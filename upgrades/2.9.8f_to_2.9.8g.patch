diff -Nur -Nur php-syslog-ng-2.9.f/html/CHANGELOG php-syslog-ng/html/CHANGELOG
--- php-syslog-ng-2.9.f/html/CHANGELOG	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/CHANGELOG	2009-02-23 12:58:28.000000000 -0500
@@ -0,0 +1,529 @@
+CHANGELOG
+
+2.9.8g
+* Update
+- Fixed Calendar (changed to a better date picker)
+- Changed SQL type for 'seq' in the database from auto_increment to int
+	to update your version just type:
+	ALTER TABLE logs MODIFY seq bigint(20);
+	from within mysql
+	NOTE: this will mess up your MERGE table, you must change it on all old tables as well and re-run logrotate.php to create a new ALL_LOGS table.
+	NOTE2: You'll also want to change your syslog-ng.conf file to insert the SEQ field like so:
+destination d_mysql {
+    program("/usr/bin/mysql -usyslogadmin -psyslogadmin syslog"
+    template("INSERT INTO logs (host, facility, priority, level, tag, datetime, program, msg, seq)
+    VALUES ( '$HOST', '$FACILITY', '$PRIORITY', '$LEVEL', '$TAG', '$YEAR-$MONTH-$DAY $HOUR:$MIN:$SEC', '$PROGRAM', '$MSG', '$SEQ' );\n")
+    template-escape(yes));
+    };
+
+- Fix for SqueezeDB not passing tables properly - Thanks Robin!
+  Email from Robin:
+  ###################
+ // CDUKES: Aug 7, 2008: Added for command line passing of tables
+$Tables = array();
+if ($argc > 1) {
+        foreach ($argv as $arg) {
+                if ($arg != $argv[0]) {
+                        $tableArray = get_logtables($dbLink);
+                        foreach($tableArray as $table) {
+                                if ($table == $arg) {
+                                        array_push($Tables, $arg);
+                                }
+                        }
+                }
+        }
+        if (!in_array($arg, $Tables)) {
+            echo "Error, $arg doesn't appear to exist\n";
+        }
+} else {
+        array_push($Tables, DEFAULTLOGTABLE);
+}
+
+Also, if you are interested in including it as a sample for the data based squeeze, here's the shell script I have evolved from your help:
+ 
+#!/bin/sh
+table="logs`date +%Y%m%d --date='4 days ago'`"
+php /srv/www/php-syslog-ng/scripts/SqueezeDB-v2.3.php $table >> /var/log/php-syslog-ng/squeeze.log
+mysqlcheck -usyslogadmin -psyslogadmin --optimize syslog $table >> /var/log/php-syslog-ng/squeeze.log
+echo "flush tables" | mysql -usyslogadmin -psyslogadmin syslog >> /var/log/php-syslog-ng/squeeze.log
+  ###################
+
+
+
+2.9.8f
+* Update
+- re-commented out the check for all_logs in reloadcache.php - it's not scaling properly on large systems. Also, I don't see the need for it since we're caching on ea
+ch log individually this way instead of relying on a massive search through a merge table.
+- Added Certificate Based Authentication by Miguel Tormo
+  Ref: http://code.google.com/p/php-syslog-ng/wiki/CertificateAuthentication
+
+2.9.8e
+* Update
+- Fix for lpdcache not detecting when SQZ was disabled
+  There's a .patch file in the scripts directory if you just want to run that against your 2.9.8d install
+  just run: patch -p0 < lpdcache.patch in the scripts/ directory
+
+2.9.8d
+* Update
+- Fix for tailresult not displaying columns correctly
+
+2.9.8c
+* Update
+- Forgot to include the new reloadcache.php
+- Fixed missing config.php.dist
+
+2.9.8b
+* Update
+- Forgot to include the new common_funcs.php
+
+2.9.8a
+* Updates/Enhancements
+- Added Front page graph for daily log count, enable/disable through config.php
+- Changed DEBUG in config.php from '0' to FALSE
+- Re-enabled SQL output on search results if DEBUG=TRUE
+- Added sql staments for Mysql 5.x users to fix problem with drop and alter commands (http://nms.gdd.net/index.php/Installation_Guide#Caveats)
+- Fixed javascript populate for "duplicates" field on search page
+- Fixed SqueezeDB issue where duplicate count was not updating properly (http://code.google.com/p/php-syslog-ng/issues/detail?id=70)
+- Added SQZ Savings calculation to search page (shows how much of a percentage the SqueezeDB script has saved overall - shows up next to the "Duplicates" dropdown as a percentage)
+- Altered graphit.php to show results based on SQZ if enabled.
+- Found and fixed a few more short tags  (http://code.google.com/p/php-syslog-ng/issues/detail?id=20&can=1&q=tag)
+- Modified SqueezeDB to handle large systems a little better - please read changes in scripts/SqueezeDB-v2.2.php
+- Fixed a bug in reloadcache.php that was trying to cache the merge table which slows reloadcache down considerably on large systems (
+  // Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=73
+- Changed the LPD graph to display numbers in a more readable manner (such as 2.4M instead of 2400000) (see blocks/graph-logs_per_day.php)
+- Added Caching for front page graphs for performance increase
+  Note: NEW FILE ADDED - ldpcache.php in the scripts directory which is called from reloadcache.php
+  Note2: This REQUIRES a change to your search_cache table:
+  ALTER TABLE search_cache MODIFY type enum('HOST','FACILITY','PROGRAM','LPD') default NULL
+- Added SQZ (fo,lo, counter) and LPD (LPD) columns to the install SQL file.
+- Fixed errors when CEMDB = OFF, REF: http://code.google.com/p/php-syslog-ng/issues/detail?id=68
+
+2.9.8 
+* Updates/Enhancements
+- Fix for tail sorting on facility fields:
+ add 
+ if (!$table) { $table = DEFAULTLOGTABLE; }
+ to line 80 of tailresult.php
+- Added 'addslashes' function to sql query cache inserts in common_funcs.php
+  // Ref: http://groups.google.com/group/php-syslog-ng-support/browse_thread/thread/eda3c96999889b47
+- Added Web Basic Auth to login for mod_auth_krb5 users
+  // Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+- Removed search page option: Collapse Identical Messages (it never worked and is replaced by the squeezeDB functionality)
+- Added search page option for "Duplicates" - only shows up if 'SQZ_ENABLED = TRUE' in confg.php
+  This option allows you to search for any duplicate lines created by the SqueezeDB feature.
+- Removed CALLHOME, it was fairly useless :-)
+- Modified distribution tar in response to http://code.google.com/p/php-syslog-ng/issues/detail?id=66
+- Removed INSTALL_STEPS file and replaced with Wiki Page @ http://nms.gdd.net/index.php/Installation_Guide
+
+TODO:
+- Re-write SqueezeDB in PERL for faster processing and scalability.
+- Need testers for SqueezeDB to verify that we aren't generating false-positives.
+
+
+2.9.7 
+* Updates/Enhancements
+!!! IMPLEMENTED SqueezeDB.php file in scripts/ !!!
+- Be sure you add this to your CRON!
+NOTE: If you have a very large database (more than 10k rows in 5 minutes), it WILL NOT scale. 
+Next release I hope to have a more scalable solution in place.
+More info on this is at http://code.google.com/p/php-syslog-ng/issues/detail?id=47
+  Cron Entry for SqueezeDB:
+ */5 * * * * php /www/php-syslog-ng/scripts/SqueezeDB-v2.0.php >> /var/log/php-syslog-ng/squeezedb.log 
+
+   NOTE: Versions of php-syslog-ng 2.9.5d and below will need to alter the database to use this script
+   ALTER TABLE logs ADD counter INT NOT NULL DEFAULT 1;
+   ALTER TABLE logs ADD fo datetime default NULL;
+   ALTER TABLE logs ADD lo datetime default NULL;
+
+- Added LDAP Auth section for Microsoft AD
+- Added 'DEMO' to config.php to change login page notification of demo site
+- Added FO, LO, and Count fields for squeezdb implementation
+- Added config.php variable for calculating hostcount on search page
+- Fixed a bug in login.php that wasn't notifying you of a failed password auth (it just put you back to the login screen)
+- Fixed bug for missing TAIL_REFRESH_SECONDS from config.php on new installation (http://code.google.com/p/php-syslog-ng/issues/detail?id=51)
+- Added a small "callhome" feature includes/callhome.php to help me get an idea of demographics - enable or disable in config.php (CALLHOME) setting.
+- Fixed FO, LO and COUNT Sort fields (added logic for sorting) in regularresult.php
+- Split Program and MSG into two columns in both regularresult and tail
+- Fixed issue 20: "Parse error: syntax error, unexpected $end in" (http://code.google.com/p/php-syslog-ng/issues/detail?id=20)
+- Fixed issue 27: "Tab stops on login screen" (http://code.google.com/p/php-syslog-ng/issues/detail?id=27)
+- Fixed issue 28: "Back to search does not remember search criteria" (http://code.google.com/p/php-syslog-ng/issues/detail?id=28)
+- Implemented issue 31: Regex Enhancements (http://code.google.com/p/php-syslog-ng/issues/detail?id=31)
+- Fixed issue 33: "custom title for tail queries" (http://code.google.com/p/php-syslog-ng/issues/detail?id=33)
+- Fixed issue 35: "save post variables through login procedure" (http://code.google.com/p/php-syslog-ng/issues/detail?id=35)
+- Fixed issue 49: Path settings in some files (http://code.google.com/p/php-syslog-ng/issues/detail?id=49)
+- Fixed issue 51: "Tail reloads page many times in a second" (http://code.google.com/p/php-syslog-ng/issues/detail?id=51)
+- Fixed issue 52: "Parse error: syntax error, unexpected $end in" (http://code.google.com/p/php-syslog-ng/issues/detail?id=52)
+- Fixed issue 53: "Parse error: syntax error, unexpected $end in" (http://code.google.com/p/php-syslog-ng/issues/detail?id=53)
+- Fixed issue 54: "Parse error: syntax error, unexpected $end in" (http://code.google.com/p/php-syslog-ng/issues/detail?id=54)
+- Fixed issue 55: "Input validation error for Program" (http://code.google.com/p/php-syslog-ng/issues/detail?id=55)
+- Fixed issue 56: "Search Option SYSLOG PRIORITY - HTML failure" (http://code.google.com/p/php-syslog-ng/issues/detail?id=56)
+- Fixed issue 57: Error check for "tail" operation on anything other than the default log table (http://code.google.com/p/php-syslog-ng/issues/detail?id=57)
+
+
+2.9.6
+* Enhancements
+- Changed "DEFINE("TTF_DIR","/usr/share/fonts/truetype/msttcorefonts/");" in includes/jpgraph/jpg-config.inc
+- Modified logrotate.php to allow for better error handling of duplicate tables 
+- Also removed myisamchk since it was causing table crashes for people.
+- Added new performance testing tools to scripts/tests/ (see README in that directory for info)
+- Modified reloadcache to remove caching based off of MERGELOGTABLE only, it was redundant.
+- MODIFIED DATABASE TABLE "search_cache", please update your tables to this:
+------------------- BEGIN SQL MODIFICATION---------------------
+mysql> drop table search_cache;
+Query OK, 0 rows affected (0.00 sec)
+
+mysql> CREATE TABLE `search_cache` (`tablename` varchar(32) default NULL,`type` enum('HOST','FACILITY','PROGRAM') default NULL, `value` varchar(128) default NULL, `updatetime` datetime default NULL,   INDEX `type_name` (`type`,`tablename`) ) ENGINE=MEMORY;
+Query OK, 0 rows affected (0.01 sec)
+------------------- END SQL MODIFICATION---------------------
+- Note that I added a 'PROGRAM' field to the enum and changed the database engine to MEMORY.
+
+- Fixed broken links for Common Graphs (line wrap was breaking the url)
+- Fixed search criteria for "Today" graph (it was searching the MERGELOGTABLE instead of DEFAULTLOGTABLE which take a *long* time on large systems
+- Fixed small cosmetic bug in graph output (it was showing a count of total hosts, instead of a sum of total rows found for TopX)
+- Fixed minor cosmetic issues with graph results (displaying total rows in results_subheader, displaying topx on graph)
+- Implemented Regex search capabilities provided by bpkroth (Big thanks!)
+  http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+ Changes as noted by bpkroth:
+ - Added a program list similar to hosts.
+ - Optional RegExp matching of hosts, programs, and messages
+ - If RegExp matching is not used, the host/program "like" fields will
+   accept comma or semicolon delimited lists of hosts to match
+ - A slight cosmetic change to the message input area so they line up.
+ - Results pages display the facility, program and host, as links for one click filtering.
+ - Results page headers allow you to adjust the results ordering via a link.
+ - Removed popups from messages that aren't found in CEMDB
+ - Date is only displayed if it's different from today
+ - Previously if $row['count'] > 1, CEMDB messages were never shown. This is fixed.
+ - Search page now uses $_SESSION variables to remember what you last entered into the form
+   so you can easily adjust the query rather than having to start over from scratch
+ - Added the ability to define the refresh rate of the tail page in config.php.
+   Make sure you configure your server to Allow overrides (AllowOverride Options)
+   Ref: http://us2.php.net/manual/en/configuration.changes.php
+
+2.9.5d
+* Minor fixes
+- Small bug fix
+
+2.9.5b
+* Minor fixes
+- Fixed Issue 36 (logrotate errors) http://code.google.com/p/php-syslog-ng/issues/detail?id=36
+  note that you need to re-grant priveleges (GRANT ALL PRIVILEGES on syslog.* to syslogadmin@'%';) to fix this.
+- Removed include from common_funcs for config.php and moved it to login.php
+  it was messing up the reloadcache.php
+- Fixed issue #45 (unable to use "ACL = FALSE" in config.php)
+  http://code.google.com/p/php-syslog-ng/issues/detail?id=45
+
+
+2.9.5a
+* Minor fixes
+- Added a .htaccess file to check for proper php global settings 
+- note that you must set "AllowOverride All" in your apache config to allow .htaccess to work.
+- Modified the regex match for cemdb stuff in tailresult and 
+  regularresult on incoming syslog messages to make it look better
+- removed a couple of old files
+
+2.9.5
+* Lots of code changes
+- Sorry...no upgrade for this one...I screwed up and used 2.9.3l as the base :-)
+  However, there are no database changes, so you *should* be able to just copy over your current html/ directory
+- Modified UMS to include LDAP Authentication
+- New login/logout screen and procedures
+- Fixed user ACL check (it only allowed the "admin" user to modify acl's before)
+- Fixed php short_open_tag issue: http://code.google.com/p/php-syslog-ng/issues/detail?id=32
+- Added fix for issue #36 (logrotate failures) http://code.google.com/p/php-syslog-ng/issues/detail?id=36
+- Applied patch for issue #43 (addcslashes) http://code.google.com/p/php-syslog-ng/issues/detail?id=43
+- Removed top information bar showing fairly useless information such as user's IP address.
+  per request from http://code.google.com/p/php-syslog-ng/issues/detail?id=25
+- Added a new favicon.ico and png under images/
+- Fixed installer to import CEMDB better and faster
+- Reduced install size by quite a bit since the cemdb is now gzipped.
+- Did a whole bunch of other things I'm probably forggetting :-0
+- Added a paypal link :-)
+
+2.9.4
+* New and improved CEMDB (yay!)
+- Added note in troubleshooting doc about setting magic quotes to "on"
+- Updated CEMDB with new data (about twice as many messages now!)
+- Note that this required a change to the CEMDB.class.php file!
+- added the "upgrades/" directory so folks could just patch to new versions. 
+  (note that you will need to manually install the new CEMDB if you use this method,
+  it's located in html/install/sql/cemdb.sql)
+  To manually install the new CEMDB:
+  1. Backup old sql:
+  mysqldump syslog cemdb > cemdb.old.sql
+  2. Delete old data from database:
+  echo "delete from cemdb" | mysql -usyslogadmin -psyslogadmin syslog
+  3. Import new data:
+  mysql syslog < html/install/sql/cemdb.sql
+  4. Apply upgrade patch:
+  patch -p0 < upgrades/2.9.3l_to_2.9.4.patch
+  # That should do it, if not, you may need to just re-run the install by zeroing out your config.php file
+- Made changes to the way syslog-ng stores its data into mysql (changing the syslog-ng.conf file)
+- Thanks go to Michael Baeker for this one!
+- Reference: http://www.baecker.com/linux/syslog-ng-in-mysql-datenbank-loggen.html
+- These changes no longer require the use of pipes so you'll want to remove:
+  "@reboot /www/php-syslog-ng/scripts/syslog2mysql.sh >> /var/log/php-syslog-ng/mysql.log 2>&1"
+  From your crontab file (crontab -e to edit the file) after making the changes to syslog-ng.conf.
+  Be sure to replace the username and password in the new syslog-ng.conf with the proper credentials.
+
+2.9.3l
+* Various fixes
+- Added chk_config to index.php to redirect to install screen if config.php is missing settings
+- Added check to common_funcs for proper PHP settings 
+- Changed function perform_query to do better error handling - added mysql_error() 
+- Changed JS to 'JS' in login.php (:%s/JS/'JS'/g)
+- fixed missing $add variable in common_funcs.php
+- Added .htaccess to make sure register_globals and magic_quotes_gpc were enabled for this site (not necessary globally in php.ini)
+- Added somewhat better login handling to login.php
+
+2.9.3k
+- Fixed improper check for $username in login.php (removed pointless code)
+
+2.9.3j
+* Various Updates/fixes
+- Applied cosmetic fix for JS definition missing from g_redirect function (http://code.google.com/p/php-syslog-ng/issues/detail?id=24)
+- Included configure.php fix for issue 1 (http://code.google.com/p/php-syslog-ng/issues/detail?id=1)
+- Changed all php shorthand echo's (in the includes directory) to longhand (http://code.google.com/p/php-syslog-ng/issues/detail?id=20)
+- Applied fix for logrotate.php (http://code.google.com/p/php-syslog-ng/issues/detail?id=21)
+- Added check for magic quotes to resolve issue 16 (http://code.google.com/p/php-syslog-ng/issues/detail?id=16)
+- Moved version information from the html_header to about.php
+- Cleaned up about.php and appended CHANGELOG info.
+
+2.9.3i
+* Ugh
+- The patch supplied for CEMDB (http://code.google.com/p/php-syslog-ng/issues/detail?id=19)
+  display threw an error on my test server, so I changed:
+//if (preg_match("/%[:alpha:].*:/", $row['msg']) == 0) {
+if (preg_match("/%[[:alpha:]]+$/", $row['msg']) == 0) {
+in regularresult.php
+
+
+2.9.3h
+* Minor updates
+- Applied CEMDB display patch from Sergio Guzman (http://code.google.com/p/php-syslog-ng/issues/detail?id=19)
+- Applied speed increase posted by patrickdk77 (http://code.google.com/p/php-syslog-ng/issues/detail?id=17)
+- Applied PHP Notices patch from emmanuel.crespy (http://code.google.com/p/php-syslog-ng/issues/detail?id=18)
+
+2.9.3g
+* Applied some fixes posted on the Google Code site
+- http://code.google.com/p/php-syslog-ng/issues/detail?id=14
+- http://code.google.com/p/php-syslog-ng/issues/detail?id=15
+- Created INSTALL-STEPS for step-by-step installation instructions
+
+2.9.3f
+* Minor update
+- Removed reference to Google Analytics (which I use on my server)
+- If you want to use it, just create a file called "includes/google-analytics.html" and add:
+	<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
+	</script>
+	<script type="text/javascript">
+	_uacct = "ACCTNUMBER";
+	urchinTracker();
+	</script>
+(Replace ACCTNUMBER with your analytics account number)
+
+2.9.3e
+* Minor fix to my previous minor fix :-)
+- After converting the eol characters to carriage returns, it had placed an extra ^M at the bottom of common_funcs.php
+  (after the last ?>) which causes headers to get messed up in php and throw a "headers already sent" error.
+  
+2.9.3d
+* Minor Fix
+- It appears that includes/common_funcs.php was missing eol characters...
+
+
+2.9.3c
+* Minor fixes
+- Changed path to config.php in scripts/drop-old-tables.php
+- Restored config.php.dist (it was empty)
+- Made some minor changes to scripts/resetusers.sh
+
+2.9.3b
+* Minor fixes
+- zero'd out config.php to allow the installer to run
+- Added memory fix to the TROUBLESHOOTING-INSTALL doc:
+
+2.9.3a
+* Minor fixes to 2.9.3
+- Increased minimum memory requirements from 64M to 128M
+- Removed duplicate table creation of the cemdb table from the install gui 
+  (2.9.3 made a change to it and I mistakenly created the table twice instead of replacing it)
+- Had to replace cemdb.sql from Daniel Berlin <mail@daniel-berlin.de> with the old one. 
+  The new one was preventing the installer from working properly...not sure why.
+  The new one from him has been renamed to "cemdb.dberlin" in the install/sql directory
+  Once the web install completes, you can load the newer format by doing the following:
+  # echo "delete from cemdb;" | mysql syslog
+  # mysql -u<user> -p syslog < cemdb.dberlin 
+  replace "<user>" and "syslog" accordingly.
+  I don't know why his imports fine from the command line but fails during the install. 
+  Anyone wanna take a crack at it?
+- Added "resetusers.sh" into the scripts directory. This script will 
+  DELETE ALL USERS and add the username/passwords for "admin/admin" and "demo/demo"
+
+
+2.9.3
+* Minor fixes included from Daniel Berlin <mail@daniel-berlin.de>
+- Issue # 8 patched (http://code.google.com/p/php-syslog-ng/issues/detail?id=8&can=1&q=)
+- Fixed missing field in emd.pl (Cisco Error Message Database)
+  Notes from Daniel:
+  The current version fails to extract the 'message' field
+  (3rd field, see below):
+ Generated by old emd.pl >>>
+  78836,'%C4K_POWERSHELF-3-INVALIDPACKETRECEIVED','ARRAY(0xc54eba0)','This
+  message indicates that the GCP protocol stack has received a packet of
+  an unexpected type. This is a transient error condition; the protocol
+  might recover automatically on the next discovery cycle.','This is an
+  informational message only. No action is required.','2006-07-03 15:53:41')
+ <<<
+ Generated by new emd.pl >>>
+  C4K_POWERSHELF-3-INVALIDPACKETRECEIVED
+  (3006, '%C4K_POWERSHELF-3-INVALIDPACKETRECEIVED', 'We got an invalid
+  packet', 'This message indicates that the GCP protocol stack has
+  received a packet of an unexpected type. This is a transient error
+  condition; the protocol might recover automatically on the next
+  discovery cycle.', 'This is an informational message only. No action is
+  required.', '2007-02-14 14:56:17')
+ <<<
+- Daniel added a new Class for CEMDB lookups (CEMDB.class.php)
+  It caches entries already looked up in the cem database
+  and results in much less database load.
+  E.g. If there are 10 messages like this one:
+  %AAA-3-IPILLEGALMSG: Fan 1 had a rotation error reported.
+  %AAA-3-IPILLEGALMSG: Fan 2 had a rotation error reported. 
+- Removed the jpgraph docs and examples (which saves ~6MB 
+  and does not change jpgraph's behavior)
+  i.e.:
+  html/includes/jpgaph/Examples
+  and
+  html/includes/jpgaph/docs
+
+ 
+2.9.2a(r14)
+* Minor fixes included from Tom Cort <linuxgeek@gmail.com>
+- php-syslog-ng-2.9.2a-r13-check-exec-mem-limits.patch - when I was
+  using the installer with the load cemdb and load sample data options I
+  was getting maximum execution time exceeded and allowed memory size
+  exhausted errors. This patch adds those checks to the first page of
+  the installer.
+
+- php-syslog-ng-2.9.2a-r13-install-index-html.patch - an HTML tag wasn't
+  closed properly, this fixes it.
+
+- php-syslog-ng-2.9.2a-r13-suppress-warnings.patch - php-syslog-ng
+  prints a warning when there are database problems. mysql_pconnect and
+  mysql_connect print warnings too. The patch suppresses the warnings
+  that mysql_pconnect and mysql_connect spit out.
+
+**** IMPORTANT (really all of this is, it's why it's here...)***
+- Moved the html/scripts directory to ../ (so that it would not be web accessible)
+- Added Mysql.pm in scripts/ which resolves a bug in Net::MySql and MySql 5.x
+
+2.9.2a(r13)
+* Minor bugfixes
+- Fixed Logrotate.php bug
+- F. Leimbach - Add logic to remember the requested query throughout a login
+  Made a few changes to this (including allowing the same for the Tail function)
+- Added user guide (Word Doc)
+- Added check to see if config.php was filled in and redirect to install if not.
+- Enhancements made to dbgen.pl so that I could use it with cron.
+
+2.9.2a
+* Minor bugfixes
+- added htmlentities filter to $info in regularresult and tailresult since some messages contained odd characters in the CEMDB.
+- Changed setcookie function - it was doing some weird timeout stuff
+
+2.9.2
+* Uh, lot's of changes...I really should have updated this file and didn't -- shame on me.
+- I did add a lot of info to the readme though --- please be sure to read that.
+
+
+2.8
+* Fixed a bug in logrotate.php (http://sourceforge.net/mailarchive/forum.php?thread_id=7674217&forum_id=34099).
+
+2.7
+* Fixed some more issues with undeclared variables 
+  (http://sourceforge.net/mailarchive/forum.php?thread_id=7433359&forum_id=34099
+  and 
+  http://sourceforge.net/mailarchive/forum.php?thread_id=7568291&forum_id=34099).
+- Fixed problem when passing arrays through POST or GET requests and running PHP without 
+  having magic quotes enabled (http://sourceforge.net/mailarchive/forum.php?thread_id=7568291&forum_id=34099).
+- Fixed a bug in the page counter at the bottom of the regularresult.php 
+  page. The count was incorrect when you moved past page five.
+- Changed the CREATE statement for the merge table in logrotate.php because it failed 
+  on some systems (it should now work on any version of MySQL 4.0.18 or later).
+- Changed logrotate.php to drop the temp table if it exists (it could 
+  possibly be created during a failed run and then the script would fail on all subsequent runs).
+
+2.6
+* More code clean-up and commenting.
+- Added an error message on failed login.
+- Did some work towards supporting other databases.
+- Option to reset other users' passwords.
+- Cache function for the search page.
+- Access controls. The access controls currently only affects various configuration specific items (add/deleting users, changing the access control settings etc).
+- Changed the database field on the search page so that you only have to pick a table if you have more than one table.
+- Fixed bug in get_logtables() (http://sourceforge.net/mailarchive/forum.php?thread_id=7433359&forum_id=34099).
+- Fixed issue with persistent MySQL connections. db_connect_syslog() now only uses mysql_pconnect() if it is available.
+- Fixed issue with undeclared variables. Some versions of PHP produce 
+  lots of errors/warnings/notices when variables are not declared before they are used.
+
+
+2.5.4
+* More code clean-up and commenting.
+- Added authentication. It can be enabled by setting REQUIRE_AUTH in config.php. 
+  Authentication also requires a new table and a create statement was added to the 
+  dbsetup.sql script. For authentication to work you also need to run the new GRANT 
+  statement for the regular user (GRANT UPDATE ON syslog.users TO sysloguser@localhost;). 
+  You should also add a user so that you are able to log in (you can add more users once you are logged in). 
+  INSERT INTO users (username, pwhash) VALUES('admin', 'd033e22ae348aeb5660fc2140aec35850c4da997'); 
+  will add a user 'admin' with password 'admin'.
+- Added a new field to the search page. If you have multiple tables with log data then 
+  you will get a dropdown where you can select what table to search. Unless you only 
+  have one table or have a merge table that covers all tables then you have to pick a 
+  table to work with before the rest of the form is displayed.
+- Changed the logrotate.php script to handle merge tables. This feature can be turned 
+  on and off using MERGELOGTABLE in config.php. When active then the logrotate.php will 
+  create a merge table covering all log tables whenever it's run. In order for this change 
+  to work you need to allow the admin user to have RELOAD priviliges. 
+  GRANT RELOAD ON *.* TO syslogadmin@localhost; will take care of that. 
+  You should not attempt to run the logrotate script more than once per day.
+- Changed the logrotate.php script to enable deleting outdated tables. This 
+  feature can be turned on and off using LOGROTATERETENTION in config.php. 
+  LOGROTATERETENTION specifies the number of days to keep old logs. Log tables with a 
+  datestamp older than today minus LOGROTATERETENTION will be deleted whenever logrotate.php is run.
+- Fixed a bug that caused the exclude option for PRIORITY to malfunction 
+  (http://sourceforge.net/mailarchive/forum.php?thread_id=7376135&forum_id=34099).
+- Fixed a bug that could result in collapsing identical messages from different hosts into one message.
+- Included a help page. If the database is unavailable then this page is the default page.
+- A few cosmetic changes to the user interface.
+- Implemented input validation for almost all input.
+
+2.5.3
+* Complete top-to-bottom clean-up of the code including large parts that were re-written.
+- Simplified much of the HTML ... but tried to stay true to the original look.
+- Changed the way the total number of results is calculated. My approach requires 
+  MySQL 4.0 or later. This way you can use a LIMIT statement and still get the total 
+  number of potential results if you had not used LIMIT. Also implemented an option to 
+  turn off this feature if using older versions of MySQL (no count will be displayed on 
+  older versions of MySQL).
+- Changed the list of result pages. It lists links to the 11 closest pages and adds 
+  FIRST, PREV, NEXT and LAST links. This only works correct when you have a total row 
+  count but limited functionality is offered for MySQL 3.x users (First, Prev and Next links).
+- The max-limit input variable is probably mostly useless now so it was removed.
+- Added sorting by column (seq, facility, severity, datetime).
+- Changed the way to and from times/dates are handled. A blank date field indicates any date. 
+  And if a date is entered and no time is specified then 00:00:00 is used for the FROM 
+  time and 23:59:59 is used for the TO time. Entering a time without a date results in 
+  the time being ignored.
+- 'now', 'today' and 'yesterday' are valid values for the date inputs on the search page (now and today are the same).
+- 'now' is valid value for the time inputs on the search page.
+- Did some prep work to allow an arbitrary number of inputs when searching for specific messages.
+- The hostname link on the result page (for both the regular result and the 
+  tail result) narrows down the search to only include that particular host.
+- The results in the tail script can be narrowed down using many of the same variables as the regular search result.
+- MySQL functions that include basic database error handling.
+- Added a button on the search page to go straight to the tail result page.
+- Added an option to collapse consecutive lines with identical messages into one line.
+- Included some sample scripts for setup etc (create database and database users, 
+  logrotate, syslog to mysql).
+# END
diff -Nur -Nur php-syslog-ng-2.9.f/html/CiUI.css php-syslog-ng/html/CiUI.css
--- php-syslog-ng-2.9.f/html/CiUI.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/CiUI.css	2008-08-14 11:00:42.000000000 -0400
@@ -0,0 +1,257 @@
+/*
+File: CiUI.css
+
+Style sheet complementing CiUI library.
+
+License:
+	http://clientside.cnet.com/wiki/cnet-libraries#license
+*/
+
+* {
+	padding: 0;
+	margin: 0;
+	font-family:Helvetica,"Lucida Grande",Verdana,Arial,sans-serif;
+}
+
+body {
+	overflow: visible;
+	padding: 0;
+	margin: 0;
+	width: 320px;
+}
+
+#iphone_header {
+	left: 0px;
+	top: 0px;
+	height:44px;
+	background: #ca2026;
+}
+
+#iphone_body {
+	position: relative;
+	overflow: hidden;	
+	width: 100%;
+	min-height: 316px;
+}
+
+.iphone_page {
+	position: absolute;
+	width: 100%;
+}
+
+#iphone_footer {
+	position: relative;
+	font-size: 10px;
+	color: #666;
+	text-align: center;
+}
+
+#iphone_backbutton {
+	position: relative;
+	float: left;
+	top: 7px;
+	left: 5px;
+	cursor: pointer;
+	display: none;
+}
+
+#iphone_backbutton_text {
+	background:transparent url(images/back-button-body.png) no-repeat scroll right top;
+	color:white;
+	display:block;
+	font-size:12px;
+	font-weight:bold;
+	height:30px;
+	margin-left:11px;
+	padding-right:5px;
+	padding-top:9px;
+	text-decoration:none;
+}
+
+#iphone_loading_page {
+	display: none;
+}
+
+#iphone_title {
+	color: white;
+	position: relative;
+	text-align: center;
+	padding: 0;
+	top: 13px;
+	font-weight: bold;
+	font-size: 18px;
+	text-shadow: rgba(0, 0, 0, 0.4) 0px -1px 0;
+	text-overflow: ellipsis;
+	white-space: nowrap;
+	overflow: hidden;
+	left: 5px;
+}
+
+.refresh {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 10px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background-color: #eee;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+}
+
+a.refresh:before {
+	content: "Refresh...";
+}
+
+.refresh_loading {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 23px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background:#194fdb url(images/loading-small.gif) no-repeat 1% center;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+	color: white;
+}
+
+a.refresh_loading:after {
+	content: "Refreshig...";
+}
+.load_more {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 10px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background-color: #eee;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+}
+
+a.load_more:before {
+	content: "Load more content...";
+}
+
+.load_more_loading {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 23px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background:#194fdb url(images/loading-small.gif) no-repeat 1% center;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+	color: white;
+}
+
+a.load_more_loading:after {
+	content: "Loading...";
+}
+
+.info_msg {
+	font-size:18px;
+	font-weight:bold;
+	text-align:center;
+	vertical-align:middle;
+	height:300px;
+	width:100%;
+	margin-bottom:150px;
+	margin-top:100px;
+}
+
+#cancel_button {
+	font-size: 16px;
+	font-weight: bold;
+	margin-top: 5px;
+	color: #333;
+}
+
+.menu {
+	width: 100%;
+	list-style-type: none;
+}
+
+.menu > li {
+	clear: both;
+	height: 30px;
+	font-weight: bold;
+	font-size: 16px;
+	cursor: pointer;
+	margin: 0;
+	padding: 8px 0pt 8px 10px;
+	border-bottom: 1px solid #ddd;	
+}
+
+.menu > li > a {
+	text-overflow: ellipsis;
+	text-decoration: none;
+	color: #333;
+	display: block;
+	padding: 8px 32px 8px 10px;
+	margin: 0px 0pt -8px -10px;
+	background: url(images/arrow-right.png) no-repeat right center;
+}
+
+.menu li button {
+	font-size:16px;
+	font-weight:bold;
+	vertical-align: middle;
+}
+
+.menu li img {
+	border: 0px;
+	vertical-align:middle;
+	margin-right: 5px;
+}
+.wapdarker {
+  background-color: #C0C0C0;
+  font-size: 9px;
+}
+.waplighter {
+  background-color: #E0E0E0;
+  font-size: 9px;
+}
+.wapresultsheader {
+  background-color: #484848;
+  color: #ffffff;
+  text-align: left;
+  font-weight: bold;
+  font-size: 9px;
+}
+.debug {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 10px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background-color: #eee;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+}
+
+a.debug:before {
+	content: "Debug...";
+}
+
+.debug {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 23px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background:#194fdb url(images/loading-small.gif) no-repeat 1% center;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+	color: white;
+}
+
+a.debug:after {
+	content: "Debug...";
+}
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/CiUI.js php-syslog-ng/html/CiUI.js
--- php-syslog-ng-2.9.f/html/CiUI.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/CiUI.js	2008-04-11 20:01:44.000000000 -0400
@@ -0,0 +1,341 @@
+/*
+Script: CiUI.js
+
+Handles iPhone-optimized pages and mimics iPhone UI behavior
+
+License:
+	http://clientside.cnet.com/wiki/cnet-libraries#license
+*/
+
+(function() {
+
+var bodyEl; // see ciUI.initialize() for details
+var buttonForward = "go_forward";
+var buttonBackward = "go_back";
+var buttonLoadMore = "load_more";
+var backButtonEl; // see ciUI.initialize() for details
+var backButtonTextEl; // see ciUI.initialize() for details
+var pageTitleEl; // see ciUI.initialize() for details
+var update = "do_update";
+var updateAttr = "update";
+
+var pages = []; // see ciUI.initialize() for details
+var pageHistory = []; 
+
+var homePage = location.href;
+var hashPrefix = "#__";
+var currentHash = location.hash;
+var currentPage = 1; // possible values are 1 or -1 (1: from, -1: to)
+
+var animSpeed = 20; // smaller number means slower animation
+var navigationCheckInterval = 300;
+var navigtionChangeTimer;
+var uiIsActive;
+
+window.ciUI = {
+	initialize: function() {
+		bodyEl = $("iphone_body");
+		backButtonEl = $("iphone_backbutton");
+		backButtonTextEl = $("iphone_backbutton_text");
+		pageTitleEl = $("iphone_title");
+		if (!bodyEl || !backButtonEl || !backButtonTextEl || !pageTitleEl) return;
+		if (pageTitleEl && pageTitleEl.innerHTML == "") pageTitleEl.innerHTML = document.title;
+		this.setupPages();
+		this.animating = false;
+		setTimeout(scrollTo, 100, 0, 1);
+		return true;
+	},
+	
+	setupPages: function() {
+		var page1 = document.createElement('div');
+		var page2 = document.createElement('div');
+		var home  = document.createElement('div');
+		var ascrolltop = document.createElement('a');
+
+		page1.id = "__page1__";
+		page1.className = "iphone_page";
+		page1.style.left = "0%";
+		page1.style.display = "block";
+		
+		page2.id = "__page2__";
+		page2.className = "iphone_page";
+		page2.style.left = "100%";
+		page2.style.display = "none";
+		
+		home.id	= "__home__";
+		home.style.display = "none";
+		ascrolltop.id = "__scroll_top__";
+		ascrolltop.name = "";
+		
+		page1.innerHTML = home.innerHTML = bodyEl.innerHTML;
+		bodyEl.innerHTML = "";
+		bodyEl.appendChild(page1);
+		bodyEl.appendChild(page2);		
+		document.body.appendChild(home);
+		document.body.insertBefore(ascrolltop, document.body.firstChild);
+
+		this.adjustBodyToEl(page1);
+	
+		pages[1] = $(page1.id);
+		pages[0] = $(home.id);
+		pages[-1] = $(page2.id);
+	},
+	
+	goToPage: function(target, backwards) {
+		if (backwards === undefined) backwards = false;
+
+		this.slidePages(backwards);
+		// BACKWARD
+		if (backwards) { 
+			currentHash = location.hash;
+			pageHistory.splice(pageHistory.indexOf(target)+1, pageHistory.length);
+		}
+		// FORWARD
+		else {
+   			pageHistory.push(target);								
+		}
+		this.updatePage(target);				
+	},
+	
+	loadMore: function(target) {
+		target.className = "load_more_loading";
+		(new this.ajax(target.href, updatePage)).run();
+		
+		function updatePage(content) {
+			target.parentNode.removeChild(target);
+			pages[currentPage].innerHTML += content;
+			ciUI.adjustBodyToEl(pages[currentPage]);
+		}
+	},
+	
+	updatePage: function(target) {
+		var nextHash = hashPrefix + (pageHistory.length);
+		backButtonEl.style.display = (pageIndexFromHash(nextHash) == 0 || !target) ? "none" : "block";
+		// Update body with new page content
+		if (pageIndexFromHash(nextHash) == 0 || !target) {
+			pageTitleEl.innerHTML = trim(document.title);
+			this.updatePageContent(pages[0].innerHTML); // page[0] is home, no need for AJAX
+		}			
+		else {
+			backButtonTextEl.innerHTML = (pageHistory[pageHistory.length-2]) ? trim(pageHistory[pageHistory.length-2].title, 15) : "Back";
+			pageTitleEl.innerHTML = trim(target.title);			
+			var url = target.href;
+			if (!url && target.tagName.toLowerCase() == "form") url = target.action+"?"+target.toQueryString();
+			(new this.ajax(url, this.updatePageContent)).run();
+		}
+	},
+	
+	updatePageContent: function(content) {
+		var updateTimer = setInterval(update, 0);
+			
+		function update() {
+			if (!ciUI.animating) {
+				$("__scroll_top__").name = currentHashName(true);
+				pages[currentPage].innerHTML = content;
+				pages[-currentPage].innerHTML = "";
+				clearInterval(updateTimer);								
+				ciUI.adjustBodyToEl(pages[currentPage]);				
+				location.href = currentHash = currentHashName();
+				if (ciUI.callbackFunct) ciUI.callbackFunct();
+			}			
+		}		
+	},
+	
+	slidePages: function(backwards) {
+		this.animating = true;
+		
+		var fromPage = pages[currentPage];
+		var toPage = pages[-currentPage];
+		var progress = 100;
+		
+		toPage.innerHTML = this.loadingPage();
+		toPage.style.display = "block";
+		
+		if (!backwards) toPage.style.left = "100%";
+		
+		clearInterval(navigationChangeTimer); // pause the history daemon during animation.
+		setTimeout(scrollTo, 100, 0, 1);
+		var animTimer = setInterval(animate, 0);
+		
+		function animate() {
+			progress -= animSpeed;
+			
+			if (progress <= 0) {
+				clearInterval(animTimer);				
+				navigationChangeTimer = setInterval(navigationChangeAgent, navigationCheckInterval); // restart the history daemon
+				currentPage *= -1;
+				progress = 0;
+				ciUI.animating = false;
+			}			
+			fromPage.style.left = (backwards ? (100 - progress) : (progress - 100)) + "%";
+			toPage.style.left = (backwards ? -progress : progress) + "%";
+		}
+	},
+	
+	ajax: function(sourceURL, responseConsumer, responseType) {
+		var httpRequest = false;
+		
+		this.run = function()
+		{
+			if (responseType === undefined) responseType = "TEXT";
+			responseType = responseType.toUpperCase();
+			
+			if (window.XMLHttpRequest) { 
+				httpRequest = new XMLHttpRequest();
+				if (httpRequest.overrideMimeType) {
+					httpRequest.overrideMimeType('text/xml');
+				}
+			} 
+			else if (window.ActiveXObject) { 
+				try {
+					httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
+				} 
+				catch (e) {
+					try {
+						httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
+					} 
+					catch (e) {}
+				}
+			}
+			
+			if (!httpRequest) {
+				//console.log('Giving up, cannot create an XMLHTTP instance');
+				return false;
+			}
+	
+			httpRequest.open('GET', sourceURL, true);
+			httpRequest.onreadystatechange = getResponse;
+			httpRequest.send(null);	
+		};
+		
+		function getResponse() {	
+			if (httpRequest.readyState == 4)
+				if (httpRequest.status == 200) {
+					if (responseType == "XML")
+						responseConsumer(httpRequest.responseXML);
+					else
+						responseConsumer(httpRequest.responseText);
+				}
+				else
+					;//console.log("There was a problem with the request: " + sourceUrl);
+		}
+	},
+	
+	update: function(url, element) {	
+		(new this.ajax(url, function(html){
+			if (!element.tagName) element = $(element);
+			element.innerHTML = html;
+		})).run();
+	},
+		
+	cancel: function(event) {
+		pageHistory = [];
+		location.reload(true);
+		location.hash = "";
+		location.href = homePage;
+		return false;
+	},
+	
+	loadingPage: function() {
+		return $("iphone_loading_page").innerHTML;
+	},
+	
+	// a dirty hack to move the footer to proper location since iphone_body doesn't expand with content
+	adjustBodyToEl: function(el) {
+		bodyEl.style.height = el.offsetHeight + "px";
+	}	
+};
+
+addEventListener("load", function(event) {
+	uiIsActive = ciUI.initialize();
+	if (uiIsActive) navigationChangeTimer = setInterval(navigationChangeAgent, navigationCheckInterval);
+}, false);
+
+addEventListener("click", function(event) {
+	if (!uiIsActive) return;
+	var a = findParent(event.target, "a");
+	// We don't want to prevent defaults by default because there may be actual hrefs going to outside pages
+	if (a && a.hasClass(buttonForward)) {
+		ciUI.goToPage(a);
+		event.preventDefault();
+	} else if (a && a.hasClass(buttonBackward)) {
+		history.back();	
+		event.preventDefault();
+	} else if (a && a.hasClass(buttonLoadMore)) {
+		ciUI.loadMore(a);
+		event.preventDefault();	
+	}	
+}, true);
+
+addEventListener("submit", function(event) {
+	if (!uiIsActive) return;
+	var a;
+	var form = findParent(event.target, "form");
+	if (!form) return;
+	if (form.hasClass(buttonForward)) {	
+		event.preventDefault();
+		return ciUI.goToPage(form);
+	} else if (form.hasClass(update)) {
+		event.preventDefault();
+		ciUI.update(form.action+"?"+form.toQueryString(), form.getAttribute(updateAttr));
+		}
+}, true);
+
+addEventListener("click", function(event) {
+	if (!uiIsActive) return;
+	var a = findParent(event.target, ("a"));
+	if (!a || !a.hasClass(update)) return;
+	ciUI.update(a.href, a.getAttribute(updateAttr));
+}, true);
+
+function trim(text, maxLength) {
+	if (maxLength === undefined) maxLength = 20;
+	return (text.length > maxLength) ? text.substring(0, maxLength - 3) + "..." : text;
+};
+
+function currentHashName(ommitHashSymbol) {
+	return (ommitHashSymbol) ? hashPrefix.substr(1, hashPrefix.length) + (pageHistory.length) : hashPrefix + (pageHistory.length);
+};
+
+function navigationChangeAgent() {
+	if (currentHash != location.hash) {
+		ciUI.goToPage(pageHistory[pageHistory.length-2], true);
+	}
+};
+
+function pageIndexFromHash(hash) {
+	return (hash) ? hash.substr(hash.lastIndexOf("_") + 1, hash.length) : 0;
+};
+
+Element.prototype.hasClass = function(name) {
+	return this.className.indexOf(name) != -1;
+};
+
+Element.prototype.toQueryString = function(){
+	var qs = "";
+	var getvals = function(element){
+		var kids = element.childNodes;
+		for (var i=0; i < kids.length; i++) {
+			var el = kids[i];
+			if (el.tagName) {
+				var t = el.tagName.toLowerCase();
+				if (t.toLowerCase() == "input" || t.toLowerCase() == "textarea") qs += el.name + "=" + escape(el.value) + "&";
+				else if (t == "select") qs += el.name + "=" + escape(el.options[el.selectedIndex].value) + "&"; //no support for multiselect yet
+				else getvals(el);
+			}
+		}
+	};
+	getvals(this);
+	return qs;
+}
+
+// This function is courtesy of iUI
+function findParent(node, localName) {
+    while (node && (node.nodeType != 1 || node.localName.toLowerCase() != localName))
+        node = node.parentNode;
+    return node;
+};
+
+function $(id) { return document.getElementById(id); };
+
+})();
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/config/config.php php-syslog-ng/html/config/config.php
--- php-syslog-ng-2.9.f/html/config/config.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/config/config.php	2009-02-23 13:08:24.000000000 -0500
@@ -0,0 +1,143 @@
+<?php
+define('PAGETITLE', 'Php-Syslog-NG' );
+define('VERSION', '2.9.8e');
+define('COUNT_ROWS', TRUE);
+define('DEFAULTLOGTABLE', 'logs');
+define('MERGELOGTABLE', 'all_logs');
+define('USETABLE', DEFAULTLOGTABLE); // This tells the main page to calculate hostcount based on "all_logs" or "logs"
+define('LOGROTATERETENTION', 30);
+define('DBUSER', 'sysloguser');
+define('DBUSERPW', 'sysloguser');
+define('DBADMIN', 'syslogadmin');
+define('DBADMINPW', 'syslogadmin');
+define('DBNAME', 'syslog');
+define('DBHOST', 'localhost');
+define('DBPORT', '3306');
+define('REQUIRE_AUTH', TRUE);
+define('AUTHTABLENAME', 'users');
+define('RENEW_SESSION_ON_EACH_PAGE', TRUE);
+define('SESSION_EXP_TIME', '3600');
+define('TAIL_REFRESH_SECONDS', '25');
+define('USE_ACL', TRUE);
+define('USER_ACCESS_TABLE', 'user_access');
+define('ACTION_TABLE', 'actions');
+define('USE_CACHE', TRUE);
+define('CACHETABLENAME', 'search_cache');
+define('SITEADMIN', 'admin');
+define('SITENAME', 'The Home of Php-Syslog-NG');
+define('ADMINEMAIL', 'cdukes@cdukes.com');
+define('CEMDB', 'ON');
+define('CISCO_ERROR_TABLE', 'cemdb');
+define('DEBUG', TRUE);
+define('SITEURL', '/');
+$regExpArray = array(
+		   	// "username"=>"(^\w{4,}\$)",
+		   	// Cdukes - 05/10/08: Modified username to allow email address as username
+		   	// This is an enhancement change for
+		   	// http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+		   	"username" => "(^[A-Za-z_.@]{4,}\$)",
+			"password"=>"(^.{4,}\$)",
+			"pageId"=>"(^\w+$)",
+			"sessionId"=>"(^\w{32}\$)",
+			// "date"=>"/^yesterday$|^today$|^now$|^(\d){4}-([01]*\d)-([0123]*\d)$/i",
+			"date"=>"/^yesterday$|^today$|^now$|^([0123]*\d)-([012]*\d)-(\d){4}$/i",
+			"time"=>"/^now$|^([012]*\d):([012345]*\d):([012345]*\d)$/i",
+			"limit"=>"(^\d+$)",
+			"topx"=>"(^\d+$)",
+			// BPK added program to orderby filter
+			"orderby"=>"/^seq$|^host$|^program$|^facility$|^priority$|^datetime$|^msg$|^fo$|^lo$|^counter$/i",
+			"order"=>"/^asc$|^desc$/i",
+			"offset"=>"(^\d+$)",
+			"collapse"=>"/^1$/",
+			"table"=>"(^\w+$)",
+			"excludeX"=>"(^[01]$)",
+			/* BEGIN: changes by BPK to allow for regexp matching, lists of hosts, and programs
+			"host"=>"(^[\w-.]+$)",
+			*/
+			"regexpX"=>"(^[01]$)",
+			"host"=>"(^([\w_.%-]+[,;]\s*)*[\w_.%-]+$)",
+			"program"=>"(^([\w/_.%-]+[,;]\s*)*[\w/_.%-]+$)",
+			"hostRegExp"=>"(^\S+$)",
+			"programRegExp"=>"(^\S+$)",
+			/* END: changes by BPK to allow for regexp matching, lists of hosts, and programs */
+			"facility"=>"(^\w+$)",
+		   	"priority"=>"/^debug$|^info$|^notice$|^warning$|^err$|^crit$|^alert$|^emerg$/i",
+		   	// Cdukes - 05/10/08: Below is an enhancement addition for SqueezeDB duplicate searching
+		   	"dupop"=>"(^lt|gt|eq$)",
+		   	"dupcount"=>"(^\d+$)",
+			);
+//------------------------------------------------------------------------
+// CDUKES - BEGIN jpgraph Addon
+//------------------------------------------------------------------------
+
+// Enable Graphing
+define('JPG_GRAPHS', 'ON');
+// Make sure this directory exists and has write permission
+define('IMG_CACHE_DIR', 'jpcache/');
+
+// Enable Daily Graph in dropdown on main page
+define('JPG_DAILY', 'ON');
+// Enable Weekly Graph in dropdown on main page
+define('JPG_WEEKLY', 'ON');
+// Enable Monthly Graph in dropdown on main page
+define('JPG_MONTHLY', 'ON');
+// Enable Overall Statistics Graph on main page (This will slow down main page rendering)
+define('JPG_MAIN', 'OFF'); // Not implemented yet
+
+
+//------------------------------------------------------------------------
+// CDUKES - END jpgraph Addon
+//------------------------------------------------------------------------
+//------------------------------------------------------------------------
+// CDUKES - Begin LDAP Addon
+//------------------------------------------------------------------------
+define('LOGIN_URL', SITEURL . "login.php");
+define('LOGOUT_URL', SITEURL . "logout.php");
+define('INDEX_URL', SITEURL . "index.php");
+define('LDAP_ENABLE', "NO");
+define('LDAP_SRV', "ldap.company.com");
+define('LDAP_BASE_DN', "ou=active, ou=employees, ou=people, o=company.com");
+// variable to search for user (container name) - in my case, this is "uid", but normally it is "cn"
+define('LDAP_CN', "uid");
+// if using MS Active Directory, put it to "sAMAccountName"
+// define('LDAP_CN', "sAMAccountName");
+// Set to Yes if using MS Active Directory for Authentication
+define('LDAP_MSAD', "NO");
+// Required when if LDAP_MSAD set to YES and using MS Active Directory, ex. mydomain.com
+define('LDAP_DOMAIN', "mydomain.com");
+
+// privilege levels for editing records 
+// (not implemented yet - this will be used to define RW and RO groups from LDAP)
+// use privilege level authentication for record editing?
+define  ('LDAP_USEPRIV', 'OFF');
+// if USEPRIV is enabled, what LDAP group name is the "privileged" group?
+define  ('LDAP_RW_GROUP', 'admin');
+define  ('LDAP_RO_GROUP', 'users');
+//------------------------------------------------------------------------
+// CDUKES - END LDAP Addon
+//------------------------------------------------------------------------
+
+//------------------------------------------------------------------------
+// cdukes - I added this just in case someone felt generous
+// If you don't want it on the menu bar, just disable it here :-)
+//------------------------------------------------------------------------
+define  ('PAYPAL_ENABLE', 'YES');
+//------------------------------------------------------------------------
+// CDUKES - Just a simple addition for my demo site at http://php-syslog-ng.gdd.net
+//------------------------------------------------------------------------
+define  ('DEMO', TRUE);
+// Cdukes - 05/10/08: WEBBASIC_ENABLE
+// This is an enhancement change for
+// http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+define('WEBBASIC_ENABLE', FALSE);
+// Cdukes - 05/10/08: SQZ_ENABLED
+// This is an enhancement change for SqueezeDB functionality
+// http://code.google.com/p/php-syslog-ng/issues/detail?id=47
+define('SQZ_ENABLED', FALSE);
+//------------------------------------------------------------------------
+// CDUKES - Added front page bar graph for daily log count
+//------------------------------------------------------------------------
+define('GRAPH_LPD', TRUE);
+define('LPD_CACHE', TRUE);
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/config/config.php.dist php-syslog-ng/html/config/config.php.dist
--- php-syslog-ng-2.9.f/html/config/config.php.dist	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/config/config.php.dist	2009-02-23 13:03:37.000000000 -0500
@@ -0,0 +1,143 @@
+<?php
+define('PAGETITLE', 'Php-Syslog-NG' );
+define('VERSION', '2.9.8e');
+define('COUNT_ROWS', TRUE);
+define('DEFAULTLOGTABLE', 'logs');
+define('MERGELOGTABLE', 'all_logs');
+define('USETABLE', DEFAULTLOGTABLE); // This tells the main page to calculate hostcount based on "all_logs" or "logs"
+define('LOGROTATERETENTION', 30);
+define('DBUSER', 'sysloguser');
+define('DBUSERPW', 'sysloguser');
+define('DBADMIN', 'syslogadmin');
+define('DBADMINPW', 'syslogadmin');
+define('DBNAME', 'syslog');
+define('DBHOST', 'localhost');
+define('DBPORT', '3306');
+define('REQUIRE_AUTH', TRUE);
+define('AUTHTABLENAME', 'users');
+define('RENEW_SESSION_ON_EACH_PAGE', TRUE);
+define('SESSION_EXP_TIME', '3600');
+define('TAIL_REFRESH_SECONDS', '25');
+define('USE_ACL', TRUE);
+define('USER_ACCESS_TABLE', 'user_access');
+define('ACTION_TABLE', 'actions');
+define('USE_CACHE', TRUE);
+define('CACHETABLENAME', 'search_cache');
+define('SITEADMIN', 'admin');
+define('SITENAME', 'The Home of Php-Syslog-NG');
+define('ADMINEMAIL', 'cdukes@cdukes.com');
+define('CEMDB', 'ON');
+define('CISCO_ERROR_TABLE', 'cemdb');
+define('DEBUG', TRUE);
+define('SITEURL', '/');
+$regExpArray = array(
+		   	// "username"=>"(^\w{4,}\$)",
+		   	// Cdukes - 05/10/08: Modified username to allow email address as username
+		   	// This is an enhancement change for
+		   	// http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+		   	"username" => "(^[A-Za-z_.@]{4,}\$)",
+			"password"=>"(^.{4,}\$)",
+			"pageId"=>"(^\w+$)",
+			"sessionId"=>"(^\w{32}\$)",
+			// "date"=>"/^yesterday$|^today$|^now$|^(\d){4}-([01]*\d)-([0123]*\d)$/i",
+			"date"=>"/^yesterday$|^today$|^now$|^([0123]*\d)-([012]*\d)-(\d){4}$/i",
+			"time"=>"/^now$|^([012]*\d):([012345]*\d):([012345]*\d)$/i",
+			"limit"=>"(^\d+$)",
+			"topx"=>"(^\d+$)",
+			// BPK added program to orderby filter
+			"orderby"=>"/^seq$|^host$|^program$|^facility$|^priority$|^datetime$|^msg$|^fo$|^lo$|^counter$/i",
+			"order"=>"/^asc$|^desc$/i",
+			"offset"=>"(^\d+$)",
+			"collapse"=>"/^1$/",
+			"table"=>"(^\w+$)",
+			"excludeX"=>"(^[01]$)",
+			/* BEGIN: changes by BPK to allow for regexp matching, lists of hosts, and programs
+			"host"=>"(^[\w-.]+$)",
+			*/
+			"regexpX"=>"(^[01]$)",
+			"host"=>"(^([\w_.%-]+[,;]\s*)*[\w_.%-]+$)",
+			"program"=>"(^([\w/_.%-]+[,;]\s*)*[\w/_.%-]+$)",
+			"hostRegExp"=>"(^\S+$)",
+			"programRegExp"=>"(^\S+$)",
+			/* END: changes by BPK to allow for regexp matching, lists of hosts, and programs */
+			"facility"=>"(^\w+$)",
+		   	"priority"=>"/^debug$|^info$|^notice$|^warning$|^err$|^crit$|^alert$|^emerg$/i",
+		   	// Cdukes - 05/10/08: Below is an enhancement addition for SqueezeDB duplicate searching
+		   	"dupop"=>"(^lt|gt|eq$)",
+		   	"dupcount"=>"(^\d+$)",
+			);
+//------------------------------------------------------------------------
+// CDUKES - BEGIN jpgraph Addon
+//------------------------------------------------------------------------
+
+// Enable Graphing
+define('JPG_GRAPHS', 'ON');
+// Make sure this directory exists and has write permission
+define('IMG_CACHE_DIR', 'jpcache/');
+
+// Enable Daily Graph in dropdown on main page
+define('JPG_DAILY', 'ON');
+// Enable Weekly Graph in dropdown on main page
+define('JPG_WEEKLY', 'ON');
+// Enable Monthly Graph in dropdown on main page
+define('JPG_MONTHLY', 'ON');
+// Enable Overall Statistics Graph on main page (This will slow down main page rendering)
+define('JPG_MAIN', 'OFF'); // Not implemented yet
+
+
+//------------------------------------------------------------------------
+// CDUKES - END jpgraph Addon
+//------------------------------------------------------------------------
+//------------------------------------------------------------------------
+// CDUKES - Begin LDAP Addon
+//------------------------------------------------------------------------
+define('LOGIN_URL', SITEURL . "login.php");
+define('LOGOUT_URL', SITEURL . "logout.php");
+define('INDEX_URL', SITEURL . "index.php");
+define('LDAP_ENABLE', "NO");
+define('LDAP_SRV', "ldap.company.com");
+define('LDAP_BASE_DN', "ou=active, ou=employees, ou=people, o=company.com");
+// variable to search for user (container name) - in my case, this is "uid", but normally it is "cn"
+define('LDAP_CN', "uid");
+// if using MS Active Directory, put it to "sAMAccountName"
+// define('LDAP_CN', "sAMAccountName");
+// Set to Yes if using MS Active Directory for Authentication
+define('LDAP_MSAD', "NO");
+// Required when if LDAP_MSAD set to YES and using MS Active Directory, ex. mydomain.com
+define('LDAP_DOMAIN', "mydomain.com");
+
+// privilege levels for editing records 
+// (not implemented yet - this will be used to define RW and RO groups from LDAP)
+// use privilege level authentication for record editing?
+define  ('LDAP_USEPRIV', 'OFF');
+// if USEPRIV is enabled, what LDAP group name is the "privileged" group?
+define  ('LDAP_RW_GROUP', 'admin');
+define  ('LDAP_RO_GROUP', 'users');
+//------------------------------------------------------------------------
+// CDUKES - END LDAP Addon
+//------------------------------------------------------------------------
+
+//------------------------------------------------------------------------
+// cdukes - I added this just in case someone felt generous
+// If you don't want it on the menu bar, just disable it here :-)
+//------------------------------------------------------------------------
+define  ('PAYPAL_ENABLE', 'YES');
+//------------------------------------------------------------------------
+// CDUKES - Just a simple addition for my demo site at http://php-syslog-ng.gdd.net
+//------------------------------------------------------------------------
+define  ('DEMO', TRUE);
+// Cdukes - 05/10/08: WEBBASIC_ENABLE
+// This is an enhancement change for
+// http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+define('WEBBASIC_ENABLE', FALSE);
+// Cdukes - 05/10/08: SQZ_ENABLED
+// This is an enhancement change for SqueezeDB functionality
+// http://code.google.com/p/php-syslog-ng/issues/detail?id=47
+define('SQZ_ENABLED', FALSE);
+//------------------------------------------------------------------------
+// CDUKES - Added front page bar graph for daily log count
+//------------------------------------------------------------------------
+define('GRAPH_LPD', TRUE);
+define('LPD_CACHE', TRUE);
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/css/default.css php-syslog-ng/html/css/default.css
--- php-syslog-ng-2.9.f/html/css/default.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/css/default.css	2008-02-06 15:48:33.000000000 -0500
@@ -0,0 +1,299 @@
+body {
+  font-family: Verdana, Arial, Helvetica, Swiss, Futura, sans-serif;
+  font-size: 11px;
+  background: #FFFFFF;
+  padding: 0px;
+  border: 0px;
+  margin: 0px;
+  color: #000000;
+  font-size: 11px;
+}
+
+table {
+  width: 100%;
+  color: #000000;
+  font-family: Verdana, Arial, Helvetica, Swiss, Futura, sans-serif;
+  font-size: 11px;
+}
+
+a {
+  font-weight: bold;
+  color: #000000;
+  text-decoration: none;
+}
+
+a:hover {
+  color: #66AA00;
+}
+
+hr {
+  width: 99%;
+}
+
+table.pagecontent {
+  width: 98%;
+  padding: 0px;
+  border-style: none;
+  border-width: 0px;
+  margin: 0px;
+}
+
+
+a.vertmenu {
+  padding-left: 1em;
+  padding-right: 1em;
+}
+
+a.vertmenu:hover {
+  color: #FFFFFF;
+}
+
+/*--------*/
+/* Header */
+/*--------*/
+table.header {
+  padding: 0px;
+  border-style: none;
+  border-width: 0px;
+  margin: 0px;
+  background-color: #484848;
+  color: #ffffff;
+}
+
+table.headerbottom {
+  background-color: #98A898;
+  padding-left: 1em;
+  padding-right: 1em;
+}
+
+h2.logo {
+  font-size: 150%;
+  margin-top: 0.4em;
+  margin-bottom: 0.2em;
+  color: #ffffff;
+}
+
+.headerright {
+  text-align: right;
+}
+
+
+/*------------*/
+/* Sub-header */
+/*------------*/
+h2.subheader {
+  font-size: 150%;
+  margin-bottom: 0.2em;
+  text-align: center;
+}
+
+h3.title {
+  font-size: 125%;
+  margin-top: 2em;
+  margin-bottom: 0.1em;
+}
+
+h4.title {
+  font-size: 100%;
+  margin-top: 0.7em;
+  margin-bottom: 0.1em;
+}
+
+.code {
+  font-family: monospace;
+}
+
+
+.sevlegend {
+  text-align: right;
+  padding: 0px;
+  border: 0px;
+  margin: 0px;
+  float: right;
+}
+
+.sev0 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #ffffff;
+}
+
+.sev1 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #dfffdf;
+}
+
+.sev2 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #a0ffa0;
+}
+
+.sev3 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #ffff00;
+}
+
+.sev4 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #ff8f00;
+}
+
+.sev5 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #ffa0a0;
+}
+
+.sev6 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #ff0000;
+}
+
+.sev7 {
+  text-align: center;
+  padding-left: 1em;
+  padding-right: 1em;
+  background-color: #ff00ff;
+}
+
+
+
+.resultsheader {
+  background-color: #484848;
+  color: #ffffff;
+  text-align: left;
+  font-weight: bold;
+}
+
+.lighter {
+  background-color: #E0E0E0;
+  font-family: Verdana, Arial, Helvetica, Swiss, Futura, sans-serif;
+}
+
+.darker {
+  background-color: #C0C0C0;
+  font-family: Verdana, Arial, Helvetica, Swiss, Futura, sans-serif;
+}
+
+
+
+table.searchform {
+  width: 100%;
+  border-style: none;
+  border-width: 0px;
+  text-align: center;
+  padding: 0px;
+  margin: 0px;
+}
+
+table.formentry {
+  width: auto;
+  align: center;
+}
+
+
+table.msgentry {
+	width: auto;
+	margin-left: auto;
+	margin-right: auto;
+}
+
+table.query {
+  border-style: none;
+  border-width: 0px;
+  padding: 0px;
+  margin: 0px;
+  background-color: #040480;
+  color: #ffffff;
+}
+
+.longtext {
+  font-size: 13px;
+}
+
+ .textCenter {
+	 border: 0px solid white;
+	 color: white;
+	 position: relative;
+	 width: 100%;
+	 text-align: center;
+	 font-weight: bold;
+ }
+ .bg {
+	 border: 0px solid white;
+	 color: white;
+	 background: #3A6EA5;
+	 position: relative;
+	 width: 100%;
+	 text-align: left;
+	 font-weight: bold;
+ }
+ .comic10 {
+	 font-family:'Comic Sans MS'; 
+	 font-size:10px;
+ } 
+ .olcg {
+	 background-color:#4466ff; 
+	 text-align:center;
+ }
+ td.tooltip 
+ {	
+	 background-color: #FFFFCE
+	 border:#000000
+	 font-family: Arial, Helvetica, sans-serif
+	 font-size: 11px
+	 color: #000000
+ }
+
+ .tagline {
+	 border: 0px solid white;
+	 background-color: #ECECEC;
+	 color: blue;
+	 position: relative;
+	 width: 25%;
+	 text-align: center;
+ }
+ input.datePickerDate {
+	 color: green;
+	 font-weight: bold;
+ }
+ select.datePickerMonth {
+	 font-size: 10px;
+	 height: 18px;
+	 background-color:silver;
+ }
+ input.datePickerYear {
+	 font-size: 10px;
+	 height: 18px;
+	 width: 35px;
+	 background-color:silver;
+ }
+ .datePickerTable {
+ }
+ .datePickerDayHeader {
+	 font-size: 10px;
+	 font-family: arial;
+ }
+ .datePickerDay {
+	 font-size: 9px;
+	 font-family: arial;
+ }
+
+/*--------*/
+/* Footer */
+/*--------*/
+.rightfooter {
+  text-align: right;
+}
diff -Nur -Nur php-syslog-ng-2.9.f/html/css/win2k.css php-syslog-ng/html/css/win2k.css
--- php-syslog-ng-2.9.f/html/css/win2k.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/css/win2k.css	2006-03-20 12:49:22.000000000 -0500
@@ -0,0 +1,41 @@
+/*
+* !!!!!!!!!!!!!!!!!!!!!!!!!!
+* deprecated, not used anymore! check win2k_ie.css
+* !!!!!!!!!!!!!!!!!!!!!!!!!!
+*/
+
+.bsBtnDefault {
+  display:inline; 
+  /*float:left;*/
+  width:24; 
+  height:22; 
+  background-color:menu; 
+  padding-left:4px;
+  padding-top:3px;
+}
+.bsBtnMouseOver {
+  display:inline; 
+  /*float:left;*/
+  width:24; 
+  height:22; 
+  background-color:menu; 
+  padding-left:3px;
+  padding-top:2px;
+  border-left:1px solid white;
+  border-top:1px solid white;
+  border-right:1px solid #808080;
+  border-bottom:1px solid #808080;
+}
+.bsBtnMouseDown {
+  display:inline; 
+  /*float:left;*/
+  width:24; 
+  height:22; 
+  background-color:menu; 
+  padding-left:4px;
+  padding-top:3px;
+  border-left:1px solid #808080;
+  border-top:1px solid #808080;
+  border-right:1px solid white;
+  border-bottom:1px solid white;
+}
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/css/win2k_ie.css php-syslog-ng/html/css/win2k_ie.css
--- php-syslog-ng-2.9.f/html/css/win2k_ie.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/css/win2k_ie.css	2006-03-20 12:49:22.000000000 -0500
@@ -0,0 +1,69 @@
+.bsBtnDefault {
+  display:inline; 
+  /*float:left;*/
+  width:24px; 
+  height:22px; 
+  background-color:Menu; 
+  padding-left:4px;
+  padding-top:3px;
+	font-family: arial, helvetica;
+	font-size: 12px;
+	cursor: default;
+	display:inline;
+}
+.bsBtnMouseOver {
+  display:inline; 
+  /*float:left;*/
+  width:24px; 
+  height:22px; 
+  background-color:Menu; 
+  padding-left:3px;
+  padding-top:2px;
+  border-left:1px solid white;
+  border-top:1px solid white;
+  border-right:1px solid #808080;
+  border-bottom:1px solid #808080;
+	font-family: arial, helvetica;
+	font-size: 12px;
+	cursor: default;
+	display:inline;
+}
+.bsBtnMouseDown {
+  display:inline; 
+  /*float:left;*/
+  width:24px; 
+  height:22px; 
+  background-color:Menu; 
+  padding-left:4px;
+  padding-top:3px;
+  border-left:1px solid #808080;
+  border-top:1px solid #808080;
+  border-right:1px solid white;
+  border-bottom:1px solid white;
+	font-family: arial, helvetica;
+	font-size: 12px;
+	cursor: default;
+	display:inline;
+}
+/**
+* vertical separator for a horizontal bar
+*/
+.separatorForHorizontal {
+	background-color: white;
+	height: 22px; 
+  border-left: 1px inset;
+	width: 2px;
+}
+/**
+* horizontal separator for a vertical bar
+* todo: crap, too much room at the bottom, dunno why.
+*/
+.separatorForVertical {
+	margin-top:5px;
+	margin-bottom:0px;
+	padding-bottom:0px;
+	background-color: menu;
+	height: 0px; 
+  border-top: 1px inset;
+	width: 22px;
+}
diff -Nur -Nur php-syslog-ng-2.9.f/html/css/win2k_mz.css php-syslog-ng/html/css/win2k_mz.css
--- php-syslog-ng-2.9.f/html/css/win2k_mz.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/css/win2k_mz.css	2006-03-20 12:49:22.000000000 -0500
@@ -0,0 +1,79 @@
+
+SPAN.bsBtnDefault IMG {vertical-align: bottom; padding: 3px }
+SPAN.bsBtnMouseDown IMG {vertical-align: bottom; padding: 4px 2px 2px 4px }
+DIV.bsBtnDefault IMG {vertical-align: bottom; padding: 3px }
+DIV.bsBtnMouseDown IMG {vertical-align: bottom; padding: 4px 2px 2px 4px }
+
+SPAN.bsBtnDefault {
+/*  line-height: 24px;*/
+  background-color:Menu;
+  margin: 0px;
+  padding-left:0px;
+  padding-top:3px;
+  padding-bottom: 2px;
+  border: 1px solid Menu;
+	font-family: arial, helvetica;
+	font-size: 12px;
+	cursor: default;
+}
+DIV.bsBtnDefault {
+/*  line-height: 24px;*/
+  background-color:Menu;
+  margin: 0px;
+  padding-left:0px;
+  padding-top:3px;
+  padding-bottom: 2px;
+  border: 1px solid Menu;
+	font-family: arial, helvetica;
+	font-size: 12px;
+	cursor: default;
+	display:inline;
+}
+SPAN.bsBtnDefault:hover {
+  border-style: outset;
+}
+DIV.bsBtnDefault:hover {
+  border-style: outset;
+}
+SPAN.bsBtnMouseDown {
+/*  line-height: 24px;*/
+  background-color:Menu;
+  margin: 0px;
+  padding-left:0px;
+  padding-top:3px;
+  padding-bottom: 2px;
+  border: 1px inset Menu;
+	font-family: arial, helvetica;
+	font-size: 12px;
+}
+DIV.bsBtnMouseDown {
+/*  line-height: 24px;*/
+  background-color:Menu;
+  margin: 0px;
+  padding-left:0px;
+  padding-top:3px;
+  padding-bottom: 2px;
+  border: 1px inset Menu;
+	font-family: arial, helvetica;
+	font-size: 12px;
+	display:inline;
+}
+/**
+* vertical separator for a horizontal bar
+*/
+.separatorForHorizontal {
+  line-height: 24px;
+  padding-top: 1px;
+  padding-bottom: 1px;
+  border: 1px inset Menu;
+}
+/**
+* horizontal separator for a vertical bar
+* todo: crap, too much room at the bottom, dunno why.
+*/
+.separatorForVertical {
+  line-height: 1px;
+  line-width: 22px;
+  padding-bottom: 0px;
+  border: 1px inset Menu;
+}
diff -Nur -Nur php-syslog-ng-2.9.f/html/.htaccess php-syslog-ng/html/.htaccess
--- php-syslog-ng-2.9.f/html/.htaccess	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/.htaccess	2008-02-28 16:18:20.000000000 -0500
@@ -0,0 +1,2 @@
+php_flag register_globals off
+php_flag magic_quotes_runtime off
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/about.php php-syslog-ng/html/includes/about.php
--- php-syslog-ng-2.9.f/html/includes/about.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/about.php	2007-09-10 23:10:44.000000000 -0400
@@ -0,0 +1,75 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+$basePath = dirname( __FILE__ );
+require_once ($basePath . "/../includes/html_header.php");
+require_once ($basePath . "/../includes/version.php");
+?>
+<body>
+<table class="header">
+<tr><td>
+	<a href="index.php"><h2 class="logo"><?php echo $version?></h2></a>
+</td><td class="headerright">
+</td></tr></table>
+<table class="headerbottom"><tr><td>
+</table>
+<table class="pagecontent">
+<tr><td><span class="longtext">
+<h3 class="title">Overview</h3>
+Php-Syslog-ng is a front-end for viewing syslog-ng messages logged to MySQL in real-time. It lets you quickly and easily manage logs from many hosts. It features customized searches based on host, facility, priority, datetime and the content of the log messages. It also has a tail mode and allows for customized filters that enable you to monitor your systmes in near real-time. The latest version of Php-Syslog-ng requires MySQL 5.0 or later for full functionality. Older versions of MySQL are still supported but the functionality will be somewhat limited. Any recent version of syslog-ng, Apache and PHP should work.
+
+<h3 class="title">License</h3>
+Php-Syslog-ng is licensed under the terms of the <a href="http://www.gnu.org/copyleft/gpl.html">GNU Public License (GPL)</a> Version 2 as published by the Free Software Foundation. This gives you legal permission to copy, distribute and/or modify Php-Syslog-ng under certain conditions. Read the 'LICENSE' file in the Php-Syslog-ng distribution or read the online version of the license for more details.<br />
+Php-Syslog-ng is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE WARRANTY OF DESIGN, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE.
+
+<h3 class="title">History</h3>
+<?php
+// Get a file into an array.  In this example we'll go through HTTP to get
+// the HTML source of a URL.
+$lines = file($basePath . "/../CHANGELOG");
+
+// Loop through our array, show HTML source as HTML source; and line numbers too.
+foreach ($lines as $line) {
+	    echo htmlspecialchars($line) . "<br />\n";
+}
+?>
+<hr>
+<b>All Changes below are PC (Pre-Clayton :-))<br></b></b>
+<hr>
+2002-07-31 - Michael Earls releases version 0.1 of Php-Syslog-ng. 
+More information can be found at http://www.vermeer.org/projects/Php-Syslog-ng and http://sourceforge.net/projects/Php-Syslog-ng/ <i>But please be aware that these version are old and no longer maintained.</i>
+
+<p>
+Michael Earls steadily improved on Php-Syslog-ng until his last release (2.5.1) in the summer of 2004.
+
+<p>
+After that I think the main contributor was Jason Taylor (<a href="http://deathstar.com/PhpSyslogNG">http://deathstar.com/PhpSyslogNG</a>). The development since Michael Earls' last release can be followed on the mailing list on sourceforge (<a href="http://sourceforge.net/mailarchive/forum.php?forum=Php-Syslog-ng-support">http://sourceforge.net/mailarchive/forum.php?forum=Php-Syslog-ng-support</a>). (Note: The Sourceforge list is in the process of being deprecated in favor of <a href="http://code.google.com/p/php-syslog-ng">Google's Code Repository</a>
+
+<p>
+Php-Syslog-ng May 2005 (2.5.3)<br />
+I had been looking at this project and others like it for a while and I needed to implement something like this at work. That gave me the excuse to finally take a good look at the code for Php-Syslog-ng to see if it matched my requirements. I downloaded Jason Taylor's 20050422 release and started to dig in. It quickly became apparent that the code could use some clean-up work before I would start to add any new features. The clean-up was a little more work than I had first hoped but after a couple of days I had some code that I thought was work-able. I then started adding/fixing some of the things I immediately wanted done. The most significant change is that MySQL 4.0 is now required if you want full functionality (earlier versions are still supported with limited functionality). I don't know how well my approach to calculating the total number of results works in a very busy environment but I believe that it will be OK. This is something I will keep an eye on as I implement this system where I work.<br> (note from cdukes: I don't know who wrote this?)
+
+<p>
+Php-Syslog-ng May 2005 (2.5.4)<br />
+User authentication, support for multiple tables with log data and improved log rotation capabilities ... those are the main changes in this version. I also fixed a couple of bugs, added input validation for must user supplied values and further cleaned up and commented the code.<br />
+Enjoy! (note from cdukes: I don't know who wrote this?)
+
+<p>
+Php-Syslog-ng June 2005 (2.6)<br />
+Three new features/changes:<br />
+1) Most of the work has been done towards supporting other databases. The base functionality can be ported to any database by just editing a few database related functions in common_funcs.php.<br />
+2) A cache function has been implemented to remove/minimize the delay when loading the search page.<br />
+3) Basic access controls have been implemented. They currently only affect the configure page but I plan on expanding it to also allow for restrictions on what searches a user can make (what hosts, timeframe etc).<br />
+In addition to the new stuff I also fixed a few minor bugs. (note from cdukes: I don't know who wrote this?)
+
+<p>
+Php-Syslog-ng June 2005 (2.7)<br />
+This release only has bug fixes. See the changelog for the list of changes.<br />
+If you are using the merge table then you need to use MySQL 4.0.18 or later. (note from cdukes: I don't know who wrote this?)
+
+<p>
+Php-Syslog-ng July 2005 (2.8)<br />
+A quick bug fix to remedy a problem in logrotate.php. (note from cdukes: I don't know who wrote this?)
+
+<p>
+This latest version of Php-Syslog-ng is available at <a href="http://code.google.com/p/php-syslog-ng">http://code.google.com/p/php-syslog-ng</a>.
+</span></td></tr></table>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/blocks/graph-logs_per_day.php php-syslog-ng/html/includes/blocks/graph-logs_per_day.php
--- php-syslog-ng-2.9.f/html/includes/blocks/graph-logs_per_day.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/blocks/graph-logs_per_day.php	2008-08-07 17:11:17.000000000 -0400
@@ -0,0 +1,189 @@
+<?php
+/*
+ * blocks/graph-logs_per_day.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2008 gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2008-05-13 - created
+ * 2008-07-15 - Modified for use w/ SqueezeDB
+ * 2008-08-01 - Added checks to see if all_logs exists so that new installs wouldn't puke
+ * 2008-08-06 - Modified for use w/ caching
+ *
+ */
+
+/* $Platon$ */
+
+$today = date("Y-m-d");
+$today_doy = date("D",mktime());
+
+// check to see if this is a new install (MERGELOGTABLE doesn't exists)
+$check = mysql_query ("SELECT * FROM ".MERGELOGTABLE." LIMIT 0,1"); /* >>limit<< is just to make it faster in case the db is huge */
+
+// how many days back to graph (i.e. 6 = 1 week (don't forget, counting starts at zero))
+// Less than 4 looks pretty bad (can't fit the data in the box)
+if ($check) {
+   	$days_back = 6; 
+} else {
+   	$days_back = 0; 
+}
+$day_names = array();
+if ($days_back > 0) {
+   	for ($i=0;$i<=$days_back;$i++){
+	   	$day = date( "D", strtotime ("-$i day" ) ) ;
+	   	array_push($day_names, $day);
+   	}
+} else {
+   	$day = date( "D", strtotime ("$i day" ) ) ;
+   	array_push($day_names, $day);
+}
+// die(print_r($day_names));
+
+$day_names = array_reverse($day_names);
+$data = array();
+// First grab today's count (skip if using the cache table)
+if(!defined('LPD_CACHE') || LPD_CACHE == FALSE) {
+   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+	   	$sql = "SELECT SUM(counter) as count from ".DEFAULTLOGTABLE." WHERE datetime BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 1 DAY)";
+   	} else {
+	   	$sql = "SELECT count(*) as count from ".DEFAULTLOGTABLE." WHERE datetime BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 1 DAY)";
+   	}
+   	$queryresult = perform_query($sql, $dbLink);
+   	while ($line = fetch_array($queryresult)) {
+	   	array_push($data, $line['count']);
+   	}
+}
+
+// Now get today + past $days_back count from  one of our storage tables (depending on our method of storage)
+	   	for ($i=0;$i<=$days_back;$i++){
+		   	if(defined('LPD_CACHE') && LPD_CACHE == TRUE) {
+			   	$sql = "SELECT value as count from ".CACHETABLENAME." WHERE type='LPD' AND updatetime=DATE_SUB(CURDATE(), INTERVAL $i DAY)";
+		   	} else {
+			   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+				   	$sql = "SELECT SUM(counter) as count from ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE(), INTERVAL 1 DAY), INTERVAL $i DAY)";
+			   	} else {
+				   	$sql = "SELECT count(*) as count from ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE(), INTERVAL 1 DAY), INTERVAL $i DAY)";
+			   	}
+		   	}
+		   	$queryresult = perform_query($sql, $dbLink);
+		   	$line = fetch_array($queryresult);
+		   	array_push($data, $line['count']);
+		   	// echo "$sql<br>\n";
+		   // 	echo "LOOP $i = " . $line['count'] ."<br>";
+	   	}
+$data = array_reverse($data);
+$max = 1;
+for ($i=0;$i<=$days_back;$i++){
+   	if ($data[$i] > $max)$max=$data[$i];  // find the largest data
+}
+// Set variables used based on $days_back so it scales accordingly
+if (($days_back < 7) && ($days_back > 0)) {
+	if ($max > 100000) {
+   	$multiplier = 1.8; // how much to grow the width
+   	$pad = 30; // Padding between each bar or value
+	} else {
+   	$multiplier = 2.4; // how much to grow the width
+   	$pad = 20; // Padding between each bar or value
+	}
+   	$width = round(($days_back + 1) * $multiplier * ceil($pad - $multiplier));
+} else {
+   	if ($days_back > 6) {
+	   	$multiplier = 2.25; // how much to grow the width
+	   	$pad = 15; // Padding between each bar or value, less padding here since the width is more
+	   	$width = round(($days_back + 1) * $multiplier * floor($pad + $multiplier));
+   	} else {
+	   	$multiplier = 12; // how much to grow the width
+	   	$pad = 15; // Padding between each bar or value, less padding here since the width is more
+	   	$width = round(($days_back + 1) * $multiplier * floor($pad + $multiplier));
+   	}
+
+}
+#die("Width = $width");
+$im = imagecreate($width,255); // width , height px
+#320
+// set the graph color variables 
+// $im        = imagecreate($width,$height); 
+$gray      = imagecolorallocate ($im,0xcc,0xcc,0xcc); 
+$gray_lite = imagecolorallocate ($im,0xee,0xee,0xee); 
+$gray_dark = imagecolorallocate ($im,0x7f,0x7f,0x7f); 
+$white     = imagecolorallocate ($im,0xff,0xff,0xff);
+
+$white = imagecolorallocate($im,255,255,255); // allocate some color from RGB components 
+$black = imagecolorallocate($im,0,0,0);   //
+$red = imagecolorallocate($im,255,0,0);   //
+$green = imagecolorallocate($im,0,255,0); //
+$blue = imagecolorallocate($im,0,0,255);  //
+//
+//draw X, Y Co-Ordinate
+
+// Below is: 
+// Starting at top left
+// X is left to right
+// Y is top to bottom
+$Xstart = 10;
+$Ystart = 5;
+$Xend   = 10;
+$Yend   = 230;
+// Left blue line (draw a line from top left to bottom left):
+imageline($im, $Xstart, $Ystart, $Xend, $Yend, $black );
+$Xstart = 10;
+$Ystart = 230; 
+$Xend   = ($width - 20);
+$Yend   = 230;
+// Bottom blue line (draw a line from bottom left to bottom right):
+imageline($im, $Xstart, $Ystart, $Xend, $Yend, $blue );
+
+// create background box
+imagerectangle($im,0, 0, $Xend+18, $Yend+24, $gray_dark);
+
+//Print X, Y
+imagestring($im,3,15,5,"Logs Per Day",$black);
+
+// imagestring($im,5,100,50,"Test Graph",$red);
+// imagestring($im,5,125,75,"cdukes",$green);
+
+// what next draw the bars
+$x = 15;    // bar x1 position
+$y = 229;    // bar $y1 position
+$x_width = 19;  // width of bars
+$y_ht = 0; // height of bars, will be calculated later
+// Draw the Days of the week:
+for ($i=0;$i<$days_back+1;$i++){
+   	$y_ht = round(($data[$i]/$max)* 100);    // no validation so check if $max = 0 later;
+   	// trying to fill the boxes in...clearly, I suck at this...someone make this prettier :-)
+   	imagerectangle($im,$x-1,$y-1,($x+$x_width),($y-$y_ht-1),$black); // draw the outline
+   	imagefill($im,$x+1,($y-$y_ht+1),$blue); // fill it
+   	imagerectangle($im,($x+$x_width)-1,$y-1,($x+$x_width) + 2,($y-$y_ht) +1,$gray_lite); // 3d-ish bar
+   	imagefill($im,($x+$x_width)+3,($y-$y_ht),$white); // fill it
+   	/*
+	   echo "X=$x, ";
+	   echo "Y=$y, ";
+	   echo "X2=".($x+$x_width) .", ";
+	   echo "Y2=".round($y-$y_ht)."\n<br>";
+	 */
+   	imagestring( $im,2,$x-1,$y+1,$day_names[$i],$black);
+   	imagestring( $im,2,$x-1,$y+10,humanReadable($data[$i]),$black);
+   	$x += ($x_width+$pad);   // $pad is diff between two bars;
+}
+// use values from above to draw the word "Day" at the end
+// subtract $pad+5 from the padding above for the diff between two bars
+$x=round(((($x - $pad) + 5) / $width) * $width);
+imagestring($im,3,$x,$y,"Day",$black);
+
+imagejpeg( $im, "graph.jpeg", 90);
+imagedestroy($im);
+echo "<img src='graph.jpeg'><p></p>";
+
+	function humanReadable($val,$thousands=0){
+	   	if($val>=1000)
+		   	$val=humanReadable($val/1000,++$thousands);
+	   	else{
+		   	$unit=array('','K','M','T','P','E','Z','Y');
+		   	$val=round($val,2).$unit[$thousands];
+	   	}
+	   	return $val;
+   	}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/cal/Bs_Button.class.js php-syslog-ng/html/includes/cal/Bs_Button.class.js
--- php-syslog-ng-2.9.f/html/includes/cal/Bs_Button.class.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/cal/Bs_Button.class.js	2006-07-03 14:38:16.000000000 -0400
@@ -0,0 +1,144 @@
+if (!Bs_Objects) {var Bs_Objects = [];};function Bs_Button() {
+this._id;this._objectId;this.id;this.group;this._status = 1;this.inactiveStyle = 3;this._imgPathDefault = '/_bsImages/buttons/';this.imgPath;this.imgName;this.height;this.width;this.backgroundColor;this.title;this.caption;this.action;this.cssClassDefault   = 'bsBtnDefault';this.cssClassMouseOver = 'bsBtnMouseOver';this.cssClassMouseDown = 'bsBtnMouseDown';this._buttonBar;this.actualizeFromChildren = 0;this._childrenButtonBar;this._isDragAction;this._attachedEvents = new Array;this._constructor = function() {
+this._id = Bs_Objects.length;Bs_Objects[this._id] = this;this._objectId = "Bs_Button_"+this._id;}
+this.attachEvent = function(fire, e) {
+if (typeof(e) == 'undefined') e = 'on';if (typeof(this._attachedEvents[e]) == 'undefined') this._attachedEvents[e] = new Array;this._attachedEvents[e][this._attachedEvents[e].length] = fire;}
+this.attachFireOff = function(param) {
+}
+this.render = function() {
+var isGecko        = this._isGecko();var out            = new Array;var containerStyle = new Array;out[out.length] = '<div style="display:inline; white-space:nowrap;">';var tagType = 'div';out[out.length] = '<' + tagType;out[out.length] = ' id="' + this._getId() + '"';if (typeof(this.title) != 'undefined') {
+out[out.length] = ' title="' + this.title + '"';}
+out[out.length] = ' unselectable="on"';captionType = typeof(this.caption);if (captionType != 'undefined') {
+containerStyle[containerStyle.length] = 'width:auto';} else {
+if (typeof(this.width)  != 'undefined') containerStyle[containerStyle.length] = 'width:'  + this.width  + 'px';if (typeof(this.height) != 'undefined') containerStyle[containerStyle.length] = 'height:' + this.height + 'px';}
+if (typeof(this.backgroundColor) != 'undefined') containerStyle[containerStyle.length] = 'background-color:' + this.backgroundColor;switch (this._status) {
+case 0:
+var filter = this._getInactiveStyleFilter();if (typeof(filter) == 'string') {
+containerStyle[containerStyle.length] = 'filter:' + filter;}
+case 1:
+out[out.length] = ' class="' + this.cssClassDefault + '"';break;case 2:
+out[out.length] = ' class="' + this.cssClassMouseDown + '"';break;}
+out[out.length] = ' style="' + containerStyle.join(';') + '"';out[out.length] = ' onMouseOver="Bs_Objects['+this._id+'].mouseOver(this);"';out[out.length] = ' onMouseOut="Bs_Objects['+this._id+'].mouseOut(this);"';out[out.length] = ' onMouseDown="Bs_Objects['+this._id+'].mouseDown(this);"';out[out.length] = ' onMouseUp="Bs_Objects['+this._id+'].mouseUp(this);"';out[out.length] = '>';if (typeof(this.imgName) != 'undefined') {
+var imgFullPath = '';imgFullPath += this._getImgPath();imgFullPath += this.imgName;if (this.imgName.substr(this.imgName.length -4) != '.gif') imgFullPath += '.gif';out[out.length] = '<img id="' + this._getId() + '_icon" src="' + imgFullPath + '"';if ((typeof(this.height) == 'undefined') || (this.height > 18)) out[out.length] = ' style="vertical-align:top;"';out[out.length] = '>';}
+captionType = typeof(this.caption);if (captionType != 'undefined') {
+if (captionType == 'string') {
+out[out.length] = this.caption;} else {
+out[out.length] = this.title;}
+if (!isGecko) out[out.length] = '&nbsp;';}
+if ((typeof(this._childrenButtonBar) != 'undefined') && (this.numberOfAttachedEvents('on') == 0)) {
+this.group =  this._objectId + '_pseudoGroup';var imgFullPath = '';if (this.imgPath) imgFullPath += this._getImgPath();imgFullPath += 'small_black_arrow_down.gif';out[out.length] = '&nbsp;<img src="' + imgFullPath + '" style="vertical-align:middle;">&nbsp;';var subBarString = this._childrenButtonBar.render();subBarString = '<div id="' + this._objectId + '_childBar" class="bsBtnMouseOver" style="width:auto; height:auto; display:none; position:absolute; left:50px; top:50px;">' + subBarString + '</div>';out[out.length] = subBarString;}
+out[out.length] = '</' + tagType + '>';out[out.length] = '</div>';return out.join('');}
+this.drawOut = function() {
+document.writeln(this.render());}
+this.drawInto = function(elm) {
+if (typeof(elm) == 'string') {
+elm = document.getElementById(elm);}
+if (elm != null) {
+var x = this.render();			//x = x.replace(/<nobr>/, '');
+			//x = x.replace(/<\/nobr>/, '');
+			x = x.replace(/<nobr>/, '<span style="white-space: nowrap">');
+			x = x.replace(/<\/nobr>/, '<\/span>');
+elm.innerHTML = x;}
+}
+this.mouseOver = function(div) {
+if (this._status == 2) return;if (this._status == 0) return;if (!this._isGecko()) {
+div.className = this.cssClassMouseOver;}
+this._fireEvent('over');}
+this.mouseOut = function(div) {
+if (this._status == 2) return;if (this._status == 0) return;if (!this._isGecko()) {
+div.className = this.cssClassDefault;}
+this._fireEvent('out');}
+this.mouseDown = function(div) {
+if (this._status == 0) return;this._isDragAction = false;div.className = this.cssClassMouseDown;}
+this.mouseUp = function(div) {
+if (this._status == 0) return;var doFireOn  = true;var doFireOff = false;if (this._isGecko()) {
+div.className = this.cssClassDefault;} else {
+div.className = this.cssClassMouseOver;}
+if (typeof(this.group) != 'undefined') {
+if (this._status == 2) {
+this._status = 1;doFireOn  = false;doFireOff = true;} else {
+div.className = this.cssClassMouseDown;this._status = 2;this._deactivateOtherGroupButtons();}
+}
+if (this._isDragAction) doFireOn = false;if (doFireOn) {
+this._fireEvent('on');} else if (doFireOff) {
+this._fireEvent('off');}
+}
+this.dragStart = function(div) {
+if (this._status == 0) return false;this._isDragAction = true;div.className = this.cssClassMouseOver;return false;}
+this._deactivateOtherGroupButtons = function() {
+if (typeof(this._buttonBar) == 'undefined') return;for (var i=0; i<this._buttonBar._buttons.length; i++) {
+var btnObj = this._buttonBar._buttons[i][0];if (typeof(btnObj) != 'object') continue;if ((btnObj.group == this.group)) {
+if (btnObj._objectId == this._objectId) continue;btnObj._status = 1;btnDiv = document.getElementById(btnObj._getId());btnDiv.className = btnObj.cssClassDefault;}
+}
+}
+this.setStatus = function(status) {
+if (this._status == status) return;var oldStatus = this._status;this._status = status;var btnDiv = document.getElementById(this._getId());if (btnDiv != null) {
+switch (status) {
+case 0:
+var filter = this._getInactiveStyleFilter();if (typeof(filter) == 'string') {
+btnDiv.style.filter = filter;}
+break;case 1:
+btnDiv.className = this.cssClassDefault;break;case 2:
+if (this._isGecko()) {
+btnDiv.className = this.cssClassDefault;} else {
+btnDiv.className = this.cssClassMouseDown;}
+if (typeof(this.group) != 'undefined') {
+this._deactivateOtherGroupButtons();}
+break;}
+}
+if ((oldStatus == 0) && (this.inactiveStyle != 0)) {
+btnDiv.style.filter = "";}
+}
+this.getStatus = function() {
+return this._status;}
+this.setTitle = function(title) {
+var elm = document.getElementById(this._getId());if (elm != null) elm.title = title;this.title = title;}
+this.setChildrenButtonBar = function(bar) {
+bar._parentButton = this;this._childrenButtonBar = bar;}
+this._isGecko = function() {
+if (navigator.appName == "Microsoft Internet Explorer") return false;    var x = navigator.userAgent.match(/gecko/i);
+return (x);return false;}
+this._fireEvent = function(e) {
+if ((e == 'on') && (typeof(this._buttonBar) != 'undefined') && (typeof(this._buttonBar._parentButton) != 'undefined')) {
+this._buttonBar._parentButton._fireEvent('off');if ((this._buttonBar._parentButton.actualizeFromChildren == 1) || (this._buttonBar._parentButton.actualizeFromChildren == 3)) {
+var elm = document.getElementById(this._buttonBar._parentButton._getId() + '_icon');var imgFullPath = '';if (this.imgPath) imgFullPath += this.imgPath;imgFullPath += this.imgName;if (this.imgName.substr(this.imgName.length -4) != '.gif') imgFullPath += '.gif';elm.src = imgFullPath;}
+}
+if (((e == 'on') || (e == 'off')) && (typeof(this._childrenButtonBar) != 'undefined') && (this.numberOfAttachedEvents('on') == 0)) {
+var elm = document.getElementById(this._objectId + '_childBar');if (elm != null) {
+if (e == 'on') {
+this._buttonBar.ignoreEvents = true;var pos = getAbsolutePos(document.getElementById(this._getId()));var plusPixel = (typeof(this.height)  != 'undefined') ? parseInt(this.height) : 22;elm.style.top     = (pos.y + plusPixel) + 'px';elm.style.left    = pos.x + 'px';elm.style.display = 'block';} else {
+this._buttonBar.ignoreEvents = false;elm.style.display = 'none';}
+}
+} else {
+if (!this._attachedEvents[e]) return;for (var i=0; i<this._attachedEvents[e].length; i++) {
+switch (typeof(this._attachedEvents[e][i])) {
+case 'function':
+this._attachedEvents[e][i](this);break;case 'string':
+						//var ev = this._attachedEvents[e][i].replace(/__THIS__/, this);
+eval(this._attachedEvents[e][i]);break;default:
+}
+}
+}
+}
+this.numberOfAttachedEvents = function(e) {
+try {
+return this._attachedEvents[e].length;} catch (ex) {
+return 0;}
+}
+this._getId = function() {
+if (typeof(this.id) != 'undefined') return this.id;return this._objectId + "_container";}
+this._getInactiveStyleFilter = function() {
+switch (this.inactiveStyle) {
+case 0:
+return false;break;case 1:
+return 'progid:DXImageTransform.Microsoft.BasicImage(grayScale=1)';break;case 2:
+return 'progid:DXImageTransform.Microsoft.BasicImage(opacity=.3)';break;default:
+return 'progid:DXImageTransform.Microsoft.BasicImage(grayScale=1) progid:DXImageTransform.Microsoft.BasicImage(opacity=.3)';}
+}
+this._getImgPath = function() {
+if (typeof(this.imgPath) != 'undefined') {
+return this.imgPath;} else if (typeof(this._buttonBar) != 'undefined') {
+return this._buttonBar.imgPath;} else {
+return this._imgPathDefault;}
+}
+this._constructor();}
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/cal/Bs_DatePicker.class.js php-syslog-ng/html/includes/cal/Bs_DatePicker.class.js
--- php-syslog-ng-2.9.f/html/includes/cal/Bs_DatePicker.class.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/cal/Bs_DatePicker.class.js	2006-07-03 14:40:54.000000000 -0400
@@ -0,0 +1,195 @@
+if (!Bs_Objects) {var Bs_Objects = [];};function bs_dp_inputFieldBlur() {
+event.srcElement.bsObj.updateByInputFieldBlur();}
+function bs_dp_inputFieldChange() {
+event.srcElement.bsObj.updateByInputFieldChange();}
+function Bs_DatePicker(fieldName) {
+this._objectId;this.fieldName = fieldName;this.jsBaseDir = '/_bsJavascript/';this.openByInit = false;this.monthLongEn = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');this.monthNumChars = 0;this.daysEn  = new Array('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday');this.daysNumChars = 2;this.useSpinEditForYear	= (typeof(Bs_NumberField) != 'undefined');this.dayHeaderFontColor = '#D4D0C8';this.dayHeaderBgColor   = '#808080';this.dayFontColor       = 'black';this.dayBgColor         = 'white';this.dayFontColorActive = 'white';this.dayBgColorActive   = '#0A246A';this.dayTableBgColor    = 'white';this.dayBgColorOver     = '#FFFFE1';this.dayTableClassName;this.dateInputClassName;this.monthSelectClassName;this.yearInputClassName;this.dayHeaderClassName;this.dayClassName;this.dayTableAttributeString = 'width="100%" border="0" cellspacing="0" cellpadding="3"';this.width = 150;this.validateErrorMsgEn = "Not a valid date: '__VALUE__'. Try again or use the date picker. Valid formats are:\nAmerican mm/dd/yyyy (eg 12/31/2003)\nEuropean dd.mm.yyyy (eg 31.12.2003)\nISO yyyy-mm-dd (eg 2003-12-31)";this.validateErrorMsgDe = "Kein gltiges Datum: '__VALUE__'. Versuchen Sie es erneut oder benutzen Sie den DatePicker. Gltige Formate sind:\nAmerikanisch mm/dd/yyyy (Beispiel 12/31/2003)\nEuropisch dd.mm.yyyy (Beispiel 31.12.2003)\nISO yyyy-mm-dd (Beispiel 2003-12-31)";this.internalDateFormat = 'iso';this.displayDateFormat = 'iso';this.dateFormat = 'iso';this.dayClassNameByWeekday = new Array();this.dayClassNameByDay = new Array();this.dateRangeLower = '1800-01-01';this.dateRangeUpper = '2100-12-31';this._currentDate  = '';this._currentYear  = 0;this._currentMonth = 0;this._currentDay   = 0;this.toggleButton;this._constructor = function() {
+this._id = Bs_Objects.length;Bs_Objects[this._id] = this;this._objectId = "Bs_DatePicker_"+this._id;var btnName = this._objectId + '_tglBtn';this.toggleButton = new Bs_Button(btnName);eval(btnName + ' = this.toggleButton;');this.toggleButton.group           = 'toggleButton';this.toggleButton.imgName         = 'bs_calendar';this.toggleButton.cssClassDefault = 'bsBtnMouseOver';this.toggleButton.attachEvent('Bs_Objects['+this._id+'].toggleSelector();', 'on');this.toggleButton.attachEvent('Bs_Objects['+this._id+'].toggleSelector();', 'off');}
+this.resetDate = function() {
+this._currentYear  = 0;this._currentMonth = 0;this._currentDay   = 0;this.updateCurrentDate();}
+this.setDateByChunks = function(year, month, day) {
+var newDate = this.dateToIsoDate(year + '-' + month + '-' + day);if (newDate == false) return false;this._currentYear  = year;this._currentMonth = month;this._currentDay   = day;this.updateCurrentDate();return true;}
+this.setDateByJunks = function(year, month, day) {
+return this.setDateByChunks(year, month, day);}
+this.setDateByIso = function(isoDate) {
+if ("" == isoDate) {
+this.resetDate();} else {
+var newDate = this.dateToIsoDate(isoDate);if (newDate == false) return false;this._currentYear  = parseInt(newDate.substr(0, 4), 10);this._currentMonth = parseInt(newDate.substr(5, 2), 10);this._currentDay   = parseInt(newDate.substr(8, 2), 10);this.updateCurrentDate();}
+return true;}
+this.seedInternalWithCurrentDate = function() {
+var dateNow = new Date();this._currentYear  = this.fixYear(dateNow.getYear());this._currentMonth = dateNow.getMonth() +1;this._currentDay   = dateNow.getDate();this.updateCurrentDate();}
+this.fixYear = function(year) {
+if (year < 100) {
+year = parseInt('19' + year, 10);} else if ((year >= 100) && (year < 110)) {
+year = parseInt(200 + '' + year.toString().substr(2, 1), 10);}
+return year;}
+this.drawInto = function(tagId) {
+document.getElementById(tagId).innerHTML = this.render();if (this.useSpinEditForYear) this._convertYearToSpinEdit();return true;}
+this.convertField = function(fieldId) {
+var origFld = document.getElementById(fieldId);if (origFld == null) return false;origFld.maxLength = 10;if (bs_isEmpty(origFld['name'])) origFld['name'] = fieldId;this.fieldName = origFld['name'];var htmlCode = this.render(true);origFld.insertAdjacentHTML('afterEnd', htmlCode);if (this.useSpinEditForYear) this._convertYearToSpinEdit();origFld.bsObj = this;origFld.attachEvent('onblur',  bs_dp_inputFieldBlur);origFld.attachEvent('onkeyup', bs_dp_inputFieldChange);return true;}
+this.render = function(noInputField) {
+var ret = new Array();if (!noInputField) {
+ret[ret.length] = '<input';ret[ret.length] = ' type="text"';ret[ret.length] = ' name="'    + this.fieldName + '"';ret[ret.length] = ' id="'      + this.fieldName + '"';ret[ret.length] = ' onBlur="Bs_Objects['+this._id+'].updateByInputFieldBlur();"';ret[ret.length] = ' onKeyUp="Bs_Objects['+this._id+'].updateByInputFieldChange();"';ret[ret.length] = ' size="10"';ret[ret.length] = ' maxlength="10"';ret[ret.length] = ' style="width:' + (this.width -22) + 'px;"';if (typeof(this.dateInputClassName) != 'undefined') {
+ret[ret.length] = ' class="' + this.dateInputClassName + '"';}
+ret[ret.length] = ' title="' + this.getCurrentDateReadable() + '"';ret[ret.length] = ' value="' + this.getCurrentDateFormatted() + '">';}
+this.toggleButton.title = (this.openByInit) ? 'Hide Calendar' : 'Show Calendar';if (this.openByInit) this.toggleButton.setStatus(2);var btnHtml = this.toggleButton.render();ret[ret.length] = btnHtml;ret[ret.length] = '<div id="' + this._objectId + '_div"';ret[ret.length] = ' style="width:' + this.width + 'px; border:1px solid black;';if (!this.openByInit) {
+ret[ret.length] = ' display:none;';}
+ret[ret.length] = '">';ret[ret.length] = this.renderDatePicker();ret[ret.length] = '</div>';return ret.join('');}
+this.renderDatePicker = function() {
+var ret = new Array();if (this._currentDate.length == 0) {
+this.seedInternalWithCurrentDate();}
+ret[ret.length] = '<nobr>';ret[ret.length] = '<select name="' + this.fieldName + '_month"';ret[ret.length] = ' id="' + this._objectId + '_month" size="1"';ret[ret.length] = ' onChange="Bs_Objects['+this._id+'].updateByMonth();"';if (typeof(this.monthSelectClassName) != 'undefined') {
+ret[ret.length] = ' class="' + this.monthSelectClassName + '"';} else {
+ret[ret.length] = ' style="width:94px;"';}
+ret[ret.length] = '>';var i = 1;for (var m=0; m<this.monthLongEn.length; m++) {
+ret[ret.length] = '<option value="' + i + '"';if (this._currentMonth == i) ret[ret.length] = ' selected';ret[ret.length] = '>';if (this.monthNumChars > 0) {
+ret[ret.length] = this.monthLongEn[m].substr(0, this.monthNumChars);} else {
+ret[ret.length] = this.monthLongEn[m];}
+ret[ret.length] = '</option>';i++;}
+ret[ret.length] = '</select>';ret[ret.length] = '<input type="text" name="' + this.fieldName + '_year"';ret[ret.length] = ' id="' + this._objectId + '_year" value="' + this._currentYear + '"';ret[ret.length] = ' size="4" maxlength="4" onKeyUp="Bs_Objects['+this._id+'].updateByYearChange();"';ret[ret.length] = ' onBlur="Bs_Objects['+this._id+'].updateByYearBlur();"';if (typeof(this.yearInputClassName) != 'undefined') {
+ret[ret.length] = ' class="' + this.yearInputClassName + '"';} else {
+ret[ret.length] = ' style="width:42px;"';}
+ret[ret.length] = '>';ret[ret.length] = '</nobr><br>';ret[ret.length] = '<div id="' + this._objectId + '_dayDiv">';ret[ret.length] = this.renderDayTable(this._currentYear, this._currentMonth, this._currentDay);ret[ret.length] = '</div>';return ret.join('');}
+this.renderDayTable = function(currentYear, currentMonth, currentDay) {
+var day            = 1;var lastDayOfMonth = this.getNumberOfDays(currentYear, currentMonth);var ret = new Array();ret[ret.length] = '<table ' + this.dayTableAttributeString;ret[ret.length] = ' bgcolor="' + this.dayTableBgColor + '"';if (typeof(this.dayTableClassName) != 'undefined') {
+ret[ret.length] = ' class="' + this.dayTableClassName + '"';}
+ret[ret.length] = '>';if (currentYear >= 1970) {
+ret[ret.length] = '<tr>';for (var d=0; d<this.daysEn.length; d++) {
+ret[ret.length] = '<td width="14%" bgcolor="' + this.dayHeaderBgColor + '" align="right">';ret[ret.length] = '<span';ret[ret.length] = ' title="' + this.daysEn[d] + '"';if (typeof(this.dayHeaderClassName) != 'undefined') {
+ret[ret.length] = ' class="' + this.dayHeaderClassName + '"';ret[ret.length] = ' style="color:' + this.dayHeaderFontColor + '; cursor:default;">';} else {
+ret[ret.length] = ' style="color:' + this.dayHeaderFontColor + '; cursor:default; font-family:arial; font-size:12px;">';}
+if (this.daysNumChars > 0) {
+ret[ret.length] = this.daysEn[d].substr(0, this.daysNumChars);} else {
+ret[ret.length] = this.daysEn[d];}
+ret[ret.length] = '</span>';ret[ret.length] = '</td>';}
+ret[ret.length] = '</tr>';var dateObjFirst = new Date(currentYear, currentMonth-1, 1, 0, 0, 0);var weekDayFirst = dateObjFirst.getDay();if (weekDayFirst == 0) weekDayFirst = 7;} else {
+var weekDayFirst = 1;}
+for (var i=0; i<6; i++) {
+ret[ret.length] = '<tr>';for (var j=1; j<8; j++) {
+if ((day > lastDayOfMonth) || ((i == 0) && (j < weekDayFirst))) {
+ret[ret.length] = '<td>&nbsp;</td>';} else {
+ret[ret.length] = '<td';ret[ret.length] = ' id="' + this._objectId + '_td' + day + '"';ret[ret.length] = ' align="right"';ret[ret.length] = ' onMouseOver="Bs_Objects['+this._id+'].dayMouseOver(' + day + ');"';ret[ret.length] = ' onMouseOut="Bs_Objects['+this._id+'].dayMouseOut(' + day + ');"';ret[ret.length] = ' onClick="Bs_Objects['+this._id+'].updateByDay(' + day + ');"';if (typeof(this.dayClassName) != 'undefined') {
+ret[ret.length] = ' class="' + this.dayClassName + '"';ret[ret.length] = ' style="cursor:hand; cursor:pointer;';} else {
+ret[ret.length] = ' style="cursor:hand; cursor:pointer; font-family:arial; font-size:11px;';}
+if (day == currentDay) {
+ret[ret.length] = ' color:' + this.dayFontColorActive + '; background-color:' + this.dayBgColorActive + ';';} else {
+ret[ret.length] = ' color:' + this.dayFontColor + '; background-color:' + this.dayBgColor + ';';}
+ret[ret.length] = '">';ret[ret.length] = day;ret[ret.length] = '</td>';day++;}
+}
+ret[ret.length] = '</tr>';if (day >= (lastDayOfMonth +1)) break;}
+ret[ret.length] = '</table>';return ret.join('');}
+this.updateDayTable = function() {
+document.getElementById(this._objectId + '_dayDiv').innerHTML = this.renderDayTable(this._currentYear, this._currentMonth, this._currentDay);}
+this.getCurrentDateReadable = function() {
+if (this._currentDay   == 0) return '';if (this._currentMonth == 0) return '';if (this._currentYear  == 0) return '';var ret = '';var dateObj = new Date(this._currentYear, this._currentMonth -1, this._currentDay);var weekDay = dateObj.getDay();if (weekDay == 0) weekDay = 7;ret += this.daysEn[weekDay -1] + ', '
+ret += this.monthLongEn[this._currentMonth -1] + ' ';ret += this._currentDay;switch (this._currentDay) {
+case 1: case 21: case 31:
+ret += 'st'; break;case 2: case 22:
+ret += 'nd'; break;case 3: case 23:
+ret += 'rd'; break;default:
+ret += 'th';}
+ret += ' ' + this._currentYear;return ret;}
+this.getCurrentDateFormatted = function() {
+if (this._currentDay   == 0) return '';if (this._currentMonth == 0) return '';if (this._currentYear  == 0) return '';switch (this.dateFormat) {
+case 'us':
+var ret = '';if (this._currentMonth < 10) ret += '0';ret += this._currentMonth + '/';if (this._currentDay < 10) ret += '0';ret += this._currentDay + '/';ret += this._currentYear;return ret;break;case 'eu':
+var ret = '';if (this._currentDay < 10) ret += '0';ret += this._currentDay + '.';if (this._currentMonth < 10) ret += '0';ret += this._currentMonth + '.';ret += this._currentYear;return ret;break;default:
+return this._currentDate;}
+}
+this.updateInputField = function() {
+var fld = document.getElementById(this.fieldName);if (fld) {
+fld.value = this.getCurrentDateFormatted();fld.title = this.getCurrentDateReadable();}
+}
+this.updateByInputFieldChange = function() {
+switch (window.event.keyCode) {
+case 16:
+case 35:
+case 36:
+case 37:
+case 38:
+case 39:
+case 40:
+return;}
+var userVal = document.getElementById(this.fieldName).value;if ((userVal.length == 10) && (this.dateToIsoDate(userVal) != false)) {
+this.updateByInputFieldBlur();}
+}
+this.updateByInputFieldBlur = function() {
+var fld = document.getElementById(this.fieldName);var userVal = fld.value;if (userVal == this._currentDate) return;if (userVal.length > 0) {
+newVal = this.dateToIsoDate(userVal);if (newVal == false) {
+fld.value = '';				alert(this.validateErrorMsgEn.replace(/__VALUE__/, userVal));
+return;}
+this._currentDate  = newVal, 10;this._currentYear  = parseInt(newVal.substr(0, 4), 10);this._currentMonth = parseInt(newVal.substr(5, 2), 10);this._currentDay   = parseInt(newVal.substr(8, 2), 10);this.updateInputField();} else {
+this.seedInternalWithCurrentDate();}
+var div = document.getElementById(this._objectId + '_div');div.innerHTML = this.renderDatePicker();if (this.useSpinEditForYear) this._convertYearToSpinEdit();}
+this.dateToIsoDate = function(someDate) {
+if (someDate.length <  6) return false;if (someDate.length > 10) return false;if (someDate.indexOf('/') >= 0) {
+var chunks = someDate.split('/');if (chunks.length != 3) return false;var day   = parseInt(chunks[1], 10);var month = parseInt(chunks[0], 10);var year  = parseInt(chunks[2], 10);} else if (someDate.indexOf('-') >= 0) {
+var chunks = someDate.split('-');if (chunks.length != 3) return false;var day   = parseInt(chunks[2], 10);var month = parseInt(chunks[1], 10);var year  = parseInt(chunks[0], 10);} else if (someDate.indexOf('.') >= 0) {
+var chunks = someDate.split('.');if (chunks.length != 3) return false;var day   = parseInt(chunks[0], 10);var month = parseInt(chunks[1], 10);var year  = parseInt(chunks[2], 10);} else {
+return false;}
+if (year < 100) {
+if (year < 30) {
+year += 2000;} else {
+year += 1900;}
+}
+if (year >= 1970) {
+var tDate = new Date(year, month -1, day);if (day   != tDate.getDate())               return false;if (month != (tDate.getMonth() +1))         return false;if (year  != this.fixYear(tDate.getYear())) return false;} else {
+if ((day   < 1)    || (day   > 31))   return false;if ((month < 1)    || (month > 12))   return false;if ((year  < 1000) || (year  > 3000)) return false;}
+if (day > 28) {
+if (this.getNumberOfDays(year, month) < day) return false;}
+var ret = '';ret += year + '-';if (month < 10) ret += '0';ret += month + '-';if (day < 10) ret += '0';ret += day;return ret;}
+this.updateByDay = function(day) {
+try {
+var oldTd = document.getElementById(this._objectId + '_td' + this._currentDay);oldTd.style.backgroundColor = this.dayBgColor;oldTd.style.color           = this.dayFontColor;} catch (e) {
+}
+var oldTd = document.getElementById(this._objectId + '_td' + day);oldTd.style.backgroundColor = this.dayBgColorActive;oldTd.style.color           = this.dayFontColorActive;this._currentDay = parseInt(day, 10);this.updateCurrentDate();this.updateInputField();}
+this.updateByMonth = function() {
+var tmp = new Bs_FormFieldSelect();var monthSelect = document.getElementById(this._objectId + '_month');tmp.init(monthSelect);this._currentMonth = parseInt(monthSelect.getValue(), 10);this.updateCurrentDate();this.updateInputField();this.updateDayTable();}
+this.updateByYearChange = function() {
+var tmpYear = parseInt(document.getElementById(this._objectId + '_year').value, 10);if ((tmpYear < 2100) && (tmpYear > 1800)) {
+this.updateByYearBlur();}
+}
+this.updateByYearBlur = function() {
+var tmpYear = parseInt(document.getElementById(this._objectId + '_year').value, 10);this._currentYear = tmpYear;this.updateCurrentDate();this.updateInputField();this.updateDayTable();}
+this.updateCurrentDate = function() {
+if ((0 == this._currentYear) &&
+(0 == this._currentMonth) &&
+(0 == this._currentDay) ) {
+this._currentDate = "";} else {
+this._currentDate = this._currentYear + '-';if (this._currentMonth < 10) this._currentDate += '0';this._currentDate += this._currentMonth + '-';if (this._currentDay < 10) this._currentDate += '0';this._currentDate += this._currentDay;}
+}
+this.toggleSelector = function() {
+var div = document.getElementById(this._objectId + '_div');if (div.style.display == 'none') {
+div.style.display = 'block';var inputField = document.getElementById(this.fieldName);if (inputField.offsetLeft > div.offsetLeft) {
+div.style.marginLeft = inputField.offsetLeft + 'px';}
+var newChar  = '-';if (this.useSpinEditForYear) {
+var objName = this._objectId + '_yObj';eval(objName + '.redraw();');}
+this.toggleButton.setTitle('Hide Calendar');} else {
+div.style.display = 'none';var newChar  = '+';this.toggleButton.setTitle('Show Calendar');}
+}
+this.dayMouseOver = function(day) {
+var td = document.getElementById(this._objectId + '_td' + day);if (td.style.backgroundColor.toLowerCase() == this.dayBgColor.toLowerCase()) {
+td.style.backgroundColor = this.dayBgColorOver;}
+}
+this.dayMouseOut = function(day) {
+var td = document.getElementById(this._objectId + '_td' + day);if (td.style.backgroundColor.toLowerCase() == this.dayBgColorOver.toLowerCase()) {
+td.style.backgroundColor = this.dayBgColor;}
+}
+this.isLeapYear = function(year) {
+return (((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0));}
+this.getNumberOfDays = function(year, month) {
+switch (month) {
+case 2:
+if (this.isLeapYear(year)) return 29;return 28;break;case 1:
+case 3:
+case 5:
+case 7:
+case 8:
+case 10:
+case 12:
+return 31;break;default:
+return 30;}
+}
+this._convertYearToSpinEdit = function() {
+var objName = this._objectId + '_yObj';var myNf = new Bs_NumberField(this._objectId + '_year');eval(objName + ' = myNf;');myNf.buttonUp.imgPath   = this.jsBaseDir + 'components/numberfield/img/';myNf.buttonDown.imgPath = this.jsBaseDir + 'components/numberfield/img/';myNf.minValue = 1800;myNf.maxValue = 2300;myNf.attachEvent('onAfterChange', 'Bs_Objects['+this._id+'].updateByYearBlur();');myNf.draw();}
+this._constructor();}
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/cal/Bs_FormFieldSelect.class.js php-syslog-ng/html/includes/cal/Bs_FormFieldSelect.class.js
--- php-syslog-ng-2.9.f/html/includes/cal/Bs_FormFieldSelect.class.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/cal/Bs_FormFieldSelect.class.js	2006-07-03 14:38:45.000000000 -0400
@@ -0,0 +1,102 @@
+function Bs_FormFieldSelect() {
+this.hasValue = function(val) {
+val = val + '';for (var i=0; i<this.length; i++) {
+var t = this.options[i].value + '';if (t == val) return true;}
+return false;}
+this.getValue = function() {
+var selIndex = this.selectedIndex;if ((selIndex != 'undefined') && (selIndex > -1)) {
+if (typeof(this.options[selIndex].value) != 'undefined') return this.options[selIndex].value;if (typeof(this.options[selIndex].text)  != 'undefined') return this.options[selIndex].text;}
+return 'undefined';}
+this.getValueOrText = function(selIndex) {
+if (typeof(selIndex) == 'undefined') selIndex = this.selectedIndex;if ((selIndex != 'undefined') && (selIndex > -1)) {
+if (typeof(this.options[selIndex].value) != 'undefined') {
+if (typeof(this.options[selIndex].outerHTML) == 'string') {
+if (this.options[selIndex].outerHTML.toLowerCase().indexOf('value=') != -1) {
+return this.options[selIndex].value;}
+} else {
+if (this.options[selIndex].value != '') return this.options[selIndex].value;}
+}
+if (typeof(this.options[selIndex].text)  != 'undefined') return this.options[selIndex].text;}
+return false;}
+this.getTextForValue = function(value) {
+for (var i=0; i<this.options.length; i++) {
+if (this.options[i].value == value) {
+return this.options[i].text;}
+}
+return false;}
+this.setTo = function(compare, type) {
+if (typeof(type) == 'undefined') type = 'text';for (var i=0; i<this.length; i++) {
+if (this.options[i][type] == compare) {
+this.selectedIndex = i;return true;}
+}
+return false;}
+this.moveSelectedTo = function(toField, keepSelected) {
+if (typeof(toField) == 'string') toField = document.getElementById(toField);if (bs_isNull(toField)) return false;var unsetArray = new Array();for (var i=0; i<this.length; i++) {
+if (this.options[i].selected) {
+var newOpt = new Option(this.options[i].text, this.options[i].value, false, false);toField.options[toField.length] = newOpt;unsetArray[unsetArray.length] = i;}
+}
+unsetArray.reverse();for (var i=0; i<unsetArray.length; i++) {
+this.options[unsetArray[i]] = null;}
+return true;}
+this.moveAllTo = function(toField) {
+if (typeof(toField) == 'string') toField = document.getElementById(toField);if (bs_isNull(toField)) return false;var unsetArray = new Array();for (var i=0; i<this.length; i++) {
+var newOpt = new Option(this.options[i].text, this.options[i].value, false, false);toField.options[toField.length] = newOpt;unsetArray[unsetArray.length] = i;}
+unsetArray.reverse();for (var i=0; i<unsetArray.length; i++) {
+this.options[unsetArray[i]] = null;}
+return true;}
+this.moveTo = function(toField, optionValue) {
+if (typeof(toField) == 'string') toField = document.getElementById(toField);if (bs_isNull(toField)) return false;var unsetArray = new Array();for (var i=0; i<this.options.length; i++) {
+if (this.options[i].value == optionValue) {
+var newOpt = new Option(this.options[i].text, this.options[i].value, false, false);toField.options[toField.length] = newOpt;unsetArray[unsetArray.length] = i;break;}
+}
+unsetArray.reverse();for (var i=0; i<unsetArray.length; i++) {
+this.options[unsetArray[i]] = null;}
+return true;}
+this.moveHashTo = function(toField, hash) {
+if (typeof(toField) == 'string') toField = document.getElementById(toField);if (bs_isNull(toField)) return false;var unsetArray = new Array();for (var i=0; i<this.length; i++) {
+if (typeof(hash[this.options[i].value]) != 'undefined') {
+var newOpt = new Option(this.options[i].text, this.options[i].value, false, false);toField.options[toField.length] = newOpt;unsetArray[unsetArray.length] = i;}
+}
+unsetArray.reverse();for (var i=0; i<unsetArray.length; i++) {
+this.options[unsetArray[i]] = null;}
+return true;}
+this.getAllKeys = function() {
+var ret = new Array();for (var i=0; i<this.options.length; i++) {
+ret[i] = this.options[i].value;}
+return ret;}
+this.getAllOptions = function() {
+var ret = new Array();for (var i=0; i<this.options.length; i++) {
+var key = this.getValueOrText(i);ret[key] = this.options[i].text;}
+return ret;}
+this.prune = function() {
+this.options.length = 0;}
+this.addElementsByHash = function(dataHash) {
+var i = 0;for (var key in dataHash) {
+var newOpt = new Option(dataHash[key], key, false, false);this.options[this.options.length] = newOpt;i++;}
+return i;}
+this.sortByText = function(desc, natural) {
+var sortArr = new Array;for (var i=0; i<this.length; i++) {
+if (this.options[i].value == 'undefined') this.options[i].value = this.options[i].text;sortArr[i] = this.options[i].text + '__BS_SORT__' + this.options[i].value;}
+sortArr.sort();if (desc) sortArr.reverse();this.prune();var key = '';var txt = '';for (var i=0; i<sortArr.length; i++) {
+var pos = sortArr[i].lastIndexOf('__BS_SORT__');txt = sortArr[i].substr(0, pos);key = sortArr[i].substr(pos + '__BS_SORT__'.length);var newOpt = new Option(txt, key, false, false);this.options[this.options.length] = newOpt;}
+}
+this.sortByKey = function() {
+}
+this.setText = function(value, text) {
+for (var i=0; i<this.length; i++) {
+if (this.options[i].value == value) {
+this.options[i].text = text
+return true;}
+}
+return false;}
+this.removeElement = function(value) {
+for (var i=0; i<this.length; i++) {
+if (this.options[i].value == value) {
+this.options[i] = null;return true;}
+}
+return false;}
+this.init = function(formField) {
+if (formField == null) return;for (var name in this) {
+if (name == 'init') continue;formField[name] = this[name];}
+}
+}
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/cal/Bs_Misc.lib.js php-syslog-ng/html/includes/cal/Bs_Misc.lib.js
--- php-syslog-ng-2.9.f/html/includes/cal/Bs_Misc.lib.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/cal/Bs_Misc.lib.js	2006-07-03 14:38:49.000000000 -0400
@@ -0,0 +1,212 @@
+var ie = document.all != null;var moz = !ie && document.getElementById != null && document.layers == null;function bs_isNull(theVar) {
+if (typeof(theVar) == 'undefined') return true;if (theVar == null) return true;return false;}
+function bs_isObject(theVar) {
+ret = false;if (typeof(theVar) == 'object') {
+ret = !bs_isNull(theVar);}
+return ret;}
+function bs_isEmpty(theVar) {
+if (bs_isNull(theVar)) return true;if (theVar == '') return true;return false;}
+function bs_typeOf(theVar) {
+ret = 'undefined';switch (typeof(theVar)) {
+case 'boolean':  ret = 'boolean';  break;case 'number':   ret = 'number';   break;case 'string':   ret = 'string';   break;case 'function': ret = 'function'; break;case 'object':
+if (bs_isNull(theVar)) {
+ret = 'null';break;}
+if (theVar.concat && theVar.join && theVar.sort && theVar.pop) {
+ret = 'array';break;}
+break;case 'undefined':
+default:
+ret = 'undefined';}
+return ret;}
+function bs_arrayMerge(obj1, obj2) {
+if (!bs_isObject(obj1) || !bs_isObject(obj2)) return false;for (var key in obj2) {obj1[key] = obj2[key];}
+return obj1;}
+function bs_arrayFlip(aArray) {
+var aHash = new Object();type = bs_typeOf(aArray);if (type == 'array') {
+for (var i=0; i<aArray.length; i++) {
+aHash[aArray[i]] = true;}
+} else if (type == 'string') {
+if (aArray != '') {
+aHash[aArray] = true;}
+}
+return aHash;}
+function queryStringToHash(queryString) {
+if (typeof(queryString) == 'undefined') {
+var queryString = window.location.search;}
+var ret = new Array;if (bs_isEmpty(queryString)) return ret;queryString = queryString.substr(1);if (bs_isEmpty(queryString)) return ret;var junks = queryString.split('&');for (var i=0; i<junks.length; i++) {
+var x = junks[i].split('=');if (x.length == 2) {
+ret[x[0]] = x[1];} else {
+ret[x[0]] = '';}
+}
+return ret;}
+function dump(theVar, doReturn, showFunctions, _out, _indent, _numCall) {
+if (!_indent) {
+_indent  = ' ';_bsDumpOverallNumCall = 1;} else {
+_indent  += ' ';_bsDumpOverallNumCall++;}
+if (_bsDumpOverallNumCall < 8) {
+if (_out) {
+var isInternal = true;} else {
+_out = '';_numCall = 1;}
+var goOn = true;if (_numCall > 10) {
+goOn = false;if (!doReturn) {
+goOn = confirm("There have been 10 recursive calls so far. Maybe you have an endless loop. Do you want to continue?");}
+if (!goOn) {
+_out += _indent + "error/warning: nesting levels too deep (>10 times)!\n";} else {
+_numCall = 0;}
+}
+if (goOn) {
+switch (typeof(theVar)) {
+case 'object':
+for (var key in theVar) {
+switch (typeof(theVar[key])) {
+case 'function':
+if (typeof(showFunctions) == 'boolean') {
+if (showFunctions) {
+_out += _indent + 'function "' + key + '" => ' + theVar[key] + "\n";} else {
+_out += _indent + 'function "' + key + "\n";}
+} else {
+if (showFunctions == 2) {
+_out += _indent + 'function "' + key + '" => ' + theVar[key] + "\n";} else if (showFunctions == 1) {
+_out += _indent + 'function "' + key + "\n";} else {
+}
+}
+break;case 'undefined':
+break;case 'object':
+_out += _indent + key;if (theVar[key] instanceof Array) {
+_out += ' (Array) => \n';} else if (theVar[key] instanceof Date) {
+_out += ' (Date) => '+ theVar[key] +'\n';} else{
+_out += ' (Object) => \n';}
+_out = dump(theVar[key], doReturn, showFunctions, _out, _indent + "    ", _numCall+1);break;case 'number':
+if (theVar instanceof Date) alert('date');default:
+_out += _indent + typeof(theVar[key]) + ' "' + key + '" => ' + theVar[key] + "\n";}
+}
+break;default:
+_out += _indent + typeof(theVar) + ' => ' + theVar + "\n";}
+}
+}
+if (isInternal || doReturn) {
+return _out;} else {
+alert(_out);return;}
+}
+function Position(x, y) {
+this.x = x;this.y = y;};function getAbsolutePos(el, stopIfAbsolute) {
+if (bs_isNull(el)) {
+var res = new Position(0, 0);return res;}
+var res = new Position(el.offsetLeft, el.offsetTop);if (el.offsetParent) {
+if ((stopIfAbsolute != true ) || ((el.offsetParent.currentStyle.position != 'absolute') && (el.offsetParent.currentStyle.position != 'relative') && (el.offsetParent.currentStyle.overflow != 'auto') && (el.offsetParent.currentStyle.overflow != 'scroll'))) {
+var tmp = getAbsolutePos(el.offsetParent, stopIfAbsolute);res.x += tmp.x;res.y += tmp.y;}
+}
+return res;};if ("undefined" != typeof(HTMLElement)) {
+if ("undefined" == typeof(HTMLElement.insertAdjacentElement)) {
+HTMLElement.prototype.insertAdjacentElement = function(where, parsedNode)	{
+switch(where){
+case 'beforeBegin':
+this.parentNode.insertBefore(parsedNode,this)
+break;case 'afterBegin':
+this.insertBefore(parsedNode,this.firstChild);break;case 'beforeEnd':
+this.appendChild(parsedNode);break;case 'afterEnd':
+if (this.nextSibling) this.parentNode.insertBefore(parsedNode,this.nextSibling);else this.parentNode.appendChild(parsedNode);break;}
+}
+}
+}
+if (moz) {
+extendEventObject();emulateAttachEvent();emulateEventHandlers(["click", "dblclick", "mouseover", "mouseout",
+"mousedown", "mouseup", "mousemove",
+"keydown", "keypress", "keyup"]);emulateCurrentStyle(["left", "right", "top", "bottom", "width", "height"]);emulateHTMLModel();Event.LEFT = 1;Event.MIDDLE = 2;Event.RIGHT = 3;}
+else {
+Event = {};Event.LEFT = 1;Event.MIDDLE = 4;Event.RIGHT = 2;}
+function extendEventObject() {
+Event.prototype.__defineSetter__("returnValue", function (b) {
+if (!b) this.preventDefault();return b;});Event.prototype.__defineSetter__("cancelBubble", function (b) {
+if (b) this.stopPropagation();return b;});Event.prototype.__defineGetter__("srcElement", function () {
+var node = this.target;while (node.nodeType != 1) node = node.parentNode;return node;});Event.prototype.__defineGetter__("fromElement", function () {
+var node;if (this.type == "mouseover")
+node = this.relatedTarget;else if (this.type == "mouseout")
+node = this.target;if (!node) return;while (node.nodeType != 1) node = node.parentNode;return node;});Event.prototype.__defineGetter__("toElement", function () {
+var node;if (this.type == "mouseout")
+node = this.relatedTarget;else if (this.type == "mouseover")
+node = this.target;if (!node) return;while (node.nodeType != 1) node = node.parentNode;return node;});Event.prototype.__defineGetter__("offsetX", function () {
+return this.layerX;});Event.prototype.__defineGetter__("offsetY", function () {
+return this.layerY;});}
+function emulateAttachEvent() {
+HTMLDocument.prototype.attachEvent =
+HTMLElement.prototype.attachEvent = function (sType, fHandler) {
+		var shortTypeName = sType.replace(/on/, "");
+fHandler._ieEmuEventHandler = function (e) {
+window.event = e;return fHandler();};this.addEventListener(shortTypeName, fHandler._ieEmuEventHandler, false);};HTMLDocument.prototype.detachEvent =
+HTMLElement.prototype.detachEvent = function (sType, fHandler) {
+		var shortTypeName = sType.replace(/on/, "");
+if (typeof fHandler._ieEmuEventHandler == "function")
+this.removeEventListener(shortTypeName, fHandler._ieEmuEventHandler, false);else
+this.removeEventListener(shortTypeName, fHandler, true);};}
+function emulateEventHandlers(eventNames) {
+for (var i = 0; i < eventNames.length; i++) {
+document.addEventListener(eventNames[i], function (e) {
+window.event = e;}, true);}
+}
+function emulateAllModel() {
+var allGetter = function () {
+var a = this.getElementsByTagName("*");var node = this;a.tags = function (sTagName) {
+return node.getElementsByTagName(sTagName);};return a;};HTMLDocument.prototype.__defineGetter__("all", allGetter);HTMLElement.prototype.__defineGetter__("all", allGetter);}
+function extendElementModel() {
+HTMLElement.prototype.__defineGetter__("parentElement", function () {
+if (this.parentNode == this.ownerDocument) return null;return this.parentNode;});HTMLElement.prototype.__defineGetter__("children", function () {
+var tmp = [];var j = 0;var n;for (var i = 0; i < this.childNodes.length; i++) {
+n = this.childNodes[i];if (n.nodeType == 1) {
+tmp[j++] = n;if (n.name) {
+if (!tmp[n.name])
+tmp[n.name] = [];tmp[n.name][tmp[n.name].length] = n;}
+if (n.id)
+tmp[n.id] = n
+}
+}
+return tmp;});HTMLElement.prototype.contains = function (oEl) {
+if (oEl == this) return true;if (oEl == null) return false;return this.contains(oEl.parentNode);};}
+function emulateCurrentStyle(properties) {
+HTMLElement.prototype.__defineGetter__("currentStyle", function () {
+var cs = {};var el = this;for (var i = 0; i < properties.length; i++) {
+cs.__defineGetter__(properties[i], encapsulateObjects(el, properties[i]));}
+return cs;});}
+function encapsulateObjects(el, sProperty) {
+return function () {
+return document.defaultView.getComputedStyle(el, null).getPropertyValue(sProperty);};}
+function emulateHTMLModel() {
+function convertTextToHTML(s) {
+		s = s.replace(/\&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, "<BR>");
+while (/\s\s/.test(s))
+			s = s.replace(/\s\s/, "&nbsp; ");
+		return s.replace(/\s/g, " ");
+}
+HTMLElement.prototype.insertAdjacentHTML = function (sWhere, sHTML) {
+var df;var r = this.ownerDocument.createRange();switch (String(sWhere).toLowerCase()) {
+case "beforebegin":
+r.setStartBefore(this);df = r.createContextualFragment(sHTML);this.parentNode.insertBefore(df, this);break;case "afterbegin":
+r.selectNodeContents(this);r.collapse(true);df = r.createContextualFragment(sHTML);this.insertBefore(df, this.firstChild);break;case "beforeend":
+r.selectNodeContents(this);r.collapse(false);df = r.createContextualFragment(sHTML);this.appendChild(df);break;case "afterend":
+r.setStartAfter(this);df = r.createContextualFragment(sHTML);this.parentNode.insertBefore(df, this.nextSibling);break;}
+};HTMLElement.prototype.__defineSetter__("outerHTML", function (sHTML) {
+var r = this.ownerDocument.createRange();r.setStartBefore(this);var df = r.createContextualFragment(sHTML);this.parentNode.replaceChild(df, this);return sHTML;});HTMLElement.prototype.__defineGetter__("canHaveChildren", function () {
+switch (this.tagName) {
+case "AREA":
+case "BASE":
+case "BASEFONT":
+case "COL":
+case "FRAME":
+case "HR":
+case "IMG":
+case "BR":
+case "INPUT":
+case "ISINDEX":
+case "LINK":
+case "META":
+case "PARAM":
+return false;}
+return true;});HTMLElement.prototype.__defineGetter__("outerHTML", function () {
+var attr, attrs = this.attributes;var str = "<" + this.tagName;for (var i = 0; i < attrs.length; i++) {
+attr = attrs[i];if (attr.specified)
+str += " " + attr.name + '="' + attr.value + '"';}
+if (!this.canHaveChildren)
+return str + ">";return str + ">" + this.innerHTML + "</" + this.tagName + ">";});HTMLElement.prototype.__defineSetter__("innerText", function (sText) {
+this.innerHTML = convertTextToHTML(sText);return sText;});var tmpGet;HTMLElement.prototype.__defineGetter__("innerText", tmpGet = function () {
+var r = this.ownerDocument.createRange();r.selectNodeContents(this);return r.toString();});HTMLElement.prototype.__defineSetter__("outerText", function (sText) {
+this.outerHTML = convertTextToHTML(sText);return sText;});HTMLElement.prototype.__defineGetter__("outerText", tmpGet);HTMLElement.prototype.insertAdjacentText = function (sWhere, sText) {
+this.insertAdjacentHTML(sWhere, convertTextToHTML(sText));};}
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/CEMDB.class.php php-syslog-ng/html/includes/CEMDB.class.php
--- php-syslog-ng-2.9.f/html/includes/CEMDB.class.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/CEMDB.class.php	2008-02-04 21:00:06.000000000 -0500
@@ -0,0 +1,98 @@
+<?php
+//========================================================================
+// Caching Cisco Error Message Database Lookup Class
+// Part of php-syslog-ng
+//
+// Author : Daniel Berlin <mail@daniel-berlin.de>
+// License: GPL v2 (http://www.gnu.org/licenses/gpl.html)
+//========================================================================
+
+class CEMDB {
+	private $dbLink;
+	private $cache = array();
+
+  	function __construct($dbLink) {
+		$this->dbLink = $dbLink;
+  	}
+
+	//------------------------------------------------------------------------
+	// Retrieve information about a logmessage
+	//------------------------------------------------------------------------
+	public function lookup($message) {
+		$name = $this->extractName($message);
+
+		if(empty($name))
+			return false;
+
+		if(($data = $this->cacheFetch($name)) !== false)
+			return $data;
+
+		$result = perform_query(
+			"SELECT message, explanation, action, datetime FROM " . CISCO_ERROR_TABLE .
+			" WHERE name = '{$name}' LIMIT 1",
+			$this->dbLink
+		);
+
+		if(! num_rows($result) > 0)
+			return false;
+
+		$data = array();
+		$row  = fetch_array($result, "ASSOC");
+
+		array_push($data, $name);
+		array_push($data, $row['message']);
+		array_push($data, $row['explanation']);
+		array_push($data, $row['action']);
+		array_push($data, $row['datetime']);
+
+		$this->cacheStore($name, $data);
+
+		return $data;
+	}
+
+	//------------------------------------------------------------------------
+	// Extract the error name from the message string
+	//------------------------------------------------------------------------
+	private function extractName($message) {
+            // Modified below to match search criteria for new CEMDB data
+                // Note that ALL incoming messages must meet this search in order to elicit a DB lookup
+                // Example Message: %SYS-5-CONFIG: meets criteria since it has the two delimiters (% and :)
+		# Old -  preg_match_all("/(%.*):/", $message, $matches);
+                preg_match_all("/(%.*?:).*/", $message, $matches);
+		if(! isset($matches[1][0]))
+			return "";
+
+		// Modified below for http://code.google.com/p/php-syslog-ng/issues/detail?id=43 
+		// $name = $matches[1][0];
+		$name = addcslashes($matches[1][0], '\'');
+
+		// Fix for CCO missing EMD info on the EC-SP
+		if(strstr($name, "EC-SP-5-DONTBNDL"))
+			return "%EC-5-DONTBNDL";
+
+		// Fix for missing name
+		if(strstr($name, "PM_SCP-SP-4-LCP_FW_ABLC"))
+			return "%PM_SCP-4-LCP_FW_ABLC";
+
+		// Fix for missing name
+		if(strstr($name, "STANDBY-3-DIFFVIP1"))
+			return "%HSRP-4-DIFFVIP1";
+
+		return $name;
+	}
+
+	//------------------------------------------------------------------------
+	// Fetch a cached CEMDB entry
+	//------------------------------------------------------------------------
+	private function cacheFetch($name) {
+		return isset($this->cache[$name]) ? $this->cache[$name] : false;
+	}
+
+	//------------------------------------------------------------------------
+	// Store a CEMDB entry in the cache
+	//------------------------------------------------------------------------
+	private function cacheStore($name, $data) {
+		$this->cache[$name] = $data;
+	}
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/common_funcs.php php-syslog-ng/html/includes/common_funcs.php
--- php-syslog-ng-2.9.f/html/includes/common_funcs.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/common_funcs.php	2008-08-12 18:21:52.000000000 -0400
@@ -0,0 +1,813 @@
+<?php
+// Copyright (C) 2001-2004 by Michael Earls, michael@michaelearls.com
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (C) 2006 Clayton Dukes, cdukes@cdukes.com
+
+$basePath = dirname( __FILE__ );
+include_once ($basePath ."/../config/config.php");
+
+error_reporting(E_ALL & ~E_NOTICE);
+//------------------------------------------------------------------------
+// This function returns the current microtime.
+//------------------------------------------------------------------------
+function get_microtime() {
+	list($usec, $sec) = explode(" ", microtime());
+	return ((float)$usec + (float)$sec);
+}
+
+
+//------------------------------------------------------------------------
+// This functions verifies a username/password combination. If the
+// combination exists then the function returns TRUE. If not then it
+// returns FALSE.
+//------------------------------------------------------------------------
+function verify_login($username, $password, $link) {
+	// If the username or password is blank then return FALSE.
+	if(!$username || !$password) {
+		return FALSE;
+	}
+
+	// Get the md5 hash of the password and query the database.
+	$pwHash = md5($password);
+	$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."' AND pwhash='".$pwHash."'";
+	// die($query);
+	$result = perform_query($query, $link);
+
+	// If the query returns one result row then return TRUE.
+	if(num_rows($result) == 1) {
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+//------------------------------------------------------------------------
+// This functions verifies a username only. If the username
+// exists then the function returns TRUE. If not then it
+// returns FALSE. Implemented for Web Basic auth.
+// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+//------------------------------------------------------------------------
+function verify_user($username, $link) {
+       // If the username is blank, then return FALSE.
+       if (!$username) {
+               return FALSE;
+       }
+
+       // Query the database
+       $query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."'";
+       $result = perform_query($query, $link);
+
+       // If the query returns one result row then return TRUE.
+       if(num_rows($result) == 1) {
+               return TRUE;
+       } else {
+               return FALSE;
+       }
+}
+
+
+//------------------------------------------------------------------------
+// This function verifies a username/sessionId combination. If the
+// combination exists then the function returns TRUE. If not then it
+// returns FALSE. If the RENEW_SESSION_ON_EACH_PAGE parameter is set then
+// the functions also updates the timestamp for the session after it is
+// verified.
+//------------------------------------------------------------------------
+function verify_session($username, $sessionId, $link) {
+	// If the username or sessionId is blank then return FALSE.
+	if(!$username || !$sessionId) {
+		return FALSE;
+	}
+
+	// Query the database.
+	$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."' 
+		AND sessionid='".$sessionId."' AND exptime>now()";
+	$result = perform_query($query, $link);
+
+	// If the query returns one result row then the session is verified.
+	if(num_rows($result) == 1) {
+		//If RENEW_SESSION_ON_EACH_PAGE is set then update the
+		// session timestamp in the database.
+		if(defined('RENEW_SESSION_ON_EACH_PAGE') && RENEW_SESSION_ON_EACH_PAGE == TRUE) {
+			$expTime = time()+SESSION_EXP_TIME;
+			$expTimeDB = date('Y-m-d H:i:s', $expTime);
+			$query = "UPDATE ".AUTHTABLENAME." SET exptime='".$expTimeDB."'
+				WHERE username='".$username."'";
+			perform_query($query, $link);
+		}
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+
+//------------------------------------------------------------------------
+// Function used to retrieve input values and if neccessary add slashes.
+//------------------------------------------------------------------------
+function get_input($varName, $check_session=true) {
+   	$value="";
+   	if(isset($_COOKIE[$varName])) {
+	   	$value = $_COOKIE[$varName];
+   	} elseif(isset($_GET[$varName])) {
+	   	$value = $_GET[$varName];
+   	} elseif(isset($_POST[$varName])) {
+	   	$value = $_POST[$varName];
+	/** 
+	 * BPK: we can't always use this, else checkboxes never get unset, 
+	 * rather let js reload the form at the end of search.php
+	 */
+   	} elseif($check_session && isset($_SESSION[$varName])) {
+	   	$value = $_SESSION[$varName];
+   	} 
+	if($value && !get_magic_quotes_gpc()) {
+	   	if(!is_array($value)) {
+		   	$value = addslashes($value);
+	   	}
+	   	else {
+		   	foreach($value as $key => $arrValue) {
+			   	$value[$key] = addslashes($arrValue);
+		   	}
+	   	}
+   	}
+   	return $value;
+}
+
+
+//------------------------------------------------------------------------
+// Function used to validate user supplied variables.
+//------------------------------------------------------------------------
+function validate_input($value, $regExpName) {
+	global $regExpArray;
+
+	if(!$regExpArray[$regExpName]) {
+		return FALSE;
+	}
+
+	if(is_array($value)) {
+		foreach($value as $arrval) {
+			if(!preg_match("$regExpArray[$regExpName]", $arrval)) {
+				return FALSE;
+			}
+		}
+		return TRUE;
+	}
+	elseif(preg_match("$regExpArray[$regExpName]", $value)) {
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+
+//------------------------------------------------------------------------
+// This function reloads the cache with data from $table.
+//------------------------------------------------------------------------
+function reload_cache($table, $link) {
+	$cacheHostValues = array();
+	$cacheFacilityValues = array();
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	// $add = "";
+
+	/* cdukes - 2-28-08: Added a default of "NONE" below so that the array would not be empty which causes the INSERT to fail if no results are returned) */
+	$cacheProgramValues = array("NONE");
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+	// Get new cache values from $table
+
+	$sql = "SELECT DISTINCT host FROM ".$table;
+	$result = perform_query($sql, $link);
+	while($row = fetch_array($result, 'ASSOC')) {
+		array_push($cacheHostValues, $row['host']);
+	} 
+
+	$sql = "SELECT DISTINCT facility FROM ".$table;
+	$result = perform_query($sql, $link);
+	while($row = fetch_array($result, 'ASSOC')) {
+		array_push($cacheFacilityValues, $row['facility']);
+	}
+
+   	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+   	// $sql = "SELECT DISTINCT program FROM ".$table." WHERE LENGTH(program)<80 AND program RLIKE '^[a-zA-Z]+[a-zA-Z0-9/()._\-]+$' limit 50";
+   	// removed DISTINCT and LENGTH keywords in order to speed up searching on large databases
+	// Instead, we'll use php's array_unique function instead of relying on mysql to do it (which is too slow!)
+   	// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=73
+   	$sql = "SELECT program FROM ".$table." WHERE program RLIKE '^[a-zA-Z]+[a-zA-Z0-9/()._\-]+$'";
+   	$result = perform_query($sql, $link);
+   	while($row = fetch_array($result, 'ASSOC')) {
+	   	array_push($cacheProgramValues, $row['program']);
+   	}
+   	$cacheProgramValues=array_unique($cacheProgramValues);
+   	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+	// Prepare INSERT statements
+	$updateTime = date("Y-m-d H:i:s");
+	$insertHost = "INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) VALUES ";
+	foreach($cacheHostValues as $value) {
+		// cdukes: 4/29/08 - Added 'addslashes' below to quote any odd sql inserts
+		// Ref: http://groups.google.com/group/php-syslog-ng-support/browse_thread/thread/eda3c96999889b47
+		// $add = "('".$table."', 'HOST', '".$value."', '".$updateTime."'),";
+		$add = "('".$table."', 'HOST', '".addslashes($value)."', '".$updateTime."'),";
+		$insertHost .= $add;
+	}
+	$insertHost = rtrim($insertHost, ',');
+	if (!$add) {
+		die("<center><em>There appear to be no hosts in the Database yet<br>
+				You can generate fake ones using scripts/dbgen.pl<br>
+				</em></center>
+				");
+	}
+
+	$insertFacility = "INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) VALUES ";
+	foreach($cacheFacilityValues as $value) {
+		$add = "('".$table."', 'FACILITY', '".$value."', '".$updateTime."'),";
+		$insertFacility .= $add;
+	}
+	$insertFacility = rtrim($insertFacility, ',');
+
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	$insertProgram = "INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) VALUES ";
+	foreach($cacheProgramValues as $value) {
+		$add = "('".$table."', 'PROGRAM', '".$value."', '".$updateTime."'),";
+		$insertProgram .= $add;
+	}
+	$insertProgram = rtrim($insertProgram, ',');
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+
+	// Insert new cache values for $table
+	perform_query($insertHost, $link);
+	perform_query($insertFacility, $link);
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	perform_query($insertProgram, $link);
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+	// Drop old cache values for $table
+	$sql = "DELETE FROM ".CACHETABLENAME." WHERE tablename='".$table.
+		"' AND updatetime<'".$updateTime."'";
+	perform_query($sql, $link);
+}
+
+
+//========================================================================
+// BEGIN DATABASE FUNCTIONS
+//========================================================================
+//------------------------------------------------------------------------
+// This function connects to the MySQL server and selects the database
+// specified in the DBNAME parameter. If an error occurs then return
+// FALSE.
+//------------------------------------------------------------------------
+function db_connect_syslog($dbUser, $dbPassword, $connType = 'P') {
+	$server_string = DBHOST.":".DBPORT;
+	$link = "";
+	if(function_exists('mysql_pconnect') && $connType == 'P') {
+		$link = @mysql_pconnect($server_string, $dbUser, $dbPassword);
+	}
+	elseif(function_exists('mysql_connect')) {
+		$link = @mysql_connect($server_string, $dbUser, $dbPassword);
+	}
+	if(!$link) {
+		return FALSE;
+	}
+
+	$result = mysql_select_db(DBNAME, $link);
+	if(!$result) {
+		return FALSE;
+	}
+
+	return $link;
+}
+
+
+//------------------------------------------------------------------------
+// This functions performs the SQL query and returns a result resource. If
+// an error occurs then execution is halted an the MySQL error is
+// displayed.
+//------------------------------------------------------------------------
+function perform_query($query, $link) {
+	if($link) {
+		$result = mysql_query($query, $link); 
+			if (!$result) {
+			print ("Error in \"function perform_query()\" <br>Mysql_error: " .mysql_error() ."<br>Query was: $query<br>"); 
+			return ("Error in \"function perform_query()\" <br>Mysql_error: " .mysql_error()); 
+			}
+	}
+	else {
+		die("Error in perform_query function<br> No DB link for query: $query<br>Mysql_error: " .mysql_error());
+	}
+
+	return $result;
+}
+//------------------------------------------------------------------------
+// This functions performs the SQL query and returns a result resource. If
+// an error occurs then nothing happens. This is ONLY used in logrotate.php
+// to check for row data of non-existent tables. 
+// In other words, we are SUCCESSFUL if there is an error.
+//------------------------------------------------------------------------
+
+function perform_query_quiet($query, $link) {
+	if($link) {
+		$result = @mysql_query($query, $link); 
+	}
+	else {
+		die("Error in perform_query function<br> No DB link for query: $query<br>Mysql_error: " .mysql_error());
+	}
+
+	return $result;
+}
+
+
+//------------------------------------------------------------------------
+// This functions returns a result row as an array.
+// The type can be BOTH, ASSOC or NUM.
+//------------------------------------------------------------------------
+function fetch_array($result, $type = 'BOTH') {
+	if($type == 'BOTH') {
+		return mysql_fetch_array($result);
+	}
+	elseif($type == 'ASSOC') {
+		return mysql_fetch_assoc($result);
+	}
+	elseif($type == 'NUM') {
+		return mysql_fetch_row($result);
+	}
+	else {
+		die('Wrong type for fetch_array()');
+	}
+}
+
+
+//------------------------------------------------------------------------
+// This functions sets the row offset for a result resource
+//------------------------------------------------------------------------
+function result_seek($result, $rowNumber) {
+	mysql_data_seek($result, $rowNumber);
+}
+
+
+//------------------------------------------------------------------------
+// This functions returns a result row as an array
+//------------------------------------------------------------------------
+function num_rows($result) {
+	return mysql_num_rows($result);
+}
+
+
+//------------------------------------------------------------------------
+// This function checks if a particular table exists.
+//------------------------------------------------------------------------
+function table_exists($tableName, $link) {
+	$tables = get_tables($link);
+	if(array_search($tableName, $tables) !== FALSE) {
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+
+//------------------------------------------------------------------------
+// This function returns an array of the names of all tables in the
+// database.
+//------------------------------------------------------------------------
+function get_tables($link) {
+	$tableList = array();
+	$query = "SHOW TABLES";
+	$result = perform_query($query, $link);
+	while($row = fetch_array($result)) {
+		array_push($tableList, $row[0]);
+	}
+
+	return $tableList;
+}
+
+
+//------------------------------------------------------------------------
+// This function returns an array with the names of tables with log data.
+//------------------------------------------------------------------------
+function get_logtables($link) {
+	// Create an array of the column names in the default table
+	$query = "DESCRIBE ".DEFAULTLOGTABLE;
+	$result = perform_query($query, $link);
+	$defaultFieldArray = array();
+	while($row = mysql_fetch_array($result)) {
+		array_push($defaultFieldArray, $row['Field']);
+	}
+
+	// Create an array with the names of all the log tables
+	$logTableArray = array();
+	$allTablesArray = get_tables($link);
+	foreach($allTablesArray as $value) {
+		// Create an array of the column names in the current table
+		$query = "DESCRIBE ".$value;
+		$result = perform_query($query, $link);
+		// Get the names of columns in current table
+		$fieldArray = array();
+		while ($row = mysql_fetch_array($result)) {
+			array_push($fieldArray, $row['Field']);
+		}
+
+		// If the current array is identical to the one from the
+		// DEFAULTLOGTABLE then the name is added to the result
+		// array.
+		$diffArray = array_diff_assoc($defaultFieldArray, $fieldArray);
+		if(!$diffArray) {
+			array_push($logTableArray, $value);
+		}
+	}
+	return $logTableArray;
+}
+//========================================================================
+// END DATABASE FUNCTIONS
+//========================================================================
+
+//========================================================================
+// BEGIN ACCESS CONTROL FUNCTIONS
+//========================================================================
+//------------------------------------------------------------------------
+// This function verifies that the user has access to a particular part
+// of php-syslog-ng.
+// Inputs are:
+// username
+// actionName
+// dbLink
+//
+// Outputs TRUE or FALSE
+//------------------------------------------------------------------------
+function grant_access($userName, $actionName, $link) {
+	// If ACL is not used then always return TRUE
+	if(!defined('USE_ACL') || !USE_ACL || !defined('REQUIRE_AUTH') || !REQUIRE_AUTH) {
+		return TRUE;
+	}
+
+	// Get user access
+	$sql = "SELECT access FROM ".USER_ACCESS_TABLE." WHERE username='".$userName."' 
+			AND actionname='".$actionName."'";
+	$result = perform_query($sql, $link);
+	$row = fetch_array($result);
+	if(num_rows($result) && $row['access'] == 'TRUE') {
+		return TRUE;
+	}
+	// Get default access
+	else {
+		$sql = "SELECT defaultaccess FROM ".ACTION_TABLE." WHERE actionname='".$actionName."'";
+		$result = perform_query($sql, $link);
+		$row = fetch_array($result);
+		if($row['defaultaccess'] == 'TRUE') {
+			return TRUE;
+		}
+		else {
+			return FALSE;
+		}
+	}
+}
+//========================================================================
+// END ACCESS CONTROL FUNCTIONS
+//========================================================================
+
+//========================================================================
+// BEGIN REDIRECT FUNCTION
+//========================================================================
+
+function g_redirect($url,$mode)
+/*  It redirects to a page specified by "$url".
+ *  $mode can be:
+ *    LOCATION:  Redirect via Header "Location".
+ *    REFRESH:  Redirect via Header "Refresh".
+ *    META:      Redirect via HTML META tag
+ *    JS:        Redirect via JavaScript command
+ */
+{
+  if (strncmp('http:',$url,5) && strncmp('https:',$url,6)) {
+
+     $starturl = ($_SERVER["HTTPS"] == 'on' ? 'https' : 'http') . '://'.
+                 (empty($_SERVER['HTTP_HOST'])? $_SERVER['SERVER_NAME'] :
+                 $_SERVER['HTTP_HOST']);
+
+     if ($url[0] != '/') $starturl .= dirname($_SERVER['PHP_SELF']).'/';
+
+     $url = "$starturl$url";
+  }
+
+  switch($mode) {
+
+     case 'LOCATION': 
+
+       if (headers_sent()) exit("Headers already sent. Can not redirect to $url");
+
+       header("Location: $url");
+       exit;
+
+     case 'REFRESH': 
+
+       if (headers_sent()) exit("Headers already sent. Can not redirect to $url");
+
+       header("Refresh: 0; URL=\"$url\""); 
+       exit;
+
+     case 'META': 
+
+       ?><meta http-equiv="refresh" content="0;url=<?php echo $url?>" /><?php
+       exit;
+
+     case 'JS': 
+
+       ?><script type="text/javascript">
+       window.location.href='<?php echo $url?>';
+       </script><?php
+       exit;
+
+     default: /* -- Java Script */
+
+       ?><script type="text/javascript">
+       window.location.href='<?php echo $url?>';
+       </script><?php
+  }
+  exit;
+}
+
+//========================================================================
+// END REDIRECT FUNCTION
+//========================================================================
+
+/*  Adds commas to a string of numbers
+*/
+function commify ($str) { 
+        $n = strlen($str); 
+        if ($n <= 3) { 
+                $return=$str;
+        } 
+        else { 
+                $pre=substr($str,0,$n-3); 
+                $post=substr($str,$n-3,3); 
+                $pre=commify($pre); 
+                $return="$pre,$post"; 
+        }
+        return($return); 
+}
+
+/* Usage:
+
+   $week = get_weekdates($year,$month,$day);
+
+   for($i = 1; $i<=7 ; $i++) {
+
+   echo 'Year: ' . $week[$i]['year'] . '<br>';
+   echo 'Month: ' . $week[$i]['month'] . '<br>';
+   echo 'Day: ' . $week[$i]['day'] . '<br>';
+   echo 'Longname: ' . $week[$i]['dayname'] . '<br>';
+   echo 'Shortname: ' . $week[$i]['shortdayname'] . '<br>';
+   echo 'Sqldate: ' . $week[$i]['sqldate'] . '<br>';
+   echo '<br>';
+
+   }
+ */
+
+function get_weekdates($year, $month, $day){
+	setlocale(LC_ALL, "C");
+	//echo "Year $year<br>";
+	//echo "Month $month<br>";
+	//echo "Day $day<br>";
+
+	// make unix time
+	$searchdate = mktime(0,0,0,$month,$day,$year);
+	//echo "Searchdate: $searchdate<br>";
+
+	// let's get the day of week                //    on solaris <8 the first day of week is sunday, not monday
+	$day_of_week = strftime("%u", $searchdate);  
+	//echo "Debug: $day_of_week <br><br>";
+
+	$days_to_firstday = ($day_of_week - 1);        //    on solaris <8 this may not work
+	//echo "Debug: $days_to_firstday <br>";
+
+	$days_to_lastday = (7 - $day_of_week);        //    on solaris <8 this may not work
+	//echo "Debug: $days_to_lastday <br>";
+
+	$date_firstday = strtotime("-".$days_to_firstday." days", $searchdate);
+	//echo "Debug: $date_firstday <br>";
+
+	$date_lastday = strtotime("+".$days_to_lastday. " days", $searchdate);
+	//echo "Debug: $date_lastday <br>";
+
+	$d_result = "";                    // array to return
+
+	// write an array of all dates of this week 
+	for($i=0; $i<=6; $i++) {
+		$y = $i + 1;
+		$d_date = strtotime("+".$i." days", $date_firstday);
+
+		// feel free to add more values to these hashes
+		$result[$y]['year'] = strftime("%Y", $d_date);
+		$result[$y]['month'] = strftime("%m", $d_date);
+		$result[$y]['day'] = strftime("%d", $d_date);
+		$result[$y]['dayname'] = strftime("%A", $d_date);
+		$result[$y]['shortdayname'] = strftime("%a", $d_date);
+		$result[$y]['sqldate'] = strftime("%Y-%m-%d", $d_date);
+	}
+
+	return $result;                    // return the array
+}
+
+// Use this instead of count(*), it's faster (supposedly)
+function get_total_rows ($table) {
+	$temp = mysql_query("SELECT SQL_CALC_FOUND_ROWS * FROM $table LIMIT 1");
+	$result = mysql_query("SELECT FOUND_ROWS()");
+	$total = mysql_fetch_row($result);
+	return $total[0];
+}
+
+// Added for better cookie handling
+function getDomain() {
+	if ( isset($_SERVER['HTTP_HOST']) ) {
+		// Get domain
+		$dom = $_SERVER['HTTP_HOST'];
+		// Strip www from the domain
+		if (strtolower(substr($dom, 0, 4)) == 'syslog.') { $dom = substr($dom, 4); }
+		// Check if a port is used, and if it is, strip that info
+		$uses_port = strpos($dom, ':');
+		if ($uses_port) { $dom = substr($dom, 0, $uses_port); }
+		// Add period to Domain (to work with or without www and on subdomains)
+		$dom = '.' . $dom;
+	} else {
+		$dom = false;
+	}
+	return $dom;
+}
+
+# cdukes - Added below for 2.9.4
+function secure () {
+   	if (!($_SESSION["member_id"]) || ($_SESSION["member_id"] == "")) {
+	   	// Cdukes: 3/20/08: Carry post variables through login
+	   	// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=35
+	   	// Header("Location:" . LOGIN_URL);
+		$destination = LOGIN_URL;
+		// Remember search query across login
+			if (!empty($_SERVER['QUERY_STRING']))
+			{
+				$destination .= '?' . $_SERVER['QUERY_STRING'];
+				}
+				Header("Location:" . $destination);
+	   	exit();
+	} else {
+		return $_SESSION["member_id"];
+   	}
+}
+function login_check ($forms) {
+   	$error = "";
+   	$username = $forms["username"];
+   	$password = $forms["password"];
+   	if (trim($username) == "") $error .= "<li>Your username is empty.</li>";
+   	if (trim($password) == "") $error .= "<li>Your password is empty.</li>";
+}
+
+function login ($forms) {
+   	$error = "";
+   	$username = $forms["username"];
+   	$password = $forms["password"];
+   	if (!$password) { $password = "NoAnonymous_somebadtokenstring"; }
+		// die("$password");
+
+   	if ($forms["authtype"] == "ldap") {
+	   	//define an appropriate ldap search filter to find your users, and filter out accounts such as administrator(administrator should be renamed anyway!).
+	  	$filter="(&(|(!(displayname=Administrator*))(!(displayname=Admin*)))(" .LDAP_CN. "=$username))";
+	   	$dn = LDAP_CN . "=$username, ";
+	   	if (!($connect = @ldap_connect(LDAP_SRV))) {
+		   	$error .= "Could not connect to LDAP server:" . LDAP_SRV;
+	   	}
+
+		switch (LDAP_MSAD) {
+		
+			case "YES":
+				
+				ldap_set_option($connect, LDAP_OPT_PROTOCOL_VERSION,3);
+	                        ldap_set_option($connect, LDAP_OPT_REFERRALS,0);
+
+				if (!($bind = @ldap_bind($connect, "$username@" . LDAP_DOMAIN, $password))) {
+		                        $error .= " Unable to bind to LDAP Server: <b>" . LDAP_SRV . "</b><br> <li>DN: $dn<br> <li>BaseDN: " . LDAP_BASE_DN . "<br>";
+                		}
+
+				break;
+
+			default:
+		
+				if (!($bind = @ldap_bind($connect, "$dn" . LDAP_BASE_DN, $password))) {
+				   	$error .= " Unable to bind to LDAP Server: <b>" . LDAP_SRV . "</b><br> <li>DN: $dn<br> <li>BaseDN: " . LDAP_BASE_DN . "<br>";
+	   			}
+				
+		}
+
+	   	if (!($sr = @ldap_search($connect, LDAP_BASE_DN, $filter))) { #search for user
+		   	$error .= " Unable to search: <b>" . LDAP_SRV . "</b><br> <li>DN: $dn<br> <li>BaseDN: " . LDAP_BASE_DN . "<br>";
+	   	}
+
+	   	$info = @ldap_get_entries($connect, $sr);
+	   	// print  "Number of entries returned is " .ldap_count_entries($connect, $sr)."<p>";
+
+	   	if (LDAP_USEPRIV == "ON") {
+		   	if (in_array(LDAP_RW_GROUP, $info[0]["groupmembership"])) {
+			   	$_SESSION["userpriv"] = "rw";
+		   	} elseif (in_array(LDAP_RO_GROUP, $info[0]["groupmembership"])) {
+			   	$_SESSION["userpriv"] = "ro";
+		   	} else {
+			   	$_SESSION["userpriv"] = "disabled";
+			   	// echo "User privileges are " . $_SESSION["userpriv"] . "<br>";
+		   	} 
+		}
+
+
+                if ( trim($error) != "" ) {
+                         return $error;
+                } else {
+
+			$fullname=$info[0]["cn"][0];
+        	        $fqdn=$info[0]["dn"];
+
+	   		$_SESSION["username"] = $username;
+		   	$_SESSION["groups"] = $info[0]["groupmembership"];
+		   	$_SESSION["token"] = $password;
+		   	$_SESSION["fullname"] = $fullname;
+		   	$_SESSION["fqdn"] = $fqdn;
+	   		$flname = explode(" ", $fullname);
+		   	$_SESSION["firstname"] = $flname[0];
+		   	$_SESSION["lastname"] = $flname[1];
+	   		$_SESSION["pageId"] = "searchform" ;
+		   	// die(phpinfo());
+		   	// die(print_r($info[0]));
+	   		// die(print_r($_SESSION));
+		}
+
+		/* from here, do your sql query to query the database to search for existing record with correct username and password */
+   	} elseif ($forms["authtype"] == "basic") {
+	   	// Using Web basic authentication. Check to see if $_SERVER['REMOTE_USER'] has access, and act accordingly.
+	  	$username = $_SERVER['REMOTE_USER'];
+	  	if ($username == "") {
+			$username = "that user";
+		}
+	   	$dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+	   	if ($username && verify_user($username, $dbLink)) {
+		   	$sessionId = md5(mt_rand());
+		   	$_SESSION["pageId"] = "searchform";
+		   	$expTime = time()+SESSION_EXP_TIME;
+		   	$expTimeDB = date('Y-m-d H:i:s', $expTime);
+		   	// Update sessionId and exptime in database
+		   	$query = "UPDATE ".AUTHTABLENAME." SET sessionid='".$sessionId."', 
+				exptime='".$expTimeDB."' WHERE username='".$username."'";
+		   	$result = perform_query($query, $dbLink);
+	   	} else {
+		   	$error .= " Sorry, $username does not have access to this service.";
+		   	$_SESSION["error"] = "$error";
+	   	}
+    	} elseif ($forms["authtype"] == "cert") {
+           // Using Cert basic authentication.Check certificate SerialNumber first, Subject DN if SerialNumber fails
+           $dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+           if (verify_user($_SERVER['SSL_CLIENT_M_SERIAL'], $dbLink) || verify_user($_SERVER['SSL_CLIENT_S_DN'], $dbLink)) {
+             $sessionId = md5(mt_rand());
+             $_SESSION["pageId"] = "searchform";
+             $expTime = time()+SESSION_EXP_TIME;
+             $expTimeDB = date('Y-m-d H:i:s', $expTime);
+             // Update sessionId and exptime in database
+             $query = "UPDATE ".AUTHTABLENAME." SET sessionid='".$sessionId."', 
+             exptime='".$expTimeDB."' WHERE username='".$username."'";
+             $result = perform_query($query, $dbLink);
+           } else {
+             $error .= " Sorry, $username does not have access to this service.";
+             $_SESSION["error"] = "$error";
+           }
+   	} else {
+	   	// Not using LDAP or WebBasic, revert to local db authentication
+	   	if ($_POST["username"]) {
+		   	$username = $_POST["username"];
+		   	$password = $_POST["password"];
+		   	// die("Info: $username, $password");
+		   	$dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+		   	if ($username && $password && verify_login($username, $password, $dbLink)) {
+			   	$sessionId = md5(mt_rand());
+			   	$_SESSION["pageId"] = "searchform" ;
+			   	// Calculate the expiration time
+			   	$expTime = time()+SESSION_EXP_TIME;
+			   	$expTimeDB = date('Y-m-d H:i:s', $expTime);
+			   	// Update sessionId and exptime in database
+			   	$query = "UPDATE ".AUTHTABLENAME." SET sessionid='".$sessionId."', 
+					exptime='".$expTimeDB."' WHERE username='".$username."'";
+			   	$result = perform_query($query, $dbLink);
+		   	} else {
+			   	$error .= " Invalid password for user $username";
+			   	$_SESSION["error"] = "$error";
+		   	}
+	   	} else {
+		   	$error .= " Missing POST variables";
+			   	$_SESSION["error"] = "$error";
+	   	}
+   	}
+   	if (trim($error)!="") {
+	   	return $error;
+	} else {
+	   	$_SESSION["username"] = $username;
+	   	return $username;
+   	}
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/common_funcs.php.orig php-syslog-ng/html/includes/common_funcs.php.orig
--- php-syslog-ng-2.9.f/html/includes/common_funcs.php.orig	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/common_funcs.php.orig	2008-08-07 23:35:20.000000000 -0400
@@ -0,0 +1,791 @@
+<?php
+// Copyright (C) 2001-2004 by Michael Earls, michael@michaelearls.com
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (C) 2006 Clayton Dukes, cdukes@cdukes.com
+
+$basePath = dirname( __FILE__ );
+include_once ($basePath ."/../config/config.php");
+
+error_reporting(E_ALL & ~E_NOTICE);
+//------------------------------------------------------------------------
+// This function returns the current microtime.
+//------------------------------------------------------------------------
+function get_microtime() {
+	list($usec, $sec) = explode(" ", microtime());
+	return ((float)$usec + (float)$sec);
+}
+
+
+//------------------------------------------------------------------------
+// This functions verifies a username/password combination. If the
+// combination exists then the function returns TRUE. If not then it
+// returns FALSE.
+//------------------------------------------------------------------------
+function verify_login($username, $password, $link) {
+	// If the username or password is blank then return FALSE.
+	if(!$username || !$password) {
+		return FALSE;
+	}
+
+	// Get the md5 hash of the password and query the database.
+	$pwHash = md5($password);
+	$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."' AND pwhash='".$pwHash."'";
+	// die($query);
+	$result = perform_query($query, $link);
+
+	// If the query returns one result row then return TRUE.
+	if(num_rows($result) == 1) {
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+//------------------------------------------------------------------------
+// This functions verifies a username only. If the username
+// exists then the function returns TRUE. If not then it
+// returns FALSE. Implemented for Web Basic auth.
+// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+//------------------------------------------------------------------------
+function verify_user($username, $link) {
+       // If the username is blank, then return FALSE.
+       if (!$username) {
+               return FALSE;
+       }
+
+       // Query the database
+       $query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."'";
+       $result = perform_query($query, $link);
+
+       // If the query returns one result row then return TRUE.
+       if(num_rows($result) == 1) {
+               return TRUE;
+       } else {
+               return FALSE;
+       }
+}
+
+
+//------------------------------------------------------------------------
+// This function verifies a username/sessionId combination. If the
+// combination exists then the function returns TRUE. If not then it
+// returns FALSE. If the RENEW_SESSION_ON_EACH_PAGE parameter is set then
+// the functions also updates the timestamp for the session after it is
+// verified.
+//------------------------------------------------------------------------
+function verify_session($username, $sessionId, $link) {
+	// If the username or sessionId is blank then return FALSE.
+	if(!$username || !$sessionId) {
+		return FALSE;
+	}
+
+	// Query the database.
+	$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."' 
+		AND sessionid='".$sessionId."' AND exptime>now()";
+	$result = perform_query($query, $link);
+
+	// If the query returns one result row then the session is verified.
+	if(num_rows($result) == 1) {
+		//If RENEW_SESSION_ON_EACH_PAGE is set then update the
+		// session timestamp in the database.
+		if(defined('RENEW_SESSION_ON_EACH_PAGE') && RENEW_SESSION_ON_EACH_PAGE == TRUE) {
+			$expTime = time()+SESSION_EXP_TIME;
+			$expTimeDB = date('Y-m-d H:i:s', $expTime);
+			$query = "UPDATE ".AUTHTABLENAME." SET exptime='".$expTimeDB."'
+				WHERE username='".$username."'";
+			perform_query($query, $link);
+		}
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+
+//------------------------------------------------------------------------
+// Function used to retrieve input values and if neccessary add slashes.
+//------------------------------------------------------------------------
+function get_input($varName, $check_session=true) {
+   	$value="";
+   	if(isset($_COOKIE[$varName])) {
+	   	$value = $_COOKIE[$varName];
+   	} elseif(isset($_GET[$varName])) {
+	   	$value = $_GET[$varName];
+   	} elseif(isset($_POST[$varName])) {
+	   	$value = $_POST[$varName];
+	/** 
+	 * BPK: we can't always use this, else checkboxes never get unset, 
+	 * rather let js reload the form at the end of search.php
+	 */
+   	} elseif($check_session && isset($_SESSION[$varName])) {
+	   	$value = $_SESSION[$varName];
+   	} 
+	if($value && !get_magic_quotes_gpc()) {
+	   	if(!is_array($value)) {
+		   	$value = addslashes($value);
+	   	}
+	   	else {
+		   	foreach($value as $key => $arrValue) {
+			   	$value[$key] = addslashes($arrValue);
+		   	}
+	   	}
+   	}
+   	return $value;
+}
+
+
+//------------------------------------------------------------------------
+// Function used to validate user supplied variables.
+//------------------------------------------------------------------------
+function validate_input($value, $regExpName) {
+	global $regExpArray;
+
+	if(!$regExpArray[$regExpName]) {
+		return FALSE;
+	}
+
+	if(is_array($value)) {
+		foreach($value as $arrval) {
+			if(!preg_match("$regExpArray[$regExpName]", $arrval)) {
+				return FALSE;
+			}
+		}
+		return TRUE;
+	}
+	elseif(preg_match("$regExpArray[$regExpName]", $value)) {
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+
+//------------------------------------------------------------------------
+// This function reloads the cache with data from $table.
+//------------------------------------------------------------------------
+function reload_cache($table, $link) {
+	$cacheHostValues = array();
+	$cacheFacilityValues = array();
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	// $add = "";
+
+	/* cdukes - 2-28-08: Added a default of "NONE" below so that the array would not be empty which causes the INSERT to fail if no results are returned) */
+	$cacheProgramValues = array("NONE");
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+	// Get new cache values from $table
+	$sql = "SELECT DISTINCT host FROM ".$table;
+	$result = perform_query($sql, $link);
+	while($row = fetch_array($result, 'ASSOC')) {
+		array_push($cacheHostValues, $row['host']);
+	}
+
+	$sql = "SELECT DISTINCT facility FROM ".$table;
+	$result = perform_query($sql, $link);
+	while($row = fetch_array($result, 'ASSOC')) {
+		array_push($cacheFacilityValues, $row['facility']);
+	}
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	  $sql = "SELECT DISTINCT program FROM ".$table." WHERE LENGTH(program)<80 AND "
+	 	 ."program RLIKE '^[a-zA-Z]+[a-zA-Z0-9/()._\-]+$' limit 50";
+	$result = perform_query($sql, $link);
+	   	while($row = fetch_array($result, 'ASSOC')) {
+		   	array_push($cacheProgramValues, $row['program']);
+	   	}
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+	// Prepare INSERT statements
+	$updateTime = date("Y-m-d H:i:s");
+	$insertHost = "INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) VALUES ";
+	foreach($cacheHostValues as $value) {
+		// cdukes: 4/29/08 - Added 'addslashes' below to quote any odd sql inserts
+		// Ref: http://groups.google.com/group/php-syslog-ng-support/browse_thread/thread/eda3c96999889b47
+		// $add = "('".$table."', 'HOST', '".$value."', '".$updateTime."'),";
+		$add = "('".$table."', 'HOST', '".addslashes($value)."', '".$updateTime."'),";
+		$insertHost .= $add;
+	}
+	$insertHost = rtrim($insertHost, ',');
+	if (!$add) {
+		die("<center><em>There appear to be no hosts in the Database yet<br>
+				You can generate fake ones using scripts/dbgen.pl<br>
+				</em></center>
+				");
+	}
+
+	$insertFacility = "INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) VALUES ";
+	foreach($cacheFacilityValues as $value) {
+		$add = "('".$table."', 'FACILITY', '".$value."', '".$updateTime."'),";
+		$insertFacility .= $add;
+	}
+	$insertFacility = rtrim($insertFacility, ',');
+
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	$insertProgram = "INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) VALUES ";
+	foreach($cacheProgramValues as $value) {
+		$add = "('".$table."', 'PROGRAM', '".$value."', '".$updateTime."'),";
+		$insertProgram .= $add;
+	}
+	$insertProgram = rtrim($insertProgram, ',');
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+
+	// Insert new cache values for $table
+	perform_query($insertHost, $link);
+	perform_query($insertFacility, $link);
+	// Start - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+	perform_query($insertProgram, $link);
+	// End - http://code.google.com/p/php-syslog-ng/issues/detail?id=31
+
+	// Drop old cache values for $table
+	$sql = "DELETE FROM ".CACHETABLENAME." WHERE tablename='".$table.
+		"' AND updatetime<'".$updateTime."'";
+	perform_query($sql, $link);
+}
+
+
+//========================================================================
+// BEGIN DATABASE FUNCTIONS
+//========================================================================
+//------------------------------------------------------------------------
+// This function connects to the MySQL server and selects the database
+// specified in the DBNAME parameter. If an error occurs then return
+// FALSE.
+//------------------------------------------------------------------------
+function db_connect_syslog($dbUser, $dbPassword, $connType = 'P') {
+	$server_string = DBHOST.":".DBPORT;
+	$link = "";
+	if(function_exists('mysql_pconnect') && $connType == 'P') {
+		$link = @mysql_pconnect($server_string, $dbUser, $dbPassword);
+	}
+	elseif(function_exists('mysql_connect')) {
+		$link = @mysql_connect($server_string, $dbUser, $dbPassword);
+	}
+	if(!$link) {
+		return FALSE;
+	}
+
+	$result = mysql_select_db(DBNAME, $link);
+	if(!$result) {
+		return FALSE;
+	}
+
+	return $link;
+}
+
+
+//------------------------------------------------------------------------
+// This functions performs the SQL query and returns a result resource. If
+// an error occurs then execution is halted an the MySQL error is
+// displayed.
+//------------------------------------------------------------------------
+function perform_query($query, $link) {
+	if($link) {
+		$result = mysql_query($query, $link); 
+			if (!$result) {
+			print ("Error in \"function perform_query()\" <br>Mysql_error: " .mysql_error() ."<br>Query was: $query<br>"); 
+			return ("Error in \"function perform_query()\" <br>Mysql_error: " .mysql_error()); 
+			}
+	}
+	else {
+		die("Error in perform_query function<br> No DB link for query: $query<br>Mysql_error: " .mysql_error());
+	}
+
+	return $result;
+}
+//------------------------------------------------------------------------
+// This functions performs the SQL query and returns a result resource. If
+// an error occurs then nothing happens. This is ONLY used in logrotate.php
+// to check for row data of non-existent tables. 
+// In other words, we are SUCCESSFUL if there is an error.
+//------------------------------------------------------------------------
+
+function perform_query_quiet($query, $link) {
+	if($link) {
+		$result = @mysql_query($query, $link); 
+	}
+	else {
+		die("Error in perform_query function<br> No DB link for query: $query<br>Mysql_error: " .mysql_error());
+	}
+
+	return $result;
+}
+
+
+//------------------------------------------------------------------------
+// This functions returns a result row as an array.
+// The type can be BOTH, ASSOC or NUM.
+//------------------------------------------------------------------------
+function fetch_array($result, $type = 'BOTH') {
+	if($type == 'BOTH') {
+		return mysql_fetch_array($result);
+	}
+	elseif($type == 'ASSOC') {
+		return mysql_fetch_assoc($result);
+	}
+	elseif($type == 'NUM') {
+		return mysql_fetch_row($result);
+	}
+	else {
+		die('Wrong type for fetch_array()');
+	}
+}
+
+
+//------------------------------------------------------------------------
+// This functions sets the row offset for a result resource
+//------------------------------------------------------------------------
+function result_seek($result, $rowNumber) {
+	mysql_data_seek($result, $rowNumber);
+}
+
+
+//------------------------------------------------------------------------
+// This functions returns a result row as an array
+//------------------------------------------------------------------------
+function num_rows($result) {
+	return mysql_num_rows($result);
+}
+
+
+//------------------------------------------------------------------------
+// This function checks if a particular table exists.
+//------------------------------------------------------------------------
+function table_exists($tableName, $link) {
+	$tables = get_tables($link);
+	if(array_search($tableName, $tables) !== FALSE) {
+		return TRUE;
+	}
+	else {
+		return FALSE;
+	}
+}
+
+
+//------------------------------------------------------------------------
+// This function returns an array of the names of all tables in the
+// database.
+//------------------------------------------------------------------------
+function get_tables($link) {
+	$tableList = array();
+	$query = "SHOW TABLES";
+	$result = perform_query($query, $link);
+	while($row = fetch_array($result)) {
+		array_push($tableList, $row[0]);
+	}
+
+	return $tableList;
+}
+
+
+//------------------------------------------------------------------------
+// This function returns an array with the names of tables with log data.
+//------------------------------------------------------------------------
+function get_logtables($link) {
+	// Create an array of the column names in the default table
+	$query = "DESCRIBE ".DEFAULTLOGTABLE;
+	$result = perform_query($query, $link);
+	$defaultFieldArray = array();
+	while($row = mysql_fetch_array($result)) {
+		array_push($defaultFieldArray, $row['Field']);
+	}
+
+	// Create an array with the names of all the log tables
+	$logTableArray = array();
+	$allTablesArray = get_tables($link);
+	foreach($allTablesArray as $value) {
+		// Create an array of the column names in the current table
+		$query = "DESCRIBE ".$value;
+		$result = perform_query($query, $link);
+		// Get the names of columns in current table
+		$fieldArray = array();
+		while ($row = mysql_fetch_array($result)) {
+			array_push($fieldArray, $row['Field']);
+		}
+
+		// If the current array is identical to the one from the
+		// DEFAULTLOGTABLE then the name is added to the result
+		// array.
+		$diffArray = array_diff_assoc($defaultFieldArray, $fieldArray);
+		if(!$diffArray) {
+			array_push($logTableArray, $value);
+		}
+	}
+	return $logTableArray;
+}
+//========================================================================
+// END DATABASE FUNCTIONS
+//========================================================================
+
+//========================================================================
+// BEGIN ACCESS CONTROL FUNCTIONS
+//========================================================================
+//------------------------------------------------------------------------
+// This function verifies that the user has access to a particular part
+// of php-syslog-ng.
+// Inputs are:
+// username
+// actionName
+// dbLink
+//
+// Outputs TRUE or FALSE
+//------------------------------------------------------------------------
+function grant_access($userName, $actionName, $link) {
+	// If ACL is not used then always return TRUE
+	if(!defined('USE_ACL') || !USE_ACL || !defined('REQUIRE_AUTH') || !REQUIRE_AUTH) {
+		return TRUE;
+	}
+
+	// Get user access
+	$sql = "SELECT access FROM ".USER_ACCESS_TABLE." WHERE username='".$userName."' 
+			AND actionname='".$actionName."'";
+	$result = perform_query($sql, $link);
+	$row = fetch_array($result);
+	if(num_rows($result) && $row['access'] == 'TRUE') {
+		return TRUE;
+	}
+	// Get default access
+	else {
+		$sql = "SELECT defaultaccess FROM ".ACTION_TABLE." WHERE actionname='".$actionName."'";
+		$result = perform_query($sql, $link);
+		$row = fetch_array($result);
+		if($row['defaultaccess'] == 'TRUE') {
+			return TRUE;
+		}
+		else {
+			return FALSE;
+		}
+	}
+}
+//========================================================================
+// END ACCESS CONTROL FUNCTIONS
+//========================================================================
+
+//========================================================================
+// BEGIN REDIRECT FUNCTION
+//========================================================================
+
+function g_redirect($url,$mode)
+/*  It redirects to a page specified by "$url".
+ *  $mode can be:
+ *    LOCATION:  Redirect via Header "Location".
+ *    REFRESH:  Redirect via Header "Refresh".
+ *    META:      Redirect via HTML META tag
+ *    JS:        Redirect via JavaScript command
+ */
+{
+  if (strncmp('http:',$url,5) && strncmp('https:',$url,6)) {
+
+     $starturl = ($_SERVER["HTTPS"] == 'on' ? 'https' : 'http') . '://'.
+                 (empty($_SERVER['HTTP_HOST'])? $_SERVER['SERVER_NAME'] :
+                 $_SERVER['HTTP_HOST']);
+
+     if ($url[0] != '/') $starturl .= dirname($_SERVER['PHP_SELF']).'/';
+
+     $url = "$starturl$url";
+  }
+
+  switch($mode) {
+
+     case 'LOCATION': 
+
+       if (headers_sent()) exit("Headers already sent. Can not redirect to $url");
+
+       header("Location: $url");
+       exit;
+
+     case 'REFRESH': 
+
+       if (headers_sent()) exit("Headers already sent. Can not redirect to $url");
+
+       header("Refresh: 0; URL=\"$url\""); 
+       exit;
+
+     case 'META': 
+
+       ?><meta http-equiv="refresh" content="0;url=<?php echo $url?>" /><?php
+       exit;
+
+     case 'JS': 
+
+       ?><script type="text/javascript">
+       window.location.href='<?php echo $url?>';
+       </script><?php
+       exit;
+
+     default: /* -- Java Script */
+
+       ?><script type="text/javascript">
+       window.location.href='<?php echo $url?>';
+       </script><?php
+  }
+  exit;
+}
+
+//========================================================================
+// END REDIRECT FUNCTION
+//========================================================================
+
+/*  Adds commas to a string of numbers
+*/
+function commify ($str) { 
+        $n = strlen($str); 
+        if ($n <= 3) { 
+                $return=$str;
+        } 
+        else { 
+                $pre=substr($str,0,$n-3); 
+                $post=substr($str,$n-3,3); 
+                $pre=commify($pre); 
+                $return="$pre,$post"; 
+        }
+        return($return); 
+}
+
+/* Usage:
+
+   $week = get_weekdates($year,$month,$day);
+
+   for($i = 1; $i<=7 ; $i++) {
+
+   echo 'Year: ' . $week[$i]['year'] . '<br>';
+   echo 'Month: ' . $week[$i]['month'] . '<br>';
+   echo 'Day: ' . $week[$i]['day'] . '<br>';
+   echo 'Longname: ' . $week[$i]['dayname'] . '<br>';
+   echo 'Shortname: ' . $week[$i]['shortdayname'] . '<br>';
+   echo 'Sqldate: ' . $week[$i]['sqldate'] . '<br>';
+   echo '<br>';
+
+   }
+ */
+
+function get_weekdates($year, $month, $day){
+	setlocale(LC_ALL, "C");
+	//echo "Year $year<br>";
+	//echo "Month $month<br>";
+	//echo "Day $day<br>";
+
+	// make unix time
+	$searchdate = mktime(0,0,0,$month,$day,$year);
+	//echo "Searchdate: $searchdate<br>";
+
+	// let's get the day of week                //    on solaris <8 the first day of week is sunday, not monday
+	$day_of_week = strftime("%u", $searchdate);  
+	//echo "Debug: $day_of_week <br><br>";
+
+	$days_to_firstday = ($day_of_week - 1);        //    on solaris <8 this may not work
+	//echo "Debug: $days_to_firstday <br>";
+
+	$days_to_lastday = (7 - $day_of_week);        //    on solaris <8 this may not work
+	//echo "Debug: $days_to_lastday <br>";
+
+	$date_firstday = strtotime("-".$days_to_firstday." days", $searchdate);
+	//echo "Debug: $date_firstday <br>";
+
+	$date_lastday = strtotime("+".$days_to_lastday. " days", $searchdate);
+	//echo "Debug: $date_lastday <br>";
+
+	$d_result = "";                    // array to return
+
+	// write an array of all dates of this week 
+	for($i=0; $i<=6; $i++) {
+		$y = $i + 1;
+		$d_date = strtotime("+".$i." days", $date_firstday);
+
+		// feel free to add more values to these hashes
+		$result[$y]['year'] = strftime("%Y", $d_date);
+		$result[$y]['month'] = strftime("%m", $d_date);
+		$result[$y]['day'] = strftime("%d", $d_date);
+		$result[$y]['dayname'] = strftime("%A", $d_date);
+		$result[$y]['shortdayname'] = strftime("%a", $d_date);
+		$result[$y]['sqldate'] = strftime("%Y-%m-%d", $d_date);
+	}
+
+	return $result;                    // return the array
+}
+
+// Use this instead of count(*), it's faster (supposedly)
+function get_total_rows ($table) {
+	$temp = mysql_query("SELECT SQL_CALC_FOUND_ROWS * FROM $table LIMIT 1");
+	$result = mysql_query("SELECT FOUND_ROWS()");
+	$total = mysql_fetch_row($result);
+	return $total[0];
+}
+
+// Added for better cookie handling
+function getDomain() {
+	if ( isset($_SERVER['HTTP_HOST']) ) {
+		// Get domain
+		$dom = $_SERVER['HTTP_HOST'];
+		// Strip www from the domain
+		if (strtolower(substr($dom, 0, 4)) == 'syslog.') { $dom = substr($dom, 4); }
+		// Check if a port is used, and if it is, strip that info
+		$uses_port = strpos($dom, ':');
+		if ($uses_port) { $dom = substr($dom, 0, $uses_port); }
+		// Add period to Domain (to work with or without www and on subdomains)
+		$dom = '.' . $dom;
+	} else {
+		$dom = false;
+	}
+	return $dom;
+}
+
+# cdukes - Added below for 2.9.4
+function secure () {
+   	if (!($_SESSION["member_id"]) || ($_SESSION["member_id"] == "")) {
+	   	// Cdukes: 3/20/08: Carry post variables through login
+	   	// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=35
+	   	// Header("Location:" . LOGIN_URL);
+		$destination = LOGIN_URL;
+		// Remember search query across login
+			if (!empty($_SERVER['QUERY_STRING']))
+			{
+				$destination .= '?' . $_SERVER['QUERY_STRING'];
+				}
+				Header("Location:" . $destination);
+	   	exit();
+	} else {
+		return $_SESSION["member_id"];
+   	}
+}
+function login_check ($forms) {
+   	$error = "";
+   	$username = $forms["username"];
+   	$password = $forms["password"];
+   	if (trim($username) == "") $error .= "<li>Your username is empty.</li>";
+   	if (trim($password) == "") $error .= "<li>Your password is empty.</li>";
+}
+
+function login ($forms) {
+   	$error = "";
+   	$username = $forms["username"];
+   	$password = $forms["password"];
+   	if (!$password) { $password = "NoAnonymous_somebadtokenstring"; }
+		// die("$password");
+
+   	if ($forms["authtype"] == "ldap") {
+	   	//define an appropriate ldap search filter to find your users, and filter out accounts such as administrator(administrator should be renamed anyway!).
+	  	$filter="(&(|(!(displayname=Administrator*))(!(displayname=Admin*)))(" .LDAP_CN. "=$username))";
+	   	$dn = LDAP_CN . "=$username, ";
+	   	if (!($connect = @ldap_connect(LDAP_SRV))) {
+		   	$error .= "Could not connect to LDAP server:" . LDAP_SRV;
+	   	}
+
+		switch (LDAP_MSAD) {
+		
+			case "YES":
+				
+				ldap_set_option($connect, LDAP_OPT_PROTOCOL_VERSION,3);
+	                        ldap_set_option($connect, LDAP_OPT_REFERRALS,0);
+
+				if (!($bind = @ldap_bind($connect, "$username@" . LDAP_DOMAIN, $password))) {
+		                        $error .= " Unable to bind to LDAP Server: <b>" . LDAP_SRV . "</b><br> <li>DN: $dn<br> <li>BaseDN: " . LDAP_BASE_DN . "<br>";
+                		}
+
+				break;
+
+			default:
+		
+				if (!($bind = @ldap_bind($connect, "$dn" . LDAP_BASE_DN, $password))) {
+				   	$error .= " Unable to bind to LDAP Server: <b>" . LDAP_SRV . "</b><br> <li>DN: $dn<br> <li>BaseDN: " . LDAP_BASE_DN . "<br>";
+	   			}
+				
+		}
+
+	   	if (!($sr = @ldap_search($connect, LDAP_BASE_DN, $filter))) { #search for user
+		   	$error .= " Unable to search: <b>" . LDAP_SRV . "</b><br> <li>DN: $dn<br> <li>BaseDN: " . LDAP_BASE_DN . "<br>";
+	   	}
+
+	   	$info = @ldap_get_entries($connect, $sr);
+	   	// print  "Number of entries returned is " .ldap_count_entries($connect, $sr)."<p>";
+
+	   	if (LDAP_USEPRIV == "ON") {
+		   	if (in_array(LDAP_RW_GROUP, $info[0]["groupmembership"])) {
+			   	$_SESSION["userpriv"] = "rw";
+		   	} elseif (in_array(LDAP_RO_GROUP, $info[0]["groupmembership"])) {
+			   	$_SESSION["userpriv"] = "ro";
+		   	} else {
+			   	$_SESSION["userpriv"] = "disabled";
+			   	// echo "User privileges are " . $_SESSION["userpriv"] . "<br>";
+		   	} 
+		}
+
+
+                if ( trim($error) != "" ) {
+                         return $error;
+                } else {
+
+			$fullname=$info[0]["cn"][0];
+        	        $fqdn=$info[0]["dn"];
+
+	   		$_SESSION["username"] = $username;
+		   	$_SESSION["groups"] = $info[0]["groupmembership"];
+		   	$_SESSION["token"] = $password;
+		   	$_SESSION["fullname"] = $fullname;
+		   	$_SESSION["fqdn"] = $fqdn;
+	   		$flname = explode(" ", $fullname);
+		   	$_SESSION["firstname"] = $flname[0];
+		   	$_SESSION["lastname"] = $flname[1];
+	   		$_SESSION["pageId"] = "searchform" ;
+		   	// die(phpinfo());
+		   	// die(print_r($info[0]));
+	   		// die(print_r($_SESSION));
+		}
+
+		/* from here, do your sql query to query the database to search for existing record with correct username and password */
+   	} elseif ($forms["authtype"] == "basic") {
+	   	// Using Web basic authentication. Check to see if $_SERVER['REMOTE_USER'] has access, and act accordingly.
+	  	$username = $_SERVER['REMOTE_USER'];
+	  	if ($username == "") {
+			$username = "that user";
+		}
+	   	$dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+	   	if ($username && verify_user($username, $dbLink)) {
+		   	$sessionId = md5(mt_rand());
+		   	$_SESSION["pageId"] = "searchform";
+		   	$expTime = time()+SESSION_EXP_TIME;
+		   	$expTimeDB = date('Y-m-d H:i:s', $expTime);
+		   	// Update sessionId and exptime in database
+		   	$query = "UPDATE ".AUTHTABLENAME." SET sessionid='".$sessionId."', 
+				exptime='".$expTimeDB."' WHERE username='".$username."'";
+		   	$result = perform_query($query, $dbLink);
+	   	} else {
+		   	$error .= " Sorry, $username does not have access to this service.";
+		   	$_SESSION["error"] = "$error";
+	   	}
+   	} else {
+	   	// Not using LDAP or WebBasic, revert to local db authentication
+	   	if ($_POST["username"]) {
+		   	$username = $_POST["username"];
+		   	$password = $_POST["password"];
+		   	// die("Info: $username, $password");
+		   	$dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+		   	if ($username && $password && verify_login($username, $password, $dbLink)) {
+			   	$sessionId = md5(mt_rand());
+			   	$_SESSION["pageId"] = "searchform" ;
+			   	// Calculate the expiration time
+			   	$expTime = time()+SESSION_EXP_TIME;
+			   	$expTimeDB = date('Y-m-d H:i:s', $expTime);
+			   	// Update sessionId and exptime in database
+			   	$query = "UPDATE ".AUTHTABLENAME." SET sessionid='".$sessionId."', 
+					exptime='".$expTimeDB."' WHERE username='".$username."'";
+			   	$result = perform_query($query, $dbLink);
+		   	} else {
+			   	$error .= " Invalid password for user $username";
+			   	$_SESSION["error"] = "$error";
+		   	}
+	   	} else {
+		   	$error .= " Missing POST variables";
+			   	$_SESSION["error"] = "$error";
+	   	}
+   	}
+   	if (trim($error)!="") {
+	   	return $error;
+	} else {
+	   	$_SESSION["username"] = $username;
+	   	return $username;
+   	}
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/configure.php php-syslog-ng/html/includes/configure.php
--- php-syslog-ng-2.9.f/html/includes/configure.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/configure.php	2008-02-03 22:29:02.000000000 -0500
@@ -0,0 +1,694 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+
+require_once 'includes/html_header.php';
+
+//========================================================================
+// BEGIN: GET THE INPUT VARIABLES
+//========================================================================
+$configTask = get_input('configTask');
+//========================================================================
+// END: GET THE INPUT VARIABLES
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE PASSWORD CHANGE REQUEST
+//========================================================================
+if(strcasecmp($configTask, "chgmypw") == 0) {
+	$username = $_SESSION["username"];
+	$oldpw = get_input('oldpw');
+	$newpw1 = get_input('newpw1');
+	$newpw2 = get_input('newpw2');
+	$chgPw = TRUE;
+
+	// Make sure newpw1 and newpw2 are identical
+	if(strcmp($newpw1, $newpw2) != 0) {
+		echo "Typo! The two passwords were not identical.<p>";
+		$chgPw = FALSE;
+	}
+
+	// Make sure the old oldpw is correct
+	$oldpwHash = md5($oldpw);
+	$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$username."'
+		AND pwhash='".$oldpwHash."'";
+	$result = perform_query($query, $dbLink);
+	if(num_rows($result) != 1) {
+		echo "Old password was not correct.<p>";
+		$chgPw = FALSE;
+	}
+
+	// Make sure the password is valid
+	if(!validate_input($newpw1, 'password')) {
+		echo "Invalid password. Passwords have to be at least 4 characters.";
+		$chgPw = FALSE;
+	}
+
+	if($chgPw) {
+		// Change password
+		$newpwHash = md5($newpw1);
+		$query = "UPDATE ".AUTHTABLENAME." SET pwhash='".$newpwHash."' WHERE
+			username='".$username."'";
+
+		perform_query($query, $dbLink);
+		echo "Your password was changed!";
+	}
+}
+//========================================================================
+// END: HANDLE PASSWORD CHANGE REQUEST
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE NEW USER REQUEST
+//========================================================================
+if(strcasecmp($configTask, "adduser") == 0) {
+	$newuser = get_input('newuser');
+	$newuserpw1 = get_input('newuserpw1');
+	$newuserpw2 = get_input('newuserpw2');
+	$addUser = TRUE;
+
+	// Make sure $newuserpw1 and $newuserpw2 are identical
+	if(strcmp($newuserpw1, $newuserpw2) != 0) {
+		echo "Typo! The two passwords were not identical.<p>";
+		$addUser = FALSE;
+        }
+
+	// Make sure the username is valid
+	if(!validate_input($newuser, 'username')) {
+		echo "Invalid username. Usernames must be at least 4 character and only use alpha-numeric and _ (underscore).";
+		$addUser = FALSE;
+	}
+
+	// Make sure the password is valid
+	if(!validate_input($newuserpw1, 'password')) {
+		echo "Invalid password. Passwords have to be at least 4 characters.";
+		$addUser = FALSE;
+	}
+
+	// Make sure the username isn't already used
+	if($addUser) {
+		$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$newuser."'";
+		$result = perform_query($query, $dbLink);
+		if(num_rows($result) != 0) {
+			echo "User already exists!<p>";
+			$addUser = FALSE;
+		}
+	}
+
+	// Add user
+	if($addUser && grant_access($username, 'add_user', $dbLink)) {
+		$newuserpwHash = md5($newuserpw1);
+		$admLink = db_connect_syslog(DBADMIN, DBADMINPW, 'C');
+		$query = "INSERT INTO ".AUTHTABLENAME." (username, pwhash) VALUES('".
+			$newuser."', '".$newuserpwHash."')";
+		perform_query($query, $admLink);
+		echo "New user added: ".$newuser.".";
+		mysql_close($admLink);
+	}
+}
+//========================================================================
+// END: HANDLE NEW USER REQUEST
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE CHANGE OTHER USER'S PASSWORD
+//========================================================================
+if(strcasecmp($configTask, "chguserpw") == 0) {
+	$chguser = get_input('chguser');
+	$newpw1 = get_input('newpw1');
+	$newpw2 = get_input('newpw2');
+	$chgUserPw = TRUE;
+
+	// Make sure $newpw1 and $newpw2 are identical
+	if(strcmp($newpw1, $newpw2) != 0) {
+		echo "Typo! The two passwords were not identical.<p>";
+		$chgUserPw = FALSE;
+        }
+
+	// Make sure the username is valid
+	if(!validate_input($chguser, 'username')) {
+		echo "Invalid username. Usernames must be at least 4 character and only use alpha-numeric and _ (underscore).";
+		$chgUserPw = FALSE;
+	}
+
+	// Make sure the password is valid
+	if(!validate_input($newpw1, 'password')) {
+		echo "Invalid password. Passwords have to be at least 4 characters.";
+		$chgUserPw = FALSE;
+	}
+
+	// Make sure the username exists
+	if($chgUserPw) {
+		$query = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$chguser."'";
+		$result = perform_query($query, $dbLink);
+		if(num_rows($result) != 1) {
+			echo "User does not exist!<p>";
+			$chgUserPw = FALSE;
+		}
+	}
+
+	// If the input is correct then change the password
+	if($chgUserPw && grant_access($username, 'edit_user', $dbLink)) {
+		$newpwHash = md5($newpw1);
+		$query = "UPDATE ".AUTHTABLENAME." SET pwhash='".$newpwHash."' WHERE username='".$chguser."'";
+		perform_query($query, $dbLink);
+		echo "Password changed for user: ".$chguser.".";
+	}
+}
+//========================================================================
+// END: HANDLE CHANGE OTHER USER'S PASSWORD
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE DELETE USER REQUEST
+//========================================================================
+if(strcasecmp($configTask, "deluser") == 0) {
+	$delusername = get_input('delusername');
+	$delUser = TRUE;
+
+	// Make sure there are at least two users
+	$query = "SELECT COUNT(*) FROM ".AUTHTABLENAME;
+	$result = perform_query($query, $dbLink);
+	$rowCount = fetch_array($result);
+	if($rowCount[0] < 2) {
+		echo "There has to be at least one user.";
+		$delUser = FALSE;
+	}
+
+	// Make sure the username is valid
+	if(!validate_input($delusername, 'username')) {
+		echo "Invalid username. Usernames must be at least 4 character and only use alpha-numeric and _ (underscore).";
+		$delUser = FALSE;
+	}
+
+	// Make sure the username exists
+	if($delUser) {
+		$query = "SELECT COUNT(*) FROM ".AUTHTABLENAME." WHERE username='".$delusername."'";
+		$result = perform_query($query, $dbLink);
+		$rowCount = fetch_array($result);
+		if($rowCount[0] == 0) {
+			echo "Username ".$delusername." does not exist!";
+			$delUser = FALSE;
+		}
+	}
+
+	// If conditions are OK then delete the user
+	if($delUser && grant_access($username, 'edit_user', $dbLink)) {
+		$admLink = db_connect_syslog(DBADMIN, DBADMINPW, 'C');
+		$query = "DELETE FROM ".AUTHTABLENAME." WHERE username='".$delusername."'";
+		perform_query($query, $admLink);
+		mysql_close($admLink);
+	}
+}
+//========================================================================
+// END: HANDLE DELETE USER REQUEST
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE RELOAD CACHE REQUEST
+//========================================================================
+if(strcasecmp($configTask, "reloadCache") == 0) {
+	$reloadCache = TRUE;
+
+	// Make sure caching is enabled
+	if(!defined('USE_CACHE') || !USE_CACHE) {
+		echo "Caching of the search page is not enabled.";
+		$reloadCache = FALSE;
+	}
+
+	// Make sure the cache table exists
+	if(!table_exists(CACHETABLENAME, $dbLink)) {
+		echo "The cache table does not exist.";
+		$reloadCache = FALSE;
+	}
+
+	// If conditions are OK then reload the cache
+	if($reloadCache && grant_access($username, 'reload_cache', $dbLink)) {
+		$reloadingWithMergeData = FALSE;
+		if(table_exists(MERGELOGTABLE, $dbLink)) {
+			$sql = "SELECT * FROM ".MERGELOGTABLE." LIMIT 1";
+			$result = perform_query($sql, $dbLink);
+			if(num_rows($result)) {
+				$reloadingWithMergeData = TRUE;
+				reload_cache(MERGELOGTABLE, $dbLink);
+				echo "The search cache has been updated.";
+			}
+		}
+
+		if(!$reloadingWithMergeData) {
+			$tableArray = get_logtables($dbLink);
+			foreach($tableArray as $table) {
+				reload_cache($table, $dbLink);
+				echo "The search cache has been updated.";
+			}
+		}
+	}
+}
+//========================================================================
+// END: HANDLE RELOAD CACHE REQUEST
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE SET USER ACCESS REQUEST
+//========================================================================
+if(strcasecmp($configTask, "updateUserACL") == 0) {
+	$selectuser = get_input('selectuser');
+	$setUserAccess = TRUE;
+	
+	// Make sure access controls are enabled
+	if(!defined('USE_ACL') || !USE_ACL) {
+		echo "Access control is not enabled.";
+		$setUserAccess = FALSE;
+	}
+
+	// Make sure the username of selectuser is OK
+	if(!validate_input($selectuser, 'username')) {
+		echo "Invalid username. Usernames must be at least 4 character and only use alpha-numeric and _ (underscore).";
+		$setUserAccess = FALSE;
+	}
+	
+	// Make sure the user exists
+	if($setUserAccess) {
+		$sql = "SELECT * FROM ".AUTHTABLENAME." WHERE username='".$selectuser."'";
+		$result = perform_query($sql, $dbLink);
+		if(num_rows($result) == 0) {
+			echo "Username ".$selectuser." does not exist!";
+			$setUserAccess = FALSE;
+		}
+	}
+	
+	// If conditions are OK then update the user's access
+	if($setUserAccess && grant_access($username, 'edit_acl', $dbLink)) {
+		$actionInputs = array();
+		$sql = "SELECT * FROM ".ACTION_TABLE;
+		$result = perform_query($sql, $dbLink);
+		$admLink = db_connect_syslog(DBADMIN, DBADMINPW, 'C');
+		while($row = fetch_array($result)) {
+			$actionname = $row['actionname'];
+			$inputVal = get_input($actionname.'_acl');
+			if($inputVal == 1) {
+				$inputVal = 'TRUE';
+			}
+			else {
+				$inputVal = 'FALSE';
+			}
+			$sql = "SELECT * FROM ".USER_ACCESS_TABLE." WHERE username='".$selectuser.
+					"' AND actionname='".$actionname."'";
+			$innerResult = perform_query($sql, $dbLink);
+			if(num_rows($innerResult)) {
+				$sql = "UPDATE ".USER_ACCESS_TABLE." SET access='".$inputVal.
+					"' WHERE username='".$selectuser."' AND actionname='".$actionname."'";
+			}
+			else {
+				$sql = "INSERT INTO ".USER_ACCESS_TABLE." (username,actionname,access) 
+						VALUES('".$selectuser."','".$actionname."','".$inputVal."')";
+			}
+			perform_query($sql, $admLink);
+		}
+		mysql_close($admLink);
+		echo "The access control settings for ".$selectuser." have been updated.";
+	}
+}
+//========================================================================
+// END: HANDLE SET USER ACCESS REQUEST
+//========================================================================
+
+//========================================================================
+// BEGIN: HANDLE SET DEFAULT ACCESS REQUEST
+//========================================================================
+if(strcasecmp($configTask, "updateDefaultACL") == 0) {
+	$setDefaultAccess = TRUE;
+
+	// Make sure access controls are enabled
+	if(!defined('USE_ACL') || !USE_ACL) {
+		echo "Access control is not enabled.";
+		$setDefaultAccess = FALSE;
+	}
+
+	// If conditions are OK then update the default access
+	if($setDefaultAccess && grant_access($username, 'edit_acl', $dbLink)) {
+		$actionInputs = array();
+		$sql = "SELECT * FROM ".ACTION_TABLE;
+		$result = perform_query($sql, $dbLink);
+		$admLink = db_connect_syslog(DBADMIN, DBADMINPW, 'C');
+		while($row = fetch_array($result)) {
+			$actionname = $row['actionname'];
+			$inputVal = get_input($actionname.'_acl');
+			if($inputVal == 1) {
+				$inputVal = 'TRUE';
+			}
+			else {
+				$inputVal = 'FALSE';
+			}
+			$sql = "UPDATE ".ACTION_TABLE." SET defaultaccess='".$inputVal."'
+				WHERE actionname='".$actionname."'";
+			perform_query($sql, $admLink);
+		}
+		mysql_close($admLink);
+		echo "The default access settings have been updated.";
+	}
+}
+//========================================================================
+// END: HANDLE SET DEFAULT ACCESS REQUEST
+//========================================================================
+
+//========================================================================
+// BEGIN: BUILDING THE HTML FORMS
+//========================================================================
+if(defined('REQUIRE_AUTH') && REQUIRE_AUTH) {
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="chgmypw">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>CHANGE YOUR PASSWORD:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		Old password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="oldpw">
+		</td></tr><tr><td>
+		New password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="newpw1">
+		</td></tr><tr><td>
+		Retype new password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="newpw2">
+		</td></tr></table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Change Password">
+	<input type="reset" value="Reset">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+}
+
+//------------------------------------------------------------------------
+// cdukes - Added SQL search below to check whether of not user has permission
+// to modify access controls, if they do then the options will be shown.
+//------------------------------------------------------------------------ 
+$acl = "FALSE";
+$sql = "SELECT * FROM ".USER_ACCESS_TABLE." WHERE username='" .$_SESSION["username"] ."'";
+$result = perform_query($sql, $dbLink);
+while($row = fetch_array($result)) {
+	   	if (array_search(edit_acl, $row))  {
+			$acl = $row[2];
+		}
+}
+if ($acl == 'TRUE') {
+
+if(defined('REQUIRE_AUTH') && REQUIRE_AUTH && grant_access($username, 'add_user', $dbLink)) {
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="adduser">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>ADD USER:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		New username:
+		</td><td>
+		<input type="text" size=12 maxlength=32 name="newuser">
+		</td></tr><tr><td>
+		New user password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="newuserpw1">
+		</td></tr><tr><td>
+		Retype new user password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="newuserpw2">
+		</td></tr></table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Add user">
+	<input type="reset" value="Reset">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+}
+if(defined('REQUIRE_AUTH') && REQUIRE_AUTH && grant_access($username, 'edit_user', $dbLink)) {
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="chguserpw">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>CHANGE USER'S PASSWORD:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		Username:
+		</td><td>
+		<input type="text" size=12 maxlength=32 name="chguser">
+		</td></tr><tr><td>
+		New password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="newpw1">
+		</td></tr><tr><td>
+		Retype new password:
+		</td><td>
+		<input type="password" size=12 maxlength=32 name="newpw2">
+		</td></tr></table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Change user's password">
+	<input type="reset" value="Reset">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+}
+if(defined('REQUIRE_AUTH') && REQUIRE_AUTH && grant_access($username, 'edit_user', $dbLink)) {
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="deluser">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>DELETE USER:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		<select name="delusername" size="8">
+<?php
+	$query = "SELECT username FROM ".AUTHTABLENAME;
+	$result = perform_query($query, $dbLink);
+	while($row = fetch_array($result)) {
+		echo "<option>".htmlentities($row[0])."</option>";
+	}
+?>
+		</select>
+		</td></tr></table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Delete user">
+	<input type="reset" value="Reset">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+}
+if(defined('USE_ACL') && USE_ACL && grant_access($username, 'edit_acl', $dbLink)) {
+	// User list
+	$sql = "SELECT username FROM ".AUTHTABLENAME;
+	$userResult = perform_query($sql, $dbLink);
+
+	// Get default access
+	$sql = "SELECT * FROM ".ACTION_TABLE;
+	$defaultResult = perform_query($sql, $dbLink);
+
+	// Create Javascript function that sets the current permissions
+	echo "<script language=\"JavaScript\">\n<!--Begin Hide\nfunction setAccess(username) {";
+	while($row = fetch_array($userResult)) {
+		result_seek($defaultResult, 0);
+		echo "if(username == '".$row['username']."') {\n";
+		while($innerRow = fetch_array($defaultResult)) {
+			$sql = "SELECT access FROM ".USER_ACCESS_TABLE." WHERE username='".$row['username'].
+				"' AND actionname='".$innerRow['actionname']."'";
+			$accessResult = perform_query($sql, $dbLink);
+			if(num_rows($accessResult)) {
+				$accessRow = fetch_array($accessResult);
+				$access = $accessRow['access'];
+			}
+			else {
+				$access = $innerRow['defaultaccess'];
+			}
+			if($access == 'TRUE') {
+				echo "document.useracl.".$innerRow['actionname']."_acl[0].checked=true\n";
+			}
+			else {
+				echo "document.useracl.".$innerRow['actionname']."_acl[1].checked=true\n";
+			}
+		}
+		echo "}\n";
+	}
+	echo "}\n// End Hide-->\n</script>";
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST" name="useracl">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="updateUserACL">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>SET USER ACCESS:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		<select name="selectuser" onchange="setAccess(this.value)" size="8">
+<?php
+	result_seek($userResult, 0);
+	while($row = fetch_array($userResult)) {
+		echo "<option>".$row['username']."</option>";
+	}
+?>		
+		</select>
+		</td></tr>
+		</table>
+		
+		<table align="center" class="formentry">
+		<tr><td>
+		</td><td>
+		ALLOW
+		</td><td>
+		DENY
+		</td></tr>
+<?php
+	result_seek($defaultResult, 0);
+	while($row = fetch_array($defaultResult)) {
+		echo "<tr><td>".$row['actiondescr']."</td><td><input name=\"";
+		echo $row['actionname']."_acl\" value=\"1\" type=\"radio\">";
+		echo "</td><td><input name=\"".$row['actionname']."_acl\"";
+		echo " value=\"0\" type=\"radio\">";
+		echo "</td></tr>\n";
+	}
+?>
+		</table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Set user access">
+	<input type="reset" value="Reset">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+	// Get default access
+	$sql = "SELECT * FROM ".ACTION_TABLE;
+	$defaultResult = perform_query($sql, $dbLink);
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="updateDefaultACL">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>SET DEFAULT ACCESS:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		</td><td>
+		ALLOW
+		</td><td>
+		DENY
+		</td></tr>
+<?php
+	while($row = fetch_array($defaultResult)) {
+		echo "<tr><td>".$row['actiondescr']."</td><td><input name=\"";
+		echo $row['actionname']."_acl\" value=\"1\" type=\"radio\"";
+		if($row['defaultaccess'] == 'TRUE') {
+			echo " checked>";
+		}
+		else {
+			echo ">";
+		}
+		echo "</td><td><input name=\"".$row['actionname']."_acl\"";
+		echo " value=\"0\" type=\"radio\"";
+		if($row['defaultaccess'] == 'FALSE') {
+			echo " checked>";
+		}
+		else {
+			echo ">";
+		}
+		echo "</td></tr>\n";
+	}
+?>
+		</table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Set default access">
+	<input type="reset" value="Reset">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+}
+if(defined('USE_CACHE') && USE_CACHE && grant_access($username, 'reload_cache', $dbLink)) {
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="index.php" method="POST">
+<input type="hidden" name="pageId" value="config">
+<input type="hidden" name="configTask" value="reloadCache">
+<table><tr><td>
+	<table class="searchform">
+	<tr class="lighter"><td>
+		<b>RELOAD SEARCH CACHE:</b>
+		<table align="center" class="formentry">
+		<tr><td>
+		Reloading the cache may take a while if you have a lot of log data.
+		</td></tr></table>
+	</td></tr></table>
+</td></tr>
+	<table class="searchform">
+	<tr><td class="darker">
+	<input type="submit" value="Reload cache">
+	</td></tr></table>
+</td></tr></table>
+</form>
+</td></tr></table>
+<?php
+}
+
+//-----------------------------------------------------------------------
+// Endif - if ($username == 'admin')
+//-----------------------------------------------------------------------
+}
+ 
+//========================================================================
+// END: BUILDING THE HTML FORMS
+//========================================================================
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/database.php php-syslog-ng/html/includes/database.php
--- php-syslog-ng-2.9.f/html/includes/database.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/database.php	2007-09-10 20:54:28.000000000 -0400
@@ -0,0 +1,1101 @@
+<?php
+/**
+* @version $Id: database.php,v 1.3 2005/07/22 03:36:09 eddieajau Exp $
+* @package PHP-Syslog-NG
+* @subpackage Database
+* @copyright (C) 2000 - 2005 Miro International Pty Ltd
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+/** ensure this file is being included by a parent file */
+defined( '_VALID_MOS' ) or die( 'Direct Access to this location is not allowed.' );
+
+/**
+* Database connector class
+* @subpackage Database
+* @package PHP-Syslog-NG
+*/
+class database {
+	/** @var string Internal variable to hold the query sql */
+	var $_sql='';
+	/** @var int Internal variable to hold the database error number */
+	var $_errorNum=0;
+	/** @var string Internal variable to hold the database error message */
+	var $_errorMsg='';
+	/** @var string Internal variable to hold the prefix used on all database tables */
+	var $_table_prefix='';
+	/** @var Internal variable to hold the connector resource */
+	var $_resource='';
+	/** @var Internal variable to hold the last query cursor */
+	var $_cursor=null;
+	/** @var boolean Debug option */
+	var $_debug=0;
+	/** @var int A counter for the number of queries performed by the object instance */
+	var $_ticker=0;
+	/** @var array A log of queries */
+	var $_log=null;
+
+	/**
+	* Database object constructor
+	* @param string Database host
+	* @param string Database user name
+	* @param string Database user password
+	* @param string Database name
+	* @param string Common prefix for all tables
+	*/
+	function database( $host='localhost', $user, $pass, $db, $table_prefix ) {
+		// perform a number of fatality checks, then die gracefully
+		if (!function_exists( 'mysql_connect' )) {
+			//or die( 'FATAL ERROR: MySQL support not available.  Please check your configuration.' );
+			$mosSystemError = 1;
+			$basePath = dirname( __FILE__ );
+			include $basePath . '/../config/config.php';
+			// include $basePath . '/../offline.php';
+			exit();
+		}
+		if (!($this->_resource = @mysql_connect( $host, $user, $pass ))) {
+			//or die( 'FATAL ERROR: Connection to database server failed.' );
+			$mosSystemError = 2;
+			$basePath = dirname( __FILE__ );
+			include $basePath . '/../config/config.php';
+			// include $basePath . '/../offline.php';
+			exit();
+		}
+		if (!mysql_select_db($db)) {
+			//or die( "FATAL ERROR: Database not found. Operation failed with error: ".mysql_error());
+			$mosSystemError = 3;
+			$basePath = dirname( __FILE__ );
+			include $basePath . '/../config/config.php';
+			// include $basePath . '/../offline.php';
+			exit();
+		}
+		$this->_table_prefix = $table_prefix;
+		$this->_ticker = 0;
+		$this->_log = array();
+	}
+	/**
+	* @param int
+	*/
+	function debug( $level ) {
+	    $this->_debug = intval( $level );
+	}
+	/**
+	* @return int The error number for the most recent query
+	*/
+	function getErrorNum() {
+		return $this->_errorNum;
+	}
+	/**
+	* @return string The error message for the most recent query
+	*/
+	function getErrorMsg() {
+		return str_replace( array( "\n", "'" ), array( '\n', "\'" ), $this->_errorMsg );
+	}
+	/**
+	* Get a database escaped string
+	* @return string
+	*/
+	function getEscaped( $text ) {
+		return mysql_escape_string( $text );
+	}
+	/**
+	* Get a quoted database escaped string
+	* @return string
+	*/
+	function Quote( $text ) {
+		return '\'' . mysql_escape_string( $text ) . '\'';
+	}
+	/**
+	* Sets the SQL query string for later execution.
+	*
+	* This function replaces a string identifier <var>$prefix</var> with the
+	* string held is the <var>_table_prefix</var> class variable.
+	*
+	* @param string The SQL query
+	* @param string The common table prefix
+	*/
+	function setQuery( $sql, $prefix='#__' ) {
+		$this->_sql = $this->replacePrefix($sql, $prefix);
+	}
+
+	/**
+	 * This function replaces a string identifier <var>$prefix</var> with the
+	 * string held is the <var>_table_prefix</var> class variable.
+	 *
+	 * @param string The SQL query
+	 * @param string The common table prefix
+	 * @author thede, David McKinnis
+	 */
+	function replacePrefix( $sql, $prefix='#__' ) {
+		$sql = trim( $sql );
+
+		$escaped = false;
+		$quoteChar = '';
+
+		$n = strlen( $sql );
+
+		$startPos = 0;
+		$literal = '';
+		while ($startPos < $n) {
+			$ip = strpos($sql, $prefix, $startPos);
+			if ($ip === false) {
+				break;
+			}
+
+			$j = strpos( $sql, "'", $startPos );
+			$k = strpos( $sql, '"', $startPos );
+			if (($k !== FALSE) && (($k < $j) || ($j === FALSE))) {
+				$quoteChar	= '"';
+				$j			= $k;
+			} else {
+				$quoteChar	= "'";
+			}
+
+			if ($j === false) {
+				$j = $n;
+			}
+
+			$literal .= str_replace( $prefix, $this->_table_prefix, substr( $sql, $startPos, $j - $startPos ) );
+			$startPos = $j;
+
+			$j = $startPos + 1;
+
+			if ($j >= $n) {
+				break;
+			}
+
+			// quote comes first, find end of quote
+			while (TRUE) {
+				$k = strpos( $sql, $quoteChar, $j );
+				$escaped = false;
+				if ($k === false) {
+					break;
+				}
+				$l = $k - 1;
+				while ($l >= 0 && $sql{$l} == '\\') {
+					$l--;
+					$escaped = !$escaped;
+				}
+				if ($escaped) {
+					$j	= $k+1;
+					continue;
+				}
+				break;
+			}
+			if ($k === FALSE) {
+				// error in the query - no end quote; ignore it
+				break;
+			}
+			$literal .= substr( $sql, $startPos, $k - $startPos + 1 );
+			$startPos = $k+1;
+		}
+		if ($startPos < $n) {
+			$literal .= substr( $sql, $startPos, $n - $startPos );
+		}
+		return $literal;
+	}
+	/**
+	* @return string The current value of the internal SQL vairable
+	*/
+	function getQuery() {
+		return "<pre>" . htmlspecialchars( $this->_sql ) . "</pre>";
+	}
+	/**
+	* Execute the query
+	* @return mixed A database resource if successful, FALSE if not.
+	*/
+	function query() {
+		global $mosConfig_debug;
+		if ($this->_debug) {
+			$this->_ticker++;
+	  		$this->_log[] = $this->_sql;
+		}
+		$this->_errorNum = 0;
+		$this->_errorMsg = '';
+		$this->_cursor = mysql_query( $this->_sql, $this->_resource );
+		if (!$this->_cursor) {
+			$this->_errorNum = mysql_errno( $this->_resource );
+			$this->_errorMsg = mysql_error( $this->_resource )." SQL=$this->_sql";
+			if ($this->_debug) {
+				trigger_error( mysql_error( $this->_resource ), E_USER_NOTICE );
+				//echo "<pre>" . $this->_sql . "</pre>\n";
+				if (function_exists( 'debug_backtrace' )) {
+					foreach( debug_backtrace() as $back) {
+					    if (@$back['file']) {
+						    echo '<br />'.$back['file'].':'.$back['line'];
+						}
+					}
+				}
+			}
+			return false;
+		}
+		return $this->_cursor;
+	}
+
+	function query_batch( $abort_on_error=true, $p_transaction_safe = false) {
+		$this->_errorNum = 0;
+		$this->_errorMsg = '';
+		if ($p_transaction_safe) {
+			$si = mysql_get_server_info();
+			preg_match_all( "/(\d+)\.(\d+)\.(\d+)/i", $si, $m );
+			if ($m[1] >= 4) {
+				$this->_sql = 'START TRANSACTION;' . $this->_sql . '; COMMIT;';
+			} else if ($m[2] >= 23 && $m[3] >= 19) {
+				$this->_sql = 'BEGIN WORK;' . $this->_sql . '; COMMIT;';
+			} else if ($m[2] >= 23 && $m[3] >= 17) {
+				$this->_sql = 'BEGIN;' . $this->_sql . '; COMMIT;';
+			}
+		}
+		$query_split = preg_split ("/[;]+/", $this->_sql);
+		$error = 0;
+		foreach ($query_split as $command_line) {
+			$command_line = trim( $command_line );
+			if ($command_line != '') {
+				$this->_cursor = mysql_query( $command_line, $this->_resource );
+				if (!$this->_cursor) {
+					$error = 1; echo 'xxx ';
+					$this->_errorNum .= mysql_errno( $this->_resource ) . ' ';
+					$this->_errorMsg .= mysql_error( $this->_resource )." SQL=$command_line <br />";
+					if ($abort_on_error) {
+						return $this->_cursor;
+					}
+				}
+			}
+		}
+		return $error ? false : true;
+	}
+
+	/**
+	* Diagnostic function
+	*/
+	function explain() {
+		$temp = $this->_sql;
+		$this->_sql = "EXPLAIN $this->_sql";
+		$this->query();
+
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$first = true;
+
+		$buf = "<table cellspacing=\"1\" cellpadding=\"2\" border=\"0\" bgcolor=\"#000000\" align=\"center\">";
+		$buf .= $this->getQuery();
+		while ($row = mysql_fetch_assoc( $cur )) {
+			if ($first) {
+				$buf .= "<tr>";
+				foreach ($row as $k=>$v) {
+					$buf .= "<th bgcolor=\"#ffffff\">$k</th>";
+				}
+				$buf .= "</tr>";
+				$first = false;
+			}
+			$buf .= "<tr>";
+			foreach ($row as $k=>$v) {
+				$buf .= "<td bgcolor=\"#ffffff\">$v</td>";
+			}
+			$buf .= "</tr>";
+		}
+		$buf .= "</table><br />&nbsp;";
+		mysql_free_result( $cur );
+
+		$this->_sql = $temp;
+
+		return "<div style=\"background-color:#FFFFCC\" align=\"left\">$buf</div>";
+	}
+	/**
+	* @return int The number of rows returned from the most recent query.
+	*/
+	function getNumRows( $cur=null ) {
+		return mysql_num_rows( $cur ? $cur : $this->_cursor );
+	}
+
+	/**
+	* This method loads the first field of the first row returned by the query.
+	*
+	* @return The value returned in the query or null if the query failed.
+	*/
+	function loadResult() {
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$ret = null;
+		if ($row = mysql_fetch_row( $cur )) {
+			$ret = $row[0];
+		}
+		mysql_free_result( $cur );
+		return $ret;
+	}
+	/**
+	* Load an array of single field results into an array
+	*/
+	function loadResultArray($numinarray = 0) {
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$array = array();
+		while ($row = mysql_fetch_row( $cur )) {
+			$array[] = $row[$numinarray];
+		}
+		mysql_free_result( $cur );
+		return $array;
+	}
+	/**
+	* Load a assoc list of database rows
+	* @param string The field name of a primary key
+	* @return array If <var>key</var> is empty as sequential list of returned records.
+	*/
+	function loadAssocList( $key='' ) {
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$array = array();
+		while ($row = mysql_fetch_assoc( $cur )) {
+			if ($key) {
+				$array[$row->$key] = $row;
+			} else {
+				$array[] = $row;
+			}
+		}
+		mysql_free_result( $cur );
+		return $array;
+	}
+	/**
+	* This global function loads the first row of a query into an object
+	*
+	* If an object is passed to this function, the returned row is bound to the existing elements of <var>object</var>.
+	* If <var>object</var> has a value of null, then all of the returned query fields returned in the object.
+	* @param string The SQL query
+	* @param object The address of variable
+	*/
+	function loadObject( &$object ) {
+		if ($object != null) {
+			if (!($cur = $this->query())) {
+				return false;
+			}
+			if ($array = mysql_fetch_assoc( $cur )) {
+				mysql_free_result( $cur );
+				mosBindArrayToObject( $array, $object, null, null, false );
+				return true;
+			} else {
+				return false;
+			}
+		} else {
+			if ($cur = $this->query()) {
+				if ($object = mysql_fetch_object( $cur )) {
+					mysql_free_result( $cur );
+					return true;
+				} else {
+					$object = null;
+					return false;
+				}
+			} else {
+				return false;
+			}
+		}
+	}
+	/**
+	* Load a list of database objects
+	* @param string The field name of a primary key
+	* @return array If <var>key</var> is empty as sequential list of returned records.
+	* If <var>key</var> is not empty then the returned array is indexed by the value
+	* the database key.  Returns <var>null</var> if the query fails.
+	*/
+	function loadObjectList( $key='' ) {
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$array = array();
+		while ($row = mysql_fetch_object( $cur )) {
+			if ($key) {
+				$array[$row->$key] = $row;
+			} else {
+				$array[] = $row;
+			}
+		}
+		mysql_free_result( $cur );
+		return $array;
+	}
+	/**
+	* @return The first row of the query.
+	*/
+	function loadRow() {
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$ret = null;
+		if ($row = mysql_fetch_row( $cur )) {
+			$ret = $row;
+		}
+		mysql_free_result( $cur );
+		return $ret;
+	}
+	/**
+	* Load a list of database rows (numeric column indexing)
+	* @param string The field name of a primary key
+	* @return array If <var>key</var> is empty as sequential list of returned records.
+	* If <var>key</var> is not empty then the returned array is indexed by the value
+	* the database key.  Returns <var>null</var> if the query fails.
+	*/
+	function loadRowList( $key='' ) {
+		if (!($cur = $this->query())) {
+			return null;
+		}
+		$array = array();
+		while ($row = mysql_fetch_array( $cur )) {
+			if ($key) {
+				$array[$row[$key]] = $row;
+			} else {
+				$array[] = $row;
+			}
+		}
+		mysql_free_result( $cur );
+		return $array;
+	}
+	/**
+	* Document::db_insertObject()
+	*
+	* { Description }
+	*
+	* @param [type] $keyName
+	* @param [type] $verbose
+	*/
+	function insertObject( $table, &$object, $keyName = NULL, $verbose=false ) {
+		$fmtsql = "INSERT INTO $table ( %s ) VALUES ( %s ) ";
+		$fields = array();
+		foreach (get_object_vars( $object ) as $k => $v) {
+			if (is_array($v) or is_object($v) or $v === NULL) {
+				continue;
+			}
+			if ($k[0] == '_') { // internal field
+				continue;
+			}
+			$fields[] = "`$k`";
+			$values[] = "'" . $this->getEscaped( $v ) . "'";
+		}
+		$this->setQuery( sprintf( $fmtsql, implode( ",", $fields ) ,  implode( ",", $values ) ) );
+		($verbose) && print "$sql<br />\n";
+		if (!$this->query()) {
+			return false;
+		}
+		$id = mysql_insert_id();
+		($verbose) && print "id=[$id]<br />\n";
+		if ($keyName && $id) {
+			$object->$keyName = $id;
+		}
+		return true;
+	}
+
+	/**
+	* Document::db_updateObject()
+	*
+	* { Description }
+	*
+	* @param [type] $updateNulls
+	*/
+	function updateObject( $table, &$object, $keyName, $updateNulls=true ) {
+		$fmtsql = "UPDATE $table SET %s WHERE %s";
+		$tmp = array();
+		foreach (get_object_vars( $object ) as $k => $v) {
+			if( is_array($v) or is_object($v) or $k[0] == '_' ) { // internal or NA field
+				continue;
+			}
+			if( $k == $keyName ) { // PK not to be updated
+				$where = "$keyName='" . $this->getEscaped( $v ) . "'";
+				continue;
+			}
+			if ($v === NULL && !$updateNulls) {
+				continue;
+			}
+			if( $v == '' ) {
+				$val = "''";
+			} else {
+				$val = "'" . $this->getEscaped( $v ) . "'";
+			}
+			$tmp[] = "`$k`=$val";
+		}
+		$this->setQuery( sprintf( $fmtsql, implode( ",", $tmp ) , $where ) );
+		return $this->query();
+	}
+
+	/**
+	* @param boolean If TRUE, displays the last SQL statement sent to the database
+	* @return string A standised error message
+	*/
+	function stderr( $showSQL = false ) {
+		return "DB function failed with error number $this->_errorNum"
+		."<br /><font color=\"red\">$this->_errorMsg</font>"
+		.($showSQL ? "<br />SQL = <pre>$this->_sql</pre>" : '');
+	}
+
+	function insertid()
+	{
+		return mysql_insert_id();
+	}
+
+	function getVersion()
+	{
+		return mysql_get_server_info();
+	}
+
+	/**
+	* Fudge method for ADOdb compatibility
+	*/
+	function GenID( $foo1=null, $foo2=null ) {
+		return '0';
+	}
+	/**
+	* @return array A list of all the tables in the database
+	*/
+	function getTableList() {
+		$this->setQuery( 'SHOW tables' );
+		$this->query();
+		return $this->loadResultArray();
+	}
+	/**
+	* @param array A list of table names
+	* @return array A list the create SQL for the tables
+	*/
+	function getTableCreate( $tables ) {
+		$result = array();
+
+		foreach ($tables as $tblval) {
+			$this->setQuery( 'SHOW CREATE table ' . $tblval );
+			$this->query();
+			$result[$tblval] = $this->loadResultArray( 1 );
+		}
+
+		return $result;
+	}
+	/**
+	* @param array A list of table names
+	* @return array An array of fields by table
+	*/
+	function getTableFields( $tables ) {
+		$result = array();
+
+		foreach ($tables as $tblval) {
+			$this->setQuery( 'SHOW FIELDS FROM ' . $tblval );
+			$this->query();
+			$fields = $this->loadObjectList();
+			foreach ($fields as $field) {
+				$result[$tblval][$field->Field] = preg_replace("/[(0-9)]/",'', $field->Type );
+			}
+		}
+
+		return $result;
+	}
+}
+
+/**
+* mosDBTable Abstract Class.
+* @abstract
+* @package PHP-Syslog-NG
+* @subpackage Database
+*
+* Parent classes to all database derived objects.  Customisation will generally
+* not involve tampering with this object.
+* @package PHP-Syslog-NG
+* @author Andrew Eddie <eddieajau@users.sourceforge.net
+*/
+class mosDBTable {
+	/** @var string Name of the table in the db schema relating to child class */
+	var $_tbl = '';
+	/** @var string Name of the primary key field in the table */
+	var $_tbl_key = '';
+	/** @var string Error message */
+	var $_error = '';
+	/** @var mosDatabase Database connector */
+	var $_db = null;
+
+	/**
+	*	Object constructor to set table and key field
+	*
+	*	Can be overloaded/supplemented by the child class
+	*	@param string $table name of the table in the db schema relating to child class
+	*	@param string $key name of the primary key field in the table
+	*/
+	function mosDBTable( $table, $key, &$db ) {
+		$this->_tbl = $table;
+		$this->_tbl_key = $key;
+		$this->_db =& $db;
+	}
+	/**
+	 * Filters public properties
+	 * @access protected
+	 * @param array List of fields to ignore
+	 */
+	function filter( $ignoreList=null ) {
+		$ignore = is_array( $ignoreList );
+
+		$iFilter = new InputFilter();
+		foreach ($this->getPublicProperties() as $k) {
+			if ($ignore && in_array( $k, $ignoreList ) ) {
+				continue;
+			}
+			$this->$k = $iFilter->process( $this->$k );
+		}
+	}
+	/**
+	 *	@return string Returns the error message
+	 */
+	function getError() {
+		return $this->_error;
+	}
+	/**
+	* Gets the value of the class variable
+	* @param string The name of the class variable
+	* @return mixed The value of the class var (or null if no var of that name exists)
+	*/
+	function get( $_property ) {
+		if(isset( $this->$_property )) {
+			return $this->$_property;
+		} else {
+			return null;
+		}
+	}
+	/**
+	 * Returns an array of public properties
+	 * @return array
+	 */
+	function getPublicProperties() {
+		static $cache = null;
+		if (is_null( $cache )) {
+			$cache = array();
+			foreach (get_class_vars( get_class( $this ) ) as $key=>$val) {
+				if (substr( $key, 0, 1 ) != '_') {
+					$cache[] = $key;
+				}
+			}
+		}
+		return $cache;
+	}
+	/**
+	* Set the value of the class variable
+	* @param string The name of the class variable
+	* @param mixed The value to assign to the variable
+	*/
+	function set( $_property, $_value ) {
+		$this->$_property = $_value;
+	}
+	/**
+	*	binds a named array/hash to this object
+	*
+	*	can be overloaded/supplemented by the child class
+	*	@param array $hash named array
+	*	@return null|string	null is operation was satisfactory, otherwise returns an error
+	*/
+	function bind( $array, $ignore="" ) {
+		if (!is_array( $array )) {
+			$this->_error = strtolower(get_class( $this ))."::bind failed.";
+			return false;
+		} else {
+			return mosBindArrayToObject( $array, $this, $ignore );
+		}
+	}
+
+	/**
+	*	binds an array/hash to this object
+	*	@param int $oid optional argument, if not specifed then the value of current key is used
+	*	@return any result from the database operation
+	*/
+	function load( $oid=null ) {
+		$k = $this->_tbl_key;
+		if ($oid !== null) {
+			$this->$k = $oid;
+		}
+		$oid = $this->$k;
+		if ($oid === null) {
+			return false;
+		}
+		$this->_db->setQuery( "SELECT * FROM $this->_tbl WHERE $this->_tbl_key='$oid'" );
+		return $this->_db->loadObject( $this );
+	}
+
+	/**
+	*	generic check method
+	*
+	*	can be overloaded/supplemented by the child class
+	*	@return boolean True if the object is ok
+	*/
+	function check() {
+		return true;
+	}
+
+	/**
+	* Inserts a new row if id is zero or updates an existing row in the database table
+	*
+	* Can be overloaded/supplemented by the child class
+	* @param boolean If false, null object variables are not updated
+	* @return null|string null if successful otherwise returns and error message
+	*/
+	function store( $updateNulls=false ) {
+		$k = $this->_tbl_key;
+		global $migrate;
+		if( $this->$k && !$migrate) {
+			$ret = $this->_db->updateObject( $this->_tbl, $this, $this->_tbl_key, $updateNulls );
+		} else {
+			$ret = $this->_db->insertObject( $this->_tbl, $this, $this->_tbl_key );
+		}
+		if( !$ret ) {
+			$this->_error = strtolower(get_class( $this ))."::store failed <br />" . $this->_db->getErrorMsg();
+			return false;
+		} else {
+			return true;
+		}
+	}
+	/**
+	*/
+	function move( $dirn, $where='' ) {
+		$k = $this->_tbl_key;
+
+		$sql = "SELECT $this->_tbl_key, ordering FROM $this->_tbl";
+
+		if ($dirn < 0) {
+			$sql .= "\nWHERE ordering < $this->ordering";
+			$sql .= ($where ? "\n	AND $where" : '');
+			$sql .= "\nORDER BY ordering DESC\nLIMIT 1";
+		} else if ($dirn > 0) {
+			$sql .= "\nWHERE ordering > $this->ordering";
+			$sql .= ($where ? "\n	AND $where" : '');
+			$sql .= "\nORDER BY ordering\nLIMIT 1";
+		} else {
+			$sql .= "\nWHERE ordering = $this->ordering";
+			$sql .= ($where ? "\n	AND $where" : '');
+			$sql .= "\nORDER BY ordering\nLIMIT 1";
+		}
+
+		$this->_db->setQuery( $sql );
+//echo 'A: ' . $this->_db->getQuery();
+
+
+		$row = null;
+		if ($this->_db->loadObject( $row )) {
+			$this->_db->setQuery( "UPDATE $this->_tbl SET ordering='$row->ordering'"
+			. "\nWHERE $this->_tbl_key='".$this->$k."'"
+			);
+
+			if (!$this->_db->query()) {
+			    $err = $this->_db->getErrorMsg();
+			    die( $err );
+			}
+//echo 'B: ' . $this->_db->getQuery();
+
+			$this->_db->setQuery( "UPDATE $this->_tbl SET ordering='$this->ordering'"
+			. "\nWHERE $this->_tbl_key='".$row->$k."'"
+			);
+//echo 'C: ' . $this->_db->getQuery();
+
+			if (!$this->_db->query()) {
+			    $err = $this->_db->getErrorMsg();
+			    die( $err );
+			}
+
+			$this->ordering = $row->ordering;
+		} else {
+			$this->_db->setQuery( "UPDATE $this->_tbl SET ordering='$this->ordering'"
+			. "\nWHERE $this->_tbl_key='".$this->$k."'"
+			);
+//echo 'D: ' . $this->_db->getQuery();
+
+
+			if (!$this->_db->query()) {
+			    $err = $this->_db->getErrorMsg();
+			    die( $err );
+			}
+		}
+	}
+	/**
+	* Compacts the ordering sequence of the selected records
+	* @param string Additional where query to limit ordering to a particular subset of records
+	*/
+	function updateOrder( $where='' ) {
+		$k = $this->_tbl_key;
+
+		if (!array_key_exists( 'ordering', get_class_vars( strtolower(get_class( $this )) ) )) {
+			$this->_error = "WARNING: ".strtolower(get_class( $this ))." does not support ordering.";
+			return false;
+		}
+
+		if ($this->_tbl == "#__content_frontpage") {
+			$order2 = ", content_id DESC";
+		} else {
+			$order2 = "";
+		}
+
+		$this->_db->setQuery( "SELECT $this->_tbl_key, ordering FROM $this->_tbl"
+		. ($where ? "\nWHERE $where" : '')
+		. "\nORDER BY ordering".$order2
+		);
+		if (!($orders = $this->_db->loadObjectList())) {
+			$this->_error = $this->_db->getErrorMsg();
+			return false;
+		}
+		// first pass, compact the ordering numbers
+		for ($i=0, $n=count( $orders ); $i < $n; $i++) {
+			if ($orders[$i]->ordering >= 0) {
+				$orders[$i]->ordering = $i+1;
+			}
+		}
+
+		$shift = 0;
+		$n=count( $orders );
+		for ($i=0; $i < $n; $i++) {
+			//echo "i=$i id=".$orders[$i]->$k." order=".$orders[$i]->ordering;
+			if ($orders[$i]->$k == $this->$k) {
+				// place 'this' record in the desired location
+				$orders[$i]->ordering = min( $this->ordering, $n );
+				$shift = 1;
+			} else if ($orders[$i]->ordering >= $this->ordering && $this->ordering > 0) {
+				$orders[$i]->ordering++;
+			}
+		}
+	//echo '<pre>';print_r($orders);echo '</pre>';
+		// compact once more until I can find a better algorithm
+		for ($i=0, $n=count( $orders ); $i < $n; $i++) {
+			if ($orders[$i]->ordering >= 0) {
+				$orders[$i]->ordering = $i+1;
+				$this->_db->setQuery( "UPDATE $this->_tbl"
+				. "\nSET ordering='".$orders[$i]->ordering."' WHERE $k='".$orders[$i]->$k."'"
+				);
+				$this->_db->query();
+	//echo '<br />'.$this->_db->getQuery();
+			}
+		}
+
+		// if we didn't reorder the current record, make it last
+		if ($shift == 0) {
+			$order = $n+1;
+			$this->_db->setQuery( "UPDATE $this->_tbl"
+			. "\nSET ordering='$order' WHERE $k='".$this->$k."'"
+			);
+			$this->_db->query();
+	//echo '<br />'.$this->_db->getQuery();
+		}
+		return true;
+	}
+	/**
+	*	Generic check for whether dependancies exist for this object in the db schema
+	*
+	*	can be overloaded/supplemented by the child class
+	*	@param string $msg Error message returned
+	*	@param int Optional key index
+	*	@param array Optional array to compiles standard joins: format [label=>'Label',name=>'table name',idfield=>'field',joinfield=>'field']
+	*	@return true|false
+	*/
+	function canDelete( $oid=null, $joins=null ) {
+		$k = $this->_tbl_key;
+		if ($oid) {
+			$this->$k = intval( $oid );
+		}
+		if (is_array( $joins )) {
+			$select = "$k";
+			$join = "";
+			foreach( $joins as $table ) {
+				$select .= ",\nCOUNT(DISTINCT {$table['idfield']}) AS {$table['idfield']}";
+				$join .= "\nLEFT JOIN {$table['name']} ON {$table['joinfield']} = $k";
+			}
+			$this->_db->setQuery( "SELECT $select\nFROM $this->_tbl\n$join\nWHERE $k = ".$this->$k." GROUP BY $k" );
+
+			if ($obj = $this->_db->loadObject()) {
+				$this->_error = $this->_db->getErrorMsg();
+				return false;
+			}
+			$msg = array();
+			foreach( $joins as $table ) {
+				$k = $table['idfield'];
+				if ($obj->$k) {
+					$msg[] = $AppUI->_( $table['label'] );
+				}
+			}
+
+			if (count( $msg )) {
+				$this->_error = "noDeleteRecord" . ": " . implode( ', ', $msg );
+				return false;
+			} else {
+				return true;
+			}
+		}
+
+		return true;
+	}
+
+	/**
+	*	Default delete method
+	*
+	*	can be overloaded/supplemented by the child class
+	*	@return true if successful otherwise returns and error message
+	*/
+	function delete( $oid=null ) {
+		//if (!$this->canDelete( $msg )) {
+		//	return $msg;
+		//}
+
+		$k = $this->_tbl_key;
+		if ($oid) {
+			$this->$k = intval( $oid );
+		}
+
+		$this->_db->setQuery( "DELETE FROM $this->_tbl WHERE $this->_tbl_key = '".$this->$k."'" );
+
+		if ($this->_db->query()) {
+			return true;
+		} else {
+			$this->_error = $this->_db->getErrorMsg();
+			return false;
+		}
+	}
+
+	function checkout( $who, $oid=null ) {
+		if (!array_key_exists( 'checked_out', get_class_vars( strtolower(get_class( $this )) ) )) {
+			$this->_error = "WARNING: ".strtolower(get_class( $this ))." does not support checkouts.";
+			return false;
+		}
+		$k = $this->_tbl_key;
+		if ($oid !== null) {
+			$this->$k = $oid;
+		}
+		$time = date( "%Y-%m-%d H:i:s" );
+		if (intval( $who )) {
+			// new way of storing editor, by id
+			$this->_db->setQuery( "UPDATE $this->_tbl"
+			. "\nSET checked_out='$who', checked_out_time='$time'"
+			. "\nWHERE $this->_tbl_key='".$this->$k."'"
+			);
+		} else {
+			// old way of storing editor, by name
+			$this->_db->setQuery( "UPDATE $this->_tbl"
+			. "\nSET checked_out='1', checked_out_time='$time', editor='".$who."' "
+			. "\nWHERE $this->_tbl_key='".$this->$k."'"
+			);
+		}
+		return $this->_db->query();
+	}
+
+	function checkin( $oid=null ) {
+		if (!array_key_exists( 'checked_out', get_class_vars( strtolower(get_class( $this )) ) )) {
+			$this->_error = "WARNING: ".strtolower(get_class( $this ))." does not support checkin.";
+			return false;
+		}
+		$k = $this->_tbl_key;
+		if ($oid !== null) {
+			$this->$k = $oid;
+		}
+		$time = date("H:i:s");
+		$this->_db->setQuery( "UPDATE $this->_tbl"
+		. "\nSET checked_out='0', checked_out_time='0000-00-00 00:00:00'"
+		. "\nWHERE $this->_tbl_key='".$this->$k."'"
+		);
+		return $this->_db->query();
+	}
+
+	function hit( $oid=null ) {
+		global $mosConfig_enable_log_items;
+
+		$k = $this->_tbl_key;
+		if ($oid !== null) {
+			$this->$k = intval( $oid );
+		}
+		$this->_db->setQuery( "UPDATE $this->_tbl SET hits=(hits+1) WHERE $this->_tbl_key='$this->id'" );
+		$this->_db->query();
+
+		if (@$mosConfig_enable_log_items) {
+			$now = date( "Y-m-d" );
+			$this->_db->setQuery( "SELECT hits"
+			. "\nFROM #__core_log_items"
+			. "\nWHERE time_stamp='$now' AND item_table='$this->_tbl' AND item_id='".$this->$k."'"
+			);
+			$hits = intval( $this->_db->loadResult() );
+			if ($hits) {
+				$this->_db->setQuery( "UPDATE #__core_log_items SET hits=(hits+1)"
+				. "\nWHERE time_stamp='$now' AND item_table='$this->_tbl' AND item_id='".$this->$k."'"
+				);
+				$this->_db->query();
+			} else {
+				$this->_db->setQuery( "INSERT INTO #__core_log_items VALUES"
+				. "\n('$now','$this->_tbl','".$this->$k."','1')"
+				);
+				$this->_db->query();
+			}
+		}
+	}
+
+	/**
+	* Generic save function
+	* @param array Source array for binding to class vars
+	* @param string Filter for the order updating
+	* @returns TRUE if completely successful, FALSE if partially or not succesful.
+	*/
+	function save( $source, $order_filter ) {
+		if (!$this->bind( $_POST )) {
+			return false;
+		}
+		if (!$this->check()) {
+			return false;
+		}
+		if (!$this->store()) {
+			return false;
+		}
+		if (!$this->checkin()) {
+			return false;
+		}
+		$filter_value = $this->$order_filter;
+		$this->updateOrder( $order_filter ? "`$order_filter`='$filter_value'" : "" );
+		$this->_error = '';
+		return true;
+	}
+
+	/**
+	* Generic Publish/Unpublish function
+	* @param array An array of id numbers
+	* @param integer 0 if unpublishing, 1 if publishing
+	* @param integer The id of the user performnig the operation
+	*/
+	function publish_array( $cid=null, $publish=1, $myid=0 ) {
+		if (!is_array( $cid ) || count( $cid ) < 1) {
+			$this->_error = "No items selected.";
+			return false;
+		}
+
+		$cids = implode( ',', $cid );
+
+		$this->_db->setQuery( "UPDATE $this->_tbl SET published='$publish'"
+		. "\nWHERE $this->_tbl_key IN ($cids) AND (checked_out=0 OR (checked_out='$myid'))"
+		);
+		if (!$this->_db->query()) {
+			$this->_error = $this->_db->getErrorMsg();
+			return false;
+		}
+
+		if (count( $cid ) == 1) {
+			$this->checkin( $cid[0] );
+		}
+		$this->_error = '';
+		return true;
+	}
+
+	/**
+	* Export item list to xml
+	* @param boolean Map foreign keys to text values
+	*/
+	function toXML( $mapKeysToText=false ) {
+		$xml = '<record table="' . $this->_tbl . '"';
+		if ($mapKeysToText) {
+			$xml .= ' mapkeystotext="true"';
+		}
+		$xml .= '>';
+		foreach (get_object_vars( $this ) as $k => $v) {
+			if (is_array($v) or is_object($v) or $v === NULL) {
+				continue;
+			}
+			if ($k[0] == '_') { // internal field
+				continue;
+			}
+			$xml .= '<' . $k . '><![CDATA[' . $v . ']]></' . $k . '>';
+		}
+		$xml .= '</record>';
+
+		return $xml;
+	}
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/form.php php-syslog-ng/html/includes/form.php
--- php-syslog-ng-2.9.f/html/includes/form.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/form.php	2008-02-03 22:39:33.000000000 -0500
@@ -0,0 +1,85 @@
+<?php 
+/**
+ * Form.php
+ *
+ * The Form class is meant to simplify the task of keeping
+ * track of errors in user submitted forms and the form
+ * field values that were entered correctly.
+ *
+ * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)
+ * Last Updated: August 19, 2004
+ */
+ 
+class Form
+{
+   var $values = array();  //Holds submitted form field values
+   var $errors = array();  //Holds submitted form error messages
+   var $num_errors;   //The number of errors in submitted form
+
+   /* Class constructor */
+   function Form(){
+      /**
+       * Get form value and error arrays, used when there
+       * is an error with a user-submitted form.
+       */
+      if(isset($_SESSION['value_array']) && isset($_SESSION['error_array'])){
+         $this->values = $_SESSION['value_array'];
+         $this->errors = $_SESSION['error_array'];
+         $this->num_errors = count($this->errors);
+
+         unset($_SESSION['value_array']);
+         unset($_SESSION['error_array']);
+      }
+      else{
+         $this->num_errors = 0;
+      }
+   }
+
+   /**
+    * setValue - Records the value typed into the given
+    * form field by the user.
+    */
+   function setValue($field, $value){
+      $this->values[$field] = $value;
+   }
+
+   /**
+    * setError - Records new form error given the form
+    * field name and the error message attached to it.
+    */
+   function setError($field, $errmsg){
+      $this->errors[$field] = $errmsg;
+      $this->num_errors = count($this->errors);
+   }
+
+   /**
+    * value - Returns the value attached to the given
+    * field, if none exists, the empty string is returned.
+    */
+   function value($field){
+      if(array_key_exists($field,$this->values)){
+         return htmlspecialchars(stripslashes($this->values[$field]));
+      }else{
+         return "";
+      }
+   }
+
+   /**
+    * error - Returns the error message attached to the
+    * given field, if none exists, the empty string is returned.
+    */
+   function error($field){
+      if(array_key_exists($field,$this->errors)){
+         return "<font size=\"2\" color=\"#ff0000\">".$this->errors[$field]."</font>";
+      }else{
+         return "";
+      }
+   }
+
+   /* getErrorArray - Returns the array of error messages */
+   function getErrorArray(){
+      return $this->errors;
+   }
+};
+ 
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/google-analytics.html php-syslog-ng/html/includes/google-analytics.html
--- php-syslog-ng-2.9.f/html/includes/google-analytics.html	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/google-analytics.html	2008-08-09 17:51:22.000000000 -0400
@@ -0,0 +1,7 @@
+<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
+</script>
+<script type="text/javascript">
+_uacct = "UA-1162837-1";
+urchinTracker();
+</script>
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/graphit.php php-syslog-ng/html/includes/graphit.php
--- php-syslog-ng-2.9.f/html/includes/graphit.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/graphit.php	2009-02-23 11:56:00.000000000 -0500
@@ -0,0 +1,624 @@
+<?php
+/*
+ * graphit.php
+ *
+ * Developed by Clayton Dukes <cdukes@cisco.com>
+ * Copyright (c) 2006 Cisco Systems, Inc.
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2006-07-11 - created
+ *
+ */
+
+/* $Platon$ */
+
+/* Modeline for ViM {{{
+ * vim: set ts=4:
+ * vim600: fdm=marker fdl=0 fdc=0:
+ * }}} */
+
+$basePath = dirname( __FILE__ );
+require_once($basePath . "/jpgraph/jpgraph.php");
+require_once($basePath . "/jpgraph/jpgraph_pie.php");
+require_once($basePath . "/jpgraph/jpgraph_pie3d.php");
+require_once($basePath . "/common_funcs.php");
+require_once($basePath . "/html_header.php");
+
+//========================================================================
+// BEGIN: GET THE INPUT VARIABLES
+//========================================================================
+$host = get_input('host');
+$host2 = get_input('host2');
+$excludeHost = get_input('excludeHost');
+$facility = get_input('facility');
+$excludeFacility = get_input('excludeFacility');
+$priority = get_input('priority');
+$excludePriority = get_input('excludePriority');
+$date = get_input('date');
+$date2 = get_input('date2');
+$time = get_input('time');
+$time2 = get_input('time2');
+$limit = get_input('limit');
+$topx = get_input('topx');
+$orderby = "host";
+$order = get_input('order');
+$offset = get_input('offset');
+if(!$offset) {
+	$offset = 0;
+}
+$collapse = get_input('collapse');
+$table = get_input('table');
+
+// Set an arbitrary number of msg# and ExcludeMsg# vars
+$msgvarnum=1;
+$msgvarname="msg".$msgvarnum;
+$excmsgvarname="ExcludeMsg".$msgvarnum;
+
+while(get_input($msgvarname)) {
+	${$msgvarname} = get_input($msgvarname);
+	${$excmsgvarname} = get_input($excmsgvarname);
+
+	$msgvarnum++;
+	$msgvarname="msg".$msgvarnum;
+	$excmsgvarname="ExcludeMsg".$msgvarnum;
+}
+//========================================================================
+// END: GET THE INPUT VARIABLES
+//========================================================================
+
+/* BEGIN: Added by BPK to save search form variables into the session. */
+$_SESSION['host'] = (isset($host)) ? $host : '';   
+$_SESSION['host2'] = (isset($host2)) ? $host2 : '';
+$_SESSION['excludeHost'] = (isset($excludeHost)) ? $excludeHost : '';
+$_SESSION['regexpHost'] = (isset($regexpHost)) ? $regexpHost : '';
+$_SESSION['program'] = (isset($program)) ? $program : '';   
+$_SESSION['program2'] = (isset($program2)) ? $program2 : '';
+$_SESSION['excludeProgram'] = (isset($excludeProgram)) ? $excludeProgram : '';
+$_SESSION['regexpProgram'] = (isset($regexpProgram)) ? $regexpProgram : '';
+$_SESSION['facility'] = (isset($facility)) ? $facility : '';
+$_SESSION['excludeFacility'] = (isset($excludeFacility)) ? $excludeFacility : '';
+$_SESSION['priority'] = (isset($priority)) ? $priority : '';
+$_SESSION['excludePriority'] = (isset($excludePriority)) ? $excludePriority : '';
+$_SESSION['date'] = (isset($date)) ? $date : '';   
+$_SESSION['date2'] = (isset($date2)) ? $date2 : '';
+$_SESSION['time'] = (isset($time)) ? $time : '';   
+$_SESSION['time2'] = (isset($time2)) ? $time2 : '';
+$_SESSION['limit'] = (isset($limit)) ? $limit : '';
+$_SESSION['orderby'] = (isset($orderby)) ? $orderby : '';
+$_SESSION['order'] = (isset($order)) ? $order : '';   
+$_SESSION['offset'] = (isset($offset)) ? $offset : '';
+$_SESSION['collapse'] = (isset($collapse)) ? $collapse : '';
+$_SESSION['table'] = (isset($table)) ? $table : '';
+$_SESSION['topx'] = (isset($topx)) ? $topx : '';
+for ($i=1; $i<=3; $i++) {
+        $_SESSION['msg'.$i] = (isset(${'msg'.$i})?${'msg'.$i}:'');
+        $_SESSION['ExcludeMsg'.$i] = (isset(${'ExcludeMsg'.$i})?${'ExcludeMsg'.$i}:'');
+        $_SESSION['RegExpMsg'.$i] = (isset(${'RegExpMsg'.$i})?${'RegExpMsg'.$i}:'');
+}
+/* END: Added by BPK to save search form variables info the session. */
+
+//========================================================================
+// BEGIN: INPUT VALIDATION
+//========================================================================
+$inputValError = array();
+
+if($excludeHost && !validate_input($excludeHost, 'excludeX')) {
+	array_push($inputValError, "excludeHost");
+}
+if($host && !validate_input($host, 'host')) {
+	array_push($inputValError, "host1");
+}
+if($host2 && !validate_input($host2, 'host')) {
+	array_push($inputValError, "host2");
+}
+if($excludeFacility && !validate_input($excludeFacility, 'excludeX')) {
+	array_push($inputValError, "excludeFacility");
+}
+if($facility && !validate_input($facility, 'facility')) {
+	array_push($inputValError, "facility");
+}
+if($excludePriority && !validate_input($excludePriority, 'excludeX')) {
+	array_push($inputValError, "excludePriority");
+}
+if($priority && !validate_input($priority, 'priority')) {
+	array_push($inputValError, "priority");
+}
+if($date && !validate_input($date, 'date')) {
+	array_push($inputValError, "date1");
+}
+if($date2 && !validate_input($date2, 'date')) {
+	array_push($inputValError, "date2");
+}
+if($time && !validate_input($time, 'time')) {
+	array_push($inputValError, "time1");
+}
+if($time2 && !validate_input($time2, 'time')) {
+	array_push($inputValError, "time2");
+}
+if($limit && !validate_input($limit, 'limit')) {
+	array_push($inputValError, "limit");
+}
+if($topx && !validate_input($topx, 'topx')) {
+	array_push($inputValError, "topx");
+}
+if($orderby && !validate_input($orderby, 'orderby')) {
+	array_push($inputValError, "orderby");
+}
+if($order && !validate_input($order, 'order')) {
+	array_push($inputValError, "order");
+}
+if(!validate_input($offset, 'offset')) {
+	array_push($inputValError, "offset");
+}
+if($collapse && !validate_input($collapse, 'collapse')) {
+	array_push($inputValError, "collapse");
+}
+if($table && !validate_input($table, 'table')) {
+	array_push($inputValError, "table");
+}
+
+if($inputValError) {
+	require_once ($basePath . "/html_header.php");
+	echo "Input validation error! The following fields had the wrong format:<p>";
+	foreach($inputValError as $value) {
+		echo $value."<br>";
+	}
+	require_once ($basePath . "/html_footer.php");
+	exit;
+}
+//========================================================================
+// END: INPUT VALIDATION
+//========================================================================
+
+//========================================================================
+// BEGIN: BUILD AND EXECUTE SQL STATEMENT
+// AND BUILD PARAMETER LIST FOR HTML GETS
+//========================================================================
+//------------------------------------------------------------------------
+// Create WHERE statement and GET parameter list
+//------------------------------------------------------------------------
+$where = "";
+$ParamsGET = "&";
+
+if($table) {
+	$ParamsGET=$ParamsGET."table=".$table."&";
+}
+
+if($limit) {
+	$ParamsGET=$ParamsGET."limit=".$limit."&";
+}
+
+if($topx) {
+	$ParamsGET=$ParamsGET."limit=".$topx."&";
+}
+
+if($orderby) {
+	$ParamsGET=$ParamsGET."orderby=".$orderby."&";
+}
+
+if($order) {
+	$ParamsGET=$ParamsGET."order=".$order."&";
+}
+
+if($collapse) {
+	$ParamsGET=$ParamsGET."collapse=".$collapse."&";
+}
+
+if($pageId) {
+	$ParamsGET=$ParamsGET."pageId=".$pageId."&";
+}
+
+if($host2) {
+	if ($where!="") {
+		$where=$where." and ";
+	}
+	if($excludeHost==1) {
+		$where = $where." host not like '%".$host2."%' ";
+	}
+	else {
+		$where = $where." host like '%".$host2."%' ";
+	}
+	$ParamsGET=$ParamsGET."host2=".$host2."&excludeHost=".$excludeHost."&";
+}
+
+if($host) {
+	$hostGET=implode("&host[]=",$host);
+	$hostSQL=implode("','",$host);
+	if($where!="") {
+		$where = $where." and ";
+	}
+	if($excludeHost==1) {
+		$where = $where." host not in ('".$hostSQL."') ";
+	}
+	else {
+		$where = $where." host in ('".$hostSQL."') ";
+	}
+	$ParamsGET=$ParamsGET."host[]=".$hostGET."&excludeHost=".$excludeHost."&";	
+}
+
+if($facility) {
+	$facilityGET=implode("&facility[]=",$facility);
+	$facilitySQL=implode("','",$facility);
+	if($where!="") {
+		$where = $where." and ";
+	}
+	if($excludeFacility==1) {
+		$where = $where." facility not in ('".$facilitySQL."') ";
+	}
+	else {
+		$where = $where." facility in ('".$facilitySQL."') ";
+	}
+	$ParamsGET=$ParamsGET."facility[]=".$facilityGET."&excludeFacility=".$excludeFacility."&";
+}
+
+if($priority) {
+	$priorityGET=implode("&priority[]=",$priority);
+	$prioritySQL=implode("','",$priority);
+	if($where!="") {
+		$where = $where." and ";
+	}
+	if($excludePriority==1) {
+		$where = $where." priority not in ('".$prioritySQL."') ";
+	}
+	else {
+		$where = $where." priority in ('".$prioritySQL."') ";
+	}
+	$ParamsGET=$ParamsGET."priority[]=".$priorityGET."&excludePriority=".$excludePriority."&";
+}
+
+$datetime = "";
+$datetime2 = "";
+
+if($date) {
+	$ParamsGET=$ParamsGET."date=".$date."&time=".$time."&";
+	if(strcasecmp($date, 'now') == 0 || strcasecmp($date, 'today') == 0) {
+		$date = date("Y-m-d");
+	}
+	elseif(strcasecmp($date, 'yesterday') == 0) {
+		$date = date("Y-m-d", mktime(0, 0, 0, date("m")  , date("d")-1, date("Y")));
+	}
+	if(!$time) {
+		$time = "00:00:00";
+	}
+	elseif(strcasecmp($time, 'now') == 0) {
+		$time = date("H:i:s");
+	}
+	$datetime = $date." ".$time ;
+}
+if($date2) {
+	$ParamsGET=$ParamsGET."date2=".$date2."&time2=".$time2."&";
+	if(strcasecmp($date2, 'now') == 0 || strcasecmp($date2, 'today') == 0) {
+		$date2 = date("Y-m-d");
+	}
+	elseif(strcasecmp($date2, 'yesterday') == 0) {
+		$date2 = date("Y-m-d", mktime(0, 0, 0, date("m")  , date("d")-1, date("Y")));
+	}
+	if(!$time2) {
+		$time2 = "23:59:59";
+	}
+	elseif(strcasecmp($time2, 'now') == 0) {
+		$time2 = date("H:i:s");
+	}
+	$datetime2 = $date2." ".$time2 ;
+}
+
+if($datetime && $datetime2) {
+	if($where != "") {
+		$where = $where." and ";
+	}
+	$where = $where." datetime between '".$datetime."' and '".$datetime2."' ";
+}
+elseif($datetime) {
+	if($where != "") {
+		$where = $where." and ";
+	}
+	$where = $where." datetime > '".$datetime."' ";
+}
+elseif($datetime2) {
+	if($where != "") {
+		$where = $where." and ";
+	}
+	$where = $where." datetime < '".$datetime2."' ";
+}
+
+$msgvarnum=1;
+$msgvarname="msg".$msgvarnum;
+$excmsgvarname="ExcludeMsg".$msgvarnum;
+
+while(isset(${$msgvarname})) {
+	if($where !="") {
+		$where = $where." and ";
+	}
+	if(${$excmsgvarname} == "on") {
+		$where = $where." msg not like '%".${$msgvarname}."%' ";
+		$ParamsGET=$ParamsGET.$excmsgvarname."=".${$excmsgvarname}."&";
+	}
+	else {
+		$where = $where." msg like '%".${$msgvarname}."%' ";
+	}
+	$ParamsGET=$ParamsGET.$msgvarname."=".${$msgvarname}."&";
+	$msgvarnum++;
+	$msgvarname="msg".$msgvarnum;
+	$excmsgvarname="ExcludeMsg".$msgvarnum;
+}
+
+//------------------------------------------------------------------------
+// Create the GET string without host variables
+//------------------------------------------------------------------------
+$pieces = explode("&", $ParamsGET);
+$hostParamsGET = "";
+foreach($pieces as $value) {
+	if(!strstr($value, "host[]=") && !strstr($value, 'excludeHost=') && !strstr($value, 'offset=') && $value) {
+		$hostParamsGET = $hostParamsGET.$value."&";
+	}
+}
+
+//------------------------------------------------------------------------
+// Create the complete SQL statement
+// SQL_CALC_FOUND_ROWS is a MySQL 4.0 feature that allows you to get the
+// total number of results if you had not used a LIMIT statement. Using
+// it saves an extra query to get the total number of rows.
+//------------------------------------------------------------------------
+if($table) {
+	$srcTable = $table;
+}
+else {
+	$srcTable = DEFAULTLOGTABLE;
+}
+// CDUKES: Jun 18, 2008: Added in support of the SQZ feature
+// CDUKES: Feb 23, 2009: Changed DEFAULTLOGTABLE to srcTable
+// Ref: http://groups.google.com/group/php-syslog-ng-dev/browse_thread/thread/e3bddab850f2ea0a/e834f8d983a7f339?lnk=gst&q=dfound#e834f8d983a7f339
+if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+   	$query = "SELECT host,SUM(counter) as count FROM ".$srcTable." ";
+} else {
+   	if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+	   	$query = "SELECT SQL_CALC_FOUND_ROWS host, count(host) as count FROM ".$srcTable." ";
+   	}
+   	else {
+	   	$query = "SELECT host, count(host) as count FROM ".$srcTable." ";
+   	}
+}
+
+if($where) {
+	$query = $query."WHERE ".$where." GROUP by host ORDER BY count DESC LIMIT " .$topx;
+}
+else {
+	$query = $query."GROUP by host ORDER BY count DESC LIMIT " .$topx;
+}
+
+//------------------------------------------------------------------------
+// Execute the query
+// The FOUND_ROWS function returns the value from the SQL_CALC_FOUND_ROWS
+// count.
+//------------------------------------------------------------------------
+ $results = perform_query($query, $dbLink);
+if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+	$num_results_array = perform_query("SELECT FOUND_ROWS()", $dbLink);
+	$num_results_array = fetch_array($num_results_array);
+	$num_results = $num_results_array[0];
+}
+
+//========================================================================
+// END: BUILD AND EXECUTE SQL STATEMENT
+// AND BUILD PARAMETER LIST FOR HTML GETS
+//========================================================================
+
+//========================================================================
+// BEGIN: PREPARE RESULT ARRAY
+//========================================================================
+//------------------------------------------------------------------------
+// Collapse consecutive identical messages into one line
+//------------------------------------------------------------------------
+/* 
+if($collapse == 1) {
+	$n = 0;
+	while($row = fetch_array($results)) {
+		if($row['msg'] == $result_array[$n-1]['msg'] 
+				&& $row['host'] == $result_array[$n-1]['host']) {
+			$result_array[$n-1]['count'] = $result_array[$n-1]['count'] + 1;
+			$n--;
+		}
+		else {
+			$row['count'] = 1;
+			$result_array[$n] = $row;
+		}
+		$n++;
+	}
+}
+else {
+	$n = 0;
+	while($row = fetch_array($results)) {
+		$row['count'] = 1;
+		$result_array[$n] = $row;
+		$n++;
+	}
+}	
+*/
+//========================================================================
+// END: PREPARE RESULT ARRAY
+//========================================================================
+
+//========================================================================
+// BEGIN: BUILDING THE HTML PAGE
+//========================================================================
+// Print result sub-header
+require_once 'includes/html_result_subheader.php';
+// If there is a result list then print it
+// if (count($result_array)){
+	// die(print_r($result_array));
+
+	//------------------------------------------------------------------------
+	// If the query returned some results then start the table with the
+	// results
+	//------------------------------------------------------------------------
+
+	?>
+		<table align="center">
+		<tr><td>
+		<?php
+		// Set up Graph variables
+		$slice = 0;
+	$type = "pie3d";
+	$mapName = 'Top10'; 
+	$fileName = IMG_CACHE_DIR . "Top10-" . time(3600) . ".png";
+
+	if ( $slice > 0 ) {
+		// include ("pageload.php");
+		$url = SITEURL . "$ParamsGET";
+		$mode = "JS";
+		// die ("$url -- $mode -- $host");
+		g_redirect($url,$mode);
+		die ("Error in redirect to graph"); // just in case g_redir fails or something weird
+	}
+
+	// $query="SELECT host, count(host) as count FROM " . DEFAULTLOGTABLE . " WHERE $where GROUP BY host ORDER BY count DESC LIMIT $limit";
+	// die($query);
+	$result = perform_query($query, $dbLink) or die (mysql_error());
+	$numrows = mysql_num_rows($result);
+	// echo "$numrows Rows\n<br>";
+
+	if ( $numrows < 1 ) { 
+	die ("<center>No results found.<br><a href=\"index.php?pageId=searchform\">BACK TO SEARCH</a></center>");
+	} else {
+		while ($row = mysql_fetch_assoc($result)) {
+			$count[]  = $row['count'];
+			// Use something like below to filter off domain names
+			// $host[]   = preg_replace("/\.tld.domain.*/", "", $row['host']);
+			$host[]   = $row['host'];
+		}
+	}
+
+// CDUKES: Jun 18, 2008: Added in support of the SQZ feature
+if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+   	$query = "SELECT SUM(counter) FROM ".DEFAULTLOGTABLE." ";
+		$result = perform_query($query, $dbLink) or die (mysql_error());
+		 $row = fetch_array($result);
+		$totalrows = commify($row[0]);
+		  // die ("Total COUNT rows: $totalrows");
+} else {
+	if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE && $num_results) {
+		$totalrows = commify(get_total_rows(DEFAULTLOGTABLE));
+		 // die ("Total COUNT rows:" . $totalrows);
+	} else {
+		// Get Total number of rows
+		$query="SELECT count(*) from " . DEFAULTLOGTABLE;
+		$result = perform_query($query, $dbLink) or die (mysql_error());
+		$numrows = mysql_num_rows($result);
+		$totalrows = commify($numrows);
+		// die ("Total rows: $query<br>" . $totalrows);
+	}
+}
+
+
+
+	// A new pie graph
+	$graph = new PieGraph(640,480,'auto');
+	$graph->SetShadow();
+
+	// Title setup
+	/* cdukes - 2-28-08: Added a test to notify the user if they selected more TopX than what was available in the database
+    Example: Selecting Top 100 when only 50 hosts are in the DB
+	 */
+   	$numhosts = (count($host)); 
+   	// die("Hostcount:$numhosts \nTopx: $topx\n");
+	if ($numhosts >= $topx) {
+	$graph->title->Set("Top $topx Hosts of " . $totalrows . " total messages");
+	} else {
+	$graph->title->Set("Top $numhosts Hosts of " . $totalrows . " total messages\n(Unable to get Top $topx, You only have $numhosts hosts in the database)");
+	$topx = $numhosts;
+	}
+	$graph->title->SetFont(FF_FONT1,FS_BOLD);
+
+	// Setup the pie plot
+	$p1 = new PiePlot3D($count);
+	$p1->SetLegends($host);
+
+	$targ = array();
+	//count number of hosts for pie slices
+	$array_count = count($host);
+	for($y=0; $y<$array_count; $y++) {
+		   if(isset($host[$y])) {
+				  array_push($targ, $_SERVER["PHP_SELF"] . "?pageId=Search&slice=1&table=$table&excludeHost=0&host2=&host%5B%5D=$host[$y]&excludeFacility=1&excludePriority=1&date=$date&time=&date2=$date2&time2=&limit=100&orderby=datetime&order=DESC&msg1=&msg2=&msg3=&collapse=1");
+				     }
+		      else { $array_count++; }
+	}
+// die(print_r($targ));
+
+	$p1->SetCSIMTargets($targ,$alts);
+
+	// Horizontal: 'left','right','center'
+	// Vertical: 'bottom','top','center' 
+	$graph->legend->SetAbsPos(10,20,'right','top');
+	// $graph->legend->Pos(0.5,0.5); 
+	// $graph->legend->SetColumns(2); 
+	$graph->legend->SetFont(FF_VERDANA,FS_NORMAL, 8);
+
+
+	// Adjust size and position of plot
+	$p1->SetSize(0.40);
+	$p1->SetCenter(0.39,0.6);
+
+	// Setup slice labels and move them into the plot
+	$p1->value->SetFont(FF_FONT1,FS_BOLD);
+	$p1->value->SetColor("darkred");
+	$p1->SetLabelPos(0.70);
+
+	// Set perM  > 1  below to enable per million labels
+	$perM = 0;
+	if ( $perM < 1 ) {
+		$p1->SetLabelType(PIE_VALUE_ABS);
+		$p1->value->SetFormat("%d");
+	} else {
+		$p1->SetLabelType(PIE_VALUE_PER); 
+		$p1->value->SetFormat(".%dM");
+	}
+	// Set percentage to enable per percent labels
+	$percentage = 1;
+	if ( $percentage > 0 ) {
+		$p1->SetLabelType(PIE_VALUE_ABS);
+		$p1->value->SetFormat("%d%%");
+		$p1->SetValueType(PIE_VALUE_PERCENTAGE);
+	}
+
+
+	// Set theme colors
+	// Options are "earth", "sand", "water" and doodoo, no, I mean "pastel" :-)
+	$p1->SetTheme("earth");
+
+	// Explode all slices
+	$p1->ExplodeAll($topx);
+
+	// Add drop shadow
+	$aColor = "darkgray";
+	$p1->SetShadow($aColor);
+
+	// Finally add the plot
+	$graph->Add($p1);
+
+	// ... and stroke it
+	// $graph->Stroke();
+	//$ih = $graph->Stroke(_IMG_HANDLE); 
+	// $graph->StrokeCSIM("$graph_name");
+
+	$graph->Stroke($fileName);
+
+	// $mapName = 'Top10'; 
+	$imgMap = $graph->GetHTMLImageMap($mapName);
+	// die("?offset=".$offset. "PPP" .$ParamsGET);
+	 echo "$imgMap <TD ALIGN=\"center\"><img src=\"$fileName\" alt=\"$mapName Graph - Click on slice to drill down\" ismap usemap=\"#$mapName\" border=\"0\"></TD></TR>";
+	require_once 'includes/html_footer.php';
+
+	//------------------------------------------------------------------------
+	// Else just direct the user back to the form
+	//------------------------------------------------------------------------
+/* } else {
+	echo "No results found.<br><a href=\"index.php?pageId=searchform\">BACK TO SEARCH</a>";
+}
+*/
+
+//========================================================================
+// END: BUILDING THE HTML PAGE
+//========================================================================
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/help.php php-syslog-ng/html/includes/help.php
--- php-syslog-ng-2.9.f/html/includes/help.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/help.php	2007-09-10 20:54:28.000000000 -0400
@@ -0,0 +1,114 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+
+require_once 'includes/html_header.php';
+
+if($dbProblem) {
+	echo "<b>A database connection problem was encountered.<br />Please check config/config.php to make sure everything is correct and make sure the MySQL server is up and running.</b>";
+}
+?>
+<table class="pagecontent">
+<tr><td><span class="longtext">
+<h3 class="title">User Manual</h3>
+<font color="blue">Click <a href="userguide.doc">here</a> to download the user guide.</font><br>
+<h3 class="title">Search</h3>
+Some of the input fields only affect the regular search result. Those fields are:<br>
+<ul>
+<li>DATE and TIME</li>
+<li>ORDER BY</li>
+<li>ORDER</li>
+</ul>
+The rest of the input fields affect both kinds of search results.<br />
+If you have more than one table with log data but you do not have a merge table then you have to select what table to work with before you can do anything else. If you have multiple tables and a merge table then the host and facility fields are populated using the merge table.<br />
+A blank date field indicates any date. And if a date is entered and no time is specified then 00:00:00 is used for the FROM time and 23:59:59 is used for the TO time. Entering a time without a date results in the time being ignored. 'now', 'today' and 'yesterday' are valid date inputs (now and today are the same) and 'now' is a valid time.
+
+<h3 class="title">Config</h3>
+The Config page lets you change your password. It is also the place where you add and delete users and edit the access control settings.
+
+<h3 class="title">Search results</h3>
+You can view the search results in two modes: regular or tail. In the regular view you are able to page through all the entries that match your query. In the tail view you will only see the number of entries you specified in the 'records per page' field but the page will keep refreshing so that you can monitor the logs in near real-time.<br />
+At the top there is a link to reference this paricular query. It can be useful to create bookmarks to queries you use often. The entries in the HOST column are links. If you click on one of those links then your query will be narrowed down to logs from that particular host.
+
+<h3 class="title">Installation</h3>
+<h4 class="title">Configure MySQL</h4>
+The quickest way to do this is to use the dbsetup.sql file in the scripts directory. Just edit the file and set some passwords for the three users that are created (replace PW_HERE). The script will create a table for logs and a table for user authentication and give the three users some sensible priviliges. If you make other changes like changing the name of the database or the name of the tables then make sure you edit config.php to reflect that. After editing the dbsetup.sql file then just run it like this:
+<p class="code">
+shell> mysql -uroot -p < dbsetup.sql
+</p>
+
+<h4 class="title">Configure syslog-ng</h4>
+Now you need to configure syslog-ng to send the desired log messages to a pipe that can be read to send the entries to MySQL. You will need to add two entries to the syslog-ng configuration file. The configuration file is usually in /etc/syslog-ng/syslog-ng.conf.<br />
+You first need to add a new 'destination' entry. Add something like this:
+<p class="code">
+destination d_mysql {<br />
+&nbsp;&nbsp;&nbsp;pipe("/var/log/mysql.pipe"<br />
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;template("INSERT INTO logs<br />
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(host, facility, priority, level, tag, datetime, program, msg)<br />
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUES ( '$HOST', '$FACILITY', '$PRIORITY', '$LEVEL', '$TAG', '$YEAR-$MONTH-$DAY $HOUR:$MIN:$SEC',<br />
+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'$PROGRAM', '$MSG' );\n") template-escape(yes));<br />
+};
+</p>
+That will take your log entries and format them into a SQL query that can be run to add it to the database.<br />
+You also need to add an entry that determines what log entries to forward to the FIFO pipe. You will usually want to forward everything to MySQL and there should already be a 'source' entry for that in your syslog-ng.conf file (usually called src or s_all). To tie that source to the destination you just created you will add something like this:
+<p class="code">
+log {<br />
+&nbsp;&nbsp;&nbsp;source(s_all);<br />
+&nbsp;&nbsp;&nbsp;destination(d_mysql);<br />
+};
+</p>
+
+<h4 class="title">Setup syslog-ng to MySQL pipe</h4>
+An example for a script that feeds log entries from the FIFO pipe to MySQL is included in the scripts directory. The script is called syslog2mysql.sh.
+<p class="code">
+#!/bin/bash<br />
+<br />
+if [ ! -e /var/log/mysql.pipe ]<br />
+then<br />
+&nbsp;&nbsp;&nbsp;mkfifo /var/log/mysql.pipe<br />
+fi<br />
+while [ -e /var/log/mysql.pipe ]<br />
+do<br />
+&nbsp;&nbsp;&nbsp;mysql -u syslogfeeder --password=PASS_HERE syslog < /var/log/mysql.pipe >/dev/null<br />
+done
+</p>
+If you decide to use this script then you have to replace PASS_HERE with the password for the syslogfeeder user. You will also probably want to have this script started automatically whenever you start the server. So add an entry in the inittab or start it through init.d (or whatever is appropriate on your system). But make sure you call it after MySQL has been started.<br />
+Now start the syslog2mysql.sh script:
+<p class="code">
+shell> ./syslog2mysql.sh &
+</p>
+or if you created an init.d script:
+<p class="code">
+shell> /etc/init.d/syslog2mysql start
+</p>
+It's finally time to restart the syslog-ng daemon and start sending your logs to the database:
+<p class="code">
+shell> /etc/init.d/syslog-ng restart
+</p>
+
+<h4 class="title">Edit config.php</h4>
+If you are using the default database setup from the dbsetup.sql file then all you need to do is to enter the passwords for the sysloguser and syslogadmin users, set the right host and port for the database server if it is not on the same server as the web server and set the correct URL. Otherwise read through the config.php file and configure things to suit your needs. All the different options are explained in the file.
+
+<h4 class="title">Securing php-syslog-ng</h4>
+It is recommended that you enable authentication in the config/config.php file. Leaving php-syslog-ng open to the public is not a good idea because some log entries might contain information that should not be shared. If you do not want to use the authentication in php-syslog-ng then you should consider using the authentication that is available in Apache.<br>
+Another thing which is strongly recommended is to deny access to the config, includes and scripts directories. Users accessing the files in those directories directly might be able to cause damage to your logs and/or gain access to things they should not have access to. Add something like this to the apache configuration file:
+<p class="code">
+&lt;Directory "/var/www/phpsyslogng/scripts"&gt;<br />
+&nbsp;&nbsp;&nbsp;&nbsp;Deny from all<br />
+&lt;/Directory&gt;<br />
+&lt;Directory "/var/www/phpsyslogng/includes"&gt;<br />
+&nbsp;&nbsp;&nbsp;&nbsp;Deny from all<br />
+&lt;/Directory&gt;<br />
+&lt;Directory "/var/www/phpsyslogng/config"&gt;<br />
+&nbsp;&nbsp;&nbsp;&nbsp;Deny from all<br />
+&lt;/Directory&gt;
+</p>
+<h4 class="title">Log rotation</h4>
+Log rotation should be part of most installations where you use php-syslog-ng. It is better to use log rotation than deleting rows in the main table because deleting rows can lead to performance problems. Rotating old logs out of the main table will also usually result in better performance because the tables with old logs are static and can be optimized. There is a logrotate.php script in the scripts directory. You may have to edit it to enter the correct path to your php-syslog-ng installation but after that it should be ready for use. If you enable merge tables in the config.php file then a merge table of all log tables will be created at the end of the script. The merge table will allow you to search across all tables instead of having to do searches against one table at a time. The merge table does equate to a slight performance hit on the search form because the fields are populated based on all tables instead of one particular table.<br />
+You can also specify enable the LOGRETENTION setting in config.php. If you enable this then logs older than this setting will be dropped whenever the logrotate.php is run.<br />
+If you decide to use the logrotate.php script then just add it to your crontab and have it run however frequent you want (max is currently one time per day).
+
+<h3 class="title">Other resources</h3>
+Check the following places for help:<br />
+- The sourceforge mailing list: <a href="http://sourceforge.net/mailarchive/forum.php?forum=php-syslog-ng-support">http://sourceforge.net/mailarchive/forum.php?forum=php-syslog-ng-support</a><br />
+- The Gentoo Linux Wiki: <a href="http://gentoo-wiki.com/HOWTO_setup_PHP-Syslog-NG">http://gentoo-wiki.com/HOWTO_setup_PHP-Syslog-NG</a>
+</span></td></tr></table>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/html_footer.php php-syslog-ng/html/includes/html_footer.php
--- php-syslog-ng-2.9.f/html/includes/html_footer.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/html_footer.php	2008-02-03 14:46:38.000000000 -0500
@@ -0,0 +1,24 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+
+//------------------------------------------------------------------------
+// Determine how long all this stuff took to generate.
+//------------------------------------------------------------------------
+$time_end = get_microtime();
+$exetime = $time_end - $time_start;
+
+// No need to show execution time if logging out...
+if(strcasecmp($pageId, "login") != 0) {
+echo "</center>\n<hr>";
+echo "<table><tr><td>";
+echo "<td class=\"rightfooter\">";
+echo "Executed in <b>".$exetime." seconds</b>";
+}
+echo "</td>";
+
+echo "</tr></table>";
+echo "</body></html>";
+//========================================================================
+// END: BUILDING THE HTML PAGE
+//========================================================================
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/html_header.php php-syslog-ng/html/includes/html_header.php
--- php-syslog-ng-2.9.f/html/includes/html_header.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/html_header.php	2008-03-22 11:05:04.000000000 -0400
@@ -0,0 +1,223 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (C) 2006 Clayton Dukes, cdukes@cdukes.com
+
+$basePath = dirname( __FILE__ );
+require_once ($basePath . "/common_funcs.php");
+
+?>
+<html>
+<head>
+<?php 
+// custom title for tail queries 
+// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=33
+// echo "<title>".PAGETITLE." ".VERSION.": ".$addTitle."</title>"; 
+echo "<title>".$addTitle.": ".PAGETITLE." ".VERSION."</title>"; 
+?>
+<link rel=stylesheet type=text/css href='css/default.css'>
+<link rel="icon" href="favicon.ico" type="image/x-icon" />
+<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
+<link rel="shortcut icon" href="favicon.ico" />
+<META HTTP-EQUIV='Pragma' CONTENT='no-cache'>
+ <!-- Begin Calendar -->
+ <script type="text/javascript" src="includes/cal/Bs_Misc.lib.js"></script>
+ <script type="text/javascript" src="includes/cal/Bs_Button.class.js"></script>
+ <script type="text/javascript" src="includes/cal/Bs_DatePicker.class.js"></script>
+ <script type="text/javascript" src="includes/cal/Bs_FormFieldSelect.class.js"></script>
+ <script type="text/javascript">
+ if (moz) {
+	 document.writeln("<link rel='stylesheet' href='css/win2k_mz.css'>");
+ } else {
+	 document.writeln("<link rel='stylesheet' href='css/win2k_ie.css'>");
+ }
+
+function fromdate() {
+	myDatePicker = new Bs_DatePicker();
+	myDatePicker.jsBaseDir = '/';
+	myDatePicker.toggleButton.imgPath = 'images/buttons/';
+	myDatePicker.fieldName                  = 'date';
+	myDatePicker.openByInit                 = true;
+	myDatePicker.dateFormat                 = 'ISO';
+	myDatePicker.useSpinEditForYear         = false;
+
+	myDatePicker.dateInputClassName         = 'datePickerDate';
+	myDatePicker.monthSelectClassName       = 'datePickerMonth';
+	myDatePicker.yearInputClassName         = 'datePickerYear';
+	myDatePicker.dayTableClassName          = 'datePickerTable';
+	myDatePicker.dayHeaderClassName         = 'datePickerDayHeader';
+	myDatePicker.dayClassName               = 'datePickerDay';
+	myDatePicker.dayClassNameByWeekday['7'] = 'datePickerDaySunday';
+	myDatePicker.dayTableAttributeString    = 'width="100%" border="1" cellspacing="0" cellpadding="0" bordercolor="white"';
+
+	myDatePicker.dayHeaderFontColor         = 'yellow';
+	myDatePicker.dayHeaderBgColor           = 'green';
+	myDatePicker.dayFontColor               = 'brown';
+	myDatePicker.dayBgColor                 = 'antiquewhite';
+	myDatePicker.dayFontColorActive         = 'red';
+	myDatePicker.dayBgColorActive           = 'white';
+	myDatePicker.dayTableBgColor            = 'silver';
+	myDatePicker.dayBgColorOver             = 'yellow';
+
+	myDatePicker.width                      = 115;
+	myDatePicker.daysNumChars               = 1;
+	myDatePicker.drawInto('myDatePickerDiv');
+}
+function todate() {
+	myDatePicker = new Bs_DatePicker();
+	myDatePicker.jsBaseDir = '/';
+	myDatePicker.toggleButton.imgPath = 'images/buttons/';
+	myDatePicker.fieldName                  = 'date2';
+	myDatePicker.openByInit                 = true;
+	myDatePicker.dateFormat                 = 'ISO';
+	myDatePicker.useSpinEditForYear         = false;
+
+	myDatePicker.dateInputClassName         = 'datePickerDate';
+	myDatePicker.monthSelectClassName       = 'datePickerMonth';
+	myDatePicker.yearInputClassName         = 'datePickerYear';
+	myDatePicker.dayTableClassName          = 'datePickerTable';
+	myDatePicker.dayHeaderClassName         = 'datePickerDayHeader';
+	myDatePicker.dayClassName               = 'datePickerDay';
+	myDatePicker.dayClassNameByWeekday['7'] = 'datePickerDaySunday';
+	myDatePicker.dayTableAttributeString    = 'width="100%" border="1" cellspacing="0" cellpadding="0" bordercolor="white"';
+
+	myDatePicker.dayHeaderFontColor         = 'yellow';
+	myDatePicker.dayHeaderBgColor           = 'green';
+	myDatePicker.dayFontColor               = 'brown';
+	myDatePicker.dayBgColor                 = 'antiquewhite';
+	myDatePicker.dayFontColorActive         = 'red';
+	myDatePicker.dayBgColorActive           = 'white';
+	myDatePicker.dayTableBgColor            = 'silver';
+	myDatePicker.dayBgColorOver             = 'yellow';
+
+	myDatePicker.width                      = 115;
+	myDatePicker.daysNumChars               = 1;
+	myDatePicker.drawInto('myDatePickerDivR');
+}
+</script>
+<!-- End Calendar -->
+<!-- Begin Overlib -->
+<script src="includes/js/overlib.js" language="Javascript" type="text/javascript"></script>
+<DIV id=overDiv	style="Z-INDEX: 1000; VISIBILITY: hidden; POSITION: absolute"></DIV>
+<!-- End Overlib -->
+
+<!-- Begin Google Code -->
+<?php
+if (is_file("includes/google-analytics.html")) {
+include "includes/google-analytics.html";
+}
+?>
+<!-- End Google Code -->
+
+</head>
+<body>
+<table class="header">
+<!-- cdukes - Removed below per request at http://code.google.com/p/php-syslog-ng/issues/detail?id=25
+<tr><td>
+	<a href="index.php"><h2 class="logo"><?php echo $version?></h2></a>
+	Network Syslog Monitor
+</td><td class="headerright">
+	<?php echo date("l F dS, Y - H:i:s"); ?><br>
+	Your IP: <?php echo $_SERVER['REMOTE_ADDR']; ?>
+</td></tr>
+-->
+</table>
+<table class="headerbottom"><tr><td>
+<?php
+if((secure() == $_SESSION["member_id"]) && (USE_ACL == 'TRUE' || USE_ACL == 'YES' ))  {
+	echo "<a class=\"vertmenu\" href=\"index.php?pageId=logout\">Logout</a>";
+	echo "<a class=\"vertmenu\" href=\"index.php?pageId=searchform\">Search</a>";
+	echo "<a class=\"vertmenu\" href=\"index.php?pageId=config\">Config</a>";
+   	echo "<a class=\"vertmenu\" href=\"index.php?pageId=help\">Help</a>\n";
+   	echo "<a class=\"vertmenu\" href=\"index.php?pageId=about\">About</a>\n";
+	// Begin Paypal Addition
+	if (PAYPAL_ENABLE == "YES") {
+   	echo "&nbsp;<td align=\"right\">";
+	?>
+		<!-- Begin Paypal link -->
+	<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
+		<input type="hidden" name="cmd" value="_donations">
+		<input type="hidden" name="business" value="cdukes@cdukes.com">
+		<input type="hidden" name="item_name" value="PHP-Syslog-NG">
+		<input type="hidden" name="no_shipping" value="0">
+		<input type="hidden" name="no_note" value="1">
+		<input type="hidden" name="currency_code" value="USD">
+		<input type="hidden" name="tax" value="0">
+		<input type="hidden" name="lc" value="US">
+		<input type="hidden" name="bn" value="PP-DonationsBF">
+		<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="Donate to a good cause :-)">
+		<div align="right">
+		The code you support today may<br>
+		turn out to be <a href="http://en.wikipedia.org/wiki/Skynet_%28Terminator%29">SkyNet</a> tomorrow...
+		</div>
+		<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
+		</form>
+		<!-- END Paypal link -->
+		<?php
+	}
+	// End Paypal Addition
+   	echo "&nbsp;</td></tr>";
+   	echo "</table><center>\n";
+
+// cdukes - Added below for non ACL systems (open access)
+} elseif(!defined('USE_ACL') || !USE_ACL || !defined('REQUIRE_AUTH') || !REQUIRE_AUTH) {
+	echo "<a class=\"vertmenu\" href=\"index.php?pageId=searchform\">Search</a>";
+   	echo "<a class=\"vertmenu\" href=\"index.php?pageId=help\">Help</a>\n";
+   	echo "<a class=\"vertmenu\" href=\"index.php?pageId=about\">About</a>\n";
+	// Begin Paypal Addition
+	if (PAYPAL_ENABLE == "YES") {
+   	echo "&nbsp;<td align=\"right\">";
+	?>
+		<!-- Begin Paypal link -->
+	<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
+		<input type="hidden" name="cmd" value="_donations">
+		<input type="hidden" name="business" value="cdukes@cdukes.com">
+		<input type="hidden" name="item_name" value="PHP-Syslog-NG">
+		<input type="hidden" name="no_shipping" value="0">
+		<input type="hidden" name="no_note" value="1">
+		<input type="hidden" name="currency_code" value="USD">
+		<input type="hidden" name="tax" value="0">
+		<input type="hidden" name="lc" value="US">
+		<input type="hidden" name="bn" value="PP-DonationsBF">
+		<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="Donate to a good cause :-)">
+		<div align="right">
+		Every time you donate...<br>
+		God decides not to kill a kitten :-)
+		</div>
+		<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
+		</form>
+		<!-- END Paypal link -->
+		<?php
+	}
+	// End Paypal Addition
+   	echo "&nbsp;</td></tr>";
+   	echo "</table><center>\n";
+
+} else { // basic user (using authentication, but not logged in)
+	echo "<a class=\"vertmenu\" href=\"index.php?pageId=login\">Login</a>";
+   	echo "<a class=\"vertmenu\" href=\"index.php?pageId=help\">Help</a>\n";
+   	echo "<a class=\"vertmenu\" href=\"index.php?pageId=about\">About</a>\n";
+	// Begin Paypal Addition
+	if (PAYPAL_ENABLE == "YES") {
+   	echo "&nbsp;<td align=\"right\">";
+	?>
+		<!-- Begin Paypal link -->
+	<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
+		<input type="hidden" name="cmd" value="_donations">
+		<input type="hidden" name="business" value="cdukes@cdukes.com">
+		<input type="hidden" name="item_name" value="PHP-Syslog-NG">
+		<input type="hidden" name="no_shipping" value="0">
+		<input type="hidden" name="no_note" value="1">
+		<input type="hidden" name="currency_code" value="USD">
+		<input type="hidden" name="tax" value="0">
+		<input type="hidden" name="lc" value="US">
+		<input type="hidden" name="bn" value="PP-DonationsBF">
+		<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="Donate to a good cause :-)">
+		<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
+		</form>
+		<!-- END Paypal link -->
+		<?php
+	}
+	// End Paypal Addition
+   	echo "&nbsp;</td></tr></table><center>\n";
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/html_result_subheader.php php-syslog-ng/html/includes/html_result_subheader.php
--- php-syslog-ng-2.9.f/html/includes/html_result_subheader.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/html_result_subheader.php	2008-05-13 18:12:26.000000000 -0400
@@ -0,0 +1,61 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+?>
+<table>
+<!-- cdukes - removed below to make things easier to read -->
+<!-- http://code.google.com/p/php-syslog-ng/issues/detail?id=25 -->
+<!--
+<tr><td><center>
+<i>Use this link to reference this query directly: </i>
+<a href="<?php echo $_SERVER["PHP_SELF"]."?offset=".$offset.$ParamsGET; ?>">QUERY</a><br>
+</center></td></tr></table>
+-->
+<table>
+<tr><td>
+<a href="index.php?pageId=searchform">BACK TO SEARCH</a><br>
+<?php
+/* cdukes - 2-28-08: Added !stristr($_SERVER[REQUEST_URI],"graph") below so that people didn't get confused by the results
+   displayed on a Top 10 search (since below would show TOTAL results, not selected results, ie. Selected = 10 for Top 10)
+   */
+if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE && $num_results && !stristr($_SERVER[REQUEST_URI],"graph")) {
+        echo "<i>Number of Entries Found</i>: <b>".commify($num_results)."</b>";
+}
+?>
+</td><td>
+<div class="sevlegend">
+SEVERITY LEGEND<br>
+<?php	/*<table>
+	<tr>
+	<td class="sev0">DEBUG</td>
+	<td class="sev1">INFO</td>
+	<td class="sev2">NOTICE</td>
+	<td class="sev3">WARNING</td>
+	<td class="sev4">ERROR</td>
+	<td class="sev5">CRIT</td>
+	<td class="sev6">ALERT</td>
+	<td class="sev7">EMERG</td>
+	</tr></table> */
+?>
+	<span class="sev0">DEBUG</span>
+	<span class="sev1">INFO</span>
+	<span class="sev2">NOTICE</span>
+	<span class="sev3">WARNING</span>
+	<span class="sev4">ERROR</span>
+	<span class="sev5">CRIT</span>
+	<span class="sev6">ALERT</span>
+	<span class="sev7">EMERG</span>
+</div>
+</td></tr></table>
+<!-- cdukes - removed below to make things easier to read -->
+<!-- http://code.google.com/p/php-syslog-ng/issues/detail?id=25 -->
+<?php
+if(defined('DEBUG') && DEBUG == TRUE) {
+   	?>
+	   	<table class="query">
+	   	<tr><td >
+	   	The SQL query:
+	   	<input type=text size=85 value="<?php echo $query; ?>">
+	   	<?php
+} 
+?>
+</td></tr></table>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/CHANGELOG php-syslog-ng/html/includes/jpgraph/CHANGELOG
--- php-syslog-ng-2.9.f/html/includes/jpgraph/CHANGELOG	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/CHANGELOG	2006-02-18 02:57:30.000000000 -0500
@@ -0,0 +1,1224 @@
+r554: 2006-02-18 07:45  ljp
+
+	* Bumped version string to 1.20.3
+	Modified files: jpgraph.php
+
+r552: 2006-02-18 07:37  ljp
+
+	* Moved table examples to its own directory
+	Modified files: Examples/combgraphex1.php, Examples/tableex00.php,
+	  Examples/tableex01.php, Examples/tableex02.php,
+	  Examples/tableex03.php, table_examples,
+	  table_examples/tablebarex1.php, table_examples/tableex00.php,
+	  table_examples/tableex01.php, table_examples/tableex02.php,
+	  table_examples/tableex03.php, table_examples/tableex04.php,
+	  table_examples/tableex05.php
+
+r549: 2006-02-18 07:31  ljp
+
+	* Added some more test cases
+	Modified files: tests/test_0bar.php, tests/test_accbartable.php,
+	  tests/test_accbartable_csim.php, tests/test_barlinecenter.php,
+	  tests/test_dateinty2.php, tests/test_flag.php,
+	  tests/test_linefillnull.php, tests/test_linelargeval.php,
+	  tests/test_linesimple.php, tests/test_linetable.php,
+	  tests/test_php5date.php, tests/test_radaraxistitle.php,
+	  tests/test_table1.php, tests/test_table2.php,
+	  tests/test_table3.php, tests/test_table_flagex1.php,
+	  tests/test_table_howto1.php, tests/test_table_howto2.php,
+	  tests/test_table_howto3.php, tests/test_table_howto4.php,
+	  tests/test_table_howto5.php, tests/test_table_howto6.php,
+	  tests/test_table_howto7.php, tests/test_table_howto8.php,
+	  tests/test_table_howto9.php, tests/test_table_iconex1.php,
+	  tests/test_table_mex0.php, tests/test_table_mex00.php,
+	  tests/test_table_mex1.php, tests/test_table_mex2.php,
+	  tests/test_table_mex3.php, tests/test_y2grouobar.php,
+	  tests/test_y2groupbar.php, tests/test_y2synch.php,
+	  tests/test_y2synch2.php
+
+r543: 2006-02-14 20:10  ljp
+
+	* FS#308 - Make JpGraph classes extendable by using is_a() instead of get_class()
+	Modified files: jpgraph_gantt.php
+
+r542: 2006-02-14 20:10  ljp
+
+	* FS#308 - Make JpGraph classes extendable by using is_a() instead of get_class()
+	Modified files: jpgraph.php, jpgraph_bar.php, jpgraph_pie.php,
+	  jpgraph_windrose.php
+
+r540: 2006-02-14 17:27  ljp
+
+	* Some minor code layout changes
+	Modified files: jpgraph_table.php
+
+r538: 2006-02-14 06:51  ljp
+
+	* Added error check for number of data points in each in AccBar
+	Modified files: jpgraph_bar.php, lang/en.inc.php
+
+r536: 2006-02-13 06:42  ljp
+
+	* Removed HTML formatting in error message
+	Modified files: lang/en.inc.php
+
+r534: 2006-02-12 08:56  ljp
+
+	* Added new error message for GTextTable constrains
+	Modified files: lang/en.inc.php
+
+r532: 2006-02-12 08:27  ljp
+
+	* Added SetScalePos(), SetAnchorPos() and CSIM capabilities to tables
+	Modified files: jpgraph.php, jpgraph_table.php
+
+r531: 2006-02-11 10:32  ljp
+
+	* Fixed buffer overflow for long lines, prper mysql escaping of strings
+	Modified files: utils/jpdocgen/de_utils.php,
+	  utils/jpdocgen/jpgendb.php, utils/jpdocgen/jplintphp.php
+
+r529: 2006-02-11 08:33  ljp
+
+	* Updated table image API to follow the table setting pattern
+	Modified files: jpgraph_table.php
+
+r527: 2006-02-11 08:07  ljp
+
+	* Added possibility to use current scale to position GTextTable
+	Modified files: jpgraph_table.php
+
+r525: 2006-02-09 16:34  ljp
+
+	* Make sure padding API follow the general API design for GTextTable
+	Modified files: jpgraph_table.php
+
+r523: 2006-02-08 21:29  ljp
+
+	* Height and width calculation whould use max of value and image for table cell size
+	Modified files: jpgraph_table.php
+
+r521: 2006-02-08 21:22  ljp
+
+	* Added background images in individual cells for GTextTable
+	Modified files: jpgraph_iconplot.php, jpgraph_table.php
+
+r519: 2006-02-06 06:21  ljp
+
+	* Some more error checking for GTextTable and generalization of the SetNumberFormat() method to follow the practice of range setting
+	Modified files: jpgraph_table.php, lang/en.inc.php
+
+r517: 2006-02-05 20:48  ljp
+
+	* Added additional error check and default values for Tables
+	Modified files: jpgraph_table.php, lang/en.inc.php
+
+r515: 2006-02-05 16:46  ljp
+
+	* Update GTextTable SetAlign with new error message. Added check for invalid error message index.
+	Modified files: jpgraph.php, jpgraph_table.php, lang/en.inc.php
+
+r514: 2006-02-05 10:00  ljp
+
+	* Updated table example
+	Modified files: Examples/tableex03.php
+
+r512: 2006-02-05 09:53  ljp
+
+	* Make sure comparison is type safe for handling of parameterized error messages
+	Modified files: jpgraph.php
+
+r510: 2006-02-05 09:48  ljp
+
+	* Updated localized error messages for table
+	Modified files: lang/en.inc.php
+
+r509: 2006-02-05 09:44  ljp
+
+	* Added NumberFormat option for table formatting,
+	Modified files: jpgraph_table.php
+
+r505: 2006-02-04 15:53  ljp
+
+	* Directory cleanup
+	Modified files: tests/.xvpics
+
+r504: 2006-02-04 15:51  ljp
+
+	* Propset Id
+	Modified files: jpgraph_mgraph.php, jpgraph_pdf417.php,
+	  jpgraph_table.php, jpgraph_utils.inc, pdf417_backends.inc,
+	  pdf417_clusters.inc, pdf417_compressors.inc, pdf417_error.inc
+
+r503: 2006-02-04 12:46  ljp
+
+	* Removed extra exit()
+	Modified files: jpgraph.php
+
+r501: 2006-02-04 12:45  ljp
+
+	* Localized jpgraph_gradient
+	Modified files: jpgraph_gradient.php
+
+r499: 2006-02-04 12:44  ljp
+
+	* Localized Linear Barcode error messages
+	Modified files: jpgraph_barcode.php
+
+r497: 2006-02-04 12:33  ljp
+
+	* Localized PDF417
+	Modified files: jpgraph_pdf417.php, pdf417_backends.inc,
+	  pdf417_clusters.inc, pdf417_compressors.inc, pdf417_error.inc
+
+r495: 2006-02-04 12:31  ljp
+
+	* Localized error messages in jpgraph_utils.php
+	Modified files: jpgraph_utils.inc
+
+r493: 2006-02-04 12:29  ljp
+
+	* Localized error messages in jpgraph_stock.php
+	Modified files: jpgraph_stock.php
+
+r491: 2006-02-04 12:28  ljp
+
+	* Localized error messages in jpgraph_scatter.php
+	Modified files: jpgraph_scatter.php
+
+r489: 2006-02-04 12:26  ljp
+
+	* Localized error messages in jpgraph_radar.php
+	Modified files: jpgraph_radar.php
+
+r487: 2006-02-04 12:25  ljp
+
+	* Localized error messages in jpgraph_polar.php
+	Modified files: jpgraph_polar.php
+
+r485: 2006-02-04 12:20  ljp
+
+	* Localized error messages in jpgraph_plotmark.inc
+	Modified files: jpgraph_plotmark.inc
+
+r483: 2006-02-04 12:19  ljp
+
+	* Localized error messages in jpgraph_plotband.php
+	Modified files: jpgraph_plotband.php
+
+r481: 2006-02-04 12:18  ljp
+
+	* Localized error messages in jpgraph_mgraph.php
+	Modified files: jpgraph_mgraph.php
+
+r479: 2006-02-04 12:17  ljp
+
+	* Localized error messages in jpgraph_log.php
+	Modified files: jpgraph_log.php
+
+r477: 2006-02-04 12:16  ljp
+
+	* Localized error messages in jpgraph_imgtrans.php
+	Modified files: jpgraph_imgtrans.php
+
+r475: 2006-02-04 12:15  ljp
+
+	* Localized error messages in jpgraph_iconplot.php
+	Modified files: jpgraph_iconplot.php
+
+r473: 2006-02-04 12:14  ljp
+
+	* Localized error messages in jpgraph_gantt.php
+	Modified files: jpgraph_gantt.php
+
+r471: 2006-02-04 12:12  ljp
+
+	* Localized error messages in jpgraph_flags.php
+	Modified files: jpgraph_flags.php
+
+r469: 2006-02-04 12:11  ljp
+
+	* Localized error messages in jpgraph_date.php
+	Modified files: jpgraph_date.php
+
+r467: 2006-02-04 12:10  ljp
+
+	* Localized error messages in jpgraph_windrose.php
+	Modified files: jpgraph_windrose.php
+
+r465: 2006-02-04 12:09  ljp
+
+	* Localized error messages in jpgraph_odo.php
+	Modified files: jpgraph_odo.php
+
+r463: 2006-02-04 12:07  ljp
+
+	* Localized error messages in jpgraph_regstat.php
+	Modified files: jpgraph_regstat.php
+
+r461: 2006-02-04 12:06  ljp
+
+	* Localized error messages in jpgraph_error.php
+	Modified files: jpgraph_error.php
+
+r459: 2006-02-04 12:05  ljp
+
+	* Localized error messages in jpgraph_pie3d.php
+	Modified files: jpgraph_pie3d.php
+
+r457: 2006-02-04 12:04  ljp
+
+	* Localized error messages in jpgraph_pie.php
+	Modified files: jpgraph_pie.php
+
+r455: 2006-02-04 12:01  ljp
+
+	* Localized error messages in main jpgraph_line.php
+	Modified files: jpgraph_line.php
+
+r453: 2006-02-04 11:40  ljp
+
+	* Localized error messages in main jpgraph.php
+	Modified files: jpgraph.php
+
+r451: 2006-02-04 11:31  ljp
+
+	* Further english resource file update
+	Modified files: lang/en.inc.php
+
+r450: 2006-02-04 10:06  ljp
+
+	* Added localized error messages to jpgraph_bar.php
+	Modified files: jpgraph_bar.php
+
+r448: 2006-02-04 10:03  ljp
+
+	* Updated english resource file
+	Modified files: lang/en.inc.php
+
+r447: 2006-02-04 10:03  ljp
+
+	* Added localized error messages to jpgraph_table.php
+	Modified files: jpgraph_table.php
+
+r445: 2006-02-04 09:29  ljp
+
+	* Removed backup versions of english language resource files
+	Modified files: lang/en.inc.php.backup, lang/en.inc.php.backup2
+
+r444: 2006-02-04 09:28  ljp
+
+	* Added language resource files
+	Modified files: lang, lang/en.inc.php, lang/en.inc.php.backup,
+	  lang/en.inc.php.backup2
+
+r442: 2006-02-02 18:03  ljp
+
+	* Added align arguments for Merge() methods
+	Modified files: jpgraph_table.php
+
+r440: 2006-02-02 06:35  ljp
+
+	* Added error checking when merging table cells
+	Modified files: jpgraph_table.php
+
+r439: 2006-01-30 22:35  ljp
+
+	* Fix spelling error in error message
+	Modified files: jpgraph.php
+
+r437: 2006-01-30 21:52  ljp
+
+	* API restructuring in the GTextTable to make it easier to use ranges
+	Modified files: jpgraph_table.php
+
+r436: 2006-01-29 21:36  ljp
+
+	* Added examples on the use of GTextTable
+	Modified files: Examples/tableex00.php, Examples/tableex01.php,
+	  Examples/tableex02.php, Examples/tableex03.php
+
+r435: 2006-01-29 21:26  ljp
+
+	* PR#306 - Icons are not added as references
+	Modified files: jpgraph.php
+
+r433: 2006-01-29 20:42  ljp
+
+	* Fixed typos and a problem with the width calculation of merged cells
+	Modified files: jpgraph_table.php
+
+r431: 2006-01-29 19:17  ljp
+
+	* Adjusted vertical position calculation to avoid issue with baselining of TTF fonts
+	Modified files: jpgraph_table.php
+
+r429: 2006-01-29 16:10  ljp
+
+	* Added API in table handling so that all major settings now has the same structure, entire table, specific row, specific column or specific cell
+	Modified files: jpgraph_table.php
+
+r427: 2006-01-29 12:26  ljp
+
+	* GTextTable: Added API for table row and column font color setting
+	Modified files: jpgraph_table.php
+
+r425: 2006-01-29 09:10  ljp
+
+	* Major ovehaul of GTextTable. Added possibility to merge cells, Added range error check for all methods, Major refactoring of grid line drawing for tables (this is now the responsibility of the individual cells)
+	Modified files: jpgraph_table.php
+
+r422: 2006-01-26 21:45  ljp
+
+	* Changed column width/height handling so that the specification is interpretated as a min height/width
+	Modified files: jpgraph_table.php
+
+r420: 2006-01-26 21:22  ljp
+
+	* Added possibility to use different grid styles on graphic tables
+	Modified files: jpgraph_table.php
+
+r418: 2006-01-26 07:44  ljp
+
+	* CR#160 - Data tables on the graphs. Added jpgraph_table.php that implements GTextTable class that will allow text tables to be created as graphical objects and added to teh graphs. The tables have basic formatting capabilities as well as auto-sizing depending on the data in each cell.
+	Modified files: jpgraph.php, jpgraph_canvas.php,
+	  jpgraph_table.php, tests/test_flag.php, tests/test_ttf.php
+
+r404: 2006-01-21 17:34  ljp
+
+	* Adjust date format to comply with newer versions of PHP
+	Modified files: Examples/gantthourex1.php,
+	  Examples/gantthourminex1.php
+
+r397: 2006-01-18 19:06  ljp
+
+	* Fix PR#304 - Flag index for Replublic of Peru missing
+	Modified files: jpgraph_flags.php
+
+r396: 2006-01-18 18:42  ljp
+
+	* Fix PR#303 - E_STRICT not available in PHP4
+	Modified files: jpgraph.php
+
+r391: 2006-01-15 20:25  ljp
+
+	* Small modification to error checking when streaming image to a file
+	Modified files: jpgraph.php
+
+r390: 2006-01-15 20:24  ljp
+
+	* Removed a number of backup files that was acidentely comitted
+	Modified files: tests/data.csv~, tests/test_automin.php~,
+	  tests/test_barcode128.php~, tests/test_bargrad.php~,
+	  tests/test_bargrad2.php~, tests/test_barpattern.php~,
+	  tests/test_barsimple2.php~, tests/test_barsimple3.php~,
+	  tests/test_barsimple4.php~, tests/test_bug123.php~,
+	  tests/test_bug130.php~, tests/test_bug168.php~,
+	  tests/test_bug208.php~, tests/test_bug210.php~,
+	  tests/test_bug214.php~, tests/test_bug229.php~,
+	  tests/test_bug231.php~, tests/test_bug233.php~,
+	  tests/test_bug238.php~, tests/test_bug239.php~,
+	  tests/test_bug246.php~, tests/test_bug252.php~,
+	  tests/test_bug253.php~, tests/test_bug254.php~,
+	  tests/test_bug261.php~, tests/test_bug270.php~,
+	  tests/test_bug272.php~, tests/test_bug275.php~,
+	  tests/test_bug279.php~, tests/test_bug283.php~,
+	  tests/test_bug287.php~, tests/test_bug289.php~,
+	  tests/test_bug298.php~, tests/test_bug68.php~,
+	  tests/test_datetickposbug.php~, tests/test_dateweight.php~,
+	  tests/test_ganttpro.php~, tests/test_ganttweekbug.php~,
+	  tests/test_line.php~, tests/test_lineiconstring.php~,
+	  tests/test_logscale.php~, tests/test_manualticks5.php~,
+	  tests/test_markcsim.php~, tests/test_mgraph.php~,
+	  tests/test_mgraph2.php~, tests/test_mgraph3.php~,
+	  tests/test_mulyaxis.php~, tests/test_mulycsim.php~,
+	  tests/test_odo2.php~, tests/test_pie3d.php~,
+	  tests/test_pie3d_1.php~, tests/test_radarbug248.php~,
+	  tests/test_radarticks3.php~, tests/test_readcsv.php~,
+	  tests/test_symchar.php~, tests/test_text90.php~,
+	  tests/test_texttick.php~
+
+r389: 2006-01-15 20:23  ljp
+
+	* Comitted a number of test scripts to make a cleaner status message
+	Modified files: tests/bigredtigerfront.jpg, tests/csimcache,
+	  tests/csimcache/test_bug261.png,
+	  tests/csimcache/test_bug261_csim_.html, tests/data.csv,
+	  tests/data.csv~, tests/dataforbug253.txt, tests/test_automin.php,
+	  tests/test_automin.php~, tests/test_barcode128.php,
+	  tests/test_barcode128.php~, tests/test_bargrad.php,
+	  tests/test_bargrad.php~, tests/test_bargrad2.php,
+	  tests/test_bargrad2.php~, tests/test_barpattern.php,
+	  tests/test_barpattern.php~, tests/test_barsimple2.php,
+	  tests/test_barsimple2.php~, tests/test_barsimple3.php,
+	  tests/test_barsimple3.php~, tests/test_barsimple4.php,
+	  tests/test_barsimple4.php~, tests/test_bug123.php,
+	  tests/test_bug123.php~, tests/test_bug130.php,
+	  tests/test_bug130.php~, tests/test_bug168.php,
+	  tests/test_bug168.php~, tests/test_bug208.php,
+	  tests/test_bug208.php~, tests/test_bug210.php,
+	  tests/test_bug210.php~, tests/test_bug214.php,
+	  tests/test_bug214.php~, tests/test_bug229.php,
+	  tests/test_bug229.php~, tests/test_bug231.php,
+	  tests/test_bug231.php~, tests/test_bug233.php,
+	  tests/test_bug233.php~, tests/test_bug238.php,
+	  tests/test_bug238.php~, tests/test_bug238b.php,
+	  tests/test_bug239.php, tests/test_bug239.php~,
+	  tests/test_bug246.php, tests/test_bug246.php~,
+	  tests/test_bug252.php, tests/test_bug252.php~,
+	  tests/test_bug253.php, tests/test_bug253.php~,
+	  tests/test_bug254.php, tests/test_bug254.php~,
+	  tests/test_bug261.php, tests/test_bug261.php~,
+	  tests/test_bug270.php, tests/test_bug270.php~,
+	  tests/test_bug272.php, tests/test_bug272.php~,
+	  tests/test_bug275.php, tests/test_bug275.php~,
+	  tests/test_bug279.php, tests/test_bug279.php~,
+	  tests/test_bug283.php, tests/test_bug283.php~,
+	  tests/test_bug287.php, tests/test_bug287.php~,
+	  tests/test_bug289.php, tests/test_bug289.php~,
+	  tests/test_bug298.php, tests/test_bug298.php~,
+	  tests/test_bug68.php, tests/test_bug68.php~,
+	  tests/test_datetickposbug.php, tests/test_datetickposbug.php~,
+	  tests/test_dateweight.php, tests/test_dateweight.php~,
+	  tests/test_ganttpro.php, tests/test_ganttpro.php~,
+	  tests/test_ganttweekbug.php, tests/test_ganttweekbug.php~,
+	  tests/test_line.php, tests/test_line.php~,
+	  tests/test_lineiconstring.php~, tests/test_logscale.php,
+	  tests/test_logscale.php~, tests/test_manualticks.php,
+	  tests/test_manualticks2.php, tests/test_manualticks3.php,
+	  tests/test_manualticks4.php, tests/test_manualticks5.php,
+	  tests/test_manualticks5.php~, tests/test_markcsim.php,
+	  tests/test_markcsim.php~, tests/test_mgraph.php,
+	  tests/test_mgraph.php~, tests/test_mgraph2.php,
+	  tests/test_mgraph2.php~, tests/test_mgraph3.php,
+	  tests/test_mgraph3.php~, tests/test_mulyaxis.php,
+	  tests/test_mulyaxis.php~, tests/test_mulycsim.php,
+	  tests/test_mulycsim.php~, tests/test_odo2.php,
+	  tests/test_odo2.php~, tests/test_pie3d.php, tests/test_pie3d.php~,
+	  tests/test_pie3d_1.php, tests/test_pie3d_1.php~,
+	  tests/test_radarbug248.php, tests/test_radarbug248.php~,
+	  tests/test_radarticks3.php, tests/test_radarticks3.php~,
+	  tests/test_readcsv.php, tests/test_readcsv.php~,
+	  tests/test_symchar.php, tests/test_symchar.php~,
+	  tests/test_text90.php, tests/test_text90.php~,
+	  tests/test_texttick.php, tests/test_texttick.php~,
+	  tests/tiger1.jpg
+
+r388: 2006-01-15 20:21  ljp
+
+	* Moved MGraph from utils to it's own file. Added Utility class to read CSV file of data
+	Modified files: jpgraph_mgraph.php, jpgraph_utils.inc
+
+r379: 2006-01-14 11:26  ljp
+
+	* Fix PR#302 - Individual colors for labels and axis on radar plots
+	Modified files: jpgraph_radar.php
+
+r377: 2006-01-13 18:29  ljp
+
+	* Fix PR#298 - Multiple plots for polar graphs
+	Modified files: jpgraph_polar.php
+
+r374: 2006-01-13 18:20  ljp
+
+	* Add CR#299 - File and line number information for headers sent error
+	Modified files: jpgraph.php
+
+r370: 2006-01-09 18:19  ljp
+
+	* Fix PR#296 - Wrong stop character for I25
+	Modified files: jpgraph_barcode.php
+
+r369: 2006-01-06 03:54  ljp
+
+	* Fix PR#294- Function name misspelled in startup php_errormsg check
+	Modified files: jpgraph.php
+
+r366: 2006-01-05 07:03  ljp
+
+	* Copy and paste mistake in fix for #292
+	Modified files: jpgraph_bar.php
+
+r365: 2006-01-05 07:00  ljp
+
+	* Fix PR#292 - Incorrect calculation of Min value for AccBarPlot in some cases
+	Modified files: jpgraph_bar.php
+
+r364: 2005-12-31 10:08  ljp
+
+	* Added filledlineex03.php - Example with filled line and NULL values
+	Modified files: Examples/filledlineex03.php,
+	  Examples/piebkgex1.php
+
+r361: 2005-12-31 10:00  ljp
+
+	* Fix CR#283 - Gaps should be displayed for NULL values in filled line graphs
+	Modified files: jpgraph_line.php
+
+r359: 2005-12-30 20:59  ljp
+
+	* Fix CR#290 - Make it possible to use StrokeCSIM() without argument
+	Modified files: jpgraph.php
+
+r358: 2005-12-30 18:08  ljp
+
+	* Properly Fix PR#123 - Background gradient for rotated bar plots
+	Modified files: jpgraph.php
+
+r355: 2005-12-30 17:36  ljp
+
+	* Fix PR#123 - Background gradient for rotated bar plots
+	Modified files: jpgraph.php
+
+r353: 2005-12-30 17:22  ljp
+
+	* Fix CR#130 - Add option to use background gradient to Pie plots
+	Modified files: jpgraph_pie.php
+
+r351: 2005-12-30 16:26  ljp
+
+	* Fix PR#68 - Setting title side for X-axis title was not implemented
+	Modified files: jpgraph.php
+
+r350: 2005-12-30 14:31  ljp
+
+	* Fix PR#289 and improve performance by reducing the number of internal copies of class Image by using more references
+	Modified files: jpgraph.php, jpgraph_plotmark.inc
+
+r349: 2005-12-30 14:31  ljp
+
+	* Fix PR#289 and improve performance by reducing the number of internal copies of class Image by using more references
+	Modified files: jpgraph_gantt.php, jpgraph_gradient.php,
+	  jpgraph_iconplot.php, jpgraph_odo.php, jpgraph_polar.php,
+	  jpgraph_scatter.php, jpgraph_stock.php, jpgraph_windrose.php
+
+r346: 2005-12-29 09:32  ljp
+
+	* Renamed odo_examples odometer_examples
+	Modified files: odo_examples, odometer_examples
+
+r344: 2005-12-29 06:56  ljp
+
+	* Make ShowBorder() show a deprecated function error for 3D Pies
+	Modified files: jpgraph_pie3d.php
+
+r340: 2005-12-29 06:51  ljp
+
+	* Added additional error check to spline and bezier interpolation
+	Modified files: jpgraph_regstat.php
+
+r339: 2005-12-29 06:44  ljp
+
+	* Comitted multiple y-axis and combined graph examples
+	Modified files: Examples/combgraphex1.php,
+	  Examples/mulyaxiscsimex1.php, Examples/mulyaxisex1.php
+
+r338: 2005-12-29 06:43  ljp
+
+	* Added bezier example
+	Modified files: Examples/bezierex1.php
+
+r336: 2005-12-28 11:05  ljp
+
+	* PR #288. Dateline scale is not properly formatted
+	Modified files: jpgraph.php
+
+r334: 2005-12-15 22:34  ljp
+
+	* Remove HTML entitites encoding in CSIM targets for barplots
+	Modified files: jpgraph_bar.php
+
+r332: 2005-12-14 18:21  ljp
+
+	* Fix PR#280 - Wrong legends in some cases for 3D Pies
+	Modified files: jpgraph_pie3d.php
+
+r330: 2005-12-10 08:28  ljp
+
+	* Merged 328:329. Add possibility to use CSIM on multi Y-axes. Made it possibly to use 'auto' as special filename for CSIM to avoid having to supply file name.
+	Modified files: jpgraph.php
+
+r327: 2005-12-10 08:24  ljp
+
+	* Added Bezier interpolation class
+	Modified files: jpgraph_regstat.php
+
+r325: 2005-12-07 18:43  ljp
+
+	* Removed extra check for UPC-A barcodes. Allow 10 number systems (0-9) as the first specification.
+	Modified files: jpgraph_barcode.php
+
+r324: 2005-12-06 19:13  ljp
+
+	* Really Fixded PR #271. SetDateFormat()
+	Modified files: jpgraph.php
+
+r322: 2005-12-06 19:09  ljp
+
+	* Fixded PR #271. Problem with SetDateFormat()
+	Modified files: jpgraph.php
+
+r320: 2005-12-05 10:54  ljp
+
+	* Added error check for empty plots when client constructs group or acc bars
+	Modified files: jpgraph_bar.php
+
+r303: 2005-12-03 08:56  ljp
+
+	* Fixed lost startyear variable in DateScaleUtils
+	Modified files: jpgraph_utils.inc
+
+r297: 2005-11-30 22:12  ljp
+
+	* Rounding problem fixing. It turns out that according to PHP (a < b)==TRUE assuming a:INT and b:float. This could cause the last tick on an axis to not be shown in some rare cases
+	Modified files: jpgraph.php
+
+r296: 2005-11-30 19:55  ljp
+
+	* Fix PR #269. Make sure that the title of the axis is only stroken once
+	Modified files: jpgraph.php
+
+r287: 2005-11-28 22:12  ljp
+
+	* Fixed gantthourminex1.php example to be compatible with PHP 5.1.0
+	Modified files: Examples/gantthourminex1.php
+
+r286: 2005-11-28 22:09  ljp
+
+	* Added error check for too large width caused by a faulty input date
+	Modified files: jpgraph_gantt.php
+
+r282: 2005-11-27 20:34  ljp
+
+	* Updated math function examples to include jpgraph_utils.inc
+	Modified files: Examples/dupyaxisex1.php, Examples/funcex1.php,
+	  Examples/funcex2.php, Examples/funcex3.php, Examples/funcex4.php
+
+r279: 2005-11-27 11:13  ljp
+
+	* Added option to put the background image for MGraph at a specific x,y location
+	Modified files: jpgraph_utils.inc
+
+r278: 2005-11-27 11:12  ljp
+
+	* Updated and added manual tick examples
+	Modified files: Examples/manualtickex1.php,
+	  Examples/manualtickex2.php
+
+r276: 2005-11-26 15:42  ljp
+
+	* Moved class FuncGenerator from jpgraph.php to jpgraph_utility.inc
+	Modified files: jpgraph.php, jpgraph_utils.inc
+
+r274: 2005-11-26 14:42  ljp
+
+	* Simplified DateScaleUtils interface
+	Modified files: jpgraph_utils.inc
+
+r272: 2005-11-26 14:26  ljp
+
+	* Various minor adjustments in jpgraph.php * Added maj_tick_label as instance variable. That had always been missing !! * Adjusted the default margin fox X-axis labels slightly, slightly larger * Adjusted the left/right default graph margin (They were unecessarily large). * Added error checking when client specifies to few manual major ticks
+	Modified files: jpgraph.php
+
+r267: 2005-11-25 16:35  ljp
+
+	* Added option to use background images in MGraph (combined graphs)
+	Modified files: jpgraph_utils.inc
+
+r265: 2005-11-25 16:23  ljp
+
+	* Added Graph proxy method for Image::SetImgFormat()
+	Modified files: jpgraph.php
+
+r262: 2005-11-25 11:00  ljp
+
+	* Modified the MGraph::Add() method to accept Graph argument instead of just an image handler. Much more elegant and user friendly. Allso added the possibility for the MGraph::Stroke() method to return an image handler as well. This will allow MGraph to have MGraph as objects.
+	Modified files: jpgraph_utils.inc
+
+r261: 2005-11-24 06:51  ljp
+
+	* Borrowed some methods from class Graph to class MGraph in ordedr to avoid having to instantiate class Graph when using the MGraph functionality to save some memory. Added Class DateScaleUtils to jpgraph_utils.inc to make it easy to manually work with month scale where the tick positions are manually set
+	Modified files: jpgraph_utils.inc
+
+r260: 2005-11-23 19:52  ljp
+
+	* Added CR#266 "Add option to set a background fill for Axis labels" by adding a new method Graph::SetAxisLabelBackground() which will allow a client to specify a number of different variants of background for the labels on the primary X and Y axis.
+	Modified files: jpgraph.php
+
+r259: 2005-11-23 16:25  ljp
+
+	* Added Class MGraph in jpgraph_utils.inc. This is a utility class that can be used to easily combine several graphs into one image
+	Modified files: jpgraph_utils.inc
+
+r258: 2005-11-23 16:04  ljp
+
+	* Updated manual tick example to show X-grid as well to better illustrate the differenc between major and minor tick marks
+	Modified files: Examples/manualtickex1.php
+
+r256: 2005-11-23 05:38  ljp
+
+	* Updated the manual tick example to also make use of minor tick marks (without a label)
+	Modified files: Examples/manualtickex1.php
+
+r255: 2005-11-22 19:49  ljp
+
+	* Extended the manual tick positioning Axis::SetTickPosition() to also include the setting of the minor tick marks, i.e. tick marks without labels.
+	Modified files: jpgraph.php
+
+r253: 2005-11-21 19:35  ljp
+
+	* Added example for how to set manual tick positions
+	Modified files: Examples/manualtickex1.php
+
+r251: 2005-11-21 19:33  ljp
+
+	* Removed double entry in code table for greek characters
+	Modified files: jpgraph_utils.inc
+
+r246: 2005-11-20 12:11  ljp
+
+	* Adapted jpgraph_utils.inc for use in v1.x branch (for PHP4)
+	Modified files: jpgraph_utils.inc
+
+r245: 2005-11-20 12:07  ljp
+
+	* Copied jpgraph_utils to v1.x branch
+	Modified files: jpgraph_utils.inc
+
+r243: 2005-11-20 11:41  ljp
+
+	* Added CR#263. Possibility to have completely manual tick positions. One new method Axis::SetTickPositions($aTickPos,$aTickLabel) can be used to manually specify the exact positions for the ticks as well as an optional specified label. If no label array is specified then the labels will be determined by the scale value and any set formatting strings.
+	Modified files: jpgraph.php
+
+r242: 2005-11-20 11:34  ljp
+
+	* Removed newline at end of jpg-config.inc file since some Windows setups have problems with newlines
+	Modified files: jpg-config.inc
+
+r225: 2005-11-04 04:37  ljp
+
+	* Added parameter to SetTextLabelInterval()
+	Modified files: jpgraph.php
+
+r222: 2005-11-04 04:31  ljp
+
+	* Fix #253 Gradient in legends. Micro speeed improvement in min/max methods
+	Modified files: jpgraph_line.php
+
+r220: 2005-10-15 16:53  ljp
+
+	* Fix for issue #229. Special case when only having a single data point in date scale
+	Modified files: jpgraph_date.php
+
+r218: 2005-10-15 10:52  ljp
+
+	* Fix for issue #247 boundary check in while loop
+	Modified files: jpgraph_gantt.php
+
+r217: 2005-10-15 10:29  ljp
+
+	* Fix for feature request #243. Allow 1.x branch to be used in compatibility mode in PHP5
+	Modified files: jpgraph.php
+
+r215: 2005-10-14 17:39  ljp
+
+	* Fix for #251 where the ID attribute in the MAP tag makes it hard to save an CSIM image
+	Modified files: jpgraph.php
+
+r213: 2005-10-11 18:22  ljp
+
+	* Fix axis title positioning issue #248
+	Modified files: jpgraph_radar.php
+
+r211: 2005-10-06 16:29  ljp
+
+	* Fix for #244. Missing ALT value for CSIM for Bars
+	Modified files: jpgraph_bar.php
+
+r209: 2005-09-26 17:23  ljp
+
+	* Fix #231. Image markers are not rotated
+	Modified files: jpgraph_plotmark.inc
+
+r207: 2005-09-04 15:25  ljp
+
+	* PHP Bug workaround (#226)
+	Modified files: jpgraph.php
+
+r201: 2005-09-03 09:39  ljp
+
+	* Moved old directories up to dust
+	Modified files: barcode, jpgraph_gantt.php, pdf417, windrose
+
+r196: 2005-09-01 05:03  ljp
+
+	* Fixed #222 Gantt day header too small in some circumstances
+	Modified files: jpgraph_gantt.php
+
+r193: 2005-08-31 19:23  ljp
+
+	* Moved windrose word-doc to docs main directory
+	Modified files: windrose/windrose.doc
+
+r192: 2005-08-31 19:22  ljp
+
+	* Removed html dir in windrose
+	Modified files: windrose/html
+
+r191: 2005-08-31 19:21  ljp
+
+	* UTF8 directory from windrose and moved it to asian_lang instead
+	Modified files: windrose/utf8
+
+r190: 2005-08-31 19:19  ljp
+
+	* Moved Example in UTF8 windrose to asian_lang
+	Modified files: windrose/utf8/Examples, windrose/utf8/jpgraph.php,
+	  windrose/utf8/jpgraph_gradient.php,
+	  windrose/utf8/jpgraph_plotmark.inc,
+	  windrose/utf8/jpgraph_windrose.php
+
+r186: 2005-08-31 19:06  ljp
+
+	* Moved windrose img to main docs directory
+	Modified files: windrose/img
+
+r185: 2005-08-31 19:06  ljp
+
+	* Moved windrose docs to main docs directory
+	Modified files: windrose/manual.book, windrose/manualpdf.book,
+	  windrose/polar_function_3.gif, windrose/windrose.png,
+	  windrose/windrose_html_manual, windrose/windrose_manual.php
+
+r184: 2005-08-31 16:17  ljp
+
+	* Added possibility to create icons and backgrounds from strings
+	Modified files: jpgraph.php, jpgraph_iconplot.php,
+	  tests/test_lineiconstring.php
+
+r176: 2005-08-29 23:25  ljp
+
+	* Cleaned up windrose directory
+	Modified files: windrose/contour.gif, windrose/contour.png,
+	  windrose/dust, windrose/dust/contour.gif,
+	  windrose/dust/contour.png, windrose/dust/jpgraph_windrose-1.0.php,
+	  windrose/dust/jpgraph_windrose-1.05.php,
+	  windrose/dust/jpgraph_windrose-1.0beta.php,
+	  windrose/dust/mockup_ex1.png, windrose/dust/windchart_3.gif,
+	  windrose/dust/windrose-1.1.tar.gz,
+	  windrose/dust/windrose_manual-1.0.php,
+	  windrose/dust/windrose_manual-1.0beta.php,
+	  windrose/jpgraph_windrose-1.0.php,
+	  windrose/jpgraph_windrose-1.05.php,
+	  windrose/jpgraph_windrose-1.0beta.php, windrose/mockup_ex1.png,
+	  windrose/windchart_3.gif, windrose/windrose-1.0.tar.gz,
+	  windrose/windrose-1.1, windrose/windrose-1.1.tar.gz,
+	  windrose/windrose_manual-1.0.php,
+	  windrose/windrose_manual-1.0beta.php
+
+r175: 2005-08-29 23:18  ljp
+
+	* Removed wrong jpgtutlib link
+	Modified files: windrose/jpgtutlib.inc
+
+r174: 2005-08-29 23:13  ljp
+
+	* Removed old sym links to jpgraph.php etc
+	Modified files: barcode/jpgraph.php, barcode/jpgraph_canvas.php
+
+r173: 2005-08-29 23:12  ljp
+
+	* Removed wrong barcode demoapp directory
+	Modified files: barcode/barcode_demoapp
+
+r172: 2005-08-29 23:12  ljp
+
+	* Removed barcode examples from it's old location
+	Modified files: barcode/barcode_ex0.php, barcode/barcode_ex1.php,
+	  barcode/barcode_ex2.php, barcode/barcode_ex3.php,
+	  barcode/barcode_ex4.php
+
+r171: 2005-08-29 23:08  ljp
+
+	* Changed path for windrose examples
+	Modified files: windrose_examples/windrose_ex0.php,
+	  windrose_examples/windrose_ex1.php,
+	  windrose_examples/windrose_ex1b.php,
+	  windrose_examples/windrose_ex2.php,
+	  windrose_examples/windrose_ex3.php,
+	  windrose_examples/windrose_ex4.php,
+	  windrose_examples/windrose_ex5.php,
+	  windrose_examples/windrose_ex6.php,
+	  windrose_examples/windrose_ex7.php,
+	  windrose_examples/windrose_ex8.php,
+	  windrose_examples/windrose_ex9.php
+
+r170: 2005-08-29 23:05  ljp
+
+	* Changed path for all PDF417 examples
+	Modified files: pdf417_examples/pdf417_ex1.php,
+	  pdf417_examples/pdf417_ex2.php, pdf417_examples/pdf417_ex3.php,
+	  pdf417_examples/pdf417_ex4.php, pdf417_examples/pdf417_ex5.php,
+	  pdf417_examples/pdf417_ex6.php
+
+r169: 2005-08-29 22:50  ljp
+
+	* Removed .directory
+	Modified files: windrose_examples/.directory
+
+r168: 2005-08-29 22:46  ljp
+
+	* Updated directory structure to match release structure
+	Modified files: barcode/barcode_demoapp,
+	  barcode/barcode_image.php, barcode/barcode_menu.php,
+	  barcode/index.html, barcode/jpgraph_barcode.php, barcode_demoapp,
+	  barcode_demoapp/barcode_image.php,
+	  barcode_demoapp/barcode_menu.php, barcode_demoapp/index.html,
+	  barcode_examples, barcode_examples/barcode_ex0.php,
+	  barcode_examples/barcode_ex1.php,
+	  barcode_examples/barcode_ex2.php,
+	  barcode_examples/barcode_ex3.php,
+	  barcode_examples/barcode_ex4.php, jpgraph_barcode.php,
+	  jpgraph_pdf417.php, odo_examples, odoexamples, pdf417/Examples,
+	  pdf417/demoapp, pdf417/jpgraph_pdf417.php,
+	  pdf417/pdf417_backends.inc, pdf417/pdf417_clusters.inc,
+	  pdf417/pdf417_compressors.inc, pdf417/pdf417_error.inc,
+	  pdf417_backends.inc, pdf417_clusters.inc, pdf417_compressors.inc,
+	  pdf417_demoapp, pdf417_demoapp/pdf417_demo_image.php,
+	  pdf417_error.inc, pdf417_examples, windrose/examples,
+	  windrose_examples
+
+r167: 2005-08-29 22:41  ljp
+
+	* Made Y2 axis default always at the right end of X
+	Modified files: jpgraph.php
+
+r166: 2005-08-29 22:35  ljp
+
+	* Changed include path for pdf417 demo app
+	Modified files: pdf417/demoapp/pdf417_demo_image.php
+
+r91: 2005-08-27 23:03  ljp
+
+	* Updted jpdocgen to skip returning object with &
+	Modified files: utils/jpdocgen/jpgendb.php
+
+r90: 2005-08-27 23:02  ljp
+
+	* Added more test scripts
+	Modified files: tests/bug_axisy2title.php, tests/gdtest.php,
+	  tests/test_axisy2.php, tests/test_baraccint.php,
+	  tests/test_baraccnull.php, tests/test_bb2671.php,
+	  tests/test_bug144.php, tests/test_bug148.php,
+	  tests/test_bug189.php, tests/test_bug190.php,
+	  tests/test_bug191.php, tests/test_bug197.php,
+	  tests/test_bug203.php, tests/test_bug3.php, tests/test_bug58.php,
+	  tests/test_bug9.php, tests/test_dateaxis3.php,
+	  tests/test_dateaxisy2.php, tests/test_datesparse.php,
+	  tests/test_datesparsebug.php, tests/test_datprobug.php,
+	  tests/test_fieldrot.php, tests/test_gantt.php,
+	  tests/test_ganttcsim.php, tests/test_horizbarcsim.php,
+	  tests/test_legendbox.php, tests/test_line.php,
+	  tests/test_linebug-104.php, tests/test_linesimple.php,
+	  tests/test_logline.php, tests/test_multiline.php,
+	  tests/test_patternbug.php, tests/test_piecsim.php,
+	  tests/test_pietheme.php, tests/test_scattermark.php,
+	  tests/test_scatternulls.php, tests/test_textalign.php,
+	  tests/test_ttf.php, tests/test_ttfread.php
+
+r88: 2005-08-07 17:18  ljp
+
+	* Chnaged some count() in for loop to a variable instead. Minor formatting change to date class
+	Modified files: jpgraph.php, jpgraph_date.php, jpgraph_error.php,
+	  jpgraph_gantt.php, jpgraph_pie.php, jpgraph_radar.php
+
+r86: 2005-07-12 17:55  ljp
+
+	* Feature #208. Added WindrosePlot::SetRangeStyle()
+	Modified files: jpgraph_windrose.php,
+	  windrose/examples/windrose_ex1b.php
+
+r84: 2005-07-10 18:22  ljp
+
+	* Added debug lines in legend and fine-tuned calculation of legend height
+	Modified files: jpgraph.php
+
+r82: 2005-07-09 21:23  ljp
+
+	* Fixed #196 - Better layout for legend box
+	Modified files: jpgraph.php
+
+r76: 2005-06-25 21:59  ljp
+
+	* Final fix for bug #191 by commenting out some strange adjustment Stroke() for accbar plot
+	Modified files: jpgraph_bar.php
+
+r75: 2005-06-25 21:59  ljp
+
+	* Fix for possible undefined CSIM alt tag. Bumbped version number to 1.19dev
+	Modified files: jpgraph.php
+
+r73: 2005-06-25 11:16  ljp
+
+	* Make sure pie csim center coordinates are integers
+	Modified files: jpgraph_pie.php
+
+r72: 2005-06-22 21:28  ljp
+
+	* Added zero option to line interpolation
+	Modified files: jpgraph_line.php
+
+r69: 2005-06-17 19:46  ljp
+
+	* Added linear interpolation for acc lines (#189)
+	Modified files: jpgraph_line.php
+
+r68: 2005-06-16 21:29  ljp
+
+	* Propset Id
+	Modified files: barcode/jpgraph_barcode.php
+
+r67: 2005-06-16 21:24  ljp
+
+	* Added Id tag
+	Modified files: barcode/jpgraph_barcode.php
+
+r65: 2005-06-16 21:18  ljp
+
+	* Implemented multipe data chunks for EAN128
+	Modified files: barcode/jpgraph_barcode.php
+
+r63: 2005-06-10 04:55  ljp
+
+	* Added individual legend mark size for horiz/vert (#144)
+	Modified files: jpgraph.php
+
+r60: 2005-06-08 11:04  ljp
+
+	* Better handling of bars with an Absolute Width (#190)
+	Modified files: jpgraph.php, jpgraph_bar.php
+
+r58: 2005-06-08 09:21  ljp
+
+	* Compensation for handling of barcenter number of data points (#190)
+	Modified files: jpgraph.php
+
+r56: 2005-06-06 20:14  ljp
+
+	* Fixed HideTicks for log scale (#90)
+	Modified files: jpgraph_log.php
+
+r53: 2005-06-06 18:12  ljp
+
+	* Fix so that 'x' and '-' are interpretated as null in ScatterPlot
+	Modified files: jpgraph_scatter.php
+
+r51: 2005-06-06 16:08  ljp
+
+	* Fix for #188 CSIM for Titles in PieGraphs
+	Modified files: jpgraph_pie.php
+
+r49: 2005-06-06 14:46  ljp
+
+	* Fixed wrong parameter to imagefilledarc() in CakeSlice() #66
+	Modified files: jpgraph.php
+
+r46: 2005-06-06 13:59  ljp
+
+	* Fixed rounding problem #164
+	Modified files: jpgraph_windrose.php
+
+r45: 2005-06-06 13:48  ljp
+
+	* Fixed problem with AccBar PreStrokeAdjust #103
+	Modified files: jpgraph_bar.php
+
+r42: 2005-06-06 13:08  ljp
+
+	* Fixed remaining problem with single slice Pie and CSIM (#107)
+	Modified files: jpgraph_pie.php
+
+r41: 2005-06-06 10:46  ljp
+
+	* Better (X)HTML compliance for generated CSIM HTML
+	Modified files: jpgraph.php, jpgraph_bar.php, jpgraph_gantt.php,
+	  jpgraph_pie.php, jpgraph_pie3d.php, jpgraph_plotmark.inc,
+	  jpgraph_stock.php
+
+r38: 2005-06-06 10:12  ljp
+
+	* Added formatting callback #172
+	Modified files: jpgraph_radar.php
+
+r36: 2005-06-06 10:03  ljp
+
+	* Fixed anti-alias pie problem #71
+	Modified files: jpgraph_pie.php
+
+r35: 2005-06-05 23:05  ljp
+
+	* Test scale positioned icon
+	Modified files: tests/test_barscaleicon.php
+
+r28: 2005-06-05 16:36  ljp
+
+	* More example for guide-lines and date axis
+	Modified files: Examples/dateaxisex2.php,
+	  Examples/dateaxisex3.php, Examples/dateaxisex4.php,
+	  Examples/pielabelsex1.php, Examples/pielabelsex4.php,
+	  jpgraph_date.php, tests/test_barpattern.php,
+	  tests/test_ganttsimple.php, tests/test_pienewlabels.php
+
+r26: 2005-06-05 15:33  ljp
+
+	* Added SetTimeAlign() and adjusted constants
+	Modified files: jpgraph_date.php
+
+r24: 2005-06-05 11:51  ljp
+
+	* Some small backporting from v2 branch to handle arrays in Add()
+	Modified files: jpgraph_pie.php
+
+r23: 2005-06-05 11:31  ljp
+
+	* Added pie guide line examples
+	Modified files: Examples/pielabelsex1.php,
+	  Examples/pielabelsex2.php, Examples/pielabelsex3.php
+
+r21: 2005-05-30 20:35  ljp
+
+	* Added Id keyword property
+	Modified files: Todo, flags_full.inc, imgdata_balls.inc,
+	  imgdata_bevels.inc, imgdata_diamonds.inc, imgdata_pushpins.inc,
+	  imgdata_squares.inc, imgdata_stars.inc, jpg-config.inc,
+	  jpgraph.php, jpgraph_antispam-digits.php, jpgraph_antispam.php,
+	  jpgraph_bar.php, jpgraph_canvas.php, jpgraph_canvtools.php,
+	  jpgraph_date.php, jpgraph_error.php, jpgraph_flags.php,
+	  jpgraph_gantt.php, jpgraph_gb2312.php, jpgraph_gradient.php,
+	  jpgraph_iconplot.php, jpgraph_imgtrans.php, jpgraph_line.php,
+	  jpgraph_log.php, jpgraph_odo.php, jpgraph_pie.php,
+	  jpgraph_pie3d.php, jpgraph_plotband.php, jpgraph_plotmark.inc,
+	  jpgraph_polar.php, jpgraph_radar.php, jpgraph_regstat.php,
+	  jpgraph_scatter.php, jpgraph_stock.php, jpgraph_windrose.php
+
+r18: 2005-05-29 18:16  ljp
+
+	* Adaption for icon plot new behaviour in jpgraph.php
+	Modified files: jpgraph_gantt.php
+
+r17: 2005-05-29 15:30  ljp
+
+	* Fix icon positioning
+	Modified files: jpgraph.php, jpgraph_iconplot.php
+
+r13: 2005-05-29 10:40  ljp
+
+	* Added test_barsmallicon test_radarticks2
+	Modified files: tests/test_barsmallicon.php,
+	  tests/test_radarticks2.php
+
+r10: 2005-05-29 10:11  ljp
+
+	* Fixed #181, #182 Scale positions for icon plots and also add rotation of icons
+	Modified files: jpgraph.php, jpgraph_iconplot.php
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_balls.inc php-syslog-ng/html/includes/jpgraph/imgdata_balls.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_balls.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/imgdata_balls.inc	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,1064 @@
+<?php
+//=======================================================================
+// File:	IMGDATA_ROUNDBALLS.INC
+// Description:	Base64 encoded images for small round markers
+// Created: 	2003-03-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: imgdata_balls.inc 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class ImgData_Balls extends ImgData {
+    var $name = 'Round Balls';
+    var $an = array(MARK_IMG_LBALL => 'imgdata_large',
+		    MARK_IMG_MBALL => 'imgdata_small',
+		    MARK_IMG_SBALL => 'imgdata_xsmall',
+		    MARK_IMG_BALL => 'imgdata_xsmall');
+    var $colors_1 = array('blue','lightblue','brown','darkgreen',
+			      'green','purple','red','gray','yellow','silver','gray');
+    var $index_1  = array('blue'=>9,'lightblue'=>1,'brown'=>6,'darkgreen'=>7,
+			      'green'=>8,'purple'=>4,'red'=>0,'gray'=>5,'silver'=>3,'yellow'=>2);
+    var $maxidx_1 = 9 ;
+
+    var $colors_2 = array('blue','bluegreen','brown','cyan',
+			  'darkgray','greengray','gray','green',
+			  'greenblue','lightblue','lightred',
+			  'purple','red','white','yellow');
+			  
+	
+    var $index_2 =  array('blue'=>9,'bluegreen'=>13,'brown'=>8,'cyan'=>12,
+			  'darkgray'=>5,'greengray'=>6,'gray'=>2,'green'=>10,
+			  'greenblue'=>3,'lightblue'=>1,'lightred'=>14,
+			  'purple'=>7,'red'=>0,'white'=>11,'yellow'=>4);
+			
+    var $maxidx_2 = 14 ;
+
+
+    var $colors_3 = array('bluegreen','cyan','darkgray','greengray',
+			  'gray','graypurple','green','greenblue','lightblue',
+			  'lightred','navy','orange','purple','red','yellow');
+	
+    var $index_3 = array('bluegreen'=>1,'cyan'=>11,'darkgray'=>14,'greengray'=>10,
+			 'gray'=>3,'graypurple'=>4,'green'=>9,'greenblue'=>7,
+			 'lightblue'=>13,'lightred'=>0,'navy'=>2,'orange'=>12,
+			 'purple'=>8,'red'=>5,'yellow'=>6);
+    var $maxidx_3 = 14 ;
+
+    var $colors,$index,$maxidx;
+    var $imgdata_large ;
+    var $imgdata_small ;
+    var $imgdata_xsmall ;
+
+
+    function GetImg($aMark,$aIdx) {
+	switch( $aMark ) {
+	    case MARK_IMG_SBALL:
+	    case MARK_IMG_BALL:
+		$this->colors = $this->colors_3;
+		$this->index = $this->index_3 ;
+		$this->maxidx = $this->maxidx_3 ;
+		break;
+	    case MARK_IMG_MBALL:
+		$this->colors = $this->colors_2;
+		$this->index = $this->index_2 ;
+		$this->maxidx = $this->maxidx_2 ;
+		break;
+	    default:
+		$this->colors = $this->colors_1;
+		$this->index = $this->index_1 ;
+		$this->maxidx = $this->maxidx_1 ;
+		break;
+	}
+	return parent::GetImg($aMark,$aIdx);
+    }
+
+    function ImgData_Balls() {
+
+//==========================================================
+// File: bl_red.png
+//==========================================================
+	$this->imgdata_large[0][0]= 1072 ;
+	$this->imgdata_large[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAByF'.
+	    'BMVEX/////////xsb/vb3/lIz/hIT/e3v/c3P/c2v/a2v/Y2P/'.
+	    'UlL/Skr/SkL/Qjn/MTH/MSn/KSn/ISH/IRj/GBj/GBD/EBD/EA'.
+	    'j/CAj/CAD/AAD3QkL3MTH3KSn3KSH3GBj3EBD3CAj3AAD1zMzv'.
+	    'QkLvISHvIRjvGBjvEBDvEAjvAADnUlLnSkrnMTnnKSnnIRjnGB'.
+	    'DnEBDnCAjnAADec3PeSkreISHeGBjeGBDeEAjWhITWa2vWUlLW'.
+	    'SkrWISnWGBjWEBDWEAjWCAjWAADOnp7Oa2vOGCHOGBjOGBDOEB'.
+	    'DOCAjOAADJrq7Gt7fGGBjGEBDGCAjGAADEpKS/v7+9QkK9GBC9'.
+	    'EBC9CAi9AAC1e3u1a2u1Skq1KSm1EBC1CAi1AACtEBCtCBCtCA'.
+	    'itAACngYGlCAilAACghIScOTmcCAicAACYgYGUGAiUCAiUAAiU'.
+	    'AACMKSmMEACMAACEa2uEGAiEAAB7GBh7CAB7AABzOTlzGBBzCA'.
+	    'BzAABrSkprOTlrGBhrAABjOTljAABaQkJaOTlaCABaAABSKSlS'.
+	    'GBhSAABKKSlKGBhKAABCGBhCCABCAAA5CAA5AAAxCAAxAAApCA'.
+	    'ApAAAhAAAYAACc9eRyAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgF'.
+	    'HUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkRFD'.
+	    'UHLytKAAAB4UlEQVR4nGNgIAK4mGjrmNq6BmFIWMmISUpKSmk5'.
+	    'B8ZEokj4qoiLiQCBgqald3xaBpKMj6y4sLCQkJCIvIaFV0RaUR'.
+	    'lCSk5cWEiAn19ASN7QwisuraihHiajKyEixM/NwckjoKrvEACU'.
+	    'qumpg7pAUlREiJdNmZmLT9/cMzwps7Smc3I2WEpGUkxYkJuFiY'.
+	    'lTxszePzY1v7Shc2oX2D+K4iLCgjzsrOw8embuYUmZeTVtPVOn'.
+	    'gqSslYAOF+Ln4ZHWtXMPTcjMrWno7J82rRgoZWOsqaCgrqaqqm'.
+	    'fn5peQmlsK1DR52vRaoFSIs5GRoYG5ub27n19CYm5pdVPnxKnT'.
+	    'pjWDpLydnZwcHTz8QxMSEnJLgDL9U6dNnQ6Sio4PDAgICA+PTU'.
+	    'zNzSkph8hADIxKS46Pj0tKTc3MLSksqWrtmQySAjuDIT8rKy0r'.
+	    'Kz+vtLSmur6jb9JUIJgGdjxDQUVRUVFpaUVNQ1NrZ9+kKVOmTZ'.
+	    'k6vR0sldJUAwQNTU2dnX0TgOJTQLrSIYFY2dPW1NbW2TNxwtQp'.
+	    'U6ZMmjJt2rRGWNB3TO7vnzh5MsgSoB6gy7sREdY7bRrQEDAGOb'.
+	    'wXOQW0TJsOEpwClmxBTTbZ7UDVIPkp7dkYaYqhuLa5trYYUxwL'.
+	    'AADzm6uekAAcXAAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bl_bluegreen.png
+//==========================================================
+	$this->imgdata_large[1][0]= 1368 ;
+	$this->imgdata_large[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMMFi8hE9b2uAAABOVJREFUeNq9lk2sJFUVx3+3qv'.
+	    'tW95t57zFvhiFxmCFRUJRoNCQiJARMhiFx/Igxii5goTG6ZDAu'.
+	    '/EhcSCIrTAgLEiKsJ8ywABNZEMJXEDYCukAmjgjzBkK/j35V1d'.
+	    '333FtV97io97pfzwxfG86qcu/N+Z3zP+fcW/Apmfk4hx57+R/6'.
+	    'Rqmc9ykhsWjlsUngAA1fXIQ7b73pI/186IGHnn9dH/8frC8v4I'.
+	    'PiG53uaerR4GmKkv31mB8cyfjd946ZTwR66qVX9OTWIi8UKUv9'.
+	    'BOrZXpYZvFeiBvzI0fgSUSFKwbVG+Pl1V3HH0VvNR4KeeukV/f'.
+	    'PmMmdHhst76aXD64AbeVQ9bjNHaiGOC2o3wLrAb2/4LL/84ffn'.
+	    'fCdzkOdayKpLppBemrBsU5Y1Zdmm9LJdGU6E/t4M24Q26jRDRL'.
+	    'j3mdc49cSTekFsMzs5XuTsyLDUNSDQ25NwKOly9YIl22MYhJr/'.
+	    'uoDtBBoT0CxBRGYOAhibIaOCe//2MpfM6KHnX9cXipSlbkKWmS'.
+	    'nk9iv38J0jixw7vJfrTMYBOvhSoQHJBS09ANELloAGDxW8tfoW'.
+	    'J+5/UC8CPS0LU7r3SpYarr7M8rmFjMPLXT6/33L4si7Z2GCrQC'.
+	    '+0ctlOaNs9DReV8vSLr85ndPLpZ/WNvHW+01kAVFBOGvJx0wYg'.
+	    'Sp47RIQ4Emwa8FGJXlDxSCFo5YlVgAo2hwPue/hRndboTV3EW2'.
+	    'Wp3k6wBp8q56QiWzecW6vwQfnPRkAWhFgILnq08jQ+R2nlUzzN'.
+	    'uES9Q7Vd+9fba7NmWJW61db2247qACmcjxXr45psYphsFGSLBu'.
+	    'kIajxqtjNwHkvAjQt0sg3crhPA2+fPz0CuyNFOghsGsr19mnFg'.
+	    'DGwrRm8UoAtNmQPQtRXDgdC4HImCFEKcCE0oieUWUYq2LtbiGp'.
+	    'mBQmppfIkjw45DK0QNNkvQ0jMBtPL0UnDRM1rN+cxKwzvOo2NP'.
+	    'tykR9a1kfpZNDLMG6QDYJqCTBvUe1+uxs+YKyPoGrTwY2HhvC4'.
+	    'CDWQd5d4xNApNQEEMgjgLdUCLBQ5cprL/trwNwKG2IUmDqDFd5'.
+	    'sr5BWrlxuSdLDFEFlqAzXGc4zFjupqh6uqYihpxJcEgp026l2w'.
+	    '7wFUv7Z6AvrfRo/n0OYzPwIKE3HUKAJg2otMBiElnsF7wngis9'.
+	    '3ZDjNnLi7huCWUZfueZKTu/M0V3HvmkOFDVxVKDG04ScejSgW5'.
+	    'V0q5JYFEghuDLHlTmToqDeGOCKIVtrW9hsdmXufEcNLPSXuPHa'.
+	    'a+bvuh9df5AH/v5PDFmbWQC3Mx+TVvfGVTRB2CodNgT2JBX003'.
+	    'aANZAYS/BxCv32TV/l2C03G7jgmfjGiT/qmeEmibEYm7XzAO2k'.
+	    'A+pbgHhBgydqu54YO5eRiLCy7yDvPP6Xqf+5Z+Lu277OYuOpiw'.
+	    'H15oBmlNOMcmK5RbP+PrEscGU+DSAxdg4CICIkxnLP8aNz63Og'.
+	    'H3/rdvOb795GVhuaYo0oBc3GGrEsUPVTwO6a7LYd+X51x3Hu/t'.
+	    'lP5tS65FN+6okn9U+n/sqb596dTvhOF+02myXTmkQNrOw7yD3H'.
+	    'j14E+UDQjp24/0E9/eKrbA4HH3aMK1b2ccvXvswjv//1J/s5ud'.
+	    'Due/hRPfP+OmfOrk7vrn7a48ihA3zh8CH+8Iuffiw/n4r9H1ZZ'.
+	    '0zz7G56hAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bl_yellow.png
+//==========================================================
+	$this->imgdata_large[2][0]= 1101 ;
+	$this->imgdata_large[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAB2l'.
+	    'BMVEX//////////+///+f//9b//8b//73//7X//63//6X//5T/'.
+	    '/4z//4T//3P//2v//1r//0r//0L//zH//yn//yH//xj//xD//w'.
+	    'j//wD/90L/9zn/9zH/9xj/9xD/9wj/9wD39yn37zn37zH37yH3'.
+	    '7xD37wj37wDv70Lv50rv50Lv5znv5yHv5xjv5wjv5wDn51Ln5x'.
+	    'Dn3jHn3iHn3hjn3hDn3gje3oze3nPe3lLe1oze1nPe1lLe1ine'.
+	    '1iHe1hje1hDe1gje1gDW1qXW1mvWzqXWzkLWzhjWzhDWzgjWzg'.
+	    'DOzrXOzq3OzpzOzgDOxkrOxinOxhjOxhDOxgjOxgDGxqXGxnvG'.
+	    'xmvGvRjGvRDGvQjGvQDFxbnAvr6/v7+9vaW9vZS9vQi9vQC9tR'.
+	    'C9tQi9tQC7u7W1tZS1tXu1tTG1tQi1rRC1rQi1rQCtrYytrSGt'.
+	    'rQitrQCtpYStpSGtpQitpQClpYSlpXulpQClnBClnAilnACcnG'.
+	    'ucnAicnACclAiclACUlFqUlCmUlAiUlACUjFKUjAiUjACMjFKM'.
+	    'jEqMjACMhACEhACEewB7ezF7exB7ewB7cwBzcylzcwBzaxBzaw'.
+	    'BraxhrawhrawBrYxBrYwBjYwBjWgBaWgBaUgCXBwRMAAAAAXRS'.
+	    'TlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAd'.
+	    'LdfvwAAAAHdElNRQfTAwkRFBKiJZ4hAAAB7ElEQVR4nI3S+1vS'.
+	    'UBgHcB67WJmIMWAVdDHEDLBC6Go0slj3Ft0m9RRBWQEmFZFDEM'.
+	    'Qgt0EMFBY7p/+198hj1kM/9N1+++x73rOd6XT/kStnTx4fPzd9'.
+	    'uwfOjFhomj7smAhwj/6Cm2O0xUwy6g7cCL99uCW3jtBmE7lsdr'.
+	    'fvejgpzP7uEDFRRoqy2k8xQPnypo2BUMP6waF9Vpf3ciiSzErL'.
+	    'XTkPc0zDe3bsHDAcc00yoVgqL3UWN2iENpspff+2vn6D0+NnZ9'.
+	    '6lC5K6RuSqBTZn1O/a3rd7v/MSez+WyIpVFX8GuuCA9SjD4N6B'.
+	    'oRNTfo5PCAVR0fBXoIuOQzab1XjwwNHx00GOj8/nKtV1DdeArk'.
+	    '24R+0ul9PjmbrHPYl+EipyU0OoQSjg8/m83kl/MMhx0fjCkqio'.
+	    'SMOE7t4JMAzDsizH81AqSdW2hroLPg4/CEF4PhKNx98vlevrbY'.
+	    'QQXgV6kXwVfjkTiSXmhYVcSa7DIE1DOENe7GM6lUym0l+EXKks'.
+	    'K20VAeH2M0JvVgrZfL5Qqkiy0lRVaMBd7H7EZUmsiJJcrTdVja'.
+	    'wGpdbTLj3/3qwrUOjAfGgg4LnNA5tdQx14Hm00QFBm65hfNzAm'.
+	    '+yIFhFtzuj+z2MI/MQn6Uez5pz4Ua41G7VumB/6RX4zMr1TKBr'.
+	    'SXAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bl_silver.png
+//==========================================================
+	$this->imgdata_large[3][0]= 1481 ;
+	$this->imgdata_large[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAADAF'.
+	    'BMVEUAAADOzs7Gxsa9vb21tbXOxsbOzsbGzsb3///O1ta1vb2c'.
+	    'paVSWlpKWlpSY2ve5+97hIze7/9aY2vO5/9zhJRaa3tSY3PGzt'.
+	    'aMlJxrc3tja3NKUlpCSlK1vcZze4RSWmPW5/+Upb3G3v9zhJxS'.
+	    'Y3t7jKVaa4TO3veltc6ElK1re5Rjc4ycpbV7hJRaY3M5QlLn7/'.
+	    '/Gzt6lrb2EjJzO3v9ja3vG1ve9zu+1xueltdacrc6UpcaMnL1C'.
+	    'SlqElLV7jK1zhKVre5zW3u/O1ue1vc6ttcaMlKVze4xrc4RSWm'.
+	    'tKUmPG1v+9zve1xu+tveeltd6crdbe5/+9xt6cpb17hJxaY3s5'.
+	    'QlrW3vfO1u/Gzue1vdattc6lrcaUnLWMlK2EjKVze5Rrc4xja4'.
+	    'RSWnNKUmtCSmO9xuecpcZ7hKVaY4TW3v/O1vfGzu+1vd6ttdal'.
+	    'rc69xu+UnL2MlLWEjK1ze5xrc5R7hK1ja4zO1v+1veettd6lrd'.
+	    'aMlL3Gzv/39//W1t7Gxs61tb29vcatrbWlpa2cnKWUlJyEhIx7'.
+	    'e4TW1ufGxta1tcZSUlqcnK3W1u+UlKW9vda1tc57e4ytrcalpb'.
+	    '1ra3vOzu9jY3OUlK29vd6MjKWEhJxaWmtSUmNzc4xKSlpjY3tK'.
+	    'SmNCQlqUjJzOxs7///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'.
+	    'AAAAAAAAAAAAAAAAAAAAAAAAD///9fnkWVAAAAAnRSTlP/AOW3'.
+	    'MEoAAAABYktHRP+lB/LFAAAACXBIWXMAAABFAAAARQBP+QatAA'.
+	    'AB/klEQVR42mNgxAsYqCdd3+lcb4hLmj8wMMvEu8DCMqYbU9op'.
+	    'UEFB2MTb26eyysomFl06XEEhUCHLpAKo2z/fujikEUVaXUFBMB'.
+	    'BouLePuV+VVWGRciIXknSEsImCQd3//xwmPr65llaFcSFJHkjS'.
+	    '3iYmWUDZ//8NfCr989NjNUMSUyTg0jneSiaCINn/gmlVQM12qg'.
+	    'lJnp5waTMTE5NAkCyHWZW/lXWNfUlikmdYK0zax7siS4EDKJtd'.
+	    'mQeU1XRwLBdLkRGASucWmGVnZ4dnhZvn5lmm29iVOWpnJqcuko'.
+	    'JKR1Wm5eTkRKYF5eblp9sU2ZeUJiV7zbfVg0pH56UFBQXNjIqK'.
+	    'jgkujItX1koKTVmYajsdKu2qETVhwgSXiUDZ2Bn9xqUeoZ5e0t'.
+	    'LzYYZ3B092ndjtOnmKTmycW1s7SHa+l5dtB8zlccE6RlN0dGbM'.
+	    'mDVbd5KupNBcL6+F82XgHouLj5vRP2PWLGNdd4+ppnxe8tJec6'.
+	    'XnNsKkm0uVQ5RDRHQTPTym68nPlZbvkfYCexsa5rpJ2qXa5Umm'.
+	    'ocmec3m8vHjmSs+fgxyhC5JDQ8WSPT2lvbzm8vDIe0nbtiBLN8'.
+	    '8BigNdu1B6Lsje+fPbUFMLi5TMfGmvHi/puUAv23q2YCTFNqH5'.
+	    'MvPnSwPh3HasCbm3XUpv+nS5VtrkEkwAANSTpGHdye9PAAAASn'.
+	    'RFWHRzaWduYXR1cmUANGJkODkyYmE4MWZhNTk4MTIyNDJjNjUx'.
+	    'NzZhY2UxMDAzOGFhZjdhZWIyNzliNTM2ZGFmZDlkM2RiNDU3Zm'.
+	    'NlNT9CliMAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bl_purple.png
+//==========================================================
+	$this->imgdata_large[4][0]= 1149 ;
+	$this->imgdata_large[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAACAV'.
+	    'BMVEX/////////7///5///1v//xv//rf//pf//lP//jP//hP//'.
+	    'c///a///Wv//Wvf/Uv//Sv//Qv//Qvf/Off/Mf//Kf//If//If'.
+	    'f/GP//GPf/EP//EPf/CP//CPf/CO//AP//APf3Oe/3Kff3Ke/3'.
+	    'Ie/3GO/3EO/3AO/vSu/vSufvOefvMefvIefvGOfvEOfvCOfvAO'.
+	    'fnUufnSufnMd7nId7nGN7nGNbnEN7nCN7nAN7ejN7ejNbec97e'.
+	    'c9beUtbeQtbeIdbeGNbeENbeCNbeANbWpdbWa9bWQs7WGM7WEM'.
+	    '7WCM7WAM7Otc7Orc7OnM7OSsbOIb3OGMbOEMbOCMbOAM7OAMbG'.
+	    'pcbGnMbGe8bGa8bGKbXGEL3GCL3GAL3FucXBu73AvsC/v7+9pb'.
+	    '29Ka29GLW9ELW9CLW9AL29ALW5rrm1lLW1e7W1MbW1GKW1EK21'.
+	    'CLW1CK21AK2tjK2thKWtMaWtIaWtGJytCK2tCKWtAK2tAKWlhK'.
+	    'Wle6WlEJylCJylAKWlAJyca5ycGJScEJScCJScAJycAJSUWpSU'.
+	    'UoyUKZSUEIyUCIyUAJSUAIyMUoyMSoyMIYSMEISMCISMAIyMAI'.
+	    'SECHuEAISEAHt7MXt7EHt7CHt7AHt7AHNzKXNzEGtzAHNzAGtr'.
+	    'GGtrEGNrCGtrAGtrAGNjCFpjAGNjAFpaAFpaAFIpZn4bAAAAAX'.
+	    'RSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsS'.
+	    'AdLdfvwAAAAHdElNRQfTAwkRFB0ymoOwAAAB9UlEQVR4nGNgIA'.
+	    'K42hhqGtm5+WFIWClKycvLK6gbuARGoEj4aMjLSElISUir6Tt7'.
+	    'x+aEIWR8leQlwEBSTc/CK7awLguuR0lGQkJMVFRUTFJVzwko1d'.
+	    'oFk9OQl5IQE+Dh5hVR0TV3CkkvbJgyASJjDZIR5GBl5eRX0TH1'.
+	    'DEqrbJ2ypBEspSgvJSXKw8bMxMavbOLoGZNf1TZlybw4oIyfLN'.
+	    'BxotxsLEzsQiaOHkFpBQ2905esrAZK2SpIAaUEuDm5+LTNPAKj'.
+	    'C+pbps1evrIDKGWnLictKSkuLKyoZQyUya9o7Z2+YMXKGUApew'.
+	    'M9PTVdXR0TEwf3wOjUirruafOXL18xFyjl72Kpb25qaurg4REU'.
+	    'EFVe2zJ5zpLlK1aCpbydnZ2dnDwDA6NTopLLeiZNXbB8BcTAyP'.
+	    'TQ0JDg4KCY1NS83JKmiVOBepYvX9UPlAovzEiPSU/LLyior2vq'.
+	    'mjZr3vLlIF01IC+XVhUWFlZW1Lc290ycOGfxohVATSsXx4Oksn'.
+	    'vaWlsb2tq6J0+bM2/RohVA81asbIcEYueU3t7JU6ZNnwNyGkhm'.
+	    '+cp5CRCppJnzZ8+ZM3/JUogECBbBIixr8Yqly8FCy8F6ltUgoj'.
+	    'lz7sqVK2ByK+cVMSCDxoUrwWDVysXt8WhJKqG4Y8bcuTP6qrGk'.
+	    'QwwAABiMu7T4HMi4AAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bl_gray.png
+//==========================================================
+	$this->imgdata_large[5][0]= 905 ;
+	$this->imgdata_large[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAABO1'.
+	    'BMVEX////////3///39/fv7+/e5+fW3t7Wzs7WxsbG1tbGzsbG'.
+	    'xsbDxMS/v7++wMC+v7+9zsa9xsa9vb29tbW9ra29pa24uLi1xs'.
+	    'a1vb21tbWxtrattbWmpqalra2cra2cpaWcnJycjIyUpaWUnJyU'.
+	    'lJSUjIyMnJyMnJSMlJSMlIyMjJSMjIyElJSElIyEjIyEhIR7jI'.
+	    'x7hIR7hHt7e3t7e3N7e2tzhIRze3tze3Nzc3Nre3trc3Nrc2tr'.
+	    'a2tjc3Njc2tja3Nja2tjY2NjWlpaa2taY2taY2NaY1paWlpaUl'.
+	    'JSY2NSY1pSWlpSWlJSUlJSUkpKWlpKWlJKUlpKUlJKUkpKSkpK'.
+	    'SkJCUlJCUkJCSkpCSkJCQkI5Sko5QkI5Qjk5OUI5OTkxQkIxOT'.
+	    'kxMTkxMTEpMTEhMTEhKSkYISEpy7AFAAAAAXRSTlMAQObYZgAA'.
+	    'AAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdE'.
+	    'lNRQfTAwkRFQfW40uLAAABx0lEQVR4nI3SbXfSMBQA4NV3nce5'.
+	    'TecAHUywRMHSgFuBCFsQUqwBS1OsWQh0GTj//y8wZUzdwQ/efM'.
+	    'tzcm/uuXdj4z9ic/PR9k4qk1qDnf0X2/uZzKt8GaRvSubg4LVp'.
+	    'mkWzCGAT/i3Zsm2XNQHLsm2n2937LaaNnGoJFAEo27B50qN0ay'.
+	    'Wg26lXsw8fP8nmzcJb2CbsnF5JmmCE8ncN404KvLfsYwd7/MdV'.
+	    'Pdgl/VbKMIzbuwVgVZw2JlSKJTVJ3609vWUY957lgAUd1KNcqr'.
+	    'yWnOcOPn8q7d5/8PywAqsOOiVDrn42NFk+HQ7dVuXNYeFdBTpN'.
+	    'nY5JdZl8xI5Y+HXYaTVqEDp1hAnRohZM03EUjMdhn5wghOoNnD'.
+	    'wSK7KiiDPqEtz+iD4ctdyAifNYzUnScBSxwPd6GLfRURW7Ay5i'.
+	    'pS5bmrY8348C5vvUI+TLiIVSJrVA0heK/GDkJxYMRoyfCSmk4s'.
+	    'uWc3yic/oBo4yF374LGQs5Xw0GyQljI8bYmEsxVUoKxa6HMpAT'.
+	    'vgyhU2mR8uU1pXmsa8ezqb6U4mwWF/5MeY8uLtQ0nmmQ8UWYvb'.
+	    'EcJaYWar7QhztrO5Wr4Q4hDbAG/4hfTAF2iCiWrCEAAAAASUVO'.
+	    'RK5CYII=' ; 
+
+//==========================================================
+// File: bl_brown.png
+//==========================================================
+	$this->imgdata_large[6][0]= 1053 ;
+	$this->imgdata_large[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAMAAADzN3VRAAABoV'.
+	    'BMVEX////Gzs7GvbXGrZTGpXu9nHO1nHO1nIy9taXGxs7GtaXO'.
+	    'nHPGlFrGjEq9hEq1hEqte0Klczmcazmce1KtnIzGxsbGvb3OlF'.
+	    'LOlFq9hFKte0qcc0KUYzGEWimMc1K9ta3OnGvOnGPWnGO9jFq9'.
+	    'jFKlc0KUazmMYzl7UilzUjGtpZzGxr3GnGPWpWvepXO1hFJ7Wj'.
+	    'FrSiFjUjG1ra3GnHPvxpT/5733zpythFKUa0KEYzlzUilaOSF7'.
+	    'Wjm9jErvvYz/99b///f/78bnrYS1hFqle0p7UjFrSiljQiFCMR'.
+	    'iMhHO9lGvGjFLWnGv/3q3////erXuthEqlc0paQiFKMRhSQin/'.
+	    '1qX/997//++cc0pjSilaQilKORhCKRiclIy9pYzGlGPntYT33q'.
+	    '3vvZSEWjlSOSE5KRB7c2O1lHutczmthFqte1JrWkqtjGtCKRBa'.
+	    'SjmljGuca0KMYzGMaznOztaclISUYzmEWjFKOSF7a1qEYzFaSi'.
+	    'GUjISEa0pKOSm9vb2llIxaQhg5IQiEc2tzY0paORilnJy1raVS'.
+	    'OSljUkJjWkKTpvQWAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHU'.
+	    'gAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkREiei'.
+	    'zP2EAAAB9UlEQVR4nGWS/VfSUBjHL5QluhhBxtwyWcCus5Blpm'.
+	    'wDC4ONaWXCyBi7RMZmpQ2Bypm9W/byV3cHHo/W88s95/s5z/d5'.
+	    'uwCcCh/4L3zAf+bs0NC588On9QAYGSUuBINk6GI4cmnsBLk8Go'.
+	    '1SFEGMkzRzZeLq5JE8FvDHouw1lqXiCZJOcnCKnx4AcP0GBqmZ'.
+	    'mRgRT9MMB4Wbs7cGSXNRik3dnp9fiMUzNCNKgpzN9bsaWaQo9s'.
+	    '7dfH7pXiFTZCBU1JK27LmtBO8TDx7mV1eXHqXXyiIUFLWiVzHx'.
+	    'BxcJIvV4/cn6wkqmWOOwmVE3UQOAp6HxRKL5bGPj+VwhUhalFq'.
+	    '8alm5vAt+LlySZTsebzcKrraIIW4JqZC3N3ga+1+EQTZKZta1M'.
+	    'pCZCSeDViqVrThsEdsLJZLJYLpZrHVGScrKBvTQNtQHY6XIM02'.
+	    'E6Ik7odRW1Dzy3N28n3kGuB3tQagm7UMBFXI/sATAs7L5vdbEs'.
+	    '8Lycm923NB0j5wMe6KOsKIIyxcuqauxbrmlqyEWfPmPy5assY1'.
+	    'U1SvWKZWom9nK/HfQ3+v2HYZSMStayTNN0PYKqg11P1nWsWq7u'.
+	    '4gJeY8g9PLrddNXRdW8Iryv86I3ja/9s26gvukhDdvUQnIjlKr'.
+	    'IdZCNH+3Xw779qbG63f//ZOzb6C4+ofdbzERrSAAAAAElFTkSu'.
+	    'QmCC' ; 
+
+//==========================================================
+// File: bl_darkgreen.png
+//==========================================================
+	$this->imgdata_large[7][0]= 1113 ;
+	$this->imgdata_large[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAB2l'.
+	    'BMVEX////////3///v///n/+/e99bW/+/W99bO786/v7++vr69'.
+	    '/96999a7wb24vbu1/9a1zqW1u7itxrWosq6l772l1qWlxrWlxq'.
+	    '2lva2cxpSU562U3q2UxqWUvaWUpZyM77WM57WMvYyMtZyMrZyM'.
+	    'pZSMnJSEvZyEtYyErZSElIx7zpR7xpx7xpR7vZR7jIRz1pRzxp'.
+	    'RzjIRrzpRrzoxrxoxrtYRrrYxrrXtrpYRrhHNjzoxjxoxjxoRj'.
+	    'vYRjtYRjrXtjpXtjlGNje2tazoxazoRaxoxaxoRavYRatYRatX'.
+	    'tarXtapXNanHNajFpae2tSzoRSxoRSvXtStXtSrXtSrXNSpXNS'.
+	    'nHNSnGtSlGtSlGNSjGtSjGNKvXtKtXNKrXNKpWtKnGtKlGNKjG'.
+	    'NKhGNKhFJKc1pKa1JCrWtCpWtCnGtClGNCjGNCjFpChFpCe1JC'.
+	    'a1JCY1I5pWs5nGM5lGM5jFo5hFo5e1o5c0o5WkoxjFoxhFoxhF'.
+	    'Ixe1Ixc1Ixc0oxa0ophFIpe0opc0opa0opa0IpY0IpWkIpWjkp'.
+	    'UkIpUjkhc0oha0IhY0IhWjkhWjEhUjkhUjEhSjEhSikhQjEhQi'.
+	    'kYWjkYSjEYSikYQjEYQikQSikQQikQQiEQOSExf8saAAAAAXRS'.
+	    'TlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAd'.
+	    'LdfvwAAAAHdElNRQfTAwkRFCaDkWqUAAAB+ElEQVR4nI3S+1vS'.
+	    'UBgHcGZlPV0ks/vFrmQWFimJjiwiYUJWjFBWFhClyZCy5hLrwA'.
+	    'x2EIwJC1w7zf2vnU0re+iHvs9++7x7zznvORbLf+TA6ct9fYMX'.
+	    'jrfAUYefpp+/iM1ykxf/lmuhUZ/PTwXC8dml5Wcd23o5H5Mk6b'.
+	    '5NUU8icXbhS67rNzn9JDnguOEYGQtEEtwC+Crs3RJ76P5A/znr'.
+	    'vsNX7wQnEiwHCtK7TTkW8rvdZ9uJtvZTLkxpHhSrP66bNEj7/P'.
+	    '3WNoLYeeSWQQCIpe9lQw7RNEU5rDsIYtcJ14Nocg7kRUlBNkxn'.
+	    'YmGKcp7cv3vPwR7XOJPmc0VYU3Sv0e9NOBAYG7Hbz/cMjTMveZ'.
+	    'CHkqxuTBv0PhYJB4N3XR6PJ5rMAPMnpGUxDX1IxSeMTEaZp1OZ'.
+	    'nGAIQiYtsalUIhFlmGTy3sO3AizJCKn6DKYryxzHsWyaneMzr6'.
+	    'cWxRVZVlFTe4SpE3zm+U/4+whyiwJcWVMQNr3XONirVWAklxcE'.
+	    'EdbqchPhjhVzGpeqhUKhWBQhLElr9fo3pDaQPrw5xOl1CGG1JE'.
+	    'k1uYEBIVkrb02+o6RItfq6rBhbw/tuINT96766KhuqYpY3UFPF'.
+	    'BbY/19yZ1XF1U0UNBa9T7rZsz80K0jWk6bpWGW55UzbvTHZ+3t'.
+	    'vbAv/IT+K1uCmhIrKJAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bl_green.png
+//==========================================================
+	$this->imgdata_large[8][0]= 1484 ;
+	$this->imgdata_large[8][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMMFjM4kcoDJQAABVlJREFUeNq9ll2MJFUVx3/11V'.
+	    'Vd/TE9vU0v4zLDwJIF16jBqLAPhsRXEiDqg0QTJiQSjcSNvCzw'.
+	    'sBEDDxizhvAAxBgf1oR9QF9NiE9ESFZkQyZB5WtddmdnZ3qqqr'.
+	    'uqbt367Cofqu3ZZpWVaDzJfbkf53//55z/PVdZXV3l/2H6f7Lp'.
+	    '5VdOV/4Nb+GmHpUeA7AdBNxc3kafNb73jRPK9Xwon8ToxVefqU'.
+	    'b91wibH5EkCQBCizFihTSviHUHR0hWws9xe3wvJ7/7nPKpgX5y'.
+	    '9oFqt3eOgWniRBoAbUBGGqZUibSYaeoT2B5bnkdaSA6793Cv/S'.
+	    'QPPbihXBfo5VdOV+8dfgnvwAU62YH5fCZ12sDujFkwyegCqTrB'.
+	    'iUOKTOJKj8jr88jS8zy6cXwBTP048nuHX0I0nDlIp7RpTG7kM0'.
+	    'sdyAYsTVukUuWGhlWHMq0ITL92lnUp9R1Obz/GmTNnqn9bDD8/'.
+	    '+0D1oX0O0zQZZDYCsK2j3Gl9jQqDfHiei8GfiKVLlsZkJaBAN1'.
+	    '0i6PgwUbB0GxG5/PrtE/xLRr959Znqw9452oVNI+jiJhnr1pe4'.
+	    'k29zB1/nFr5Kj7tpt1YYhJ0FJ7nUYbcJQBgahN2MzeCP/OipR6'.
+	    'prgN6Qr6ELFQFUWoRpNVjlKwxZB8DCpE+PtfEKqV1cUzxpVudu'.
+	    'GTBHA5Y1g99e+dUio9O/P1Vpq+/WE5GGjDSMoAtAQjrf3C52IP'.
+	    'QxpY4WK2hpReka9Gfrhqgz0bACRoCWjDh56kQ1z9FeuUUQxVhK'.
+	    'B92sD1VahM+bAJgcoJhGjP/6Ln8rAgDiRCVRKiIzxMkkodBJ85'.
+	    'im1IlEHbE4k1xyNveL4YP8HarmGJIOpqyjeQmfNHmTvnqZTWBt'.
+	    'vIJXpPwlukJSuSTKGK3pEwtJmiX00ZlInTyNscImO6XBITvH1c'.
+	    '8vVt2OucdKvIyeKRTNCivsEMgcpg6taYs30nfq0Gqg6hOSSFJ4'.
+	    'BSnJPht0IqEjWmOGocEI6F0J94F0qaL6BntTF0MtUfweKQKAPU'.
+	    'Wwp4OcVnQAmVb0p9DLOzjEhEKnGRmoRc7EzRGlwA6NujAKG4yP'.
+	    '6Sjwc4aVznZ7DK0xXdkDoJf0kGmFBniFBOBGcZSCCSKd0IwN0k'.
+	    'IS+QZWCGVZex4BnUxya3+Zt9iugQbcRFpIAtuHvAZulPUdLhUJ'.
+	    'RqegI3WcqaSXddlT3idsWMSRRGkEtNwmyTifAwyBo7LP+11J0e'.
+	    '7tM7pZOYblHkBLcqZ5LcYtw6Wbd4CM3SpE9foYZsIHoqDKCrbz'.
+	    'mLSQtPwmuhXgtBLs0GBdbXOhFGB7WBKO2F8GXt9/VO97Ya3atF'.
+	    '7nUHnwGjGGQqcPxFEdFqURkEidiZszAERoYIsGju1hq21kWee3'.
+	    'bw15+8WpsvAy3K1+i3JkkhZyPpxxjjPOsfOYiZ+TFhLPzQnHOU'.
+	    'tpzGB2dgA4tscIkKIx19Cxg/fPL7vQJu47eXt1VvsDK8pwPueZ'.
+	    'PuZoQMOqhRoJHSs0kKLBWjvjYinmeQGw1TaX1RFdfZ3LMzYLjA'.
+	    'C++dkn6AaH2Nobk6cxEzdnuG0TdC8zvdJkN0hqkFkO/jwL0fxa'.
+	    'so8sBcuFzQ+/+MRC+BeAHnpwQzn++ee5KT9Eshuy46dcKAXm32'.
+	    '0uzPQhS4GttkH2GQID2Wc0Y4LtAbDxhZ/x5A+e/uTG9+jGceXH'.
+	    '9/ySnnIXnUzOxXe1038mW3ZynNmam4yYWkO+f9cv+Oljz16/lV'.
+	    '9tDz/9nerc1hm8ZEScSRK7VvtYl1i1dklsOKyvc+zg/bzw1O8+'.
+	    '/efkajt56kR1ydlEJBc5H46xzbrJ3dY9wrB7hGcff+6/+279L+'.
+	    '0fHxyiE8XMLl4AAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bl_blue.png
+//==========================================================
+	$this->imgdata_large[9][0]= 1169 ;
+	$this->imgdata_large[9][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAACEF'.
+	    'BMVEX/////////7//35//v1v/exv/Wvf/Wrf/Wpf/Orf+/v7+9'.
+	    'tc69jP+9hP+5ucW1tc6tlP+rq7Wlpdalpcalpb2cnM6cnMacc/'.
+	    '+cWv+UlLWUjN6UjK2Uc/+Ma/+MUv+EhKWEa/+EQvd7e8Z7e7V7'.
+	    'e6V7c957Wv9za9Zza8ZzSv9ra5xrSv9rOf9rMe9jUudjQv9jOe'.
+	    '9aWpRaUt5aUpRaSu9aSudSUoxSSs5SSoxSMf9KQtZKOfdKMedK'.
+	    'Kf9KKe9CKf9CKb1CKa1CIfdCIedCId45MXs5Kfc5If85Iec5Id'.
+	    'Y5GP8xMbUxMXsxKc4xKZQxIf8xGP8xGO8xGN4xGNYxGL0xGK0p'.
+	    'KXMpIYwpGP8pGO8pGOcpGNYpGM4pEP8pEPcpEOcpEN4pENYpEM'.
+	    'YpEL0hGKUhEP8hEPchEO8hEOchEN4hENYhEM4hEMYhELUhCP8h'.
+	    'CO8hCN4YGJwYGGsYEL0YEK0YEHMYCN4YCM4YCMYYCL0YCKUYAP'.
+	    '8QEJQQEIwQEHsQEGsQCM4QCLUQCK0QCKUQCJwQCJQQCIwQCHMQ'.
+	    'CGsQAP8QAPcQAO8QAOcQAN4QANYQAM4QAMYQAL0QALUQAKUQAJ'.
+	    'QQAIQICGsICGMIAO8IANYIAL0IALUIAK0IAKUIAJwIAJQIAIwI'.
+	    'AIQIAHsIAHMIAGsIAGMAAN4AAMYAAK0AAJQAAIwAAIQAAHMAAG'.
+	    'sAAGMAAFrR1dDlAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkRFRPMOZ'.
+	    '/2AAAB+klEQVR4nGNgIAIIqeqZmBqpi2JISNml5lVXV3d198Yo'.
+	    'oUjwm1SnxsbGRsSm5ZfNXO4tjCTjVh0ABhFx6QV9E1Y0S8JkuN'.
+	    '3yAgLc7W3t/QPi4jPKJ8ye1yoIlTKpjvVy15eVUbN0i4zKLJ8w'.
+	    'ae6qcKgLqmMj3PUFWFl5NJ0CExLLJzbNW7BWCyxlXR0ba6/Axs'.
+	    'zELmfnkRBT0QiSKgXJCOflxUbYy3KyMHEoOrtEZ1c2TZ6/cMl6'.
+	    'eaCUamdsbIC7tjgPr4SBS3BMMVDTwkXr1hsDpYy6UmMj/O0tdX'.
+	    'QNbDxjknJLWqYsXLx0vStQynxGflpkZGCgs7Onp29SbtNkoMy6'.
+	    'pevCgFJWy3oyMuKjgoKCPWNCvEuqWhcsWrJ06XqQlPnMvrKyrM'.
+	    'TomJjkZAfHlNa2qdOWrlu63gcopbG8v7+hvLwip7g4JdSxsLZu'.
+	    '8dKlS9ettwBKic2eNXHChIkTG5tKqgpr2uo6loLAehWQx0LnzJ'.
+	    '49p6mpeXLLlNq6RUvqly6dvnR9Bx9ISnnlvLmT582bMr9t4aL2'.
+	    '+vrp60GaDCGB6Ld6wfwFCxYCJZYsXQ+SmL6+FBryInVrFi1atH'.
+	    'jJkqVQsH6pNCzCJNvXrQW6CmQJREYFEc2CYevXrwMLAyXXl0oz'.
+	    'IAOt0vVQUGSIkabkDV3DwlzNVDAksAAAfUbNQRCwr88AAAAASU'.
+	    'VORK5CYII=' ; 
+
+//==========================================================
+// File: bs_red.png
+//==========================================================
+	$this->imgdata_small[0][0]= 437 ;
+	$this->imgdata_small[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAk1'.
+	    'BMVEX////////GxsbGra3/xsbOhITWhIT/hIT/e3v/c3P/a2vG'.
+	    'UlK1SkrOUlL/Y2PWUlLGSkrnUlLeSkrnSkr/SkqEGBj/KSmlGB'.
+	    'jeGBjvGBj3GBj/EBD/CAj/AAD3AADvAADnAADeAADWAADOAADG'.
+	    'AAC9AAC1AACtAAClAACcAACUAACMAACEAAB7AABzAABrAABjAA'.
+	    'BuukXBAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZ'.
+	    'cwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGDNEMgOYAAAAm0'.
+	    'lEQVR4nI3Q3RKCIBAFYGZMy9RKzX7MVUAUlQTe/+kS0K49d3wD'.
+	    '7JlFaG+CvIR3FvzPXgpLatxevVVS+Jzv0BDGk/UJwOkQ1ph2g/'.
+	    'Ct5ACX4wNT1o/zzUoJUFUGBiGfVnDTYGJgmrWy8iKEtp0Bpd2d'.
+	    'jLGu56MB7f4JOOfDJAwoNwslk/jOUi+Jts6RVNrC1hkhPy50Ef'.
+	    'u79/ADQMQSGQ8bBywAAAAASUVORK5CYII=' ; 
+
+
+//==========================================================
+// File: bs_lightblue.png
+//==========================================================
+	$this->imgdata_small[1][0]= 657 ;
+	$this->imgdata_small[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAABVl'.
+	    'BMVEX////////d///AwMC7wcS08P+y+P+xxdCwxM+uws2twMur'.
+	    'vsinzNynytylzuKhyN6e5v6d5P+d1fOcwNWcu8ub4f+at8iZ3v'.
+	    '+ZvdGY2/yW2f+VscGU1vuT1fqTr72Sx+SSxeKR0fWRz/GPz/OP'.
+	    'rr+OyeqMy+6Myu2LyeyKxueJudSGw+SGorGDvt+Cvd6CvN2Aud'.
+	    'p+uNd+t9Z9tdV8tdR8tNN6sc94r813rct2q8h0qcZ0qMVzp8Rx'.
+	    'o8Bwor5tn7ptnrptnrlsnbhqmbRpmbNpi51ol7Flkqtkkqtkka'.
+	    'pjj6hijaRhjaZgi6NfiqJfiaFdh55bhJtag5pZgphYgJZYf5VX'.
+	    'cn9Ve5FSeI1RdopRdYlQdYlPc4dPcoZPcoVNcINLboBLbH9GZn'.
+	    'hGZXdFZHZEY3RDYnJCXW4/W2s/WWg+Wmo7VmU7VGM7U2E6VGM6'.
+	    'VGI5UV82T1wGxheQAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHU'.
+	    'gAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGTok'.
+	    '9Yp9AAAAtElEQVR4nGNgIBaw8wkpKghzwvksPAKiUsraprYiLF'.
+	    'ARXkE2JiZ1PXMHXzGIAIekOFBE08TGLTCOCyzCLyvDxsZqZOnk'.
+	    'E56kAhaRV9NQUjW2tPcMjs9wBYsY6Oobmlk7egRGpxZmgkW0zC'.
+	    '2s7Jy9giKT8gohaiQcnVzc/UNjkrMLCyHmcHr7BYREJKTlFxbm'.
+	    'QOxiEIuKTUzJKgQCaZibpdOzQfwCOZibGRi4dcJyw3S4iQ4HAL'.
+	    'qvIlIAMH7YAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bs_gray.png
+//==========================================================
+	$this->imgdata_small[2][0]= 550 ;
+	$this->imgdata_small[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAMAAADH72RtAAABI1'.
+	    'BMVEX///8AAAD8EAD8IAD8NAD8RAD8VAAYGBi/v7+goKCCgoJk'.
+	    'ZGRGRkb8yAD83AD87AD8/AD4+ADo+ADY+ADI+AC0+ACk+ACU+A'.
+	    'CE+AB0/ABk/ABU/ABE/AAw/AAg/AAQ/AAA/AAA+AAA6BAA2CAA'.
+	    'yDQAtEQApFQAlGQAhHQAdIgAZJgAVKgARLgAMMgAINwAEOwAAP'.
+	    'wAAPgIAPAQAOgYAOAkANgsANA0AMg8AMBEALhMALBUAKhcAKBo'.
+	    'AJhwAJB4AIiAAID////4+Pjy8vLs7Ozm5ubg4ODa2trT09PNzc'.
+	    '3Hx8fBwcG7u7u1tbWurq6oqKiioqKcnJyWlpaQkJCJiYmDg4N9'.
+	    'fX13d3dxcXFra2tkZGReXl5YWFhSUlJMTExGRkZAQEA1BLn4AA'.
+	    'AAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIA'.
+	    'AAsSAdLdfvwAAAAHdElNRQfTAwkUGiIctEHoAAAAfElEQVR4nI'.
+	    '2N2xKDIAwF+bZ2kAa8cNFosBD//yvKWGh9dN+yk9kjxH28R7ze'.
+	    'wzBOYSX6CaNB927Z9qZ66KTSNmBM7UU9Hx2c5qjmJaWCaV5j4t'.
+	    'o1ANr40sn5a+x4biElrqHgrXMeac/c1nEpFHG0LSFoo/jO/BeF'.
+	    'lJnFbT58ayUf0BpA8wAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bs_greenblue.png
+//==========================================================
+	$this->imgdata_small[3][0]= 503 ;
+	$this->imgdata_small[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAxl'.
+	    'BMVEX///////+/v79znJQhSkJ7raU5hHtjraVKnJRCjIRClIyU'.
+	    '9++E595avbVaxr2/v7+ctbWcvb17nJxrjIx7paUxQkK9//+Mvb'.
+	    '17ra2Evb17tbVCY2MQGBiU5+ec9/eM5+d71tZanJxjra1rvb1j'.
+	    'tbVSnJxara1rzs5jxsZKlJRChIQpUlIhQkJatbVSpaU5c3MxY2'.
+	    'MYMTEQISFavb1Sra1KnJxCjIw5e3sxa2spWlpClJQhSkoYOTkp'.
+	    'Y2MhUlIQKSkIGBgQMTH+e30mAAAAAXRSTlMAQObYZgAAAAFiS0'.
+	    'dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfT'.
+	    'AwkUGTIqLgJPAAAAqklEQVR4nI2QVxOCMBCEM6Mi2OiCvSslJB'.
+	    'CUoqjn//9TYgCfubf9Zu9uZxFqO+rscO7b6l/LljMZX29J2pNr'.
+	    'YjmX4ZaIEs2NeiWO19NNacl8rHAyD4LR6jjw6PMRdTjZE0JOiU'.
+	    'dDv2ALTlzRvSdCCfAHGCc7yRPSrAQRQOWxKc3C/IUjBlDdUcM8'.
+	    '97vFGwBY9QsZGBc/A4DWZNbeXIPWZEZI0c2lqSute/gCO9MXGY'.
+	    '4/IOkAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bs_yellow.png
+//==========================================================
+	$this->imgdata_small[4][0]= 507 ;
+	$this->imgdata_small[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAzF'.
+	    'BMVEX///////+/v79zYwCMewDOxoTWzoTezkr/5wj/5wDnzgDe'.
+	    'xgC1pQCtnACllACcjACUhABjWgDGvVK1rUrOxlLGvUqEexilnB'.
+	    'jv3hj35xj/7wj/7wD35wDv3gDn1gDezgDWxgDOvQDGtQC9rQCE'.
+	    'ewB7cwBzawBrYwDWzlLn3lLe1krn3kre1hi9tQC1rQCtpQClnA'.
+	    'CclACUjACMhAD/9wC/v7///8bOzoT//4T//3v//3P//2v//2Pn'.
+	    '50r//0r//yn39xj//xD//wBjYwDO8noaAAAAAXRSTlMAQObYZg'.
+	    'AAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAH'.
+	    'dElNRQfTAwkUGSDZl3MHAAAAqElEQVR4nI3QWRNDMBAA4My09E'.
+	    'IF1SME0VT1okXvM/3//6kEfbZv+81eswA0DfHxRpOV+M+zkDGG'.
+	    'rL63zCoJ2ef2RLZDIqNqYexyvFrY9ePkxGWdpvfzC7tEGtIRly'.
+	    'nqzboFKMlizAXbNnZyiFUKAy4bZ+B6W0lRaQDLmg4h/k7eFwDL'.
+	    'OWIky8qhXUBQ7gKGmsxpC+ah1TdriwByqG8GQNDNr6kLjf/wAx'.
+	    'KgEq+FpPbfAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bs_darkgray.png
+//==========================================================
+	$this->imgdata_small[5][0]= 611 ;
+	$this->imgdata_small[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAMAAAAMCGV4AAABJl'.
+	    'BMVEX////////o8v/f6O7W4OnR3PXL1OTL0evEyLvCzePAwMC/'.
+	    'v7a8wsq7t7C1xum1vtS1q6GzopmyxeKsrsOqvNWoq7anvN+nsb'.
+	    'qhrcGgqbGfpq6cp7+bqMuVmJKRm7yPlKKMnL6FkKWFipOEkLSE'.
+	    'j6qEhoqAiaB+jqd8haF7hZR4iJt4g5l3hZl2gIt2cod1hJVzeY'.
+	    'VzboJvhp9sfJJsb41peY1pd5xpdoVod4xndI5lcHxka4BjcYVg'.
+	    'Z3BfboFbb4lbZnZbYntaZ4laZYVZV3JYYWpXX3JWWm5VX4RVW2'.
+	    'NUYX9SXHxPWn5OVFxNWWtNVXVMVWFKV3xHUGZGU3dGTldFSlxE'.
+	    'Sk9ESXBCRlNBS3k/SGs/RU4+R1k9R2U6RFU2PUg0PEQxNU0ECL'.
+	    'QWAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAA'.
+	    'CxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGQmbJetrAAAAtklEQV'.
+	    'R4nGNgwAK4JZTNNOWlYDxhMT4ZDTOzQE1uMF9CiJWVU0LbxDlS'.
+	    'G8QVF+FnZ2KRNHAIiPUHaZGSlmZj5lH19A1KjLUA8lXU5MWllF'.
+	    'yjo30TYr2BfG19G11b37CEeN84H38gX1HbwTUkOjo+zjfG3hLI'.
+	    'l1exCvCNCwnxjfMz0gTyRdXNHXx9fUNCQu2MwU6SN3ZwD42LCH'.
+	    'W30IK4T8vUJSAkNMhDiwPqYiktXWN9JZj7UQAAjWEfhlG+kScA'.
+	    'AAAASUVORK5CYII=' ; 
+
+
+//==========================================================
+// File: bs_darkgreen.png
+//==========================================================
+	$this->imgdata_small[6][0]= 666 ;
+	$this->imgdata_small[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAABX1'.
+	    'BMVEX////////l/+nAwMC86r+8wb28wby8wLy78sCzw7SywrSx'.
+	    'wLKwvrGuvK+syK+ryq2rx62n36ym3aumxKmk2qij0Keh16ahva'.
+	    'Og1aSguKKe06KeuaCetZ+d0KGdtZ+bz6Cay56ZyZ2Zwp2Zr5qZ'.
+	    'rpqYwJuXyZuXrJmVw5mUxZiTxJeTw5eTq5WRwJWPtJKOvZKKuI'.
+	    '6Kt42Kn4yJt42ItIuGsomFsYmEsIiEr4eDr4eBrIR/qoN+qIJ8'.
+	    'poB7pH56o356on14nnt2nXl0mndzmnZzmXZymHVwlXNvlHJukn'.
+	    'FtiHBqjm1qjW1oi2toiWpniWplh2hlhmdkhWdig2VggGNgf2Je'.
+	    'fmFdfGBde19bbl1aeFxXdFpWclhVclhVcVdUcFZTb1VSbVRQal'.
+	    'JPaVFKY0xKYkxJYUtIYEpHX0lEWkZCWERCV0NCVkM/U0A+U0A+'.
+	    'UUA+UEA9Uj89UT48Tj45TDvewfrHAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElN'.
+	    'RQfTAwkUGRjxlcuZAAAAtElEQVR4nGNgIBZw8osqqIpzw/msfI'.
+	    'IiUmr6lo6SbFARASEOJiYtQ2uXADmIAJeEGFBE18LBMySBBywi'.
+	    'LC/LwcFiZuvmH5WiAxZR0tRW1DC3dfYJS8zyAouYGBibWtm7+o'.
+	    'TEpZfkgEX0rG3snNx9Q2NSCksgaqRd3Ty8gyLiU/NKSiDmcPsF'.
+	    'BodHJ2UUlZTkQ+xikIlNSE7LLgECZagL2VQyc0H8YnV2uD94jS'.
+	    'ILIo14iQ4HALarJBNwbJVNAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bs_purple.png
+//==========================================================
+	$this->imgdata_small[7][0]= 447 ;
+	$this->imgdata_small[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAnF'.
+	    'BMVEX///////+/v7/Gvca9rb3Grcb/xv+1hLWte629hL21e7XG'.
+	    'hMbWhNbOe87We9b/hP//e/97OXv/c///a///Y/+cOZz/Sv/WOd'.
+	    'bnOefvOe//Kf9jCGNrCGv/EP//CP/nCOf/AP/3APfvAO/nAOfe'.
+	    'AN7WANbOAM7GAMa9AL21ALWtAK2lAKWcAJyUAJSMAIyEAIR7AH'.
+	    'tzAHNrAGtjAGPP1sZnAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgF'.
+	    'HUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGS'.
+	    'o5QpoZAAAAnElEQVR4nI3Q2xJDMBAG4MyQokWrZz3oSkJISJH3'.
+	    'f7dK0Gv/Xb7J7vyzCK0NjtPsHuH/2wlhTE7LnTNLCO/TFQjjIp'.
+	    'hHAA6bY06LSqppMAY47x+04HXTba2kAFlmQKr+YuVDCGUG2k6/'.
+	    'rNwYK8rKwKCnPxHnVS0aA3rag4UQslUGhrlk0Kpv1+sx3tLZ6w'.
+	    'dtYemMkOsnz8R3V9/hB87DEu2Wos5+AAAAAElFTkSuQmCC' ; 
+
+
+//==========================================================
+// File: bs_brown.png
+//==========================================================
+	$this->imgdata_small[8][0]= 677 ;
+	$this->imgdata_small[8][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAABaF'.
+	    'BMVEX//////////8X/3oD/3nj/1HX/0Gr/xGP/rkv/gBf+iS/2'.
+	    'bAL1agDxaQDuZwDrZwLpZQDmZQLlZADjcx7gZATeYQDdZgraXw'.
+	    'DZXwHYXgDXiEvXZAvUjlfUXwXTjVfTbR7ShUvRbR7RWwDMWQDL'.
+	    'WADKooLKWADJoYLJgkvHWATGoILFn4LFgEvFVgDEZx7EVQDDt6'.
+	    '/DVQDCt6/CnoLChlfCVADAwMC+hFe+UgC8UgC6UQC4gVe4UAC3'.
+	    'gVe3UAC1gFe1eUu1TwC1TgCzTgCwTQKuTACrSgCqSgCpSgCpSQ'.
+	    'CodEulSACkRwCiRgCdRACcRACaQwCYQgCWQgKVQQCVQACUQACS'.
+	    'UR6RPwCOPgCNPQCLPACKPACJOwCEOQCBOAB+NwB9NgB8NgB7NQ'.
+	    'B6NwJ4NAB3RR52MwB0MgBuLwBtLwBsLwBqLgBpLQBkLQJiKgBh'.
+	    'KgBgKwRcKABbKQJbJwBaKQRaJwBYKAJVJQDZvdIYAAAAAXRSTl'.
+	    'MAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLd'.
+	    'fvwAAAAHdElNRQfTAwkUGho0tvl2AAAAtklEQVR4nGNgIBaoSg'.
+	    'mLKGpowfkGMty8AqJKpi4mRlAROR5ONg4JFUv3YHOIgDo/HwsT'.
+	    'q6yps29EsjZYREFIkJ2ZS9/OMzA20wEsIi8uKSZtaOPmH5WSFw'.
+	    'YW0VRW07Vw8vCLSMguLwCL6FlaObp6B0TGZxSXQ9TouHv6+IXG'.
+	    'JGYWlpdDzNEKCgmPjkvLKS0vL4LYxWAen5SelV8OBNZQFxrZ5h'.
+	    'aC+GX2MDczMBh7pZakehkTHQ4AA0Am/jsB5gkAAAAASUVORK5C'.
+	    'YII=' ; 
+
+//==========================================================
+// File: bs_blue.png
+//==========================================================
+	$this->imgdata_small[9][0]= 436 ;
+	$this->imgdata_small[9][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAk1'.
+	    'BMVEX///////+/v7+trcbGxv+EhM6EhNaEhP97e/9zc/9ra/9S'.
+	    'UsZKSrVSUs5jY/9SUtZKSsZSUudKSt5KSudKSv8YGIQpKf8YGK'.
+	    'UYGN4YGO8YGPcQEP8ICP8AAP8AAPcAAO8AAOcAAN4AANYAAM4A'.
+	    'AMYAAL0AALUAAK0AAKUAAJwAAJQAAIwAAIQAAHsAAHMAAGsAAG'.
+	    'ONFkFbAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZ'.
+	    'cwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGhNNakHSAAAAmk'.
+	    'lEQVR4nI3P2xKCIBAGYGfM6SBWo1nauIqogaDA+z9dK9Lhrv47'.
+	    'vtl/2A2CfxNlJRRp9IETYGraJeEb7ocLNKznia8A7Db7umWDUG'.
+	    'sxAzhurxRHxok4KQGqCuEhlL45oU1D2w5BztY4KRhj/bCAsetM'.
+	    '2uObjwvY8/oX50JItYDxSyZSTrO2mNhvGMbaWAevnbFIcpuTr7'.
+	    't+5AkyfBIKSJHdSQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bs_green.png
+//==========================================================
+	$this->imgdata_small[10][0]= 452 ;
+	$this->imgdata_small[10][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAn1'.
+	    'BMVEX///////+/v7+/v7/G/8aUxpSMvYyUzpSMzoyM1oxarVqE'.
+	    '/4R7/3tavVpKnEpaxlpz/3Nr/2tKtUpj/2Na51pKzkpK1kpK50'.
+	    'pK/0oYcxgp/ykYlBgY3hgY7xgY9xgQ/xAI/wgA/wAA9wAA7wAA'.
+	    '5wAA3gAA1gAAzgAAxgAAvQAAtQAArQAApQAAnAAAlAAAjAAAhA'.
+	    'AAewAAcwAAawAAYwA0tyxUAAAAAXRSTlMAQObYZgAAAAFiS0dE'.
+	    'AIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAw'.
+	    'kUGgW5vvSDAAAAnklEQVR4nI3QSxKCMAwA0M4gqCgoiiJ+kEAL'.
+	    'LQUq0PufzX7ENdnlJZNkgtDS2CYZvK6bf+7EoKLA9cH5SQzv6A'.
+	    'YloTywsAbYr44FrlgrXCMJwHl3xxVtuuFkJAPIcw2tGB9GcFli'.
+	    'oqEf5GTkSUhVMw2TtD0XSlnDOw3SznE5520vNEi7CwW9+Ayjyq'.
+	    'U/3+yPuq5gvhkhL0xlGnqL//AFf14UIh4mkEkAAAAASUVORK5C'.
+	    'YII=' ; 
+
+
+//==========================================================
+// File: bs_white.png
+//==========================================================
+	$this->imgdata_small[11][0]= 480 ;
+	$this->imgdata_small[11][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMLFTsY/ewvBQAAAW1JREFUeJytkz2u4jAUhT/jic'.
+	    'gfBUKiZhE0bIKeVbCWrIKenp6eDiGlCEEEBArIxvzGU4xeZjLk'.
+	    'jWb05lRXuvbx+exr4bouX1Xjyw7Atz81F4uFBYjjGIDhcCjq1o'.
+	    'k6nN1uZwFerxfP55Msy1itVmRZBsB4PK6YveHkeW5d18XzPIIg'.
+	    'wPd9Wq0WnU6HMAxJkoQoiuynOIfDwUopkVIihKAoCgAcx6Hdbm'.
+	    'OMIU1T5vN55eBKEikljUYDIX6kFUKU9e8aDAZlmjcca+1b7TgO'.
+	    '1+uVy+VS9nzfr8e53++VzdZaiqIgz3OMMWitOZ/PaK0JgqDeRC'.
+	    'mF53lIKYGfr3O73TDGoJQiTVO01nS73XqT4/FIs9kkCAIej0eZ'.
+	    'brPZEMcxSZKgtQZgMpmIWpN+vy+m06n1PK9yTx8Gy+WS/X5Pr9'.
+	    'er9GuHLYoiG4YhSilOpxPr9Zrtdlti/JriU5MPjUYjq7UuEWaz'.
+	    '2d+P/b/qv/zi75oetJcv7QQXAAAAAElFTkSuQmCC' ; 
+
+
+//==========================================================
+// File: bs_cyan.png
+//==========================================================
+	$this->imgdata_small[12][0]= 633 ;
+	$this->imgdata_small[12][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAABPl'.
+	    'BMVEX////////F///AwMCvxsaC1NSC0dGCz8+CzMyA//94//91'.
+	    '//9q//9j//9X4uJX09NXz89Xx8dXxMRL//9L5uZL3d1L2NhLxs'.
+	    'ZLt7cv//8e9fUe8fEe7u4e398epqYehoYX//8L+PgK//8F9fUE'.
+	    '/v4E5+cEb28EZ2cC//8C/v4C/f0CzMwCrq4Cjo4CdXUCaWkCZW'.
+	    'UB/PwA//8A/f0A+/sA8/MA7e0A7OwA6+sA5eUA5OQA4uIA4eEA'.
+	    '3NwA2toA2NgA1dUA09MA0tIA0NAAysoAxsYAxcUAxMQAv78Avr'.
+	    '4AvLwAtrYAtbUAs7MAsLAAra0Aq6sAqKgApaUApKQAoqIAoKAA'.
+	    'n58AmpoAlZUAk5MAkpIAkJAAj48AjIwAiYkAh4cAf38AfX0Ae3'.
+	    'sAenoAcnIAcHAAa2sAaWkAaGgAYmIUPEuTAAAAAXRSTlMAQObY'.
+	    'ZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAA'.
+	    'AHdElNRQfTAwkUGQDi+VPPAAAAtElEQVR4nGNgIBawikipyIiy'.
+	    'wfksfJpGRkamNtr8LFARPiMFHmFDcztXfwGoFi0jLiZuZRtnry'.
+	    'BddrCIiJEGL6eklYO7X3iCOFhE2thESdHawdUnJDZFDiyiamZh'.
+	    'aevk5h0UlZSpBhaRtbN3dPHwDY5MSM+EqBFzc/f0DgiLTkjLzI'.
+	    'SYw6bjHxgaEZeckZmpD7GLQSAqJj4xNRMIBGFuFtRLA/ENhGBu'.
+	    'ZmDgkJBXl5fgIDocAAKcINaFePT4AAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bs_bluegreen.png
+//==========================================================
+	$this->imgdata_small[13][0]= 493 ;
+	$this->imgdata_small[13][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAvV'.
+	    'BMVEX///////+/v79j//855/8x3v851v9Spb1C1v8AOUqEtcZK'.
+	    'lK1StdYxzv8hxv8AY4QASmNSlK1KpcZKtd4YQlIYnM4YrecIvf'.
+	    '8AtfcAre8AjL0AhLUAc5wAa5QAWnsAQloAKTkAGCFKhJxKrdYY'.
+	    'jL0Ypd4Atf8ArfcApecAnN4AlM4AjMYAe60Ac6UAY4wAUnNSnL'.
+	    '0AlNYAWoQASmsAOVIAITGEtc4YWnsAUnsAMUqtvcaErcYAKUIA'.
+	    'GCkAECHUyVh/AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAA'.
+	    'AJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGxNUcXCT'.
+	    'AAAAqUlEQVR4nI2Q1xKCMBREM2NHLCCogAGCjd6SqLT8/2cZKT'.
+	    '6zb3tm987OBWCsXoejp8rC35fi4+l6gXFZlD0Rz6fZ1tdDmKR9'.
+	    'RdOmkzmP7DDpilfX3SzvRgQ/Vr1uiZplfsCBiVf03RJd140wgj'.
+	    'kmNqMtuYXcxyYmNWJdRoYwzpM9qRvGujuCmSR7q7ARY00/MiWk'.
+	    'sCnjkobNEm1+HknDZgAqR0GKU43+wxdu2hYzbsHU6AAAAABJRU'.
+	    '5ErkJggg==' ; 
+
+//==========================================================
+// File: bs_lightred.png
+//==========================================================
+	$this->imgdata_small[14][0]= 532 ;
+	$this->imgdata_small[14][1]=
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAA3l'.
+	    'BMVEX///////+/v7/Gvb0hGBj/5///3v//zu//1u//xucpGCG9'.
+	    'nK21lKVSQkp7Wms5KTExISlaOUpjQlIhEBj/tdbOhKXnrcbGjK'.
+	    'Wla4TetcbGnK2EWmv/rc73pcZ7UmOcY3vOpbW1jJzenLW9e5Rz'.
+	    'Slq1c4xrQlJSOULGhJz/pcb3nL2chIzOnK33rcbelK3WjKWMWm'.
+	    'vGe5SEUmM5ISnOtb3GrbXerb3vpb2ca3v/rcaUY3POhJxCKTF7'.
+	    'SlrWnK21e4ytc4TvnLXnlK2la3taOUK1lJxrSlLGhJRjQkpSMT'.
+	    'lw+q2nAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZ'.
+	    'cwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAwkUGjoP2Nm+AAAAr0'.
+	    'lEQVR4nGNgIBaYiOk62imYwPnMkiIyso76yhJSzFARMxkRNk49'.
+	    'a3t5OW6oFk1LVkYOfWUHKxUXiEYzLS12DnN3VXkjIRtFsIiSk5'.
+	    '6evqGqhYGKugAfWMRa1FpD2UHeQEXQRlgALCJur+rgbCUNFOAS'.
+	    'hqjRkZe3MpBTcwEKCEPMMTGSs3Xz8OQHCnBBHckt6OJpIyAMBD'.
+	    'wwN/MYc4H4LK4wNzMwmGrzcvFqmxIdDgDiHRT6VVQkrAAAAABJ'.
+	    'RU5ErkJggg==' ;
+
+//==========================================================
+// File: bxs_lightred.png
+//==========================================================
+	$this->imgdata_xsmall[0][0]= 432 ;
+	$this->imgdata_xsmall[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAA3l'.
+	    'BMVEX///////+/v7/Gvb0hGBj/5///3v//zu//1u//xucpGCG9'.
+	    'nK21lKVSQkp7Wms5KTExISlaOUpjQlIhEBj/tdbOhKXnrcbGjK'.
+	    'Wla4TetcbGnK2EWmv/rc73pcZ7UmOcY3vOpbW1jJzenLW9e5Rz'.
+	    'Slq1c4xrQlJSOULGhJz/pcb3nL2chIzOnK33rcbelK3WjKWMWm'.
+	    'vGe5SEUmM5ISnOtb3GrbXerb3vpb2ca3v/rcaUY3POhJxCKTF7'.
+	    'SlrWnK21e4ytc4TvnLXnlK2la3taOUK1lJxrSlLGhJRjQkpSMT'.
+	    'lw+q2nAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZ'.
+	    'cwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAwkUKBOgGhWjAAAAS0'.
+	    'lEQVR4nGNgQAEmunYmEJaMCKe1vBxYzJKVQ9lKBSSupKdnaKGi'.
+	    'zgdkiqs6WKnYcIGYJnK2HvzCwmCNgi42wsLCECNMeXlNUY0HAL'.
+	    'DaB7Du8MiEAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bxs_bluegreen.png
+//==========================================================
+	$this->imgdata_xsmall[1][0]= 397 ;
+	$this->imgdata_xsmall[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAvV'.
+	    'BMVEX///////+/v79j//855/8x3v851v9Spb1C1v8AOUqEtcZK'.
+	    'lK1StdYxzv8hxv8AY4QASmNSlK1KpcZKtd4YQlIYnM4YrecIvf'.
+	    '8AtfcAre8AjL0AhLUAc5wAa5QAWnsAQloAKTkAGCFKhJxKrdYY'.
+	    'jL0Ypd4Atf8ArfcApecAnN4AlM4AjMYAe60Ac6UAY4wAUnNSnL'.
+	    '0AlNYAWoQASmsAOVIAITGEtc4YWnsAUnsAMUqtvcaErcYAKUIA'.
+	    'GCkAECHUyVh/AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAA'.
+	    'AJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAwkUKDVyF5Be'.
+	    'AAAASUlEQVR4nGNgQAFmYqJcEJaEOJ+UrD5YTJKFTZrfGCQuaq'.
+	    'glLWvMaQ5kqujo6hnbKIKYXPr68gp2dmCNJiZAlh3ECGsREWtU'.
+	    '4wF1kwdpAHfnSwAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bxs_navy.png
+//==========================================================
+	$this->imgdata_xsmall[2][0]= 353 ;
+	$this->imgdata_xsmall[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAk1'.
+	    'BMVEX///////+/v7+trcbGxv+EhM6EhNaEhP97e/9zc/9ra/9S'.
+	    'UsZKSrVSUs5jY/9SUtZKSsZSUudKSt5KSudKSv8YGIQpKf8YGK'.
+	    'UYGN4YGO8YGPcQEP8ICP8AAP8AAPcAAO8AAOcAAN4AANYAAM4A'.
+	    'AMYAAL0AALUAAK0AAKUAAJwAAJQAAIwAAIQAAHsAAHMAAGsAAG'.
+	    'ONFkFbAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZ'.
+	    'cwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAwkUJxXO4axZAAAAR0'.
+	    'lEQVR4nGNgQAGskhKsEJaslIi8ijpYTJaDU1FVAyQuKSujoKKh'.
+	    'LQ5kSigpqWro6oOYrOoaWroGBmCNWiCWAdQwUVFWVOMBOp4GCJ'.
+	    's5S60AAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bxs_gray.png
+//==========================================================
+	$this->imgdata_xsmall[3][0]= 492 ;
+	$this->imgdata_xsmall[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAABI1'.
+	    'BMVEX///8AAAD8EAD8IAD8NAD8RAD8VAAYGBi/v7+goKCCgoJk'.
+	    'ZGRGRkb8yAD83AD87AD8/AD4+ADo+ADY+ADI+AC0+ACk+ACU+A'.
+	    'CE+AB0/ABk/ABU/ABE/AAw/AAg/AAQ/AAA/AAA+AAA6BAA2CAA'.
+	    'yDQAtEQApFQAlGQAhHQAdIgAZJgAVKgARLgAMMgAINwAEOwAAP'.
+	    'wAAPgIAPAQAOgYAOAkANgsANA0AMg8AMBEALhMALBUAKhcAKBo'.
+	    'AJhwAJB4AIiAAID////4+Pjy8vLs7Ozm5ubg4ODa2trT09PNzc'.
+	    '3Hx8fBwcG7u7u1tbWurq6oqKiioqKcnJyWlpaQkJCJiYmDg4N9'.
+	    'fX13d3dxcXFra2tkZGReXl5YWFhSUlJMTExGRkZAQEA1BLn4AA'.
+	    'AAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxEA'.
+	    'AAsRAX9kX5EAAAAHdElNRQfTAwkUKC74clmyAAAAQklEQVR4nG'.
+	    'NgQAVBYVCGt5dXYEQ0mOnp5h4QFgVmeri6+4dHxYMVeHoFRUTH'.
+	    'gTUFBIZBWAwMkZEx8bFQM2Lj0UwHANc/DV6yq/BiAAAAAElFTk'.
+	    'SuQmCC' ; 
+
+//==========================================================
+// File: bxs_graypurple.png
+//==========================================================
+	$this->imgdata_xsmall[4][0]= 542 ;
+	$this->imgdata_xsmall[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAABSl'.
+	    'BMVEX////////11P/MqdvKrNfAwMC+u7+9u7+4rr24lsi3rby3'.
+	    'lMe1rLq1o720q7i0oL20ksSzoryyqbaykMGxlb2wkL+vnbiujb'.
+	    '2sjLuri7qpl7GoirWoibenmK2mla6mjLKmhrSllauki7CjhrCj'.
+	    'hLGihLChg6+ggq2fkqadkKOcfqqai6Gag6WYe6WXeqSWeaOTd6'.
+	    'CTd5+Rdp6RdZ6RdZ2Qg5eOc5qMcpiLcZeJb5WIbpOHbZKGbJGE'.
+	    'a4+CaY2AZ4t/Z4p/Zop/Zol+Zol7ZIZ6Y4V5YoR1ZH11X391Xn'.
+	    '9zXX1yXXtxXHtvWnluWXhsV3VqVnNpVXJoVHFnU3BmUm9jUGth'.
+	    'VGdgTmheTGZcS2RcSmRaSWJYR19XRl5SQllRQlhQQVdPQFZOP1'.
+	    'VLPlFJO09IPE5IOk5FOEtEN0lDOEpDOElDNklCNkc/M0XhbrfD'.
+	    'AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACx'.
+	    'EAAAsRAX9kX5EAAAAHdElNRQfTAwkUKCgREfyHAAAATUlEQVR4'.
+	    'nGNgQAEcIko8EBY3M5Ougy+IxSXMwmTsFsAHZMqrSRvZB0W7A5'.
+	    'k6FlYugXEZICaPr394Um4uSAFDRFRCbm4uxAihsDAhVOMBHT0L'.
+	    'hkeRpo8AAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bxs_red.png
+//==========================================================
+	$this->imgdata_xsmall[5][0]= 357 ;
+	$this->imgdata_xsmall[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAk1'.
+	    'BMVEX////////GxsbGra3/xsbOhITWhIT/hIT/e3v/c3P/a2vG'.
+	    'UlK1SkrOUlL/Y2PWUlLGSkrnUlLeSkrnSkr/SkqEGBj/KSmlGB'.
+	    'jeGBjvGBj3GBj/EBD/CAj/AAD3AADvAADnAADeAADWAADOAADG'.
+	    'AAC9AAC1AACtAAClAACcAACUAACMAACEAAB7AABzAABrAABjAA'.
+	    'BuukXBAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZ'.
+	    'cwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAwkUIyjy5SVMAAAAS0'.
+	    'lEQVR4nGNgQAFsUpJsEJastIi8ijpYTJaDU0FVgxXIlJKVUVDR'.
+	    '0BYHMiUUlVQ1dPVBTDZ1dS1dAwOQAgYtbSDLAGIEq6goK6rxAD'.
+	    'yXBg73lwGUAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: bxs_yellow.png
+//==========================================================
+	$this->imgdata_xsmall[6][0]= 414 ;
+	$this->imgdata_xsmall[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAzF'.
+	    'BMVEX///////+/v79zYwCMewDOxoTWzoTezkr/5wj/5wDnzgDe'.
+	    'xgC1pQCtnACllACcjACUhABjWgDGvVK1rUrOxlLGvUqEexilnB'.
+	    'jv3hj35xj/7wj/7wD35wDv3gDn1gDezgDWxgDOvQDGtQC9rQCE'.
+	    'ewB7cwBzawBrYwDWzlLn3lLe1krn3kre1hi9tQC1rQCtpQClnA'.
+	    'CclACUjACMhAD/9wC/v7///8bOzoT//4T//3v//3P//2v//2Pn'.
+	    '50r//0r//yn39xj//xD//wBjYwDO8noaAAAAAXRSTlMAQObYZg'.
+	    'AAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAH'.
+	    'dElNRQfTAwkUIzoBXFQEAAAAS0lEQVR4nGNgQAFsDhJsEJaTo5'.
+	    '2skj5YzMnSSk7ZwBzIlOSUklPiMxYHMnW4FXT5VNVBTDZeXiNV'.
+	    'QUGQAgYBYyBLEGIEq5gYK6rxAH4kBmHBaMQQAAAAAElFTkSuQm'.
+	    'CC' ; 
+
+//==========================================================
+// File: bxs_greenblue.png
+//==========================================================
+	$this->imgdata_xsmall[7][0]= 410 ;
+	$this->imgdata_xsmall[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAxl'.
+	    'BMVEX///////+/v79znJQhSkJ7raU5hHtjraVKnJRCjIRClIyU'.
+	    '9++E595avbVaxr2/v7+ctbWcvb17nJxrjIx7paUxQkK9//+Mvb'.
+	    '17ra2Evb17tbVCY2MQGBiU5+ec9/eM5+d71tZanJxjra1rvb1j'.
+	    'tbVSnJxara1rzs5jxsZKlJRChIQpUlIhQkJatbVSpaU5c3MxY2'.
+	    'MYMTEQISFavb1Sra1KnJxCjIw5e3sxa2spWlpClJQhSkoYOTkp'.
+	    'Y2MhUlIQKSkIGBgQMTH+e30mAAAAAXRSTlMAQObYZgAAAAFiS0'.
+	    'dEAIgFHUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElNRQfT'.
+	    'AwkUJy5/6kV9AAAATUlEQVR4nGNgQAGCyuyCEJaGugKHviVYzF'.
+	    'hO3sxCWwDIVNLTM9PXtpEGMhW12Cy0DR1ATEFLSxZ7BweQAgYd'.
+	    'HUMHBweIEQKiogKoxgMAo/4H5AfSehsAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bxs_purple.png
+//==========================================================
+	$this->imgdata_xsmall[8][0]= 364 ;
+	$this->imgdata_xsmall[8][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAnF'.
+	    'BMVEX///////+/v7/Gvca9rb3Grcb/xv+1hLWte629hL21e7XG'.
+	    'hMbWhNbOe87We9b/hP//e/97OXv/c///a///Y/+cOZz/Sv/WOd'.
+	    'bnOefvOe//Kf9jCGNrCGv/EP//CP/nCOf/AP/3APfvAO/nAOfe'.
+	    'AN7WANbOAM7GAMa9AL21ALWtAK2lAKWcAJyUAJSMAIyEAIR7AH'.
+	    'tzAHNrAGtjAGPP1sZnAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgF'.
+	    'HUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAwkUIj'.
+	    'mBTjT/AAAASUlEQVR4nGNgQAGskhKsEJaCrJiSuhZYTEFASFlD'.
+	    'GyQuqSCnrK6tJwpkiquoamgbGIGYrFpaugbGxmCNunpAljHECB'.
+	    'ZBQRZU4wFSMAZsXeM71AAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bxs_green.png
+//==========================================================
+	$this->imgdata_xsmall[9][0]= 370 ;
+	$this->imgdata_xsmall[9][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAAAn1'.
+	    'BMVEX///////+/v7+/v7/G/8aUxpSMvYyUzpSMzoyM1oxarVqE'.
+	    '/4R7/3tavVpKnEpaxlpz/3Nr/2tKtUpj/2Na51pKzkpK1kpK50'.
+	    'pK/0oYcxgp/ykYlBgY3hgY7xgY9xgQ/xAI/wgA/wAA9wAA7wAA'.
+	    '5wAA3gAA1gAAzgAAxgAAvQAAtQAArQAApQAAnAAAlAAAjAAAhA'.
+	    'AAewAAcwAAawAAYwA0tyxUAAAAAXRSTlMAQObYZgAAAAFiS0dE'.
+	    'AIgFHUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAw'.
+	    'kUKBrZxq0HAAAATElEQVR4nGNgQAGccrIcEJaivISyhjaIxa7I'.
+	    'I6CiqcMKZMopKqho6OhLA5kyqmqaOobGICartraeoYkJSAGDnj'.
+	    '6QZQIxgk1Skg3VeABlVgbItqEBUwAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bxs_darkgreen.png
+//==========================================================
+	$this->imgdata_xsmall[10][0]= 563 ;
+	$this->imgdata_xsmall[10][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAABX1'.
+	    'BMVEX////////l/+nAwMC86r+8wb28wby8wLy78sCzw7SywrSx'.
+	    'wLKwvrGuvK+syK+ryq2rx62n36ym3aumxKmk2qij0Keh16ahva'.
+	    'Og1aSguKKe06KeuaCetZ+d0KGdtZ+bz6Cay56ZyZ2Zwp2Zr5qZ'.
+	    'rpqYwJuXyZuXrJmVw5mUxZiTxJeTw5eTq5WRwJWPtJKOvZKKuI'.
+	    '6Kt42Kn4yJt42ItIuGsomFsYmEsIiEr4eDr4eBrIR/qoN+qIJ8'.
+	    'poB7pH56o356on14nnt2nXl0mndzmnZzmXZymHVwlXNvlHJukn'.
+	    'FtiHBqjm1qjW1oi2toiWpniWplh2hlhmdkhWdig2VggGNgf2Je'.
+	    'fmFdfGBde19bbl1aeFxXdFpWclhVclhVcVdUcFZTb1VSbVRQal'.
+	    'JPaVFKY0xKYkxJYUtIYEpHX0lEWkZCWERCV0NCVkM/U0A+U0A+'.
+	    'UUA+UEA9Uj89UT48Tj45TDvewfrHAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElN'.
+	    'RQfTAwkUKCFozUQjAAAATUlEQVR4nGNgQAGcoqrcEJYQB5OhSw'.
+	    'CIxSXGwWThGcIDZCppK5o7hyV6AZl6NnbuoSmFICZ3YHB0RkkJ'.
+	    'SAFDbEJaSUkJxAjeyEheVOMBQj4MOEkWew4AAAAASUVORK5CYI'.
+	    'I=' ; 
+
+//==========================================================
+// File: bxs_cyan.png
+//==========================================================
+	$this->imgdata_xsmall[11][0]= 530 ;
+	$this->imgdata_xsmall[11][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAABPl'.
+	    'BMVEX////////F///AwMCvxsaC1NSC0dGCz8+CzMyA//94//91'.
+	    '//9q//9j//9X4uJX09NXz89Xx8dXxMRL//9L5uZL3d1L2NhLxs'.
+	    'ZLt7cv//8e9fUe8fEe7u4e398epqYehoYX//8L+PgK//8F9fUE'.
+	    '/v4E5+cEb28EZ2cC//8C/v4C/f0CzMwCrq4Cjo4CdXUCaWkCZW'.
+	    'UB/PwA//8A/f0A+/sA8/MA7e0A7OwA6+sA5eUA5OQA4uIA4eEA'.
+	    '3NwA2toA2NgA1dUA09MA0tIA0NAAysoAxsYAxcUAxMQAv78Avr'.
+	    '4AvLwAtrYAtbUAs7MAsLAAra0Aq6sAqKgApaUApKQAoqIAoKAA'.
+	    'n58AmpoAlZUAk5MAkpIAkJAAj48AjIwAiYkAh4cAf38AfX0Ae3'.
+	    'sAenoAcnIAcHAAa2sAaWkAaGgAYmIUPEuTAAAAAXRSTlMAQObY'.
+	    'ZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAA'.
+	    'AHdElNRQfTAwkUKQFKuFWqAAAATUlEQVR4nGNgQAGsUjJsEJaR'.
+	    'grC5qz9YzIiL28YriB3IlDZRsnYNiZUDMmXtHT2CE9JBTDb/wI'.
+	    'jkzEyQAoaomMTMzEyIERzy8hyoxgMAN2MLVPW0f4gAAAAASUVO'.
+	    'RK5CYII=' ; 
+
+//==========================================================
+// File: bxs_orange.png
+//==========================================================
+	$this->imgdata_xsmall[12][0]= 572 ;
+	$this->imgdata_xsmall[12][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAABaF'.
+	    'BMVEX//////////8X/3oD/3nj/1HX/0Gr/xGP/rkv/gBf+iS/2'.
+	    'bAL1agDxaQDuZwDrZwLpZQDmZQLlZADjcx7gZATeYQDdZgraXw'.
+	    'DZXwHYXgDXiEvXZAvUjlfUXwXTjVfTbR7ShUvRbR7RWwDMWQDL'.
+	    'WADKooLKWADJoYLJgkvHWATGoILFn4LFgEvFVgDEZx7EVQDDt6'.
+	    '/DVQDCt6/CnoLChlfCVADAwMC+hFe+UgC8UgC6UQC4gVe4UAC3'.
+	    'gVe3UAC1gFe1eUu1TwC1TgCzTgCwTQKuTACrSgCqSgCpSgCpSQ'.
+	    'CodEulSACkRwCiRgCdRACcRACaQwCYQgCWQgKVQQCVQACUQACS'.
+	    'UR6RPwCOPgCNPQCLPACKPACJOwCEOQCBOAB+NwB9NgB8NgB7NQ'.
+	    'B6NwJ4NAB3RR52MwB0MgBuLwBtLwBsLwBqLgBpLQBkLQJiKgBh'.
+	    'KgBgKwRcKABbKQJbJwBaKQRaJwBYKAJVJQDZvdIYAAAAAXRSTl'.
+	    'MAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxEAAAsRAX9k'.
+	    'X5EAAAAHdElNRQfTAwkUJBSSy88MAAAATUlEQVR4nGNgQAGqwo'.
+	    'paEBYPJ4eKezCIpc7HwmrqG6ENZMpLihm6RaWEAZl6Vo7ekRnF'.
+	    'IKZWSHhcTnk5SAFDfFJWeXk5xAjj1FRjVOMBeFwNcWYSLjsAAA'.
+	    'AASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bxs_lightblue.png
+//==========================================================
+	$this->imgdata_xsmall[13][0]= 554 ;
+	$this->imgdata_xsmall[13][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAMAAAC67D+PAAABVl'.
+	    'BMVEX////////d///AwMC7wcS08P+y+P+xxdCwxM+uws2twMur'.
+	    'vsinzNynytylzuKhyN6e5v6d5P+d1fOcwNWcu8ub4f+at8iZ3v'.
+	    '+ZvdGY2/yW2f+VscGU1vuT1fqTr72Sx+SSxeKR0fWRz/GPz/OP'.
+	    'rr+OyeqMy+6Myu2LyeyKxueJudSGw+SGorGDvt+Cvd6CvN2Aud'.
+	    'p+uNd+t9Z9tdV8tdR8tNN6sc94r813rct2q8h0qcZ0qMVzp8Rx'.
+	    'o8Bwor5tn7ptnrptnrlsnbhqmbRpmbNpi51ol7Flkqtkkqtkka'.
+	    'pjj6hijaRhjaZgi6NfiqJfiaFdh55bhJtag5pZgphYgJZYf5VX'.
+	    'cn9Ve5FSeI1RdopRdYlQdYlPc4dPcoZPcoVNcINLboBLbH9GZn'.
+	    'hGZXdFZHZEY3RDYnJCXW4/W2s/WWg+Wmo7VmU7VGM7U2E6VGM6'.
+	    'VGI5UV82T1wGxheQAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHU'.
+	    'gAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElNRQfTAwkUJziL'.
+	    'PvAsAAAATUlEQVR4nGNgQAHsQgqcEJYgG5Oegy+IxSHOxmTiFs'.
+	    'gFZMprKBnbB8e7AplaFlbOQUl5ICanX0BEWmEhSAFDVGxKYWEh'.
+	    'xAjusDBuVOMBJO8LrFHRAykAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: bxs_darkgray.png
+//==========================================================
+	$this->imgdata_xsmall[14][0]= 574 ;
+	$this->imgdata_xsmall[14][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAABm'.
+	    'JLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsRAAALEQF/ZF+RAAAB'.
+	    'iElEQVR42k3QPU8TYRwA8P//ebkXrgdIColXRAOEkJqbaExMut'.
+	    'DBhE1GNjYHPg+DG6ODiU6QOLjVxITBcFKBYCstlAC2Bz17fe76'.
+	    'vLD6+wg/1FpTRFR5lpaub/u1eGBGaAT4HneD4OlXx7avtDYUjT'.
+	    'HQabd2Ti8e3vVSKzxrtHS32wIpFVldno22Nqvvg2Bhl0gp/aNm'.
+	    'vJ3qqXAtLIva+ks1H0wqlSXi4+d6+OFTfRsAfHJx2d1od24rZP'.
+	    'xP2HzopINr1mkesX7ccojqif0v9crxWXODZTno3+dNGA7uWLsd'.
+	    'mUYU4fHJCViMG9umLBmM4L6fagZGg9QKfjZ+Qfy3C3G/B3mugF'.
+	    'IHHNcDf64E3KJALApk2p8CSolUUqLjFkyxOGMsTtFyJ+Wz57NQ'.
+	    '8DghS4sLB0svioeZZo7nPhFoUKZDIVFbglkTTnl5/rC8snjAkJ'.
+	    'Bk/XV5LxHC/v7tR8jzTFPbg8LENK9WX0Vv31T2AEmCSmlKCCoh'.
+	    'ROnP1U1tPFYjJBRcbtzSf+GPsFTAQBq1n4AAAABKdEVYdHNpZ2'.
+	    '5hdHVyZQBiYzYyMDIyNjgwYThjODMyMmUxNjk0NWUzZjljOGFh'.
+	    'N2VmZWFhMjA4OTE2ZjkwOTdhZWE1MzYyMjk0MWRkM2I5EqaPDA'.
+	    'AAAABJRU5ErkJggg==' ; 
+    }
+}
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_bevels.inc php-syslog-ng/html/includes/jpgraph/imgdata_bevels.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_bevels.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/imgdata_bevels.inc	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,105 @@
+<?php
+//=======================================================================
+// File:	IMGDATA_BEVELS.INC
+// Description:	Base64 encoded images for round bevels
+// Created: 	2003-03-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: imgdata_bevels.inc 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class ImgData_Bevels extends ImgData {
+    var $name = 'Round Bevels';
+    var $an = array(MARK_IMG_BEVEL => 'imgdata');
+    
+    var $colors = array('green','purple','orange','red','yellow');
+    var $index  = array('green'=>1,'purple'=>4,'orange'=>2,'red'=>0,'yellow'=>3);
+    var $maxidx = 4 ;
+
+    var $imgdata ;
+
+    function ImgData_Bevels() {
+//==========================================================
+// File: bullets_balls_red_013.png
+//==========================================================
+	$this->imgdata[0][0]= 337 ;
+	$this->imgdata[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAM1'.
+	    'BMVEX////////27t/f3+LFwcmNxMuxm62DmqKth1VpZmIWg6fv'.
+	    'HCa7K0BwMEytCjFnIyUlEBg9vhQvAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElN'.
+	    'RQfTAxcBNhk+pYJVAAAAl0lEQVR4nE2Q2xLDIAgFHUWBKJf//9'.
+	    'oekmbafVDZARRbK/pYTKP9WNcNv64zzUdd9BjmrgnsVXRNSzO3'.
+	    'CJ5ahdhy0XKQkxld1kxb45j7dp0x2lBNOyVgQpMaoadX7Hs7zr'.
+	    'P1yKj47DKBnKaBKiSAkNss7O6PkMx6kIgYXISQJpcZCqdY6KR+'.
+	    'J1PkS5Xob/h7MNz8x6D3fz5DKQjpkZOBYAAAAABJRU5ErkJggg'.
+	    '==' ; 
+
+//==========================================================
+// File: bullets_balls_green_013.png
+//==========================================================
+	$this->imgdata[1][0]= 344 ;
+	$this->imgdata[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAM1'.
+	    'BMVEX////////27t/e3+K3vriUub/Dm18j4xc3ob10k0ItqQlU'.
+	    'e5JBmwpxY1ENaKBgUh0iHgwsSre9AAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElN'.
+	    'RQfTAxcBNTfJXtxZAAAAnklEQVR4nE2QWY4EMQhDUVhSIRC4/2'.
+	    'kbaqLp9p+f2AxAayAzDfiK9znPORuvH0x8Ss9z6I9sHp6tcxE9'.
+	    'nLmWmebmt5F5p2AR0+C9AWpLBjXRaZsCAT3SqklVp0YkAWaGtd'.
+	    'c5Z41/STYpPzW7BjyiRrwkVmQto/Cw9tNEMvsgcekyCyFPboIu'.
+	    'IsuXiKffYB4NK4r/h6d4g9HPPwCR7i8+GscIiiaonUAAAAAASU'.
+	    'VORK5CYII=' ; 
+
+//==========================================================
+// File: bullets_balls_oy_035.png
+//==========================================================
+	$this->imgdata[2][0]= 341 ;
+	$this->imgdata[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAM1'.
+	    'BMVEX////////27t/f3+K5tbqNwcjnkjXjbxR2i5anfEoNkbis'.
+	    'PBxpU0sZbZejKgdqIRIlERIwYtkYAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElN'.
+	    'RQfTAxcBNgK0wEu5AAAAm0lEQVR4nE3QVxIEIQgEUErAgTHA/U'.
+	    '+7zbipf9RXgoGo0liMmX6RdSPLPtZM9F4LuuSIaZtZWffiU6Iz'.
+	    'Y8SOMF0NogBj30ioGRGLZgiPvce1TbIRz6oBQEbOFGK0rIoxrn'.
+	    '5hDomMA1cfGRCaRVhjS3gkzheM+4HtnlkXcvdZhWG4qZawewe6'.
+	    '9Jnz/TKLB/ML6HUepn//QczazuwFO/0Ivpolhi4AAAAASUVORK'.
+	    '5CYII=' ; 
+
+//==========================================================
+// File: bullets_balls_oy_036.png
+//==========================================================
+	$this->imgdata[3][0]= 340 ;
+	$this->imgdata[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAM1'.
+	    'BMVEX////////27t/e3+LO3hfYzz65ubiNwci6uQ12ipadgVGa'.
+	    'fwsNkbhnVkcaZ5dwSA8lFg7CEepmAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxEAAAsRAX9kX5EAAAAHdElN'.
+	    'RQfTAxcCBySi1nevAAAAjElEQVR4nFXPWw7EIAgFUNMoCMhj/6'.
+	    'staKczc/2RkwjS2glQ+w3YytgXCXCZpRo8gJdGxZadJws13CUP'.
+	    '4SZI4MYiUxypeiGGw1XShVBTNN9kLXP2GRrZPFvKgd7z/sqGGV'.
+	    '7C7r7r3l09alYN3iA8Yn+ImdVrNoEeSRqJPAaHfhZzLYwXstdZ'.
+	    'rP3n2bvdAI4INwtihiwAAAAASUVORK5CYII=' ;
+
+//==========================================================
+// File: bullets_balls_pp_019.png
+//==========================================================
+	$this->imgdata[4][0]= 334 ;
+	$this->imgdata[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAMAAAAMs7fIAAAAM1'.
+	    'BMVEX////+/v7i4eO/w8eHxcvKroNVormtfkjrMN2BeXQrepPc'.
+	    'Esy4IL+OFaR7F25LHF8mFRh5XXtUAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElN'.
+	    'RQfTAxcBNgkjEpIxAAAAlElEQVR4nE2QAQ7FIAhDDTAVndL7n3'.
+	    'ZV/7JfEwMvFIWUlkTMVNInbVv5ZeJqG7Smh2QTBwJBpsdizAZP'.
+	    '5NyW0awhK8kYodnZxS6ECvPRp2sI+y7PBv1mN02KH7h77QCJ8D'.
+	    '4VvY5NUgEmCwj6ZMzHtJRgRSXwC1gfcqJJH0GBnSnK1kUQ72DY'.
+	    'CPBv+MCS/e0jib77eQAJxwiEWm7hFwAAAABJRU5ErkJggg==' ; 
+
+    }
+}
+
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_diamonds.inc php-syslog-ng/html/includes/jpgraph/imgdata_diamonds.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_diamonds.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/imgdata_diamonds.inc	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,178 @@
+<?php
+//=======================================================================
+// File:	IMGDATA_DIAMONDS.INC
+// Description:	Base64 encoded images for diamonds
+// Created: 	2003-03-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: imgdata_diamonds.inc 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class ImgData_Diamonds extends ImgData {
+    var $name = 'Diamonds';
+    var $an = array(MARK_IMG_DIAMOND =>'imgdata');
+    var $colors = array('lightblue','darkblue','gray', 
+			'blue','pink','purple','red','yellow');
+    var $index  = array('lightblue' =>7,'darkblue'=>2,'gray'=>6, 
+			'blue'=>4,'pink'=>1,'purple'=>5,'red'=>0,'yellow'=>3);
+
+    var $maxidx = 7 ;
+    var $imgdata ;
+
+    function ImgData_Diamonds() {
+//==========================================================
+// File: diam_red.png
+//==========================================================
+	$this->imgdata[0][0]= 668 ;
+	$this->imgdata[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAC6CgRnAAAA/F'.
+	    'BMVEX///////+cAAD/AADOAABjAABrAADWGBjOCAj/CAj/GBj/'.
+	    'EBCcCAiMOTl7KSl7ISFzGBilGBjOEBBrCAjv5+eMQkK1QkKtMT'.
+	    'GtKSnWKSn/KSlzEBCcEBDexsb/tbXOe3ucWlqcUlKUSkr/e3vn'.
+	    'a2u9UlL/a2uEMTHeUlLeSkqtOTn/UlL/SkrWOTn/QkL/OTmlIS'.
+	    'H/MTH/ISH39/f/9/f35+fezs7/5+fvzs7WtbXOra3nvb3/zs7G'.
+	    'nJzvtbXGlJTepaW9jIy1hITWlJS1e3uta2ulY2P/lJTnhITne3'.
+	    'vGY2O9Wlr/c3PeY2O1Skr/Y2P/WlreQkLWISGlEBCglEUaAAAA'.
+	    'AXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAA'.
+	    'sSAdLdfvwAAAAHdElNRQfTAwsWEw5WI4qnAAABGUlEQVR4nHXQ'.
+	    '1XLDMBAFUKUCM1NiO8zcpIxpp8z0//9SWY7b2LHv6EU6s1qtAN'.
+	    'iMBAojLPkigpJvogKC4pxDuQipjanlICXof1RQDkYEF21mKIfg'.
+	    '/GGKtjAmOKt9oSyuCU7OhyiDCQnjowGfRnooCJIkiWJvv8NxnG'.
+	    'nyNAwFcekvZpPP3mu7Vrp8fOq8DYbTyjdnAvBj7Jbd7nP95urs'.
+	    '+MC2D6unF+Cu0VJULQBAlsOQuueN3Hrp2nGUvqppemBZ0aU7Se'.
+	    'SXvYZFMKaLJn7MH3btJmZEMEmGSOreqy0SI/4ffo3uiUOYEACy'.
+	    'OFopmNWlP5uZd9uPWmUoxvK9ilO9NtBo6mS7KkZD0fOJYqgGBU'.
+	    'S/T7OKCAA9tfsFOicXcbxt29cAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: diam_pink.png
+//==========================================================
+	$this->imgdata[1][0]= 262 ;
+	$this->imgdata[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbBAMAAAB/+ulmAAAAEl'.
+	    'BMVEX///+AgID/M5n/Zpn/zMz/mZn1xELhAAAAAXRSTlMAQObY'.
+	    'ZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAA'.
+	    'AHdElNRQfTAwsWEi3tX8qUAAAAbUlEQVR4nFXJwQ3AMAhDUdRm'.
+	    'kKojuCswABf2X6UEEiC+WF+PyDfoGEuvwXogq3Rk1Y6W0tBSG8'.
+	    '6Uwpla6CmJnpoYKRsjjb/Y63vo9kIkLcZCCsbGYGwMRqIzEp1R'.
+	    'OBmFk9HQGA2N0ZEIz5HX+h/jailYpfz4dAAAAABJRU5ErkJggg'.
+	    '==' ; 
+
+//==========================================================
+// File: diam_blue.png
+//==========================================================
+	$this->imgdata[2][0]= 662 ;
+	$this->imgdata[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAC6CgRnAAAA+V'.
+	    'BMVEX///+AgIAAAJwAAP8AAM4AAGMAAGsQEP8YGHMQEHMYGP8Q'.
+	    'EKUICJwICM5KSpQxMYQpKXsYGNYQEM4ICGsICP97e85aWpw5OY'.
+	    'xSUv85ObVCQt4xMa0pKa0hIaUpKf+9vd6EhLVra+dzc/9SUr1r'.
+	    'a/9aWt5SUt5CQrVaWv9KSv8hIXs5Of8xMf8pKdYhIdYYGKUhIf'.
+	    '/Ozs739//v7/fn5+/v7//n5/fW1ufOzufOzu/W1v+trc69veel'.
+	    'pc6trd6UlMa9vf+MjL21tfe1tf+UlNZzc61ra6Wlpf+EhOeMjP'.
+	    '9ra8ZSUpyEhP9CQoxKSrVCQv85Od4xMdYQENZnJhlWAAAAAXRS'.
+	    'TlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAd'.
+	    'LdfvwAAAAHdElNRQfTAwsWEx3Snct5AAABFklEQVR4nHXR5XbD'.
+	    'IBgGYM6AuHsaqbvOfeuknev9X8xISbplSd5/8JyXwwcA/I0AKm'.
+	    'PFchVBdvKNKggKQx2VIoRwMZihMiQE49YUlWBCcPL0hYq4ITh+'.
+	    'qKECUoLDZWqoQNA766F/mJHlHXblPJJNiyURhM5eU9cNw5BlmS'.
+	    'IrLOLxhzfotF7vwO2j3ez2ap/TmW4AIM7DoN9+tu+vLk6Pdg9O'.
+	    '6ufXjfXLm6pxPACSJIpRFAa+/26DhuK6qjbiON40k0N3skjOvm'.
+	    'NijBmchF5mi+1jhQqDmWyIzPp1hUlrv8On5l+6mMm1tigFNyrt'.
+	    '5R97g+FKKyGKkTNKesXPJTZXOFIrUoKiypcTQVHjK4g8H2dWEQ'.
+	    'B8bvUDLSQXSr41rmEAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: diam_yellow.png
+//==========================================================
+	$this->imgdata[3][0]= 262 ;
+	$this->imgdata[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbBAMAAAB/+ulmAAAAEl'.
+	    'BMVEX///+AgIBmMwCZZgD/zADMmQD/QLMZAAAAAXRSTlMAQObY'.
+	    'ZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAA'.
+	    'AHdElNRQfTAwsWEwcv/zIDAAAAbUlEQVR4nFXJwQ3AMAhDUdRm'.
+	    'kKojuCswABf2X6UEEiC+WF+PyDfoGEuvwXogq3Rk1Y6W0tBSG8'.
+	    '6Uwpla6CmJnpoYKRsjjb/Y63vo9kIkLcZCCsbGYGwMRqIzEp1R'.
+	    'OBmFk9HQGA2N0ZEIz5HX+h/jailYpfz4dAAAAABJRU5ErkJggg'.
+	    '==' ; 
+
+//==========================================================
+// File: diam_lightblue.png
+//==========================================================
+	$this->imgdata[4][0]= 671 ;
+	$this->imgdata[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAC6CgRnAAAA/1'.
+	    'BMVEX///+AgIAAnP8A//8Azv8AY/8Aa/8I//8Y1v8Izv8Y//8Q'.
+	    '//8InP8Qzv8Ypf85jP8he/8Yc/8Ia/8pe/8p//8p1v9Ctf8xrf'.
+	    '8prf8QnP8Qc/9CjP+1//97//9r//9S//9K//9C//85//8x//8h'.
+	    '//9r5/9K3v9S3v851v97zv9Svf85rf8hpf/G3v9SnP9anP9KlP'.
+	    '8xhP/n7//v7+f3///n///O//+U//9z//9j//9a//975/9C3v8h'.
+	    '1v+E5/+17/9j3v/O7//n9/+95/+l3v9jxv+U1v8Qpf9avf9Ktf'.
+	    '+Uxv+11v97tf9rrf+cxv+Mvf9jpf+tzv+Etf/O3v/39/8Akkxr'.
+	    'AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACx'.
+	    'IAAAsSAdLdfvwAAAAHdElNRQfTAwsWEiHk6Ya/AAABGUlEQVR4'.
+	    'nHXQ13KDMBAF0J2o0E01GHDvJa7p3em95/+/JQJMYjDc0Yt0Zr'.
+	    'VaAaxHgtxwbSGPkGQpOIeQ2ORxJiJmNWYZyAhZR0WcgQGhViU0'.
+	    'nEGoedDHGxgRapRPcRpXhOr7XZzCmLjaXk9IIjvkOEmSRLG62+'.
+	    'F5XlEElhA5sW21GvXj6mGlDBfnJ51lr9svnvEKwH1hu2QPbwd3'.
+	    'N9eXVzuL7/Hn29frdKaamgcgy67L3HFG9gDefV+dm5qme4YRXL'.
+	    'oVR374mRqUELZYosf84XAxISFRQuMh4rrH8YxGSP6HX6H97NNQ'.
+	    'KEAaR08qCeuSnx2a8zIPWqUowtKHSRK91rAw0elmVYQFVc8mhq'.
+	    '7p5RD7Ps3IIwA9sfsFxFUX6eZ4Zh4AAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: diam_purple.png
+//==========================================================
+	$this->imgdata[5][0]= 657 ;
+	$this->imgdata[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbCAMAAAC6CgRnAAAA/F'.
+	    'BMVEX///////8xAP/OAP+cAP9jAP9rAP+cCP85CP/OEP9SKf/O'.
+	    'CP9CEP9zGP9rCP+lGP/WOf/WIf9KIf9jOf+MQv+EMf97If9zEP'.
+	    '+1Sv+lIf/ne//eUv/na//n5//Oxv/Wzv+chP9zUv97Wv9rQv9a'.
+	    'Mf9KGP/v5/+te/97Kf+9Y/+tOf+tKf+lEP/vtf/WMf/WKf/v7+'.
+	    'f39/+tnP+9rf9rSv9jQv9CGP+ljP+EY//Gtf+tlP+Ma/9zSv/e'.
+	    'zv+UUv+9lP+cWv+lY/+cUv+MOf+EKf+UQv/Opf/OhP/Ga/+1Qv'.
+	    '/Oe/+9Uv/ntf/eWv/eSv/WGP/3zv/vlP/WEP//9/+pL4oHAAAA'.
+	    'AXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAA'.
+	    'sSAdLdfvwAAAAHdElNRQfTAwsWEjX+M1LCAAABDklEQVR4nHXQ'.
+	    '1bLDIBAGYFqIEW+ksbr7cXd3ff93OUCamdOE/Mxw882yywLwPz'.
+	    '+gNKotlRFUVnNUQlCxTMRFCKEdE+MgpJaEiIOU4DKaoSIygtb3'.
+	    'FBUQrm3xjPK4JvXjK0A5hFniYSBtIilQVYUm+X0KTVNiYah+2q'.
+	    'ulFb8nUbSovD2+TCavwXQWmnMA6ro+di+uR5cPzfPhVqPV3N1p'.
+	    'n3b3+rimAWAYhP3xnXd7P6oc9vadPsa1wYEs00dFQRAFehlX21'.
+	    '25Sg9NOgwF5jeNTjVL9om0TjDc1lmeCKZ17nFPzhPtSRt6J06R'.
+	    'WKUoeG3MoXRa/wjLHGLodwZcotPqjsYngnWslRBZH91hWTbpD2'.
+	    'EdF1ECWW1SAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: diam_gray.png
+//==========================================================
+	$this->imgdata[6][0]= 262 ;
+	$this->imgdata[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbBAMAAAB/+ulmAAAAEl'.
+	    'BMVEX//////wAzMzNmZmbMzMyZmZlq4Qo5AAAAAXRSTlMAQObY'.
+	    'ZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAA'.
+	    'AHdElNRQfTAwsWExZFTxLxAAAAbUlEQVR4nFXJwQ3AMAhDUdRm'.
+	    'kKojuCswABf2X6UEEiC+WF+PyDfoGEuvwXogq3Rk1Y6W0tBSG8'.
+	    '6Uwpla6CmJnpoYKRsjjb/Y63vo9kIkLcZCCsbGYGwMRqIzEp1R'.
+	    'OBmFk9HQGA2N0ZEIz5HX+h/jailYpfz4dAAAAABJRU5ErkJggg'.
+	    '==' ; 
+
+//==========================================================
+// File: diam_blgr.png
+//==========================================================
+	$this->imgdata[7][0]= 262 ;
+	$this->imgdata[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABsAAAAbBAMAAAB/+ulmAAAAEl'.
+	    'BMVEX///+AgIBmzP9m///M//+Z//8hMmBVAAAAAXRSTlMAQObY'.
+	    'ZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAA'.
+	    'AHdElNRQfTAwsWEwCxm6egAAAAbUlEQVR4nFXJwQ3AMAhDUdRm'.
+	    'kKojuCswABf2X6UEEiC+WF+PyDfoGEuvwXogq3Rk1Y6W0tBSG8'.
+	    '6Uwpla6CmJnpoYKRsjjb/Y63vo9kIkLcZCCsbGYGwMRqIzEp1R'.
+	    'OBmFk9HQGA2N0ZEIz5HX+h/jailYpfz4dAAAAABJRU5ErkJggg'.
+	    '==' ; 
+    }
+}
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_pushpins.inc php-syslog-ng/html/includes/jpgraph/imgdata_pushpins.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_pushpins.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/imgdata_pushpins.inc	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,518 @@
+<?php
+//=======================================================================
+// File:	IMGDATA_PUSHPINS.INC
+// Description:	Base64 encoded images for pushpins
+// Created: 	2003-03-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: imgdata_pushpins.inc 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class ImgData_PushPins extends ImgData {
+    var $name = 'Push pins';
+    var $an = array(MARK_IMG_PUSHPIN => 'imgdata_small',
+		    MARK_IMG_SPUSHPIN => 'imgdata_small',
+		    MARK_IMG_LPUSHPIN => 'imgdata_large');
+
+    var $colors = array('blue','green','orange','pink','red');
+    var $index  = array('red' => 0, 'orange' => 1, 'pink' => 2, 'blue' => 3, 'green' => 4 ) ;
+    var $maxidx = 4 ;
+    var $imgdata_large, $imgdata_small ;
+
+    function ImgData_PushPins() {
+
+	// The anchor should be where the needle "hits" the paper
+	// (bottom left corner)
+	$this->anchor_x = 0;
+	$this->anchor_y = 1;
+
+//==========================================================
+// File: ppl_red.png
+//==========================================================
+	$this->imgdata_large[0][0]= 2490 ;
+	$this->imgdata_large[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMKBh4Ryh89CgAACUdJREFUeJy9mNtTFFcexz+/7p'.
+	    '4Lw1wZJKDGCAwmDAqUySamcCq1ed6k9mn3UfMP7F+1T3nYqn2J'.
+	    'lZdoDEjpbq0KG8EBFBFBEJye6Zmenkv32Ydu5GYiUMmeqq6uqT'.
+	    '6Xz3zP73aOcIKmAQkIFyD3N/jrBPwlKjLQEglVlJKyUjR3u7cc'.
+	    'WLoP3/4dvv03LNrQ8I6x1rFbDML9kOmHvh7IRHU9JKmUSG8vpF'.
+	    'IoXX/TV0AiEM5A5jT0noFMFMJHXUt/d5f9TUAbhtQ3cPFruDog'.
+	    '8klHMnmO0dGYe/myOJGINEwTz3F2higFXgy8PpAkOC+h8hoaCt'.
+	    '4ppHFcQAWSgOQlyI/p+lUjmRxWAwNJd3xca/f34yoFi4tgmjtD'.
+	    'NIFkJ4xcgBCgVqEBFJ9DqcZea/gNAAVEg7AOGYnHe9XoaJd3+X'.
+	    'LISSSwnz6lsbKCZ9sHh4UVdBkwdA6cPwNnIfJPmC3Ctgft3wwQ'.
+	    'QPkvTZJJnbExzfvsM2nMzVG7e5fG48d4lnXwTwEYCjJxuHQBog'.
+	    'BHUfKkgAIIhiGk06hTp/Dm5qS1uYlXLvtWd4gPgIiCrAEcVckT'.
+	    'Ab5p7TaYJrK1hQaEenrwSiVfQdc91P0kSp7Ii89D5ksY/kAkLy'.
+	    'IZXFdXkQjS1YUSEbdcRu168V6+HTUNIKJDRwdE+sBIQmP9Ld59'.
+	    'bEBA3of4F/D+uXb7rGaaCSmXI3pPj64PDaHCYfEqFVSjgWo2D2'.
+	    '73XlJNQTgCyQykIuBWoNKEeh1aLXBPBCggGdBOgxZVSjoajVhH'.
+	    'o5HWlIpq4bCQSgm9vXhK4ZZKh5SUYygp4J1EQVUD9xlU18BJQD'.
+	    'bUbJ5T5XJStyxN9fSI099P3baxV1dRloW2h2ivx/yakg2ot6F1'.
+	    'EkCa4G1D+zVEq5ArKTWM42Q6HUczQV7U66w9e0ZpdRXlOIQ5vF'.
+	    'VHUXILKify4jiEzkOqC3peQMoBQymFlMt4Dx6wUSxSsm2UZXEK'.
+	    'P30QvOUt8/2Sd78CdWwFDTA+gsw3cOlPcPUD+CQB52oQ21RKXM'.
+	    'eRhGXhOg7VoKrx8KuS4ygZhVg3ZI8FGIfwR9BVgAtfwxdXdP3L'.
+	    '86nUR91dXelNXTeWWy10paQHX602YAP1ADASAL7LJvFtMpOCc0'.
+	    'cG3FHuGlz6Gr4YEpnoTCbzsdHRbOzy5RCRiLRMk5rjyOtAimwA'.
+	    'U4U3SurBN/0wnAASBCVDIKpB4kiAB5Ub0/UvO9LpPAMDGfn005'.
+	    'AxPCzxep3Q6iqPLUseBoufCZRsAE6g5g5kKIDfKUj3wnpAG8QB'.
+	    '/Z1OIqANQuI65AtwNScyYXR2XlAXL2YZHzcklRKWl5GVFXFtGx'.
+	    'MoAiV/EQaAGH6BUQNWgQpwFngv+Ca8KUAQEBcwgTJHyMV7679R'.
+	    'XS8YqdSI6u/PMD5ukMtJY3GR2uQkr5aXeWVZOEALmA8WsIAxfL'.
+	    'd0goVLAdCOd+/YpgqeVtBv4yiA++q/RKKXixe7GB8PSyoljcVF'.
+	    'yg8fyubyMpulEk2lyAIfAAvAC+B+oOQFoAt/+0rAejB/EzjNri'.
+	    'vvqNnCd64jxcE39V8spnP+vMbAgDSePKE2NcXm06dslMuUlcID'.
+	    'TuFvqwXMBU8N39bGgRR+ki0Dz4L5DSAe9NGD7zq+6kcN1L6H2b'.
+	    'ao5WWaQHllRTafPmWrVMJUimoAQrBYJFjQwre7B6A8YAi8LCgD'.
+	    '5DVo6/hbb/iHK1KggvFeD3hHziQKEMuiNTNDbXGRTdtmw7Iwla'.
+	    'KGH0oqwbscLOoG46rAY6AOzRhY74PT6QuUKEN4PegXxd/yEDTT'.
+	    'YMWOk+oEaLkuFdNk0zTZwjfkavDUArXWgGXgFb4dEShXhfYqlI'.
+	    'ow3w9rg3B6ED60IOOA5oEYQBrcpG+mj9bg0VG8GMJhVDZLyzAo'.
+	    'VSq8rFYxXXefcjVgG9+uisDrXUCApoKSBcUHMBmHhfcgNwhtD3'.
+	    'q9IG6Lr15b4OUTmPwBJt8JqGuapp05o0mhoHnptLQfPsR+8IBK'.
+	    'uYyNH3yr+B77LHheA3tK1Ta+IrMeTL2C6Xl48TOsNWDDgAz7s5'.
+	    '/r+krP/eddCsbj8fDQ4GBm9MqVvvRXX2VULBayRGRzaYn1SoWa'.
+	    'UjgB4PIB5QK4ZgBXBKaAHxQsrED1H7CRgCUPwgHZDqACmhWwXv'.
+	    '2aDRqGYeRyufS169cvThQKV88PDuYbW1vJ5VRK+5euqxWlPMdX'.
+	    'SRqgreHbZGN3ijfKBXBTAeh2Fdwi2MofshP/dvKwCmKhp4m83Y'.
+	    'vj8Xg4l8tlCoXC0MTExMTFkZE/1m37wvLGRvKRacoD1209E7Fc'.
+	    'pZwYREOQqEJ4z3HskHLsz4AoXykPIBSN0t3dTTQafROoHdumXC'.
+	    '4fjoMiog0ODiauX7+eLxQKV3O53ETdti88nJnJ3rl505ifmWm3'.
+	    'arWSodR8GNbycDoNHy5C5jFold1k8d+DyvELNwg93d18/vnn9P'.
+	    'X1oes6nufx/Plz7t+/fxhQKSWJRCI5NjaWHxkZKdj1+sjSwkJm'.
+	    '+uZN/dZ337VqCwullGUVdZjsgIUC5LqhrUPvCugWuApeApPAzY'.
+	    'PKHWyaphGNRunt7WVwcBARwfM8Ojo6sCzrMKBhGLphGFEF2Wq1'.
+	    '2jc7M5OZ/vHH0MPbt93awkJJmeZsC6ZaMK3DCwvWdNioQUb5B6'.
+	    'AdBR+9SzkAz/NwHIeXL18iIui6TjgcJplMMjY2th8wHo+Hh4aG'.
+	    'MsPDw6fddru7+Phxx51bt/RbN260qwsLpZhlFZsw9QJ+2Pbrga'.
+	    'oJG2FY2oKwuTtVEz9uV34NbqdtbW0xPT1NNBoF4MyZM1y5coWu'.
+	    'rq5dQBHRcrlc4tq1a/l8Pj9RMs38ndu3Ez//9JNXLRZNyuXZJk'.
+	    'xVYKoExQpsK/+IaAuYb7no8zjC/R+A4zisrq7u+53NZjl16tQ+'.
+	    'QIlEIslsNpuPRCJXZ2dnh2/duNFRW1oy07a96MKd575yxRqU1B'.
+	    '5vPMpF5HHa1tYW9+7do7Ozc/eQpZTSQ6FQt1Lq8pMnT/5w7969'.
+	    'nuLcXE1rNufO9fRMhlKpOyvt9qPtVmvb25fFfvvWbrepVCqHwo'.
+	    'xaX19vff/996ZhGC8qlkW9Wt1Onz073fXxxz+6MB+9e9dUjuO+'.
+	    '7ebq9wLdB9hoNCrr6+s/4wf3FCJW3fPmTZhXsNWCprjuW66Dfr'.
+	    '928KAfBhJAEgiJSLuzs7OSTqctoFkqlZRt26j/I+L/AGjPTN4d'.
+	    'Nqn4AAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+// File: ppl_orange.png
+//==========================================================
+	$this->imgdata_large[1][0]= 2753 ;
+	$this->imgdata_large[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMLFQ0VCkHCzQAACk5JREFUeJytmGtzG0d2hp8zNw'.
+	    'AEcRdJ6EJK9FL0CqZUm9jWbkwq3vhDstl8dmLvz8rP2H8Q75ZT'.
+	    'pkRfpLgqsS6WIFEKGYkiSBCDO+banQ8DUpRWEkklXQUUqlCDfv'.
+	    'rp857pgfAOQ4AMOJdg4R/hX96Hf06bvDc5iT07i8yeg8ksiIAI'.
+	    '4TBi/ds9/vivD/njapNHvRBfHXMu410AM+BUoVSF05NQsi1sO4'.
+	    '8402AXwLQTuP31OAZO2aG0MEn14iSlnI1z3LnMk8IZYJyBwjIs'.
+	    '/TWsVIWPJkvMFS4zMfMhUp5BsoCpAAEBLYKaMFGn00jBxnvu02'.
+	    '35+JHmSJEnBpQEcPo38MmCxd/nS9Ry71Ga/g1W9a8gn0GsHkgA'.
+	    '6DGjxkqb5CoO+YxF3A3p+jGjQUzoK+L/V0ADzFMwtSR8eLbAr8'.
+	    'uXOTf9NzhTc0geSLUQcYHgYEH786RMg0zWJHV2Aitv4x/HpHVS'.
+	    'QA2YBqTTGIUq5qkPMWaWkVwPnPtAA/BevmZcjxaaUtHh8pJJGu'.
+	    'DpCB9FvT7A7YT7S3p5vFMNzmWo/O0MSx/Ms3TqI8r59zFTfUQe'.
+	    'I7SBODE3tnfoIxYnNHligwik0zAzDdVpyKbA8sff5YAeMEwgkV'.
+	    'cufQeTJzZoCsaFLKXPTnNpoUTNsSgJmNoGsuNQjIDwYD2HlnZy'.
+	    'k++yxTKXZfKTU8zOpjhneeQYkorSmGERtIlICBKRbLX+y98YN3'.
+	    'ADcNIm+bJD4U3pPnmbEaRgYVRTGBkDSSsmxKfY7ZLuDJA4hdjl'.
+	    'JEgyBB2SJOvQ9RzTpNKoEwNq0CNFvOXR3/HxMgYVPObaz8kPmh'.
+	    'hkEWMatAfRONGGvLizyOE9P8KkpwhPDAgQKJQbELUD0oOIhbbH'.
+	    'JeVTmowxjAgZutB5AoOngA+2DdYrcTyOyYZP9+QpBvI29vwEhb'.
+	    'It042BVQgDy9KTMfkwQG1A9ACCLlgBBGUwxxoc52WDh2ATyEPp'.
+	    '1hoaPvrEBh0Dq5an9OUsl/9hylk5b5c+mowLc4E2Jtw4Eoljyf'.
+	    'ogA/AGEAagNRjGyUxOmEycyVA5EWDBxrmUp3ytLIv/NJP69Goh'.
+	    '+9mFydIvS5PZYkvH1oY/RFtKymlwBFQAgQd+kAA6qSQ8pvn2mp'.
+	    'SkJkuVFHPHBnQMrEt5Sl+e4/Lvp51PF1PF5Xy6WMvOWZXMom8z'.
+	    'OZTQ8+j5sbQiMEwopsCIwRtBGIJSCdzbTGo9NimkDcgdC7Bg49'.
+	    'TG5n4/nfr0Si77WdYp1YzyZEkWPdteaEnB7pPqBTxuIf/VgciE'.
+	    'SgasCPwh+GNIkaNNag1RiPge5pEhMQVjfoLcF+eoXSvbKxedwn'.
+	    'LKzC3KWbOi5/sW5a44/SHFUSgVA7SCzRG0AvA9mPOgFIETgu4n'.
+	    'Ww0wNQWFAqRSL6D2ZQYBdDrQ7R7jXiwgRcvIL02makuTmWtpM/'.
+	    '+BlLMl5vuWzLVEuwH6oYnR1KS8kJINGXMM2YdfRlALoQoQQKeb'.
+	    'bDVwoMdxQMaLCwLo96HZTF5HbrEhmOftianfZisfzueKv7ZmrX'.
+	    'MsjhxKXZGBjzyeEHmSE3oWiggtyVGmE8DTIXTC5NxgAxOAGUM8'.
+	    'fun9mnSSLQ/CxNzOTgJ3LIMgoGwkKBiiMyaVviHVkdCO4FEKNv'.
+	    'LQzWBYHfITPa4UBVM0LR/WB7ARJsdDDTjA6deYFIFUOimJ3d0E'.
+	    'sNdLavYYgBpthqKcjiiJRO8K6CK0CsJTjfQAGaJtD9vQFAxNNQ'.
+	    '1FB0yBAfA8gdMAIagLoCVAen0M00zMOTYShNDtoHs9CAIUoI4E'.
+	    '1IBihCdNhsMhsj6NuV7BCC2IBpBqQaaFOENCCeiEsO1BO4RQgy'.
+	    'I5Hm4k4oIU9MrgZSAdBeTabZz+ODxKQRRBFBJo6IUc51anYRQo'.
+	    'dto+24FNxYCiaWKkQsj00KkO4gxRRkAngJ868M0u3OkkM+hxQA'.
+	    'cQ7YD7GO5XYSsPZybh/TCkFIYY+kWniTW4Q7jXgHvHMhiRpmuW'.
+	    'ca08GZkkZ/nY6TZMNhCnf2CuPoDVJvxpB+q9BHA8Ag1uH+oP4c'.
+	    'YEPCzDwmzSLquShHW/E0YRbG/BjZtw40hAy7aNzJlzRn75E6N0'.
+	    'qiwTzafI7kOU3gWrhzZC2iHcbsPqLlxvJnCt4KC1RYAL3I5hzY'.
+	    'Xv/huePYCtITQMKEnyB4KQvMURuJvw889HGSwUCs7CwkLpo6tX'.
+	    'Ty/+7nel6VLGDn/8N9m+eZuo1UP8iNhLau6b3RfmOsHBGTUYw9'.
+	    'WBNeDrGB4+h/4qNLKwTnLbHj9CJw/6GoIh9Jpvq0HHcayFhYXi'.
+	    'l3/4w9LK8vLKexfma3G/mb/3n1njTivS7tNQaaU1grQDjJ868D'.
+	    'Axx6vmxnBrY9C9IcSbSXbavNjb/S3eN6/0m1JcKBScixcvllZW'.
+	    'Vi6uLC8v12q1v/M8b/HxVjP//YYr32yE4dYWvShO0ogi14xwxq'.
+	    'F4rbnxZ3cMjtpvEEeMvwA0TdOYn5/PffHFF7Vr166tvPeLXyx7'.
+	    'nrd4+/btyg/frFo//Xgncnd67qCn78earQqcmYD3fSi1wPCTSV'.
+	    '3gzqvm9uFOMl5nUAqFQn5paal26dKla57vf7D+6FHph9VV88af'.
+	    'vgq79bo70e3VT2l9A3hYg4UiRALVHTCHSZvYBm4A//6quf8zoG'.
+	    '3bpuM4acMwKr1+//SDe/dK31+/bv90/Xrcq9fduNW6rbVeC+E7'.
+	    'gWdD2DKg4UEpBmPcm10RuScida31ntb62HAigoigDw6Gh0axWH'.
+	    'QWFhZKi4uLZ+I4PrVer2e+u37dXPvqq6hbr7tOp1NXWq89h6/b'.
+	    '8FBB34WGBesdcPrj38lkMkGlUuml0+mu53nR3t4eo9HoSLhMJk'.
+	    'OlUiGdTuN5Hq7rvgA0TdO4cOFC7vPPP6/VarXldqdTu7m2lrv7'.
+	    '7beq++BBO263b/tKrfWSXlbvwJ6CuAtDgTYiaBFMw6BSqfDxxx'.
+	    '+rarWqGo0GN2/eZGtrC6XenAkRoVKpcPXqVWZmZmg0Gty6desF'.
+	    'oIhIOp3Ol8vlmmVZK3fv3Lm09uc/Zwbr653ccPgoNIzvnmn99Z'.
+	    '7W9QG46lAaM5mM2l95GIYUi0VOnz7N7OwsWmsymQzyuse5Q8Mw'.
+	    'DNLpNDMzM5w/f/7A6AGgUkoajYa9urpayOXzUz/fvZutr68Pim'.
+	    'F4/2y1+n2o9Q/ru7uPesPhXnyo4A+vfHp6mmazybNnz9jZ2UFr'.
+	    'TbPZJAhe+8/aS0Mphed5NBoNABqNBqPR6MWBVWstvu/nnj9/Pv'.
+	    'vo0aPq5uZmPBgM/qcwPf39xV/9ajU1M3Nvq9PZaw8GoT50PjdN'.
+	    'k6mpKa5cucL58+eJ45j19XWePHnCzs4OnudhmiaWZRGGIVH05r'.
+	    'yEYYjrumxubrKxsfFyDQJ6NBp1Pc+7C4jWumBaVm+kVL2l1H2l'.
+	    '1G6otS+H6V6z8u3tbVzXpdFooJRicXGRqakptre3uXXr1ltrcT'.
+	    'Qa8ezZszemWAE9rfUdYBOwtVLRbrPZ+48ff+wDvuu6Sr3MB4Dr'.
+	    'uty6desgfa1WC3iRyrNnz4pSSmezWUzTfGtYtNYcdvC/9sMlgP'.
+	    'n5N4cAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+// File: ppl_pink.png
+//==========================================================
+	$this->imgdata_large[2][0]= 2779 ;
+	$this->imgdata_large[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMLFQolY9lkpgAACmhJREFUeJy9mOtzFNl5h5+3b9'.
+	    'Mz0kzPBWmEVtIiWYhIiC0HCDhB8lb8ISk7nzdZ5+/zJ/8BTmpT'.
+	    '660CZLwG1pVFgBkgGIHECEaa+/T9nHzQCCQuRpCNz6mp6g893U'.
+	    '8/c37ve3qEjxiC4OA4n/Lp/EUu/tsMM/+aEWduVBx7WhdkShcY'.
+	    'xUH2zo0Dwod/5N6vf8V//PoGdx8M8EOFPtK9jI8BdHCcMuVSmf'.
+	    'LxHLmSZdm2U8xIbmKETDGDZZnIy4dBbCynyGhphurEDBOlHFnn'.
+	    'qPcyPxTOwDCOccw7w5nlBRZWylI+ny/mZ6rL1dzUZ5/IWGZU3D'.
+	    'ZIOMQDDaJcHDVGWUbJBi9odVr0QoVSPzigIEaZ8vgSS/8wZU3/'.
+	    'k1fylipz5dLM2WlrZqHKaGCKbEbontq3KAKWQyZfZKTgYqc9Bp'.
+	    '2I2PcJ4ogk/UEBQcwipbFZmT13vDBx8fhnE1Ofnp9yJopFyT3X'.
+	    'yANfks0QHSQMDaL37pOxMLIu2UyVkjVKLjyKSeuD8dAYCFkso1'.
+	    'gYMaeWJ40T56cl8yAi/O4FSa2P6kYczIDsgVpAqcDImZPMuAB1'.
+	    'dkLQtcc8a/bwox8IUHAxZVxGZMouSLVYwKuMkD5IxN+JSdsRJB'.
+	    'pexuTVgYYM6EoGmxkmg3/hEhNUMr/hd7dqbOzExMn/GRDAxWZc'.
+	    'j3I8HiXfMjF2FQowKw7pjoN6E/Llw/GBJj8qxVOMlX4ipxc/lY'.
+	    'kl2zBLkmrTcEzMkoNoRLVidLi/9g+Z3I+1xRHX5EcAihxnbPRv'.
+	    'OTU9kZSmpKPy9FTGrLimPZ1H+UiyGaF67w6n7E1DwMngFDxGvc'.
+	    'w70v0xZUby5IxjlIyMssUJrJwVWkXBdbXvSvwEibcSdKCAFI16'.
+	    '4/sc0SRo9cGAGq1DwvQFzV6DVuBiV4zYnlEts6A2TSPcSiXoxo'.
+	    'QqJCEEFMbQ2b69o5qMiOOPqIMQkagu/aSL7waE8101WFShLjk9'.
+	    'yxgEvjRUiyYd+gwAjY2J9VpXfZ/JEXLhDp3OR6U4T97+hEnPwx'.
+	    'tv4HsRjy2tTQSFzQgDUnwSLBQRI+x1ZgcH87Vcv4SF19Kt0ezS'.
+	    '1h9s0Ma25pgr/YJfnLnEysok0+ezjM6EBLldGqKIJYuDRhOQEJ'.
+	    'Oih8X9Q0xmcXNjlCofBJgn78wxVz7L2YWf8tPPz1hnfjbjzfxN'.
+	    'qVwutq2etZXUQSXikcXGIgUiUkJSDIQMJgYGJsaB3c7b1qQ4GZ'.
+	    'xSkdGZIwMeNLfK6uezMnvJK3pLxeVixfvMsyVjSNSO6IV9adPG'.
+	    'AArkEEz8oUkFmBjYGO80qfd6pCWIayD59wIKcsjcKqufn7JO/S'.
+	    'xfyi+5c24pey5rZ09mJRNkiDdT/tzbkBr3SYkpMYpgEaIJSYhI'.
+	    'kSOY1GhilAQk5ntDIojxCZ/kf87Pl85xbuWEnLiUy+cW3NNuJX'.
+	    'MmY5meKf6mT7wZS+THdOjxlG06tIlIOMZxchSxcFFEGAwAGGME'.
+	    'jwyZYSnWL3cXWiIUbUI6hO/vxXuFOV84ycmlBWthNeflTjuzTi'.
+	    'lzJmM5s46Ej0J63/ZoPmoy6PYxtYVNhmfs0mbAND1mmKVMBY1L'.
+	    'mxA1LN7WgXQbCApNhKJHRIM+DQbv7yQGhjnJ5NgFuXBuxpu5mD'.
+	    'udm3LPuY7pmZLUE6L1SIJaIPFuDAqyw9lnwDYv6NFHkWJh4ZDB'.
+	    'wCBFD3uMxsTAwcBAiElpE/KcPg36dIiOvpsRxDCyhmlP2YY9ZU'.
+	    'v8NMb/1id+FGO0DTztkSXLOONUqeITsMkW2zwnJEIDFhYGx+A1'.
+	    'kwK4mASkvKDPc3p0iYhRRwYUhZLUTyV6Eu0t4s1Y4kcx6W6KaM'.
+	    'EZThcXH59RRhGEgIAddnBwNEBKqqpUtWBIF22YDIhJsbEkJqFN'.
+	    'qLtERHs7GnUkwISEQAf0uj30bY39PzbiC6qrDu2cExJ69Nhhhz'.
+	    '59UlIUipCQOnVi4sjG7ubJBy6um0C+he/0iDHQKIQERYyKFLqr'.
+	    'SI/W6kJCnvOcrWSLSquC1/Jw9Ks3R0FQKHr0uMc9bnCDGjX69A'.
+	    'H0XlcJkibN5jOe/alCZStHbjJL9lSMLkXExvCXRiDV6GZEeGeX'.
+	    '3TvvBVQoEjfBL/v0rT75Th7VU5C8gktI6NLlMY+5yU3WWGODDf'.
+	    'r098tHpNFNH7/2lKdXXdz7efLzVaqJIBOCmK8AJUlI6g0aV+9y'.
+	    '9+p7AR3bMQpTBWPy7yeN6fy0jNwewfpvC9Xe+3kFoUuXe9zj5n'.
+	    'BusEGHjh6GIAGawC2FWuvSvbbF1maFylZAsC1ISZADBiVNSJrP'.
+	    'eX73MY//skHP85z5+fnSxQsXj//4n39cmnPn7LbZlsajBmEnBL'.
+	    '1nuEGDG9x4aa5Ldz+h0RCuBqwBv1Wo+7vs9r7n++0MmYeAM+zB'.
+	    '+61EK1QUEnbbtN+9Bh3Hsebn54u//PdfLq9eWl2ZnZ1dSnaSwu'.
+	    'Pin40b9g3doKE0WoNIl65xj3v75njd3BBubQi6ExKmDWkMRKSl'.
+	    'tSbVKQcMao1Go5Ugb0+x53nOyZMnSysrKydXLq1cWlxa/McgCB'.
+	    'Yev3hU+GPrD3I5/q94k3pXYQY58q6B5Bs0HB//neaGx00gyWaz'.
+	    'VCoV7bquCoKAnZ0dfN/f03egLGj0m3XQNE1jdnY2/+WXXy6trq'.
+	    '6uzP3oR5eCIFi4detW5feXL1vr679Let37zVB3/mQytjXJwmSB'.
+	    'wikHp9ShY0RESqObwPrr5oBERKhUKly4cIFqtUq9XufmzZtsbW'.
+	    '2hXvuDwTTNtxZq8TyvsLy8vLS4uLgahOHphw8elL69fNlc++qr'.
+	    'uFOrNXPddm1cczVL5f5P+Lv5MuOJgTGxwYbZpZsCdeAq8M1Bcw'.
+	    'CGYeC6LtVqlRMnTjAyMkKn0yGXyx0N0LZt03Ec1zCMSrfXO37v'.
+	    'zp3S769csb+/ciXt1mrNdHf3ltZ6Lca8ZpJsduhtCdb2gEFJoQ'.
+	    'xADYHuHDS3f32lFEEQUK/XGRkZoVAocP78eZaXl9FaI/Jq25Uk'.
+	    'yWHAYrHozM/PlxYWFibTND32sFbLXrtyxVz76qukXas1M61WTW'.
+	    'm99gx+20TdN9jqtfjP7QzOwwYNp037Zd0DukDnIByA1pqdnR2+'.
+	    '++472u02Z8+eZWJiAsMwDsEBRNGBzYJpmsaJEyfyX3zxxdLS0t'.
+	    'KlVqu1dP3q1cLta9ekU6u1dat1J9b6Sk9kraV1rYXegW7apDYw'.
+	    'kFY6fPc4MNTw88bwfZ/NzU2UUnieRxAEiAiGcXiXfcigiIjruo'.
+	    'VyubxkWdbK7fX1xWvffFMInjzBM82uMT5+p++6V1UUrSe7u03t'.
+	    '+8lezlKt3gHyl0aSJDQaDa5fv876+vo+w6FzDq1BpZRsb2/bly'.
+	    '9f9vL5/Njdu3fzG0+eMJHNxsfn532vXN5NPG/7abPZal6/Hvfe'.
+	    'kroPHfsm98f7AHW9Xo+//vrrlmVZm71+37QNw3JnZ9PK4uJGpV'.
+	    'pt4Dh+vLGhsrmcfv1iHzu01m89HjIdCon2fb8TBMHtvYeRUn50'.
+	    '1Oj4vqp3Ok1f5LYSadfr9dQfDN642P/XeF2DA+SBAuA4jkOhUK'.
+	    'BQKESO43S11p3BYBDt7u4y+CtB/i/q7jp1GMiw2AAAAABJRU5E'.
+	    'rkJggg==' ; 
+
+//==========================================================
+// File: ppl_blue.png
+//==========================================================
+	$this->imgdata_large[3][0]= 2284 ;
+	$this->imgdata_large[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMLFRAiTZAL3gAACHlJREFUeJy9mGtv29YZgJ9zKF'.
+	    'F3y/Q9jh05tuQkarKgbYasde0UBdZgwNou/Vqga/sD9mP2B4a1'.
+	    'BbZ9atFPxb5sqOtmXbI19bqsluPYiR3HN90vFEWRZx/IJI5zqa'.
+	    'x0OwBBSgR5Hj7v+55zSEFXTUgIJyA9C6/9RsjMjAyFIxxJCDc7'.
+	    'iBqKgyZACGg3G2x9+xXf/fG33P3mC9qNKsp1O+1JdkEnQTdgIO'.
+	    'ttCSMUi8gj072MnugllAyB9G8rBGi6RsToJTF6iuRoFi1kHKZf'.
+	    '7fB8Iggj0/Dy23D2dakNTR3JDsXPvzstxmZGRMER1EwHhQAEgE'.
+	    'CLhIkPD6InY9S3djGLJVBtQP1Qb4HDAyoJYQOOZkPx49nhTH9i'.
+	    '7MUBGT7egxkJgd70wZS/CUkoZtA/fRoE1DZ2ACiv52ibReCp4e'.
+	    '7CIEHomxDiuVdGTqUnf/ZeOjR8fpiVXZul5ZrY3bWwbdcLr/dA'.
+	    'AAIpAwQjUWIjQ+g9HZvswiCgBVF9/SI6OSLGzo0i+oLi6+Utbq'.
+	    '+bKEftgwOE/0Ohocf66M+cBjo22U2RQLIHMhmYnvaOpR9S8bSU'.
+	    'UqCURGpRkuMZMm9cIvPGJZLj0yBjT2LprkiSkykx9cuXIhOnUs'.
+	    'm+QNC2XdG02ggBTcvFabsPWwTPpBAChSCgh4kYBpoeplWp47Qs'.
+	    '7EYDt21xINzd5GCAxLExRl89Z+nHjpbKMmjbmkgfDzI0JEW53K'.
+	    'Jaa6NcAOEX8v52uJzsBlAS6u0hcnTIccPRqhWPCUcLD+s1EaUp'.
+	    'HCEhEMCyHNpt9SjgIU12A6iw6xb123vYhaaKjB9tlgMD5X+uBp'.
+	    'zdkpg6azA8EaNQtKlVba+Xez4eCntnJrsDdFsW5nYFpxlFN846'.
+	    'DXe8utkM4mhi+EgQmjYbS2WqexZKk6BpjwJ2YlK5VjeA3pNDiH'.
+	    'YjRWPzPE7tmBo8EWwGhkXx+z3uXL7D3rU97LIF8RBEAl6lK/Uo'.
+	    '6JNM1rZ2aTcr3eUgIQOGTgbdwXMGyRejenLYTvQGbAdRuetSud'.
+	    'OivVuFZgtCEgICghICnZoMhmlVTPR49LCAEkQUhk/B7KXe0MWf'.
+	    'nxj8xVR/cDheK14WZmtVMJSBnlGoN6FmQq0FLfdwJgORKPHRo/'.
+	    'Snzx4G0F/FjJ4KiOdmjPCrrx8bffnMybMv9MQGNG3rzlVqtR1B'.
+	    'sh/CYXCD4Aag1oCW7ZnUOjSp6WFi/QNEB8Y7BfTNjZyCmUvJ0I'.
+	    'XXT47MTp98Ybon9VZCk8cVazfqlNargsY34G7ByAlIjkHd9CCr'.
+	    'LbBdiHViUgiECuDKYCdz8b2cywREdiYZOj8zNnLuzOTzx6ODp+'.
+	    'OaGaqwVzBFqz0Idhz2loE7YEwBLaAJLQcKbW8qjAcBF5Jh0AMP'.
+	    'IOHe6kxgtb3UMO2OxkF//ffK28nQqxfvm3szrtnDVa799Qb/+v'.
+	    'NtsbNSpm3tAv8B+w7Ub0FhAyoBcMPec9oK6raXk48ziQBXQcmC'.
+	    'pT3YqHa0mpEBkTR6wz/Jjo2cy04+fzwxdDquNfQKO7sFUbpu0c'.
+	    'wp3JoAYsA42Bbkl4GCryUNDEM7Avm6Z/CgSYBWG8pNuFuDu1Wo'.
+	    'tjoxKIJGeHIiM/jmK9NnX5ycuJQMtUcqXPvLDTa+qIie4hAJ1U'.
+	    'vdrmO2HaDfB931twJgAn1A4lGT96obPHPLBbhVgUoTHHWo9aAA'.
+	    'JVAKpyKEmQNzWRENAsL18ycKjAFN/9gCNvzLB/390MMmE7pnDi'.
+	    'Bvwt0K5Jv3O+0oB22nJ1Vvjb/UMhOpcKknqN1OiMB2DNHU2G5s'.
+	    'sVndpGJVcZXjX1IAlvw9PmhRQcOFPhsSDkiBrQR1G7brgs0a7D'.
+	    'ag3FK4rguqBXarI4Nt1SJv5gls7TEWtJDRBO2GwnIs8maevFnA'.
+	    'Gx6awLZvzeTBu4kFbLigijC47pscpx0xyDfkvtUEnlarCDtrUC'.
+	    't2HGIhvPHVdVwqjTIrxRU2a5uUrYoP0QZ2gMvACl7+3V/LuKDq'.
+	    'sJuDy597516+CEezIHXv7vcgXQu2l+Bvn8He9Y4AE4kgk5P9DE'.
+	    'R6aFdq5Et5Nit3yTf3m9sBcsAN3+D98c0Fit5JawE25r1zg1Fo'.
+	    '5B8GFD7g+nVYnu8EUEop9XTa0N/9dUbqcphP/rDJzbUClVbpgR'.
+	    'y2fXM3fND95qj75J8AC6BWPINfVSBieK+x+6cS5UCzCLu3oFV9'.
+	    'GqCMx2NGOp2Znpv7aXZudsool3T5J/179sxVlHJ4kGPrP2COBX'.
+	    '/7DmiApWCjxIMXpYNznYuXM+6TAKWUMppOZzLvv//ery5cuDCT'.
+	    'SqVS336bCwr1JfAPB9r+2KAFwJS+OcETzZHz/7v3etl6ipz77X'.
+	    'GAMh6PG+l0OjM3NzczOzs3k0pNnFlbW43+e/GKtMqrblSsF03V'.
+	    'WHcJA0PjIAzvg9JTze2H67g9DjAwOTmZ+uCDD96anZ2dnZiYmF'.
+	    '5dW41++Lvfa1fnr7qllVK9103mXNTnJgPA+YugsvB3HTaEl+Qs'.
+	    'AZ/yeHPPDCiTyaRx5syZbGoilV1dW00szC9oV+avusuLy0Xd0X'.
+	    'MgFkDM+zkYBZEHV8f7wwKu84zmngQoNU0LaZoWUa4K31y5qX/8'.
+	    '4cfyyvwVN5/L10NOKNeg8UmDxoKF5Vfj1xXAgD0JrgAcvBDfel'.
+	    'a4g4AykUgY6XR6emJiIru2ttZXq9S0K19eUcuLy8WQE8o5OAsN'.
+	    'Ggsmpl+NpoL1g9X4UBU+C9xDgEKIwNTUVOqdd955M9mbnJ3/cj'.
+	    '6Vu5aTheXCQXNdVeMzAwJSCGEA2XKpnF1cXIzlFnOVhJPIKdR+'.
+	    'c88ctq4AlVKsrKzw0UcfKcC5uXqzXnNqSzb2pwLxOHP/l7Z/BN'.
+	    'eB01LKt4HTrusKvGr8jB+hGn8MQAkYQMrfw4Nq/MFPtf+rdvDb'.
+	    'k8QL+/5Z4Uepxm7bfwHuTAVUWpWaqAAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: ppl_green.png
+//==========================================================
+	$this->imgdata_large[4][0]= 2854 ;
+	$this->imgdata_large[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMLFQ4hANhluwAACrNJREFUeJytmF1zE1eagJ+3u9'.
+	    'XdkvUty2AbmLEtEzDBgZ0UpDBOalNTUzU3czl7tct/2n+wt3M/'.
+	    'NVM12SSTQQSyW2TA+QAJQogtYYFtyfrqL3WfvWj5g8AEjzfvhS'.
+	    'SXjk8//Zz3Pf3qCMcJAWxMKlT4kH+jwu/FknnJSUItKFHzCrKA'.
+	    'BggBQx5ziz/wn/yBz3hED4/oaJfSjgVoYjJJgTLTZCjohp7IGT'.
+	    'k5aZ4kb+bRTR30Q7djj8f/kpPMUSCFedRL6W8e8qMQNE6S4xpv'.
+	    'c5HrTPFubiJ3ZnlyOXV59rJYU5Z00h1c3d0brxAiUkScRijisk'.
+	    '6XLTyiN3s8HuAJpniXa/q8/pt8Or+0kF8oXJm5YiydWcIpOrJu'.
+	    'rjOQwd54AQwsMpTJYhPSoYuLQ58An/DnBQSdImXO8avsTPbqpc'.
+	    'lLp67OXDVzMznZLGxSs2qyIRu4at8gKHQEC50kE1icxqCAdxST'.
+	    'xjEA44tqaJlERl8uLWvvnX5PHuQfcCdxh5qq0aX76vj4WgWyXO'.
+	    'QiNgBP8IAaddr08X8+wHFmJSQhBbPAZGoSZSt5wQs6qoNC7UEd'.
+	    '4AEoLIQSCaCCy78Dv8Tiv1hjjW1CRj8XIAgEKqDtt9keboMJZa'.
+	    'vMjuzQVd3Xr9prTJo+GF/jKZea95R25Lxs8jg5qFGiwDnOS0mW'.
+	    'NE0rjNRIt3WbklUCA9mV3Zdz8OBT/JfCQLB0SKYVVjGFYSfx/E'.
+	    '26ow4e6uDujlPFQpE0FU6P8qNTHdXJdEdda0qf0itWBVM3pa/3'.
+	    'ccUlIECJet0cAJoeYk5EZCeS5IwEoerSxccJBwRqFFf38QCTaO'.
+	    'TRVFKJm3NTbtLNSyh2IkhIXsvLCesEGNCWdmwyruSD/z9kUlRc'.
+	    '3bqNlSxhJNJ43p5JITrOEis8Qtr0cXEpU/JT/pmO18n2vb42pU'.
+	    '3JnDnHMBqyPlpnoAaxhr2llv1ZUBqEGlqYwDQMsskMOcMgVL3Y'.
+	    'ZOQTHAcQQiIGjHCwCaiovjrv4hbcpKuJJjIcDHm685RGr4GLCx'.
+	    'YHkAcrLoAoDSLBiAQrMkjqybHJCbxgh+7xAC1MpsgzwRwD3qHL'.
+	    'WyTIBdlAa6u2rHfXaew06PV78ZZjAwleNnkolECoH5i090wOcY'.
+	    '+TgwYzFHiPi1zkOkXexeAMASnVU+LiyiA1wFUuaqggACLizeWw'.
+	    'ycMzyssmVYKkbpGyC5T+OUALk2mKLHKWf+ED/az+YW42d66YL+'.
+	    'aNrmEEzQCFEnKw368EgEvcN1m80eTIQIt0TFOjMJHkzNEBBYPp'.
+	    'sblf8QHzrORO5JaWZ5ZLl6cuJyyxpNPv4PZdoT+GyIxBfI5uUg'.
+	    'eJMCwP2/bIHO1JEudcgUUWOceKNq99mCvnzs5PzRcuTV4y5mRO'.
+	    'SMIjo47z5S7a94oQCNKgJsZwO7D/IDNg3/LLhRNXt4JohBb4aG'.
+	    '82GLdXcf93mQ+Y43r2RHZp+cRy6cqJK4l8MS+tdItaqiYtc0Mm'.
+	    'QpfJARh98HYh9IiXVcaAo58wGb+LBAjbSPgCOcoSa0wzxXtc08'.
+	    '/pv8mfyL+9MLVQvDJ1JVHJV6SZbFI1qtTsB+KlehRtRTGE8Afo'.
+	    'P4DRcAxiEudhAHjjzz+ubgX4oHowakHQOlqzICQwyVPITGVOXi'.
+	    'xfLF6aumzmczl5lHzMff2+fCdPaGttEkXoLQAO9B7C6EugPYby'.
+	    'gVPjGXc5eIbNAJPjGwiAbaAJUQv8wVG7GROkJFpyOqn/ovgLba'.
+	    '44L0+sDaraXb6jzq7aBQWjBOyUoHcaopOgmaA3IRyNDZnA1HjO'.
+	    'HSBkr7eEFDAEngHrQCf+/s2A8cSiSkqcKUeeTjwFy2Jd78t3+L'.
+	    'TR4itIiBLwLQhzkJyB5Cx4HXDaENVQCBAQcRqFIHTRaBIvuYXg'.
+	    'AdsouuNxEL0ZUBHnSQp66R73zYfUtQ6OytKT8RckQAJQoLtgO5'.
+	    'BJgj0D/WfgdyHaAHx8THoUcbGx8ciwhUl3bDEiToURPooeI7pH'.
+	    'MziK9Yd9nU5a6GgKjOH41vsgI4hAcyC5AZkapF+AoYNrjjsuhx'.
+	    'FbtPmeB5ykyQQzTPAWAQWC8S9oAI0QRRuPb9jkmyMZNAOTklvC'.
+	    'GGYZaFkGmkVAh8h4DtKFMIBunG+pB5B5AIkGBDsQ+qBiL20caj'.
+	    'zhJknq5KlgMkLjJHJos4kYEbFJi5vc5eYbATVN02bNWe19+32t'.
+	    'aJWlFm3wbf8Rz5NbDFJdlOFBF/g7cBf0JkrbBb+F6j1DOduEkU'.
+	    '8bWCOiSofPWadBnSZDWmgUkEMGhZCINut8S/0NBtPptFlZrBSu'.
+	    'vnt1+ndnflfIp9OJ/279Ubbbd+lP7KBKPoEBsgnqLph/BRzwdS'.
+	    'LnBUFvHcfdpRsGPAGqwMco6jynz+e0SPKYCHMfLX5VKHwcenR+'.
+	    'Igd1XTcqlUr+xn/cePv91fevzy8sLO2OtrOpWkqL7gXKSAVRdh'.
+	    'ZFEmEXoYkwBNqovoc/3GHH3aUR+jwC1oD/AWrANi4hGwyBzqEG'.
+	    'Vvb77Dgi0eT1VZzJZMxKpVJYXV1dXF1dXVm6sPSvruue3Xzcyj'.
+	    '6/syvDzwj0lNazK6Fj5LFCRZouZpBABj6jXouu3+Np6HNvDHaf'.
+	    'g91t74msbMuOJicnSSaTKKUQEUQEpRSO69But1/dB0VEm5uby9'.
+	    'y4cWNpdXX1+sLCworrume//PuXpeqnVeOban0U1PW2kcx+O9L7'.
+	    'Te9sUB4lWFR9SqNtNGcHx+/RDD2+Am4D94CnQA8OjjlEhMnyJC'.
+	    'srK8zOzu7BiYioMAzZ2Njg9u3brwIqpSSXy2WXl5eXLly4sOo4'.
+	    'zoV6vV6oflrVP/7Tx8Hmw1Zb6ydqmpWp7ha8h4O3gjOhzVANmF'.
+	    'XPMNQWvdDnCXCXuHR+APqH4fbCtm2mp6eZn59H13WJuYXRaKSU'.
+	    'UiSTyVcBdV3XDcOwRaTU7/en19bWCn/79G+JL/76RbhZ22y7u+'.
+	    '6ahl71nPDz/nO17m7wAxlabFOihy4+DvAcqAMbPzZ3OFzX5dmz'.
+	    'Z2iahoiosUUVhiGNRgPHcV4GzGQy5uLiYuH8+fMzo9FoslarJW'.
+	    '9+elP75E+fBJu1zY7qqpqBUW3T/niohnVvy+1zm5aVtp+WE2XT'.
+	    'nrHFzbjh1tYLz3XdPjD4R3BKKba2tqhWq4dzUO3noBPn4H5PKy'.
+	    'LaO++8U7hx48byhQsXVne7u6tf3/v64t3P7mbq9+odt+OuaWi3'.
+	    'PLxbW2ytubjbQCgiMnt6VlaurWgz0zM0m02q1WrUaDSUUuqI56'.
+	    'ivDxE5MCgiYllWtlwuL5mmufLV/a/O/uXPf9Ff1F+80Lv6Yx29'.
+	    '2qHzyZBh3cdvc7gaTZuZkzPh/Py8ACqVSv1/uPZDKXUAGEWRtF'.
+	    'qtxEcffZTL5XLF+2v39fqjeivshA/TpP83JLwzYFBzcA4370Cc'.
+	    'S81nTRBUs9lkOByi1GuOPI4Rh3+26JZlnSkWi781DOPXvV4v3+'.
+	    '/2G0R8kSBxB/jew+tERK+c49m2TblcxrZtXNfl+fPneJ6HZVmU'.
+	    'y2VJJpNyaJ9TSinlOA5bW1u4rntkQA0oAG8D54gb9W3ianxM3A'.
+	    'e/cn73U3Hq1Cm5du2aPjs7a+ztcSIShmE4ajQa6tatWzQajZ+0'.
+	    'fbiKI+It4SvijVUj7kL2qvGfgkskEqTTaZmcnDROnTplJhIJTU'.
+	    'QiwPd9P/Q8T6XTaQzDIAiCfzjP/wFVfszuFqdHXgAAAABJRU5E'.
+	    'rkJggg==' ; 
+
+
+//==========================================================
+// File: pp_red.png
+//==========================================================
+	$this->imgdata_small[0][0]= 384 ;
+	$this->imgdata_small[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAA'.
+	    'B3RJTUUH0wMJFhouFobZrQAAAQ1JREFUeJyV1dFtwyAQBuD/og'.
+	    'xQdYxa8gRY6hJ0jK6QdohMkTEuE5wUj5ERen05IoLvID7Jkn2G'.
+	    'j8MgTMyMXqRlUQBYq9ydmaL2h1cwqD7l30t+L1iwlbYFRegY7I'.
+	    'SHjkEifGg4ww3aBa/l4+9AhxWWr/dLhEunXUGHq6yGniw3QkOw'.
+	    '3jJ7UBd82n/VVAlAtvsfp98lAj2sAJOhU4AeQ7DC1ubVBODWDJ'.
+	    'TtCsEWa6u5M1NeFs1NzgdtuhHGtj+9Q2IDppQUAL6Cyrlz0gDN'.
+	    'ohSMiJCt861672EiAhEhESG3woJ9V9OKTkwRKbdqz4cHmFLSFg'.
+	    's69+LvAZKdeZ/n89uLnd2g0S+gjd5g8zzjH5Y/eLLi+NPEAAAA'.
+	    'AElFTkSuQmCC' ; 
+
+//==========================================================
+// File: pp_orange.png
+//==========================================================
+	$this->imgdata_small[1][0]= 403 ;
+	$this->imgdata_small[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAA'.
+	    'B3RJTUUH0wMJFhwAnApz5AAAASBJREFUeJyN1dFthDAMBuDf7S'.
+	    '3BCm2VCRKpS4QxbhikW6IewzcBqm6Fm6JyH7iEEByCn5AJH38g'.
+	    'BBIRHNUzBAWAGNfe/SrUGv92CtNt309BrfFdMGPjvt9CD8Fyml'.
+	    'ZZaDchRgA/59FDMD18pvNoNyHxMnUmgLmPHoJ+CqqfMaNAH22C'.
+	    'fgqKRwR+GRpxGjXBEiuXDBWQhTK3plxijyWWvtKVS5KNG1xM8I'.
+	    'OBr7geV1WupDqpmTAPKjCqLhxk/z0PImQmjKrAuI6vMXlhFroD'.
+	    'vfdqITXWqg2YMSJEAFcReoag6UXU2DzPG8w5t09YYsAyLWvHrL'.
+	    'HUy6D3XmvMAAhAay8kAJpBosX4vt0G4+4Jam6s6Rz1fgFG0ncA'.
+	    'f3XfOQcA+Acv5IUSdQw9hgAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: pp_pink.png
+//==========================================================
+	$this->imgdata_small[2][0]= 419 ;
+	$this->imgdata_small[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAA'.
+	    'B3RJTUUH0wMJFhsQzvz1RwAAATBJREFUeJyd1MFthDAQheF/oi'.
+	    'gF+JYWQKICkCJRA1vGtrDbxFbhGvY0HVjCLeS2BeTiHFgTB2wg'.
+	    'eRISstCnmcG2qCpbuXf3ADBQzWsPfZfS9y9HsEu4/Fo33Wf4Fx'.
+	    'gxL3a1XkI3wbTNXHLoboVeLFUYDqObYBy+Fw/Uh9DdCmtOwIjF'.
+	    'YvG76CZoOhNGRmpO8zz30CJoOhMAqlDxFzQLppgXj2XaNlP7FF'.
+	    'GLL7ccMYCBgZERgCvXLBrfi2DEclmiKZwFY4tp6sW26bVfnede'.
+	    'e5Hc5dC2bUgrXGKqWrwcXnNYDjmCrcCIiQgDcFYV05kQ8SXmnB'.
+	    'NgPiVN06wrTDGAhz5EWY/FOccTk+cTnHM/YNu2YYllgFxCWuUM'.
+	    'ikzGx+2Gc+4N+CoJW8n+5a2UKm2aBoBvGA6L7wfl8aoAAAAASU'.
+	    'VORK5CYII=' ; 
+
+
+//==========================================================
+// File: pp_blue.png
+//==========================================================
+	$this->imgdata_small[3][0]= 883 ;
+	$this->imgdata_small[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAACi1'.
+	    'BMVEX///8AAAAAADMAAGYAAJkAAMwAAP8zAAAzADMzAGYzAJkz'.
+	    'AMwzAP9mAABmADNmAGZmAJlmAMxmAP+ZAACZADOZAGaZAJmZAM'.
+	    'yZAP/MAADMADPMAGbMAJnMAMzMAP//AAD/ADP/AGb/AJn/AMz/'.
+	    'AP8AMwAAMzMAM2YAM5kAM8wAM/8zMwAzMzMzM2YzM5kzM8wzM/'.
+	    '9mMwBmMzNmM2ZmM5lmM8xmM/+ZMwCZMzOZM2aZM5mZM8yZM//M'.
+	    'MwDMMzPMM2bMM5nMM8zMM///MwD/MzP/M2b/M5n/M8z/M/8AZg'.
+	    'AAZjMAZmYAZpkAZswAZv8zZgAzZjMzZmYzZpkzZswzZv9mZgBm'.
+	    'ZjNmZmZmZplmZsxmZv+ZZgCZZjOZZmaZZpmZZsyZZv/MZgDMZj'.
+	    'PMZmbMZpnMZszMZv//ZgD/ZjP/Zmb/Zpn/Zsz/Zv8AmQAAmTMA'.
+	    'mWYAmZkAmcwAmf8zmQAzmTMzmWYzmZkzmcwzmf9mmQBmmTNmmW'.
+	    'ZmmZlmmcxmmf+ZmQCZmTOZmWaZmZmZmcyZmf/MmQDMmTPMmWbM'.
+	    'mZnMmczMmf//mQD/mTP/mWb/mZn/mcz/mf8AzAAAzDMAzGYAzJ'.
+	    'kAzMwAzP8zzAAzzDMzzGYzzJkzzMwzzP9mzABmzDNmzGZmzJlm'.
+	    'zMxmzP+ZzACZzDOZzGaZzJmZzMyZzP/MzADMzDPMzGbMzJnMzM'.
+	    'zMzP//zAD/zDP/zGb/zJn/zMz/zP8A/wAA/zMA/2YA/5kA/8wA'.
+	    '//8z/wAz/zMz/2Yz/5kz/8wz//9m/wBm/zNm/2Zm/5lm/8xm//'.
+	    '+Z/wCZ/zOZ/2aZ/5mZ/8yZ///M/wDM/zPM/2bM/5nM/8zM////'.
+	    '/wD//zP//2b//5n//8z///9jJVUgAAAAAXRSTlMAQObYZgAAAA'.
+	    'FiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElN'.
+	    'RQfTAwkWGTNerea3AAAAYUlEQVR4nHXNwQ3AIAxDUUfyoROxRZ'.
+	    'icARin0EBTIP3Hp1gBRqSqYo0seqjZpnngojlWBir5+b8o06lM'.
+	    'ha5uFKEpDZulV8l52axhVzqaCdxQp32qVSSwC1wN3fYiw7b76w'.
+	    'bN4SMue4/KbwAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: pp_green.png
+//==========================================================
+	$this->imgdata_small[4][0]= 447 ;
+	$this->imgdata_small[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAA'.
+	    'B3RJTUUH0wMJFhkLdq9eKQAAAUxJREFUeJyN1LFVwzAQxvH/8f'.
+	    'IeDS0FLKABlN6eIwPYAzCHB0gWYI2jj+i1ABUTQN4TRSQ7iiWZ'.
+	    'qxLn9Mt9ydmiqrSq930AYFiu6YdKrf/hP1gYQn6960PxwBaYMG'.
+	    'E9UA3dBFtVQjdBOQmBakLennK0CapRwbZRZ3N0O/IeEsqp3HKL'.
+	    'Smtt5pUZgTPg4gdDud+6xoS97wM2rsxxmRSoTgoVcMZsXJkBho'.
+	    'SmKqCuOuEtls6nmGMFPTUmxBKx/MeyNfQGLoOOiC2ddsxb1Kzv'.
+	    'ZzUqu5IXbGDvBJf+hDisi77qFSuhq7Xpuu66TyJLRGbsXVUPxV'.
+	    'SxsgkzDMt0mKT3/RcjL8C5hHnvJToXY0xYRZ4xnVKsV/S+a8YA'.
+	    'AvCb3s9g13UhYj+TTo93B3fApRV1FVlEAD6H42DjN9/WvzDYuJ'.
+	    'dL5b1/ji+/IX8EGWP4AwRii8PdFHTqAAAAAElFTkSuQmCC' ; 
+    }
+}
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_squares.inc php-syslog-ng/html/includes/jpgraph/imgdata_squares.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_squares.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/imgdata_squares.inc	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,151 @@
+<?php
+//=======================================================================
+// File:	IMGDATA_SQUARES.INC
+// Description:	Base64 encoded images for squares
+// Created: 	2003-03-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: imgdata_squares.inc 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class ImgData_Squares extends ImgData {
+    var $name = 'Squares';
+    var $an = array(MARK_IMG_SQUARE =>'imgdata');
+    
+    var $colors = array('bluegreen','blue','green', 
+			'lightblue','orange','purple','red','yellow');
+    var $index  = array('bluegreen' =>2,'blue'=>5,'green'=>6, 
+			'lightblue'=>0,'orange'=>7,'purple'=>4,'red'=>3,'yellow'=>1);
+    var $maxidx = 7 ;
+    var $imgdata ;
+
+    function ImgData_Squares () {
+//==========================================================
+//sq_lblue.png
+//==========================================================
+	$this->imgdata[0][0]= 362 ;
+	$this->imgdata[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAIAAADZrBkAAAAABm'.
+	    'JLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsRAAALEQF/ZF+RAAAA'.
+	    'B3RJTUUH0wMLFgojiPx/ygAAAPdJREFUeNpj/P377+kzHx89/c'.
+	    'VAHNBQ5VBX52HavPWWjg6nnDQbkXoUFTnnL7zD9PPXrz17HxCj'.
+	    'E6Jn6fL7H7/+ZWJgYCBGJ7IeBgYGJogofp1oehDa8OjE1IOiDa'.
+	    'tOrHoYGBhY0NwD0enirMDAwMDFxYRVD7ptyDrNTAU0NXix6sGu'.
+	    'jYGBgZOT9e/f/0xMjFyczFgVsGAKCfBza2kKzpl3hIuT1c9Xb/'.
+	    'PW58/foKchJqx6tmy98vbjj8cvPm/afMnXW1JShA2fNmQ9EBFc'.
+	    'Opnw6MGjkwm/Hlw6mQjqwaqTiRg9mDoZv//4M2/+UYJ64EBWgj'.
+	    'cm2hwA8l24oNDl+DMAAAAASUVORK5CYII=' ; 
+
+//==========================================================
+//sq_yellow.png
+//==========================================================
+	$this->imgdata[1][0]= 338 ;
+	$this->imgdata[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAWl'.
+	    'BMVEX////+/+H+/9/9/9v8/8P8/8H8/7v8/7n6/4P5/335/3n5'.
+	    '/3X4/1f4/1P3/031/w30/wn0/wPt+ADp9ADm8ADk7gDc5gDa5A'.
+	    'DL1ADFzgCwuACqsgClrABzeAC9M0MzAAAAAWJLR0QAiAUdSAAA'.
+	    'AAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9MDCxYEDlOgDj'.
+	    'EAAAB+SURBVHjaVcpbCsQgDEDRGERGKopjDa2a/W9zfLWj9/Nw'.
+	    'Ac21ZRBOtZlRN9ApzSYFaDUj79KIorRDbJNO9bN/GUSh2ZRJFJ'.
+	    'S18iorURBiyksO8buT0zkfYaUqzI91ckfhWhoGXTLzsDjI68Sz'.
+	    'pGMjrzPzauA/iXk1AtykmvgBC8UcWUdc9HkAAAAASUVORK5CYI'.
+	    'I=' ; 
+
+//==========================================================
+//sq_blgr.png
+//==========================================================
+	$this->imgdata[2][0]= 347 ;
+	$this->imgdata[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAZl'.
+	    'BMVEX////0+vv0+vrz+fry+frv+Png7e/d7e/a6+zY6+250tSz'.
+	    '0tSyztCtztGM0NWIz9SDzdNfsLVcrrRZrbJOp61MpqtIr7dHn6'.
+	    'RErrZArLQ6q7M2g4kygYcsp68npa4ctr8QZ20JnqepKsl4AAAA'.
+	    'AWJLR0QAiAUdSAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU'.
+	    '1FB9MDCxYEByp8tpUAAAB7SURBVHjaVcjRFoIgDADQWZpWJpjY'.
+	    'MsnG//9kzIFn3McLzfArDA3MndFjrhvgfDHFBEB9pt0CVzwrY3'.
+	    'n2yicjhY4vTSp0nbXtN+hCV53SHDWe61dZY+/9463r2XuifHAM'.
+	    '0SoH+6xEcovUlCfefeFSIwfTTQ3fB+pi4lV/bTIgvmaA7a0AAA'.
+	    'AASUVORK5CYII=' ; 
+
+//==========================================================
+//sq_red.png
+//==========================================================
+	$this->imgdata[3][0]= 324 ;
+	$this->imgdata[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAXV'.
+	    'BMVEX////++Pn99/j99ff99fb98/X98/T98PL55uj43+P24+bw'.
+	    'kKPvjaHviJ3teJHpxMnoL2Pjs73WW3rWNljVWXnUVnbUK1DTJk'.
+	    '3SUHPOBz/KQmmxPVmuOFasNFOeIkWVka/fAAAAAWJLR0QAiAUd'.
+	    'SAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9MDCxYEHd'.
+	    'ceT+8AAABtSURBVHjaVchbAkMwEAXQq6i3VrQiQfa/zDYTw8z5'.
+	    'PCjGt9JVWFt1XWPh1fWNdfDy+tq6WPfRUPENNKnSnXNWPB4uv2'.
+	    'b54nSZ8jHrMtOxvWZZZtpD4KP6xLkO9/AhzhaCOMhJh68cOjzV'.
+	    '/K/4Ac2cG+nBcaRuAAAAAElFTkSuQmCC' ; 
+
+//==========================================================
+//sq_pink.png
+//==========================================================
+	$this->imgdata[4][0]= 445 ;
+	$this->imgdata[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAApV'.
+	    'BMVEX////6+Pz69/v49Pr38/r17/jr4+/l3Onj2efh1ua/L+i+'.
+	    'q8m+Lue9Lua8qsS8LuW8LeS7pca5LOG4LN+2Y9O2YNW1ZdO1Kt'.
+	    'y0atC0aNGzb82zbc6zKtuzKdqycsuwa8qtJtOISZ2GRpuFN6GE'.
+	    'NqCDQpmCMZ+BPpd/LJ1/K519S5B9Jpx9Jpt9JZt6RY11BJZ1BJ'.
+	    'V0BJV0BJRzBJNvNoRtIoJUEmdZ/XbrAAAAAWJLR0QAiAUdSAAA'.
+	    'AAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9MDCxYDF3iKMD'.
+	    'YAAACeSURBVHjaVczbEoIgGARgCiMtrexoWpaa2FHUgvd/tH4Y'.
+	    'BnEvv9ldhNPradPnnGBUTtPDzMRPSIF46SaBoR25dYjz3I20Lb'.
+	    'ek6BgQz73Il7KKpSgCO0pTHU0886J1sCe0ZYbALjGhjFnEM2es'.
+	    'VhZVI4d+B1QtfnV47ywCEaKeP/p7JdLejSYt0j6NIiOq1wJZIs'.
+	    'QTDA0ELHwhPBCwyR/Cni9cOmzJtwAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+//sq_blue.png
+//==========================================================
+	$this->imgdata[5][0]= 283 ;
+	$this->imgdata[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAQl'.
+	    'BMVEX////4+fz39/z19vvy8vru7/ni4+7g4fHW1ue8vteXmt6B'.
+	    'hdhiZ7FQVaZETcxCSJo1Oq4zNoMjKakhJHcKFaMEC2jRVYdWAA'.
+	    'AAAWJLR0QAiAUdSAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0'.
+	    'SU1FB9MDCxYDN0PkEP4AAABfSURBVHjaVchHAoAgDATAVcCCIF'.
+	    'j4/1elJEjmOFDHKVgDv4iz640gLs+LMF6ZUv/VqcXXplU7Gqpy'.
+	    'PFzBT5qml9NzlOX259riWHlS4kOffviHD8PQYZx2EFMPRkw+9Q'.
+	    'FSnRPeWEDzKAAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+//sq_green.png
+//==========================================================
+	$this->imgdata[6][0]= 325 ;
+	$this->imgdata[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAXV'.
+	    'BMVEX////2+vX1+vX1+fT0+fPz+PPx9/Dv9u7u9e3h7uHe697a'.
+	    '6dnO2s3I1sa10LOvza2ay5aEwYBWlE9TqE5Tkk1RkEpMrUJMg0'.
+	    'hKiUNGpEFBojw8oTcsbScaYBMWlwmMT0NtAAAAAWJLR0QAiAUd'.
+	    'SAAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9MDCxYEFd'.
+	    'nFx90AAABuSURBVHjaVc9HAoAgDADB2HuJWLDx/2cKBITscW4L'.
+	    '5byzMIWtZobNDZIZtrcCGZsRQ8GwvRSRNxIiMuysODKG3alikl'.
+	    'ueOPlpKTLBaRmOZxQxaXlfb5ZWI9om4WntrXiDSJzp7SBkwMQa'.
+	    'FEy0VR/NAB2kNuj7rgAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+//sq_orange.png
+//==========================================================
+	$this->imgdata[7][0]= 321 ;
+	$this->imgdata[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAAAUV'.
+	    'BMVEX/////8+n/8uf/8OP/59H/5Mv/zqH/zJ3/ypv/yJf/vYH/'.
+	    'u33/uXn/n0n/nUX/m0H/lzn/ljf/lDP/kS3/kCv/iR//hxv/fg'.
+	    'n/fAX/eQDYZgDW6ia5AAAAAWJLR0QAiAUdSAAAAAlwSFlzAAAL'.
+	    'EgAACxIB0t1+/AAAAAd0SU1FB9MDCxYEJIgbx+cAAAB2SURBVH'.
+	    'jaVczRCoQwDETRbLAWLZSGUA35/w/dVI0283i4DODew3YESmWW'.
+	    'kg5gWkoQAe6TleUQI/66Sy7i56+kLk7cht2N0+hcnJgQu0SqiC'.
+	    '1SzSIbzWSi6gavqJ63wSduRi2f+kwyD5rEukwCdZ1kGAMGMfv9'.
+	    'AbWuGMOr5COSAAAAAElFTkSuQmCC' ; 
+    }
+}
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_stars.inc php-syslog-ng/html/includes/jpgraph/imgdata_stars.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/imgdata_stars.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/imgdata_stars.inc	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,145 @@
+<?php
+//=======================================================================
+// File:	IMGDATA_STARS.INC
+// Description:	Base64 encoded images for stars
+// Created: 	2003-03-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: imgdata_stars.inc 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+
+class ImgData_Stars extends ImgData {
+    var $name = 'Stars';
+    var $an = array(MARK_IMG_STAR => 'imgdata');
+
+    var $colors = array('bluegreen','lightblue','purple','blue','green','pink','red','yellow');
+    var $index  = array('bluegreen'=>3,'lightblue'=>4,'purple'=>1, 
+			'blue'=>5,'green'=>0,'pink'=>7,'red'=>2,'yellow'=>6);
+    var $maxidx = 7 ;
+    var $imgdata ;
+
+    function ImgData_Stars() {
+//==========================================================
+// File: bstar_green_001.png
+//==========================================================
+	$this->imgdata[0][0]= 329 ;
+	$this->imgdata[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAAUV'.
+	    'BMVEX///////+/v7+83rqcyY2Q/4R7/15y/1tp/05p/0lg/zdX'.
+	    '/zdX/zVV/zdO/zFJ9TFJvDFD4yg+8Bw+3iU68hwurhYotxYosx'.
+	    'YokBoTfwANgQFUp7DWAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgF'.
+	    'HUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJj'.
+	    'CRyxgTAAAAcUlEQVR4nH3MSw6AIAwEUBL/IKBWwXL/g0pLojUS'.
+	    'ZzGLl8ko9Zumhr5iy66/GH0dp49llNPB5sTotDY5PVuLG6tnM9'.
+	    'CVKSIe1joSgPsAKSuANNaENFQvTAGzmheSkUpMBWeJZwqBT8wo'.
+	    'hmysD4bnnPsC/x8ItUdGPfAAAAAASUVORK5CYII=' ; 
+//==========================================================
+// File: bstar_blred.png
+//==========================================================
+	$this->imgdata[1][0]= 325 ;
+	$this->imgdata[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v79uRJ6jWPOSUtKrb+ejWO+gWPaGTruJTr6rZvF2'.
+	    'RqC2ocqdVuCeV+egV/GsnLuIXL66rMSpcOyATbipY/OdWOp+VK'.
+	    'aTU9WhV+yJKBoLAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJwynv1'.
+	    'XVAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bstar_red_001.png
+//==========================================================
+	$this->imgdata[2][0]= 325 ;
+	$this->imgdata[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v7+eRFHzWG3SUmHnb37vWGr2WHG7Tlm+TljxZneg'.
+	    'Rk3KoaXgVmXnV2nxV227nJ++XGzErK3scIS4TVzzY3fqWG2mVF'.
+	    'zVU2PsV2rJFw9VAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJzCI0C'.
+	    'lSAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bstar_blgr_001.png
+//==========================================================
+	$this->imgdata[3][0]= 325 ;
+	$this->imgdata[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v79Ehp5Yx/NSq9Jvw+dYwu9YzfZOmbtOmb5myPFG'.
+	    'gqChvcpWteBXvedXxvGcsbtcpb6su8RwzOxNmrhjyvNYwupUjK'.
+	    'ZTr9VXwOyJhmWNAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJTC65k'.
+	    'vQAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bstar_blgr_002.png
+//==========================================================
+	$this->imgdata[4][0]= 325 ;
+	$this->imgdata[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v79EnpxY8/FS0dJv5+dY7+9Y9vBOubtOur5m8fFG'.
+	    'nKChycpW3uBX5+ZX8e2curtcvrqswsRw7OdNuLZj8/BY6udUpK'.
+	    'ZT1dRX7OtNkrW5AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJgXHeN'.
+	    'wwAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bstar_blue_001.png
+//==========================================================
+	$this->imgdata[5][0]= 325 ;
+	$this->imgdata[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v79EY55Yi/NSetJvledYiO9YkPZOb7tObr5mkvFG'.
+	    'X6ChrcpWgOBXhedXi/Gcpbtcf76sssRwnOxNcbhjk/NYiepUbK'.
+	    'ZTfdVXh+ynNEzzAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJhStyP'.
+	    'zCAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bstar_oy_007.png
+//==========================================================
+	$this->imgdata[6][0]= 325 ;
+	$this->imgdata[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v7+ejUTz11jSvVLn02/v1lj21li7q06+r07x2mag'.
+	    'lUbKxKHgy1bnz1fx1Ve7t5y+qlzEwqzs03C4pE3z2WPqz1imml'.
+	    'TVv1Ps01dGRjeyAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJjsGGc'.
+	    'GbAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+
+//==========================================================
+// File: bstar_lred.png
+//==========================================================
+	$this->imgdata[7][0]= 325 ;
+	$this->imgdata[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAMAAABsDg4iAAAATl'.
+	    'BMVEX///+/v7+eRJPzWN3SUr7nb9TvWNj2WOS7Tqi+TqnxZtyg'.
+	    'Ro/KocPgVsjnV9LxV927nLa+XLTErL7scN24TarzY9/qWNemVJ'.
+	    'jVU8LsV9VCwcc9AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgA'.
+	    'AAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTAxYTJxi9ZY'.
+	    'GoAAAAcElEQVR4nH3MyQ6AIAwEUFIqiwju2///qLQmWiJxDnN4'.
+	    'mYxSv5lqGCs2nvaLLtZx/VhGOW1MjnPJWp0zsw2wsUY2jd09BY'.
+	    'DFmESC+BwA5UCUxhqAhqrA4CGrLpCMVGK4sZe4B+/5RLdiyMb6'.
+	    'on/PuS9CdQNC7yBXEQAAAABJRU5ErkJggg==' ; 
+    }
+}
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpg-config.inc php-syslog-ng/html/includes/jpgraph/jpg-config.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpg-config.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpg-config.inc	2008-02-05 22:06:44.000000000 -0500
@@ -0,0 +1,203 @@
+<?php
+//=======================================================================
+// File:	JPG-CONFIG.INC
+// Description:	Configuration file for JpGraph library
+// Created: 	2004-03-27
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpg-config.inc 242 2005-11-20 11:34:41Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+
+
+//------------------------------------------------------------------------
+// Directories for cache and font directory. 
+//
+// CACHE_DIR:
+// The full absolute name of the directory to be used to store the
+// cached image files. This directory will not be used if the USE_CACHE
+// define (further down) is false. If you enable the cache please note that
+// this directory MUST be readable and writable for the process running PHP.
+// Must end with '/'
+//
+// TTF_DIR:
+// Directory where TTF fonts can be found. Must end with '/'
+//
+// The default values used if these defines are left commented out are:
+//
+// UNIX:
+//   CACHE_DIR /tmp/jpgraph_cache/
+//   TTF_DIR   /usr/X11R6/lib/X11/fonts/truetype/
+//   MBTTF_DIR /usr/share/fonts/ja/TrueType/
+//
+// WINDOWS:
+//   CACHE_DIR $SERVER_TEMP/jpgraph_cache/
+//   TTF_DIR   $SERVER_SYSTEMROOT/fonts/
+//   MBTTF_DIR $SERVER_SYSTEMROOT/fonts/
+//
+//------------------------------------------------------------------------
+// DEFINE("CACHE_DIR","/tmp/jpgraph_cache/");
+// DEFINE("TTF_DIR","/usr/X11R6/lib/X11/fonts/truetype/");
+// DEFINE("TTF_DIR","/usr/share/fonts/corefonts/");
+DEFINE("TTF_DIR","/usr/share/fonts/truetype/msttcorefonts/");
+// DEFINE("MBTTF_DIR","/usr/share/fonts/ja/TrueType/");
+
+//-------------------------------------------------------------------------
+// Cache directory specification for use with CSIM graphs that are
+// using the cache.
+// The directory must be the filesysystem name as seen by PHP
+// and the 'http' version must be the same directory but as 
+// seen by the HTTP server relative to the 'htdocs' ddirectory. 
+// If a relative path is specified it is taken to be relative from where
+// the image script is executed.
+// Note: The default setting is to create a subdirectory in the 
+// directory from where the image script is executed and store all files
+// there. As ususal this directory must be writeable by the PHP process.
+DEFINE("CSIMCACHE_DIR","csimcache/"); 
+DEFINE("CSIMCACHE_HTTP_DIR","csimcache/");
+
+//------------------------------------------------------------------------
+// Defines for font setup
+//------------------------------------------------------------------------
+
+// Actual name of the TTF file used together with FF_CHINESE aka FF_BIG5
+// This is the TTF file being used when the font family is specified as
+// either FF_CHINESE or FF_BIG5
+DEFINE('CHINESE_TTF_FONT','bkai00mp.ttf');
+
+// Special unicode cyrillic language support
+DEFINE("LANGUAGE_CYRILLIC",false);
+
+// If you are setting this config to true the conversion
+// will assume that the input text is windows 1251, if
+// false it will assume koi8-r
+DEFINE("CYRILLIC_FROM_WINDOWS",false);
+
+// Japanese TrueType font used with FF_MINCHO, FF_PMINCHO, FF_GOTHIC, FF_PGOTHIC
+DEFINE('MINCHO_TTF_FONT','ipam.ttf');
+DEFINE('PMINCHO_TTF_FONT','ipamp.ttf');
+DEFINE('GOTHIC_TTF_FONT','ipag.ttf');
+DEFINE('PGOTHIC_TTF_FONT','ipagp.ttf');
+
+//------------------------------------------------------------------------
+// Various JpGraph Settings. Adjust accordingly to your
+// preferences. Note that cache functionality is turned off by
+// default (Enable by setting USE_CACHE to true)
+//------------------------------------------------------------------------
+
+// Deafult graphic format set to "auto" which will automatically
+// choose the best available format in the order png,gif,jpeg
+// (The supported format depends on what your PHP installation supports)
+DEFINE("DEFAULT_GFORMAT","auto");
+
+// Should the image be a truecolor image? 
+// Note 1: Has only effect with GD 2.0.1 and above.
+// Note 2: GD 2.0.1 + PHP 4.0.6 on Win32 crashes when trying to use 
+// trucolor.
+// Note 3: MUST be enabled to get background images working with GD2
+DEFINE('USE_TRUECOLOR',true);
+
+// Specify what version of the GD library is installed.
+// If this is set to 'auto' the version will be automatically 
+// determined.
+// However since determining the library takes ~1ms you can also 
+// manually specify the version if you know what version you have. 
+// This means that you should 
+// set this define to true if you have GD 2.x installed to save 1ms. 
+DEFINE("USE_LIBRARY_GD2",'auto');
+
+// Should the cache be used at all? By setting this to false no
+// files will be generated in the cache directory.  
+// The difference from READ_CACHE being that setting READ_CACHE to
+// false will still create the image in the cache directory
+// just not use it. By setting USE_CACHE=false no files will even
+// be generated in the cache directory.
+DEFINE("USE_CACHE",false);
+
+// Should we try to find an image in the cache before generating it? 
+// Set this define to false to bypass the reading of the cache and always
+// regenerate the image. Note that even if reading the cache is 
+// disabled the cached will still be updated with the newly generated
+// image. Set also "USE_CACHE" below.
+DEFINE("READ_CACHE",true);
+
+// Determine if the error handler should be image based or purely
+// text based. Image based makes it easier since the script will
+// always return an image even in case of errors.
+DEFINE("USE_IMAGE_ERROR_HANDLER",true);
+
+// Determine if the library should also setup the default PHP
+// error handler to generate a graphic error mesage. This is useful
+// during development to be able to see the error message as an image
+// instead as a "red-cross" in a page where an image is expected.
+DEFINE("INSTALL_PHP_ERR_HANDLER",false);
+
+// Should the library examin the global php_errmsg string and convert
+// any error in it to a graphical representation. This is handy for the
+// occasions when, for example, header files cannot be found and this results
+// in the graph not being created and just a "red-cross" image would be seen.
+// This should be turned off for a production site.
+DEFINE("CATCH_PHPERRMSG",true);
+
+// If the color palette is full should JpGraph try to allocate
+// the closest match? If you plan on using background images or
+// gradient fills it might be a good idea to enable this.
+// If not you will otherwise get an error saying that the color palette is 
+// exhausted. The drawback of using approximations is that the colors 
+// might not be exactly what you specified. 
+// Note1: This does only apply to paletted images, not truecolor 
+// images since they don't have the limitations of maximum number
+// of colors.
+DEFINE("USE_APPROX_COLORS",true);
+
+// Should usage of deprecated functions and parameters give a fatal error?
+// (Useful to check if code is future proof.)
+DEFINE("ERR_DEPRECATED",true);
+
+// Should the time taken to generate each picture be branded to the lower
+// left in corner in each generated image? Useful for performace measurements
+// generating graphs
+DEFINE("BRAND_TIMING",false);
+
+// What format should be used for the timing string?
+DEFINE("BRAND_TIME_FORMAT","(%01.3fs)");
+
+//------------------------------------------------------------------------
+// The following constants should rarely have to be changed !
+//------------------------------------------------------------------------
+
+// What group should the cached file belong to
+// (Set to "" will give the default group for the "PHP-user")
+// Please note that the Apache user must be a member of the
+// specified group since otherwise it is impossible for Apache
+// to set the specified group.
+DEFINE("CACHE_FILE_GROUP","wwwadmin");
+
+// What permissions should the cached file have
+// (Set to "" will give the default persmissions for the "PHP-user")
+DEFINE("CACHE_FILE_MOD",0664);
+
+// Decide if we should use the bresenham circle algorithm or the
+// built in Arc(). Bresenham gives better visual apperance of circles 
+// but is more CPU intensive and slower then the built in Arc() function
+// in GD. Turned off by default for speed
+DEFINE("USE_BRESENHAM",false);
+
+// Special file name to indicate that we only want to calc
+// the image map in the call to Graph::Stroke() used
+// internally from the GetHTMLCSIM() method.
+DEFINE("_CSIM_SPECIALFILE","_csim_special_");
+
+// HTTP GET argument that is used with image map
+// to indicate to the script to just generate the image
+// and not the full CSIM HTML page.
+DEFINE("_CSIM_DISPLAY","_jpg_csimd");
+
+// Special filename for Graph::Stroke(). If this filename is given
+// then the image will NOT be streamed to browser of file. Instead the
+// Stroke call will return the handler for the created GD image.
+DEFINE("_IMG_HANDLER","__handle");
+
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_antispam-digits.php php-syslog-ng/html/includes/jpgraph/jpgraph_antispam-digits.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_antispam-digits.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_antispam-digits.php	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,205 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_ANTISPAM.PHP
+// Description:	Genarate anti-spam challenge
+// Created: 	2004-10-07
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_antispam-digits.php 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class HandDigits {
+    var $digits_thumb30x30 = array();
+    var $iHeight=30, $iWidth=30;
+    function HandDigits() {
+//==========================================================
+// d6-small.jpg
+//==========================================================
+	$this->digits['6'][0]= 645 ;
+	$this->digits['6'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAEBAAMBAAAAAAAAAAAAAAAABgMEBwX/xAAvEAABAwMC'.
+	    'BAQEBwAAAAAAAAABAgMEAAURBiESIjFRBxMUQRUWMmFTYnGRkrHC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFhEBAQEAAAAA'.
+	    'AAAAAAAAAAAAAAER/9oADAMBAAIRAxEAPwDslwiR3oDku8ONttsAvDiVyMcO/ET7ke5/aoOz6k1Vr5htNjW7a7M1yO3NTQU9JUDu'.
+	    'GgrlSn8xyf6p4gXaHJvNps9/mKZtSkGdMjRwpfqAFBLLACRlZUrJONsI2717No1lbZ10kx7XGnRpKWQ/6GVGMfzEJ5VFIVtsOH6e'.
+	    'wyKVhYsia0y22pLThSkJK1uniVgdThOM0ol+StIUhpopIyCFq3H8aUVCwnG3PGe4Rp6fLXJtMdyM0ojcIWvIz3HFnAPfrWTXb6GN'.
+	    'WaLXDwZjVz8pKEfhuIUFg/bAz9sVJ61nt61mxJFslLtq7e5yPqiBT4UDklKw4MDpt+u+9bFiu9riXNu83R+fcr6tohuQ5HQhmK37'.
+	    'paaC8DruScmg6X8KkjZEhbaB9KEyFYSOw26Uqd+e7Qerl5z74DY/1SomP//Z' ; 
+
+//==========================================================
+// d2-small.jpg
+//==========================================================
+	$this->digits['2'][0]= 606 ;
+	$this->digits['2'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEQMBIgACEQEDEQH/xAAYAAEBAQEBAAAAAAAAAAAAAAAFAAQHAv/EACsQAAEDBAEC'.
+	    'BAYDAAAAAAAAAAIBAwQABQYRIRIxQVFhcQcTFSJSU5GU0f/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAZEQACAwEAAAAAAAAA'.
+	    'AAAAAAAAARESUUH/2gAMAwEAAhEDEQA/AOqXm/Q8dxmOL4PPSnCSNFixx6nXnkXgRT3Te17JWbGsveueSyLZdbPItNxOKLzTLjou'.
+	    'gYCSoSoY8ISKSbFeUrzkdlnTL1YshskiErkQnFEZaF8kkdBBVdjyi6RNL5+9F486eS/ECVkcBtDt1vZcho5viS8ZCp9C9tAIAm/F'.
+	    'VoPRU+HRtJ5JVRP1kP0PfwP+1VKrHBMliXG4Nw8VgE4xGkuqk2S1wTUNEVdIvgpL9iL6KtNxY7WOwo9tt0RCitj0sR2uCbFPPzH1'.
+	    '7+6rRuSRcljMBMsUy2tky045KOawZk5xtEFBJEROO3hx61kh2rPCIX3MhsyC4QmfTbC6lH8dq5212qwkiG5H6Y/9R2qm+ofxqqsL'.
+	    'DLZ6f//Z' ; 
+
+//==========================================================
+// d9-small.jpg
+//==========================================================
+	$this->digits['9'][0]= 680 ;
+	$this->digits['9'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABAUGBwP/xAArEAABAwMD'.
+	    'AgYBBQAAAAAAAAABAgMEBQYRABIhE1EUIjEzQUIHMlJhcdH/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/xAAYEQEAAwEAAAAAAAAA'.
+	    'AAAAAAAAAREhQf/aAAwDAQACEQMRAD8AkK7brF6X7XpMeGoKhFMLEeT4ZUheEhanF4OcZ2pTgDykk92bZpdCsi7aezLjxkIPUZiV'.
+	    'RSCy8hah7EkZ27yM7V+iscal5bE22Lon1qNDmSKROd8Sl+Ix1lMOlIS4HGgQpbStoUCnlJz8HmsXtW3Lst2rmBAelLMRRekOwnYz'.
+	    'Edls9QKKnOVLyk7UgcbzzrdBthqEJJwZbAI4x1U/7o1TaFa9lG36aXaZTy54VrcXUgrzsGdx+T30aNydweqVw1GS87T6Lb86Q4ha'.
+	    'my/IAYjZBx+snKk99oOQMf1AViE65SY348hzFy6hPKnqtKz7DC1lbqyPrvJKUJ7H+M6Wrt3InP7o1brFNp4bCDGhxGAsqz69VSiQ'.
+	    'ORwBxrrQ7itm1ac7Hp0WoGTIc3PSn0pccdcP2WorycfA1RaRHjxosZqOyhtDTSAhCf2gDAGjVHTd9sKSCumynFEZK1tIJUe58/ro'.
+	    '1V1//9k=' ; 
+
+//==========================================================
+// d5-small.jpg
+//==========================================================
+	$this->digits['5'][0]= 632 ;
+	$this->digits['5'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABgIFBwT/xAAoEAABAwME'.
+	    'AQQCAwAAAAAAAAABAgMEBQYRABIhIkEUMVFhBxNCgaH/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/EABcRAQEBAQAAAAAAAAAAAAAA'.
+	    'AAABEUH/2gAMAwEAAhEDEQA/ANGvW4YVOeiRX5b4mv5Sin05IdlupPKdo/j2SO3+6TbPNQvOsTVz33KRT4csR3YUF7Dsh5OSFvug'.
+	    'kqG4FPBxnjxpvvi4KZb1pTpU+QwxUi2Y7ZIAefUk5ATxnB9/gbtL/wCH1UpuhPUlZlMVaQ0mS8zJjqZOPfc2TwpIUonI9tw40R1r'.
+	    'WNGq/wBdJR1XT3lqHBUnGCfkfWjRWs1ve249erQqQYjOtN1FqPUpCXQ4WIzQSsJwT0UpRwQPG0nzqyuNHobjsl9kBuWqoOoXtT1/'.
+	    'WppZcA8lKRj64HxqU+3KpAr6plElRVKef3S4E0K9O8pLXVzKcqSsJAB9wSAca6bSoNXeuA1+5pEV+SGFNU1iKVFqI0Vdx2AJUeoz'.
+	    '8DGlTDwG3CAf3q/pI0ah6MDhLz6U+EpXwPoaNMU//9k=' ; 
+
+//==========================================================
+// d1-small.jpg
+//==========================================================
+	$this->digits['1'][0]= 646 ;
+	$this->digits['1'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEwMBIgACEQEDEQH/xAAZAAADAAMAAAAAAAAAAAAAAAAABQYCBAf/xAApEAACAQMD'.
+	    'AwQBBQAAAAAAAAABAgMEBREABiESMUEHEyJRkSNCYXGB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFxEBAQEBAAAAAAAAAAAA'.
+	    'AAAAAAEREv/aAAwDAQACEQMRAD8A6jdd4WLbstILnc4Uq0VoWpkJknb6IjXLHJUePOlez923fcW4r1SxWlqC2UbdKirQif3Xw3yA'.
+	    'OFAGT09/kO3OmV3a20MFRf6lIYPcpy7yRRAzgxjIy2M8YwcdiBzpX6d22VNvUlTXsFkuwkrKqNSfnK7F8OTzwrAY+l5zoxKskudN'.
+	    'EgQPUT9PBkWF3DH+1GPxo1mLnRoAqF2VRgGOFmX/AAgY/GjRUP6hVMFv2FuFqUvUGrpDFJMBnpdyF5bsAQew7Hxzp6LZNT0yQ1DI'.
+	    'wp0QCFBhD0jCsfLZHxbx5xxpTuvb1+v9PV7Ztk9roLPLCjmSSN3mX5ZwqjCgZX7PfWxDQb2in96pv9qq46aTE0bW4x9ceAWAYPwS'.
+	    'PsYzoixgmheBGjIVcYCnjp/jHjHbRpe1JLn9OnopE/a0ykvjwDx47aNMXqP/2Q==' ; 
+
+//==========================================================
+// d8-small.jpg
+//==========================================================
+	$this->digits['8'][0]= 694 ;
+	$this->digits['8'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AFQMBIgACEQEDEQH/xAAYAAADAQEAAAAAAAAAAAAAAAAABgcEBf/EACsQAAEDAwMD'.
+	    'AwMFAAAAAAAAAAECAwQFBhEAEiEUMVEHE0EVYYEiIzJCsf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/EABcRAQEBAQAAAAAAAAAA'.
+	    'AAAAAAABERL/2gAMAwEAAhEDEQA/AKL6gVVUa0i1T5QjvTprUJMlxW4R9zgQXe/AH+kaWrntqlWjaq7gpcmotXAw82ht9yY4tch8'.
+	    'uAFC0k7VBXPGMY51ruiaue+bThIj+7NbWqS+7HDxajFf6AlB/k44o8ZOABk4xkL0X0tZiojKrlRuGRJjugqldSlKGf6t7BuUQe3J'.
+	    '44xxxrA1a4KVJipLidri8uLHgqOcfjOPxo0o2hdDvS1CmV2Yl6fS5ioipIQR1CAlKkLKR2UUqAI8g6NRSwuuyHab6s1ufLI/Zai7'.
+	    'UBJOxhTS0+6B32pWSFH4CidOdWU0ukLiN1BLr0zG5Sdm3GRvcPhIT858DvjXNrVsSLnm/VIdTXS6tTnFsxZTSN3jchaTwps+O/z9'.
+	    'tcBVq3hIX0tYqlIiQHdy5CqRHKHXEjAOMgBKjnvyRk4xrQa7OiGt1K5biYZL8SoVEpjOqkFsONtJCNwASeCQrn7aNUKnQYtLp7EC'.
+	    'EylmLHQltptPZKQOBo1FzH//2Q==' ; 
+
+//==========================================================
+// d4-small.jpg
+//==========================================================
+	$this->digits['4'][0]= 643 ;
+	$this->digits['4'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAYAAADAQEAAAAAAAAAAAAAAAAABAYHAv/EAC0QAAIBAwQA'.
+	    'BAMJAAAAAAAAAAECAwQFEQAGEiETFDFBUmGBByIjUVNxobHR/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAIB/8QAGBEBAAMBAAAAAAAA'.
+	    'AAAAAAAAAAERIVH/2gAMAwEAAhEDEQA/ANjM00Nxmt1xiWW31CZp5uJwoAAaOQ/n7qfcZHqO5my3q5XX7R6ijiqnNut9u4NyJ4yv'.
+	    'JJyjYr8Xhrn5g599J7x3ulBNU7Zo7dXXXcLQ8kURYi4epYtkALjOePv1nUvbLvV7P3BZm3DR3eh88Kp7pVzBZI6iUhGWRRGWwE44'.
+	    'HX3V+uiL1uHgt+vL/H+aNJQ3CSeCOaFqSaJ1DJKs/TqRkMOvQjvRorHE4pRDLNWLGlRHGUeYIORXs9e5B7OP31E0fmdyb/t0DJ4Q'.
+	    '27bfx3YZzPUIoAAz7IpOD6cuxq0uNumqLfVNDOqXBoZEjnZcqhIPXH4c46+WkdoWOltu3IDDLLLVVR83UVcuPEmmcZZ2/rHoAANG'.
+	    'GI7KIY1ijoLeEQBVCwIoAHpgY6Hy0aZe7mJ2jeHLKcEhusj6aNKgzr//2Q==' ; 
+
+//==========================================================
+// d7-small.jpg
+//==========================================================
+	$this->digits['7'][0]= 658 ;
+	$this->digits['7'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABgEFBwT/xAAuEAABAwIE'.
+	    'BAQGAwAAAAAAAAABAgMEBREABiExEhMiQSMyUXEHFBclVJFhk9L/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/8QAGREBAQEAAwAA'.
+	    'AAAAAAAAAAAAAAEREiFR/9oADAMBAAIRAxEAPwDXq9mCjZeQ05VZ5ZST4bfEpa3VdglCbqUe+g9MZ5Uq7V8415WXoMSdQ6etgSps'.
+	    '19wpkCMDZKUpv0FZvbi1NzpYasMDLDUbMVXrtQdbeeU23xLWkj5RlLYK0J7anW9gbAjCzkOtsVSUJUdtc6dVZK51UeaFm4LKbhpC'.
+	    'l7EhIFkDW974GbRI2XorUVls1OTdKAOqUpR0Hc3198GITQ6k+hLwrEpoODiDenRfW23bBicg78JXxPpD0mgVOW5PAivNNpahsPW5'.
+	    '8xxQaSVkboQnhsnYm5OHqDGp1IpsalMKjMsMIC3+XZKbJFth62/QOEfMOZqZXp9JcKZTcGmTky3meSi7xQklI81vMR+sXIz/AEgp'.
+	    'Q0qPNu6ea8Q2jqtbp8+2w9h/OKORc/cpHjt1dDSHOtLZ4ekHW23bBjj+o9H/AB539aP94MG0+L//2Q==' ; 
+
+//==========================================================
+// d3-small.jpg
+//==========================================================
+	$this->digits['3'][0]= 662 ;
+	$this->digits['3'][1]= 
+	    '/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+	    'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+	    'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABAUGBwL/xAArEAABBAED'.
+	    'AwMDBQEAAAAAAAABAgMEBREABhIhMUEiMmETFZEHFkJDUdH/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/xAAYEQEBAQEBAAAAAAAA'.
+	    'AAAAAAAAEQExQf/aAAwDAQACEQMRAD8A0vclruBdk3VVLLUNssGRJsZSCtqOjlgJAHvcOD6c4HnOdIbcttw1W5P29cFEhuawqTXS'.
+	    'VsJjnCMBxKkJJx7goAde+ceJfdNxU0UNlyymyXHi6kxWUNl1S3EnkAEIHX2nv86qtTuZr9Q9+1VhRsOoYpYcgSVyAE/TdewkJxnK'.
+	    'sBCjkdPGpnOtFMd3PqsXgfOAgD8Y0aX+11H9rDDjn8lr9yj5J+dGqsqxaw6Cc9cQZU4Sp7zTJsIrKlcUEKwhSin1JABI45GUjqOu'.
+	    'lbOvjbc3Ts9ynjGCy445UuFLYRzbWgrT6fhSCQSMDke+pew2zYVly/d7YchNqkMJZnQpgV9J8IzwWFJyUrAJHYgjvpLbu37G5nR7'.
+	    'vck5C3YRKYEOEVJZj8kjKypXqWvirjk9h+dB9i4faa89TDZUfKlIyT8k+To10a6KTkpcJ/0vL/7o0TS//9k=' ; 
+    } 
+}
+
+class AntiSpam {
+
+    var $iNumber='';
+
+    function AntiSpam($aNumber='') {
+	$this->iNumber = $aNumber;
+    }
+
+    function Rand($aLen) {
+	$d='';
+	for($i=0; $i < $aLen; ++$i) {
+	    $d .= rand(1,9);
+	}
+	$this->iNumber = $d;
+	return $d;
+    }
+
+    function Stroke() {
+
+	$n=strlen($this->iNumber);
+	for($i=0; $i < $n; ++$i ) {
+	    if( !is_numeric($this->iNumber[$i]) || $this->iNumber[$i]==0 ) {
+		return false;
+	    }
+	}
+
+	$dd = new HandDigits();
+	$n = strlen($this->iNumber);
+	$img = @imagecreatetruecolor($n*$dd->iWidth, $dd->iHeight);
+	if( $img < 1 ) {
+	    return false;
+	}
+	$start=0;
+	for($i=0; $i < $n; ++$i ) {
+	    $size = $dd->digits[$this->iNumber[$i]][0];
+	    $dimg = imagecreatefromstring(base64_decode($dd->digits[$this->iNumber[$i]][1]));
+	    imagecopy($img,$dimg,$start,0,0,0,imagesx($dimg), $dd->iHeight);
+	    $start += imagesx($dimg);
+	}
+	$resimg = @imagecreatetruecolor($start+4, $dd->iHeight+4);
+	if( $resimg < 1 ) {
+	    return false;
+	}
+	imagecopy($resimg,$img,2,2,0,0,$start, $dd->iHeight);
+	header("Content-type: image/jpeg");
+	imagejpeg($resimg);
+	return true;
+    }
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_antispam.php php-syslog-ng/html/includes/jpgraph/jpgraph_antispam.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_antispam.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_antispam.php	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,625 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_ANTISPAM.PHP
+// Description:	Genarate anti-spam challenge
+// Created: 	2004-10-07
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_antispam.php 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+class HandDigits {
+    var $chars = array();
+    var $iHeight=30, $iWidth=30;
+    function HandDigits() {
+
+//==========================================================
+// lj-small.jpg
+//==========================================================
+$this->chars['j'][0]= 658 ;
+$this->chars['j'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABUDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAUGBAf/xAAsEAACAQMDAwMBCQAAAAAAAAAB'.
+'AgMEBREAEjEGIUEUUXGBBxMVIiNSYWKC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwEC/8QAGhEAAwADAQAAAAAAAAAAAAAAAAECERIh'.
+'Mv/aAAwDAQACEQMRAD8A6veK2st8zRWSyV1dUBfvHaGVI4hknsS7AFv4AyM57ayWbqeS+11xtT2etttwo4YqhEqnQs5bcAfyk4AZ'.
+'SOeD441TKRTyingUBG4/ah8j684+dSFzh/BvtaslejMUu9DPQTDnLx4lQ/ONw1TGBm0jdRWqguEMghEisWilgDmNs4Ze+MEEEH40'.
+'aUVFTa7JeLjRXu4GjhmnNbSfqFQVlA3rkckOjH/Q99Glmkl0C/Q06pvsvT9vttXHDF6T1KrWbs5gRgQJM+FDlQxPhjpF1XcVq+qe'.
+'jEoKiOecXBqh2TDDYIXLKuP6549xk8auI6aJqV45oknWdNswkAIkGMYIxjGO2NR1F0LZY5qkWqkS1xrM0M8lMSJpY+TGrnJiQ577'.
+'cEgeNHhi7D3qC3UN69M8tIakRhgrh9o748+eNGtcCiKjjpkQKlMTEg3ZwoxtHHtgfTRpYXArvp//2Q==' ; 
+
+//==========================================================
+// lf-small.jpg
+//==========================================================
+$this->chars['f'][0]= 633 ;
+$this->chars['f'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQFBgcC/8QAKxAAAgEDAwMCBQUAAAAAAAAA'.
+'AQIDBBEhAAUGEjFBEyIHFFFhoRUzYnGS/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQP/xAAaEQACAwEBAAAAAAAAAAAAAAAAAQIRMRIh'.
+'/9oADAMBAAIRAxEAPwDcnmLoIkiSYsouC3tA++O2lU9WkqVjJ+YdhZLsQI/4/YfQm50kZP0vbmaCSU0SRNIH6sghb9INs3t38dvp'.
+'akUuz8x5DwdN5peS1jV1dSipSiVUigIcdQjQ26lIB/c6r3F86SZpE/zCFJaqsihQNhRgdj3Jyfxo0jDSbXHt9Oph9RAoV3qJGltY'.
+'HDOxyb/nRpV0D3RXle21m48XraOk3IUSemUaV4g4Zc9ShcDtgff+tQfwvjq34Dtku7buamFqeJKemCCMxKFsEJU+/FrX8d76sEHG'.
+'aNItzr4usVNdG3S0rmRYAVwEUmyjyQLZ11x7aF4zs9DQOyzml29I2cLa/pixIHi99DFCtU9dFuLIaijo9qiYPmR2mZmB9thgAHOD'.
+'4+mjUrURyrUNMZFEkkIOFuFAbsP9d/OjVIQ6Vh4tP//Z' ; 
+
+//==========================================================
+// lb-small.jpg
+//==========================================================
+$this->chars['b'][0]= 645 ;
+$this->chars['b'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABUDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYCAwUH/8QAKxAAAQMDAwMDAwUAAAAAAAAA'.
+'AQIDBAAFEQYSIRMxUSJBYQcVI2JxgqHw/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAYEQEBAQEBAAAAAAAAAAAAAAAAATERYf/a'.
+'AAwDAQACEQMRAD8A6H95mxNYwLXcX+pCuilSLXJ6YSplaUELjqxwe4IJ5PIPamJ2V0bPcS7+NxCX1cHggAnIP+xSd9RyzHh2m7FQ'.
+'Q1CvMNQWTjCt+HFD+PB/Y1fI1PL1HFFt0zaGblFdJQ9cJjpZiqPJUlBAKnPcEpGB5NNRKdrOl1NlgiQol4R2w4Sc5VtGf7opZteo'.
+'LhdorjUSM5FnQnlR50NeHQysYxtVxlJHIPgjtRRD3xkaghs6juumdHz4+Y7RVPnt59K2mk7W+fcKWsZ7djTXMkW+xMP3GRJjwIEN'.
+'HTG/CWx5wPY8AADx2NYk3SL9wukvUjGobnBkORksIbjdMANozgEqSo8qJPGO/wAVO36IsjUmBIfZfuM7epZk3F9UhSSk5O0K9Kcq'.
+'8AcU3UzFuhUSBFud6nRXoz96mqmJZWg7m2dqUNhWBwdqQSP1UU5c/FFCn//Z' ; 
+
+//==========================================================
+// d6-small.jpg
+//==========================================================
+$this->chars['6'][0]= 645 ;
+$this->chars['6'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAEBAAMBAAAAAAAAAAAAAAAABgMEBwX/xAAvEAABAwMC'.
+'BAQEBwAAAAAAAAABAgMEAAURBiESIjFRBxMUQRUWMmFTYnGRkrHC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFhEBAQEAAAAA'.
+'AAAAAAAAAAAAAAER/9oADAMBAAIRAxEAPwDslwiR3oDku8ONttsAvDiVyMcO/ET7ke5/aoOz6k1Vr5htNjW7a7M1yO3NTQU9JUDu'.
+'GgrlSn8xyf6p4gXaHJvNps9/mKZtSkGdMjRwpfqAFBLLACRlZUrJONsI2717No1lbZ10kx7XGnRpKWQ/6GVGMfzEJ5VFIVtsOH6e'.
+'wyKVhYsia0y22pLThSkJK1uniVgdThOM0ol+StIUhpopIyCFq3H8aUVCwnG3PGe4Rp6fLXJtMdyM0ojcIWvIz3HFnAPfrWTXb6GN'.
+'WaLXDwZjVz8pKEfhuIUFg/bAz9sVJ61nt61mxJFslLtq7e5yPqiBT4UDklKw4MDpt+u+9bFiu9riXNu83R+fcr6tohuQ5HQhmK37'.
+'paaC8DruScmg6X8KkjZEhbaB9KEyFYSOw26Uqd+e7Qerl5z74DY/1SomP//Z' ; 
+
+//==========================================================
+// lx-small.jpg
+//==========================================================
+$this->chars['x'][0]= 650 ;
+$this->chars['x'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABMDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAUHBgj/xAApEAABAwMDAwQCAwAAAAAAAAAB'.
+'AgMEBQYRACFBBxIxFCJRgRNxkcHw/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQH/2gAMAwEA'.
+'AhEDEQA/AH9t3pKvO14UykVARa/HfAlxlDKXR24V2p3z7RlPwdtMep91uWdRGHWELjuTFFtLvcC4SNznnH+21O7ttiodOq1BvC0E'.
+'p9I0lSX2kgqCSklK+5PKCMAng6zV2XRO6u3lSIURtbDRShltlZHa0tW7q/0MeTwnjxq1Jiw2xc9xTLbhSVU5iaXUFfqFFILgJOCd'.
+'9Gt3SXabR6REpkL8yo0RpLCFNx1qBCRjOQMHxo0pEr6o3um2LVYpMEpTVqg25lHn08dfcB9kEgfZ1LIFDuawqZRb7aQlLTzqglsg'.
+'9wQdveOEqBIB425xqhQuk8qo9UKlPrlRblw2ZBeCSVKW6CcoSrI2AGOT41SKzT4dYtmdS5bIXDZhNoWgbZJ94x8AYT/GkM03oNUc'.
+'uKgwqtTZDTMOU0FttqRkoHggnPkEEHRrkJ6t1SlSHYUOc6zHaWrsbQrATk5/vRqK/9k=' ; 
+
+//==========================================================
+// d2-small.jpg
+//==========================================================
+$this->chars['2'][0]= 606 ;
+$this->chars['2'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEQMBIgACEQEDEQH/xAAYAAEBAQEBAAAAAAAAAAAAAAAFAAQHAv/EACsQAAEDBAEC'.
+'BAYDAAAAAAAAAAIBAwQABQYRIRIxQVFhcQcTFSJSU5GU0f/EABcBAAMBAAAAAAAAAAAAAAAAAAECAwT/xAAZEQACAwEAAAAAAAAA'.
+'AAAAAAAAARESUUH/2gAMAwEAAhEDEQA/AOqXm/Q8dxmOL4PPSnCSNFixx6nXnkXgRT3Te17JWbGsveueSyLZdbPItNxOKLzTLjou'.
+'gYCSoSoY8ISKSbFeUrzkdlnTL1YshskiErkQnFEZaF8kkdBBVdjyi6RNL5+9F486eS/ECVkcBtDt1vZcho5viS8ZCp9C9tAIAm/F'.
+'VoPRU+HRtJ5JVRP1kP0PfwP+1VKrHBMliXG4Nw8VgE4xGkuqk2S1wTUNEVdIvgpL9iL6KtNxY7WOwo9tt0RCitj0sR2uCbFPPzH1'.
+'7+6rRuSRcljMBMsUy2tky045KOawZk5xtEFBJEROO3hx61kh2rPCIX3MhsyC4QmfTbC6lH8dq5212qwkiG5H6Y/9R2qm+ofxqqsL'.
+'DLZ6f//Z' ; 
+
+//==========================================================
+// lm-small.jpg
+//==========================================================
+$this->chars['m'][0]= 649 ;
+$this->chars['m'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAcDBAUCBv/EAC0QAAICAQMCBAMJAAAAAAAA'.
+'AAECAwQRAAUSBiETMVFhB2KhFSIyQVJxgZHB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgED/8QAGREBAQEAAwAAAAAAAAAAAAAAAQAR'.
+'EiEx/9oADAMBAAIRAxEAPwB0MI2lIdgI0Cly3kFXLEn2zx1FDdp7rbpbjUtRWKio3hyxOGQllJzkegX66rQ2qW87Zuk9S5FNVmru'.
+'iywyBhjDKTkeXfSr+GRfYtq2KAO32b1BGxAZu0dyJ2DKPTxY1wPddVszycUq2Golq8jRWbcnJWwCVGMjz+VQP50atxMtm2ZUOY4l'.
+'4qfUnBP0x/Z0amy4jJm10Tt2yddWasFmfaRfdrlG3UcgArnxKzJ+Fu4DqCMkcgNem2DoWav8PLfTm+FPEkuSNTnqueS5bnHIv6CG'.
+'LNjJwM99bm67NB1Ht89KSxNXnr2hNDbiUc47K4KyD2GQMfmMjUnS+7vuIktTqPCaaWCqAMMojPFyw8hyYMQBnAwNJHYGXPTsW9VN'.
+'jg2zf50W9zk524GAEihuz+xbIOD82jW5TkjtRPZkTkJ+4VgDhQfuj/f3OjUxl1f/2Q==' ; 
+
+//==========================================================
+// lt-small.jpg
+//==========================================================
+$this->chars['t'][0]= 648 ;
+$this->chars['t'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQDBQYH/8QAJxAAAQMDAgYDAQEAAAAAAAAA'.
+'AQIDBAUGEQASEyExQVFhIjJxFSP/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAP/xAAZEQADAQEBAAAAAAAAAAAAAAAAAREhMUH/2gAM'.
+'AwEAAhEDEQA/AO4BLEiEy7uG4IGxxs5IOOx76wd2XYidSp1HoD70240gcNNPbDyI6wQQpaz8E9MczkdhqtbsKYLieDk6WLKmZmmL'.
+'Hk7AHVkbkLI+RQc7uRxgkfr1tx2rGu6VbToLVKkhU+kbugGf9WfaknCk5ycaX0zmaa+3JkqvW/CmzojsB9xoF6OoFK0r6HOcEDI0'.
+'aefTuKX5ScMdC14HYq8n12zo1DEUcKTGg1Z+hyBwoPBVIiA/VQyOIgedhUCB4WMfXSV3UufVLcTUIqVf26K6mXDbPVRRzKT54iMg'.
+'+zjtq6mtsyJjclxpKlUhSXEbkgkqWnBx4+J5e/zU0pZemPvJJQzEPDfQOrwwFY9AZ5eeYPLV6FwhoFYZuigxpkJeIjqAeIoAk9wA'.
+'D46EnuD+6Nc1smDNrTlRkxqtMo1vzKhIdYgU9YDqVpISrLhHxSSd21I0aYyqP//Z' ; 
+
+//==========================================================
+// li-small.jpg
+//==========================================================
+$this->chars['i'][0]= 639 ;
+$this->chars['i'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABYDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABwAGBP/EACcQAAEEAQMEAgIDAAAAAAAAAAEC'.
+'AwQRBQAGEiExQVEHExSBFWFx/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgMB/8QAGBEBAQEBAQAAAAAAAAAAAAAAAAECMRH/2gAMAwEA'.
+'AhEDEQA/AE7c+5M9BeRG29t1WUfKFFYW+GvrI7WD3B9g140YD5T36rcErDjbUR6dCBdejsKUpxITXI2FUrooCh70yvxzHyIlMvuK'.
+'eVSH7IKEpJoKqu/ahddLryR/aMiO187bsmrWShhp1AZS2XHHrWhNJrzdf7f7GiVcHk3sptmHkJcJ2DIftS2FrKlJPXudWuLGYeQp'.
+'t2fmEIckqIZaaKuSGG0lQ4gduRoFRHQ9AOgs2lOJbk9aSUlpjGvAWeSVH2VKq/2dFPw3IjyJe8s281ct3I9UoHJXGiQkD2STrSZ7'.
+'Yf8AOl7JTdw5eOCz0jw3+LbYCfA9nz71msb8KMxoTGTw+5srjsipAdDqFBQBIuiOl6KrdYyJMyTCshlw2G3Fr/HiNqNNAqJJUoGl'.
+'KND+h47km1bZwsvCbYYjycxIyK1qDv2yEi0hQviK8atKDcy9j//Z' ;
+ 
+
+//==========================================================
+// lp-small.jpg
+//==========================================================
+$this->chars['p'][0]= 700 ;
+$this->chars['p'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGgAAAQUBAAAAAAAAAAAAAAAAAAECBAUGB//EAC8QAAEDAwMCBAMJAAAAAAAA'.
+'AAECAwQFESEABhIiMRMVUWEHFEEWIzIzcYGRocH/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgH/xAAcEQACAgIDAAAAAAAAAAAAAAAA'.
+'AQIxAxESIUH/2gAMAwEAAhEDEQA/AOh703xG21DMeOyqoVNDjSzERiwU6Ep5qtZNycA97HTF13d33KWtmlt9xwkLl1NkXVxIuQgK'.
+'wLj+hqBvel0qmbR8GnR22nJNZiLeeKr8nDIT1OLJucX+uPbWom7iocRpafOac5MX1ALltp/Cbi+cJH++utdh+WVNL3PNdNYpdWgx'.
+'Y0qmLZSrwJJcQoOJ5XKlJFu4HbJOjVbt+V5nu7eopNRivqcdhK+bFnWwA1Y2AOcgjvj9dGlxy0g5y0xd+hNXoG24C4obizq3HZUh'.
+'YHqtRHD06bG/8a0MbbG1mqekxaBSGmgkrcdcitlLfrckZIz7DUatbeFak0tyRLUwzT5vmiGm0cufEkFBJItfkD+59tKmiO12atFa'.
+'eQukO3ejUxgENqTcfnE5WbkHiOnJ76N2IqI1DibabptS+zkZhtp90F2Y0S026EkAFK/qL46cXv65NVZDfxHmVCK4DE2/RX/lRFbA'.
+'C5LwAyq2EtpHZI7mxPYDRqoctdESimz/2Q==' ; 
+
+//==========================================================
+// le-small.jpg
+//==========================================================
+$this->chars['e'][0]= 700 ;
+$this->chars['e'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABgDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYEBQcB/8QAKhAAAQMCBAUEAwEAAAAAAAAA'.
+'AgEDBAURAAYSIQciMTJBE0JRYRQVFoH/xAAXAQEBAQEAAAAAAAAAAAAAAAAAAgED/8QAGREAAwEBAQAAAAAAAAAAAAAAAAERAjFB'.
+'/9oADAMBAAIRAxEAPwDTszvhEYCoS80BTm2bCjQRwdAzVe2yopkpJtpRUVfjEIc4V2oMerByg5Ji30oMyS3GeMunK0upfnu09MdJ'.
+'p2scTmWnnGfx6HThktgLfKj7xEOqyr7QBbL41LhBzpxbcOru0LKDLdSnOHoaltNqSC4qWL0x9xbJYum69caczSaHmGmTmpDUYn4l'.
+'UiqjkynzAVtwV23Ud+X4Ibpa2DCPkjhfUaRO/p8yzpb+YHhUmhbev6ZEll1lvqK3jt2XrbBgp6HVwsK3THpfEubGSoOUyFMpbJmL'.
+'Deh6SgOGKti57EuY6l62JMWdJy7k3hg1LkOozEbVm7suQSkTiKtkEfP1pH664Za/QItccgI4bseTHdNxiXHLQ8yVl7V32XyioqL5'.
+'TGc1ng6eYs0idczXUZscBBABWgEhEtfKNuUezwPnBhEuj8X2M21z9BR6NUX211Kk/UKKAjuhkPhL7XVf8vtgw7UPJlEyrDWFSYLb'.
+'LBNF6qrzG6t0spEu6+fpL7YMXhUndp//2Q==' ; 
+
+//==========================================================
+// la-small.jpg
+//==========================================================
+$this->chars['a'][0]= 730 ;
+$this->chars['a'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABoDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAABgMEBwX/xAAvEAABAwIFAQcCBwAAAAAAAAAB'.
+'AgMEBREAEiExQQYHFBUiUXGBE2EyQkNSgpHh/8QAFwEBAQEBAAAAAAAAAAAAAAAAAAMBAv/EABkRAAMBAQEAAAAAAAAAAAAAAAAB'.
+'IQIRMf/aAAwDAQACEQMRAD8AfdQ1pxjqZMSn0mRUZRYDaklJCE3OawO2ttTxY4hl07qFMVs1Ku02kpPnRGhsAqz8W9T9wDjozq6o'.
+'Q1lDrcZLGVcmUoZg0obpufxK3Ftt9ccqB1GgBcmLSqtVEqOZcr6ARm/kbXHt7DEtc7WTJKTJqEWvRKfLqL9QplSjuPtGVYOJKBrm'.
+'t+U+n94WGStZzNypmRWqckUKTbixy6jAfxPxHtCgKqFNlU5huK6pLMndSlegG4J45N8aKmTMKQRBsCNMzwB+RbHWHGEAZlPZX2hx'.
+'qZIC34ygZoYUbB50JSkFXFhZR9BrpheR4fIbQ6gvurJ7q02bIQTuAOAN8x40HAxRr3TrNRpBmSHVt1KMlTyJTCsqkKAPlSf28W+c'.
+'UGaD1c9HSR1HFUh9tJU45EBcAtcC9+P9wqbg8IAto9o81yputrVGpiUkgHKkqUTZI32+cKm1z1tIUgPBBAKQ4UBQH3uL3xmXSXep'.
+'HVDtXStE5K5jlPU7PF3Q41+okJFkjgC+3OuNSYiSzHaLtRcW4UDMpLYSCbakDW3thhum5p//2Q==' ;
+
+//==========================================================
+// d9-small.jpg
+//==========================================================
+$this->chars['9'][0]= 680 ;
+$this->chars['9'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABAUGBwP/xAArEAABAwMD'.
+'AgYBBQAAAAAAAAABAgMEBQYRABIhE1EUIjEzQUIHMlJhcdH/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQD/xAAYEQEAAwEAAAAAAAAA'.
+'AAAAAAAAAREhQf/aAAwDAQACEQMRAD8AkK7brF6X7XpMeGoKhFMLEeT4ZUheEhanF4OcZ2pTgDykk92bZpdCsi7aezLjxkIPUZiV'.
+'RSCy8hah7EkZ27yM7V+iscal5bE22Lon1qNDmSKROd8Sl+Ix1lMOlIS4HGgQpbStoUCnlJz8HmsXtW3Lst2rmBAelLMRRekOwnYz'.
+'Edls9QKKnOVLyk7UgcbzzrdBthqEJJwZbAI4x1U/7o1TaFa9lG36aXaZTy54VrcXUgrzsGdx+T30aNydweqVw1GS87T6Lb86Q4ha'.
+'my/IAYjZBx+snKk99oOQMf1AViE65SY348hzFy6hPKnqtKz7DC1lbqyPrvJKUJ7H+M6Wrt3InP7o1brFNp4bCDGhxGAsqz69VSiQ'.
+'ORwBxrrQ7itm1ac7Hp0WoGTIc3PSn0pccdcP2WorycfA1RaRHjxosZqOyhtDTSAhCf2gDAGjVHTd9sKSCumynFEZK1tIJUe58/ro'.
+'1V1//9k=' ; 
+
+//==========================================================
+// d5-small.jpg
+//==========================================================
+$this->chars['5'][0]= 632 ;
+$this->chars['5'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABgIFBwT/xAAoEAABAwME'.
+'AQQCAwAAAAAAAAABAgMEBQYRABIhIkEUMVFhBxNCgaH/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAv/EABcRAQEBAQAAAAAAAAAAAAAA'.
+'AAABEUH/2gAMAwEAAhEDEQA/ANGvW4YVOeiRX5b4mv5Sin05IdlupPKdo/j2SO3+6TbPNQvOsTVz33KRT4csR3YUF7Dsh5OSFvug'.
+'kqG4FPBxnjxpvvi4KZb1pTpU+QwxUi2Y7ZIAefUk5ATxnB9/gbtL/wCH1UpuhPUlZlMVaQ0mS8zJjqZOPfc2TwpIUonI9tw40R1r'.
+'WNGq/wBdJR1XT3lqHBUnGCfkfWjRWs1ve249erQqQYjOtN1FqPUpCXQ4WIzQSsJwT0UpRwQPG0nzqyuNHobjsl9kBuWqoOoXtT1/'.
+'WppZcA8lKRj64HxqU+3KpAr6plElRVKef3S4E0K9O8pLXVzKcqSsJAB9wSAca6bSoNXeuA1+5pEV+SGFNU1iKVFqI0Vdx2AJUeoz'.
+'8DGlTDwG3CAf3q/pI0ah6MDhLz6U+EpXwPoaNMU//9k=' ; 
+
+//==========================================================
+// d1-small.jpg
+//==========================================================
+$this->chars['1'][0]= 646 ;
+$this->chars['1'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEwMBIgACEQEDEQH/xAAZAAADAAMAAAAAAAAAAAAAAAAABQYCBAf/xAApEAACAQMD'.
+'AwQBBQAAAAAAAAABAgMEBREABiESMUEHEyJRkSNCYXGB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFxEBAQEBAAAAAAAAAAAA'.
+'AAAAAAEREv/aAAwDAQACEQMRAD8A6jdd4WLbstILnc4Uq0VoWpkJknb6IjXLHJUePOlez923fcW4r1SxWlqC2UbdKirQif3Xw3yA'.
+'OFAGT09/kO3OmV3a20MFRf6lIYPcpy7yRRAzgxjIy2M8YwcdiBzpX6d22VNvUlTXsFkuwkrKqNSfnK7F8OTzwrAY+l5zoxKskudN'.
+'EgQPUT9PBkWF3DH+1GPxo1mLnRoAqF2VRgGOFmX/AAgY/GjRUP6hVMFv2FuFqUvUGrpDFJMBnpdyF5bsAQew7Hxzp6LZNT0yQ1DI'.
+'wp0QCFBhD0jCsfLZHxbx5xxpTuvb1+v9PV7Ztk9roLPLCjmSSN3mX5ZwqjCgZX7PfWxDQb2in96pv9qq46aTE0bW4x9ceAWAYPwS'.
+'PsYzoixgmheBGjIVcYCnjp/jHjHbRpe1JLn9OnopE/a0ykvjwDx47aNMXqP/2Q==' ; 
+
+//==========================================================
+// ll-small.jpg
+//==========================================================
+$this->chars['l'][0]= 626 ;
+$this->chars['l'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYEBQf/xAArEAACAQIFAwIGAwAAAAAAAAAB'.
+'AgMEEQAFBhIhFEFREzEHFSIyYcFxgZH/xAAXAQEAAwAAAAAAAAAAAAAAAAACAAED/8QAGhEAAwEAAwAAAAAAAAAAAAAAAAECMREh'.
+'Qf/aAAwDAQACEQMRAD8A15Zfm1VURj1Fp5AqLKv3OARcL4W5Nzx+MLWjdRz5hqXU6TSb6OCr6WghiQbrJ91gOTy1yT5xZ55myZFk'.
+'Gb5ozX6Ondm28XYqpQDwu7jEH4c5S2UaDy4xxrLmlUDWzk8XaQ3O49hbj+RiB85HNg8Ee3aqwIqhDuux7G/HHbvzgxEqaWOvy09R'.
+'O0o3hjdQoUji20g+fY3wYSM6pJ4Ylr7V+Zz5PSaezHTlTRNWzxySSxt6q1MSkH6AOT2Fu3Aw7RfF/T9DEkLUeawuF2mKSgdWQj2/'.
+'q3+fnDZDlqRZzQGaOGcpTOaeR1u8R+ncN3gj94so2jNWHeMNNKzorEX2qp9v3imNPoRE1zpjUtZ09HJmYq5lury0benZeTww23t3'.
+'Ivgw+T0yRRyyxIqNfkLcA8jt7YMKcBWn/9k=' ;
+
+
+//==========================================================
+// ls-small.jpg
+//==========================================================
+$this->chars['s'][0]= 701 ;
+$this->chars['s'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABQDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAMCBAUGB//EACwQAAEEAQIFAgUFAAAAAAAA'.
+'AAECAwQFEQAGEhMUITEiYQcjQVFxFRZCUoH/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgH/xAAZEQADAQEBAAAAAAAAAAAAAAAAAQIR'.
+'EiH/2gAMAwEAAhEDEQA/APWZMhmFXSJU+SGmWFiQtAWMJQAnJUr8Z+w/OuQk71uZnMsqnbjy9s8st9UMCQ6kZJdZaIHEkZ/JHceN'.
+'N3HtizuY1JLrG48yLBSC9UTFKQiY4nACir+wAOOMEe2rm2bTbzlqtE1MyBuZAPybpw85KSfDRJ4Cg+Pl/wC61hJeGjV31VuuKqwr'.
+'LGU+whZZK+Rw+oYJAyj3GjS4dZFpZVkqPLktdfMXNcaU2kBC1BIITkdx6c599GlnvPAa3TL2vNvU76n0063acr3YSLCEjpUpUQtW'.
+'Dhf14SMEnOc57aZ8Tegm7dbrEQGZt1PeTDgc1PEW3FeXAvyAkZVkeMDOm2G3f3O7Cl/qEuqkQg4lp6CRxraWfUlRUD24kZA741Ko'.
+'2k1HvlT3ri2sLOCgtsyJz6XEtBwZPAgJAGQMHUNPWKqWItsqh0UCFVyLeKhyLHQ2TMdHNVj+RKlAnJyfto1FW2ahgjrq6LYTFjjf'.
+'lymUOLdWfJyoHA+gA7AAAaNPE3ysJdLT/9k=' ; 
+
+//==========================================================
+// lh-small.jpg
+//==========================================================
+$this->chars['h'][0]= 677 ;
+$this->chars['h'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABUDASIAAhEBAxEB/8QAGgAAAQUBAAAAAAAAAAAAAAAAAAIDBAUGB//EACwQAAIBAwMCBQIHAAAAAAAA'.
+'AAECAwQFEQAGEiExExQiQVEVggcyU2GRocH/xAAXAQADAQAAAAAAAAAAAAAAAAAAAwQB/8QAGhEBAQEAAwEAAAAAAAAAAAAAAQAC'.
+'AyEyMf/aAAwDAQACEQMRAD8A6DZb95q9bmpK6ieOCzNHJTxmE+NMhQ5fr1fLq3Ejvkak2e7ipiFsqb3R0m4qkPPJRiRXenU9VjKE'.
+'5JVcA9R7nWc3/BUbfoKTdO3VRXhpjbZ2D8Rwk6RyZH6chB+46m7i2hDYtgA2ePlV2VkuKysoLzzRnlIScZJZeeevvjtrX7LK2rp7'.
+'tTwwJ9WjhILDrTKnIdMEDl2+P80aVdJZb1QW+vgqENLPH4sBCDLIwUgnOf4GjVvDnLgUk79T81voqjb8NnuUx8pVRCiEaYUSuynl'.
+'jHU9mOfnOoOx6hqz8PrbNdfEkMUXg1LSM3rKOUywJ7YAJ1ZTWmSpvdvlaVTDSUzJAhH5ZJBgv0x2RSAPlz21WXqoet3ba9nuW8n4'.
+'Jr6qTPqnUNxSM/f6mPvxA9zqJnExTbR+h0nkhVu1uE8j0UBRQ9PGxBKFjnkAScdsDp10a0lc7z0tI7Y5YYN+5GAf7GjVXF4Icj3f'.
+'/9k=' ; 
+
+
+//==========================================================
+// ld-small.jpg
+//==========================================================
+$this->chars['d'][0]= 681 ;
+$this->chars['d'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFBgH/xAAsEAABAwMEAAQFBQAAAAAAAAAB'.
+'AgMEBQYRABIhMQcTI0EUMlFhkRgicaGx/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgEA/8QAGBEBAQEBAQAAAAAAAAAAAAAAAAECETH/'.
+'2gAMAwEAAhEDEQA/ALUhp6h3W/X63UlypbhCY0WMjLqGzwDtPCfv/WtealNpVInuVBBqCogcdbU36YUkAkJWVHG8YPXBxxzxqPcN'.
+'YtWyWnIlUeW05VEOAvrCnnSkftK1H5lKJPHsMDoDUWq+KdrSbIqsalVsImiEtLUZ2MU71bcYJWkhZ/36ayLHhi/IXZVOmzKqp5uU'.
+'688hTyjuGVEFJKvoQesD86NL2jGZp1EoLDSmk+ZAQ8d7oPzp3YGesFWMfxo1YGvSzLsT9QExVX8phTlMaFOExAJIBGQjJwCcL+/e'.
+'rd+W7GuO0Kw05CQ6+ww69Gfdb2kFIKk7DgEkjgnr86rXRa9HuyP8LV4SH0sIBbWFFDiFEgDaocgdkjo8ccay0qw7ut5nyrcviQqC'.
+'slsRKo0HwlODkBRzxj2AGoXTtpzIdQ8MbffUChz4NCPRaClAo9Mn6c7T3o13wytmo0K05VIqkiPJbizFiMWs4CTgnIIHOST796NL'.
+'Ia1JX//Z' ;
+
+//==========================================================
+// d8-small.jpg
+//==========================================================
+$this->chars['8'][0]= 694 ;
+$this->chars['8'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AFQMBIgACEQEDEQH/xAAYAAADAQEAAAAAAAAAAAAAAAAABgcEBf/EACsQAAEDAwMD'.
+'AwMFAAAAAAAAAAECAwQFBhEAEiEUMVEHE0EVYYEiIzJCsf/EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/EABcRAQEBAQAAAAAAAAAA'.
+'AAAAAAABERL/2gAMAwEAAhEDEQA/AKL6gVVUa0i1T5QjvTprUJMlxW4R9zgQXe/AH+kaWrntqlWjaq7gpcmotXAw82ht9yY4tch8'.
+'uAFC0k7VBXPGMY51ruiaue+bThIj+7NbWqS+7HDxajFf6AlB/k44o8ZOABk4xkL0X0tZiojKrlRuGRJjugqldSlKGf6t7BuUQe3J'.
+'44xxxrA1a4KVJipLidri8uLHgqOcfjOPxo0o2hdDvS1CmV2Yl6fS5ioipIQR1CAlKkLKR2UUqAI8g6NRSwuuyHab6s1ufLI/Zai7'.
+'UBJOxhTS0+6B32pWSFH4CidOdWU0ukLiN1BLr0zG5Sdm3GRvcPhIT858DvjXNrVsSLnm/VIdTXS6tTnFsxZTSN3jchaTwps+O/z9'.
+'tcBVq3hIX0tYqlIiQHdy5CqRHKHXEjAOMgBKjnvyRk4xrQa7OiGt1K5biYZL8SoVEpjOqkFsONtJCNwASeCQrn7aNUKnQYtLp7EC'.
+'EylmLHQltptPZKQOBo1FzH//2Q==' ; 
+
+//==========================================================
+// lz-small.jpg
+//==========================================================
+$this->chars['z'][0]= 690 ;
+$this->chars['z'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABYDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABgAHA//EACsQAAEDAwQBAwIHAAAAAAAAAAEC'.
+'AwQFESEABhIxBxMiQVFxCCM0UmGRof/EABYBAQEBAAAAAAAAAAAAAAAAAAECAP/EABgRAAMBAQAAAAAAAAAAAAAAAAABEVEC/9oA'.
+'DAMBAAIRAxEAPwBTWfLu1KXXZDbM4uewNvLajlwhaCbBAwDe5uehYd3xm6t6bi3jvulwqc7KgxXZZeYQLNLeF73WRg4HEdgfzrSa'.
+'P45pNEkznITDc9ypLShtyWhJDJyXC2qxJHZvjoZOjyVv1v8AESt6FFS4ijxvTLbawEApSccrYHJf0+OtJMQ2rNXk7GZMufJgJjTH'.
+'Un9M4qzxT7hyCiThIyRnPXWrRvyLElVBUF6vlhl0lwRYCFKcQhAtyWpVhyWTx+w++rUvp4EWjOvbniUOnVatcS43BYDbJSPZyIBw'.
+'ejclIx+3Wa+J63T6DQanuGszI0eZVJJV60p0Jum5GEi6le7l0PjvSjyRsaTvJqI1BqhhR46ksuMrQVJcUSEoUbHNr/7o7C8L7eiz'.
+'4lLlyJk2cEqW+6V+m0AE9ISLnsj5+O9UhsFK92bZZqb9SRu9p2c4A0OCEqDbYAJSlJwAVZv3fBvbFrg/462btlhuS1RG5nL8pYkq'.
+'KrnsKH06I/rVrQKkf//Z' ;
+
+//==========================================================
+// d4-small.jpg
+//==========================================================
+$this->chars['4'][0]= 643 ;
+$this->chars['4'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAYAAADAQEAAAAAAAAAAAAAAAAABAYHAv/EAC0QAAIBAwQA'.
+'BAMJAAAAAAAAAAECAwQFEQAGEiETFDFBUmGBByIjUVNxobHR/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAIB/8QAGBEBAAMBAAAAAAAA'.
+'AAAAAAAAAAERIVH/2gAMAwEAAhEDEQA/ANjM00Nxmt1xiWW31CZp5uJwoAAaOQ/n7qfcZHqO5my3q5XX7R6ijiqnNut9u4NyJ4yv'.
+'JJyjYr8Xhrn5g599J7x3ulBNU7Zo7dXXXcLQ8kURYi4epYtkALjOePv1nUvbLvV7P3BZm3DR3eh88Kp7pVzBZI6iUhGWRRGWwE44'.
+'HX3V+uiL1uHgt+vL/H+aNJQ3CSeCOaFqSaJ1DJKs/TqRkMOvQjvRorHE4pRDLNWLGlRHGUeYIORXs9e5B7OP31E0fmdyb/t0DJ4Q'.
+'27bfx3YZzPUIoAAz7IpOD6cuxq0uNumqLfVNDOqXBoZEjnZcqhIPXH4c46+WkdoWOltu3IDDLLLVVR83UVcuPEmmcZZ2/rHoAANG'.
+'GI7KIY1ijoLeEQBVCwIoAHpgY6Hy0aZe7mJ2jeHLKcEhusj6aNKgzr//2Q==' ; 
+
+//==========================================================
+// lv-small.jpg
+//==========================================================
+$this->chars['v'][0]= 648 ;
+$this->chars['v'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQDBQYH/8QAKBAAAQQBAwMEAgMAAAAAAAAA'.
+'AQIDBBEFAAYhEzFBEhQiYQdRFTKB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFxEBAQEBAAAAAAAAAAAAAAAAAAERIf/aAAwD'.
+'AQACEQMRAD8A6Ngt1SZ4yrYgrecgTFsFJA9aGwAUrUaF2D2Avjzq6CIjiBPkB9bwQVIkIYIDae/wq+P9N+dY4SGMf+Txlev7KBmY'.
+'PoadKRy4zxSgRxaTwO/x09u7KPYnasmHjlsyFZZXt4K23ezjvBpNGgLUrvXfVZyLLbWambiwEbKvvxYAkeotNlIJW2FEJWb7WBda'.
+'NSQI0fHYyJjkrjKRDZQwnpQ1vgBIr+w8+a+9GocZr8iKkuY1eXhsKH8U8iZE9BHz6ZHUc48UfSPqzqH3kfeO9kTTDQYGGietpTaO'.
+'shyW6AocpHNIrv8AvWzk9BUSdPdYS4BcRlomkhIV6KP0VE39V+tU2wdlRMHtZUB8NuTQ+51X27+Kr46ZPIAFV540D8zeLsJ5LMHa'.
+'ubmMBCVJdjx0pRyLoWR4I8aNIQ8BvZMNtMTeUcsptKfc4tC1gAkCyFC+K0aJtf/Z' ;
+
+//==========================================================
+// lk-small.jpg
+//==========================================================
+$this->chars['k'][0]= 680 ;
+$this->chars['k'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABUDASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAUGBAMH/8QALhAAAQMDAwIEBAcAAAAAAAAA'.
+'AQIDBAUREgAGITFBEyIyYQcVUYEUIzNicZHx/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwEE/8QAGxEAAwACAwAAAAAAAAAAAAAAAAEC'.
+'AxESMeH/2gAMAwEAAhEDEQA/APVK/V36dU6NSJDTT8esPLiqfK8S2cCoeTkKvZQ6jm2ldSqKqbu+OgMOvSX3m4UBrLnDlbqiefKl'.
+'Nzz2x1m+IwNP27CkJQ7JkR6rCkMJbP5jp8S2CPfkgD6H+dJ6Ca0nerr+64rTNSqMYrg+C9mmOwhVpDfsuxSbi97DmybaoZeQ5jTl'.
+'PEp18JTIfeW3kq3ly4H26aNZqvTWZsjFcZTsVtSg0G8Rio+vr2vb7g6NLPRnuXy8F+8kl+obUh4KXJdqSJJQnohlkZqJPYBXh3P+'.
+'a4b5Hyp6k1bO7sOotPyXkj9NlwFl0ewstJA9ifrqkVSmET4csoS7UTHXFQ+6SQlskKUMb/tH9ddLVUmS7DqdBqD7U6OsqfS46jzl'.
+'hQ5bXb1K9Scuybdxo2OTu92dwSZkWn0Sb8viQWyn8Qq5D6ifSLd0BIv7q0arTBRSKPToMZbi2GWylsvLK148Wue/XRrRjxOpT2R2'.
+'k9aP/9k=' ; 
+
+//==========================================================
+// lr-small.jpg
+//==========================================================
+$this->chars['r'][0]= 681 ;
+$this->chars['r'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABYDASIAAhEBAxEB/8QAGgAAAgIDAAAAAAAAAAAAAAAAAAYCBQMEB//EAC4QAAICAQIFAgMJAQAAAAAA'.
+'AAECAwQRBQYAEiExQQdRFGFxEyIyM0JSYoGC8P/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/EABcRAQEBAQAAAAAAAAAAAAAAAAAB'.
+'EUH/2gAMAwEAAhEDEQA/AOs0ZdETU54Gt1INSmlPJEsyo7J+jlXPUYBPY9c+eE/dO9tY0a7ren6BVrW7VJTZtW5kZkjXkBSIKveQ'.
+'gHp0AAJ4w+q2hVdT2Md0h46+saS4mr3EUK0gWTAB+vQj2PboeL/ZVOqmhaZVjkFmxdC6tctt3tM2G5/7bAx4C4+qxiWwd3prWzKe'.
+'r3IBAth5OYxozKsgc8y4GTgnJB9uncdTi6tXq2140rRVM13JMEMAVAg7sMdBjJB/18uDgRO9R2Oo6FX2vShkFzURFUq1whIj+8DI'.
+'7EdAFjXv7MeNb0kuStsFEmIaajZaos2fy2Q4VGH7SGxn+Rzw9yMLOm/FzRhZazmOTkP4grYyD3B8j2PTyeFfZ+z7G3BeSS8lmprl'.
+'2K2qcnK0Z5S8gPjrgAY8cNEWmq7u23pEos6/Zji+Kd0rLLGWwseA3joeZj/w4OET1g0vlmrWV+ydFnkUxSgsvM4V+YYIwfHz6cHB'.
+'ZeKZ1//Z' ; 
+
+//==========================================================
+// lg-small.jpg
+//==========================================================
+$this->chars['g'][0]= 655 ;
+$this->chars['g'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQCBQYH/8QAJxAAAQQBAwQCAgMAAAAAAAAA'.
+'AQIDBBEFAAYhBxIxQRNhcYEiQlH/xAAYAQACAwAAAAAAAAAAAAAAAAACAwABBP/EABkRAAMBAQEAAAAAAAAAAAAAAAABAhEhIv/a'.
+'AAwDAQACEQMRAD8AayO4t6bq3hmMHtxyLi4OKeKH5jyASiiQCCQeTRNAeB61FrBb+jTGpLO+BMW24EFMhkhpQru8m7B/H70x09Yi'.
+'q3nv/vLfwpnJ7UNkqSRbngf2ofWkpXV7brymC2malLfagurjW0aHk89xPJ9cX9aprURHWbYEaMHHEBfwpv8AnXPk+/8AdGqGJOxO'.
+'4YbOSxK4y4boIStUWysgkEmxY54r60aOI8oTV9MHtjJwunPUbO46WWo0HLlD8KY4goboFVoquOVEVwLT963WdnxYfT6ZJyz0JvHm'.
+'KvtaSkW4tYNVSqKiTwB+fw5n9sY/cuOXCzDDcluyW3Ckd7V+0n0eNZTH9DdouFalHIOJBUhtDki0pNV3UALo81ehG6IdKjPZ6d47'.
+'4ywltanVJvuJI+RQs/sHRqy2r003JhsImEc/CUyhxRZBjKV2oJ8eRXNmufPnRo1WIz3DdNn/2Q==' ;
+
+//==========================================================
+// lc-small.jpg
+//==========================================================
+$this->chars['c'][0]= 629 ;
+$this->chars['c'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAUGBwID/8QALRAAAgICAQIEBAYDAAAAAAAA'.
+'AQIDBAURACExBhIiQRMVUWEHMkJScYFykaH/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/xAAXEQEBAQEAAAAAAAAAAAAAAAAAATER'.
+'/9oADAMBAAIRAxEAPwDcoGkmiT4Q8kWvzuPU38D2/v8A1zwrCFayq1qTaFk2H7aJHt05MeMvENzC4upDWkjW9kJXiricAJCigvJN'.
+'IB1IVQT5frrv24twPgunk6a288crbklUSJNNdnSTZ2STHHqOP/Eb17njdZtAoqwEvrEiGVyG117/AG6HhyV8H1sljMldoxXTksGC'.
+'zV7M0oaWGQOVeGQ92I6EMR22D11w4LmEPjaOL51iL8ssc9Z69zHtZkYCGGeQK0ez2UEoU39wCeX1S/LLiEt+mPSbMLxsGVv2kEjR'.
+'305xkaEV/GTULMUT1LD/AAGh8gIZS2jv+vpybb8NMIb0dVLWYWgiiU0vmMphOj6V0TvQI3rfsON1E6dYjGtisa0F1mAWR2NhG0WZ'.
+'3Ls3TqNs5Hc9h23w49NWL9K+Q/VD5T/zhwPH/9k=' ; 
+
+//==========================================================
+// d7-small.jpg
+//==========================================================
+$this->chars['7'][0]= 658 ;
+$this->chars['7'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABgEFBwT/xAAuEAABAwIE'.
+'BAQGAwAAAAAAAAABAgMEBREABiExEhMiQSMyUXEHFBclVJFhk9L/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/8QAGREBAQEAAwAA'.
+'AAAAAAAAAAAAAAEREiFR/9oADAMBAAIRAxEAPwDXq9mCjZeQ05VZ5ZST4bfEpa3VdglCbqUe+g9MZ5Uq7V8415WXoMSdQ6etgSps'.
+'19wpkCMDZKUpv0FZvbi1NzpYasMDLDUbMVXrtQdbeeU23xLWkj5RlLYK0J7anW9gbAjCzkOtsVSUJUdtc6dVZK51UeaFm4LKbhpC'.
+'l7EhIFkDW974GbRI2XorUVls1OTdKAOqUpR0Hc3198GITQ6k+hLwrEpoODiDenRfW23bBicg78JXxPpD0mgVOW5PAivNNpahsPW5'.
+'8xxQaSVkboQnhsnYm5OHqDGp1IpsalMKjMsMIC3+XZKbJFth62/QOEfMOZqZXp9JcKZTcGmTky3meSi7xQklI81vMR+sXIz/AEgp'.
+'Q0qPNu6ea8Q2jqtbp8+2w9h/OKORc/cpHjt1dDSHOtLZ4ekHW23bBjj+o9H/AB539aP94MG0+L//2Q==' ; 
+
+//==========================================================
+// ly-small.jpg
+//==========================================================
+$this->chars['y'][0]= 672 ;
+$this->chars['y'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQGBQf/xAArEAABAwMEAQIFBQAAAAAAAAAB'.
+'AgMEBREhAAYSEzEHIhQkQVGxQmFxgaH/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/xAAeEQEAAgEEAwAAAAAAAAAAAAABABECAxIh'.
+'MUGR8P/aAAwDAQACEQMRAD8Ar3tys07dVHohemz5dWQ7fk91MsA3IIRY8rkKFySceTqw3JVV0KhyKw+0C1CQp9aUOFSiAk4AIAvn'.
+'76xtz0ioVvbcJ6msx2JtOfZmw1PKI5LQcJNh7UqBKcn6+NRfqPu6s1fYc6GxSJsRfWDUVSGA22ygEckJWSexRNgOP0udXzDKOJ0I'.
+'yo62mHm25Sy80l1Z4lSgpQvZRGLgWwPGjTjbchyLH+Ejx22EtJSgO8kki3kADA/nOjWjGzv73CyQZjUWNVp7bNSrj7qJDqflqUlQ'.
+'DMds24l3HvcNr3Pi9gME6T9WWVsemdYWswwC2lPta4m5WMA3OdUExCmozUJD6g84ntMjrHIFBTdQz5yLDx/WDNytpwW6nAkViqVe'.
+'uvmXdlme6n4dCwlRBKEgA2tj99QG7Ilncp5QqpU31PMsJ6x7A32f6SPxo0hPVCD45oVyKf0MtgeT97/nRrO7UOCFla3tn//Z' ; 
+
+//==========================================================
+// d3-small.jpg
+//==========================================================
+$this->chars['3'][0]= 662 ;
+$this->chars['3'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD//gAJSnBHcmFwaP/bAEMACAYGBwYFCAcHBwkJCAoMFA0MCwsMGRITDxQdGh8eHRocHCAkLicg'.
+'IiwjHBwoNyksMDE0NDQfJzk9ODI8LjM0Mv/bAEMBCQkJDAsMGA0NGDIhHCEyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjIyMjIyMjIyMjIyMv/AABEIAB4AEgMBIgACEQEDEQH/xAAZAAACAwEAAAAAAAAAAAAAAAAABAUGBwL/xAArEAABBAED'.
+'AwMDBQEAAAAAAAABAgMEBREABhIhMUEiMmETFZEHFkJDUdH/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/xAAYEQEBAQEBAAAAAAAA'.
+'AAAAAAAAEQExQf/aAAwDAQACEQMRAD8A0vclruBdk3VVLLUNssGRJsZSCtqOjlgJAHvcOD6c4HnOdIbcttw1W5P29cFEhuawqTXS'.
+'VsJjnCMBxKkJJx7goAde+ceJfdNxU0UNlyymyXHi6kxWUNl1S3EnkAEIHX2nv86qtTuZr9Q9+1VhRsOoYpYcgSVyAE/TdewkJxnK'.
+'sBCjkdPGpnOtFMd3PqsXgfOAgD8Y0aX+11H9rDDjn8lr9yj5J+dGqsqxaw6Cc9cQZU4Sp7zTJsIrKlcUEKwhSin1JABI45GUjqOu'.
+'lbOvjbc3Ts9ynjGCy445UuFLYRzbWgrT6fhSCQSMDke+pew2zYVly/d7YchNqkMJZnQpgV9J8IzwWFJyUrAJHYgjvpLbu37G5nR7'.
+'vck5C3YRKYEOEVJZj8kjKypXqWvirjk9h+dB9i4faa89TDZUfKlIyT8k+To10a6KTkpcJ/0vL/7o0TS//9k=' ; 
+
+//==========================================================
+// ln-small.jpg
+//==========================================================
+$this->chars['n'][0]= 643 ;
+$this->chars['n'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABQDASIAAhEBAxEB/8QAGwAAAgEFAAAAAAAAAAAAAAAAAAYCAQMEBQf/xAAtEAACAQMCBAUCBwAAAAAA'.
+'AAABAgMEBREAIQYSE0EHIjFRcWGRIzIzQoGCwf/EABYBAQEBAAAAAAAAAAAAAAAAAAMEAP/EABkRAQEBAQEBAAAAAAAAAAAAAAEA'.
+'AhEhUf/aAAwDAQACEQMRAD8A6FR3p7v4oV9rlkMQsjL00RyOss0KkFxnDcrc2PbI1NOJKyTjW+W5OmKeA0UEJx5meRZS2/8AUfbS'.
+'LVGS1+K16vCzfiR3GmoqqXGyxz06hWPsFlVMfOmq1iNvE69KjBYo3oJMZ3GKeYYPxg/fW+xzZX1FLQyxwSTcpWNceu4G3+aNSmpY'.
+'qmQzzwh2k8yhv2r2H23/AJ0aoy+EWh7I1ntacR3PxDtEzhjWy0wkkIwYmanU5GO6sNh7rrU8AVdTceNbhDXxNHUQvS0tZ3DzwxVA'.
+'fB7hj59/XJ08cPWaKj4gvlwSQiG7dCboqvLy9NOmQT9SM7ayJrBa6K5V91hjlWorp4JGUOAglRSiMMDb82/vgaBGTpVvtNUVtyJg'.
+'5+WNAh5ZCu/r2+dGrgq0pi0DhmlRsSSAfqMd+b6ZyNu3po1Rk1yNBe3/2Q==' ; 
+
+//==========================================================
+// lu-small.jpg
+//==========================================================
+$this->chars['u'][0]= 671 ;
+$this->chars['u'][1]= 
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAYDBAUH/8QAJRAAAQQBAwQDAQEAAAAAAAAA'.
+'AQIDBBEFAAYhBxMxYRJBURSB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAD/8QAGhEBAQEAAwEAAAAAAAAAAAAAAQARITFBAv/aAAwD'.
+'AQACEQMRAD8A6dLkQmJzu3WVtHIqjf0duKFNuBr5UTQ45F1R8/XI1PMmsYoJyjhS9iI7BKHeKjkXZVXqhyLHP+rrHeR1pZlx1W1M'.
+'wTiW0ukkrS28nn5fV2SPPFfurHUKQhzYG7pLYKEfyBhaSOS7dG/YCki/uvWn3LPDOJrwa4kyEzOYeakqkpC3Hk0bNePQHgDRpchY'.
+'leIZwzUWauKtuPctTSUlCAUmrBHIKuAPV/ujQsmHdm7hya43UbbD3ZVElOQJsdTS6IQaQUqBHCk8E2Pocgam6oYwObHy0Zm0oi45'.
+'T1KBPdpV2f0pom/1Ws7cmPazu98Ltvcq3VzRHfehz8a4pirFEKRZo8eQT+eCdWYfS/b+WYnxpbuVcDRMdHcyTqg2fiAfiLoi+Rf+'.
+'jT7Xc74HtOYnHyUOh8yWUvKeHhy0CiPVUAPoDRrm+OeznTva6lzsyMjCYbbaiNJjJSWElagD5tRpNUSALFeNGoOCH7Bv/9k=' ; 
+
+//==========================================================
+// lw-small.jpg
+//==========================================================
+$this->chars['w'][0]= 673 ;
+$this->chars['w'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABcDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYDBAX/xAAtEAACAQMDAgMHBQAAAAAAAAAB'.
+'AgMEBREABhIhMRMUQRUiIzJRYZEWNIGx0f/EABYBAQEBAAAAAAAAAAAAAAAAAAABA//EABoRAAICAwAAAAAAAAAAAAAAAAABERIh'.
+'MVH/2gAMAwEAAhEDEQA/AHXbV13ZLu6t2/uaa1JijWopVp4XUTKSAXRyc+6ehBGeoPbTSlwpql0K3GneqpZViqUhI5JzGMEZJGeh'.
+'GlXfaFILDf7FQzXC426rDLTojs8sLqVkXBGcfKf40twWbdWzZY75R0s90ul3jPtKjVMJDNn4DDp8iEhW+wJ1WZG2KWt3Lv26U1tv'.
+'92o7PaYkgYUbqVepYlmUBlIwqnB++O2jTDt/bBtth9jcpvEWNGqalZQryTlmeR8jPct6+mNGmRC4a1U13htzVFItB5nA/cyOUVfp'.
+'7oz/ALqitJulYJKuqvFsppHALLFb3cp9FBaXr+O51bq0q6i38KK5PDVAAxSzU6SIpz3Kjjn8jUFoS7uFmut1gq17xLFQ+DxOccj8'.
+'Rsn+tVpiyJnqv09YfOXu5AycgZZQEhBZjgDBOOgwO/po0sttWHdNzqLruioa4UwmdaC3kYp4IwSvJlBHKQ4OSe3po0qxM6P/2Q==' ;
+
+//==========================================================
+// lq-small.jpg
+//==========================================================
+$this->chars['q'][0]= 671 ;
+$this->chars['q'][1]=
+'/9j/4AAQSkZJRgABAQEASgBKAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx'.
+'NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy'.
+'MjIyMjIyMjL/wAARCAAeABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAcDBAUG/8QAKRAAAQQBBAICAQQDAAAAAAAA'.
+'AQIDBBEFAAYSIQcxIlETCBQVgSNBYf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oADAMB'.
+'AAIRAxEAPwDT3H5Qz+O3LN2vtrF/y86NYLzzVlAABJITQPv2a/17vXMboz3lDEYWPuafNx7CFrS03+2jpK2bs0CUkUa7pRvrUu63'.
+'sr438yv7pLEo4XIK5Kcji0uJUkckm+uQUOVH6GsnyJv7A5vaJwuFdkONLmolgONFH4vioKRXYqyCADXvRMh0yspmZ4jyIEtDTK47'.
+'aiA0lQUopBJBI/7X9aNT7amRo228e3a31iO3yUzCcdSPiKAIFdCho0TIswZ7GQlO/hlRxBooih1YXzAoKUkX0LPEBX110dJ7zbuv'.
+'AORpO04cIpmxH23FSEIRwKuNnsdk0o31702XhFMKbuRUZJWP8LTQ6HBCuIB+iVWSR2BXuqK93/hDlvGzEphmG3Ml5JpDi1I7TzNA'.
+'BYFlPafY+/7LBiv1CYDH4iFDOGySlMR22lFP4wCUpANfL11o1r4bxXlWMNEaE/bqlIbCFl/ANPK5Do/M0VDr2Rf3o0TX/9k=' ;
+
+
+
+    } 
+}
+
+class AntiSpam {
+
+    var $iData='';
+    var $iDD=null;
+
+    function AntiSpam($aData='') {
+	$this->iData = $aData;
+	$this->iDD = new HandDigits();	
+    }
+
+    function Set($aData) {
+	$this->iData = $aData;
+    }
+
+    function Rand($aLen) {
+	$d='';
+	for($i=0; $i < $aLen; ++$i) {
+	    if( rand(0,9) < 6 ) {
+		// Digits
+		$d .= chr( ord('1') + rand(0,8) );
+	    }
+	    else {
+		// Letters
+		do {
+		    $offset = rand(0,25);
+		} while ( $offset==14 );
+		$d .= chr( ord('a') + $offset );
+	    }
+	}
+	$this->iData = $d;
+	return $d;
+    }
+
+    function Stroke($aStrokeFileName="") {
+
+	$n=strlen($this->iData);
+	if( $n==0 ) {
+	    return false;
+	}
+
+	for($i=0; $i < $n; ++$i ) {
+	    if( $this->iData[$i]==='0' || strtolower($this->iData[$i])==='o') {
+		return false;
+	    }
+	}
+
+	$img = @imagecreatetruecolor($n*$this->iDD->iWidth, $this->iDD->iHeight);
+	if( $img < 1 ) {
+	    return false;
+	}
+
+	$start=0;
+	for($i=0; $i < $n; ++$i ) {
+	    $dimg = imagecreatefromstring(base64_decode($this->iDD->chars[strtolower($this->iData[$i])][1]));
+	    imagecopy($img,$dimg,$start,0,0,0,imagesx($dimg), $this->iDD->iHeight);
+	    $start += imagesx($dimg);
+	}
+	$resimg = @imagecreatetruecolor($start+4, $this->iDD->iHeight+4);
+	if( $resimg < 1 ) {
+	    return false;
+	}
+
+	imagecopy($resimg,$img,2,2,0,0,$start, $this->iDD->iHeight);
+
+	if( $aStrokeFileName!="" ) {
+	    if( file_exists($aStrokeFileName) ) {
+		if( !@unlink($aStrokeFileName) )
+		    return false;
+	    }
+	    imagejpeg($resimg,$aStrokeFileName);
+	    return;
+	}
+
+	header("Content-type: image/jpeg");
+	$res=imagejpeg($resimg);
+	return $res;
+    }
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_bar.php php-syslog-ng/html/includes/jpgraph/jpgraph_bar.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_bar.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_bar.php	2006-02-14 15:10:46.000000000 -0500
@@ -0,0 +1,964 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_BAR.PHP
+// Description:	Bar plot extension for JpGraph
+// Created: 	2001-01-08
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_bar.php 542 2006-02-14 20:10:46Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+require_once('jpgraph_plotband.php');
+
+// Pattern for Bars
+DEFINE('PATTERN_DIAG1',1);
+DEFINE('PATTERN_DIAG2',2);
+DEFINE('PATTERN_DIAG3',3);
+DEFINE('PATTERN_DIAG4',4);
+DEFINE('PATTERN_CROSS1',5);
+DEFINE('PATTERN_CROSS2',6);
+DEFINE('PATTERN_CROSS3',7);
+DEFINE('PATTERN_CROSS4',8);
+DEFINE('PATTERN_STRIPE1',9);
+DEFINE('PATTERN_STRIPE2',10);
+
+//===================================================
+// CLASS BarPlot
+// Description: Main code to produce a bar plot 
+//===================================================
+class BarPlot extends Plot {
+    var $width=0.4; // in percent of major ticks
+    var $abswidth=-1; // Width in absolute pixels
+    var $fill=false,$fill_color="lightblue"; // Default is to fill with light blue
+    var $ybase=0; // Bars start at 0 
+    var $align="center";
+    var $grad=false,$grad_style=1;
+    var $grad_fromcolor=array(50,50,200),$grad_tocolor=array(255,255,255);
+    var $bar_shadow=false;
+    var $bar_shadow_color="black";
+    var $bar_shadow_hsize=3,$bar_shadow_vsize=3;	
+    var $valuepos='top';
+    var $iPattern=-1,$iPatternDensity=80,$iPatternColor='black';
+	
+//---------------
+// CONSTRUCTOR
+    function BarPlot(&$datay,$datax=false) {
+	$this->Plot($datay,$datax);		
+	++$this->numpoints;
+    }
+
+//---------------
+// PUBLIC METHODS	
+	
+    // Set a drop shadow for the bar (or rather an "up-right" shadow)
+    function SetShadow($color="black",$hsize=3,$vsize=3,$show=true) {
+	$this->bar_shadow=$show;
+	$this->bar_shadow_color=$color;
+	$this->bar_shadow_vsize=$vsize;
+	$this->bar_shadow_hsize=$hsize;
+		
+	// Adjust the value margin to compensate for shadow
+	$this->value->margin += $vsize;
+    }
+		
+    // DEPRECATED use SetYBase instead
+    function SetYMin($aYStartValue) {
+	//die("JpGraph Error: Deprecated function SetYMin. Use SetYBase() instead.");    	
+	$this->ybase=$aYStartValue;
+    }
+
+    // Specify the base value for the bars
+    function SetYBase($aYStartValue) {
+	$this->ybase=$aYStartValue;
+    }
+	
+    function Legend(&$graph) {
+	if( $this->grad && $this->legend!="" && !$this->fill ) {
+	    $color=array($this->grad_fromcolor,$this->grad_tocolor);
+	    // In order to differentiate between gradients and cooors specified as an RGB triple
+	    $graph->legend->Add($this->legend,$color,"",-$this->grad_style,
+				$this->legendcsimtarget,$this->legendcsimalt);
+	}
+	elseif( $this->legend!="" && ($this->iPattern > -1 || is_array($this->iPattern)) ) {
+	    if( is_array($this->iPattern) ) {
+		$p1 = $this->iPattern[0];
+		$p2 = $this->iPatternColor[0];
+		$p3 = $this->iPatternDensity[0];
+	    }
+	    else {
+		$p1 = $this->iPattern;
+		$p2 = $this->iPatternColor;
+		$p3 = $this->iPatternDensity;
+	    }
+	    $color = array($p1,$p2,$p3,$this->fill_color);
+	    // A kludge: Too mark that we add a pattern we use a type value of < 100
+	    $graph->legend->Add($this->legend,$color,"",-101,
+				$this->legendcsimtarget,$this->legendcsimalt);
+	}
+	elseif( $this->fill_color && $this->legend!="" ) {
+	    if( is_array($this->fill_color) ) {
+		$graph->legend->Add($this->legend,$this->fill_color[0],"",0,
+				    $this->legendcsimtarget,$this->legendcsimalt);
+	    }
+	    else {
+		$graph->legend->Add($this->legend,$this->fill_color,"",0,
+				    $this->legendcsimtarget,$this->legendcsimalt);	
+	    }
+	}
+    }
+
+    // Gets called before any axis are stroked
+    function PreStrokeAdjust(&$graph) {
+	parent::PreStrokeAdjust($graph);
+
+	// If we are using a log Y-scale we want the base to be at the
+	// minimum Y-value unless the user have specifically set some other
+	// value than the default.
+	if( substr($graph->axtype,-3,3)=="log" && $this->ybase==0 )
+	    $this->ybase = $graph->yaxis->scale->GetMinVal();
+		
+	// For a "text" X-axis scale we will adjust the
+	// display of the bars a little bit.
+	if( substr($graph->axtype,0,3)=="tex" ) {
+	    // Position the ticks between the bars
+	    $graph->xaxis->scale->ticks->SetXLabelOffset(0.5,0);
+
+	    // Center the bars 
+	    if( $this->abswidth > -1 ) {
+		$graph->SetTextScaleAbsCenterOff($this->abswidth);
+	    }
+	    else {
+		if( $this->align == "center" )
+		    $graph->SetTextScaleOff(0.5-$this->width/2);
+		elseif( $this->align == "right" )
+		    $graph->SetTextScaleOff(1-$this->width);			
+	    }
+
+	}
+	elseif( is_a($this,'AccBarPlot') || is_a($this,'GroupBarPlot') ) { 
+	    // We only set an absolute width for linear and int scale
+	    // for text scale the width will be set to a fraction of
+	    // the majstep width.
+	    if( $this->abswidth == -1 ) {
+                // Not set
+		// set width to a visuable sensible default
+		$this->abswidth = $graph->img->plotwidth/(2*count($this->coords[0]));
+	    }
+	}
+    }
+
+    function Min() {
+	$m = parent::Min();
+	if( $m[1] >= $this->ybase )
+	    $m[1] = $this->ybase;
+	return $m;	
+    }
+
+    function Max() {
+	$m = parent::Max();
+	if( $m[1] <= $this->ybase )
+	    $m[1] = $this->ybase;
+	return $m;	
+    }	
+	
+    // Specify width as fractions of the major stepo size
+    function SetWidth($aFractionWidth) {
+	$this->width=$aFractionWidth;
+    }
+	
+    // Specify width in absolute pixels. If specified this
+    // overrides SetWidth()
+    function SetAbsWidth($aWidth) {
+	$this->abswidth=$aWidth;
+    }
+		
+    function SetAlign($aAlign) {
+	$this->align=$aAlign;
+    }
+	
+    function SetNoFill() {
+	$this->grad = false;
+	$this->fill_color=false;
+	$this->fill=false;
+    }
+		
+    function SetFillColor($aColor) {
+	$this->fill = true ;
+	$this->fill_color=$aColor;
+    }
+	
+    function SetFillGradient($from_color,$to_color,$style) {
+	$this->grad=true;
+	$this->grad_fromcolor=$from_color;
+	$this->grad_tocolor=$to_color;
+	$this->grad_style=$style;
+    }
+	
+    function SetValuePos($aPos) {
+	$this->valuepos = $aPos;
+    }
+
+    function SetPattern($aPattern, $aColor='black'){
+	if( is_array($aPattern) ) {
+	    $n = count($aPattern);
+	    $this->iPattern = array();
+	    $this->iPatternDensity = array();
+	    if( is_array($aColor) ) {
+		$this->iPatternColor = array();
+		if( count($aColor) != $n ) {
+		    JpGraphError::RaiseL(2001);//('NUmber of colors is not the same as the number of patterns in BarPlot::SetPattern()');
+		}
+	    }
+	    else
+		$this->iPatternColor = $aColor;
+	    for( $i=0; $i < $n; ++$i ) {
+		$this->_SetPatternHelper($aPattern[$i], $this->iPattern[$i], $this->iPatternDensity[$i]);
+		if( is_array($aColor) ) {
+		    $this->iPatternColor[$i] = $aColor[$i];
+		}
+	    }
+	}
+	else {
+	    $this->_SetPatternHelper($aPattern, $this->iPattern, $this->iPatternDensity);
+	    $this->iPatternColor = $aColor;
+	}
+    }
+
+    function _SetPatternHelper($aPattern, &$aPatternValue, &$aDensity){
+	switch( $aPattern ) {
+	    case PATTERN_DIAG1:
+		$aPatternValue= 1;
+		$aDensity = 90;
+		break;
+	    case PATTERN_DIAG2:
+		$aPatternValue= 1;
+		$aDensity = 75;
+		break;
+	    case PATTERN_DIAG3:
+		$aPatternValue= 2;
+		$aDensity = 90;
+		break;
+	    case PATTERN_DIAG4:
+		$aPatternValue= 2;
+		$aDensity = 75;
+		break;
+	    case PATTERN_CROSS1:
+		$aPatternValue= 8;
+		$aDensity = 90;
+		break;
+	    case PATTERN_CROSS2:
+		$aPatternValue= 8;
+		$aDensity = 78;
+		break;
+	    case PATTERN_CROSS3:
+		$aPatternValue= 8;
+		$aDensity = 65;
+		break;
+	    case PATTERN_CROSS4:
+		$aPatternValue= 7;
+		$aDensity = 90;
+		break;
+	    case PATTERN_STRIPE1:
+		$aPatternValue= 5;
+		$aDensity = 95;
+		break;
+	    case PATTERN_STRIPE2:
+		$aPatternValue= 5;
+		$aDensity = 85;
+		break;
+	    default:
+		JpGraphError::RaiseL(2002);//('Unknown pattern specified in call to BarPlot::SetPattern()');
+	}
+    }
+
+    function Stroke(&$img,&$xscale,&$yscale) { 
+		
+	$numpoints = count($this->coords[0]);
+	if( isset($this->coords[1]) ) {
+	    if( count($this->coords[1])!=$numpoints )
+		JpGraphError::RaiseL(2003,count($this->coords[1]),$numpoints);
+//("Number of X and Y points are not equal. Number of X-points:".count($this->coords[1])."Number of Y-points:$numpoints");
+	    else
+		$exist_x = true;
+	}
+	else 
+	    $exist_x = false;
+		
+		
+	$numbars=count($this->coords[0]);
+
+	// Use GetMinVal() instead of scale[0] directly since in the case
+	// of log scale we get a correct value. Log scales will have negative
+	// values for values < 1 while still not representing negative numbers.
+	if( $yscale->GetMinVal() >= 0 ) 
+	    $zp=$yscale->scale_abs[0]; 
+	else {
+	    $zp=$yscale->Translate(0);
+	}
+
+	if( $this->abswidth > -1 ) {
+	    $abswidth=$this->abswidth;
+	}
+	else
+	    $abswidth=round($this->width*$xscale->scale_factor,0);
+
+	// Count potential pattern array to avoid doing the count for each iteration
+	if( is_array($this->iPattern) ) {
+	    $np = count($this->iPattern);
+	}
+					
+	for($i=0; $i < $numbars; ++$i) {
+
+ 	    // If value is NULL, or 0 then don't draw a bar at all
+ 	    if ($this->coords[0][$i] === null ||
+		$this->coords[0][$i] === '' ||
+		$this->coords[0][$i] === 0 ) continue;    
+
+	    if( $exist_x ) $x=$this->coords[1][$i];
+	    else $x=$i;
+			
+	    $x=$xscale->Translate($x);
+
+// Comment Note: This confuses the positioning when using acc together with 
+// grouped bars. Workaround for fixing #191
+/*
+	    if( !$xscale->textscale ) {
+	    	if($this->align=="center")
+		    $x -= $abswidth/2;
+		elseif($this->align=="right")
+		    $x -= $abswidth;			
+	    }
+
+*/
+	    // Stroke fill color and fill gradient
+	    $pts=array(
+		$x,$zp,
+		$x,$yscale->Translate($this->coords[0][$i]),
+		$x+$abswidth,$yscale->Translate($this->coords[0][$i]),
+		$x+$abswidth,$zp);
+	    if( $this->grad ) {
+		$grad = new Gradient($img);
+		$grad->FilledRectangle($pts[2],$pts[3],
+				       $pts[6],$pts[7],
+				       $this->grad_fromcolor,$this->grad_tocolor,$this->grad_style); 
+	    }
+	    elseif( !empty($this->fill_color) ) {
+		if(is_array($this->fill_color)) {
+		    $img->PushColor($this->fill_color[$i % count($this->fill_color)]);
+		} else {
+		    $img->PushColor($this->fill_color);
+		}
+		$img->FilledPolygon($pts);
+		$img->PopColor();
+	    }
+ 
+			
+	    // Remember value of this bar
+	    $val=$this->coords[0][$i];
+
+	    if( !empty($val) && !is_numeric($val) ) {
+		JpGraphError::RaiseL(2004,$i,$val);
+//('All values for a barplot must be numeric. You have specified value['.$i.'] == \''.$val.'\'');
+	    }
+
+	    // Determine the shadow
+	    if( $this->bar_shadow && $val != 0) {
+
+		$ssh = $this->bar_shadow_hsize;
+		$ssv = $this->bar_shadow_vsize;
+		// Create points to create a "upper-right" shadow
+		if( $val > 0 ) {
+		    $sp[0]=$pts[6];		$sp[1]=$pts[7];
+		    $sp[2]=$pts[4];		$sp[3]=$pts[5];
+		    $sp[4]=$pts[2];		$sp[5]=$pts[3];
+		    $sp[6]=$pts[2]+$ssh;	$sp[7]=$pts[3]-$ssv;
+		    $sp[8]=$pts[4]+$ssh;	$sp[9]=$pts[5]-$ssv;
+		    $sp[10]=$pts[6]+$ssh;	$sp[11]=$pts[7]-$ssv;
+		} 
+		elseif( $val < 0 ) {
+		    $sp[0]=$pts[4];		$sp[1]=$pts[5];
+		    $sp[2]=$pts[6];		$sp[3]=$pts[7];
+		    $sp[4]=$pts[0];		$sp[5]=$pts[1];
+		    $sp[6]=$pts[0]+$ssh;	$sp[7]=$pts[1]-$ssv;
+		    $sp[8]=$pts[6]+$ssh;	$sp[9]=$pts[7]-$ssv;
+		    $sp[10]=$pts[4]+$ssh;	$sp[11]=$pts[5]-$ssv;
+		}
+		if( is_array($this->bar_shadow_color) ) {
+		    $numcolors = count($this->bar_shadow_color);
+		    if( $numcolors == 0 ) {
+			JpGraphError::RaiseL(2005);//('You have specified an empty array for shadow colors in the bar plot.');
+		    }
+		    $img->PushColor($this->bar_shadow_color[$i % $numcolors]);
+		}
+		else {
+		    $img->PushColor($this->bar_shadow_color);
+		}
+		$img->FilledPolygon($sp);
+		$img->PopColor();
+	    }
+			
+	    // Stroke the pattern
+	    if( is_array($this->iPattern) ) {
+		$f = new RectPatternFactory();
+		if( is_array($this->iPatternColor) ) {
+		    $pcolor = $this->iPatternColor[$i % $np];
+		}
+		else
+		    $pcolor = $this->iPatternColor;
+		$prect = $f->Create($this->iPattern[$i % $np],$pcolor,1);
+		$prect->SetDensity($this->iPatternDensity[$i % $np]);
+
+		if( $val < 0 ) {
+		    $rx = $pts[0];
+		    $ry = $pts[1];
+		}
+		else {
+		    $rx = $pts[2];
+		    $ry = $pts[3];
+		}
+		$width = abs($pts[4]-$pts[0])+1;
+		$height = abs($pts[1]-$pts[3])+1;
+		$prect->SetPos(new Rectangle($rx,$ry,$width,$height));
+		$prect->Stroke($img);
+	    }
+	    else {
+		if( $this->iPattern > -1 ) {
+		    $f = new RectPatternFactory();
+		    $prect = $f->Create($this->iPattern,$this->iPatternColor,1);
+		    $prect->SetDensity($this->iPatternDensity);
+		    if( $val < 0 ) {
+			$rx = $pts[0];
+			$ry = $pts[1];
+		    }
+		    else {
+			$rx = $pts[2];
+			$ry = $pts[3];
+		    }
+		    $width = abs($pts[4]-$pts[0])+1;
+		    $height = abs($pts[1]-$pts[3])+1;
+		    $prect->SetPos(new Rectangle($rx,$ry,$width,$height));
+		    $prect->Stroke($img);
+		}
+	    }
+	    // Stroke the outline of the bar
+	    if( is_array($this->color) )
+		$img->SetColor($this->color[$i % count($this->color)]);
+	    else
+		$img->SetColor($this->color);
+
+	    $pts[] = $pts[0];
+	    $pts[] = $pts[1];
+
+	    if( $this->weight > 0 ) {
+		$img->SetLineWeight($this->weight);
+		$img->Polygon($pts);
+	    }
+			
+	    // Determine how to best position the values of the individual bars
+	    $x=$pts[2]+($pts[4]-$pts[2])/2;
+	    if( $this->valuepos=='top' ) {
+		$y=$pts[3];
+		if( $img->a === 90 ) {
+		    if( $val < 0 )
+			$this->value->SetAlign('right','center');			
+		    else
+			$this->value->SetAlign('left','center');
+			
+		}
+		$this->value->Stroke($img,$val,$x,$y);
+	    }
+	    elseif( $this->valuepos=='max' ) {
+		$y=$pts[3];
+		if( $img->a === 90 ) {
+		    if( $val < 0 )
+			$this->value->SetAlign('left','center');
+		    else
+			$this->value->SetAlign('right','center');		    
+		}
+		else {
+		    $this->value->SetAlign('center','top');
+		}
+		$this->value->SetMargin(-3);
+		$this->value->Stroke($img,$val,$x,$y);
+	    }
+	    elseif( $this->valuepos=='center' ) {
+		$y = ($pts[3] + $pts[1])/2;
+		$this->value->SetAlign('center','center');
+		$this->value->SetMargin(0);
+		$this->value->Stroke($img,$val,$x,$y);
+	    }
+	    elseif( $this->valuepos=='bottom' || $this->valuepos=='min' ) {
+		$y=$pts[1];
+		if( $img->a === 90 ) {
+		    if( $val < 0 )
+			$this->value->SetAlign('right','center');
+		    else
+			$this->value->SetAlign('left','center');		    		    
+		}
+		$this->value->SetMargin(3);
+		$this->value->Stroke($img,$val,$x,$y);
+	    }
+	    else {
+		JpGraphError::RaiseL(2006,$this->valuepos);
+//('Unknown position for values on bars :'.$this->valuepos);
+	    }
+	    // Create the client side image map
+	    $rpts = $img->ArrRotate($pts);		
+	    $csimcoord=round($rpts[0]).", ".round($rpts[1]);
+	    for( $j=1; $j < 4; ++$j){
+		$csimcoord .= ", ".round($rpts[2*$j]).", ".round($rpts[2*$j+1]);
+	    }	    	    
+	    if( !empty($this->csimtargets[$i]) ) {
+		$this->csimareas .= '<area shape="poly" coords="'.$csimcoord.'" ';    	    
+		$this->csimareas .= " href=\"".$this->csimtargets[$i]."\"";
+		$sval='';
+		if( !empty($this->csimalts[$i]) ) {
+		    $sval=sprintf($this->csimalts[$i],$this->coords[0][$i]);
+		    $this->csimareas .= " title=\"$sval\" ";
+		}
+		$this->csimareas .= " alt=\"$sval\" />\n";
+	    }
+	}
+	return true;
+    }
+} // Class
+
+//===================================================
+// CLASS GroupBarPlot
+// Description: Produce grouped bar plots
+//===================================================
+class GroupBarPlot extends BarPlot {
+    var $plots;
+    var $width=0.7;
+    var $nbrplots=0;
+    var $numpoints;
+//---------------
+// CONSTRUCTOR
+    function GroupBarPlot($plots) {
+	$this->plots = $plots;
+	$this->nbrplots = count($plots);
+	if( $this->nbrplots < 1 ) {
+	    JpGraphError::RaiseL(2007);//('Cannot create GroupBarPlot from empty plot array.');
+	}
+	for($i=0; $i < $this->nbrplots; ++$i ) {
+	    if( empty($this->plots[$i]) || !isset($this->plots[$i]) ) {
+		JpGraphError::RaiseL(2008,$i);//("Group bar plot element nbr $i is undefined or empty.");
+	    }
+	}
+	$this->numpoints = $plots[0]->numpoints;
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function Legend(&$graph) {
+	$n = count($this->plots);
+	for($i=0; $i < $n; ++$i) {
+	    $c = get_class($this->plots[$i]);
+	    if( !is_a($this->plots[$i],'BarPlot') ) {
+		JpGraphError::RaiseL(2009,$c);//('One of the objects submitted to GroupBar is not a BarPlot. Make sure that you create the Group Bar plot from an array of BarPlot or AccBarPlot objects. (Class = '.$c.')');
+	    }
+	    $this->plots[$i]->DoLegend($graph);
+	}
+    }
+	
+    function Min() {
+	list($xmin,$ymin) = $this->plots[0]->Min();
+	$n = count($this->plots);
+	for($i=0; $i < $n; ++$i) {
+	    list($xm,$ym) = $this->plots[$i]->Min();
+	    $xmin = max($xmin,$xm);
+	    $ymin = min($ymin,$ym);
+	}
+	return array($xmin,$ymin);		
+    }
+	
+    function Max() {
+	list($xmax,$ymax) = $this->plots[0]->Max();
+	$n = count($this->plots);
+	for($i=0; $i < $n; ++$i) {
+	    list($xm,$ym) = $this->plots[$i]->Max();
+	    $xmax = max($xmax,$xm);
+	    $ymax = max($ymax,$ym);
+	}
+	return array($xmax,$ymax);
+    }
+	
+    function GetCSIMareas() {
+	$n = count($this->plots);
+	$csimareas='';
+	for($i=0; $i < $n; ++$i) {
+	    $csimareas .= $this->plots[$i]->csimareas;
+	}
+	return $csimareas;
+    }
+	
+    // Stroke all the bars next to each other
+    function Stroke(&$img,&$xscale,&$yscale) { 
+	$tmp=$xscale->off;
+	$n = count($this->plots);
+	$subwidth = $this->width/$this->nbrplots ; 
+	for( $i=0; $i < $n; ++$i ) {
+	    $this->plots[$i]->ymin=$this->ybase;
+	    $this->plots[$i]->SetWidth($subwidth);
+	    
+	    // If the client have used SetTextTickInterval() then
+	    // major_step will be > 1 and the positioning will fail.
+	    // If we assume it is always one the positioning will work
+	    // fine with a text scale but this will not work with
+	    // arbitrary linear scale
+	    $xscale->off = $tmp+$i*round(/*$xscale->ticks->major_step* */
+					$xscale->scale_factor* $subwidth);
+	    $this->plots[$i]->Stroke($img,$xscale,$yscale);
+	}
+	$xscale->off=$tmp;
+    }
+} // Class
+
+//===================================================
+// CLASS AccBarPlot
+// Description: Produce accumulated bar plots
+//===================================================
+class AccBarPlot extends BarPlot {
+    var $plots=null,$nbrplots=0,$numpoints=0;
+//---------------
+// CONSTRUCTOR
+    function AccBarPlot($plots) {
+	$this->plots = $plots;
+	$this->nbrplots = count($plots);
+	if( $this->nbrplots < 1 ) {
+	    JpGraphError::RaiseL(2010);//('Cannot create AccBarPlot from empty plot array.');
+	}
+	for($i=0; $i < $this->nbrplots; ++$i ) {
+	    if( empty($this->plots[$i]) || !isset($this->plots[$i]) ) {
+		JpGraphError::RaiseL(2011,$i);//("Acc bar plot element nbr $i is undefined or empty.");
+	    }
+	}
+	$this->numpoints = $plots[0]->numpoints;		
+	$this->value = new DisplayValue();
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function Legend(&$graph) {
+	$n = count($this->plots);
+	for( $i=$n-1; $i >= 0; --$i ) {
+	    $c = get_class($this->plots[$i]);
+	    if( !is_a($this->plots[$i],'BarPlot') ) {
+		JpGraphError::RaiseL(2012,$c);//('One of the objects submitted to AccBar is not a BarPlot. Make sure that you create the AccBar plot from an array of BarPlot objects.(Class='.$c.')');
+	    }	    
+	    $this->plots[$i]->DoLegend($graph);
+	}
+    }
+
+    function Max() {
+	list($xmax) = $this->plots[0]->Max();
+	$nmax=0;
+	for($i=0; $i < count($this->plots); ++$i) {
+	    $n = count($this->plots[$i]->coords[0]);
+	    $nmax = max($nmax,$n);
+	    list($x) = $this->plots[$i]->Max();
+	    $xmax = max($xmax,$x);
+	}
+	for( $i = 0; $i < $nmax; $i++ ) {
+	    // Get y-value for bar $i by adding the
+	    // individual bars from all the plots added.
+	    // It would be wrong to just add the
+	    // individual plots max y-value since that
+	    // would in most cases give to large y-value.
+	    $y=0;
+	    if( !isset($this->plots[0]->coords[0][$i]) ) {
+		JpGraphError::RaiseL(2014);
+	    }
+	    if( $this->plots[0]->coords[0][$i] > 0 )
+		$y=$this->plots[0]->coords[0][$i];
+	    for( $j = 1; $j < $this->nbrplots; $j++ ) {
+		if( !isset($this->plots[$j]->coords[0][$i]) ) {
+		    JpGraphError::RaiseL(2014);
+		}
+		if( $this->plots[$j]->coords[0][$i] > 0 )
+		    $y += $this->plots[$j]->coords[0][$i];
+	    }
+	    $ymax[$i] = $y;
+	}
+	$ymax = max($ymax);
+
+	// Bar always start at baseline
+	if( $ymax <= $this->ybase ) 
+	    $ymax = $this->ybase;
+	return array($xmax,$ymax);
+    }
+
+    function Min() {
+	$nmax=0;
+	list($xmin,$ysetmin) = $this->plots[0]->Min();
+	for($i=0; $i < count($this->plots); ++$i) {
+	    $n = count($this->plots[$i]->coords[0]);
+	    $nmax = max($nmax,$n);
+	    list($x,$y) = $this->plots[$i]->Min();
+	    $xmin = Min($xmin,$x);
+	    $ysetmin = Min($y,$ysetmin);
+	}
+	for( $i = 0; $i < $nmax; $i++ ) {
+	    // Get y-value for bar $i by adding the
+	    // individual bars from all the plots added.
+	    // It would be wrong to just add the
+	    // individual plots max y-value since that
+	    // would in most cases give to large y-value.
+	    $y=0;
+	    if( $this->plots[0]->coords[0][$i] < 0 )
+		$y=$this->plots[0]->coords[0][$i];
+	    for( $j = 1; $j < $this->nbrplots; $j++ ) {
+		if( $this->plots[$j]->coords[0][$i] < 0 )
+		    $y += $this->plots[ $j ]->coords[0][$i];
+	    }
+	    $ymin[$i] = $y;
+	}
+	$ymin = Min($ysetmin,Min($ymin));
+	// Bar always start at baseline
+	if( $ymin >= $this->ybase )
+	    $ymin = $this->ybase;
+	return array($xmin,$ymin);
+    }
+
+    // Stroke acc bar plot
+    function Stroke(&$img,&$xscale,&$yscale) {
+	$pattern=NULL;
+	$img->SetLineWeight($this->weight);
+	for($i=0; $i < $this->numpoints-1; $i++) {
+	    $accy = 0;
+	    $accy_neg = 0; 
+	    for($j=0; $j < $this->nbrplots; ++$j ) {				
+		$img->SetColor($this->plots[$j]->color);
+
+		if ( $this->plots[$j]->coords[0][$i] >= 0) {
+		    $yt=$yscale->Translate($this->plots[$j]->coords[0][$i]+$accy);
+		    $accyt=$yscale->Translate($accy);
+		    $accy+=$this->plots[$j]->coords[0][$i];
+		}
+		else {
+		    //if ( $this->plots[$j]->coords[0][$i] < 0 || $accy_neg < 0 ) {
+		    $yt=$yscale->Translate($this->plots[$j]->coords[0][$i]+$accy_neg);
+		    $accyt=$yscale->Translate($accy_neg);
+		    $accy_neg+=$this->plots[$j]->coords[0][$i];
+		}				
+				
+		$xt=$xscale->Translate($i);
+
+		if( $this->abswidth > -1 )
+		    $abswidth=$this->abswidth;
+		else
+		    $abswidth=round($this->width*$xscale->scale_factor,0);
+		
+		$pts=array($xt,$accyt,$xt,$yt,$xt+$abswidth,$yt,$xt+$abswidth,$accyt);
+
+		if( $this->bar_shadow ) {
+		    $ssh = $this->bar_shadow_hsize;
+		    $ssv = $this->bar_shadow_vsize;
+		    
+		    // We must also differ if we are a positive or negative bar. 
+		    if( $j === 0 ) {
+			// This gets extra complicated since we have to
+			// see all plots to see if we are negative. It could
+			// for example be that all plots are 0 until the very
+			// last one. We therefore need to save the initial setup
+			// for both the negative and positive case
+
+			// In case the final bar is positive
+			$sp[0]=$pts[6]+1; $sp[1]=$pts[7];
+			$sp[2]=$pts[6]+$ssh; $sp[3]=$pts[7]-$ssv;
+
+			// In case the final bar is negative
+			$nsp[0]=$pts[0]; $nsp[1]=$pts[1];
+			$nsp[2]=$pts[0]+$ssh; $nsp[3]=$pts[1]-$ssv;
+			$nsp[4]=$pts[6]+$ssh; $nsp[5]=$pts[7]-$ssv;
+			$nsp[10]=$pts[6]+1; $nsp[11]=$pts[7];
+		    }
+
+		    if( $j === $this->nbrplots-1 ) {
+			// If this is the last plot of the bar and
+			// the total value is larger than 0 then we
+			// add the shadow.
+			if( is_array($this->bar_shadow_color) ) {
+			    $numcolors = count($this->bar_shadow_color);
+			    if( $numcolors == 0 ) {
+				JpGraphError::RaiseL(2013);//('You have specified an empty array for shadow colors in the bar plot.');
+			    }
+			    $img->PushColor($this->bar_shadow_color[$i % $numcolors]);
+			}
+			else {
+			    $img->PushColor($this->bar_shadow_color);
+			}
+
+			if( $accy > 0 ) {
+			    $sp[4]=$pts[4]+$ssh; $sp[5]=$pts[5]-$ssv;
+			    $sp[6]=$pts[2]+$ssh; $sp[7]=$pts[3]-$ssv;
+			    $sp[8]=$pts[2]; $sp[9]=$pts[3]-1;
+			    $sp[10]=$pts[4]+1; $sp[11]=$pts[5];
+			    $img->FilledPolygon($sp,4);
+			}
+			elseif( $accy_neg < 0 ) {
+			    $nsp[6]=$pts[4]+$ssh; $nsp[7]=$pts[5]-$ssv;
+			    $nsp[8]=$pts[4]+1; $nsp[9]=$pts[5];
+			    $img->FilledPolygon($nsp,4);
+			}
+			$img->PopColor();
+		    }
+		}
+
+
+		// If value is NULL or 0, then don't draw a bar at all
+		if ($this->plots[$j]->coords[0][$i] == 0 ) continue;
+
+		if( $this->plots[$j]->grad ) {
+		    $grad = new Gradient($img);
+		    $grad->FilledRectangle(
+			$pts[2],$pts[3],
+			$pts[6],$pts[7],
+			$this->plots[$j]->grad_fromcolor,
+			$this->plots[$j]->grad_tocolor,
+			$this->plots[$j]->grad_style);				
+		} else {
+		    if (is_array($this->plots[$j]->fill_color) ) {
+			$numcolors = count($this->plots[$j]->fill_color);
+			$img->SetColor($this->plots[$j]->fill_color[$i % $numcolors]);
+		    }
+		    else {
+			$img->SetColor($this->plots[$j]->fill_color);
+		    }
+		    $img->FilledPolygon($pts);
+		    $img->SetColor($this->plots[$j]->color);
+		}				  
+
+		// Stroke the pattern
+		if( $this->plots[$j]->iPattern > -1 ) {
+		    if( $pattern===NULL ) 
+			$pattern = new RectPatternFactory();
+		
+		    $prect = $pattern->Create($this->plots[$j]->iPattern,$this->plots[$j]->iPatternColor,1);
+		    $prect->SetDensity($this->plots[$j]->iPatternDensity);
+		    if( $this->plots[$j]->coords[0][$i] < 0 ) {
+			$rx = $pts[0];
+			$ry = $pts[1];
+		    }
+		    else {
+			$rx = $pts[2];
+			$ry = $pts[3];
+		    }
+		    $width = abs($pts[4]-$pts[0])+1;
+		    $height = abs($pts[1]-$pts[3])+1;
+		    $prect->SetPos(new Rectangle($rx,$ry,$width,$height));
+		    $prect->Stroke($img);
+		}
+
+
+		// CSIM array
+
+		if( $i < count($this->plots[$j]->csimtargets) ) {
+		    // Create the client side image map
+		    $rpts = $img->ArrRotate($pts);		
+		    $csimcoord=round($rpts[0]).", ".round($rpts[1]);
+		    for( $k=1; $k < 4; ++$k){
+			$csimcoord .= ", ".round($rpts[2*$k]).", ".round($rpts[2*$k+1]);
+		    }	    	    
+		    if( ! empty($this->plots[$j]->csimtargets[$i]) ) {
+			$this->csimareas.= '<area shape="poly" coords="'.$csimcoord.'" '; 
+			$this->csimareas.= " href=\"".$this->plots[$j]->csimtargets[$i]."\"";
+			if( !empty($this->plots[$j]->csimalts[$i]) ) {
+			    $sval=sprintf($this->plots[$j]->csimalts[$i],$this->plots[$j]->coords[0][$i]);
+			    $this->csimareas .= " title=\"$sval\" ";
+			}
+			$this->csimareas .= " alt=\"$sval\" />\n";				
+		    }
+		}
+
+		$pts[] = $pts[0];
+		$pts[] = $pts[1];
+		$img->Polygon($pts);
+	    }
+		
+	    // Draw labels for each acc.bar
+	
+	    $x=$pts[2]+($pts[4]-$pts[2])/2;
+	    if($this->bar_shadow) $x += $ssh;
+
+	    // First stroke the accumulated value for the entire bar
+	    // This value is always placed at the top/bottom of the bars
+	    if( $accy_neg < 0 ) {
+		$y=$yscale->Translate($accy_neg);			
+		$this->value->Stroke($img,$accy_neg,$x,$y);
+	    }
+	    else {
+		$y=$yscale->Translate($accy);			
+		$this->value->Stroke($img,$accy,$x,$y);
+	    }
+
+	    $accy = 0;
+	    $accy_neg = 0; 
+	    for($j=0; $j < $this->nbrplots; ++$j ) {	
+
+		// We don't print 0 values in an accumulated bar plot
+		if( $this->plots[$j]->coords[0][$i] == 0 ) continue;
+			
+		if ($this->plots[$j]->coords[0][$i] > 0) {
+		    $yt=$yscale->Translate($this->plots[$j]->coords[0][$i]+$accy);
+		    $accyt=$yscale->Translate($accy);
+		    if(  $this->plots[$j]->valuepos=='center' ) {
+			$y = $accyt-($accyt-$yt)/2;
+		    }
+		    elseif( $this->plots[$j]->valuepos=='bottom' ) {
+			$y = $accyt;
+		    }
+		    else { // top or max
+			$y = $accyt-($accyt-$yt);
+		    }
+		    $accy+=$this->plots[$j]->coords[0][$i];
+		    if(  $this->plots[$j]->valuepos=='center' ) {
+			$this->plots[$j]->value->SetAlign("center","center");
+			$this->plots[$j]->value->SetMargin(0);
+		    }
+		    elseif( $this->plots[$j]->valuepos=='bottom' ) {
+			$this->plots[$j]->value->SetAlign('center','bottom');
+			$this->plots[$j]->value->SetMargin(2);
+		    }
+		    else {
+			$this->plots[$j]->value->SetAlign('center','top');
+			$this->plots[$j]->value->SetMargin(1);
+		    }
+		} else {
+		    $yt=$yscale->Translate($this->plots[$j]->coords[0][$i]+$accy_neg);
+		    $accyt=$yscale->Translate($accy_neg);
+		    $accy_neg+=$this->plots[$j]->coords[0][$i];
+		    if(  $this->plots[$j]->valuepos=='center' ) {
+			$y = $accyt-($accyt-$yt)/2;
+		    }
+		    elseif( $this->plots[$j]->valuepos=='bottom' ) {
+			$y = $accyt;
+		    }
+		    else {
+			$y = $accyt-($accyt-$yt);
+		    }
+		    if(  $this->plots[$j]->valuepos=='center' ) {
+			$this->plots[$j]->value->SetAlign("center","center");
+			$this->plots[$j]->value->SetMargin(0);
+		    }
+		    elseif( $this->plots[$j]->valuepos=='bottom' ) {
+			$this->plots[$j]->value->SetAlign('center',$j==0 ? 'bottom':'top');
+			$this->plots[$j]->value->SetMargin(-2);
+		    }
+		    else {
+			$this->plots[$j]->value->SetAlign('center','bottom');
+			$this->plots[$j]->value->SetMargin(-1);
+		    }
+		}	
+		$this->plots[$j]->value->Stroke($img,$this->plots[$j]->coords[0][$i],$x,$y);
+	    }
+
+	}
+	return true;
+    }
+} // Class
+
+/* EOF */
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_canvas.php php-syslog-ng/html/includes/jpgraph/jpgraph_canvas.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_canvas.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_canvas.php	2006-01-26 02:44:33.000000000 -0500
@@ -0,0 +1,77 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_CANVAS.PHP
+// Description:	Canvas drawing extension for JpGraph
+// Created: 	2001-01-08
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_canvas.php 418 2006-01-26 07:44:33Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+//===================================================
+// CLASS CanvasGraph
+// Description: Creates a simple canvas graph which
+// might be used together with the basic Image drawing
+// primitives. Useful to auickoly produce some arbitrary
+// graphic which benefits from all the functionality in the
+// graph liek caching for example. 
+//===================================================
+class CanvasGraph extends Graph {
+//---------------
+// CONSTRUCTOR
+    function CanvasGraph($aWidth=300,$aHeight=200,$aCachedName="",$timeout=0,$inline=1) {
+	$this->Graph($aWidth,$aHeight,$aCachedName,$timeout,$inline);
+    }
+
+//---------------
+// PUBLIC METHODS	
+
+    function InitFrame() {
+	$this->StrokePlotArea();
+    }
+
+    // Method description
+    function Stroke($aStrokeFileName="") {
+	if( $this->texts != null ) {
+	    for($i=0; $i < count($this->texts); ++$i) {
+		$this->texts[$i]->Stroke($this->img);
+	    }
+	}		
+	if( $this->iTables !== null ) {
+	    for($i=0; $i < count($this->iTables); ++$i) {
+		$this->iTables[$i]->Stroke($this->img);
+	    }   
+	}
+	$this->StrokeTitles();
+
+	// Should we do any final image transformation
+	if( $this->iImgTrans ) {
+	    if( !class_exists('ImgTrans') ) {
+		require_once('jpgraph_imgtrans.php');
+	    }
+	    
+	    $tform = new ImgTrans($this->img->img);
+	    $this->img->img = $tform->Skew3D($this->iImgTransHorizon,$this->iImgTransSkewDist,
+					     $this->iImgTransDirection,$this->iImgTransHighQ,
+					     $this->iImgTransMinSize,$this->iImgTransFillColor,
+					     $this->iImgTransBorder);
+	}
+	
+
+	// If the filename is given as the special _IMG_HANDLER
+	// then the image handler is returned and the image is NOT
+	// streamed back
+	if( $aStrokeFileName == _IMG_HANDLER ) {
+	    return $this->img->img;
+	}
+	else {
+	    // Finally stream the generated picture					
+	    $this->cache->PutAndStream($this->img,$this->cache_name,$this->inline,$aStrokeFileName);
+	    return true;
+	}
+    }
+} // Class
+/* EOF */
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_canvtools.php php-syslog-ng/html/includes/jpgraph/jpgraph_canvtools.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_canvtools.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_canvtools.php	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,516 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_CANVTOOLS.PHP
+// Description:	Some utilities for text and shape drawing on a canvas
+// Created: 	2002-08-23
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_canvtools.php 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+DEFINE('CORNER_TOPLEFT',0);
+DEFINE('CORNER_TOPRIGHT',1);
+DEFINE('CORNER_BOTTOMRIGHT',2);
+DEFINE('CORNER_BOTTOMLEFT',3);
+
+
+//===================================================
+// CLASS CanvasScale
+// Description: Define a scale for canvas so we
+// can abstract away with absolute pixels
+//===================================================
+ 
+class CanvasScale {
+    var $g;
+    var $w,$h;
+    var $ixmin=0,$ixmax=10,$iymin=0,$iymax=10;
+
+    function CanvasScale(&$graph,$xmin=0,$xmax=10,$ymin=0,$ymax=10) {
+	$this->g = &$graph;
+	$this->w = $graph->img->width;
+	$this->h = $graph->img->height;
+	$this->ixmin = $xmin;
+	$this->ixmax = $xmax;
+	$this->iymin = $ymin;
+	$this->iymax = $ymax;
+    }
+    
+    function Set($xmin=0,$xmax=10,$ymin=0,$ymax=10) {
+	$this->ixmin = $xmin;
+	$this->ixmax = $xmax;
+	$this->iymin = $ymin;
+	$this->iymax = $ymax;
+    }
+
+    function Translate($x,$y) {
+	$xp = round(($x-$this->ixmin)/($this->ixmax - $this->ixmin) * $this->w);
+	$yp = round(($y-$this->iymin)/($this->iymax - $this->iymin) * $this->h);
+	return array($xp,$yp);
+    }
+
+    function TranslateX($x) {
+	$xp = round(($x-$this->ixmin)/($this->ixmax - $this->ixmin) * $this->w);
+	return $xp;
+    }
+
+    function TranslateY($y) {
+	$yp = round(($y-$this->iymin)/($this->iymax - $this->iymin) * $this->h);
+	return $yp;
+    }
+
+}
+
+
+//===================================================
+// CLASS Shape
+// Description: Methods to draw shapes on canvas
+//===================================================
+class Shape {
+    var $img,$scale;
+
+    function Shape(&$aGraph,&$scale) {
+	$this->img = &$aGraph->img;
+	$this->img->SetColor('black');
+	$this->scale = &$scale;
+    }
+
+    function SetColor($aColor) {
+	$this->img->SetColor($aColor);
+    }
+
+    function Line($x1,$y1,$x2,$y2) {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	list($x2,$y2) = $this->scale->Translate($x2,$y2);
+	$this->img->Line($x1,$y1,$x2,$y2);
+    }
+
+    function Polygon($p,$aClosed=false) {
+	$n=count($p);
+	for($i=0; $i < $n; $i+=2 ) {
+	   $p[$i]   = $this->scale->TranslateX($p[$i]);
+	   $p[$i+1] = $this->scale->TranslateY($p[$i+1]);
+	}
+	$this->img->Polygon($p,$aClosed);
+    }
+
+    function FilledPolygon($p) {
+	$n=count($p);
+	for($i=0; $i < $n; $i+=2 ) {
+	   $p[$i]   = $this->scale->TranslateX($p[$i]);
+	   $p[$i+1] = $this->scale->TranslateY($p[$i+1]);
+	}
+	$this->img->FilledPolygon($p);
+    }
+    
+
+    // Draw a bezier curve with defining points in the $aPnts array
+    // using $aSteps steps.
+    // 0=x0, 1=y0
+    // 2=x1, 3=y1
+    // 4=x2, 5=y2
+    // 6=x3, 7=y3
+    function Bezier($p,$aSteps=40) {
+	$x0 = $p[0];
+	$y0 = $p[1];
+	// Calculate coefficients
+	$cx = 3*($p[2]-$p[0]);
+	$bx = 3*($p[4]-$p[2])-$cx;
+	$ax = $p[6]-$p[0]-$cx-$bx;
+	$cy = 3*($p[3]-$p[1]);
+	$by = 3*($p[5]-$p[3])-$cy;
+	$ay = $p[7]-$p[1]-$cy-$by;
+
+	// Step size
+	$delta = 1.0/$aSteps;
+
+	$x_old = $x0;
+	$y_old = $y0;
+	for($t=$delta; $t<=1.0; $t+=$delta) {
+	    $tt = $t*$t; $ttt=$tt*$t;
+	    $x  = $ax*$ttt + $bx*$tt + $cx*$t + $x0;
+	    $y = $ay*$ttt + $by*$tt + $cy*$t + $y0;
+	    $this->Line($x_old,$y_old,$x,$y);
+	    $x_old = $x;
+	    $y_old = $y;
+	}
+	$this->Line($x_old,$y_old,$p[6],$p[7]);
+    }
+
+    function Rectangle($x1,$y1,$x2,$y2) {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	list($x2,$y2)   = $this->scale->Translate($x2,$y2);
+	$this->img->Rectangle($x1,$y1,$x2,$y2);
+    }
+
+    function FilledRectangle($x1,$y1,$x2,$y2) {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	list($x2,$y2)   = $this->scale->Translate($x2,$y2);
+	$this->img->FilledRectangle($x1,$y1,$x2,$y2);
+    }
+    
+    function Circle($x1,$y1,$r) {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	if( $r >= 0 )
+	    $r   = $this->scale->TranslateX($r);
+	else
+	    $r = -$r;
+	$this->img->Circle($x1,$y1,$r);
+    }
+
+    function FilledCircle($x1,$y1,$r) {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	if( $r >= 0 )
+	    $r   = $this->scale->TranslateX($r);
+	else
+	    $r = -$r;
+	$this->img->FilledCircle($x1,$y1,$r);
+    }
+
+    function RoundedRectangle($x1,$y1,$x2,$y2,$r=null) {    
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	list($x2,$y2)   = $this->scale->Translate($x2,$y2);
+
+	if( $r == null )
+	    $r = 5;
+	elseif( $r >= 0 )
+	    $r = $this->scale->TranslateX($r);
+	else
+	    $r = -$r;
+	$this->img->RoundedRectangle($x1,$y1,$x2,$y2,$r);
+    }
+
+    function FilledRoundedRectangle($x1,$y1,$x2,$y2,$r=null) {    
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	list($x2,$y2)   = $this->scale->Translate($x2,$y2);
+
+	if( $r == null )
+	    $r = 5;
+	elseif( $r > 0 )
+	    $r = $this->scale->TranslateX($r);
+	else
+	    $r = -$r;
+	$this->img->FilledRoundedRectangle($x1,$y1,$x2,$y2,$r);    
+    }
+
+    function ShadowRectangle($x1,$y1,$x2,$y2,$fcolor=false,$shadow_width=null,$shadow_color=array(102,102,102)) {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	list($x2,$y2) = $this->scale->Translate($x2,$y2);
+	if( $shadow_width == null ) 
+	    $shadow_width=4;
+	else
+	    $shadow_width=$this->scale->TranslateX($shadow_width);
+	$this->img->ShadowRectangle($x1,$y1,$x2,$y2,$fcolor,$shadow_width,$shadow_color);
+    }
+
+    function SetTextAlign($halign,$valign="bottom") {
+	$this->img->SetTextAlign($halign,$valign="bottom");
+    }
+
+    function StrokeText($x1,$y1,$txt,$dir=0,$paragraph_align="left") {
+	list($x1,$y1) = $this->scale->Translate($x1,$y1);
+	$this->img->StrokeText($x1,$y1,$txt,$dir,$paragraph_align);
+    }
+
+    // A rounded rectangle where one of the corner has been moved "into" the
+    // rectangle 'iw' width and 'ih' height. Corners:
+    // 0=Top left, 1=top right, 2=bottom right, 3=bottom left
+    function IndentedRectangle($xt,$yt,$w,$h,$iw=0,$ih=0,$aCorner=3,$aFillColor="",$r=4) {
+    
+	list($xt,$yt) = $this->scale->Translate($xt,$yt);
+	list($w,$h)   = $this->scale->Translate($w,$h);
+	list($iw,$ih) = $this->scale->Translate($iw,$ih);
+	
+	$xr = $xt + $w - 0;
+	$yl = $yt + $h - 0;
+
+	switch( $aCorner ) {
+	    case 0: // Upper left
+	    
+		// Bottom line, left &  right arc
+		$this->img->Line($xt+$r,$yl,$xr-$r,$yl);
+		$this->img->Arc($xt+$r,$yl-$r,$r*2,$r*2,90,180);
+		$this->img->Arc($xr-$r,$yl-$r,$r*2,$r*2,0,90);
+
+		// Right line, Top right arc
+		$this->img->Line($xr,$yt+$r,$xr,$yl-$r);
+		$this->img->Arc($xr-$r,$yt+$r,$r*2,$r*2,270,360);
+
+		// Top line, Top left arc
+		$this->img->Line($xt+$iw+$r,$yt,$xr-$r,$yt);
+		$this->img->Arc($xt+$iw+$r,$yt+$r,$r*2,$r*2,180,270);
+
+		// Left line
+		$this->img->Line($xt,$yt+$ih+$r,$xt,$yl-$r);
+
+		// Indent horizontal, Lower left arc
+		$this->img->Line($xt+$r,$yt+$ih,$xt+$iw-$r,$yt+$ih);
+		$this->img->Arc($xt+$r,$yt+$ih+$r,$r*2,$r*2,180,270);
+
+		// Indent vertical, Indent arc
+		$this->img->Line($xt+$iw,$yt+$r,$xt+$iw,$yt+$ih-$r);
+		$this->img->Arc($xt+$iw-$r,$yt+$ih-$r,$r*2,$r*2,0,90);
+
+		if( $aFillColor != '' ) {
+		    $bc = $this->img->current_color_name;
+		    $this->img->PushColor($aFillColor);
+		    $this->img->FillToBorder($xr-$r,$yl-$r,$bc);
+		    $this->img->PopColor();
+		}
+
+		break;
+
+	    case 1: // Upper right
+
+		// Bottom line, left &  right arc
+		$this->img->Line($xt+$r,$yl,$xr-$r,$yl);
+		$this->img->Arc($xt+$r,$yl-$r,$r*2,$r*2,90,180);
+		$this->img->Arc($xr-$r,$yl-$r,$r*2,$r*2,0,90);
+
+		// Left line, Top left arc
+		$this->img->Line($xt,$yt+$r,$xt,$yl-$r);
+		$this->img->Arc($xt+$r,$yt+$r,$r*2,$r*2,180,270);
+
+		// Top line, Top right arc
+		$this->img->Line($xt+$r,$yt,$xr-$iw-$r,$yt);
+		$this->img->Arc($xr-$iw-$r,$yt+$r,$r*2,$r*2,270,360);
+
+		// Right line
+		$this->img->Line($xr,$yt+$ih+$r,$xr,$yl-$r);
+
+		// Indent horizontal, Lower right arc
+		$this->img->Line($xr-$iw+$r,$yt+$ih,$xr-$r,$yt+$ih);
+		$this->img->Arc($xr-$r,$yt+$ih+$r,$r*2,$r*2,270,360);
+
+		// Indent vertical, Indent arc
+		$this->img->Line($xr-$iw,$yt+$r,$xr-$iw,$yt+$ih-$r);
+		$this->img->Arc($xr-$iw+$r,$yt+$ih-$r,$r*2,$r*2,90,180);
+
+		if( $aFillColor != '' ) {
+		    $bc = $this->img->current_color_name;
+		    $this->img->PushColor($aFillColor);
+		    $this->img->FillToBorder($xt+$r,$yl-$r,$bc);
+		    $this->img->PopColor();
+		}
+
+		break;
+
+	    case 2: // Lower right
+		// Top line, Top left & Top right arc
+		$this->img->Line($xt+$r,$yt,$xr-$r,$yt);
+		$this->img->Arc($xt+$r,$yt+$r,$r*2,$r*2,180,270);
+		$this->img->Arc($xr-$r,$yt+$r,$r*2,$r*2,270,360);
+
+		// Left line, Bottom left arc
+		$this->img->Line($xt,$yt+$r,$xt,$yl-$r);
+		$this->img->Arc($xt+$r,$yl-$r,$r*2,$r*2,90,180);
+
+		// Bottom line, Bottom right arc
+		$this->img->Line($xt+$r,$yl,$xr-$iw-$r,$yl);
+		$this->img->Arc($xr-$iw-$r,$yl-$r,$r*2,$r*2,0,90);
+
+		// Right line
+		$this->img->Line($xr,$yt+$r,$xr,$yl-$ih-$r);
+	    
+		// Indent horizontal, Lower right arc
+		$this->img->Line($xr-$r,$yl-$ih,$xr-$iw+$r,$yl-$ih);
+		$this->img->Arc($xr-$r,$yl-$ih-$r,$r*2,$r*2,0,90);
+
+		// Indent vertical, Indent arc
+		$this->img->Line($xr-$iw,$yl-$r,$xr-$iw,$yl-$ih+$r);
+		$this->img->Arc($xr-$iw+$r,$yl-$ih+$r,$r*2,$r*2,180,270);
+
+		if( $aFillColor != '' ) {
+		    $bc = $this->img->current_color_name;
+		    $this->img->PushColor($aFillColor);
+		    $this->img->FillToBorder($xt+$r,$yt+$r,$bc);
+		    $this->img->PopColor();
+		}
+
+		break;
+
+	    case 3: // Lower left
+		// Top line, Top left & Top right arc
+		$this->img->Line($xt+$r,$yt,$xr-$r,$yt);
+		$this->img->Arc($xt+$r,$yt+$r,$r*2,$r*2,180,270);
+		$this->img->Arc($xr-$r,$yt+$r,$r*2,$r*2,270,360);
+
+		// Right line, Bottom right arc
+		$this->img->Line($xr,$yt+$r,$xr,$yl-$r);
+		$this->img->Arc($xr-$r,$yl-$r,$r*2,$r*2,0,90);
+
+		// Bottom line, Bottom left arc
+		$this->img->Line($xt+$iw+$r,$yl,$xr-$r,$yl);
+		$this->img->Arc($xt+$iw+$r,$yl-$r,$r*2,$r*2,90,180);
+
+		// Left line
+		$this->img->Line($xt,$yt+$r,$xt,$yl-$ih-$r);
+	    
+		// Indent horizontal, Lower left arc
+		$this->img->Line($xt+$r,$yl-$ih,$xt+$iw-$r,$yl-$ih);
+		$this->img->Arc($xt+$r,$yl-$ih-$r,$r*2,$r*2,90,180);
+
+		// Indent vertical, Indent arc
+		$this->img->Line($xt+$iw,$yl-$ih+$r,$xt+$iw,$yl-$r);
+		$this->img->Arc($xt+$iw-$r,$yl-$ih+$r,$r*2,$r*2,270,360);
+
+		if( $aFillColor != '' ) {
+		    $bc = $this->img->current_color_name;
+		    $this->img->PushColor($aFillColor);
+		    $this->img->FillToBorder($xr-$r,$yt+$r,$bc);
+		    $this->img->PopColor();
+		}
+
+		break;
+	}
+    }
+}
+
+
+//===================================================
+// CLASS RectangleText
+// Description: Draws a text paragraph inside a 
+// rounded, possible filled, rectangle.
+//===================================================
+class CanvasRectangleText {
+    var $ix,$iy,$iw,$ih,$ir=4;
+    var $iTxt,$iColor='black',$iFillColor='',$iFontColor='black';
+    var $iParaAlign='center';
+    var $iAutoBoxMargin=5;
+    var $iShadowWidth=3,$iShadowColor='';
+
+    function CanvasRectangleText($aTxt='',$xl=0,$yt=0,$w=0,$h=0) {
+	$this->iTxt = new Text($aTxt);
+	$this->ix = $xl;
+	$this->iy = $yt;
+	$this->iw = $w;
+	$this->ih = $h;
+    }
+ 
+    function SetShadow($aColor='gray',$aWidth=3) {
+	$this->iShadowColor = $aColor;
+	$this->iShadowWidth = $aWidth;
+    }
+
+    function SetFont($FontFam,$aFontStyle,$aFontSize=12) {
+	$this->iTxt->SetFont($FontFam,$aFontStyle,$aFontSize);
+    }
+
+    function SetTxt($aTxt) {
+	$this->iTxt->Set($aTxt);
+    }
+
+    function ParagraphAlign($aParaAlign) {
+	$this->iParaAlign = $aParaAlign;
+    }
+
+    function SetFillColor($aFillColor) {
+	$this->iFillColor = $aFillColor;
+    }
+
+    function SetAutoMargin($aMargin) {
+	$this->iAutoBoxMargin=$aMargin;
+    }
+
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+
+    function SetFontColor($aColor) {
+	$this->iFontColor = $aColor;
+    }
+
+    function SetPos($xl=0,$yt=0,$w=0,$h=0) {
+	$this->ix = $xl;
+	$this->iy = $yt;
+	$this->iw = $w;
+	$this->ih = $h;
+    }
+
+    function Pos($xl=0,$yt=0,$w=0,$h=0) {
+	$this->ix = $xl;
+	$this->iy = $yt;
+	$this->iw = $w;
+	$this->ih = $h;
+    }
+
+    function Set($aTxt,$xl,$yt,$w=0,$h=0) {
+	$this->iTxt->Set($aTxt);
+	$this->ix = $xl;
+	$this->iy = $yt;
+	$this->iw = $w;
+	$this->ih = $h;
+    }
+
+    function SetCornerRadius($aRad=5) {
+	$this->ir = $aRad;
+    }
+
+    function Stroke($aImg,$scale) {
+	
+	// If coordinates are specifed as negative this means we should
+	// treat them as abolsute (pixels) coordinates
+	if( $this->ix > 0 ) {
+	    $this->ix = $scale->TranslateX($this->ix) ;
+	}
+	else {
+	    $this->ix = -$this->ix;
+	}
+
+	if( $this->iy > 0 ) {
+	    $this->iy = $scale->TranslateY($this->iy) ;
+	}
+	else {
+	    $this->iy = -$this->iy;
+	}
+	    
+	list($this->iw,$this->ih) = $scale->Translate($this->iw,$this->ih) ;
+
+	if( $this->iw == 0 ) 
+	    $this->iw = round($this->iTxt->GetWidth($aImg) + $this->iAutoBoxMargin);
+	if( $this->ih == 0 ) {
+	    $this->ih = round($this->iTxt->GetTextHeight($aImg) + $this->iAutoBoxMargin);
+	}
+
+	if( $this->iShadowColor != '' ) {
+	    $aImg->PushColor($this->iShadowColor);
+	    $aImg->FilledRoundedRectangle($this->ix+$this->iShadowWidth,
+					  $this->iy+$this->iShadowWidth,
+					  $this->ix+$this->iw-1+$this->iShadowWidth,
+					  $this->iy+$this->ih-1+$this->iShadowWidth,
+					  $this->ir);
+	    $aImg->PopColor();	    
+	}
+
+	if( $this->iFillColor != '' ) {
+	    $aImg->PushColor($this->iFillColor);
+	    $aImg->FilledRoundedRectangle($this->ix,$this->iy,
+					  $this->ix+$this->iw-1,
+					  $this->iy+$this->ih-1,
+					  $this->ir);
+	    $aImg->PopColor();
+	}
+
+	if( $this->iColor != '' ) {
+	    $aImg->PushColor($this->iColor);
+	    $aImg->RoundedRectangle($this->ix,$this->iy,
+				    $this->ix+$this->iw-1,
+				    $this->iy+$this->ih-1,
+				    $this->ir);
+	    $aImg->PopColor();
+	}
+	
+	$this->iTxt->Align('center','center');
+	$this->iTxt->ParagraphAlign($this->iParaAlign);
+	$this->iTxt->SetColor($this->iFontColor);
+	$this->iTxt->Stroke($aImg, $this->ix+$this->iw/2, $this->iy+$this->ih/2);
+
+	return array($this->iw, $this->ih);
+
+    }
+
+}
+
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_date.php php-syslog-ng/html/includes/jpgraph/jpgraph_date.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_date.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_date.php	2006-02-04 07:11:41.000000000 -0500
@@ -0,0 +1,492 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_DATE.PHP
+// Description:	Classes to handle Date scaling
+// Created: 	2005-05-02
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_date.php 469 2006-02-04 12:11:41Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+DEFINE('HOURADJ_1',0+30);
+DEFINE('HOURADJ_2',1+30);
+DEFINE('HOURADJ_3',2+30);
+DEFINE('HOURADJ_4',3+30);
+DEFINE('HOURADJ_6',4+30);
+DEFINE('HOURADJ_12',5+30);
+
+DEFINE('MINADJ_1',0+20);
+DEFINE('MINADJ_5',1+20);
+DEFINE('MINADJ_10',2+20);
+DEFINE('MINADJ_15',3+20);
+DEFINE('MINADJ_30',4+20);
+
+DEFINE('SECADJ_1',0);
+DEFINE('SECADJ_5',1);
+DEFINE('SECADJ_10',2);
+DEFINE('SECADJ_15',3);
+DEFINE('SECADJ_30',4);
+
+
+DEFINE('YEARADJ_1',0+30);
+DEFINE('YEARADJ_2',1+30);
+DEFINE('YEARADJ_5',2+30);
+
+DEFINE('MONTHADJ_1',0+20);
+DEFINE('MONTHADJ_6',1+20);
+
+DEFINE('DAYADJ_1',0);
+DEFINE('DAYADJ_WEEK',1);
+DEFINE('DAYADJ_7',1);
+
+DEFINE('SECPERYEAR',31536000);
+DEFINE('SECPERDAY',86400);
+DEFINE('SECPERHOUR',3600);
+DEFINE('SECPERMIN',60);
+
+
+class DateScale extends LinearScale {
+    var $date_format = '';
+    var $iStartAlign = false, $iEndAlign = false;
+    var $iStartTimeAlign = false, $iEndTimeAlign = false;
+
+//---------------
+// CONSTRUCTOR
+    function DateScale($aMin=0,$aMax=0,$aType='x') {
+	assert($aType=="x");
+	assert($aMin<=$aMax);
+		
+	$this->type=$aType;
+	$this->scale=array($aMin,$aMax);		
+	$this->world_size=$aMax-$aMin;	
+	$this->ticks = new LinearTicks();
+	$this->intscale=true;
+    }
+
+
+//------------------------------------------------------------------------------------------
+// Utility Function AdjDate()
+// Description: Will round a given time stamp to an even year, month or day 
+// argument. 
+//------------------------------------------------------------------------------------------
+
+    function AdjDate($aTime,$aRound=0,$aYearType=false,$aMonthType=false,$aDayType=false) {
+	$y = (int)date('Y',$aTime); $m = (int)date('m',$aTime); $d = (int)date('d',$aTime);
+	$h=0;$i=0;$s=0;
+	if( $aYearType !== false ) {
+	    $yearAdj = array(0=>1, 1=>2, 2=>5);
+	    if( $aRound == 0 ) {
+		$y = floor($y/$yearAdj[$aYearType])*$yearAdj[$aYearType];
+	    }
+	    else {
+		++$y;
+		$y = ceil($y/$yearAdj[$aYearType])*$yearAdj[$aYearType];
+	    }
+	    $m=1;$d=1;
+	}
+	elseif( $aMonthType !== false ) {
+	    $monthAdj = array(0=>1, 1=>6);
+	    if( $aRound == 0 ) {
+		$m = floor($m/$monthAdj[$aMonthType])*$monthAdj[$aMonthType];
+		$d=1;
+	    }
+	    else {
+		++$m;
+		$m = ceil($m/$monthAdj[$aMonthType])*$monthAdj[$aMonthType];
+		$d=1;
+	    }
+	}
+	elseif( $aDayType !== false ) {
+	    if( $aDayType == 0 ) {
+		if( $aRound == 1 ) {
+		    //++$d;
+		    $h=23;$i=59;$s=59;
+		}
+	    }
+	    else {
+		// Adjust to an even week boundary. 
+		$w = (int)date('w',$aTime); // Day of week 0=Sun, 6=Sat
+		if( true ) { // Adjust to start on Mon
+		    if( $w==0 ) $w=6;
+		    else --$w;
+		}
+		if( $aRound == 0 ) {
+		    $d -= $w;
+		}
+		else {
+		    $d += (7-$w);
+		    $h=23;$i=59;$s=59;
+		}
+	    }
+	}
+	return mktime($h,$i,$s,$m,$d,$y);
+	
+    }
+
+//------------------------------------------------------------------------------------------
+// Wrapper for AdjDate that will round a timestamp to an even date rounding
+// it downwards.
+//------------------------------------------------------------------------------------------
+    function AdjStartDate($aTime,$aYearType=false,$aMonthType=false,$aDayType=false) {
+	return $this->AdjDate($aTime,0,$aYearType,$aMonthType,$aDayType);
+    }
+
+//------------------------------------------------------------------------------------------
+// Wrapper for AdjDate that will round a timestamp to an even date rounding
+// it upwards
+//------------------------------------------------------------------------------------------
+    function AdjEndDate($aTime,$aYearType=false,$aMonthType=false,$aDayType=false) {
+	return $this->AdjDate($aTime,1,$aYearType,$aMonthType,$aDayType);
+    }
+
+//------------------------------------------------------------------------------------------
+// Utility Function AdjTime()
+// Description: Will round a given time stamp to an even time according to 
+// argument. 
+//------------------------------------------------------------------------------------------
+
+    function AdjTime($aTime,$aRound=0,$aHourType=false,$aMinType=false,$aSecType=false) {
+	$y = (int)date('Y',$aTime); $m = (int)date('m',$aTime); $d = (int)date('d',$aTime);
+	$h = (int)date('H',$aTime); $i = (int)date('i',$aTime); $s = (int)date('s',$aTime);
+	if( $aHourType !== false ) {
+	    $aHourType %= 6;
+	    $hourAdj = array(0=>1, 1=>2, 2=>3, 3=>4, 4=>6, 5=>12);
+	    if( $aRound == 0 )
+		$h = floor($h/$hourAdj[$aHourType])*$hourAdj[$aHourType];
+	    else {
+		if( ($h % $hourAdj[$aHourType]==0) && ($i > 0 || $s > 0) ) {
+		    $h++;
+		}
+		$h = ceil($h/$hourAdj[$aHourType])*$hourAdj[$aHourType];
+		if( $h >= 24 ) {
+		    $aTime += 86400;
+		    $y = (int)date('Y',$aTime); $m = (int)date('m',$aTime); $d = (int)date('d',$aTime);
+		    $h -= 24; 
+		}
+	    }
+	    $i=0;$s=0;
+	}
+	elseif( $aMinType !== false ) {
+	    $aMinType %= 5;
+	    $minAdj = array(0=>1, 1=>5, 2=>10, 3=>15, 4=>30);
+	    if( $aRound == 0 ) {
+		$i = floor($i/$minAdj[$aMinType])*$minAdj[$aMinType];
+	    }
+	    else {
+		if( ($i % $minAdj[$aMinType]==0) && $s > 0 ) {
+		    $i++;
+		}
+		$i = ceil($i/$minAdj[$aMinType])*$minAdj[$aMinType];
+		if( $i >= 60) {
+		    $aTime += 3600;
+		    $y = (int)date('Y',$aTime); $m = (int)date('m',$aTime); $d = (int)date('d',$aTime);
+		    $h = (int)date('H',$aTime); $i = 0;
+		}
+	    }
+	    $s=0;
+	}
+	elseif( $aSecType !== false ) {
+	    $aSecType %= 5;
+	    $secAdj = array(0=>1, 1=>5, 2=>10, 3=>15, 4=>30);
+	    if( $aRound == 0 ) {
+		$s = floor($s/$secAdj[$aSecType])*$secAdj[$aSecType];
+	    }
+	    else {
+		$s = ceil($s/$secAdj[$aSecType]*1.0)*$secAdj[$aSecType];
+		if( $s >= 60) {
+		    $s=0;
+		    $aTime += 60;
+		    $y = (int)date('Y',$aTime); $m = (int)date('m',$aTime); $d = (int)date('d',$aTime);
+		    $h = (int)date('H',$aTime); $i = (int)date('i',$aTime); 
+		}
+	    }
+	}
+	return mktime($h,$i,$s,$m,$d,$y);
+    }
+
+//------------------------------------------------------------------------------------------
+// Wrapper for AdjTime that will round a timestamp to an even time rounding
+// it downwards.
+// Example: AdjStartTime(mktime(18,27,13,2,22,2005),false,2) => 18:20
+//------------------------------------------------------------------------------------------
+    function AdjStartTime($aTime,$aHourType=false,$aMinType=false,$aSecType=false) {
+	return $this->AdjTime($aTime,0,$aHourType,$aMinType,$aSecType);
+    }
+
+//------------------------------------------------------------------------------------------
+// Wrapper for AdjTime that will round a timestamp to an even time rounding
+// it upwards
+// Example: AdjEndTime(mktime(18,27,13,2,22,2005),false,2) => 18:30
+//------------------------------------------------------------------------------------------
+    function AdjEndTime($aTime,$aHourType=false,$aMinType=false,$aSecType=false) {
+	return $this->AdjTime($aTime,1,$aHourType,$aMinType,$aSecType);
+    }
+
+//------------------------------------------------------------------------------------------
+// DateAutoScale
+// Autoscale a date axis given start and end time
+// Returns an array ($start,$end,$major,$minor,$format)
+//------------------------------------------------------------------------------------------
+    function DoDateAutoScale($aStartTime,$aEndTime,$aDensity=0,$aAdjust=true) {
+	// Format of array
+	// array ( Decision point,  array( array( Major-scale-step-array ),  
+	//			    array( Minor-scale-step-array ), 
+	//			    array( 0=date-adjust, 1=time-adjust, adjustment-alignment) )
+	//
+	$scalePoints = 
+	    array(
+		/* Intervall larger than 10 years */
+		SECPERYEAR*10,array(array(SECPERYEAR*5,SECPERYEAR*2),
+				    array(SECPERYEAR), 
+				    array(0,YEARADJ_1, 0,YEARADJ_1) ),
+
+		/* Intervall larger than 2 years */
+		SECPERYEAR*2,array(array(SECPERYEAR),array(SECPERYEAR), 
+				   array(0,YEARADJ_1) ),
+
+		/* Intervall larger than 90 days (approx 3 month) */
+		SECPERDAY*90,array(array(SECPERDAY*30,SECPERDAY*14,SECPERDAY*7,SECPERDAY),
+				   array(SECPERDAY*5,SECPERDAY*7,SECPERDAY,SECPERDAY), 
+				   array(0,MONTHADJ_1, 0,DAYADJ_WEEK, 0,DAYADJ_1, 0,DAYADJ_1)),
+
+		/* Intervall larger than 30 days (approx 1 month) */
+		SECPERDAY*30,array(array(SECPERDAY*14,SECPERDAY*7,SECPERDAY*2, SECPERDAY),
+				   array(SECPERDAY,SECPERDAY.SECPERDAY,SECPERDAY), 
+				   array(0,DAYADJ_WEEK, 0,DAYADJ_1, 0,DAYADJ_1, 0,DAYADJ_1)),
+
+		/* Intervall larger than 7 days */
+		SECPERDAY*7,array(array(SECPERDAY,SECPERHOUR*12,SECPERHOUR*6,SECPERHOUR*2),
+				  array(SECPERHOUR*6,SECPERHOUR*3,SECPERHOUR,SECPERHOUR),
+				  array(0,DAYADJ_1, 1,HOURADJ_12, 1,HOURADJ_6, 1,HOURADJ_1)),
+
+		/* Intervall larger than 1 day */
+		SECPERDAY,array(array(SECPERDAY,SECPERHOUR*12,SECPERHOUR*6,SECPERHOUR*2,SECPERHOUR),
+				array(SECPERHOUR*6,SECPERHOUR*2,SECPERHOUR,SECPERHOUR,SECPERHOUR),
+				array(1,HOURADJ_12, 1,HOURADJ_6, 1,HOURADJ_1, 1,HOURADJ_1)),
+
+		/* Intervall larger than 12 hours */
+		SECPERHOUR*12,array(array(SECPERHOUR*2,SECPERHOUR,SECPERMIN*30,900,600),
+				    array(1800,1800,900,300,300),
+				    array(1,HOURADJ_1, 1,MINADJ_30, 1,MINADJ_15, 1,MINADJ_10, 1,MINADJ_5) ),
+
+		/* Intervall larger than 2 hours */
+		SECPERHOUR*2,array(array(SECPERHOUR,SECPERMIN*30,900,600,300),
+				   array(1800,900,300,120,60),
+				   array(1,HOURADJ_1, 1,MINADJ_30, 1,MINADJ_15, 1,MINADJ_10, 1,MINADJ_5) ),
+
+		/* Intervall larger than 1 hours */
+		SECPERHOUR,array(array(SECPERMIN*30,900,600,300),array(900,300,120,60),
+				 array(1,MINADJ_30, 1,MINADJ_15, 1,MINADJ_10, 1,MINADJ_5) ),
+
+		/* Intervall larger than 30 min */
+		SECPERMIN*30,array(array(SECPERMIN*15,SECPERMIN*10,SECPERMIN*5,SECPERMIN),
+				   array(300,300,60,10),
+				   array(1,MINADJ_15, 1,MINADJ_10, 1,MINADJ_5, 1,MINADJ_1)),
+
+		/* Intervall larger than 1 min */
+		SECPERMIN,array(array(SECPERMIN,15,10,5),
+				array(15,5,2,1),
+				array(1,MINADJ_1, 1,SECADJ_15, 1,SECADJ_10, 1,SECADJ_5)),
+
+		/* Intervall larger than 10 sec */
+		10,array(array(5,2),
+			 array(1,1),
+			 array(1,SECADJ_5, 1,SECADJ_1)),
+
+		/* Intervall larger than 1 sec */
+		1,array(array(1),
+			array(1),
+			array(1,SECADJ_1)),
+		);
+
+	$ns = count($scalePoints);
+	// Establish major and minor scale units for the date scale
+	$diff = $aEndTime - $aStartTime;
+	if( $diff < 1 ) return false;
+	$done=false;
+	$i=0;
+	while( ! $done ) {
+	    if( $diff > $scalePoints[2*$i] ) {
+		// Get major and minor scale for this intervall
+		$scaleSteps = $scalePoints[2*$i+1];
+		$major = $scaleSteps[0][min($aDensity,count($scaleSteps[0])-1)];
+		// Try to find out which minor step looks best
+		$minor = $scaleSteps[1][min($aDensity,count($scaleSteps[1])-1)];
+		if( $aAdjust ) {
+		    // Find out how we should align the start and end timestamps
+		    $idx = 2*min($aDensity,floor(count($scaleSteps[2])/2)-1);
+		    if( $scaleSteps[2][$idx] === 0 ) { 
+			// Use date adjustment
+			$adj = $scaleSteps[2][$idx+1]; 
+			if( $adj >= 30 ) {
+			    $start = $this->AdjStartDate($aStartTime,$adj-30);
+			    $end   = $this->AdjEndDate($aEndTime,$adj-30);
+			}
+			elseif( $adj >= 20 ) {
+			    $start = $this->AdjStartDate($aStartTime,false,$adj-20);
+			    $end   = $this->AdjEndDate($aEndTime,false,$adj-20);
+			}
+			else {
+			    $start = $this->AdjStartDate($aStartTime,false,false,$adj);
+			    $end   = $this->AdjEndDate($aEndTime,false,false,$adj);
+			    // We add 1 second for date adjustment to make sure we end on 00:00 the following day
+			    // This makes the final major tick be srawn when we step day-by-day instead of ending
+			    // on xx:59:59 which would not draw the final major tick
+			    $end++;	
+			}
+		    }
+		    else {
+			// Use time adjustment
+			$adj = $scaleSteps[2][$idx+1]; 
+			if( $adj >= 30 ) {
+			    $start = $this->AdjStartTime($aStartTime,$adj-30);
+			    $end   = $this->AdjEndTime($aEndTime,$adj-30);
+			}
+			elseif( $adj >= 20 ) {
+			    $start = $this->AdjStartTime($aStartTime,false,$adj-20);
+			    $end   = $this->AdjEndTime($aEndTime,false,$adj-20);
+			}
+			else {
+			    $start = $this->AdjStartTime($aStartTime,false,false,$adj);
+			    $end   = $this->AdjEndTime($aEndTime,false,false,$adj);		    
+			}
+		    }
+		}
+		// If the overall date span is larger than 1 day ten we show date
+		$format = '';
+		if( ($end-$start) > SECPERDAY ) {
+		    $format = 'Y-m-d ';
+		}
+		// If the major step is less than 1 day we need to whow hours + min
+		if( $major < SECPERDAY ) {
+		    $format .= 'H:i';
+		}
+		// If the major step is less than 1 min we need to show sec
+		if( $major < 60 ) {
+		    $format .= ':s';
+		}
+		$done=true;
+	    }
+	    ++$i;
+	}
+	return array($start,$end,$major,$minor,$format);
+    }
+
+    // Overrides the automatic determined date format. Must be a valid date() format string
+    function SetDateFormat($aFormat) {
+	$this->date_format = $aFormat;
+    }
+
+    function SetDateAlign($aStartAlign,$aEndAlign=false) {
+	if( $aEndAlign === false ) {
+	    $aEndAlign=$aStartAlign;
+	}
+	$this->iStartAlign = $aStartAlign;
+	$this->iEndAlign = $aEndAlign;
+    }
+
+    function SetTimeAlign($aStartAlign,$aEndAlign=false) {
+	if( $aEndAlign === false ) {
+	    $aEndAlign=$aStartAlign;
+	}
+	$this->iStartTimeAlign = $aStartAlign;
+	$this->iEndTimeAlign = $aEndAlign;
+    }
+
+
+    function AutoScale(&$img,$aStartTime,$aEndTime,$aNumSteps) {
+	if( $aStartTime == $aEndTime ) {
+	    // Special case when we only have one data point.
+	    // Create a small artifical intervall to do the autoscaling
+	    $aStartTime -= 10;
+	    $aEndTime += 10;
+	}
+	$done=false;
+	$i=0;
+	while( ! $done && $i < 5) {
+	    list($adjstart,$adjend,$maj,$min,$format) = $this->DoDateAutoScale($aStartTime,$aEndTime,$i);
+	    $n = floor(($adjend-$adjstart)/$maj);
+	    if( $n * 1.7 > $aNumSteps ) {
+		$done=true;
+	    }
+	    $i++;
+	}
+	
+	/*
+	if( 0 ) { // DEBUG
+	    echo "    Start =".date("Y-m-d H:i:s",$aStartTime)."<br>";
+	    echo "    End   =".date("Y-m-d H:i:s",$aEndTime)."<br>";
+	    echo "Adj Start =".date("Y-m-d H:i:s",$adjstart)."<br>";
+	    echo "Adj End   =".date("Y-m-d H:i:s",$adjend)."<p>";
+	    echo "Major = $maj s, ".floor($maj/60)."min, ".floor($maj/3600)."h, ".floor($maj/86400)."day<br>";
+	    echo "Min = $min s, ".floor($min/60)."min, ".floor($min/3600)."h, ".floor($min/86400)."day<br>";
+	    echo "Format=$format<p>";
+	}
+	*/
+	
+	if( $this->iStartTimeAlign !== false && $this->iStartAlign !== false ) {
+	    JpGraphError::RaiseL(3001);
+//('It is only possible to use either SetDateAlign() or SetTimeAlign() but not both');
+	}
+
+	if( $this->iStartTimeAlign !== false ) {
+	    if( $this->iStartTimeAlign >= 30 ) {
+		$adjstart = $this->AdjStartTime($aStartTime,$this->iStartTimeAlign-30);
+	    }
+	    elseif(  $this->iStartTimeAlign >= 20 ) {
+		$adjstart = $this->AdjStartTime($aStartTime,false,$this->iStartTimeAlign-20);
+	    }
+	    else {
+		$adjstart = $this->AdjStartTime($aStartTime,false,false,$this->iStartTimeAlign);
+	    }
+	}
+	if( $this->iEndTimeAlign !== false ) {
+	    if( $this->iEndTimeAlign >= 30 ) {
+		$adjend = $this->AdjEndTime($aEndTime,$this->iEndTimeAlign-30);
+	    }
+	    elseif(  $this->iEndTimeAlign >= 20 ) {
+		$adjend = $this->AdjEndTime($aEndTime,false,$this->iEndTimeAlign-20);
+	    }
+	    else {
+		$adjend = $this->AdjEndTime($aEndTime,false,false,$this->iEndTimeAlign);
+	    }
+	}
+
+
+	
+	if( $this->iStartAlign !== false ) {
+	    if( $this->iStartAlign >= 30 ) {
+		$adjstart = $this->AdjStartDate($aStartTime,$this->iStartAlign-30);
+	    }
+	    elseif(  $this->iStartAlign >= 20 ) {
+		$adjstart = $this->AdjStartDate($aStartTime,false,$this->iStartAlign-20);
+	    }
+	    else {
+		$adjstart = $this->AdjStartDate($aStartTime,false,false,$this->iStartAlign);
+	    }
+	}
+	if( $this->iEndAlign !== false ) {
+	    if( $this->iEndAlign >= 30 ) {
+		$adjend = $this->AdjEndDate($aEndTime,$this->iEndAlign-30);
+	    }
+	    elseif(  $this->iEndAlign >= 20 ) {
+		$adjend = $this->AdjEndDate($aEndTime,false,$this->iEndAlign-20);
+	    }
+	    else {
+		$adjend = $this->AdjEndDate($aEndTime,false,false,$this->iEndAlign);
+	    }
+	}
+	$this->Update($img,$adjstart,$adjend);
+	if( ! $this->ticks->IsSpecified() )
+	    $this->ticks->Set($maj,$min);
+	if( $this->date_format == '' ) 
+	    $this->ticks->SetLabelDateFormat($format);
+	else 
+	    $this->ticks->SetLabelDateFormat($this->date_format);
+    }
+}
+
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_error.php php-syslog-ng/html/includes/jpgraph/jpgraph_error.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_error.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_error.php	2006-02-04 07:06:40.000000000 -0500
@@ -0,0 +1,157 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_ERROR.PHP
+// Description:	Error plot extension for JpGraph
+// Created: 	2001-01-08
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_error.php 461 2006-02-04 12:06:40Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+//===================================================
+// CLASS ErrorPlot
+// Description: Error plot with min/max value for
+// each datapoint
+//===================================================
+class ErrorPlot extends Plot {
+    var $errwidth=2;
+//---------------
+// CONSTRUCTOR
+    function ErrorPlot(&$datay,$datax=false) {
+	$this->Plot($datay,$datax);
+	$this->numpoints /= 2;
+    }
+//---------------
+// PUBLIC METHODS
+	
+    // Gets called before any axis are stroked
+    function PreStrokeAdjust(&$graph) {
+	if( $this->center ) {
+	    $a=0.5; $b=0.5;
+	    ++$this->numpoints;			
+	} else {
+	    $a=0; $b=0;
+	}
+	$graph->xaxis->scale->ticks->SetXLabelOffset($a);
+	$graph->SetTextScaleOff($b);						
+	//$graph->xaxis->scale->ticks->SupressMinorTickMarks();
+    }
+	
+    // Method description
+    function Stroke(&$img,&$xscale,&$yscale) {
+	$numpoints=count($this->coords[0])/2;
+	$img->SetColor($this->color);
+	$img->SetLineWeight($this->weight);	
+
+	if( isset($this->coords[1]) ) {
+	    if( count($this->coords[1])!=$numpoints )
+		JpGraphError::RaiseL(2003,count($this->coords[1]),$numpoints);
+//("Number of X and Y points are not equal. Number of X-points:".count($this->coords[1])." Number of Y-points:$numpoints");
+	    else
+		$exist_x = true;
+	}
+	else 
+	    $exist_x = false;
+		
+	for( $i=0; $i<$numpoints; ++$i) {
+	    if( $exist_x ) 
+		$x=$this->coords[1][$i];
+	    else 
+		$x=$i;
+
+	    if( !is_numeric($x) ||  
+		!is_numeric($this->coords[0][$i*2]) || !is_numeric($this->coords[0][$i*2+1]) ) {
+		continue;
+	    }
+	    
+	    $xt = $xscale->Translate($x);
+	    $yt1 = $yscale->Translate($this->coords[0][$i*2]);
+	    $yt2 = $yscale->Translate($this->coords[0][$i*2+1]);
+	    $img->Line($xt,$yt1,$xt,$yt2);
+	    $img->Line($xt-$this->errwidth,$yt1,$xt+$this->errwidth,$yt1);
+	    $img->Line($xt-$this->errwidth,$yt2,$xt+$this->errwidth,$yt2);
+	}			
+	return true;
+    }
+} // Class
+
+
+//===================================================
+// CLASS ErrorLinePlot
+// Description: Combine a line and error plot
+// THIS IS A DEPRECATED PLOT TYPE JUST KEPT FOR
+// BACKWARD COMPATIBILITY
+//===================================================
+class ErrorLinePlot extends ErrorPlot {
+    var $line=null;
+//---------------
+// CONSTRUCTOR
+    function ErrorLinePlot(&$datay,$datax=false) {
+	$this->ErrorPlot($datay,$datax);
+	// Calculate line coordinates as the average of the error limits
+	$n = count($datay);
+	for($i=0; $i < $n; $i+=2 ) {
+	    $ly[]=($datay[$i]+$datay[$i+1])/2;
+	}		
+	$this->line=new LinePlot($ly,$datax);
+    }
+
+//---------------
+// PUBLIC METHODS
+    function Legend(&$graph) {
+	if( $this->legend != "" )
+	    $graph->legend->Add($this->legend,$this->color);
+	$this->line->Legend($graph);
+    }
+			
+    function Stroke(&$img,&$xscale,&$yscale) {
+	parent::Stroke($img,$xscale,$yscale);
+	$this->line->Stroke($img,$xscale,$yscale);
+    }
+} // Class
+
+
+//===================================================
+// CLASS LineErrorPlot
+// Description: Combine a line and error plot
+//===================================================
+class LineErrorPlot extends ErrorPlot {
+    var $line=null;
+//---------------
+// CONSTRUCTOR
+    // Data is (val, errdeltamin, errdeltamax)
+    function LineErrorPlot(&$datay,$datax=false) {
+	$ly=array(); $ey=array();
+	$n = count($datay);
+	if( $n % 3 != 0 ) {
+	    JpGraphError::RaiseL(4002);
+//('Error in input data to LineErrorPlot. Number of data points must be a multiple of 3');
+	}
+	for($i=0; $i < $n; $i+=3 ) {
+	    $ly[]=$datay[$i];
+	    $ey[]=$datay[$i]+$datay[$i+1];
+	    $ey[]=$datay[$i]+$datay[$i+2];
+	}		
+	$this->ErrorPlot($ey,$datax);
+	$this->line=new LinePlot($ly,$datax);
+    }
+
+//---------------
+// PUBLIC METHODS
+    function Legend(&$graph) {
+	if( $this->legend != "" )
+	    $graph->legend->Add($this->legend,$this->color);
+	$this->line->Legend($graph);
+    }
+			
+    function Stroke(&$img,&$xscale,&$yscale) {
+	parent::Stroke($img,$xscale,$yscale);
+	$this->line->Stroke($img,$xscale,$yscale);
+    }
+} // Class
+
+
+/* EOF */
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_flags.php php-syslog-ng/html/includes/jpgraph/jpgraph_flags.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_flags.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_flags.php	2006-02-04 07:12:32.000000000 -0500
@@ -0,0 +1,374 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_FLAGS.PHP
+// Description:	Class Jpfile. Handles plotmarks
+// Created: 	2003-06-28
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_flags.php 471 2006-02-04 12:12:32Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+//------------------------------------------------------------
+// Defines for the different basic sizes of flags
+//------------------------------------------------------------
+DEFINE('FLAGSIZE1',1);
+DEFINE('FLAGSIZE2',2);
+DEFINE('FLAGSIZE3',3);
+DEFINE('FLAGSIZE4',4);
+
+class FlagImages {
+
+    var $iCountryNameMap = array(
+    'Afghanistan' => 'afgh',
+    'Republic of Angola' => 'agla',
+    'Republic of Albania' => 'alba',
+    'Alderney' => 'alde',
+    'Democratic and Popular Republic of Algeria' => 'alge',
+    'Territory of American Samoa' => 'amsa',
+    'Principality of Andorra' => 'andr',
+    'British Overseas Territory of Anguilla' => 'angu',
+    'Antarctica' => 'anta',
+    'Argentine Republic' => 'arge',
+    'League of Arab States' => 'arle',
+    'Republic of Armenia' => 'arme',
+    'Aruba' => 'arub',
+    'Commonwealth of Australia' => 'astl',
+    'Republic of Austria' => 'aust',
+    'Azerbaijani Republic' => 'azer',
+    'British Antarctic Territory' => 'bant',
+    'Kingdom of Belgium' => 'belg',
+    'British Overseas Territory of Bermuda' => 'berm',
+    'Commonwealth of the Bahamas' => 'bhms',
+    'Kingdom of Bahrain' => 'bhrn',
+    'Republic of Belarus' => 'blru',
+    'Republic of Bolivia' => 'blva',
+    'Belize' => 'blze',
+    'Republic of Benin' => 'bnin',
+    'Republic of Botswana' => 'bots',
+    'Federative Republic of Brazil' => 'braz',
+    'Barbados' => 'brbd',
+    'British Indian Ocean Territory' => 'brin',
+    'Brunei Darussalam' => 'brun',
+    'Republic of Burkina' => 'bufa',
+    'Republic of Bulgaria' => 'bulg',
+    'Republic of Burundi' => 'buru',
+    'Overseas Territory of the British Virgin Islands' => 'bvis',
+    'Central African Republic' => 'cafr',
+    'Kingdom of Cambodia' => 'camb',
+    'Republic of Cameroon' => 'came',
+    'Dominion of Canada' => 'cana',
+    'Caribbean Community' => 'cari',
+    'Republic of Cape Verde' => 'cave',
+    'Republic of Chad' => 'chad',
+    'Republic of Chile' => 'chil',
+    'Peoples Republic of China' => 'chin',
+    'Territory of Christmas Island' => 'chms',
+    'Commonwealth of Independent States' => 'cins',
+    'Cook Islands' => 'ckis',
+    'Republic of Colombia' => 'clmb',
+    'Territory of Cocos Islands' => 'cois',
+    'Commonwealth' => 'comn',
+    'Union of the Comoros' => 'como',
+    'Republic of the Congo' => 'cong',
+    'Republic of Costa Rica' => 'corc',
+    'Republic of Croatia' => 'croa',
+    'Republic of Cuba' => 'cuba',
+    'British Overseas Territory of the Cayman Islands' => 'cyis',
+    'Republic of Cyprus' => 'cypr',
+    'The Czech Republic' => 'czec',
+    'Kingdom of Denmark' => 'denm',
+    'Republic of Djibouti' => 'djib',
+    'Commonwealth of Dominica' => 'domn',
+    'Dominican Republic' => 'dore',
+    'Republic of Ecuador' => 'ecua',
+    'Arab Republic of Egypt' => 'egyp',
+    'Republic of El Salvador' => 'elsa',
+    'England' => 'engl',
+    'Republic of Equatorial Guinea' => 'eqgu',
+    'State of Eritrea' => 'erit',
+    'Republic of Estonia' => 'estn',
+    'Ethiopia' => 'ethp',
+    'European Union' => 'euun',
+    'British Overseas Territory of the Falkland Islands' => 'fais',
+    'International Federation of Vexillological Associations' => 'fiav',
+    'Republic of Fiji' => 'fiji',
+    'Republic of Finland' => 'finl',
+    'Territory of French Polynesia' => 'fpol',
+    'French Republic' => 'fran',
+    'Overseas Department of French Guiana' => 'frgu',
+    'Gabonese Republic' => 'gabn',
+    'Republic of the Gambia' => 'gamb',
+    'Republic of Georgia' => 'geor',
+    'Federal Republic of Germany' => 'germ',
+    'Republic of Ghana' => 'ghan',
+    'Gibraltar' => 'gibr',
+    'Hellenic Republic' => 'grec',
+    'State of Grenada' => 'gren',
+    'Overseas Department of Guadeloupe' => 'guad',
+    'Territory of Guam' => 'guam',
+    'Republic of Guatemala' => 'guat',
+    'The Bailiwick of Guernsey' => 'guer',
+    'Republic of Guinea' => 'guin',
+    'Republic of Haiti' => 'hait',
+    'Hong Kong Special Administrative Region' => 'hokn',
+    'Republic of Honduras' => 'hond',
+    'Republic of Hungary' => 'hung',
+    'Republic of Iceland' => 'icel',
+    'International Committee of the Red Cross' => 'icrc',
+    'Republic of India' => 'inda',
+    'Republic of Indonesia' => 'indn',
+    'Republic of Iraq' => 'iraq',
+    'Republic of Ireland' => 'irel',
+    'Organization of the Islamic Conference' => 'isco',
+    'Isle of Man' => 'isma',
+    'State of Israel' => 'isra',
+    'Italian Republic' => 'ital',
+    'Jamaica' => 'jama',
+    'Japan' => 'japa',
+    'The Bailiwick of Jersey' => 'jers',
+    'Hashemite Kingdom of Jordan' => 'jord',
+    'Republic of Kazakhstan' => 'kazk',
+    'Republic of Kenya' => 'keny',
+    'Republic of Kiribati' => 'kirb',
+    'State of Kuwait' => 'kuwa',
+    'Kyrgyz Republic' => 'kyrg',
+    'Republic of Latvia' => 'latv',
+    'Lebanese Republic' => 'leba',
+    'Kingdom of Lesotho' => 'lest',
+    'Republic of Liberia' => 'libe',
+    'Principality of Liechtenstein' => 'liec',
+    'Republic of Lithuania' => 'lith',
+    'Grand Duchy of Luxembourg' => 'luxe',
+    'Macao Special Administrative Region' => 'maca',
+    'Republic of Macedonia' => 'mace',
+    'Republic of Madagascar' => 'mada',
+    'Republic of the Marshall Islands' => 'mais',
+    'Republic of Mali' => 'mali',
+    'Federation of Malaysia' => 'mals',
+    'Republic of Malta' => 'malt',
+    'Republic of Malawi' => 'malw',
+    'Overseas Department of Martinique' => 'mart',
+    'Islamic Republic of Mauritania' => 'maur',
+    'Territorial Collectivity of Mayotte' => 'mayt',
+    'United Mexican States' => 'mexc',
+    'Federated States of Micronesia' => 'micr',
+    'Midway Islands' => 'miis',
+    'Republic of Moldova' => 'mold',
+    'Principality of Monaco' => 'mona',
+    'Republic of Mongolia' => 'mong',
+    'British Overseas Territory of Montserrat' => 'mont',
+    'Kingdom of Morocco' => 'morc',
+    'Republic of Mozambique' => 'moza',
+    'Republic of Mauritius' => 'mrts',
+    'Union of Myanmar' => 'myan',
+    'Republic of Namibia' => 'namb',
+    'North Atlantic Treaty Organization' => 'nato',
+    'Republic of Nauru' => 'naur',
+    'Turkish Republic of Northern Cyprus' => 'ncyp',
+    'Netherlands Antilles' => 'nean',
+    'Kingdom of Nepal' => 'nepa',
+    'Kingdom of the Netherlands' => 'neth',
+    'Territory of Norfolk Island' => 'nfis',
+    'Federal Republic of Nigeria' => 'ngra',
+    'Republic of Nicaragua' => 'nica',
+    'Republic of Niger' => 'nigr',
+    'Niue' => 'niue',
+    'Commonwealth of the Northern Mariana Islands' => 'nmar',
+    'Province of Northern Ireland' => 'noir',
+    'Nordic Council' => 'nord',
+    'Kingdom of Norway' => 'norw',
+    'Territory of New Caledonia and Dependencies' => 'nwca',
+    'New Zealand' => 'nwze',
+    'Organization of American States' => 'oast',
+    'Organization of African Unity' => 'oaun',
+    'International Olympic Committee' => 'olym',
+    'Sultanate of Oman' => 'oman',
+    'Islamic Republic of Pakistan' => 'paks',
+    'Republic of Palau' => 'pala',
+    'Independent State of Papua New Guinea' => 'pang',
+    'Republic of Paraguay' => 'para',
+    'Republic of Peru' => 'peru',
+    'Republic of the Philippines' => 'phil',
+    'British Overseas Territory of the Pitcairn Islands' => 'piis',
+    'Republic of Poland' => 'pola',
+    'Republic of Portugal' => 'port',
+    'Commonwealth of Puerto Rico' => 'purc',
+    'State of Qatar' => 'qata',
+    'Russian Federation' => 'russ',
+    'Republic of Rwanda' => 'rwan',
+    'Kingdom of Saudi Arabia' => 'saar',
+    'Republic of San Marino' => 'sama',
+    'Nordic Sami Conference' => 'sami',
+    'Sark' => 'sark',
+    'Scotland' => 'scot',
+    'Principality of Seborga' => 'sebo',
+    'Republic of Sierra Leone' => 'sile',
+    'Republic of Singapore' => 'sing',
+    'Republic of Korea' => 'skor',
+    'Republic of Slovenia' => 'slva',
+    'Somali Republic' => 'smla',
+    'Republic of Somaliland' => 'smld',
+    'Republic of South Africa' => 'soaf',
+    'Solomon Islands' => 'sois',
+    'Kingdom of Spain' => 'span',
+    'Secretariat of the Pacific Community' => 'spco',
+    'Democratic Socialist Republic of Sri Lanka' => 'srla',
+    'Saint Lucia' => 'stlu',
+    'Republic of the Sudan' => 'suda',
+    'Republic of Suriname' => 'surn',
+    'Slovak Republic' => 'svka',
+    'Kingdom of Sweden' => 'swdn',
+    'Swiss Confederation' => 'swit',
+    'Syrian Arab Republic' => 'syra',
+    'Kingdom of Swaziland' => 'szld',
+    'Republic of China' => 'taiw',
+    'Taiwan' => 'taiw',
+    'Republic of Tajikistan' => 'tajk',
+    'United Republic of Tanzania' => 'tanz',
+    'Kingdom of Thailand' => 'thal',
+    'Autonomous Region of Tibet' => 'tibe',
+    'Turkmenistan' => 'tkst',
+    'Togolese Republic' => 'togo',
+    'Tokelau' => 'toke',
+    'Kingdom of Tonga' => 'tong',
+    'Tristan da Cunha' => 'trdc',
+    'Tromelin' => 'tris',
+    'Republic of Tunisia' => 'tuns',
+    'Republic of Turkey' => 'turk',
+    'Tuvalu' => 'tuva',
+    'United Arab Emirates' => 'uaem',
+    'Republic of Uganda' => 'ugan',
+    'Ukraine' => 'ukrn',
+    'United Kingdom of Great Britain' => 'unkg',
+    'United Nations' => 'unna',
+    'United States of America' => 'unst',
+    'Oriental Republic of Uruguay' => 'urgy',
+    'Virgin Islands of the United States' => 'usvs',
+    'Republic of Uzbekistan' => 'uzbk',
+    'State of the Vatican City' => 'vacy',
+    'Republic of Vanuatu' => 'vant',
+    'Bolivarian Republic of Venezuela' => 'venz',
+    'Republic of Yemen' => 'yemn',
+    'Democratic Republic of Congo' => 'zare',
+    'Republic of Zimbabwe' => 'zbwe' ) ;
+
+
+    var $iFlagCount = -1;
+    var $iFlagSetMap = array(
+	FLAGSIZE1 => 'flags_thumb35x35',
+	FLAGSIZE2 => 'flags_thumb60x60',
+	FLAGSIZE3 => 'flags_thumb100x100',
+	FLAGSIZE4 => 'flags'
+	);
+
+    var $iFlagData ;
+    var $iOrdIdx=array();
+
+    function FlagImages($aSize=FLAGSIZE1) {
+	switch($aSize) {
+	    case FLAGSIZE1 :
+	    case FLAGSIZE2 :
+	    case FLAGSIZE3 :
+	    case FLAGSIZE4 :
+		$file = dirname(__FILE__).'/'.$this->iFlagSetMap[$aSize].'.dat';
+		$fp = fopen($file,'rb');
+		$rawdata = fread($fp,filesize($file));
+		$this->iFlagData = unserialize($rawdata);
+	    break;
+	    default:
+		JpGraphError::RaiseL(5001,$aSize);
+//('Unknown flag size. ('.$aSize.')');
+	}
+	$this->iFlagCount = count($this->iCountryNameMap);
+    }
+
+    function GetNum() {
+	return $this->iFlagCount;
+    }
+
+    function GetImgByName($aName,&$outFullName) {
+	$idx = $this->GetIdxByName($aName,$outFullName);
+	return $this->GetImgByIdx($idx);
+    }
+
+    function GetImgByIdx($aIdx) {
+	if( array_key_exists($aIdx,$this->iFlagData) ) {
+	    $d = $this->iFlagData[$aIdx][1];   
+	    return Image::CreateFromString($d);   
+	}
+	else {
+	    JpGraphError::RaiseL(5002,$aIdx);
+//("Flag index \"$aIdx\" does not exist.");
+	}
+    }
+
+    function GetIdxByOrdinal($aOrd,&$outFullName) {
+	$aOrd--;
+	$n = count($this->iOrdIdx);
+	if( $n == 0 ) {
+	    reset($this->iCountryNameMap);
+	    $this->iOrdIdx=array();
+	    $i=0;
+	    while( list($key,$val) = each($this->iCountryNameMap) ) {
+		$this->iOrdIdx[$i++] = array($val,$key);
+	    }
+	    $tmp=$this->iOrdIdx[$aOrd];
+	    $outFullName = $tmp[1];
+	    return $tmp[0];
+	    
+	}
+	elseif( $aOrd >= 0 && $aOrd < $n ) {
+	    $tmp=$this->iOrdIdx[$aOrd];
+	    $outFullName = $tmp[1];
+	    return $tmp[0];
+	}
+	else {
+	    JpGraphError::RaiseL(5003,$aOrd);
+//('Invalid ordinal number specified for flag index.');
+	}
+    }
+
+    function GetIdxByName($aName,&$outFullName) {
+
+	if( is_integer($aName) ) {
+	    $idx = $this->GetIdxByOrdinal($aName,$outFullName);
+	    return $idx;
+	}
+
+	$found=false;
+	$aName = strtolower($aName);
+	$nlen = strlen($aName);
+	reset($this->iCountryNameMap);
+	// Start by trying to match exact index name
+	while( list($key,$val) = each($this->iCountryNameMap) ) {
+	    if( $nlen == strlen($val) && $val == $aName )  {
+		$found=true;
+		break;
+	    }
+	}
+	if( !$found ) {
+	    reset($this->iCountryNameMap);
+	    // If the exact index doesn't work try a (partial) full name
+	    while( list($key,$val) = each($this->iCountryNameMap) ) {
+		if( strpos(strtolower($key), $aName) !== false ) {
+		    $found=true;
+		    break;
+		}
+	    }
+	}
+	if( $found ) {
+	    $outFullName = $key;
+	    return $val;   
+	}
+	else { 
+	    JpGraphError::RaiseL(5004,$aName);
+//("The (partial) country name \"$aName\" does not have a cooresponding flag image. The flag may still exist but under another name, e.g. insted of \"usa\" try \"united states\".");
+	}
+    }
+}
+
+
+
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_gantt.php php-syslog-ng/html/includes/jpgraph/jpgraph_gantt.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_gantt.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_gantt.php	2006-02-14 15:10:55.000000000 -0500
@@ -0,0 +1,3776 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_GANTT.PHP
+// Description:	JpGraph Gantt plot extension
+// Created: 	2001-11-12
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_gantt.php 543 2006-02-14 20:10:55Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+require_once('jpgraph_plotband.php'); 
+require_once('jpgraph_iconplot.php'); 
+require_once('jpgraph_plotmark.inc');
+
+// Maximum size for Automatic Gantt chart
+DEFINE('MAX_GANTTIMG_SIZE_W',4000);
+DEFINE('MAX_GANTTIMG_SIZE_H',5000);
+
+// Scale Header types
+DEFINE("GANTT_HDAY",1);
+DEFINE("GANTT_HWEEK",2);
+DEFINE("GANTT_HMONTH",4);
+DEFINE("GANTT_HYEAR",8);
+DEFINE("GANTT_HHOUR",16);
+DEFINE("GANTT_HMIN",32);
+
+// Bar patterns
+DEFINE("GANTT_RDIAG",BAND_RDIAG);	// Right diagonal lines
+DEFINE("GANTT_LDIAG",BAND_LDIAG); // Left diagonal lines
+DEFINE("GANTT_SOLID",BAND_SOLID); // Solid one color
+DEFINE("GANTT_VLINE",BAND_VLINE); // Vertical lines
+DEFINE("GANTT_HLINE",BAND_HLINE);  // Horizontal lines
+DEFINE("GANTT_3DPLANE",BAND_3DPLANE);  // "3D" Plane
+DEFINE("GANTT_HVCROSS",BAND_HVCROSS);  // Vertical/Hor crosses
+DEFINE("GANTT_DIAGCROSS",BAND_DIAGCROSS); // Diagonal crosses
+
+// Conversion constant
+DEFINE("SECPERDAY",3600*24);
+
+// Locales. ONLY KEPT FOR BACKWARDS COMPATIBILITY
+// You should use the proper locale strings directly 
+// from now on. 
+DEFINE("LOCALE_EN","en_UK");
+DEFINE("LOCALE_SV","sv_SE");
+
+// Layout of bars
+DEFINE("GANTT_EVEN",1);
+DEFINE("GANTT_FROMTOP",2);
+
+// Style for minute header
+DEFINE("MINUTESTYLE_MM",0);		// 15
+DEFINE("MINUTESTYLE_CUSTOM",2);		// Custom format
+
+
+// Style for hour header
+DEFINE("HOURSTYLE_HM24",0);		// 13:10
+DEFINE("HOURSTYLE_HMAMPM",1);		// 1:10pm
+DEFINE("HOURSTYLE_H24",2);		// 13
+DEFINE("HOURSTYLE_HAMPM",3);		// 1pm
+DEFINE("HOURSTYLE_CUSTOM",4);		// User defined
+
+// Style for day header
+DEFINE("DAYSTYLE_ONELETTER",0);		// "M"
+DEFINE("DAYSTYLE_LONG",1);		// "Monday"
+DEFINE("DAYSTYLE_LONGDAYDATE1",2);	// "Monday 23 Jun"
+DEFINE("DAYSTYLE_LONGDAYDATE2",3);	// "Monday 23 Jun 2003"
+DEFINE("DAYSTYLE_SHORT",4);		// "Mon"
+DEFINE("DAYSTYLE_SHORTDAYDATE1",5);	// "Mon 23/6"
+DEFINE("DAYSTYLE_SHORTDAYDATE2",6);	// "Mon 23 Jun"
+DEFINE("DAYSTYLE_SHORTDAYDATE3",7);	// "Mon 23"
+DEFINE("DAYSTYLE_SHORTDATE1",8);	// "23/6"
+DEFINE("DAYSTYLE_SHORTDATE2",9);	// "23 Jun"
+DEFINE("DAYSTYLE_SHORTDATE3",10);	// "Mon 23"
+DEFINE("DAYSTYLE_SHORTDATE4",11);	// "23"
+DEFINE("DAYSTYLE_CUSTOM",12);		// "M"
+
+// Styles for week header
+DEFINE("WEEKSTYLE_WNBR",0);
+DEFINE("WEEKSTYLE_FIRSTDAY",1);
+DEFINE("WEEKSTYLE_FIRSTDAY2",2);
+DEFINE("WEEKSTYLE_FIRSTDAYWNBR",3);
+DEFINE("WEEKSTYLE_FIRSTDAY2WNBR",4);
+
+// Styles for month header
+DEFINE("MONTHSTYLE_SHORTNAME",0);
+DEFINE("MONTHSTYLE_LONGNAME",1);
+DEFINE("MONTHSTYLE_LONGNAMEYEAR2",2);
+DEFINE("MONTHSTYLE_SHORTNAMEYEAR2",3);
+DEFINE("MONTHSTYLE_LONGNAMEYEAR4",4);
+DEFINE("MONTHSTYLE_SHORTNAMEYEAR4",5);
+DEFINE("MONTHSTYLE_FIRSTLETTER",6);
+
+
+// Types of constrain links
+DEFINE('CONSTRAIN_STARTSTART',0);
+DEFINE('CONSTRAIN_STARTEND',1);
+DEFINE('CONSTRAIN_ENDSTART',2);
+DEFINE('CONSTRAIN_ENDEND',3);
+
+// Arrow direction for constrain links
+DEFINE('ARROW_DOWN',0);
+DEFINE('ARROW_UP',1);
+DEFINE('ARROW_LEFT',2);
+DEFINE('ARROW_RIGHT',3);
+
+// Arrow type for constrain type
+DEFINE('ARROWT_SOLID',0);
+DEFINE('ARROWT_OPEN',1);
+
+// Arrow size for constrain lines
+DEFINE('ARROW_S1',0);
+DEFINE('ARROW_S2',1);
+DEFINE('ARROW_S3',2);
+DEFINE('ARROW_S4',3);
+DEFINE('ARROW_S5',4);
+
+// Activity types for use with utility method CreateSimple()
+DEFINE('ACTYPE_NORMAL',0);
+DEFINE('ACTYPE_GROUP',1);
+DEFINE('ACTYPE_MILESTONE',2);
+
+DEFINE('ACTINFO_3D',1);
+DEFINE('ACTINFO_2D',0);
+
+
+// Check if array_fill() exists
+if (!function_exists('array_fill')) {
+    function array_fill($iStart, $iLen, $vValue) {
+	$aResult = array();
+	for ($iCount = $iStart; $iCount < $iLen + $iStart; $iCount++) {
+	    $aResult[$iCount] = $vValue;
+	}
+	return $aResult;
+    }
+}
+
+//===================================================
+// CLASS GanttActivityInfo
+// Description: 
+//===================================================
+class GanttActivityInfo {
+    var $iColor='black';
+    var $iBackgroundColor='lightgray';
+    var $iFFamily=FF_FONT1,$iFStyle=FS_NORMAL,$iFSize=10,$iFontColor='black';
+    var $iTitles=array();
+    var $iWidth=array(),$iHeight=-1;
+    var $iLeftColMargin=4,$iRightColMargin=1,$iTopColMargin=1,$iBottomColMargin=3;
+    var $iTopHeaderMargin = 4;
+    var $vgrid = null;
+    var $iStyle=1;
+    var $iShow=true;
+    var $iHeaderAlign='center';
+
+    function GanttActivityInfo() {
+	$this->vgrid = new LineProperty();
+    }
+
+    function Hide($aF=true) {
+	$this->iShow=!$aF;
+    }
+
+    function Show($aF=true) {
+	$this->iShow=$aF;
+    }
+
+    // Specify font
+    function SetFont($aFFamily,$aFStyle=FS_NORMAL,$aFSize=10) {
+	$this->iFFamily = $aFFamily;
+	$this->iFStyle	 = $aFStyle;
+	$this->iFSize	 = $aFSize;
+    }
+
+    function SetStyle($aStyle) {
+	$this->iStyle = $aStyle;
+    }
+
+    function SetColumnMargin($aLeft,$aRight) {
+	$this->iLeftColMargin = $aLeft;
+	$this->iRightColMargin = $aRight;
+    }
+
+    function SetFontColor($aFontColor) {
+	$this->iFontColor = $aFontColor;
+    }
+
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+
+    function SetBackgroundColor($aColor) {
+	$this->iBackgroundColor = $aColor;
+    }
+
+    function SetColTitles($aTitles,$aWidth=null) {
+	$this->iTitles = $aTitles;
+	$this->iWidth = $aWidth;
+    }
+
+    function SetMinColWidth($aWidths) {
+	$n = min(count($this->iTitles),count($aWidths));
+	for($i=0; $i < $n; ++$i ) {
+	    if( !empty($aWidths[$i]) ) {
+		if( empty($this->iWidth[$i]) ) {
+		    $this->iWidth[$i] = $aWidths[$i];
+		}
+		else {
+		    $this->iWidth[$i] = max($this->iWidth[$i],$aWidths[$i]);
+		}
+	    }
+	}
+    }
+
+    function GetWidth(&$aImg) {
+	$txt = new TextProperty();
+	$txt->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	$n = count($this->iTitles) ;
+	$rm=$this->iRightColMargin;
+	$w = 0;
+	for($h=0, $i=0; $i < $n; ++$i ) {
+	    $w += $this->iLeftColMargin;
+	    $txt->Set($this->iTitles[$i]);
+	    if( !empty($this->iWidth[$i]) ) {
+		$w1 = max($txt->GetWidth($aImg)+$rm,$this->iWidth[$i]);
+	    }
+	    else {
+		$w1 = $txt->GetWidth($aImg)+$rm;
+	    }
+	    $this->iWidth[$i] = $w1;
+	    $w += $w1;
+	    $h = max($h,$txt->GetHeight($aImg));
+	}
+	$this->iHeight = $h+$this->iTopHeaderMargin;
+        $txt='';
+	return $w;
+    }
+    
+    function GetColStart(&$aImg,&$ioStart,$aAddLeftMargin=false) {
+	$n = count($this->iTitles) ;
+	$adj = $aAddLeftMargin ? $this->iLeftColMargin : 0;
+	$ioStart=array($aImg->left_margin+$adj);
+	for( $i=1; $i < $n; ++$i ) {
+	    $ioStart[$i] = $ioStart[$i-1]+$this->iLeftColMargin+$this->iWidth[$i-1];
+	}
+    }
+    
+    // Adjust headers left, right or centered
+    function SetHeaderAlign($aAlign) {
+	$this->iHeaderAlign=$aAlign;
+    }
+
+    function Stroke(&$aImg,$aXLeft,$aYTop,$aXRight,$aYBottom,$aUseTextHeight=false) {
+
+	if( !$this->iShow ) return;
+
+	$txt = new TextProperty();
+	$txt->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	$txt->SetColor($this->iFontColor);
+	$txt->SetAlign($this->iHeaderAlign,'top');
+	$n=count($this->iTitles);
+
+	if( $n == 0 ) 
+	    return;
+	
+	$x = $aXLeft;
+	$h = $this->iHeight;
+	$yTop = $aUseTextHeight ? $aYBottom-$h-$this->iTopColMargin-$this->iBottomColMargin : $aYTop ;
+
+	if( $h < 0 ) {
+	    JpGraphError::RaiseL(6001);
+//('Internal error. Height for ActivityTitles is < 0');
+	}
+
+	$aImg->SetLineWeight(1);
+	// Set background color
+	$aImg->SetColor($this->iBackgroundColor);
+	$aImg->FilledRectangle($aXLeft,$yTop,$aXRight,$aYBottom-1);
+
+	if( $this->iStyle == 1 ) {
+	    // Make a 3D effect
+	    $aImg->SetColor('white');
+	    $aImg->Line($aXLeft,$yTop+1,
+			$aXRight,$yTop+1);
+	}
+	
+	for($i=0; $i < $n; ++$i ) {
+	    if( $this->iStyle == 1 ) {
+		// Make a 3D effect
+		$aImg->SetColor('white');
+		$aImg->Line($x+1,$yTop,$x+1,$aYBottom);
+	    }
+	    $x += $this->iLeftColMargin;
+	    $txt->Set($this->iTitles[$i]);
+	    
+	    // Adjust the text anchor position according to the choosen alignment
+	    $xp = $x;
+	    if( $this->iHeaderAlign == 'center' ) {
+		$xp = (($x-$this->iLeftColMargin)+($x+$this->iWidth[$i]))/2;
+	    }
+	    elseif( $this->iHeaderAlign == 'right' ) {
+		$xp = $x +$this->iWidth[$i]-$this->iRightColMargin;
+	    }
+		    
+	    $txt->Stroke($aImg,$xp,$yTop+$this->iTopHeaderMargin);
+	    $x += $this->iWidth[$i];
+	    if( $i < $n-1 ) {
+		$aImg->SetColor($this->iColor);
+		$aImg->Line($x,$yTop,$x,$aYBottom);
+	    }
+	}
+
+	$aImg->SetColor($this->iColor);
+	$aImg->Line($aXLeft,$yTop, $aXRight,$yTop);
+
+	// Stroke vertical column dividers
+	$cols=array();
+	$this->GetColStart($aImg,$cols);
+	$n=count($cols);
+	for( $i=1; $i < $n; ++$i ) {
+	    $this->vgrid->Stroke($aImg,$cols[$i],$aYBottom,$cols[$i],
+				    $aImg->height - $aImg->bottom_margin);
+	}
+    }
+}
+
+
+//===================================================
+// CLASS GanttGraph
+// Description: Main class to handle gantt graphs
+//===================================================
+class GanttGraph extends Graph {
+    var $scale;							// Public accessible
+    var $iObj=array();				// Gantt objects
+    var $iLabelHMarginFactor=0.2;	// 10% margin on each side of the labels
+    var $iLabelVMarginFactor=0.4;	// 40% margin on top and bottom of label
+    var $iLayout=GANTT_FROMTOP;	// Could also be GANTT_EVEN
+    var $iSimpleFont = FF_FONT1,$iSimpleFontSize=11;
+    var $iSimpleStyle=GANTT_RDIAG,$iSimpleColor='yellow',$iSimpleBkgColor='red';
+    var $iSimpleProgressBkgColor='gray',$iSimpleProgressColor='darkgreen';
+    var $iSimpleProgressStyle=GANTT_SOLID;
+    var $hgrid=null;
+//---------------
+// CONSTRUCTOR	
+    // Create a new gantt graph
+    function GanttGraph($aWidth=0,$aHeight=0,$aCachedName="",$aTimeOut=0,$aInline=true) {
+
+	// Backward compatibility
+	if( $aWidth == -1 ) $aWidth=0;
+	if( $aHeight == -1 ) $aHeight=0;
+
+	if( $aWidth<  0 || $aHeight < 0 ) {
+	    JpgraphError::RaiseL(6002);
+//("You can't specify negative sizes for Gantt graph dimensions. Use 0 to indicate that you want the library to automatically determine a dimension.");
+	}
+	Graph::Graph($aWidth,$aHeight,$aCachedName,$aTimeOut,$aInline);		
+	$this->scale = new GanttScale($this->img);
+
+	// Default margins
+	$this->img->SetMargin(15,17,25,15);
+
+	$this->hgrid = new HorizontalGridLine();
+		
+	$this->scale->ShowHeaders(GANTT_HWEEK|GANTT_HDAY);
+	$this->SetBox();
+    }
+	
+//---------------
+// PUBLIC METHODS
+
+    // 
+
+    function SetSimpleFont($aFont,$aSize) {
+	$this->iSimpleFont = $aFont;
+	$this->iSimpleFontSize = $aSize;
+    }
+
+    function SetSimpleStyle($aBand,$aColor,$aBkgColor) {
+	$this->iSimpleStyle = $aBand;
+	$this->iSimpleColor = $aColor;
+	$this->iSimpleBkgColor = $aBkgColor;
+    }
+
+    // A utility function to help create basic Gantt charts
+    function CreateSimple($data,$constrains=array(),$progress=array()) {
+	$num = count($data);
+	for( $i=0; $i < $num; ++$i) {
+	    switch( $data[$i][1] ) {
+		case ACTYPE_GROUP:
+		    // Create a slightly smaller height bar since the
+		    // "wings" at the end will make it look taller
+		    $a = new GanttBar($data[$i][0],$data[$i][2],$data[$i][3],$data[$i][4],'',8);
+		    $a->title->SetFont($this->iSimpleFont,FS_BOLD,$this->iSimpleFontSize);		
+		    $a->rightMark->Show();
+		    $a->rightMark->SetType(MARK_RIGHTTRIANGLE);
+		    $a->rightMark->SetWidth(8);
+		    $a->rightMark->SetColor('black');
+		    $a->rightMark->SetFillColor('black');
+	    
+		    $a->leftMark->Show();
+		    $a->leftMark->SetType(MARK_LEFTTRIANGLE);
+		    $a->leftMark->SetWidth(8);
+		    $a->leftMark->SetColor('black');
+		    $a->leftMark->SetFillColor('black');
+	    
+		    $a->SetPattern(BAND_SOLID,'black');
+		    $csimpos = 6;
+		    break;
+		
+		case ACTYPE_NORMAL:
+		    $a = new GanttBar($data[$i][0],$data[$i][2],$data[$i][3],$data[$i][4],'',10);
+		    $a->title->SetFont($this->iSimpleFont,FS_NORMAL,$this->iSimpleFontSize);
+		    $a->SetPattern($this->iSimpleStyle,$this->iSimpleColor);
+		    $a->SetFillColor($this->iSimpleBkgColor);
+		    // Check if this activity should have a constrain line
+		    $n = count($constrains);
+		    for( $j=0; $j < $n; ++$j ) {
+			if( empty($constrains[$j]) || (count($constrains[$j]) != 3) ) {
+			    JpGraphError::RaiseL(6003,$j);
+//("Invalid format for Constrain parameter at index=$j in CreateSimple(). Parameter must start with index 0 and contain arrays of (Row,Constrain-To,Constrain-Type)");	 
+			}
+			if( $constrains[$j][0]==$data[$i][0] ) {
+			    $a->SetConstrain($constrains[$j][1],$constrains[$j][2],'black',ARROW_S2,ARROWT_SOLID);    
+			}
+		    }
+
+		    // Check if this activity have a progress bar
+		    $n = count($progress);
+		    for( $j=0; $j < $n; ++$j ) {
+			
+			if( empty($progress[$j]) || (count($progress[$j]) != 2) ) {
+			    JpGraphError::RaiseL(6004,$j);
+//("Invalid format for Progress parameter at index=$j in CreateSimple(). Parameter must start with index 0 and contain arrays of (Row,Progress)");	
+			}
+			if( $progress[$j][0]==$data[$i][0] ) {
+			    $a->progress->Set($progress[$j][1]);
+			    $a->progress->SetHeight(0.5);
+			    $a->progress->SetPattern($this->iSimpleProgressStyle,
+						     $this->iSimpleProgressColor);
+			    $a->progress->SetFillColor($this->iSimpleProgressBkgColor);
+			    //$a->progress->SetPattern($progress[$j][2],$progress[$j][3]);
+			    break;
+			}
+		    }
+		    $csimpos = 6;
+		    break;
+
+		case ACTYPE_MILESTONE:
+		    $a = new MileStone($data[$i][0],$data[$i][2],$data[$i][3]);
+		    $a->title->SetFont($this->iSimpleFont,FS_NORMAL,$this->iSimpleFontSize);
+		    $a->caption->SetFont($this->iSimpleFont,FS_NORMAL,$this->iSimpleFontSize);
+		    $csimpos = 5;
+		    break;
+		default:
+		    die('Unknown activity type');
+		    break;
+	    }
+
+	    // Setup caption
+	    $a->caption->Set($data[$i][$csimpos-1]);
+
+	    // Check if this activity should have a CSIM target?
+	    if( !empty($data[$i][$csimpos]) ) {
+		$a->SetCSIMTarget($data[$i][$csimpos]);
+		$a->SetCSIMAlt($data[$i][$csimpos+1]);
+	    }
+	    if( !empty($data[$i][$csimpos+2]) ) {
+		$a->title->SetCSIMTarget($data[$i][$csimpos+2]);
+		$a->title->SetCSIMAlt($data[$i][$csimpos+3]);
+	    }
+
+	    $this->Add($a);
+	}
+    }
+
+	
+    // Set what headers should be shown
+    function ShowHeaders($aFlg) {
+	$this->scale->ShowHeaders($aFlg);
+    }
+	
+    // Specify the fraction of the font height that should be added 
+    // as vertical margin
+    function SetLabelVMarginFactor($aVal) {
+	$this->iLabelVMarginFactor = $aVal;
+    }
+
+    // Synonym to the method above
+    function SetVMarginFactor($aVal) {
+	$this->iLabelVMarginFactor = $aVal;
+    }
+	
+	
+    // Add a new Gantt object
+    function Add($aObject) {
+	if( is_array($aObject) && count($aObject) > 0 ) {
+	    $cl = $aObject[0];
+	    if( is_a($cl,'IconPlot') ) {
+		$this->AddIcon($aObject);
+	    }
+	    else {
+		$n = count($aObject);
+		for($i=0; $i < $n; ++$i)
+		    $this->iObj[] = $aObject[$i];
+	    }
+	}
+	else {
+	    if( is_a($aObject,'IconPlot') ) {
+		$this->AddIcon($aObject);
+	    }
+	    else {	    
+		$this->iObj[] = $aObject;
+	    }
+	}
+    }
+
+    // Override inherit method from Graph and give a warning message
+    function SetScale() {
+	JpGraphError::RaiseL(6005);
+//("SetScale() is not meaningfull with Gantt charts.");
+    }
+
+    // Specify the date range for Gantt graphs (if this is not set it will be
+    // automtically determined from the input data)
+    function SetDateRange($aStart,$aEnd) {
+	// Adjust the start and end so that the indicate the
+	// begining and end of respective start and end days
+	if( strpos($aStart,':') === false )
+	    $aStart = date('Y-m-d 00:00',strtotime($aStart));
+	if( strpos($aEnd,':') === false )
+	    $aEnd = date('Y-m-d 23:59',strtotime($aEnd));
+	$this->scale->SetRange($aStart,$aEnd);
+    }
+	
+    // Get the maximum width of the activity titles columns for the bars
+    // The name is lightly misleading since we from now on can have
+    // multiple columns in the label section. When this was first written
+    // it only supported a single label, hence the name.
+    function GetMaxLabelWidth() {
+	$m=50;
+	if( $this->iObj != null ) {
+	    $marg = $this->scale->actinfo->iLeftColMargin+$this->scale->actinfo->iRightColMargin;
+	    $m = $this->iObj[0]->title->GetWidth($this->img)+$marg;
+	    $n = count($this->iObj);
+	    for($i=1; $i < $n; ++$i) {
+		if( !empty($this->iObj[$i]->title) ) {
+		    if( $this->iObj[$i]->title->HasTabs() ) {
+			list($tot,$w) = $this->iObj[$i]->title->GetWidth($this->img,true);
+			$m=max($m,$tot);
+		    }
+		    else 
+			$m=max($m,$this->iObj[$i]->title->GetWidth($this->img));
+		}
+	    }
+	}
+	return $m;
+    }
+	
+    // Get the maximum height of the titles for the bars
+    function GetMaxLabelHeight() {
+	$m=0;
+	if( $this->iObj != null ) {
+	    $m = $this->iObj[0]->title->GetHeight($this->img);
+	    $n = count($this->iObj);
+	    for($i=1; $i < $n; ++$i) {
+		if( !empty($this->iObj[$i]->title) ) {
+		    $m=max($m,$this->iObj[$i]->title->GetHeight($this->img));
+		}
+	    }
+	}
+	return $m;
+    }
+
+    function GetMaxBarAbsHeight() {
+	$m=0;
+	if( $this->iObj != null ) {
+	    $m = $this->iObj[0]->GetAbsHeight($this->img);
+	    $n = count($this->iObj);
+	    for($i=1; $i < $n; ++$i) {
+		$m=max($m,$this->iObj[$i]->GetAbsHeight($this->img));
+	    }
+	}
+	return $m;		
+    }
+	
+    // Get the maximum used line number (vertical position) for bars
+    function GetBarMaxLineNumber() {
+	$m=0;
+	if( $this->iObj != null ) {
+	    $m = $this->iObj[0]->GetLineNbr();
+	    $n = count($this->iObj);
+	    for($i=1; $i < $n; ++$i) {
+		$m=max($m,$this->iObj[$i]->GetLineNbr());
+	    }
+	}
+	return $m;
+    }
+	
+    // Get the minumum and maximum used dates for all bars
+    function GetBarMinMax() {
+	$start = 0 ;
+	$n = count($this->iObj);
+
+	while( $start < $n && $this->iObj[$start]->GetMaxDate() === false )
+	    ++$start;
+	if( $start >= $n ) {
+	    JpgraphError::RaiseL(6006);
+//('Cannot autoscale Gantt chart. No dated activities exist. [GetBarMinMax() start >= n]');
+	}
+
+	$max=$this->scale->NormalizeDate($this->iObj[$start]->GetMaxDate());
+	$min=$this->scale->NormalizeDate($this->iObj[$start]->GetMinDate());
+
+	for($i=$start+1; $i < $n; ++$i) {
+	    $rmax = $this->scale->NormalizeDate($this->iObj[$i]->GetMaxDate());
+	    if( $rmax != false ) 
+		$max=Max($max,$rmax);
+	    $rmin = $this->scale->NormalizeDate($this->iObj[$i]->GetMinDate());
+	    if( $rmin != false ) 
+		$min=Min($min,$rmin);
+	}
+	$minDate = date("Y-m-d",$min);
+	$min = strtotime($minDate);
+	$maxDate = date("Y-m-d 23:59",$max);
+	$max = strtotime($maxDate);	
+	return array($min,$max);
+    }
+
+    // Create a new auto sized canvas if the user hasn't specified a size
+    // The size is determined by what scale the user has choosen and hence
+    // the minimum width needed to display the headers. Some margins are
+    // also added to make it better looking.
+    function AutoSize() {
+	if( $this->img->img == null ) {
+	    // The predefined left, right, top, bottom margins.
+	    // Note that the top margin might incease depending on
+	    // the title.
+	    $lm = $this->img->left_margin; 
+	    $rm = $this->img->right_margin; 
+	    $rm += 2 ;
+	    $tm = $this->img->top_margin; 
+	    $bm = $this->img->bottom_margin; 
+	    $bm += 1; 
+	    if( BRAND_TIMING ) $bm += 10;
+			
+	    // First find out the height			
+	    $n=$this->GetBarMaxLineNumber()+1;
+	    $m=max($this->GetMaxLabelHeight(),$this->GetMaxBarAbsHeight());
+	    $height=$n*((1+$this->iLabelVMarginFactor)*$m);			
+			
+	    // Add the height of the scale titles			
+	    $h=$this->scale->GetHeaderHeight();
+	    $height += $h;
+
+	    // Calculate the top margin needed for title and subtitle
+	    if( $this->title->t != "" ) {
+		$tm += $this->title->GetFontHeight($this->img);
+	    }
+	    if( $this->subtitle->t != "" ) {
+		$tm += $this->subtitle->GetFontHeight($this->img);
+	    }
+
+	    // ...and then take the bottom and top plot margins into account
+	    $height += $tm + $bm + $this->scale->iTopPlotMargin + $this->scale->iBottomPlotMargin;
+	    // Now find the minimum width for the chart required
+
+	    // If day scale or smaller is shown then we use the day font width
+	    // as the base size unit.
+	    // If only weeks or above is displayed we use a modified unit to
+	    // get a smaller image.
+	    if( $this->scale->IsDisplayHour() || $this->scale->IsDisplayMinute() ) {
+		// Add 2 pixel margin on each side
+		$fw=$this->scale->day->GetFontWidth($this->img)+4; 
+	    }
+	    elseif( $this->scale->IsDisplayWeek() ) {
+		$fw = 8;
+	    }
+	    elseif( $this->scale->IsDisplayMonth() ) {
+		$fw = 4;
+	    }
+	    else {
+		$fw = 2;
+	    }
+
+	    $nd=$this->scale->GetNumberOfDays();
+
+	    if( $this->scale->IsDisplayDay() ) {
+		// If the days are displayed we also need to figure out
+		// how much space each day's title will require.
+		switch( $this->scale->day->iStyle ) {
+		    case DAYSTYLE_LONG :
+			$txt = "Monday";
+			break;
+		    case DAYSTYLE_LONGDAYDATE1 :
+			$txt =  "Monday 23 Jun";
+			break;
+		    case DAYSTYLE_LONGDAYDATE2 :
+			$txt =  "Monday 23 Jun 2003";
+			break;
+		    case DAYSTYLE_SHORT : 
+			$txt =  "Mon";
+			break;
+		    case DAYSTYLE_SHORTDAYDATE1 : 
+                        $txt =  "Mon 23/6";
+			break;
+		    case DAYSTYLE_SHORTDAYDATE2 :
+			$txt =  "Mon 23 Jun";
+			break;
+		    case DAYSTYLE_SHORTDAYDATE3 :
+			$txt =  "Mon 23";
+			break;
+		    case DAYSTYLE_SHORTDATE1 :
+                        $txt =  "23/6";
+			break;
+		    case DAYSTYLE_SHORTDATE2 :
+			$txt =  "23 Jun";
+			break;
+		    case DAYSTYLE_SHORTDATE3 :
+			$txt =  "Mon 23";
+			break;
+		    case DAYSTYLE_SHORTDATE4 :
+			$txt =  "88";
+			break;
+		    case DAYSTYLE_CUSTOM :
+			$txt = date($this->scale->day->iLabelFormStr,
+				    strtotime('2003-12-20 18:00'));
+			break;
+		    case DAYSTYLE_ONELETTER :
+		    default:
+			$txt = "M";
+			break;
+		}
+		$fw = $this->scale->day->GetStrWidth($this->img,$txt)+6;
+	    }
+
+	    // If we have hours enabled we must make sure that each day has enough
+	    // space to fit the number of hours to be displayed.
+	    if( $this->scale->IsDisplayHour() ) {
+		// Depending on what format the user has choose we need different amount
+		// of space. We therefore create a typical string for the choosen format
+		// and determine the length of that string.
+		switch( $this->scale->hour->iStyle ) {
+		    case HOURSTYLE_HMAMPM:
+			$txt = '12:00pm';
+			break;
+		    case HOURSTYLE_H24:
+			// 13
+			$txt = '24';
+			break;
+		    case HOURSTYLE_HAMPM:
+			$txt = '12pm';
+			break;
+		    case HOURSTYLE_CUSTOM:
+			$txt = date($this->scale->hour->iLabelFormStr,strtotime('2003-12-20 18:00'));
+			break;
+		    case HOURSTYLE_HM24:
+		    default:
+			$txt = '24:00';
+			break;
+		}
+
+		$hfw = $this->scale->hour->GetStrWidth($this->img,$txt)+6;
+		$mw = $hfw;
+		if( $this->scale->IsDisplayMinute() ) {
+		    // Depending on what format the user has choose we need different amount
+		    // of space. We therefore create a typical string for the choosen format
+		    // and determine the length of that string.
+		    switch( $this->scale->minute->iStyle ) {
+			case HOURSTYLE_CUSTOM:
+			    $txt2 = date($this->scale->minute->iLabelFormStr,strtotime('2005-05-15 18:55'));
+			    break;
+			case MINUTESTYLE_MM:
+			default:
+			    $txt2 = '15';
+			    break;
+		    }
+		    
+		    $mfw = $this->scale->minute->GetStrWidth($this->img,$txt2)+6;
+		    $n2 = ceil(60 / $this->scale->minute->GetIntervall() );
+		    $mw = $n2 * $mfw;
+		}
+		$hfw = $hfw < $mw ? $mw : $hfw ;   
+		$n = ceil(24*60 / $this->scale->TimeToMinutes($this->scale->hour->GetIntervall()) );
+		$hw = $n * $hfw;
+		$fw = $fw < $hw ? $hw : $fw ;
+	    }
+
+	    // We need to repeat this code block here as well. 
+	    // THIS iS NOT A MISTAKE !
+	    // We really need it since we need to adjust for minutes both in the case
+	    // where hour scale is shown and when it is not shown.
+
+	    if( $this->scale->IsDisplayMinute() ) {
+		// Depending on what format the user has choose we need different amount
+		// of space. We therefore create a typical string for the choosen format
+		// and determine the length of that string.
+		switch( $this->scale->minute->iStyle ) {
+		    case HOURSTYLE_CUSTOM:
+			$txt = date($this->scale->minute->iLabelFormStr,strtotime('2005-05-15 18:55'));
+			break;
+		    case MINUTESTYLE_MM:
+		    default:
+			$txt = '15';
+			break;
+		}
+		
+		$mfw = $this->scale->minute->GetStrWidth($this->img,$txt)+6;
+		$n = ceil(60 / $this->scale->TimeToMinutes($this->scale->minute->GetIntervall()) );
+		$mw = $n * $mfw;
+		$fw = $fw < $mw ? $mw : $fw ;
+	    }
+
+	    // If we display week we must make sure that 7*$fw is enough
+	    // to fit up to 10 characters of the week font (if the week is enabled)
+	    if( $this->scale->IsDisplayWeek() ) {
+		// Depending on what format the user has choose we need different amount
+		// of space
+		$fsw = strlen($this->scale->week->iLabelFormStr);
+		if( $this->scale->week->iStyle==WEEKSTYLE_FIRSTDAY2WNBR ) {
+		    $fsw += 8;
+		}
+		elseif( $this->scale->week->iStyle==WEEKSTYLE_FIRSTDAYWNBR ) {
+		    $fsw += 7;
+		}
+		else {
+		    $fsw += 4;
+		}
+		    
+		$ww = $fsw*$this->scale->week->GetFontWidth($this->img);
+		if( 7*$fw < $ww ) {
+		    $fw = ceil($ww/7);
+		}
+	    }
+
+	    if( !$this->scale->IsDisplayDay() && !$this->scale->IsDisplayHour() &&
+		!( ($this->scale->week->iStyle==WEEKSTYLE_FIRSTDAYWNBR || 
+		    $this->scale->week->iStyle==WEEKSTYLE_FIRSTDAY2WNBR) && $this->scale->IsDisplayWeek() ) ) {
+		// If we don't display the individual days we can shrink the
+		// scale a little bit. This is a little bit pragmatic at the 
+		// moment and should be re-written to take into account
+		// a) What scales exactly are shown and 
+		// b) what format do they use so we know how wide we need to
+		// make each scale text space at minimum.
+		$fw /= 2;
+		if( !$this->scale->IsDisplayWeek() ) {
+		    $fw /= 1.8;
+		}
+	    }
+
+	    // Has the user specified a width or do we need to
+	    // determine it?
+	    if( $this->img->width <= 0 ) {
+		// Now determine the width for the activity titles column
+
+		// Firdst find out the maximum width of each object column
+		$cw = $this->GetMaxActInfoColWidth() ;
+		$this->scale->actinfo->SetMinColWidth($cw); 
+		$titlewidth = max(max($this->GetMaxLabelWidth(),
+				      $this->scale->tableTitle->GetWidth($this->img)), 
+				  $this->scale->actinfo->GetWidth($this->img));
+
+		// Add the width of the vertivcal divider line
+		$titlewidth += $this->scale->divider->iWeight*2;
+
+
+		// Now get the total width taking 
+		// titlewidth, left and rigt margin, dayfont size 
+		// into account
+		$width = $titlewidth + $nd*$fw + $lm+$rm;
+	    }
+	    else
+		$width = $this->img->width;
+
+	    $width = round($width);
+	    $height = round($height);
+	    if( $width > MAX_GANTTIMG_SIZE_W || $height > MAX_GANTTIMG_SIZE_H ) {
+		JpgraphError::RaiseL(6007,$width,$height);
+//("Sanity check for automatic Gantt chart size failed. Either the width (=$width) or height (=$height) is larger than MAX_GANTTIMG_SIZE. This could potentially be caused by a wrong date in one of the activities.");
+	    }
+						
+	    $this->img->CreateImgCanvas($width,$height);			
+	    $this->img->SetMargin($lm,$rm,$tm,$bm);
+	}
+    }
+
+    // Return an array width the maximum width for each activity
+    // column. This is used when we autosize the columns where we need
+    // to find out the maximum width of each column. In order to do that we
+    // must walk through all the objects, sigh...
+    function GetMaxActInfoColWidth() {
+	$n = count($this->iObj);
+	if( $n == 0 ) return;
+	$w = array();
+	$m = $this->scale->actinfo->iLeftColMargin + $this->scale->actinfo->iRightColMargin;
+	
+	for( $i=0; $i < $n; ++$i ) {
+	    $tmp = $this->iObj[$i]->title->GetColWidth($this->img,$m);
+	    $nn = count($tmp);
+	    for( $j=0; $j < $nn; ++$j ) {
+		if( empty($w[$j]) ) 
+		    $w[$j] = $tmp[$j];
+		else 
+		    $w[$j] = max($w[$j],$tmp[$j]);
+	    }
+	}
+	return $w;
+    }
+
+    // Stroke the gantt chart
+    function Stroke($aStrokeFileName="") {	
+
+
+	// If the filename is the predefined value = '_csim_special_'
+	// we assume that the call to stroke only needs to do enough
+	// to correctly generate the CSIM maps.
+	// We use this variable to skip things we don't strictly need
+	// to do to generate the image map to improve performance
+	// a best we can. Therefor you will see a lot of tests !$_csim in the
+	// code below.
+	$_csim = ($aStrokeFileName===_CSIM_SPECIALFILE);
+
+	// Should we autoscale dates?
+	if( !$this->scale->IsRangeSet() ) {
+	    list($min,$max) = $this->GetBarMinMax();
+	    $this->scale->SetRange($min,$max);
+	}
+
+	$this->scale->AdjustStartEndDay();
+
+	// Check if we should autoscale the image
+	$this->AutoSize();
+		
+	// Should we start from the top or just spread the bars out even over the
+	// available height
+	$this->scale->SetVertLayout($this->iLayout);			
+	if( $this->iLayout == GANTT_FROMTOP ) {
+	    $maxheight=max($this->GetMaxLabelHeight(),$this->GetMaxBarAbsHeight());
+	    $this->scale->SetVertSpacing($maxheight*(1+$this->iLabelVMarginFactor));
+	}
+	// If it hasn't been set find out the maximum line number
+	if( $this->scale->iVertLines == -1 ) 
+	    $this->scale->iVertLines = $this->GetBarMaxLineNumber()+1; 	
+		
+	$maxwidth=max($this->scale->actinfo->GetWidth($this->img),
+		      max($this->GetMaxLabelWidth(),
+		      $this->scale->tableTitle->GetWidth($this->img)));
+
+	$this->scale->SetLabelWidth($maxwidth+$this->scale->divider->iWeight);//*(1+$this->iLabelHMarginFactor));
+
+	if( !$_csim ) {
+	    $this->StrokePlotArea();
+	    if( $this->iIconDepth == DEPTH_BACK ) {
+		$this->StrokeIcons();
+	    }
+	}
+
+	$this->scale->Stroke();
+
+	if( !$_csim ) {
+	    // Due to a minor off by 1 bug we need to temporarily adjust the margin
+	    $this->img->right_margin--;
+	    $this->StrokePlotBox();
+	    $this->img->right_margin++;
+	}
+
+	// Stroke Grid line
+	$this->hgrid->Stroke($this->img,$this->scale);
+
+	$n = count($this->iObj);
+	for($i=0; $i < $n; ++$i) {
+	    //$this->iObj[$i]->SetLabelLeftMargin(round($maxwidth*$this->iLabelHMarginFactor/2));
+	    $this->iObj[$i]->Stroke($this->img,$this->scale);
+	}
+
+	$this->StrokeTitles();
+
+	if( !$_csim ) {
+	    $this->StrokeConstrains();
+	    $this->footer->Stroke($this->img);
+
+	    if( $this->iIconDepth == DEPTH_FRONT) {
+		$this->StrokeIcons();
+	    }
+
+	    // Should we do any final image transformation
+	    if( $this->iImgTrans ) {
+		if( !class_exists('ImgTrans') ) {
+		    require_once('jpgraph_imgtrans.php');
+		}
+	    
+		$tform = new ImgTrans($this->img->img);
+		$this->img->img = $tform->Skew3D($this->iImgTransHorizon,$this->iImgTransSkewDist,
+						 $this->iImgTransDirection,$this->iImgTransHighQ,
+						 $this->iImgTransMinSize,$this->iImgTransFillColor,
+						 $this->iImgTransBorder);
+	    }
+	    
+	    
+	    // If the filename is given as the special "__handle"
+	    // then the image handler is returned and the image is NOT
+	    // streamed back
+	    if( $aStrokeFileName == _IMG_HANDLER ) {
+		return $this->img->img;
+	    }
+	    else {
+		// Finally stream the generated picture					
+		$this->cache->PutAndStream($this->img,$this->cache_name,$this->inline,
+					   $aStrokeFileName);		
+	    }
+	}
+    }
+
+    function StrokeConstrains() {
+	$n = count($this->iObj);
+
+	// Stroke all constrains
+	for($i=0; $i < $n; ++$i) {
+
+	    // Some gantt objects may not have constraints associated with them
+	    // for example we can add IconPlots which doesn't have this property.
+	    if( empty($this->iObj[$i]->constraints) ) continue;
+
+	    $numConstrains = count($this->iObj[$i]->constraints);
+
+	    for( $k = 0; $k < $numConstrains; $k++ ) {
+		$vpos = $this->iObj[$i]->constraints[$k]->iConstrainRow;
+		if( $vpos >= 0 ) {
+		    $c1 = $this->iObj[$i]->iConstrainPos;
+
+		    // Find out which object is on the target row
+		    $targetobj = -1;
+		    for( $j=0; $j < $n && $targetobj == -1; ++$j ) {
+			if( $this->iObj[$j]->iVPos == $vpos ) {
+			    $targetobj = $j;
+			}
+		    }
+		    if( $targetobj == -1 ) {
+			JpGraphError::RaiseL(6008,$this->iObj[$i]->iVPos,$vpos);
+//('You have specifed a constrain from row='.$this->iObj[$i]->iVPos.' to row='.$vpos.' which does not have any activity.');
+		    }
+		    $c2 = $this->iObj[$targetobj]->iConstrainPos;
+		    if( count($c1) == 4 && count($c2 ) == 4) {
+			switch( $this->iObj[$i]->constraints[$k]->iConstrainType ) {
+			    case CONSTRAIN_ENDSTART:
+				if( $c1[1] < $c2[1] ) {
+				    $link = new GanttLink($c1[2],$c1[3],$c2[0],$c2[1]);
+				}
+				else {
+				    $link = new GanttLink($c1[2],$c1[1],$c2[0],$c2[3]);
+				}
+				$link->SetPath(3);
+				break;
+			    case CONSTRAIN_STARTEND:
+				if( $c1[1] < $c2[1] ) {
+				    $link = new GanttLink($c1[0],$c1[3],$c2[2],$c2[1]);
+				}
+				else {
+				    $link = new GanttLink($c1[0],$c1[1],$c2[2],$c2[3]);
+				}
+				$link->SetPath(0);
+				break;
+			    case CONSTRAIN_ENDEND:
+				if( $c1[1] < $c2[1] ) {
+				    $link = new GanttLink($c1[2],$c1[3],$c2[2],$c2[1]);
+				}
+				else {
+				    $link = new GanttLink($c1[2],$c1[1],$c2[2],$c2[3]);
+				}
+				$link->SetPath(1);
+				break;
+			    case CONSTRAIN_STARTSTART:
+				if( $c1[1] < $c2[1] ) {
+				    $link = new GanttLink($c1[0],$c1[3],$c2[0],$c2[1]);
+				}
+				else {
+				    $link = new GanttLink($c1[0],$c1[1],$c2[0],$c2[3]);
+				}
+				$link->SetPath(3);
+				break;
+			    default:
+				JpGraphError::RaiseL(6009,$this->iObj[$i]->iVPos,$vpos);
+//('Unknown constrain type specified from row='.$this->iObj[$i]->iVPos.' to row='.$vpos);
+				break;
+			}
+
+			$link->SetColor($this->iObj[$i]->constraints[$k]->iConstrainColor);
+			$link->SetArrow($this->iObj[$i]->constraints[$k]->iConstrainArrowSize,
+					$this->iObj[$i]->constraints[$k]->iConstrainArrowType);
+ 
+			$link->Stroke($this->img);
+		    }
+		}
+	    }
+	}
+    }
+
+    function GetCSIMAreas() {
+	if( !$this->iHasStroked )
+	    $this->Stroke(_CSIM_SPECIALFILE);
+
+	$csim = $this->title->GetCSIMAreas();
+	$csim .= $this->subtitle->GetCSIMAreas();
+	$csim .= $this->subsubtitle->GetCSIMAreas();
+
+	$n = count($this->iObj);
+	for( $i=$n-1; $i >= 0; --$i ) 
+	    $csim .= $this->iObj[$i]->GetCSIMArea();
+	return $csim;
+    }
+}
+
+//===================================================
+// CLASS PredefIcons
+// Description: Predefined icons for use with Gantt charts
+//===================================================
+DEFINE('GICON_WARNINGRED',0);
+DEFINE('GICON_TEXT',1);
+DEFINE('GICON_ENDCONS',2);
+DEFINE('GICON_MAIL',3);
+DEFINE('GICON_STARTCONS',4);
+DEFINE('GICON_CALC',5);
+DEFINE('GICON_MAGNIFIER',6);
+DEFINE('GICON_LOCK',7);
+DEFINE('GICON_STOP',8);
+DEFINE('GICON_WARNINGYELLOW',9);
+DEFINE('GICON_FOLDEROPEN',10);
+DEFINE('GICON_FOLDER',11);
+DEFINE('GICON_TEXTIMPORTANT',12);
+
+class PredefIcons {
+    var $iBuiltinIcon = null;
+    var $iLen = -1 ;
+
+    function GetLen() {
+	return $this->iLen ; 
+    }
+
+    function GetImg($aIdx) {
+	if( $aIdx < 0 || $aIdx >= $this->iLen ) {
+	    JpGraphError::RaiseL(6010,$aIdx);
+//('Illegal icon index for Gantt builtin icon ['.$aIdx.']');
+	}
+	return Image::CreateFromString(base64_decode($this->iBuiltinIcon[$aIdx][1]));   
+    }
+
+    function PredefIcons() {
+	//==========================================================
+	// warning.png
+	//==========================================================
+	$this->iBuiltinIcon[0][0]= 1043 ;
+	$this->iBuiltinIcon[0][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAA'.
+	    'B3RJTUUH0wgKFSgilWPhUQAAA6BJREFUeNrtl91rHFUYh5/3zMx+Z5JNUoOamCZNaqTZ6IWIkqRiQWmi1IDetHfeiCiltgXBP8AL'.
+	    '0SIUxf/AvfRSBS9EKILFFqyIH9CEmFZtPqrBJLs7c+b1YneT3WTTbNsUFPLCcAbmzPt73o9zzgzs2Z793231UOdv3w9k9Z2uzOdA'.
+	    '5+2+79yNeL7Hl7hw7oeixRMZ6PJM26W18DNAm/Vh7lR8fqh97NmMF11es1iFpMATqdirwMNA/J4DpIzkr5YsAF1PO6gIMYHRdPwl'.
+	    'oO2elmB+qH3sm7XozbkgYvy8SzYnZPtcblyM6I+5z3jQ+0vJfgpEu56BfI9vUkbyi2HZd1QJoeWRiAjBd4SDCW8SSAOy6wBHMzF7'.
+	    'YdV2A+ROuvRPLfHoiSU0EMY/cDAIhxJeGngKaN1VgHyPL7NBxI1K9P4QxBzw3K1zJ/zkG8B9uwaQ7/HNsRZv9kohBGD0o7JqMYS/'.
+	    '/ynPidQw/LrBiPBcS/yFCT95DvB2BWAy4575PaQbQKW+tPd3GCItu2odKI++YxiKu0d26oWmAD7paZU/rLz37VqIijD2YbnzNBBE'.
+	    'IBHf8K8qjL7vYhCGErEU8CTg3xXAeMp96GrJEqkyXkm9Bhui1xfsunjdGhcYLq+IzjsGmBt5YH/cmJkFq6gIqlon3u4LxdKGuCIo'.
+	    'Qu41g0E41po+2R33Xt5uz9kRIB2UTle7PnfKrROP1HD4sRjZlq0lzhwoZ6rDNeTi3nEg1si/7FT7kYQbXS6E5E65tA5uRF9tutq0'.
+	    'K/VwAF+/FbIYWt6+tjQM/AqUms7A4Wy6d7YSfSNxgMmzi0ycWWworio4QJvj4LpuL5BqugTnXzzqJsJwurrlNhJXFaavW67NRw3F'.
+	    'q+aJcCQVe9fzvJGmAY7/dPH0gi0f64OveGxa+usCuQMeZ0+kt8BVrX+qPO9Bzx0MgqBvs+a2PfDdYIf+WAjXU1ub4tqNaPPzRs8A'.
+	    'blrli+WVn79cXn0cWKl+tGx7HLc7pu3CSmnfitL+l1UihAhwjFkPQev4K/fSABjBM8JCaFuurJU+rgW41SroA8aNMVNAFtgHJCsn'.
+	    'XGy/58QVxAC9MccJtZ5kIzNlW440WrJ2ea4YPA9cAooA7i0A/gS+iqLoOpB1HOegqrYB3UBmJrAtQAJwpwPr1Ry92wVlgZsiYlW1'.
+	    'uX1gU36dymgqYxJIJJNJT1W9QqHgNwFQBGYqo94OwHZQUuPD7ACglSvc+5n5T9m/wfJJX4U9qzEAAAAASUVORK5CYII=' ; 
+
+	//==========================================================
+	// edit.png
+	//==========================================================
+	$this->iBuiltinIcon[1][0]= 959 ;
+	$this->iBuiltinIcon[1][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAFgAWABY9j+ZuwAAAAlwSFlz'.
+	    'AAALEAAACxABrSO9dQAAAAd0SU1FB9AKDAwbIEXOA6AAAAM8SURBVHicpdRPaBxlHMbx76ZvsmOTmm1dsEqQSIIsEmGVBAQjivEQ'.
+	    'PAUJngpWsAWlBw8egpQepKwplN4ULEG9CjkEyUFKlSJrWTG0IU51pCsdYW2ncUPjdtp9Z+f3vuNhu8nKbmhaf5cZeGc+PO8zf1Lc'.
+	    'm0KhkACICCKCMeaBjiLC0tLSnjNvPmuOHRpH0TZTU1M8zBi9wakzn7OFTs5sw8YYACYmJrre7HkeuVyu69qPF77hlT1XmZ0eQ03O'.
+	    'wOLJTvhBx1rLz18VmJ0eY+jVd2FxDkKXnvYLHgb97OgLzE4ON9Hzc1B1QaQzsed5O0Lta3Ec89OnR5h5McfQ+Mw2qgQUnfBOPbZ3'.
+	    'bK3l+xOvMT0+3ERLp5FNF6UEjcL32+DdVmGt5WLhDYYPZrbRqreFumXwql0S3w9tnDvLWD5PZigPpdOwuYpSCo3C8wU3UHxQdHbf'.
+	    'cZIkNM6dxcnlUM4k1eUFMlUPpUADbpkttFarHe6oYqeOr6yt4RzMQHYUcUsQVtGicHDwKprViuLDkkOtVnsHCHZVRVy/zcj1i5Af'.
+	    'h8AjdIts+hUcGcYPK3iBtKM3gD/uAzf/AdY2mmmVgy6X8YNNKmGIvyloPcB8SUin07RQ4EZHFdsdG0wkJEnEaHAJxvKEpSLeaokV'.
+	    'r4zWmhUZYLlY4b1D03y5eIEWCtS7vsciAgiIxkQRabWOrlQor66y4pUphoJb1jiO4uO5o0S3q6RSqVbiOmC7VCEgAhLSaDQ48dH7'.
+	    'vD46REY0iysegSjKQciRt99ib7qXwX0O+pG4teM6YKHLB9JMq4mTmF9/+AKA4wvLZByH7OgYL7+UY2qvw/7Bfg5kHiXjJFyv3CGO'.
+	    'Y1rof+BW4t/XLiPG0DCGr79d4XzRxRnIMn98huXSTYyJ6et1UNYQhRvcinpJq86H3wGPPPM0iBDd+QffD1g4eZjLvuG7S1Wef26E'.
+	    'J7L7eSx7gAHVg7V3MSbi6m/r93baBd6qQjerAJg/9Ql/XrvG0ON1+vv7GH3qSfY5fahUnSTpwZgIEQesaVXRPbHRG/xyJSAxMYlp'.
+	    'EOm71HUINiY7mGb95l/8jZCyQmJjMDGJjUmsdCROtZ0n/P/Z8v4Fs2MTUUf7vYoAAAAASUVORK5CYII=' ; 
+
+	//==========================================================
+	// endconstrain.png
+	//==========================================================
+	$this->iBuiltinIcon[2][0]= 666 ;
+	$this->iBuiltinIcon[2][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlz'.
+	    'AAALDwAACw8BkvkDpQAAAAd0SU1FB9ALEREILkh0+eQAAAIXSURBVHictZU9aFNRFMd/N81HX77aptJUWmp1LHRpIcWhg5sIDlUQ'.
+	    'LAXB4t7RRUpwEhy7iQ46CCIoSHcl0CFaoVARU2MFMYktadLXJNok7x2HtCExvuYFmnO4w/3gx+Gc/z1HKRTdMEdXqHbB/sgc/sic'.
+	    'nDoYAI8XwDa8o1RMLT+2hAsigtTvbIGVqhX46szUifBGswUeCPgAGB7QeLk0X4Ork+HOxo1VgSqGASjMqkn8W4r4vVtEgI/RRQEL'.
+	    'vaoGD85cl5V3nySR/S1mxWxab7f35PnntNyMJeRr9kCMqiHTy09EoeToLwggx6ymiMOD/VwcD7Oa/MHkcIiQx026WGYto5P/U+ZZ'.
+	    '7gD0QwDuT5z9N3LrVPi0Xs543eQPKkRzaS54eviJIp4tMFQFMllAWN2qcRZHBnixNM8NYD162xq8u7ePSQ+GX2Pjwxc2dB2cLtB8'.
+	    '7GgamCb0anBYBeChMtl8855CarclxU1gvViiUK4w2OMkNDnGeJ8bt9fH90yOnOkCwLFTwhzykhvtYzOWoBBbY//R3dbaNTYhf2RO'.
+	    'QpeuUMzv188MlwuHy0H13HnE48UzMcL0WAtUHX8OxZHoG1URiFw7rnLLCswuSPD1ulze/iWjT2PSf+dBXRFtVVGIvzqph0pQL7VE'.
+	    'avXYaXXxPwsnt0imdttCocMmZBdK7YU9D8wuNOW0nXc6QWzPsSa5naZ1beb9BbGB6dxGtMnXAAAAAElFTkSuQmCC' ; 
+
+	//==========================================================
+	// mail.png
+	//==========================================================
+	$this->iBuiltinIcon[3][0]= 1122 ;
+	$this->iBuiltinIcon[3][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlz'.
+	    'AAALEAAACxABrSO9dQAAAAd0SU1FB9AJHAMfFvL9OU8AAAPfSURBVHictZRdaBRXFMd/987H7tbNx8aYtGCrEexDsOBDaKHFxirb'.
+	    'h0qhsiY0ykppKq1osI99C4H2WSiFFMHWUhXBrjRi0uCmtSEUGgP1QWqhWjGkoW7M1kTX3WRn5p4+TJJNGolQ6IXDnDtz+N0z/3PP'.
+	    'UWBIpdpYa23b9g09PZ2kUrOrvmUyGVKp1Ao/mUyi56YnVgWfO/P1CihAd/dJMpmaNROIRq8BkM1m0bH6TasC3j6QXgFdXI+DR6PR'.
+	    'JX/Pno8B+KLnMKqlpUU8z8MYs2RBEDzWf9J+0RcRbMdxGBsbw/fmCXwPMUEYID4iAVp8wIRmDIHMo4yHSIBSASKC+CWE0C/PF9jU'.
+	    '3B6Cp+4M07C5FUtKGNvGwQJctPgIsgD2wRhEIqAMGB+UQYkHJgYYZD7P1HwVlmWhHcfhyk83KeRGUW4t6CgoG5SNUS4KBWgQDUov'.
+	    '7AGlwYASBVqH0Bk49dXpCviVV3dw/tI1Bvr7kMIIlh0NYUpjlF0BAYvcxSXmEVLKceHSCJm+PnbueBHbtkNwTXUNBzo6aGpq4sSZ'.
+	    'GwT5H7BsF6Wdf1GWHQAoM0upeI9PT1yioS7B7tdaSdSuw7KsUGMAy7HYsmUztTW1nMwM0txssX1rlHjjS5jy/Uq2YkK/eJuLl6/z'.
+	    'x+1xkslW6mrixGIODx8EFSlEBC0+tmXT0NhA2763iEUjnLv4C8XpUbSbAB1mKkGJ3J83Od77HW5EszvZSqK2iljMIeJaRGNuJePF'.
+	    '6mspY7BJ1DXwQnCd2fxGRq5OUCz8xt72dyhMZcn++Cu3xu9SKhdp2b4ZHWnAtTSxmIWlhcIjlksR3lNBYzlxZsb7+f7ne+xtSzOd'.
+	    'u83szH1OnThOPp/n+a0beeP1l4mvq+PU2Qyd+5PY1RuwlAqLYFaBfbTbyPSdfgaH77A//QF4f1O/vpr6RJyq+C5Kc/M8FbFxXItY'.
+	    'xOHDrvfo/fxLDnbsJBp5BowBReVWYAzabeTh5ABDw7cWoNNL3YYYNtSv57lnn6Z+Qx01VeuIuBa2DV1HD3H63BAPZu4u1WGpeLHq'.
+	    'Rh7+NcjA0O+0p4+CNwXigwnbWlQQdpuEpli+n+PIkcOc//YKuckJJFh2K2anrjFw+QZt6S6kPImIF/b+cqAJD1LihWAxC61twBTo'.
+	    'fPcQF/oGsVW5ovHQlavs2/8+uYnRVSOUgHAmmAClBIOBwKC0gPjhIRgEIX2wg7NnwpZW3d3d4vs+vu8TBMGK51rvPM9b8hdteZxd'.
+	    'LBbVR8feJDs0Rlv6GFKeXJ21rNRXESxMPR+CBUl0nN7PjtO+dye7Up/8v1I88bf/ixT/AO1/hZsqW+C6AAAAAElFTkSuQmCC' ; 
+
+	//==========================================================
+	// startconstrain.png
+	//==========================================================
+	$this->iBuiltinIcon[4][0]= 725 ;
+	$this->iBuiltinIcon[4][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlz'.
+	    'AAALDgAACw4BQL7hQQAAAAd0SU1FB9ALEREICJp5fBkAAAJSSURBVHic3dS9a1NRGMfx77kxtS+xqS9FG6p1ER3qVJpBQUUc3CRU'.
+	    'BwURVLB1EAuKIP0THJQiiNRJBK3iJl18AyeltRZa0bbaJMbUNmlNSm5e7s25j0NqpSSmyag/OMM9POdzDuflwn8djz8gClVRrVEV'.
+	    'ur4Bl1FTNSzLrSS6vbml0jUUwSXj8Qfk3PkLtLW2AeBIybmrgz3+gFzpucjlE4f4btuFTuWuCF5XDr3a3UPf6cM8GQvxzbsRAJdh'.
+	    'ScfxSywml5j7mVypN0eGEJ0tebIre+zxB6Tv7jPReS2hREpOvpmUXU+H5eC913JnNCSRVE60pUVbWoZjprR39Yq70bdqj4pW7PEH'.
+	    '5FpvL9e79jOTTHM7ssDL6CJZ08LbvAGnrpZg2mI2Z/MlZfN8IkxuSwu4V9+WIrj7zFlOHfXzKrLIi2SGh5ECKjnNVNxkQEc55vOw'.
+	    'rb6O8JLFdHyJ+ayFElUeHvjwkfteL/V7fKTSkFvIQE4DoLI2Mz/muTkTApcBKIwaN8pwIUrKw+ajWwDknAO0d/r4zFaMuRS63sWm'.
+	    'RoOdm+vRIriUYjKexrQV+t1o0YEVwfZSVJmD/dIABJuO0LG3lRFx0GOfiAELE9OgCrfU0XnIp5FwGLEy5WEAOxlR5uN+ARhP7GN3'.
+	    '5w7Gv4bQI2+xpt4jjv2nWBmIlcExE2vDAHYioszBZXw6CPE4ADoWVHmd/tuwlZR9eXYyoszBfpiNQqaAOU5+TXRN+DeeenADPT9b'.
+	    'EVgKVsutKPl0TGWGhwofoquaoKK4apsq/tH/e/kFwBMXLgAEKK4AAAAASUVORK5CYII=' ; 
+
+	//==========================================================
+	// calc.png
+	//==========================================================
+	$this->iBuiltinIcon[5][0]= 589 ;
+	$this->iBuiltinIcon[5][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAA4AIwBbgMF12wAAAAlwSFlz'.
+	    'AAALEQAACxEBf2RfkQAAAAd0SU1FB9AHBxQeFsqn0wQAAAHKSURBVHicnZWff+RAGIef3U/gcOEgUAgUCgcLhYXCwsHBQeGgUDgs'.
+	    'FgMHB4VA/4Bg4XChWFgIFIqBwkJhsRAYeOGF+TQHmWSTTbKd9pU37/x45jvfTDITXEynAbdWKVQB0NazcVm0alcL4rJaRVzm+w/e'.
+	    '3iwAkzbYRcnnYgI04GCvsxxSPabYaEdt2Ra6D0atcvvvDmyrMWBX1zPq2ircP/Tk98DiJtjV/fim6ziOCL6dDHZNhxQ3arIMsox4'.
+	    'vejleL2Ay9+jaw6A+4OSICG2cacGKhsGxg+CxeqAQS0Y7BYJvowq7iGMOhXHEfzpvpQkA9bLKgOgWKt+4Lo1mM9hs9m17QNsJ70P'.
+	    'Fjc/O52joogoX8MZKiBiAFxd9Z1vcj9wfSpUlDRNMcYQxzFpmnJ0FPH8nDe1MQaWSz9woQpWSZKEojDkeaWoKAyr1tlu+s48wfVx'.
+	    'u7n5i7jthmGIiEGcT+36PP+gFeJrxWLhb0UA/lb4ggGs1T0rZs0zwM/ZjNfilcIY5tutPxgOW3F6dUX464LrKILLiw+A7WErrl+2'.
+	    'rABG1EL/BilZP8DjU2uR4U+2E49P1Z8QJmNXUzl24A9GBT0IruCfi86d9x+D12RGzt+pNAAAAABJRU5ErkJggg==' ; 
+
+	//==========================================================
+	// mag.png
+	//==========================================================
+	$this->iBuiltinIcon[6][0]= 1415 ;
+	$this->iBuiltinIcon[6][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlz'.
+	    'AAALDAAACwwBP0AiyAAAAAd0SU1FB9ALDxEWDY6Ul+UAAAUESURBVHicdZVrbFRFGIafsyyF0nalV1R6WiggaAptlzsr1OgEogmC'.
+	    '0IgoBAsBgkIrBAPEhBj/AP6xRTCUFEwRI4jcgsitXMrFCJptJWvBNpXYbbXtbtttt6e7e86ec/yxadlCfZPJZDIz73zzzjfvR2VL'.
+	    'F7U+hf0HD2JduIzTFy6SlJRkPtkcDgdCCE65OxFC8NPV6wghyM7OptankJ2dzbSC5QghEEIgCSHog9PpNAF27dlN6miZuPgElB4/'.
+	    'nmY3O7ZtByA1NVUCkGWZweD1eklJScESTbqxuIjrd+/x6uIl5M19hSy7nfGOeUxf+g7VjU1sKi7C4/GYsiyz7tAJAD4/cRaA1tZW'.
+	    'AHIPnECUVGD1+/3U19ebG4uLeHf1akamjsIwoVnVCOvQEdLoVILYYmMo3PIxSBJflpSaDX5FAmju1QAYv/8k/s8+wLVxOU0jR2LZ'.
+	    '8sMFAApWrCApbRRDrRZirBYSLBKaoRPQw3SFernf2sav7T0Ubt4KwL4FMwF4Vu8FoHBCKgCzDhwHwLIhZ7y5a89u4m2JhA0wTdDC'.
+	    'OrphEjJMNElCHxKDEjaobmvlfo/Krj27CQQCJsCGJW8C0KXqAMxMiosQA8hZWcTFx9OsaniDKh1qmG7VoFsL0x0K06kbeAMhWpRe'.
+	    '/KpG+gwHAKUnz7Dz3BUMw6DK18nuw99wt0Nh6VdHI8RJicmETQgFg7SFwjSrGv+oKp6ghldV6dZ0ugJBlF6FmCESQ2w2AIqXLsan'.
+	    'BrFYLJTnTCBrdBqveeopWZiPFaBHUegJhegMqGgxEkHDwB/UaQ9rdIV06v0+TD2EEQjQFtAY0dsNgNvt5sialQAIIXh7wQKuVf6J'.
+	    'gTsSccPDWlQstClBGjr9eHpVWvUQncEwdYEedF8noQ4vmYmpZMTH0nTvDn25vLbrNmu7bvfnsYEbAMnhcPDgwQPzUo2LJusw/mhp'.
+	    'QwlHNO0KBAnoIfxtrcQMT2De1Mm891wyUzNlUlJSpIyMDBobGzlzr5rFM/Koq6vrP8ASGxsLwPmKcvIShjPGZiPOakE3VFB8hHwd'.
+	    'vJAxhrk5L7Ly+RQuH/sWgPdXrwFg/6HDFBUsIj09nehfbAWwPWOT9n5RYhqGwarNWxkRM5TRCfF4U1PQsDDJFk9uYhwXvzvKjm3b'.
+	    'KSsro3DJInNW5RXp7u2bAKSlpeH1esnPz6eqqgqLpmmcr3Fht9ulfaV7mZk1Bs+lM6T1djM9fhg5egDPpTNMy5TZsW07kydPYdWM'.
+	    'aXx96ixOp9O8cfUa80srmDpjOgAulytiQqZpMnvObLbt/JTtHxXj9/tRVdU0DGOAufRpevPDTeac0hJyc3NxOOawfv161lVWS6eX'.
+	    'z+9/UOCxu1VWVvaTRGv16NFfjB2bNeAQp9NpTpmSM4DcbrdL0WsGDKLRR+52uwe1yP8jb2lpYfikyY9t80n03UCWZeaXVjw1f+zs'.
+	    'Oen+/d+pqanhzp2fKSsrw+l0mi6XiyPl5ZGITdN8fAVJwjRNJEmi1qfw1kw7siyTnJxMe3s71dXV3GpoZO64DG41NPJylvxU5D/e'.
+	    'qJKsfWQD9IkaZ2RmUvr9aV4aGYcQgjfO3aWoYBF5eXm4ewIsu/CbdPz1aWb0/p1bNoOrQxlUiuiaFo3c3FyEEOx9+C9CCD6paaTW'.
+	    'p/TXyYkTJ0Xe59jf7QOyAKDWp/QXxcFQ61P4pT3ShBBcvnUHIQTjxmX19/8BCeVg+/GPpskAAAAASUVORK5CYII=' ; 
+
+	//==========================================================
+	// lock.png
+	//==========================================================
+	$this->iBuiltinIcon[7][0]= 963 ;
+	$this->iBuiltinIcon[7][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlz'.
+	    'AAALCwAACwsBbQSEtwAAAAd0SU1FB9AKAw0XDmwMOwIAAANASURBVHic7ZXfS1t3GMY/3+PprI7aisvo2YU6h6ATA8JW4rrlsF4U'.
+	    'qiAsF9mhl0N2cYTRy9G/wptAYWPD9iJtRy5asDe7cYFmyjaXOLaMImOrmkRrjL9yTmIS3120JybWQgfb3R74wuc8Lzw858vLOUpE'.
+	    'OK6pqSm2trbY39+nu7tbPHYch7m5OcLhMIA67kWj0aMQEWk6tm17rNm2LSIie3t7ksvlJJ1OSyqVkls3Z8SyLMnlcqTTaVKpFLdu'.
+	    'zmBZVj1HeY2VUti2TSQSQSml2bZdi0QirK2tMT09zerqKtlslqGhISYnJ4nHv2N+foFsNquOe9FotLlxOBwmk8lgWRbhcFgymYxY'.
+	    'liUi0mqaJoAuIi2macrdO7fFsizx3to0Te7euV1vrXtXEgqFmJmZYWVlhXK5LB4/U9kwDL784kYV0A3DYHd3m4sXRymXywKoRi8U'.
+	    'Ch01DgQCJBIJLMsiEAhIIpHw2uLz+eqtYrEYIqKZpimxWEyCwaCMjY01zYPBIJpXqVQqsby8TLVabWKA/v5+RkZGMAyDrq4ulFKH'.
+	    'HsfjcWZnZ+ns7KTRqwcnk0mKxSKFQqGJlVKtruuSTCYB6O3trW9UI/v9/iZPB/j8s2HOnX0FgHfeXpeffnzK+fWf+fijvhLs0PtG'.
+	    'D/n1OJ9+MsrlSwb3733DwMCAt1EyPj6uACYmJp56168NU6nUqFSE9nZdPE7+WqC/r4NKTagcCJVqDaUUB5VDAA4Pa9x7sMLlSwan'.
+	    'WjRmv13D7/erpaWlo604qOp88OF7LC48rPNosMq5Th+Dgxd4/XyA1rbzADi7j8jnf2P++wdcvSr8MJ/i8eomAKlUqn41OsDAQDeD'.
+	    'g++yuPCwzm/2vU8+n2a7sMFfj79mp7BBuVzioFSiXHJx3SKuW2Rzy0Up9dxnQVvODALQerqNRn4ZKe0Mvtc6TpzpmqbxalcY9Ato'.
+	    '2v06t515C73YQftZB9GLnDrt4LoujuPgOA4Ui+C6yOpXJwZrJ7r/gv4P/u+D9W7fLxTz+1ScQxrZ3atRLaVxdjbY2d184R6/sLHe'.
+	    'opHP7/Do90Ua+WWUyezzZHObP/7cfX54/dowE1d66s8TV3oE+Mfn+L/zb4XmHPjRG9YjAAAAAElFTkSuQmCC' ; 
+
+	//==========================================================
+	// stop.png
+	//==========================================================
+	$this->iBuiltinIcon[8][0]= 889 ;
+	$this->iBuiltinIcon[8][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlz'.
+	    'AAALDwAACw8BkvkDpQAAAAd0SU1FB9AJDwEvNyD6M/0AAAL2SURBVHic1ZTLaxVnGIefb2bO5OScHJN4oWrFNqcUJYoUEgU3/Qf6'.
+	    'F7gwCkIrvdBLUtqqiLhSg9bgBduFSHZdiG5ctkJ3xRDbUFwUmghNzBDanPGMkzOX79LFJGPMOSd204U/+Bbzvd/78F4H/ieJdoad'.
+	    'pZKxRFszAI/DcP0HazXY22v+HB01kee1PA/v3zfnjx4xgGnHcNZe7OvuNj+cOEF1ZATv5nUA4jhBSgmADCVWo8Ge2Of9wb18P/G7'.
+	    'oUXmYi30zqlTVEdGWLh1g2D6MYlKkXGE0Vl8aa2GEB149+4xXSzyoOIw/mimiZV/DPb25pFOj13A9gOMEChhUEqhVYqWKUk9QAUp'.
+	    'sT/P4s8PmKlUmNhQaIJbkDVqBbpw6wZ2zUc4Nm+ePku5p4eOrgpueQOFUoVCVxcD4+N07dpF9+5tVJeWGPBjhvr7WF1zC8ASgtcP'.
+	    'H8a7eZ1odh4sh50nzwCw9ZNh3M4Stutiu0X2nB/LyjZ6lcIbVTpdQU/jWVPzLADM8+ZGBRdtC7wrF/O7bR99iu26VL86iU4SAH4b'.
+	    'Po5d6AQhstMSvGyI4wS5FJBKSRwnzF8byx/u+PjzzMF1mfryQ1K/jnCahqp1xEopjFLoNEFJSRJHzF799gWHqa+/QKcSUXBI609f'.
+	    'Al5W4teQSiHDOipNUKnMI13RvnOXAIEKQixvGWya98SC560MFwPiqEG86JM8q79Q06lvhnOndy5/B6GPCUOMUu3BQgg8z0M3GmBZ'.
+	    'iGJn3v2VmsqnfzNx7FDueODuj8ROCFpjtG5TCmOYv32bJ09msP0ISydMfnAUgF8/O45RAA6WTPjlvXcB+Gn7FuRf/zAnNX6x3ARe'.
+	    'PSdmqL+P/YHkwMGDOGWDZTlQcNBRhPEComgB/YeHfq2InF1kLlXUOkpMbio1bd7aATRD/X0M1lPeSlM2vt2X1XBZjZnpLG2tmZO6'.
+	    'LbQVOIcP+HG2UauH3xgwBqOz9Cc3l1tC24Fz+MvUDroeGNb5if9H/1dM/wLPCYMw9fryKgAAAABJRU5ErkJggg==' ; 
+
+	//==========================================================
+	// error.png
+	//==========================================================
+	$this->iBuiltinIcon[9][0]= 541 ;
+	$this->iBuiltinIcon[9][1]= 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAaVBMVEX//////2Xy8mLl5V/Z2VvMzFi/v1WyslKlpU+ZmUyMjEh/'.
+	    'f0VyckJlZT9YWDxMTDjAwMDy8sLl5bnY2K/MzKW/v5yyspKlpYiYmH+MjHY/PzV/f2xycmJlZVlZWU9MTEXY2Ms/PzwyMjLFTjea'.
+	    'AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAHdElNRQfTCAkUMSj9wWSOAAABLUlEQVR4'.
+	    '2s2U3ZKCMAxGjfzJanFAXFkUle/9H9JUKA1gKTN7Yy6YMjl+kNPK5rlZVSuxf1ZRnlZxFYAm93NnIKvR+MEHUgqBXx93wZGIUrSe'.
+	    'h+ctEgbpiMo3iQ4kioHCGxir/ZYUbr7AgPXs9bX0BCYM8vN/cPe8oQYzom3tVsSBMVHEoOJ5dm5F1RsIe9CtqGgRacCAkUvRtevT'.
+	    'e2pd6vOWF+gCuc/brcuhyARakBU9FgK5bUBWdHEH8tHpDsZnRTZQGzdLVvQ3CzyYZiTAmSIODEwzFCAdJopuvbpeZDisJ4pKEcjD'.
+	    'ijWPJhU1MjCo9dkYfiUVjQNTDKY6CVbR6A0niUSZjRwFanR0l9i/TyvGnFdqwStq5axMfDbyBksld/FUumvxS/Bd9VyJvQDWiiMx'.
+	    'iOsCHgAAAABJRU5ErkJggg==' ; 
+
+	//==========================================================
+	// openfolder.png
+	//==========================================================
+	$this->iBuiltinIcon[10][0]= 2040 ;
+	$this->iBuiltinIcon[10][1]=
+	    'iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEANAAtwClFht71AAAAAlwSFlz'.
+	    'AAALEAAACxABrSO9dQAAAAd0SU1FB9AKDQ4RIXMeaLcAAAd1SURBVHicxZd7jBXVHcc/58zcvTNzH8vusqw8FsTsKiCUUh5WBZXG'.
+	    'GkOptmqwNWsWLKXFGlEpzZI0AWNKSy0WhDS22gJKtWlTsSRqzYIuLGB2WVvDIwQMZQMsy2OFfdzde+/OnHP6x907vJaFpjb9JZM5'.
+	    'c85Mfp/f9/s7Jxn4P4e41gtSyp78WGvtfdEAcqDFYUOH9HS0NhGk9tPb/ilSyp789UUB2AMuqhQy3Uzm7HGkE6W3dTNZMRI3EcWO'.
+	    'jf9ClLmWBT3dzW8jUsevWHCG3UpWl+IkHSxnbDh/Mcz12NevBcuWXTmf6TjnXvJ88gDmVB3pw3+nt3UzHa1NqMzBS2zqPLGFjtMN'.
+	    'ZNr3XdW+qyqwZcFk76HX/tHWfuQvyO4W7qhaHwL8efkMRlRUpPv7rqD0RrJ+FgAjLy1a20OIxZJEEuNCRfIApj+om4bGM3u2/sYU'.
+	    '9J41d8973f3Dhg1pISTV1dXXBRNJxPGFCzhou+DCQrScZOkktNaeDZjamgeZ9MgiYmVDccvHhjAzJw0NTh8/alyZMaVJicp0iTHj'.
+	    'JpgNv38tjWUhhGROdbUL9W5/MH5XCkjlcibi+KIop5LVHLKEu8A/f4r286doa9pGrGwYAAsfqbbH3b8MgO/Nqgy6WvdbbXHMkEFJ'.
+	    '4xUOMVEvaTZu3BgmvF4Yk4hz9rO/Ulr5cE9owae/rcGxohSOuiWkC2IjcIqKyPZm+OmCH7GhoZEF077EEzVVweAbJ+riEeO0Ey8y'.
+	    'UubqOHn0AOgMwvf59txnBrSp9dgxKmf/+kIP1NY8SFk0jh5ajmNHAWg5b2E5EexojGHjbiVRMoRMNs0LC+Yz46vTuH3enN7BI8fr'.
+	    'qFdo0BoVZNC9aVSQ4fNjBzEmQJiARxb+/AqYPMAVB5FsPU5v37g9OxgLhe14ZM5/ju052E6MNZvf5pmHHuLmmWOkEysxUtpGAtme'.
+	    'dtHTflJkezqQto3jFRnLssyf1jydxiiM7zNnye/c3ZsqLu2BN5fcMfzrv/hby1tPzmRUoihcTJ87CwQI2yLtDcIqsIjYUf51qBlf'.
+	    'OnScOSrdQUOMURkiXsLUzJnvbGhoBGDHH5cGyZLhOpYoNl5hqYnYEXOu5fDl9eYAHntx98n8hFHZcPHUuTSxSASAeK/CGIOxJJ0f'.
+	    'bOGNPU280dgkq6Y2yu8vfjCIlwwzr+/ZQ/PHO0gOLuO5qsftDQ2NbN+4OCgqG6WTxWVaq6zpF+DiSHWnicdylp3r6aZTWthIOrNp'.
+	    'ktHcvBu0sHX1Sm6ozB3B42d90zZA9bQp7PvgPSzXZfnqX/HS4DKKK2+x69Y/HURs26iBAN5ccsfw7774UcumF37C6f07KSt2OHji'.
+	    'DEUJD0tISjyPrrSPlAKvN0JP/U4O1NfjuhG2rvklN1SOpfXwftpbTqAyKRrff5fb7rs9V1R7m4wlz2ihA3HpmXflUWyOH2umpLiY'.
+	    'ui3v8M+6bWzfsRNbSgqkxaCkiy0simMuEWEhpcRzIhQWOIAh6tiAwS4owInFiTou5dOnMnl2NR++ujBwXEc9terD6M43nrj6LgAB'.
+	    'QnDPA9/irtkP8JRS7Hr/3T6YekDQ1pEiEXOwpUVJzCVlZZFS4mZtkpEo9ChAkDp/jtLMBACy6S4RiQghLyv5cgBRPnKUOX6smUGF'.
+	    'hSil0MYw9d77mPy1e5mnFE3batm3czvb6nYgEJztSFGU9LCRlMRdUjIH0+lnEMIwPNXD3NumoVJnrMCJaiciMUZfvQnz4QcBSvV1'.
+	    'vjE5GK358t0zmXDnDB79saLpo20c+aSRD+t25JTp7GZQwsEWFiVxl6hlUf/WO9z32CxmL1rOe6u/I2KuwGhzLQCB7/sYY9Bah3el'.
+	    'FKbvrrVm4vS7GH/7ncx+chEHGz7myCeNbPtoO0JI2jq78WIRLGkzsqs7V5SfFV5EovXACoiqqsfNpk2vo5VCWtYFBfoU0VoTBAFa'.
+	    'a7TRaK2p+MoURk+cxMzq+Rzbv49DDbuo27UTW9h0dedssPxuK+kIfN8XxhgDYPVXf2Fh4XKtFIl4AiklAlBKAYRKKK36wHIweTCt'.
+	    'NfHiEkaOn8j0+7/BmDFjaT30GbHywSxcuZkpFfFg+m1jjZ/NmnVvNfRvwd69e8WBA/uNFAIh4JVXXmHsmDHE4vEQQgjQ2lxQIm9N'.
+	    'nz35q3BEOZOHzaG2thaA4mRU+L29It+IV21CpbRQfeMFC35gRB/M2rVrubnyZmLxWJhECBEmz/eHyo/7lMlH3LFFujsthNFCCGOu'.
+	    '+WNyeUgpjSVzMKtWraKyshLPdcPEeYWCIEBdpIxSivr6eta8vI7d6+cGnhdV06pe1QP+F/QXWmuRL+jZZ58LlVmxYgUVFRV4rhtu'.
+	    '4TzMxXAA6XRaRAtsYUkx8I/JtSJQOlSwpmZpCLN8+fPcdNNoHMfB9/0QJgRoP295TlR7UVv8xxZcHMuWIZ9/Hn35vG3JEGZpzVJG'.
+	    'jx5N1IlitKahsZE1L69j69qHgx+urFX/lQL9JYdLlfnZihUhzOLFi8N3Ml1dthOxVH/f/8/CtqSJ2JaJ2JZ59J7RPsC/AViJsQS/'.
+	    'dBntAAAAAElFTkSuQmCC' ;
+
+	//==========================================================
+	// folder.png
+	//==========================================================
+        $this->iBuiltinIcon[11][0]= 1824 ;
+	$this->iBuiltinIcon[11][1]=
+	    'iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlz'.
+	    'AAALEAAACxABrSO9dQAAAAd0SU1FB9ECAQgFFyd9cRUAAAadSURBVHiczdhvbBP3Hcfx9/2xfefEOA5JoCNNnIT8AdtZmYBETJsI'.
+	    '6+jQOlQihT1AYgytqzZpD1atfyYqlT1h0lRpT7aRJ4NQpRvZGELVuo5Ua9jEJDIETQsNQyPBsUJMWGPnj//e+e72wNg4xElMR6ed'.
+	    'ZNln3933dZ/f93f6yfB/sgmrHdDV1WXlPg8NDZUDScD8LFFFEZZlWYZhWMFg0Orq6sq/gDJAfFy1iiZy9OjrVnj4JzQ1rMWqfxm/'.
+	    '309jYyNtbW0kEgnu3bvH4cOH88c/jqSKQl4/XGkd+eVtAN46up1LH92ktqYS++ZX8Pv9NDQ0sGnTJlKpFOFwmO7u7vy5IyMjeVRd'.
+	    'XV1+WEOh0IrY4pDnq6wXX/sTiCJaMkFZdRNqxefoe7VtCSqXVDqdZnZ2ltraWkzTpKqqijt3JpFlG7dvj7NzZ1f++qFQyA3EClHL'.
+	    'Ql743nFkhxPDtJAd5eTaYSVUfX09lZWVlJWVIUnSg7sVQMBCUcu4ceMGe/bsIRQK1QAzOcyykIM9P0KyudAyCWyqG8nhwqa4SkLt'.
+	    '3r0bVVVxu924XC40TUOWZUQxe97CwgIdHR2LMHIxSCaVInVvFElxE0vMY1Pd2NUKJMWNTXHlUfF//4vETJCelwbpFm3MjP2dt37x'.
+	    'AlN+PzU1NViWRSwW4+7du3g8HjweD4qi5EFAJzAExIpCANbooxhplfB0FJvTg6xWIqsVRVF6MopkU3FXPcnkJxGU0VEAdF2noqKC'.
+	    'W3/8DpnqLjzep2lubsblcjE8PExHR8fboVDID9xYFpLBDpJF0jDQIncQpWlkm31FlFLtp9PfyuW/vYQj1kPSuRW/38+lj27S2Q7v'.
+	    '/aWXUBVUffVNtm3blivVCEwsC5Eyc5iiApEpDEAXMqQdldhSiWVQHjJagud+8Fuexck/zv+K82dfoSbSCsDe75/km+4GVPd6+l5t'.
+	    '4zJHcqVUYN2yEEtZQDCSJCueRAYsPY49HsFIZVG6p25JUumFafT4DKJN4amtT7Nz38sk5+5A70HMtEYyMkFiZhxzjQ/poXrLQrRU'.
+	    'DFGEeFpAlkQkm4pRiCpIKodKzk0T/2QMh+piPjxKZPwiSkUtu/b9mNnJEWS7E8nhAmvpM60oJDkXJxqNozxRRUxPIesispBBlsXV'.
+	    'UaKEFo8gzoaJhz8s2lOmrpUG+WBhJ9/60g+Z+fDXTAXfxllRjl1VkO0OFATsYhYliiK21ZKKhhHnFveUqSdKgwAEOp7F2v51vvw8'.
+	    'XH7/N1wd/BlTweuUV65BdtgfoLTSkipsdD3tRi0VYpommUwGwzDwdT5HYEc3giAwcvH3jLz3BlPB67jWeZBEKYsSBWwpHZtNKo4q'.
+	    'aHTDsJeeiGEYWJaFZVmYpommaRiGQdPnv0bb1m8gSRL/vPIOV979aR4lmAJ2p4qCgCxksNuKJ6VNpx4NYhgGpmkuQhmGQTqdxjAM'.
+	    'qr2d7HtxEEEQuH1tkKvvvkF44tqDnrIcKJKAPf1g+LAUElq8dIiu60sApmnm93Pfzc7OYhgGrie+wFe++ztcLhcT1wf54PzPCU9c'.
+	    'w7XWjWS3IdsdOAUBWZAxrRJnTQ6SG5bce2FCpmkughmGQSqVYm5uDtnj44sH38TtdhP6+Dwf//V4ttHXrkGURZJaic8RgHQ6jWma'.
+	    'SJKUL5RLKNfIOczDKF3XSSaTRCIRhLJWntp3nGfWrSMxc5OLf3iNP4+68T9Ub9nF76lTpxgfHycajZJKpdA0LZ9GbjYV7hcDWZaF'.
+	    'pmnMz88Ti8UYunSLmu1HFi2aVkxkaGjINTY2ttDb24vX6+XQoUNs3ryZ8vJyIDu1BUFYkkxhgxeiWlpaOHPmDE1NTdTX1xe98eWG'.
+	    'JnF/9dQZCoXUYDA4AOD1ejlw4ACtra2Ul5fniwmCkEcUJiUIAoFAgL6+Pnw+H21tbfT39z8SxCS7hHsfWH9/8dL4MKqnp4eWlhac'.
+	    'TmcekEvMNE2am5s5ceIEgUCA9vZ2Tp48ic/nY3j4UsmQHCYOjJHtpeBKqL1799Lc3IzT6UTXdRobGxkYGKC9vZ3W1tZ8Ko86NJ8a'.
+	    'tXHjRo4dO8bp06fZsmULGzZsoL+/n0AggNfr5ezZs/8VpGTU5OSkc//+/acBfD4f1dXV7Nq1i4aGBs6dO4fP5+Pq1SuPBbIiyjTN'.
+	    'RUnV1dUNXLhwAa/Xy44dO4jFYgBEo9FFF1r134BPuYlk16LrAYXsAlmtq6sbKDwoFAp9m+ykuP5ZQVZF3f8tCdwCov8LyHIoAANI'.
+	    'AXf/A1TI0XCDh7OWAAAAAElFTkSuQmCC' ;
+
+	//==========================================================
+	// file_important.png
+	//==========================================================
+	$this->iBuiltinIcon[12][0]= 1785 ;
+	$this->iBuiltinIcon[12][1]=
+	    'iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlz'.
+	    'AAALDwAACw8BkvkDpQAAAAd0SU1FB9ECDAcjDeD3lKsAAAZ2SURBVHicrZhPaFzHHcc/897s7lutJCsr2VHsOHWMk0MPbsBUrcnF'.
+	    'OFRdSo6FNhdB6SGHlpDmYtJCDyoxyKe6EBxKQkt7KKL0T6ABo0NbciqigtC6PhWKI2NFqqxdSd7V2/dmftPDvPd212t55dCBYfbN'.
+	    'zpvfZ77z+/1mdhUjytWrV93Hf/24eD5z9gwiMlDjOKbb7dLtdhER2u02u7u73Lp1CxEZBw4AeZwdNQqkMd9wbziFGINJUt6rRbz5'.
+	    '1ptUq1XK5TJBEAAUMHt7e+zu7gKwvLzMysoKwAng/uNg9CgQgFKlgg1DUJ67Vqtx6tQpZmdniaIIpRTOOZRSdDoddnZ2aLfbLC8v'.
+	    's7S0xJUrV7ZGwQSj1PhhfRodVdDlMrpc5vup5Z2fvMPdu3fZ29vDWjvwztjYGPV6nVqtRqVS4dKlSywtLQFsAdOH2XwsCEApg3jl'.
+	    'w98Rak2gvYjNZpNms0mSJDjnHgkDMDc3dySYQ0Ea8w139YUX0OUKulzyg7UmCEO+l1huvHuDra0t9vf3h1TJYSqVypFhHquIrlQI'.
+	    'S5qv/uIDAC7/4bcEQYAKvK+0Wq1DVQGIoog7d+4cCeaRII35hrt+8SsEOkRlUaEyR0UpFIrXHxyMVKVUKnHv3r0jwRwaNelBjBjL'.
+	    'Sz/7KYuLiwAsLi7y4z/9kY9e+TpkCuSqjI+Po7XuAWeKXLt2DWNMUZMkwRjDhQsXWFtbK6JpCCT3jfQgxomPtPX19YHWicM5x3c2'.
+	    '73Pj3Ru8/aO3mZqaolKpoHVvyuvXr/Ppnf/Q7uzz380NPtu4y/qnG+ztd1hfX2dtbQ3gIvDnRyqSxl1UoPjyz98D4PTp0wPtq39Z'.
+	    '4fdzLxegrVaLVqvF5OQkYRgWqpRKJZ77wvNsbW1RG5tgfKLOTH2G7Z1twqBQrgrMDvhInjfSOCY5iIv+hYWFgRZArEWsZWF941Bf'.
+	    'SdMUgMnJCWpjVU4cn+HUyePM1Gc4+fRUPkzBI5w1jbukcczLv/5l0XfmzJmBFuCba38r/CRXpT+CrDUoZ0jjB4RYonJAOYRobJKT'.
+	    'z5zgqfqxAbsFSH6mpHFM2qdGXh4VnoViD6mSJF2cTQeqDqBaKVHWmonJCWpZjhkC6anR5WsffTgwaHV1FaUUq6urA/2v3f5k4LnV'.
+	    'arG9tUn3oI2YBCcWHYAxMVYs1qZEZY2SFB2aYZDGfMN9d7uJiWPSeFiNo5Rclc3NTXZbO6RpF7EJVixYA9agwwDnUiqlEPdQ3imi'.
+	    'Jo27BGHIt/7x9yEjc3Nzh27Na7c/4TdffKl4bja3ae5MUIu0T/HOEIaOpJt4gwoSsVTK4SBIY77hFtY3ABBjBiZ90rKwvsH77/+K'.
+	    't37wOhO1iPpTk4SBw1mLsz6CnKQ4l3qV+kE+t9XHlNZOk+bUJLVIE1VCcIJWQmJ6qjj30NbcXLkZMt8YPig+Z3n1G5fZ39/j/vY2'.
+	    '9ckqZT2Ochbn0p4qNkU/dDfUADdXbh4HXgRO4zNdEU0XL1784PLly5w9e7Z4SazFOfGrEotDcOKrcoJPmrYIXf/Zop3QNd1skuGt'.
+	    'cUAb2MgAxvHZTgFUq1Wmp6eZnZ0F8JlTjDduDThBnDeECEoJtbGIp6enqEblzCcEZ1PECU4yVRiOGgd0gc+AB0CZvkv1sWPHOHfu'.
+	    'HOfPn8da41cpkkltEBEPJhYnBkTQJcdYVKGkgRxCfBsq5xXNgAa2Bn+hjTOgHEKBP8pzRUxykIH4ifLJRTJAl+UMBJzPHQ6bfe/f'.
+	    'cWIzPxlUpD+zugzIZtVk1d8znBAqRxgoQuVQgSJQ3h9C5QhDRYgjUILCAzlnEdsHYTKfMTEBcP7F54YUGVmc2GLlIn6ve6v0ahSt'.
+	    '8X25TzjJ+rIx1grKpQPWR4LkGVVsMgghvS0qjPdvm5OeceOTWA5Evo2mFzkjQfL7hZPUy5yvvF/uPFQL3+nbDmsLCEmT3sTmCTNr'.
+	    'rogT6yFsOix3ftw7OwQhkvSU6CuinhCk0+kAkFoBazEEICHaHHiPVmU0gnUp4EAc1mYrF0EBVpwPi34VrBkwPxKk3W5ju/e5/c+d'.
+	    'bGUHIAIuydTIE5zfc5Wr4lJcahHnHTP3CVGm78DrgY38N+DEibp7dmYKdAQmBh1hjEFjis+9CTWYGK21H6PxPyOI0DobYwzZF/z7'.
+	    '7jadTvJtYG0kCD7lfwl49ijgT1gc0AH+dZSJA/xB+Mz/GSIvFoj/B7H1mAd8CO/zAAAAAElFTkSuQmCC' ;
+
+	$this->iLen = count($this->iBuiltinIcon);
+    }
+}
+
+//===================================================
+// Global cache for builtin images
+//===================================================
+$_gPredefIcons = new PredefIcons();
+
+//===================================================
+// CLASS IconImage
+// Description: Holds properties for an icon image 
+//===================================================
+class IconImage {
+    var $iGDImage=null;
+    var $iWidth,$iHeight;
+    var $ixalign='left',$iyalign='center';
+    var $iScale=1.0;
+
+    function IconImage($aIcon,$aScale=1) {
+	GLOBAL $_gPredefIcons ; 
+	if( is_string($aIcon) ) {
+	    $this->iGDImage = Graph::LoadBkgImage('',$aIcon);
+	}
+	elseif( is_integer($aIcon) ) {
+	    // Builtin image
+	    $this->iGDImage = $_gPredefIcons->GetImg($aIcon);
+	}
+	else {
+	    JpGraphError::RaiseL(6011);
+//('Argument to IconImage must be string or integer');
+	}
+	$this->iScale = $aScale;
+	$this->iWidth = Image::GetWidth($this->iGDImage);
+	$this->iHeight = Image::GetHeight($this->iGDImage);
+    }
+
+    function GetWidth() {
+	return round($this->iScale*$this->iWidth);
+    }
+
+    function GetHeight() {
+	return round($this->iScale*$this->iHeight);
+    }
+
+    function SetAlign($aX='left',$aY='center') {
+
+	$this->ixalign = $aX;
+	$this->iyalign = $aY;
+
+    }
+
+    function Stroke(&$aImg,$x,$y) {
+
+	if( $this->ixalign == 'right' ) {
+	    $x -= $this->iWidth;
+	}
+	elseif( $this->ixalign == 'center' ) {
+	    $x -= round($this->iWidth/2*$this->iScale);
+	}
+
+	if( $this->iyalign == 'bottom' ) {
+	    $y -= $this->iHeight;
+	}
+	elseif( $this->iyalign == 'center' ) {
+	    $y -= round($this->iHeight/2*$this->iScale);
+	}
+
+	$aImg->Copy($this->iGDImage,
+		    $x,$y,0,0,
+		    round($this->iWidth*$this->iScale),round($this->iHeight*$this->iScale),
+		    $this->iWidth,$this->iHeight);
+    }
+}
+
+
+//===================================================
+// CLASS TextProperty
+// Description: Holds properties for a text
+//===================================================
+class TextProperty {
+    var $iFFamily=FF_FONT1,$iFStyle=FS_NORMAL,$iFSize=10;
+    var $iColor="black";
+    var $iShow=true;
+    var $iText="";
+    var $iHAlign="left",$iVAlign="bottom";
+    var $csimtarget='',$csimalt='';
+	
+//---------------
+// CONSTRUCTOR	
+    function TextProperty($aTxt='') {
+	$this->iText = $aTxt;
+    }		
+	
+//---------------
+// PUBLIC METHODS	
+    function Set($aTxt) {
+	$this->iText = $aTxt;
+    }
+
+    function SetCSIMTarget($aTarget,$aAltText='') {
+	if( is_string($aTarget) )
+	    $aTarget = array($aTarget);
+	$this->csimtarget=$aTarget;
+	if( is_string($aAltText) )
+	    $aAltText = array($aAltText);
+        $this->csimalt=$aAltText;
+    }
+    
+    function SetCSIMAlt($aAltText) {
+	if( is_string($aAltText) )
+	    $aAltText = array($aAltText);
+        $this->csimalt=$aAltText;
+    }
+
+    // Set text color
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+	
+    function HasTabs() {
+	if( is_string($this->iText) ) {
+	    return substr_count($this->iText,"\t") > 0;
+	}
+	elseif( is_array($this->iText) ) {
+	    return false;
+	}
+    }
+	
+    // Get number of tabs in string
+    function GetNbrTabs() {
+	if( is_string($this->iText) ) {
+	    return substr_count($this->iText,"\t") ;
+	}
+	else{
+	    return 0;
+	}
+    }
+	
+    // Set alignment
+    function Align($aHAlign,$aVAlign="bottom") {
+	$this->iHAlign=$aHAlign;
+	$this->iVAlign=$aVAlign;
+    }
+	
+    // Synonym
+    function SetAlign($aHAlign,$aVAlign="bottom") {
+	$this->iHAlign=$aHAlign;
+	$this->iVAlign=$aVAlign;
+    }
+	
+    // Specify font
+    function SetFont($aFFamily,$aFStyle=FS_NORMAL,$aFSize=10) {
+	$this->iFFamily = $aFFamily;
+	$this->iFStyle	 = $aFStyle;
+	$this->iFSize	 = $aFSize;
+    }
+
+    function IsColumns() {
+	return is_array($this->iText) ; 
+    }
+	
+    // Get width of text. If text contains several columns separated by
+    // tabs then return both the total width as well as an array with a 
+    // width for each column.
+    function GetWidth(&$aImg,$aUseTabs=false,$aTabExtraMargin=1.1) {
+	$extra_margin=4;
+	$aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	if( is_string($this->iText) ) {
+	    if( strlen($this->iText) == 0 ) return 0;
+	    $tmp = split("\t",$this->iText);
+	    if( count($tmp) <= 1 || !$aUseTabs ) {
+		return $aImg->GetTextWidth($this->iText)+2*$extra_margin;
+	    }
+	    else {
+		$tot=0;
+		$n = count($tmp);
+		for($i=0; $i < $n; ++$i) {
+		    $res[$i] = $aImg->GetTextWidth($tmp[$i]);
+		    $tot += $res[$i]*$aTabExtraMargin;
+		}
+		return array(round($tot),$res);
+	    }
+	}
+	elseif( is_object($this->iText) ) {
+	    // A single icon
+	    return $this->iText->GetWidth()+2*$extra_margin;
+	}
+	elseif( is_array($this->iText) ) {
+	    // Must be an array of texts. In this case we return the sum of the
+	    // length + a fixed margin of 4 pixels on each text string
+	    $n = count($this->iText);
+	    for( $i=0, $w=0; $i < $n; ++$i ) {
+		$tmp = $this->iText[$i];
+		if( is_string($tmp) ) {
+		    $w += $aImg->GetTextWidth($tmp)+$extra_margin;
+		}
+		else {
+		    if( is_object($tmp) === false ) {
+			JpGraphError::RaiseL(6012);
+		    }
+		    $w += $tmp->GetWidth()+$extra_margin;
+		}
+	    }
+	    return $w;
+	}
+	else {
+	    JpGraphError::RaiseL(6012);
+	}
+    }
+
+    // for the case where we have multiple columns this function returns the width of each
+    // column individually. If there is no columns just return the width of the single
+    // column as an array of one
+    function GetColWidth(&$aImg,$aMargin=0) {
+	$aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	if( is_array($this->iText) ) {
+	    $n = count($this->iText);
+	    for( $i=0, $w=array(); $i < $n; ++$i ) {
+		$tmp = $this->iText[$i];
+		if( is_string($tmp) ) {
+		    $w[$i] = $aImg->GetTextWidth($this->iText[$i])+$aMargin;
+		}
+		else {
+		    if( is_object($tmp) === false ) {
+			JpGraphError::RaiseL(6012);
+		    }
+		    $w[$i] = $tmp->GetWidth()+$aMargin;
+		}
+	    }
+	    return $w;	
+	}
+	else {
+	    return array($this->GetWidth($aImg));
+	}
+    }
+	
+    // Get total height of text
+    function GetHeight(&$aImg) {
+	$aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	return $aImg->GetFontHeight();
+    }
+	
+    // Unhide/hide the text	
+    function Show($aShow=true) {
+	$this->iShow=$aShow;
+    }
+	
+    // Stroke text at (x,y) coordinates. If the text contains tabs then the
+    // x parameter should be an array of positions to be used for each successive
+    // tab mark. If no array is supplied then the tabs will be ignored.
+    function Stroke(&$aImg,$aX,$aY) {
+	if( $this->iShow ) {
+	    $aImg->SetColor($this->iColor);
+	    $aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	    $aImg->SetTextAlign($this->iHAlign,$this->iVAlign);			
+	    if( $this->GetNbrTabs() <= 1 ) {
+		if( is_string($this->iText) ) {
+		    // Get rid of any "\t" characters and stroke string
+		    if( is_array($aX) ) $aX=$aX[0];
+		    if( is_array($aY) ) $aY=$aY[0];
+		    $aImg->StrokeText($aX,$aY,str_replace("\t"," ",$this->iText));
+		}
+		else {
+		    $n = count($this->iText);
+		    $ax = is_array($aX) ;
+		    $ay = is_array($aY) ;
+		    if( $ax && $ay ) {
+			// Nothing; both are already arrays
+		    }
+		    elseif( $ax ) {
+			$aY = array_fill(0,$n,$aY);
+		    }
+		    elseif( $ay ) {
+			$aX = array_fill(0,$n,$aX);
+		    }
+		    else {
+			$aX = array_fill(0,$n,$aX);
+			$aY = array_fill(0,$n,$aY);
+		    }
+		    $n = min($n, count($aX) ) ;
+		    $n = min($n, count($aY) ) ;
+		    for($i=0; $i < $n; ++$i ) {
+			$tmp = $this->iText[$i];
+			if( is_object($tmp) ) {
+			    $tmp->Stroke($aImg,$aX[$i],$aY[$i]);
+			}
+			else
+			    $aImg->StrokeText($aX[$i],$aY[$i],str_replace("\t"," ",$tmp));
+		    }
+		}
+	    }
+	    else {
+		$tmp = split("\t",$this->iText);
+		$n = min(count($tmp),count($aX));
+		for($i=0; $i < $n; ++$i) {
+		    $aImg->StrokeText($aX[$i],$aY,$tmp[$i]);
+		}	
+	    }
+	}
+    }
+}
+
+//===================================================
+// CLASS HeaderProperty
+// Description: Data encapsulating class to hold property 
+// for each type of the scale headers
+//===================================================
+class HeaderProperty {
+    var $iTitleVertMargin=3,$iFFamily=FF_FONT0,$iFStyle=FS_NORMAL,$iFSize=8;
+    var $iFrameColor="black",$iFrameWeight=1;
+    var $iShowLabels=true,$iShowGrid=true;
+    var $iBackgroundColor="white";
+    var $iWeekendBackgroundColor="lightgray",$iSundayTextColor="red"; // these are only used with day scale
+    var $iTextColor="black";
+    var $iLabelFormStr="%d";
+    var $grid,$iStyle=0;
+    var $iIntervall = 1;
+
+//---------------
+// CONSTRUCTOR	
+    function HeaderProperty() {
+	$this->grid = new LineProperty();
+    }
+
+//---------------
+// PUBLIC METHODS		
+    function Show($aShow=true) {
+	$this->iShowLabels = $aShow;
+    }
+
+    function SetIntervall($aInt) {
+	$this->iIntervall = $aInt;
+    }
+
+    function GetIntervall() {
+	return $this->iIntervall ;
+    }
+	
+    function SetFont($aFFamily,$aFStyle=FS_NORMAL,$aFSize=10) {
+	$this->iFFamily = $aFFamily;
+	$this->iFStyle	 = $aFStyle;
+	$this->iFSize	 = $aFSize;
+    }
+
+    function SetFontColor($aColor) {
+	$this->iTextColor = $aColor;
+    }
+	
+    function GetFontHeight(&$aImg) {
+	$aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	return $aImg->GetFontHeight();
+    }
+
+    function GetFontWidth(&$aImg) {
+	$aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	return $aImg->GetFontWidth();
+    }
+
+    function GetStrWidth(&$aImg,$aStr) {
+	$aImg->SetFont($this->iFFamily,$this->iFStyle,$this->iFSize);
+	return $aImg->GetTextWidth($aStr);
+    }
+	
+    function SetStyle($aStyle) {
+	$this->iStyle = $aStyle;
+    }
+	
+    function SetBackgroundColor($aColor) {
+	$this->iBackgroundColor=$aColor;
+    }
+
+    function SetFrameWeight($aWeight) {
+	$this->iFrameWeight=$aWeight;
+    }
+
+    function SetFrameColor($aColor) {
+	$this->iFrameColor=$aColor;
+    }
+	
+    // Only used by day scale
+    function SetWeekendColor($aColor) {
+	$this->iWeekendBackgroundColor=$aColor;
+    }
+	
+    // Only used by day scale
+    function SetSundayFontColor($aColor) {
+	$this->iSundayTextColor=$aColor;
+    }
+	
+    function SetTitleVertMargin($aMargin) {
+	$this->iTitleVertMargin=$aMargin;
+    }
+	
+    function SetLabelFormatString($aStr) {
+	$this->iLabelFormStr=$aStr;
+    }
+
+    function SetFormatString($aStr) {
+	$this->SetLabelFormatString($aStr);
+    }
+
+
+}
+
+//===================================================
+// CLASS GanttScale
+// Description: Responsible for calculating and showing
+// the scale in a gantt chart. This includes providing methods for
+// converting dates to position in the chart as well as stroking the
+// date headers (days, week, etc).
+//===================================================
+class GanttScale {
+    var $minute,$hour,$day,$week,$month,$year;
+    var $divider,$dividerh,$tableTitle;
+    var $iStartDate=-1,$iEndDate=-1;
+    // Number of gantt bar position (n.b not necessariliy the same as the number of bars)
+    // we could have on bar in position 1, and one bar in position 5 then there are two
+    // bars but the number of bar positions is 5
+    var $iVertLines=-1;	
+    // The width of the labels (defaults to the widest of all labels)
+    var $iLabelWidth;	
+    // Out image to stroke the scale to
+    var $iImg;	
+    var $iTableHeaderBackgroundColor="white",$iTableHeaderFrameColor="black";
+    var $iTableHeaderFrameWeight=1;
+    var $iAvailableHeight=-1,$iVertSpacing=-1,$iVertHeaderSize=-1;
+    var $iDateLocale;
+    var $iVertLayout=GANTT_EVEN;
+    var $iTopPlotMargin=10,$iBottomPlotMargin=15;
+    var $iUsePlotWeekendBackground=true;
+    var $iWeekStart = 1;	// Default to have weekends start on Monday
+    var $actinfo;
+	
+//---------------
+// CONSTRUCTOR	
+    function GanttScale(&$aImg) {
+	$this->iImg = &$aImg;		
+	$this->iDateLocale = new DateLocale();
+
+	$this->minute = new HeaderProperty();
+	$this->minute->SetIntervall(15);
+	$this->minute->SetLabelFormatString('i');
+	$this->minute->SetFont(FF_FONT0);
+	$this->minute->grid->SetColor("gray");
+
+	$this->hour = new HeaderProperty();
+	$this->hour->SetFont(FF_FONT0);
+	$this->hour->SetIntervall(6);
+	$this->hour->SetStyle(HOURSTYLE_HM24);
+	$this->hour->SetLabelFormatString('H:i');
+	$this->hour->grid->SetColor("gray");
+
+	$this->day = new HeaderProperty();
+	$this->day->grid->SetColor("gray");
+	$this->day->SetLabelFormatString('l');
+
+	$this->week = new HeaderProperty();
+	$this->week->SetLabelFormatString("w%d");
+	$this->week->SetFont(FF_FONT1);
+
+	$this->month = new HeaderProperty();
+	$this->month->SetFont(FF_FONT1,FS_BOLD);
+
+	$this->year = new HeaderProperty();
+	$this->year->SetFont(FF_FONT1,FS_BOLD);		
+		
+	$this->divider=new LineProperty();
+	$this->dividerh=new LineProperty();		
+	$this->dividerh->SetWeight(2);
+	$this->divider->SetWeight(6);
+	$this->divider->SetColor('gray');
+	$this->divider->SetStyle('fancy');
+
+	$this->tableTitle=new TextProperty();
+	$this->tableTitle->Show(false);
+	$this->actinfo = new GanttActivityInfo();
+    }
+	
+//---------------
+// PUBLIC METHODS	
+    // Specify what headers should be visible
+    function ShowHeaders($aFlg) {
+	$this->day->Show($aFlg & GANTT_HDAY);
+	$this->week->Show($aFlg & GANTT_HWEEK);
+	$this->month->Show($aFlg & GANTT_HMONTH);
+	$this->year->Show($aFlg & GANTT_HYEAR);
+	$this->hour->Show($aFlg & GANTT_HHOUR);
+	$this->minute->Show($aFlg & GANTT_HMIN);
+
+	// Make some default settings of gridlines whihc makes sense
+	if( $aFlg & GANTT_HWEEK ) {
+	    $this->month->grid->Show(false);
+	    $this->year->grid->Show(false);
+	}
+	if( $aFlg & GANTT_HHOUR ) {
+	    $this->day->grid->SetColor("black");
+	}
+    }
+	
+    // Should the weekend background stretch all the way down in the plotarea
+    function UseWeekendBackground($aShow) {
+	$this->iUsePlotWeekendBackground = $aShow;
+    }
+	
+    // Have a range been specified?
+    function IsRangeSet() {
+	return $this->iStartDate!=-1 && $this->iEndDate!=-1;
+    }
+	
+    // Should the layout be from top or even?
+    function SetVertLayout($aLayout) {
+	$this->iVertLayout = $aLayout;
+    }
+	
+    // Which locale should be used?
+    function SetDateLocale($aLocale) {
+	$this->iDateLocale->Set($aLocale);
+    }
+	
+    // Number of days we are showing
+    function GetNumberOfDays() {
+	return round(($this->iEndDate-$this->iStartDate)/SECPERDAY);
+    }
+	
+    // The width of the actual plot area
+    function GetPlotWidth() {
+	$img=$this->iImg;
+	return $img->width - $img->left_margin - $img->right_margin;
+    }
+
+    // Specify the width of the titles(labels) for the activities
+    // (This is by default set to the minimum width enought for the
+    // widest title)
+    function SetLabelWidth($aLabelWidth) {
+	$this->iLabelWidth=$aLabelWidth;
+    }
+
+	// Which day should the week start?
+	// 0==Sun, 1==Monday, 2==Tuesday etc
+    function SetWeekStart($aStartDay) {
+	$this->iWeekStart = $aStartDay % 7;
+	
+	//Recalculate the startday since this will change the week start
+	$this->SetRange($this->iStartDate,$this->iEndDate);
+    }
+
+    // Do we show min scale?
+    function IsDisplayMinute() {
+	return $this->minute->iShowLabels;
+    }
+
+    // Do we show day scale?
+    function IsDisplayHour() {
+	return $this->hour->iShowLabels;
+    }
+
+	
+    // Do we show day scale?
+    function IsDisplayDay() {
+	return $this->day->iShowLabels;
+    }
+	
+    // Do we show week scale?
+    function IsDisplayWeek() {
+	return $this->week->iShowLabels;
+    }
+	
+    // Do we show month scale?
+    function IsDisplayMonth() {
+	return $this->month->iShowLabels;
+    }
+	
+    // Do we show year scale?
+    function IsDisplayYear() {
+	return $this->year->iShowLabels;
+    }
+
+    // Specify spacing (in percent of bar height) between activity bars
+    function SetVertSpacing($aSpacing) {
+	$this->iVertSpacing = $aSpacing;
+    }
+
+    // Specify scale min and max date either as timestamp or as date strings
+    // Always round to the nearest week boundary
+    function SetRange($aMin,$aMax) {
+	$this->iStartDate = $this->NormalizeDate($aMin);
+	$this->iEndDate = $this->NormalizeDate($aMax);	
+    }
+
+
+    // Adjust the start and end date so they fit to beginning/ending
+    // of the week taking the specified week start day into account.
+    function AdjustStartEndDay() {
+
+	if( !($this->IsDisplayYear() ||$this->IsDisplayMonth() || $this->IsDisplayWeek()) ) {
+	    // Don't adjust
+	    return;
+	}
+
+	// Get day in week for start and ending date (Sun==0)
+	$ds=strftime("%w",$this->iStartDate);
+	$de=strftime("%w",$this->iEndDate);	
+	
+	// We want to start on iWeekStart day. But first we subtract a week
+	// if the startdate is "behind" the day the week start at. 
+	// This way we ensure that the given start date is always included 
+	// in the range. If we don't do this the nearest correct weekday in the week 
+	// to start at might be later than the start date.
+	if( $ds < $this->iWeekStart )
+	    $d = strtotime('-7 day',$this->iStartDate);
+	else
+	    $d = $this->iStartDate;
+	$adjdate = strtotime(($this->iWeekStart-$ds).' day',$d /*$this->iStartDate*/ );
+	$this->iStartDate = $adjdate;
+	
+	// We want to end on the last day of the week
+	$preferredEndDay = ($this->iWeekStart+6)%7;
+	if( $preferredEndDay != $de ) { 
+	    // Solve equivalence eq:    $de + x ~ $preferredDay (mod 7)
+	    $adj = (7+($preferredEndDay - $de)) % 7;
+	    $adjdate = strtotime("+$adj day",$this->iEndDate);
+	    $this->iEndDate = $adjdate;	
+	}	
+    }
+
+    // Specify background for the table title area (upper left corner of the table)	
+    function SetTableTitleBackground($aColor) {
+	$this->iTableHeaderBackgroundColor = $aColor;
+    }
+
+///////////////////////////////////////
+// PRIVATE Methods
+	
+    // Determine the height of all the scale headers combined
+    function GetHeaderHeight() {
+	$img=$this->iImg;
+	$height=1;
+	if( $this->minute->iShowLabels ) {
+	    $height += $this->minute->GetFontHeight($img);
+	    $height += $this->minute->iTitleVertMargin;
+	}
+	if( $this->hour->iShowLabels ) {
+	    $height += $this->hour->GetFontHeight($img);
+	    $height += $this->hour->iTitleVertMargin;
+	}
+	if( $this->day->iShowLabels ) {
+	    $height += $this->day->GetFontHeight($img);
+	    $height += $this->day->iTitleVertMargin;
+	}
+	if( $this->week->iShowLabels ) {
+	    $height += $this->week->GetFontHeight($img);
+	    $height += $this->week->iTitleVertMargin;
+	}
+	if( $this->month->iShowLabels ) {
+	    $height += $this->month->GetFontHeight($img);
+	    $height += $this->month->iTitleVertMargin;
+	}
+	if( $this->year->iShowLabels ) {
+	    $height += $this->year->GetFontHeight($img);
+	    $height += $this->year->iTitleVertMargin;
+	}
+	return $height;
+    }
+	
+    // Get width (in pixels) for a single day
+    function GetDayWidth() {
+	return ($this->GetPlotWidth()-$this->iLabelWidth+1)/$this->GetNumberOfDays();	
+    }
+
+    // Get width (in pixels) for a single hour
+    function GetHourWidth() {
+	return $this->GetDayWidth() / 24 ;
+    }
+
+    function GetMinuteWidth() {
+	return $this->GetHourWidth() / 60 ;
+    }
+
+    // Nuber of days in a year
+    function GetNumDaysInYear($aYear) {
+	if( $this->IsLeap($aYear) )
+	    return 366;
+	else
+	    return 365;
+    }
+	
+    // Get week number 
+    function GetWeekNbr($aDate,$aSunStart=true) {
+	// We can't use the internal strftime() since it gets the weeknumber
+	// wrong since it doesn't follow ISO on all systems since this is
+	// system linrary dependent.
+	// Even worse is that this works differently if we are on a Windows
+	// or UNIX box (it even differs between UNIX boxes how strftime()
+	// is natively implemented)
+	//
+	// Credit to Nicolas Hoizey <nhoizey@phpheaven.net> for this elegant
+	// version of Week Nbr calculation. 
+
+	$day = $this->NormalizeDate($aDate) ;
+	if( $aSunStart )
+	    $day += 60*60*24;
+		
+	/*-------------------------------------------------------------------------
+	  According to ISO-8601 :
+	  "Week 01 of a year is per definition the first week that has the Thursday in this year,
+	  which is equivalent to the week that contains the fourth day of January.
+	  In other words, the first week of a new year is the week that has the majority of its
+	  days in the new year."
+		  
+	  Be carefull, with PHP, -3 % 7 = -3, instead of 4 !!!
+		  
+	  day of year             = date("z", $day) + 1
+	  offset to thursday      = 3 - (date("w", $day) + 6) % 7
+	  first thursday of year  = 1 + (11 - date("w", mktime(0, 0, 0, 1, 1, date("Y", $day)))) % 7
+	  week number             = (thursday's day of year - first thursday's day of year) / 7 + 1
+	  ---------------------------------------------------------------------------*/
+		 
+	$thursday = $day + 60 * 60 * 24 * (3 - (date("w", $day) + 6) % 7);              // take week's thursday
+	$week = 1 + (date("z", $thursday) - (11 - date("w", mktime(0, 0, 0, 1, 1, date("Y", $thursday)))) % 7) / 7;
+		  
+	return $week;
+    }
+	
+    // Is year a leap year?
+    function IsLeap($aYear) {
+	// Is the year a leap year?
+	//$year = 0+date("Y",$aDate);
+	if( $aYear % 4 == 0)
+	    if( !($aYear % 100 == 0) || ($aYear % 400 == 0) )
+		return true;
+	return false;
+    }
+
+    // Get current year
+    function GetYear($aDate) {
+	return 0+Date("Y",$aDate);
+    }
+	
+    // Return number of days in a year
+    function GetNumDaysInMonth($aMonth,$aYear) {
+	$days=array(31,28,31,30,31,30,31,31,30,31,30,31);
+	$daysl=array(31,29,31,30,31,30,31,31,30,31,30,31);
+	if( $this->IsLeap($aYear))
+	    return $daysl[$aMonth];
+	else
+	    return $days[$aMonth];
+    }
+	
+    // Get day in month
+    function GetMonthDayNbr($aDate) {
+	return 0+strftime("%d",$aDate);
+    }
+
+    // Get day in year
+    function GetYearDayNbr($aDate) {
+	return 0+strftime("%j",$aDate);
+    }
+	
+    // Get month number
+    function GetMonthNbr($aDate) {
+	return 0+strftime("%m",$aDate);
+    }
+	
+    // Translate a date to screen coordinates	(horizontal scale)
+    function TranslateDate($aDate) {
+	//
+	// In order to handle the problem with Daylight savings time
+	// the scale written with equal number of seconds per day beginning
+	// with the start date. This means that we "cement" the state of
+	// DST as it is in the start date. If later the scale includes the
+	// switchover date (depends on the locale) we need to adjust back
+	// if the date we try to translate has a different DST status since
+	// we would otherwise be off by one hour.
+	$aDate = $this->NormalizeDate($aDate);
+	$tmp = localtime($aDate);
+	$cloc = $tmp[8];
+	$tmp = localtime($this->iStartDate);
+	$sloc = $tmp[8];
+	$offset = 0;
+	if( $sloc != $cloc) {
+	    if( $sloc ) 
+		$offset = 3600;
+	    else
+		$offset = -3600;
+	}
+	$img=$this->iImg;		
+	return ($aDate-$this->iStartDate-$offset)/SECPERDAY*$this->GetDayWidth()+$img->left_margin+$this->iLabelWidth;;
+    }
+
+    // Get screen coordinatesz for the vertical position for a bar		
+    function TranslateVertPos($aPos) {
+	$img=$this->iImg;
+	$ph=$this->iAvailableHeight;
+	if( $aPos > $this->iVertLines ) 
+	    JpGraphError::RaiseL(6015,$aPos);
+// 'Illegal vertical position %d'
+	if( $this->iVertLayout == GANTT_EVEN ) {
+	    // Position the top bar at 1 vert spacing from the scale
+	    return round($img->top_margin + $this->iVertHeaderSize +  ($aPos+1)*$this->iVertSpacing);
+	}
+	else {
+	    // position the top bar at 1/2 a vert spacing from the scale
+	    return round($img->top_margin + $this->iVertHeaderSize  + $this->iTopPlotMargin + ($aPos+1)*$this->iVertSpacing);		
+	}
+    }
+	
+    // What is the vertical spacing?
+    function GetVertSpacing() {
+	return $this->iVertSpacing;
+    }
+					
+    // Convert a date to timestamp
+    function NormalizeDate($aDate) {
+	if( $aDate === false ) return false; 
+	if( is_string($aDate) ) {
+	    $t = strtotime($aDate);
+	    if( $t === FALSE || $t === -1 ) {	    
+		JpGraphError::RaiseL(6016,$aDate);
+//("Date string ($aDate) specified for Gantt activity can not be interpretated. Please make sure it is a valid time string, e.g. 2005-04-23 13:30");
+	    }
+	    return $t;
+	}
+	elseif( is_int($aDate) || is_float($aDate) )
+	    return $aDate;
+	else
+	    JpGraphError::RaiseL(6017,$aDate);
+//Unknown date format in GanttScale ($aDate).");
+    }
+
+    
+    // Convert a time string to minutes
+
+    function TimeToMinutes($aTimeString) {
+	// Split in hours and minutes
+	$pos=strpos($aTimeString,':');
+	$minint=60;
+	if( $pos === false ) {
+	    $hourint = $aTimeString;
+	    $minint = 0;
+	}
+	else {
+	    $hourint = floor(substr($aTimeString,0,$pos));
+	    $minint = floor(substr($aTimeString,$pos+1));
+	}
+	$minint += 60 * $hourint;
+	return $minint;
+    }
+
+    // Stroke the day scale (including gridlines)			
+    function StrokeMinutes($aYCoord,$getHeight=false) {
+	$img=$this->iImg;	
+	$xt=$img->left_margin+$this->iLabelWidth;
+	$yt=$aYCoord+$img->top_margin;		
+	if( $this->minute->iShowLabels ) {
+	    $img->SetFont($this->minute->iFFamily,$this->minute->iFStyle,$this->minute->iFSize);
+	    $yb = $yt + $img->GetFontHeight() + 
+		  $this->minute->iTitleVertMargin + $this->minute->iFrameWeight;
+	    if( $getHeight ) {
+		return $yb - $img->top_margin;
+	    }
+	    $xb = $img->width-$img->right_margin+1;
+	    $img->SetColor($this->minute->iBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+
+	    $x = $xt;   
+	    $img->SetTextAlign("center");
+	    $day = date('w',$this->iStartDate);
+	    $minint = $this->minute->GetIntervall() ;
+	    
+	    if( 60 % $minint !== 0 ) { 
+                JpGraphError::RaiseL(6018,$minint);
+//'Intervall for minutes must divide the hour evenly, e.g. 1,5,10,12,15,20,30 etc You have specified an intervall of '.$minint.' minutes.');
+            } 
+
+
+	    $n = 60 / $minint;
+	    $datestamp = $this->iStartDate;
+	    $width = $this->GetHourWidth() / $n ;
+	    if( $width < 8 ) {
+		// TO small width to draw minute scale
+		JpGraphError::RaiseL(6019,$width);
+//('The available width ('.$width.') for minutes are to small for this scale to be displayed. Please use auto-sizing or increase the width of the graph.');
+	    }
+
+	    $nh = ceil(24*60 / $this->TimeToMinutes($this->hour->GetIntervall()) );
+	    $nd = $this->GetNumberOfDays();
+	    // Convert to intervall to seconds
+	    $minint *= 60;
+	    for($j=0; $j < $nd; ++$j, $day += 1, $day %= 7) {
+		for( $k=0; $k < $nh; ++$k ) {
+		    for($i=0; $i < $n ;++$i, $x+=$width, $datestamp += $minint ) {   
+			if( $day==6 || $day==0 ) {
+			
+			    $img->PushColor($this->day->iWeekendBackgroundColor);
+			    if( $this->iUsePlotWeekendBackground )
+				$img->FilledRectangle($x,$yt+$this->day->iFrameWeight,$x+$width,$img->height-$img->bottom_margin);						
+			    else
+				$img->FilledRectangle($x,$yt+$this->day->iFrameWeight,$x+$width,$yb-$this->day->iFrameWeight);
+			    $img->PopColor();
+
+			}
+
+			if( $day==0 ) 
+			    $img->SetColor($this->day->iSundayTextColor);
+			else
+			    $img->SetColor($this->day->iTextColor);
+
+			switch( $this->minute->iStyle ) {
+			    case MINUTESTYLE_CUSTOM:
+				$txt = date($this->minute->iLabelFormStr,$datestamp);
+				break;
+			    case MINUTESTYLE_MM:
+			    default:
+				// 15
+				$txt = date('i',$datestamp);
+				break;
+			}
+			$img->StrokeText(round($x+$width/2),round($yb-$this->minute->iTitleVertMargin),$txt);
+
+			// FIXME: The rounding problem needs to be solved properly ...
+			//
+			// Fix a rounding problem the wrong way ..
+			// If we also have hour scale then don't draw the firsta or last
+			// gridline since that will be overwritten by the hour scale gridline if such exists.
+			// However, due to the propagation of rounding of the 'x+=width' term in the loop
+			// this might sometimes be one pixel of so we fix this by not drawing it.
+			// The proper way to fix it would be to re-calculate the scale for each step and
+			// not using the additive term.
+			if( !(($i == $n || $i==0) && $this->hour->iShowLabels && $this->hour->grid->iShow) ) {
+			    $img->SetColor($this->minute->grid->iColor);
+			    $img->SetLineWeight($this->minute->grid->iWeight);
+			    $img->Line($x,$yt,$x,$yb);
+			    $this->minute->grid->Stroke($img,$x,$yb,$x,$img->height-$img->bottom_margin);
+			}
+		    }		
+		}	
+	    }
+	    $img->SetColor($this->minute->iFrameColor);
+	    $img->SetLineWeight($this->minute->iFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);
+	    return $yb - $img->top_margin;
+	}
+	return $aYCoord;
+    }
+
+    // Stroke the day scale (including gridlines)			
+    function StrokeHours($aYCoord,$getHeight=false) {
+	$img=$this->iImg;	
+	$xt=$img->left_margin+$this->iLabelWidth;
+	$yt=$aYCoord+$img->top_margin;		
+	if( $this->hour->iShowLabels ) {
+	    $img->SetFont($this->hour->iFFamily,$this->hour->iFStyle,$this->hour->iFSize);
+	    $yb = $yt + $img->GetFontHeight() + 
+		  $this->hour->iTitleVertMargin + $this->hour->iFrameWeight;
+	    if( $getHeight ) {
+		return $yb - $img->top_margin;
+	    }
+	    $xb = $img->width-$img->right_margin+1;
+	    $img->SetColor($this->hour->iBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+
+	    $x = $xt;   
+	    $img->SetTextAlign("center");
+	    $tmp = $this->hour->GetIntervall() ;
+	    $minint = $this->TimeToMinutes($tmp);
+	    if( 1440 % $minint !== 0 ) { 
+                JpGraphError::RaiseL(6020,$tmp);
+//('Intervall for hours must divide the day evenly, e.g. 0:30, 1:00, 1:30, 4:00 etc. You have specified an intervall of '.$tmp);
+            } 
+
+	    $n = ceil(24*60 / $minint );
+	    $datestamp = $this->iStartDate;
+	    $day = date('w',$this->iStartDate);
+	    $doback = !$this->minute->iShowLabels;
+	    $width = $this->GetDayWidth() / $n ;
+	    for($j=0; $j < $this->GetNumberOfDays(); ++$j, $day += 1,$day %= 7) {
+		for($i=0; $i < $n ;++$i, $x+=$width) {   
+		    if( $day==6 || $day==0 ) {
+			
+			$img->PushColor($this->day->iWeekendBackgroundColor);
+			if( $this->iUsePlotWeekendBackground && $doback )
+			    $img->FilledRectangle($x,$yt+$this->day->iFrameWeight,$x+$width,$img->height-$img->bottom_margin);						
+			else
+			    $img->FilledRectangle($x,$yt+$this->day->iFrameWeight,$x+$width,$yb-$this->day->iFrameWeight);
+			$img->PopColor();
+
+		    }
+
+		    if( $day==0 ) 
+			$img->SetColor($this->day->iSundayTextColor);
+		    else
+			$img->SetColor($this->day->iTextColor);
+
+		    switch( $this->hour->iStyle ) {
+			case HOURSTYLE_HMAMPM:
+			    // 1:35pm
+			    $txt = date('g:ia',$datestamp);
+			    break;
+			case HOURSTYLE_H24:
+			    // 13
+			    $txt = date('H',$datestamp);
+			    break;
+			case HOURSTYLE_HAMPM:
+			    $txt = date('ga',$datestamp);
+			    break;
+			case HOURSTYLE_CUSTOM:
+			    $txt = date($this->hour->iLabelFormStr,$datestamp);
+			    break;
+			case HOURSTYLE_HM24:
+			default:
+			    $txt = date('H:i',$datestamp);
+			    break;
+		    }
+		    $img->StrokeText(round($x+$width/2),round($yb-$this->hour->iTitleVertMargin),$txt);
+		    $img->SetColor($this->hour->grid->iColor);
+		    $img->SetLineWeight($this->hour->grid->iWeight);
+		    $img->Line($x,$yt,$x,$yb);
+		    $this->hour->grid->Stroke($img,$x,$yb,$x,$img->height-$img->bottom_margin);
+		    //$datestamp += $minint*60
+		    $datestamp = mktime(date('H',$datestamp),date('i',$datestamp)+$minint,0,
+					date("m",$datestamp),date("d",$datestamp)+1,date("Y",$datestamp));
+		    
+		}			
+	    }
+	    $img->SetColor($this->hour->iFrameColor);
+	    $img->SetLineWeight($this->hour->iFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);
+	    return $yb - $img->top_margin;
+	}
+	return $aYCoord;
+    }
+
+
+    // Stroke the day scale (including gridlines)			
+    function StrokeDays($aYCoord,$getHeight=false) {
+	$img=$this->iImg;	
+	$daywidth=$this->GetDayWidth();
+	$xt=$img->left_margin+$this->iLabelWidth;
+	$yt=$aYCoord+$img->top_margin;		
+	if( $this->day->iShowLabels ) {
+	    $img->SetFont($this->day->iFFamily,$this->day->iFStyle,$this->day->iFSize);
+	    $yb=$yt + $img->GetFontHeight() + $this->day->iTitleVertMargin + $this->day->iFrameWeight;
+	    if( $getHeight ) {
+		return $yb - $img->top_margin;
+	    }
+	    $xb=$img->width-$img->right_margin+1;
+	    $img->SetColor($this->day->iBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+
+	    $x = $xt;   
+	    $img->SetTextAlign("center");
+	    $day = date('w',$this->iStartDate);
+	    $datestamp = $this->iStartDate;
+	    
+	    $doback = !($this->hour->iShowLabels || $this->minute->iShowLabels);
+
+	    setlocale(LC_TIME,$this->iDateLocale->iLocale);
+	    
+	    for($i=0; $i < $this->GetNumberOfDays(); ++$i, $x+=$daywidth, $day += 1,$day %= 7) {
+		if( $day==6 || $day==0 ) {
+		    $img->SetColor($this->day->iWeekendBackgroundColor);
+		    if( $this->iUsePlotWeekendBackground && $doback)
+			$img->FilledRectangle($x,$yt+$this->day->iFrameWeight,
+					      $x+$daywidth,$img->height-$img->bottom_margin);	
+		    else
+			$img->FilledRectangle($x,$yt+$this->day->iFrameWeight,
+					      $x+$daywidth,$yb-$this->day->iFrameWeight);
+		}
+
+		$mn = strftime('%m',$datestamp);
+		if( $mn[0]=='0' ) 
+		    $mn = $mn[1];
+
+		switch( $this->day->iStyle ) {
+		    case DAYSTYLE_LONG:
+			// "Monday"
+			$txt = strftime('%A',$datestamp);
+			break;
+		    case DAYSTYLE_SHORT:
+			// "Mon"
+			$txt = strftime('%a',$datestamp);
+			break;
+		    case DAYSTYLE_SHORTDAYDATE1:
+			// "Mon 23/6"
+			$txt = strftime('%a %d/'.$mn,$datestamp);
+			break;
+		    case DAYSTYLE_SHORTDAYDATE2:
+			// "Mon 23 Jun"
+			$txt = strftime('%a %d %b',$datestamp);
+			break;
+		    case DAYSTYLE_SHORTDAYDATE3:
+			// "Mon 23 Jun 2003"
+			$txt = strftime('%a %d %b %Y',$datestamp);
+			break;
+		    case DAYSTYLE_LONGDAYDATE1:
+			// "Monday 23 Jun"
+			$txt = strftime('%A %d %b',$datestamp);
+			break;
+		    case DAYSTYLE_LONGDAYDATE2:
+			// "Monday 23 Jun 2003"
+			$txt = strftime('%A %d %b %Y',$datestamp);
+			break;
+		    case DAYSTYLE_SHORTDATE1:
+			// "23/6"
+			$txt = strftime('%d/'.$mn,$datestamp);
+			break;			
+		    case DAYSTYLE_SHORTDATE2:
+			// "23 Jun"
+			$txt = strftime('%d %b',$datestamp);
+			break;			
+		    case DAYSTYLE_SHORTDATE3:
+			// "Mon 23"
+			$txt = strftime('%a %d',$datestamp);
+			break;	
+		    case DAYSTYLE_SHORTDATE4:
+			// "23"
+			$txt = strftime('%d',$datestamp);
+			break;	
+		    case DAYSTYLE_CUSTOM:
+			// Custom format
+			$txt = strftime($this->day->iLabelFormStr,$datestamp);
+			break;	
+		    case DAYSTYLE_ONELETTER:
+		    default:
+			// "M"
+			$txt = strftime('%A',$datestamp);
+			$txt = strtoupper($txt[0]);
+			break;
+		}
+
+		if( $day==0 ) 
+		    $img->SetColor($this->day->iSundayTextColor);
+		else
+		    $img->SetColor($this->day->iTextColor);
+		$img->StrokeText(round($x+$daywidth/2+1),
+				 round($yb-$this->day->iTitleVertMargin),$txt);
+		$img->SetColor($this->day->grid->iColor);
+		$img->SetLineWeight($this->day->grid->iWeight);
+		$img->Line($x,$yt,$x,$yb);
+		$this->day->grid->Stroke($img,$x,$yb,$x,$img->height-$img->bottom_margin);
+		$datestamp = mktime(0,0,0,date("m",$datestamp),date("d",$datestamp)+1,date("Y",$datestamp));
+		//$datestamp += SECPERDAY;
+		
+	    }			
+	    $img->SetColor($this->day->iFrameColor);
+	    $img->SetLineWeight($this->day->iFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);
+	    return $yb - $img->top_margin;
+	}
+	return $aYCoord;
+    }
+	
+    // Stroke week header and grid
+    function StrokeWeeks($aYCoord,$getHeight=false) {
+	if( $this->week->iShowLabels ) {
+	    $img=$this->iImg;	
+	    $yt=$aYCoord+$img->top_margin;		
+	    $img->SetFont($this->week->iFFamily,$this->week->iFStyle,$this->week->iFSize);
+	    $yb=$yt + $img->GetFontHeight() + $this->week->iTitleVertMargin + $this->week->iFrameWeight;
+
+	    if( $getHeight ) {
+		return $yb - $img->top_margin;  
+	    }
+
+	    $xt=$img->left_margin+$this->iLabelWidth;
+	    $weekwidth=$this->GetDayWidth()*7;
+	    $wdays=$this->iDateLocale->GetDayAbb();	
+	    $xb=$img->width-$img->right_margin+1;
+	    $week = $this->iStartDate;
+	    $weeknbr=$this->GetWeekNbr($week);
+	    $img->SetColor($this->week->iBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+	    $img->SetColor($this->week->grid->iColor);
+	    $x = $xt;
+	    if( $this->week->iStyle==WEEKSTYLE_WNBR ) {
+		$img->SetTextAlign("center");
+		$txtOffset = $weekwidth/2+1;
+	    }
+	    elseif( $this->week->iStyle==WEEKSTYLE_FIRSTDAY  || 
+		    $this->week->iStyle==WEEKSTYLE_FIRSTDAY2 ||
+		    $this->week->iStyle==WEEKSTYLE_FIRSTDAYWNBR ||
+		    $this->week->iStyle==WEEKSTYLE_FIRSTDAY2WNBR ) {
+		$img->SetTextAlign("left");
+		$txtOffset = 3;
+	    }
+	    else
+		JpGraphError::RaiseL(6021);
+//("Unknown formatting style for week.");
+				
+	    for($i=0; $i<$this->GetNumberOfDays()/7; ++$i, $x+=$weekwidth) {
+		$img->PushColor($this->week->iTextColor);
+				
+		if( $this->week->iStyle==WEEKSTYLE_WNBR )
+		    $txt = sprintf($this->week->iLabelFormStr,$weeknbr);
+		elseif( $this->week->iStyle==WEEKSTYLE_FIRSTDAY || 
+			$this->week->iStyle==WEEKSTYLE_FIRSTDAYWNBR ) 
+		    $txt = date("j/n",$week);
+		elseif( $this->week->iStyle==WEEKSTYLE_FIRSTDAY2 || 
+			$this->week->iStyle==WEEKSTYLE_FIRSTDAY2WNBR ) {
+		    $monthnbr = date("n",$week)-1;
+		    $shortmonth = $this->iDateLocale->GetShortMonthName($monthnbr);
+		    $txt = Date("j",$week)." ".$shortmonth;
+		}
+
+		if( $this->week->iStyle==WEEKSTYLE_FIRSTDAYWNBR ||
+		    $this->week->iStyle==WEEKSTYLE_FIRSTDAY2WNBR ) {
+		    $w = sprintf($this->week->iLabelFormStr,$weeknbr);
+		    $txt .= ' '.$w;
+		}
+				
+		$img->StrokeText(round($x+$txtOffset),
+				 round($yb-$this->week->iTitleVertMargin),$txt);
+				
+		$week = strtotime('+7 day',$week); 
+		$weeknbr = $this->GetWeekNbr($week);
+		$img->PopColor();	
+		$img->SetLineWeight($this->week->grid->iWeight);
+		$img->Line($x,$yt,$x,$yb);
+		$this->week->grid->Stroke($img,$x,$yb,$x,$img->height-$img->bottom_margin);
+	    }			
+	    $img->SetColor($this->week->iFrameColor);
+	    $img->SetLineWeight($this->week->iFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);
+	    return $yb-$img->top_margin;
+	}
+	return $aYCoord;
+    }	
+	
+    // Format the mont scale header string
+    function GetMonthLabel($aMonthNbr,$year) {
+	$sn = $this->iDateLocale->GetShortMonthName($aMonthNbr);
+	$ln = $this->iDateLocale->GetLongMonthName($aMonthNbr);
+	switch($this->month->iStyle) {
+	    case MONTHSTYLE_SHORTNAME:
+		$m=$sn;
+		break;
+	    case MONTHSTYLE_LONGNAME:
+		$m=$ln;
+		break;
+	    case MONTHSTYLE_SHORTNAMEYEAR2:
+		$m=$sn." '".substr("".$year,2);
+		break;
+	    case MONTHSTYLE_SHORTNAMEYEAR4:
+		$m=$sn." ".$year;
+		break;
+	    case MONTHSTYLE_LONGNAMEYEAR2:
+		$m=$ln." '".substr("".$year,2);
+		break;
+	    case MONTHSTYLE_LONGNAMEYEAR4:
+		$m=$ln." ".$year;
+		break;
+	    case MONTHSTYLE_FIRSTLETTER:
+		$m=$sn[0];
+		break;
+	}
+	return $m;
+    }
+	
+    // Stroke month scale and gridlines
+    function StrokeMonths($aYCoord,$getHeight=false) {
+	if( $this->month->iShowLabels ) {
+	    $img=$this->iImg;		
+	    $img->SetFont($this->month->iFFamily,$this->month->iFStyle,$this->month->iFSize);
+	    $yt=$aYCoord+$img->top_margin;		
+	    $yb=$yt + $img->GetFontHeight() + $this->month->iTitleVertMargin + $this->month->iFrameWeight;
+	    if( $getHeight ) {
+		return $yb - $img->top_margin;  
+	    }
+	    $monthnbr = $this->GetMonthNbr($this->iStartDate)-1; 
+	    $xt=$img->left_margin+$this->iLabelWidth;
+	    $xb=$img->width-$img->right_margin+1;
+			
+	    $img->SetColor($this->month->iBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+
+	    $img->SetLineWeight($this->month->grid->iWeight);
+	    $img->SetColor($this->month->iTextColor);
+	    $year = 0+strftime("%Y",$this->iStartDate);
+	    $img->SetTextAlign("center");
+	    if( $this->GetMonthNbr($this->iStartDate) == $this->GetMonthNbr($this->iEndDate)  
+		&& $this->GetYear($this->iStartDate)==$this->GetYear($this->iEndDate) ) {
+	    	$monthwidth=$this->GetDayWidth()*($this->GetMonthDayNbr($this->iEndDate) - $this->GetMonthDayNbr($this->iStartDate) + 1);
+	    } 
+	    else {
+	    	$monthwidth=$this->GetDayWidth()*($this->GetNumDaysInMonth($monthnbr,$year)-$this->GetMonthDayNbr($this->iStartDate)+1);
+	    }
+	    // Is it enough space to stroke the first month?
+	    $monthName = $this->GetMonthLabel($monthnbr,$year);
+	    if( $monthwidth >= 1.2*$img->GetTextWidth($monthName) ) {
+		$img->SetColor($this->month->iTextColor);				
+		$img->StrokeText(round($xt+$monthwidth/2+1),
+				 round($yb-$this->month->iTitleVertMargin),
+				 $monthName);
+	    }
+	    $x = $xt + $monthwidth;
+	    while( $x < $xb ) {
+		$img->SetColor($this->month->grid->iColor);				
+		$img->Line($x,$yt,$x,$yb);
+		$this->month->grid->Stroke($img,$x,$yb,$x,$img->height-$img->bottom_margin);
+		$monthnbr++;
+		if( $monthnbr==12 ) {
+		    $monthnbr=0;
+		    $year++;
+		}
+		$monthName = $this->GetMonthLabel($monthnbr,$year);
+		$monthwidth=$this->GetDayWidth()*$this->GetNumDaysInMonth($monthnbr,$year);				
+		if( $x + $monthwidth < $xb )
+		    $w = $monthwidth;
+		else
+		    $w = $xb-$x;
+		if( $w >= 1.2*$img->GetTextWidth($monthName) ) {
+		    $img->SetColor($this->month->iTextColor);				
+		    $img->StrokeText(round($x+$w/2+1),
+				     round($yb-$this->month->iTitleVertMargin),$monthName);
+		}
+		$x += $monthwidth;
+	    }	
+	    $img->SetColor($this->month->iFrameColor);
+	    $img->SetLineWeight($this->month->iFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);			
+	    return $yb-$img->top_margin;
+	}
+	return $aYCoord;
+    }
+
+    // Stroke year scale and gridlines
+    function StrokeYears($aYCoord,$getHeight=false) {
+	if( $this->year->iShowLabels ) {
+	    $img=$this->iImg;	
+	    $yt=$aYCoord+$img->top_margin;		
+	    $img->SetFont($this->year->iFFamily,$this->year->iFStyle,$this->year->iFSize);
+	    $yb=$yt + $img->GetFontHeight() + $this->year->iTitleVertMargin + $this->year->iFrameWeight;
+
+	    if( $getHeight ) {
+		return $yb - $img->top_margin;  
+	    }
+
+	    $xb=$img->width-$img->right_margin+1;
+	    $xt=$img->left_margin+$this->iLabelWidth;
+	    $year = $this->GetYear($this->iStartDate); 			
+	    $img->SetColor($this->year->iBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+	    $img->SetLineWeight($this->year->grid->iWeight);
+	    $img->SetTextAlign("center");
+	    if( $year == $this->GetYear($this->iEndDate) )
+		$yearwidth=$this->GetDayWidth()*($this->GetYearDayNbr($this->iEndDate)-$this->GetYearDayNbr($this->iStartDate)+1);
+	    else
+		$yearwidth=$this->GetDayWidth()*($this->GetNumDaysInYear($year)-$this->GetYearDayNbr($this->iStartDate)+1);
+			
+	    // The space for a year must be at least 20% bigger than the actual text 
+	    // so we allow 10% margin on each side
+	    if( $yearwidth >= 1.20*$img->GetTextWidth("".$year) ) {
+		$img->SetColor($this->year->iTextColor);				
+		$img->StrokeText(round($xt+$yearwidth/2+1),
+				 round($yb-$this->year->iTitleVertMargin),
+				 $year);
+	    }
+	    $x = $xt + $yearwidth;
+	    while( $x < $xb ) {
+		$img->SetColor($this->year->grid->iColor);				
+		$img->Line($x,$yt,$x,$yb);
+		$this->year->grid->Stroke($img,$x,$yb,$x,$img->height-$img->bottom_margin);
+		$year += 1;
+		$yearwidth=$this->GetDayWidth()*$this->GetNumDaysInYear($year);				
+		if( $x + $yearwidth < $xb )
+		    $w = $yearwidth;
+		else
+		    $w = $xb-$x;
+		if( $w >= 1.2*$img->GetTextWidth("".$year) ) {
+		    $img->SetColor($this->year->iTextColor);
+		    $img->StrokeText(round($x+$w/2+1),
+				     round($yb-$this->year->iTitleVertMargin),
+				     $year);
+		}
+		$x += $yearwidth;
+	    }
+	    $img->SetColor($this->year->iFrameColor);
+	    $img->SetLineWeight($this->year->iFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);			
+	    return $yb-$img->top_margin;
+	}
+	return $aYCoord;
+    }
+	
+    // Stroke table title (upper left corner)
+    function StrokeTableHeaders($aYBottom) {
+	$img=$this->iImg;
+	$xt=$img->left_margin;
+	$yt=$img->top_margin;
+	$xb=$xt+$this->iLabelWidth;
+	$yb=$aYBottom+$img->top_margin;
+
+	if( $this->tableTitle->iShow ) {
+	    $img->SetColor($this->iTableHeaderBackgroundColor);
+	    $img->FilledRectangle($xt,$yt,$xb,$yb);
+	    $this->tableTitle->Align("center","top");
+	    $this->tableTitle->Stroke($img,$xt+($xb-$xt)/2+1,$yt+2);		
+	    $img->SetColor($this->iTableHeaderFrameColor);
+	    $img->SetLineWeight($this->iTableHeaderFrameWeight);
+	    $img->Rectangle($xt,$yt,$xb,$yb);
+	}
+
+	$this->actinfo->Stroke($img,$xt,$yt,$xb,$yb,$this->tableTitle->iShow);
+
+
+	// Draw the horizontal dividing line		
+	$this->dividerh->Stroke($img,$xt,$yb,$img->width-$img->right_margin,$yb);		
+		
+	// Draw the vertical dividing line
+	// We do the width "manually" since we want the line only to grow
+	// to the left
+	$fancy = $this->divider->iStyle == 'fancy' ;
+	if( $fancy ) {
+	    $this->divider->iStyle = 'solid';
+	}
+
+	$tmp = $this->divider->iWeight;	
+	$this->divider->iWeight=1;
+	$y = $img->height-$img->bottom_margin;
+	for($i=0; $i < $tmp; ++$i ) {
+	    $this->divider->Stroke($img,$xb-$i,$yt,$xb-$i,$y);
+	}
+
+	// Should we draw "fancy" divider
+	if( $fancy ) {
+	    $img->SetLineWeight(1);
+	    $img->SetColor($this->iTableHeaderFrameColor);
+	    $img->Line($xb,$yt,$xb,$y);
+	    $img->Line($xb-$tmp+1,$yt,$xb-$tmp+1,$y);
+	    $img->SetColor('white');
+	    $img->Line($xb-$tmp+2,$yt,$xb-$tmp+2,$y);
+	}
+    }
+
+    // Main entry point to stroke scale
+    function Stroke() {
+	if( !$this->IsRangeSet() )
+	    JpGraphError::RaiseL(6022);
+//("Gantt scale has not been specified.");
+	$img=$this->iImg;
+
+	// If minutes are displayed then hour interval must be 1
+	if( $this->IsDisplayMinute() && $this->hour->GetIntervall() > 1 ) {
+	    JpGraphError::RaiseL(6023);
+//('If you display both hour and minutes the hour intervall must be 1 (Otherwise it doesn\' make sense to display minutes).');
+	}
+		
+	// Stroke all headers. As argument we supply the offset from the
+	// top which depends on any previous headers
+	
+	// First find out the height of each header
+	$offy=$this->StrokeYears(0,true);
+	$offm=$this->StrokeMonths($offy,true);
+	$offw=$this->StrokeWeeks($offm,true);
+	$offd=$this->StrokeDays($offw,true);
+	$offh=$this->StrokeHours($offd,true);
+	$offmin=$this->StrokeMinutes($offh,true);
+
+
+	// ... then we can stroke them in the "backwards order to ensure that
+	// the larger scale gridlines is stroked over the smaller scale gridline
+	$this->StrokeMinutes($offh);
+	$this->StrokeHours($offd);
+	$this->StrokeDays($offw);
+	$this->StrokeWeeks($offm);		
+	$this->StrokeMonths($offy);		
+	$this->StrokeYears(0);
+
+	// Now when we now the oaverall size of the scale headers
+	// we can stroke the overall table headers
+	$this->StrokeTableHeaders($offmin);
+		
+	// Now we can calculate the correct scaling factor for each vertical position
+	$this->iAvailableHeight = $img->height - $img->top_margin - $img->bottom_margin - $offd;		
+	$this->iVertHeaderSize = $offmin;
+	if( $this->iVertSpacing == -1 )
+	    $this->iVertSpacing = $this->iAvailableHeight / $this->iVertLines;
+    }	
+}
+
+
+//===================================================
+// CLASS GanttConstraint
+// Just a structure to store all the values for a constraint
+//===================================================
+class GanttConstraint {
+    var $iConstrainType;
+    var $iConstrainRow;
+    var $iConstrainColor;
+    var $iConstrainArrowSize;
+    var $iConstrainArrowType;
+
+//---------------
+// CONSTRUCTOR
+    function GanttConstraint($aRow,$aType,$aColor,$aArrowSize,$aArrowType){
+	$this->iConstrainType = $aType;
+	$this->iConstrainRow = $aRow;
+	$this->iConstrainColor=$aColor;
+	$this->iConstrainArrowSize=$aArrowSize;
+	$this->iConstrainArrowType=$aArrowType;
+    }
+}
+
+
+//===================================================
+// CLASS GanttPlotObject
+// The common signature for a Gantt object
+//===================================================
+class GanttPlotObject {
+    var $iVPos=0;					// Vertical position
+    var $iLabelLeftMargin=2;	// Title margin
+    var $iStart="";				// Start date
+    var $title,$caption;
+    var $iCaptionMargin=5;
+    var $csimarea='',$csimtarget='',$csimalt='';
+
+    var $constraints = array();    
+    var $iConstrainPos=array();
+		
+    function GanttPlotObject() {
+ 	$this->title = new TextProperty();
+	$this->title->Align("left","center");
+	$this->caption = new TextProperty();
+    }
+
+    function GetCSIMArea() {
+	return $this->csimarea;
+    }
+
+    function SetCSIMTarget($aTarget,$aAlt='') {
+	if( !is_string($aTarget) ) {
+	    $tv = substr(var_export($aTarget,true),0,40);
+	    JpGraphError::RaiseL(6024,$tv);
+//('CSIM Target must be specified as a string.'."\nStart of target is:\n$tv");
+	}
+	if( !is_string($aAlt) ) {
+	    $tv = substr(var_export($aAlt,true),0,40);
+	    JpGraphError::RaiseL(6025,$tv);
+//('CSIM Alt text must be specified as a string.'."\nStart of alt text is:\n$tv");
+	}
+
+        $this->csimtarget=$aTarget;
+        $this->csimalt=$aAlt;
+    }
+    
+    function SetCSIMAlt($aAlt) {
+	if( !is_string($aAlt) ) {
+	    $tv = substr(var_export($aAlt,true),0,40);
+	    JpGraphError::RaiseL(6025,$tv);
+//('CSIM Alt text must be specified as a string.'."\nStart of alt text is:\n$tv");
+	}
+        $this->csimalt=$aAlt;
+    }
+
+    function SetConstrain($aRow,$aType,$aColor='black',$aArrowSize=ARROW_S2,$aArrowType=ARROWT_SOLID) {
+	$this->constraints[] = new GanttConstraint($aRow, $aType, $aColor, $aArrowSize, $aArrowType);
+    }
+
+    function SetConstrainPos($xt,$yt,$xb,$yb) {
+	$this->iConstrainPos = array($xt,$yt,$xb,$yb);
+    }
+
+    /*
+    function GetConstrain() {
+	return array($this->iConstrainRow,$this->iConstrainType);
+    }
+    */
+	
+    function GetMinDate() {
+	return $this->iStart;
+    }
+
+    function GetMaxDate() {
+	return $this->iStart;
+    }
+	
+    function SetCaptionMargin($aMarg) {
+	$this->iCaptionMargin=$aMarg;
+    }
+
+    function GetAbsHeight(&$aImg) {
+	return 0; 
+    }
+	
+    function GetLineNbr() {
+	return $this->iVPos;
+    }
+
+    function SetLabelLeftMargin($aOff) {
+	$this->iLabelLeftMargin=$aOff;
+    }		
+
+    function StrokeActInfo(&$aImg,$aScale,$aYPos) {
+	$cols=array();
+	$aScale->actinfo->GetColStart($aImg,$cols,true);
+	$this->title->Stroke($aImg,$cols,$aYPos);		
+    }
+}
+
+//===================================================
+// CLASS Progress
+// Holds parameters for the progress indicator 
+// displyed within a bar
+//===================================================
+class Progress {
+    var $iProgress=-1, $iColor="black", $iFillColor='black';
+    var $iPattern=GANTT_SOLID;
+    var $iDensity=98, $iHeight=0.65; 
+	
+    function Set($aProg) {
+	if( $aProg < 0.0 || $aProg > 1.0 )
+	    JpGraphError::RaiseL(6027);
+//("Progress value must in range [0, 1]");
+	$this->iProgress = $aProg;
+    }
+
+    function SetPattern($aPattern,$aColor="blue",$aDensity=98) {		
+	$this->iPattern = $aPattern;
+	$this->iColor = $aColor;
+	$this->iDensity = $aDensity;
+    }
+
+    function SetFillColor($aColor) {
+	$this->iFillColor = $aColor;
+    }
+	
+    function SetHeight($aHeight) {
+	$this->iHeight = $aHeight;
+    }
+}
+
+DEFINE('GANTT_HGRID1',0);
+DEFINE('GANTT_HGRID2',1);
+
+//===================================================
+// CLASS HorizontalGridLine
+// Responsible for drawinf horizontal gridlines and filled alternatibg rows
+//===================================================
+class HorizontalGridLine {
+    var $iGraph=NULL;
+    var $iRowColor1 = '', $iRowColor2 = '';
+    var $iShow=false;
+    var $line=null;
+    var $iStart=0; // 0=from left margin, 1=just along header
+
+    function HorizontalGridLine() {
+	$this->line = new LineProperty();
+	$this->line->SetColor('gray@0.4');
+	$this->line->SetStyle('dashed');
+    }
+    
+    function Show($aShow=true) {
+	$this->iShow = $aShow;
+    }
+
+    function SetRowFillColor($aColor1,$aColor2='') {
+	$this->iRowColor1 = $aColor1;
+	$this->iRowColor2 = $aColor2;
+    }
+
+    function SetStart($aStart) {
+	$this->iStart = $aStart;
+    }
+
+    function Stroke(&$aImg,$aScale) {
+	
+	if( ! $this->iShow ) return;
+
+	// Get horizontal width of line
+	/*
+	$limst = $aScale->iStartDate;
+	$limen = $aScale->iEndDate;
+	$xt = round($aScale->TranslateDate($aScale->iStartDate));
+	$xb = round($aScale->TranslateDate($limen)); 
+	*/
+
+	if( $this->iStart === 0 ) {
+	    $xt = $aImg->left_margin-1;
+	}
+	else {
+	    $xt = round($aScale->TranslateDate($aScale->iStartDate))+1;
+	}
+
+	$xb = $aImg->width-$aImg->right_margin;
+
+	$yt = round($aScale->TranslateVertPos(0));
+	$yb = round($aScale->TranslateVertPos(1));	    
+	$height = $yb - $yt;
+
+	// Loop around for all lines in the chart
+	for($i=0; $i < $aScale->iVertLines; ++$i ) {
+	    $yb = $yt - $height;
+	    $this->line->Stroke($aImg,$xt,$yb,$xb,$yb);
+	    if( $this->iRowColor1 !== '' ) {
+		if( $i % 2 == 0 ) {
+		    $aImg->PushColor($this->iRowColor1);
+		    $aImg->FilledRectangle($xt,$yt,$xb,$yb);
+		    $aImg->PopColor();
+		}
+		elseif( $this->iRowColor2 !== '' ) {
+		    $aImg->PushColor($this->iRowColor2);
+		    $aImg->FilledRectangle($xt,$yt,$xb,$yb);
+		    $aImg->PopColor();
+		}
+	    }
+	    $yt = round($aScale->TranslateVertPos($i+1));
+	}
+	$yb = $yt - $height;
+	$this->line->Stroke($aImg,$xt,$yb,$xb,$yb);
+    }
+}
+
+
+//===================================================
+// CLASS GanttBar
+// Responsible for formatting individual gantt bars
+//===================================================
+class GanttBar extends GanttPlotObject {
+    var $iEnd;
+    var $iHeightFactor=0.5;
+    var $iFillColor="white",$iFrameColor="black";
+    var $iShadow=false,$iShadowColor="darkgray",$iShadowWidth=1,$iShadowFrame="black";
+    var $iPattern=GANTT_RDIAG,$iPatternColor="blue",$iPatternDensity=95;
+    var $leftMark,$rightMark;
+    var $progress;
+//---------------
+// CONSTRUCTOR	
+    function GanttBar($aPos,$aLabel,$aStart,$aEnd,$aCaption="",$aHeightFactor=0.6) {
+	parent::GanttPlotObject();	
+	$this->iStart = $aStart;	
+	// Is the end date given as a date or as number of days added to start date?
+	if( is_string($aEnd) ) {
+	    // If end date has been specified without a time we will asssume
+	    // end date is at the end of that date
+	    if( strpos($aEnd,':') === false )
+		$this->iEnd = strtotime($aEnd)+SECPERDAY-1;
+	    else 
+		$this->iEnd = $aEnd;
+	}
+	elseif(is_int($aEnd) || is_float($aEnd) ) 
+	    $this->iEnd = strtotime($aStart)+round($aEnd*SECPERDAY);
+	$this->iVPos = $aPos;
+	$this->iHeightFactor = $aHeightFactor;
+	$this->title->Set($aLabel);
+	$this->caption = new TextProperty($aCaption);
+	$this->caption->Align("left","center");
+	$this->leftMark =new PlotMark();
+	$this->leftMark->Hide();
+	$this->rightMark=new PlotMark();
+	$this->rightMark->Hide();
+	$this->progress = new Progress();
+    }
+	
+//---------------
+// PUBLIC METHODS	
+    function SetShadow($aShadow=true,$aColor="gray") {
+	$this->iShadow=$aShadow;
+	$this->iShadowColor=$aColor;
+    }
+    
+    function GetMaxDate() {
+	return $this->iEnd;
+    }
+	
+    function SetHeight($aHeight) {
+	$this->iHeightFactor = $aHeight;
+    }
+
+    function SetColor($aColor) {
+	$this->iFrameColor = $aColor;
+    }
+
+    function SetFillColor($aColor) {
+	$this->iFillColor = $aColor;
+    }
+
+    function GetAbsHeight(&$aImg) {
+	if( is_int($this->iHeightFactor) || $this->leftMark->show || $this->rightMark->show ) {
+	    $m=-1;
+	    if( is_int($this->iHeightFactor) )
+		$m = $this->iHeightFactor;
+	    if( $this->leftMark->show ) 
+		$m = max($m,$this->leftMark->width*2);
+	    if( $this->rightMark->show ) 
+		$m = max($m,$this->rightMark->width*2);
+	    return $m;
+	}
+	else
+	    return -1;
+    }
+	
+    function SetPattern($aPattern,$aColor="blue",$aDensity=95) {		
+	$this->iPattern = $aPattern;
+	$this->iPatternColor = $aColor;
+	$this->iPatternDensity = $aDensity;
+    }
+
+    function Stroke(&$aImg,$aScale) {
+	$factory = new RectPatternFactory();
+	$prect = $factory->Create($this->iPattern,$this->iPatternColor);
+	$prect->SetDensity($this->iPatternDensity);
+
+	// If height factor is specified as a float between 0,1 then we take it as meaning
+	// percetage of the scale width between horizontal line.
+	// If it is an integer > 1 we take it to mean the absolute height in pixels
+	if( $this->iHeightFactor > -0.0 && $this->iHeightFactor <= 1.1)
+	    $vs = $aScale->GetVertSpacing()*$this->iHeightFactor;
+	elseif(is_int($this->iHeightFactor) && $this->iHeightFactor>2 && $this->iHeightFactor < 200 )
+	    $vs = $this->iHeightFactor;
+	else
+	    JpGraphError::RaiseL(6028,$this->iHeightFactor);
+//("Specified height (".$this->iHeightFactor.") for gantt bar is out of range.");
+	
+	// Clip date to min max dates to show
+	$st = $aScale->NormalizeDate($this->iStart);
+	$en = $aScale->NormalizeDate($this->iEnd);
+	
+
+	$limst = max($st,$aScale->iStartDate);
+	$limen = min($en,$aScale->iEndDate);
+			
+	$xt = round($aScale->TranslateDate($limst));
+	$xb = round($aScale->TranslateDate($limen)); 
+	$yt = round($aScale->TranslateVertPos($this->iVPos)-$vs-($aScale->GetVertSpacing()/2-$vs/2));
+	$yb = round($aScale->TranslateVertPos($this->iVPos)-($aScale->GetVertSpacing()/2-$vs/2));
+	$middle = round($yt+($yb-$yt)/2);
+	$this->StrokeActInfo($aImg,$aScale,$middle);
+
+	// CSIM for title
+	if( ! empty($this->title->csimtarget) ) {
+	    $colwidth = $this->title->GetColWidth($aImg);
+	    $colstarts=array();
+	    $aScale->actinfo->GetColStart($aImg,$colstarts,true);
+	    $n = min(count($colwidth),count($this->title->csimtarget));
+	    for( $i=0; $i < $n; ++$i ) {
+		$title_xt = $colstarts[$i];
+		$title_xb = $title_xt + $colwidth[$i];
+		$coords = "$title_xt,$yt,$title_xb,$yt,$title_xb,$yb,$title_xt,$yb";
+		$this->csimarea .= "<area shape=\"poly\" coords=\"$coords\" href=\"".$this->title->csimtarget[$i]."\"";
+		if( ! empty($this->title->csimalt[$i]) ) {
+		    $tmp = $this->title->csimalt[$i];
+		    $this->csimarea .= " title=\"$tmp\"";
+		}
+		$this->csimarea .= " alt=\"$tmp\" />\n";
+	    }
+	}
+
+	// Check if the bar is totally outside the current scale range
+	if( $en <  $aScale->iStartDate || $st > $aScale->iEndDate )
+		return;
+			
+
+	// Remember the positions for the bar
+	$this->SetConstrainPos($xt,$yt,$xb,$yb);
+		
+	$prect->ShowFrame(false);
+	$prect->SetBackground($this->iFillColor);
+	if( $this->iShadow ) {
+	    $aImg->SetColor($this->iFrameColor);
+	    $aImg->ShadowRectangle($xt,$yt,$xb,$yb,$this->iFillColor,$this->iShadowWidth,$this->iShadowColor);				
+	    $prect->SetPos(new Rectangle($xt+1,$yt+1,$xb-$xt-$this->iShadowWidth-2,$yb-$yt-$this->iShadowWidth-2));				
+	    $prect->Stroke($aImg);
+	}
+	else {	
+	    $prect->SetPos(new Rectangle($xt,$yt,$xb-$xt+1,$yb-$yt+1));				
+	    $prect->Stroke($aImg);
+	    $aImg->SetColor($this->iFrameColor);
+	    $aImg->Rectangle($xt,$yt,$xb,$yb);
+	}
+
+	// CSIM for bar
+	if( $this->csimtarget != '' ) {
+
+	    $coords = "$xt,$yt,$xb,$yt,$xb,$yb,$xt,$yb";
+	    $this->csimarea .= "<area shape=\"poly\" coords=\"$coords\" href=\"".
+		              $this->csimtarget."\"";
+	    if( $this->csimalt != '' ) {
+		$tmp = $this->csimalt;
+		$this->csimarea .= " title=\"$tmp\"";
+	    }
+	    $this->csimarea .= " alt=\"$tmp\" />\n";
+	}
+
+	// Draw progress bar inside activity bar
+	if( $this->progress->iProgress > 0 ) {
+		
+	    $xtp = $aScale->TranslateDate($st);
+	    $xbp = $aScale->TranslateDate($en);
+	    $len = ($xbp-$xtp)*$this->progress->iProgress;
+
+	    $endpos = $xtp+$len;
+	    if( $endpos > $xt ) {
+		$len -= ($xt-$xtp); 
+
+		// Make sure that the progess bar doesn't extend over the end date
+		if( $xtp+$len-1 > $xb )
+		    $len = $xb - $xtp + 1;
+		
+		if( $xtp < $xt ) 
+		    $xtp = $xt;
+		
+		$prog = $factory->Create($this->progress->iPattern,$this->progress->iColor);
+		$prog->SetDensity($this->progress->iDensity);
+		$prog->SetBackground($this->progress->iFillColor);
+	    	$barheight = ($yb-$yt+1);
+		if( $this->iShadow ) 
+		    $barheight -= $this->iShadowWidth;
+		$progressheight = floor($barheight*$this->progress->iHeight);
+		$marg = ceil(($barheight-$progressheight)/2);
+	    	$pos = new Rectangle($xtp,$yt + $marg, $len,$barheight-2*$marg);
+		$prog->SetPos($pos);
+		$prog->Stroke($aImg);
+	    }
+	}
+	
+	// We don't plot the end mark if the bar has been capped
+	if( $limst == $st ) {
+	    $y = $middle;
+	    // We treat the RIGHT and LEFT triangle mark a little bi
+	    // special so that these marks are placed right under the
+	    // bar.
+	    if( $this->leftMark->GetType() == MARK_LEFTTRIANGLE ) {
+		$y = $yb ; 
+	    }
+	    $this->leftMark->Stroke($aImg,$xt,$y);
+	}
+	if( $limen == $en ) {
+	    $y = $middle;
+	    // We treat the RIGHT and LEFT triangle mark a little bi
+	    // special so that these marks are placed right under the
+	    // bar.
+	    if( $this->rightMark->GetType() == MARK_RIGHTTRIANGLE ) {
+		$y = $yb ; 
+	    }
+	    $this->rightMark->Stroke($aImg,$xb,$y);
+	    
+	    $margin = $this->iCaptionMargin;
+	    if( $this->rightMark->show ) 
+	    	$margin += $this->rightMark->GetWidth();
+	    $this->caption->Stroke($aImg,$xb+$margin,$middle);		
+	}
+    }
+}
+
+//===================================================
+// CLASS MileStone
+// Responsible for formatting individual milestones
+//===================================================
+class MileStone extends GanttPlotObject {
+    var $mark;
+	
+//---------------
+// CONSTRUCTOR	
+    function MileStone($aVPos,$aLabel,$aDate,$aCaption="") {
+	GanttPlotObject::GanttPlotObject();
+	$this->caption->Set($aCaption);
+	$this->caption->Align("left","center");
+	$this->caption->SetFont(FF_FONT1,FS_BOLD);
+	$this->title->Set($aLabel);
+	$this->title->SetColor("darkred");
+	$this->mark = new PlotMark();
+	$this->mark->SetWidth(10);
+	$this->mark->SetType(MARK_DIAMOND);
+	$this->mark->SetColor("darkred");
+	$this->mark->SetFillColor("darkred");
+	$this->iVPos = $aVPos;
+	$this->iStart = $aDate;
+    }
+	
+//---------------
+// PUBLIC METHODS	
+	
+    function GetAbsHeight(&$aImg) {
+	return max($this->title->GetHeight($aImg),$this->mark->GetWidth());
+    }
+		
+    function Stroke(&$aImg,$aScale) {
+	// Put the mark in the middle at the middle of the day
+	$d = $aScale->NormalizeDate($this->iStart)+SECPERDAY/2;
+	$x = $aScale->TranslateDate($d);
+	$y = $aScale->TranslateVertPos($this->iVPos)-($aScale->GetVertSpacing()/2);
+
+	$this->StrokeActInfo($aImg,$aScale,$y);
+
+	// CSIM for title
+	if( ! empty($this->title->csimtarget) ) {
+	    
+	    $yt = round($y - $this->title->GetHeight($aImg)/2);
+	    $yb = round($y + $this->title->GetHeight($aImg)/2);
+
+	    $colwidth = $this->title->GetColWidth($aImg);
+	    $colstarts=array();
+	    $aScale->actinfo->GetColStart($aImg,$colstarts,true);
+	    $n = min(count($colwidth),count($this->title->csimtarget));
+	    for( $i=0; $i < $n; ++$i ) {
+		$title_xt = $colstarts[$i];
+		$title_xb = $title_xt + $colwidth[$i];
+		$coords = "$title_xt,$yt,$title_xb,$yt,$title_xb,$yb,$title_xt,$yb";
+		$this->csimarea .= "<area shape=\"poly\" coords=\"$coords\" href=\"".$this->title->csimtarget[$i]."\"";
+		if( ! empty($this->title->csimalt[$i]) ) {
+		    $tmp = $this->title->csimalt[$i];
+		    $this->csimarea .= " title=\"$tmp\"";
+		}
+		$this->csimarea .= " alt=\"$tmp\" />\n";
+	    }
+	}
+
+	if( $d <  $aScale->iStartDate || $d > $aScale->iEndDate )
+		return;
+
+	// Remember the coordinates for any constrains linking to
+	// this milestone
+	$w = $this->mark->GetWidth()/2;
+	$this->SetConstrainPos($x,round($y-$w),$x,round($y+$w));
+	
+	// Setup CSIM
+	if( $this->csimtarget != '' ) {
+	    $this->mark->SetCSIMTarget( $this->csimtarget );
+	    $this->mark->SetCSIMAlt( $this->csimalt );
+	}
+		
+	$this->mark->Stroke($aImg,$x,$y);		
+	$this->caption->Stroke($aImg,$x+$this->mark->width/2+$this->iCaptionMargin,$y);
+
+	$this->csimarea .= $this->mark->GetCSIMAreas();
+    }
+}
+
+
+//===================================================
+// CLASS GanttVLine
+// Responsible for formatting individual milestones
+//===================================================
+
+class TextPropertyBelow extends TextProperty {
+    function TextPropertyBelow($aTxt='') {
+	parent::TextProperty($aTxt);
+    }
+
+    function GetColWidth(&$aImg,$margin) {
+	// Since we are not stroking the title in the columns
+	// but rather under the graph we want this to return 0.
+	return array(0);
+    }
+}
+
+class GanttVLine extends GanttPlotObject {
+
+    var $iLine,$title_margin=3;
+    var $iDayOffset=1;	// Defult to right edge of day
+	
+//---------------
+// CONSTRUCTOR	
+    function GanttVLine($aDate,$aTitle="",$aColor="black",$aWeight=3,$aStyle="dashed") {
+	GanttPlotObject::GanttPlotObject();
+	$this->iLine = new LineProperty();
+	$this->iLine->SetColor($aColor);
+	$this->iLine->SetWeight($aWeight);
+	$this->iLine->SetStyle($aStyle);
+	$this->iStart = $aDate;
+	$this->title = new TextPropertyBelow();
+	$this->title->Set($aTitle);
+    }
+
+//---------------
+// PUBLIC METHODS	
+
+    function SetDayOffset($aOff=0.5) {
+	if( $aOff < 0.0 || $aOff > 1.0 )
+	    JpGraphError::RaiseL(6029);
+//("Offset for vertical line must be in range [0,1]");
+	$this->iDayOffset = $aOff;
+    }
+	
+    function SetTitleMargin($aMarg) {
+	$this->title_margin = $aMarg;
+    }
+	
+    function Stroke(&$aImg,$aScale) {
+	$d = $aScale->NormalizeDate($this->iStart);
+	if( $d <  $aScale->iStartDate || $d > $aScale->iEndDate )
+	    return;	
+	if($this->iDayOffset != 0.0)
+	    $d += 24*60*60*$this->iDayOffset;	
+	$x = $aScale->TranslateDate($d);	
+	$y1 = $aScale->iVertHeaderSize+$aImg->top_margin;
+	$y2 = $aImg->height - $aImg->bottom_margin;	
+	$this->iLine->Stroke($aImg,$x,$y1,$x,$y2);
+	$this->title->Align("center","top");
+	$this->title->Stroke($aImg,$x,$y2+$this->title_margin);
+    }	
+}
+
+//===================================================
+// CLASS LinkArrow
+// Handles the drawing of a an arrow 
+//===================================================
+class LinkArrow {
+    var $ix,$iy;
+    var $isizespec = array(
+	array(2,3),array(3,5),array(3,8),array(6,15),array(8,22));
+    var $iDirection=ARROW_DOWN,$iType=ARROWT_SOLID,$iSize=ARROW_S2;
+    var $iColor='black';
+
+    function LinkArrow($x,$y,$aDirection,$aType=ARROWT_SOLID,$aSize=ARROW_S2) {
+	$this->iDirection = $aDirection;
+	$this->iType = $aType;
+	$this->iSize = $aSize;
+	$this->ix = $x;
+	$this->iy = $y;
+    }
+    
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+
+    function SetSize($aSize) {
+	$this->iSize = $aSize;
+    }
+
+    function SetType($aType) {
+	$this->iType = $aType;
+    }
+
+    function Stroke(&$aImg) {
+	list($dx,$dy) = $this->isizespec[$this->iSize];
+	$x = $this->ix;
+	$y = $this->iy;
+	switch ( $this->iDirection ) {
+	    case ARROW_DOWN:
+		$c = array($x,$y,$x-$dx,$y-$dy,$x+$dx,$y-$dy,$x,$y);
+		break;
+	    case ARROW_UP:
+		$c = array($x,$y,$x-$dx,$y+$dy,$x+$dx,$y+$dy,$x,$y);
+		break;
+	    case ARROW_LEFT:
+		$c = array($x,$y,$x+$dy,$y-$dx,$x+$dy,$y+$dx,$x,$y);
+		break;
+	    case ARROW_RIGHT:
+		$c = array($x,$y,$x-$dy,$y-$dx,$x-$dy,$y+$dx,$x,$y);
+		break;
+	    default:
+		JpGraphError::RaiseL(6030);
+//('Unknown arrow direction for link.');
+		die();
+		break;
+	}
+	$aImg->SetColor($this->iColor);
+	switch( $this->iType ) {
+	    case ARROWT_SOLID:
+		$aImg->FilledPolygon($c);
+		break;
+	    case ARROWT_OPEN:
+		$aImg->Polygon($c);
+		break;
+	    default:
+		JpGraphError::RaiseL(6031);
+//('Unknown arrow type for link.');
+		die();
+		break;		
+	}
+    }
+}
+
+//===================================================
+// CLASS GanttLink
+// Handles the drawing of a link line between 2 points
+//===================================================
+
+class GanttLink {
+    var $ix1,$ix2,$iy1,$iy2;
+    var $iPathType=2,$iPathExtend=15;
+    var $iColor='black',$iWeight=1;
+    var $iArrowSize=ARROW_S2,$iArrowType=ARROWT_SOLID;
+
+    function GanttLink($x1=0,$y1=0,$x2=0,$y2=0) {
+	$this->ix1 = $x1;
+	$this->ix2 = $x2;
+	$this->iy1 = $y1;
+	$this->iy2 = $y2;
+    }
+
+    function SetPos($x1,$y1,$x2,$y2) {
+	$this->ix1 = $x1;
+	$this->ix2 = $x2;
+	$this->iy1 = $y1;
+	$this->iy2 = $y2;
+    }
+
+    function SetPath($aPath) {
+	$this->iPathType = $aPath;
+    }
+
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+
+    function SetArrow($aSize,$aType=ARROWT_SOLID) {
+	$this->iArrowSize = $aSize;
+	$this->iArrowType = $aType;
+    }
+    
+    function SetWeight($aWeight) {
+	$this->iWeight = $aWeight;
+    }
+
+    function Stroke(&$aImg) {
+	// The way the path for the arrow is constructed is partly based
+	// on some heuristics. This is not an exact science but draws the
+	// path in a way that, for me, makes esthetic sence. For example
+	// if the start and end activities are very close we make a small
+	// detour to endter the target horixontally. If there are more
+	// space between axctivities then no suh detour is made and the 
+	// target is "hit" directly vertical. I have tried to keep this
+	// simple. no doubt this could become almost infinitive complex
+	// and have some real AI. Feel free to modify this.
+	// This will no-doubt be tweaked as times go by. One design aim
+	// is to avoid having the user choose what types of arrow
+	// he wants.
+
+	// The arrow is drawn between (x1,y1) to (x2,y2)
+	$x1 = $this->ix1 ;
+	$x2 = $this->ix2 ;
+	$y1 = $this->iy1 ;
+	$y2 = $this->iy2 ;
+
+	// Depending on if the target is below or above we have to
+	// handle thi different.
+	if( $y2 > $y1 ) {
+	    $arrowtype = ARROW_DOWN;
+	    $midy = round(($y2-$y1)/2+$y1);
+	    if( $x2 > $x1 ) {
+		switch ( $this->iPathType  ) {
+		    case 0:
+			$c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			break;
+		    case 1:
+		    case 2:
+		    case 3:
+			$c = array($x1,$y1,$x2,$y1,$x2,$y2);
+			break;
+		    default:
+			JpGraphError::RaiseL(6032,$this->iPathType);
+//('Internal error: Unknown path type (='.$this->iPathType .') specified for link.');
+			exit(1);
+			break;
+		}
+	    }
+	    else {
+		switch ( $this->iPathType  ) {
+		    case 0:
+		    case 1:
+			$c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			break;
+		    case 2:
+			// Always extend out horizontally a bit from the first point
+			// If we draw a link back in time (end to start) and the bars 
+			// are very close we also change the path so it comes in from 
+			// the left on the activity
+			$c = array($x1,$y1,$x1+$this->iPathExtend,$y1,
+				   $x1+$this->iPathExtend,$midy,
+				   $x2,$midy,$x2,$y2);
+			break;
+		    case 3:
+			if( $y2-$midy < 6 ) {
+			    $c = array($x1,$y1,$x1,$midy,
+				       $x2-$this->iPathExtend,$midy,
+				       $x2-$this->iPathExtend,$y2,
+				       $x2,$y2);
+			    $arrowtype = ARROW_RIGHT;
+			}
+			else {
+			    $c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			}
+			break;
+		    default:
+			JpGraphError::RaiseL(6032,$this->iPathType);
+//('Internal error: Unknown path type specified for link.');
+			exit(1);
+			break;
+		}
+	    }
+	    $arrow = new LinkArrow($x2,$y2,$arrowtype);
+	}
+	else {
+	    // Y2 < Y1
+	    $arrowtype = ARROW_UP;
+	    $midy = round(($y1-$y2)/2+$y2);
+	    if( $x2 > $x1 ) {
+		switch ( $this->iPathType  ) {
+		    case 0:
+		    case 1:
+			$c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			break;
+		    case 3:
+			if( $midy-$y2 < 8 ) {
+			    $arrowtype = ARROW_RIGHT;
+			    $c = array($x1,$y1,$x1,$y2,$x2,$y2);
+			}
+			else {
+			    $c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			}
+			break;
+		    default:
+			JpGraphError::RaiseL(6032,$this->iPathType);
+//('Internal error: Unknown path type specified for link.');
+			break;
+		}
+	    }
+	    else {
+		switch ( $this->iPathType  ) {
+		    case 0:
+		    case 1:
+			$c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			break;
+		    case 2:
+			// Always extend out horizontally a bit from the first point
+			$c = array($x1,$y1,$x1+$this->iPathExtend,$y1,
+				   $x1+$this->iPathExtend,$midy,
+				   $x2,$midy,$x2,$y2);
+			break;
+		    case 3:
+			if( $midy-$y2 < 16 ) {
+			    $arrowtype = ARROW_RIGHT;
+			    $c = array($x1,$y1,$x1,$midy,$x2-$this->iPathExtend,$midy,
+				       $x2-$this->iPathExtend,$y2,
+				       $x2,$y2);
+			}
+			else {
+			    $c = array($x1,$y1,$x1,$midy,$x2,$midy,$x2,$y2);
+			}
+			break;
+		    default:
+			JpGraphError::RaiseL(6032,$this->iPathType);
+//('Internal error: Unknown path type specified for link.');
+			break;
+		}
+	    }
+	    $arrow = new LinkArrow($x2,$y2,$arrowtype);
+	}
+	$aImg->SetColor($this->iColor);
+	$aImg->SetLineWeight($this->iWeight);
+	$aImg->Polygon($c);
+	$aImg->SetLineWeight(1);
+	$arrow->SetColor($this->iColor);
+	$arrow->SetSize($this->iArrowSize);
+	$arrow->SetType($this->iArrowType);
+	$arrow->Stroke($aImg);
+    }
+}
+
+// <EOF>
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_gb2312.php php-syslog-ng/html/includes/jpgraph/jpgraph_gb2312.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_gb2312.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_gb2312.php	2005-05-30 16:35:34.000000000 -0400
@@ -0,0 +1,1553 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_GB2312.PHP
+// Description:	PHP4 Graph Plotting library. Chinese font conversions
+// Created: 	2003-05-30
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_gb2312.php 21 2005-05-30 20:35:34Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+
+class GB2312toUTF8 {
+// --------------------------------------------------------------------
+// This code table is used to translate GB2312 code (key) to 
+// it's corresponding Unicode value (data)
+// --------------------------------------------------------------------
+    var $codetable = array( 
+	8481 => 12288, 8482 => 12289, 8483 => 12290, 8484 => 12539, 8485 => 713,
+	8486 => 711, 8487 => 168, 8488 => 12291, 8489 => 12293, 8490 => 8213,
+	8491 => 65374, 8492 => 8214, 8493 => 8230, 8494 => 8216, 8495 => 8217,
+	8496 => 8220, 8497 => 8221, 8498 => 12308, 8499 => 12309, 8500 => 12296,
+	8501 => 12297, 8502 => 12298, 8503 => 12299, 8504 => 12300, 8505 => 12301,
+	8506 => 12302, 8507 => 12303, 8508 => 12310, 8509 => 12311, 8510 => 12304,
+	8511 => 12305, 8512 => 177, 8513 => 215, 8514 => 247, 8515 => 8758,
+	8516 => 8743, 8517 => 8744, 8518 => 8721, 8519 => 8719, 8520 => 8746,
+	8521 => 8745, 8522 => 8712, 8523 => 8759, 8524 => 8730, 8525 => 8869,
+	8526 => 8741, 8527 => 8736, 8528 => 8978, 8529 => 8857, 8530 => 8747,
+	8531 => 8750, 8532 => 8801, 8533 => 8780, 8534 => 8776, 8535 => 8765,
+	8536 => 8733, 8537 => 8800, 8538 => 8814, 8539 => 8815, 8540 => 8804,
+	8541 => 8805, 8542 => 8734, 8543 => 8757, 8544 => 8756, 8545 => 9794,
+	8546 => 9792, 8547 => 176, 8548 => 8242, 8549 => 8243, 8550 => 8451,
+	8551 => 65284, 8552 => 164, 8553 => 65504, 8554 => 65505, 8555 => 8240,
+	8556 => 167, 8557 => 8470, 8558 => 9734, 8559 => 9733, 8560 => 9675,
+	8561 => 9679, 8562 => 9678, 8563 => 9671, 8564 => 9670, 8565 => 9633,
+	8566 => 9632, 8567 => 9651, 8568 => 9650, 8569 => 8251, 8570 => 8594,
+	8571 => 8592, 8572 => 8593, 8573 => 8595, 8574 => 12307, 8753 => 9352,
+	8754 => 9353, 8755 => 9354, 8756 => 9355, 8757 => 9356, 8758 => 9357,
+	8759 => 9358, 8760 => 9359, 8761 => 9360, 8762 => 9361, 8763 => 9362,
+	8764 => 9363, 8765 => 9364, 8766 => 9365, 8767 => 9366, 8768 => 9367,
+	8769 => 9368, 8770 => 9369, 8771 => 9370, 8772 => 9371, 8773 => 9332,
+	8774 => 9333, 8775 => 9334, 8776 => 9335, 8777 => 9336, 8778 => 9337,
+	8779 => 9338, 8780 => 9339, 8781 => 9340, 8782 => 9341, 8783 => 9342,
+	8784 => 9343, 8785 => 9344, 8786 => 9345, 8787 => 9346, 8788 => 9347,
+	8789 => 9348, 8790 => 9349, 8791 => 9350, 8792 => 9351, 8793 => 9312,
+	8794 => 9313, 8795 => 9314, 8796 => 9315, 8797 => 9316, 8798 => 9317,
+	8799 => 9318, 8800 => 9319, 8801 => 9320, 8802 => 9321, 8805 => 12832,
+	8806 => 12833, 8807 => 12834, 8808 => 12835, 8809 => 12836, 8810 => 12837,
+	8811 => 12838, 8812 => 12839, 8813 => 12840, 8814 => 12841, 8817 => 8544,
+	8818 => 8545, 8819 => 8546, 8820 => 8547, 8821 => 8548, 8822 => 8549,
+	8823 => 8550, 8824 => 8551, 8825 => 8552, 8826 => 8553, 8827 => 8554,
+	8828 => 8555, 8993 => 65281, 8994 => 65282, 8995 => 65283, 8996 => 65509,
+	8997 => 65285, 8998 => 65286, 8999 => 65287, 9000 => 65288, 9001 => 65289,
+	9002 => 65290, 9003 => 65291, 9004 => 65292, 9005 => 65293, 9006 => 65294,
+	9007 => 65295, 9008 => 65296, 9009 => 65297, 9010 => 65298, 9011 => 65299,
+	9012 => 65300, 9013 => 65301, 9014 => 65302, 9015 => 65303, 9016 => 65304,
+	9017 => 65305, 9018 => 65306, 9019 => 65307, 9020 => 65308, 9021 => 65309,
+	9022 => 65310, 9023 => 65311, 9024 => 65312, 9025 => 65313, 9026 => 65314,
+	9027 => 65315, 9028 => 65316, 9029 => 65317, 9030 => 65318, 9031 => 65319,
+	9032 => 65320, 9033 => 65321, 9034 => 65322, 9035 => 65323, 9036 => 65324,
+	9037 => 65325, 9038 => 65326, 9039 => 65327, 9040 => 65328, 9041 => 65329,
+	9042 => 65330, 9043 => 65331, 9044 => 65332, 9045 => 65333, 9046 => 65334,
+	9047 => 65335, 9048 => 65336, 9049 => 65337, 9050 => 65338, 9051 => 65339,
+	9052 => 65340, 9053 => 65341, 9054 => 65342, 9055 => 65343, 9056 => 65344,
+	9057 => 65345, 9058 => 65346, 9059 => 65347, 9060 => 65348, 9061 => 65349,
+	9062 => 65350, 9063 => 65351, 9064 => 65352, 9065 => 65353, 9066 => 65354,
+	9067 => 65355, 9068 => 65356, 9069 => 65357, 9070 => 65358, 9071 => 65359,
+	9072 => 65360, 9073 => 65361, 9074 => 65362, 9075 => 65363, 9076 => 65364,
+	9077 => 65365, 9078 => 65366, 9079 => 65367, 9080 => 65368, 9081 => 65369,
+	9082 => 65370, 9083 => 65371, 9084 => 65372, 9085 => 65373, 9086 => 65507,
+	9249 => 12353, 9250 => 12354, 9251 => 12355, 9252 => 12356, 9253 => 12357,
+	9254 => 12358, 9255 => 12359, 9256 => 12360, 9257 => 12361, 9258 => 12362,
+	9259 => 12363, 9260 => 12364, 9261 => 12365, 9262 => 12366, 9263 => 12367,
+	9264 => 12368, 9265 => 12369, 9266 => 12370, 9267 => 12371, 9268 => 12372,
+	9269 => 12373, 9270 => 12374, 9271 => 12375, 9272 => 12376, 9273 => 12377,
+	9274 => 12378, 9275 => 12379, 9276 => 12380, 9277 => 12381, 9278 => 12382,
+	9279 => 12383, 9280 => 12384, 9281 => 12385, 9282 => 12386, 9283 => 12387,
+	9284 => 12388, 9285 => 12389, 9286 => 12390, 9287 => 12391, 9288 => 12392,
+	9289 => 12393, 9290 => 12394, 9291 => 12395, 9292 => 12396, 9293 => 12397,
+	9294 => 12398, 9295 => 12399, 9296 => 12400, 9297 => 12401, 9298 => 12402,
+	9299 => 12403, 9300 => 12404, 9301 => 12405, 9302 => 12406, 9303 => 12407,
+	9304 => 12408, 9305 => 12409, 9306 => 12410, 9307 => 12411, 9308 => 12412,
+	9309 => 12413, 9310 => 12414, 9311 => 12415, 9312 => 12416, 9313 => 12417,
+	9314 => 12418, 9315 => 12419, 9316 => 12420, 9317 => 12421, 9318 => 12422,
+	9319 => 12423, 9320 => 12424, 9321 => 12425, 9322 => 12426, 9323 => 12427,
+	9324 => 12428, 9325 => 12429, 9326 => 12430, 9327 => 12431, 9328 => 12432,
+	9329 => 12433, 9330 => 12434, 9331 => 12435, 9505 => 12449, 9506 => 12450,
+	9507 => 12451, 9508 => 12452, 9509 => 12453, 9510 => 12454, 9511 => 12455,
+	9512 => 12456, 9513 => 12457, 9514 => 12458, 9515 => 12459, 9516 => 12460,
+	9517 => 12461, 9518 => 12462, 9519 => 12463, 9520 => 12464, 9521 => 12465,
+	9522 => 12466, 9523 => 12467, 9524 => 12468, 9525 => 12469, 9526 => 12470,
+	9527 => 12471, 9528 => 12472, 9529 => 12473, 9530 => 12474, 9531 => 12475,
+	9532 => 12476, 9533 => 12477, 9534 => 12478, 9535 => 12479, 9536 => 12480,
+	9537 => 12481, 9538 => 12482, 9539 => 12483, 9540 => 12484, 9541 => 12485,
+	9542 => 12486, 9543 => 12487, 9544 => 12488, 9545 => 12489, 9546 => 12490,
+	9547 => 12491, 9548 => 12492, 9549 => 12493, 9550 => 12494, 9551 => 12495,
+	9552 => 12496, 9553 => 12497, 9554 => 12498, 9555 => 12499, 9556 => 12500,
+	9557 => 12501, 9558 => 12502, 9559 => 12503, 9560 => 12504, 9561 => 12505,
+	9562 => 12506, 9563 => 12507, 9564 => 12508, 9565 => 12509, 9566 => 12510,
+	9567 => 12511, 9568 => 12512, 9569 => 12513, 9570 => 12514, 9571 => 12515,
+	9572 => 12516, 9573 => 12517, 9574 => 12518, 9575 => 12519, 9576 => 12520,
+	9577 => 12521, 9578 => 12522, 9579 => 12523, 9580 => 12524, 9581 => 12525,
+	9582 => 12526, 9583 => 12527, 9584 => 12528, 9585 => 12529, 9586 => 12530,
+	9587 => 12531, 9588 => 12532, 9589 => 12533, 9590 => 12534, 9761 => 913,
+	9762 => 914, 9763 => 915, 9764 => 916, 9765 => 917, 9766 => 918,
+	9767 => 919, 9768 => 920, 9769 => 921, 9770 => 922, 9771 => 923,
+	9772 => 924, 9773 => 925, 9774 => 926, 9775 => 927, 9776 => 928,
+	9777 => 929, 9778 => 931, 9779 => 932, 9780 => 933, 9781 => 934,
+	9782 => 935, 9783 => 936, 9784 => 937, 9793 => 945, 9794 => 946,
+	9795 => 947, 9796 => 948, 9797 => 949, 9798 => 950, 9799 => 951,
+	9800 => 952, 9801 => 953, 9802 => 954, 9803 => 955, 9804 => 956,
+	9805 => 957, 9806 => 958, 9807 => 959, 9808 => 960, 9809 => 961,
+	9810 => 963, 9811 => 964, 9812 => 965, 9813 => 966, 9814 => 967,
+	9815 => 968, 9816 => 969, 10017 => 1040, 10018 => 1041, 10019 => 1042,
+	10020 => 1043, 10021 => 1044, 10022 => 1045, 10023 => 1025, 10024 => 1046,
+	10025 => 1047, 10026 => 1048, 10027 => 1049, 10028 => 1050, 10029 => 1051,
+	10030 => 1052, 10031 => 1053, 10032 => 1054, 10033 => 1055, 10034 => 1056,
+	10035 => 1057, 10036 => 1058, 10037 => 1059, 10038 => 1060, 10039 => 1061,
+	10040 => 1062, 10041 => 1063, 10042 => 1064, 10043 => 1065, 10044 => 1066,
+	10045 => 1067, 10046 => 1068, 10047 => 1069, 10048 => 1070, 10049 => 1071,
+	10065 => 1072, 10066 => 1073, 10067 => 1074, 10068 => 1075, 10069 => 1076,
+	10070 => 1077, 10071 => 1105, 10072 => 1078, 10073 => 1079, 10074 => 1080,
+	10075 => 1081, 10076 => 1082, 10077 => 1083, 10078 => 1084, 10079 => 1085,
+	10080 => 1086, 10081 => 1087, 10082 => 1088, 10083 => 1089, 10084 => 1090,
+	10085 => 1091, 10086 => 1092, 10087 => 1093, 10088 => 1094, 10089 => 1095,
+	10090 => 1096, 10091 => 1097, 10092 => 1098, 10093 => 1099, 10094 => 1100,
+	10095 => 1101, 10096 => 1102, 10097 => 1103, 10273 => 257, 10274 => 225,
+	10275 => 462, 10276 => 224, 10277 => 275, 10278 => 233, 10279 => 283,
+	10280 => 232, 10281 => 299, 10282 => 237, 10283 => 464, 10284 => 236,
+	10285 => 333, 10286 => 243, 10287 => 466, 10288 => 242, 10289 => 363,
+	10290 => 250, 10291 => 468, 10292 => 249, 10293 => 470, 10294 => 472,
+	10295 => 474, 10296 => 476, 10297 => 252, 10298 => 234, 10309 => 12549,
+	10310 => 12550, 10311 => 12551, 10312 => 12552, 10313 => 12553, 10314 => 12554,
+	10315 => 12555, 10316 => 12556, 10317 => 12557, 10318 => 12558, 10319 => 12559,
+	10320 => 12560, 10321 => 12561, 10322 => 12562, 10323 => 12563, 10324 => 12564,
+	10325 => 12565, 10326 => 12566, 10327 => 12567, 10328 => 12568, 10329 => 12569,
+	10330 => 12570, 10331 => 12571, 10332 => 12572, 10333 => 12573, 10334 => 12574,
+	10335 => 12575, 10336 => 12576, 10337 => 12577, 10338 => 12578, 10339 => 12579,
+	10340 => 12580, 10341 => 12581, 10342 => 12582, 10343 => 12583, 10344 => 12584,
+	10345 => 12585, 10532 => 9472, 10533 => 9473, 10534 => 9474, 10535 => 9475,
+	10536 => 9476, 10537 => 9477, 10538 => 9478, 10539 => 9479, 10540 => 9480,
+	10541 => 9481, 10542 => 9482, 10543 => 9483, 10544 => 9484, 10545 => 9485,
+	10546 => 9486, 10547 => 9487, 10548 => 9488, 10549 => 9489, 10550 => 9490,
+	10551 => 9491, 10552 => 9492, 10553 => 9493, 10554 => 9494, 10555 => 9495,
+	10556 => 9496, 10557 => 9497, 10558 => 9498, 10559 => 9499, 10560 => 9500,
+	10561 => 9501, 10562 => 9502, 10563 => 9503, 10564 => 9504, 10565 => 9505,
+	10566 => 9506, 10567 => 9507, 10568 => 9508, 10569 => 9509, 10570 => 9510,
+	10571 => 9511, 10572 => 9512, 10573 => 9513, 10574 => 9514, 10575 => 9515,
+	10576 => 9516, 10577 => 9517, 10578 => 9518, 10579 => 9519, 10580 => 9520,
+	10581 => 9521, 10582 => 9522, 10583 => 9523, 10584 => 9524, 10585 => 9525,
+	10586 => 9526, 10587 => 9527, 10588 => 9528, 10589 => 9529, 10590 => 9530,
+	10591 => 9531, 10592 => 9532, 10593 => 9533, 10594 => 9534, 10595 => 9535,
+	10596 => 9536, 10597 => 9537, 10598 => 9538, 10599 => 9539, 10600 => 9540,
+	10601 => 9541, 10602 => 9542, 10603 => 9543, 10604 => 9544, 10605 => 9545,
+	10606 => 9546, 10607 => 9547, 12321 => 21834, 12322 => 38463, 12323 => 22467,
+	12324 => 25384, 12325 => 21710, 12326 => 21769, 12327 => 21696, 12328 => 30353,
+	12329 => 30284, 12330 => 34108, 12331 => 30702, 12332 => 33406, 12333 => 30861,
+	12334 => 29233, 12335 => 38552, 12336 => 38797, 12337 => 27688, 12338 => 23433,
+	12339 => 20474, 12340 => 25353, 12341 => 26263, 12342 => 23736, 12343 => 33018,
+	12344 => 26696, 12345 => 32942, 12346 => 26114, 12347 => 30414, 12348 => 20985,
+	12349 => 25942, 12350 => 29100, 12351 => 32753, 12352 => 34948, 12353 => 20658,
+	12354 => 22885, 12355 => 25034, 12356 => 28595, 12357 => 33453, 12358 => 25420,
+	12359 => 25170, 12360 => 21485, 12361 => 21543, 12362 => 31494, 12363 => 20843,
+	12364 => 30116, 12365 => 24052, 12366 => 25300, 12367 => 36299, 12368 => 38774,
+	12369 => 25226, 12370 => 32793, 12371 => 22365, 12372 => 38712, 12373 => 32610,
+	12374 => 29240, 12375 => 30333, 12376 => 26575, 12377 => 30334, 12378 => 25670,
+	12379 => 20336, 12380 => 36133, 12381 => 25308, 12382 => 31255, 12383 => 26001,
+	12384 => 29677, 12385 => 25644, 12386 => 25203, 12387 => 33324, 12388 => 39041,
+	12389 => 26495, 12390 => 29256, 12391 => 25198, 12392 => 25292, 12393 => 20276,
+	12394 => 29923, 12395 => 21322, 12396 => 21150, 12397 => 32458, 12398 => 37030,
+	12399 => 24110, 12400 => 26758, 12401 => 27036, 12402 => 33152, 12403 => 32465,
+	12404 => 26834, 12405 => 30917, 12406 => 34444, 12407 => 38225, 12408 => 20621,
+	12409 => 35876, 12410 => 33502, 12411 => 32990, 12412 => 21253, 12413 => 35090,
+	12414 => 21093, 12577 => 34180, 12578 => 38649, 12579 => 20445, 12580 => 22561,
+	12581 => 39281, 12582 => 23453, 12583 => 25265, 12584 => 25253, 12585 => 26292,
+	12586 => 35961, 12587 => 40077, 12588 => 29190, 12589 => 26479, 12590 => 30865,
+	12591 => 24754, 12592 => 21329, 12593 => 21271, 12594 => 36744, 12595 => 32972,
+	12596 => 36125, 12597 => 38049, 12598 => 20493, 12599 => 29384, 12600 => 22791,
+	12601 => 24811, 12602 => 28953, 12603 => 34987, 12604 => 22868, 12605 => 33519,
+	12606 => 26412, 12607 => 31528, 12608 => 23849, 12609 => 32503, 12610 => 29997,
+	12611 => 27893, 12612 => 36454, 12613 => 36856, 12614 => 36924, 12615 => 40763,
+	12616 => 27604, 12617 => 37145, 12618 => 31508, 12619 => 24444, 12620 => 30887,
+	12621 => 34006, 12622 => 34109, 12623 => 27605, 12624 => 27609, 12625 => 27606,
+	12626 => 24065, 12627 => 24199, 12628 => 30201, 12629 => 38381, 12630 => 25949,
+	12631 => 24330, 12632 => 24517, 12633 => 36767, 12634 => 22721, 12635 => 33218,
+	12636 => 36991, 12637 => 38491, 12638 => 38829, 12639 => 36793, 12640 => 32534,
+	12641 => 36140, 12642 => 25153, 12643 => 20415, 12644 => 21464, 12645 => 21342,
+	12646 => 36776, 12647 => 36777, 12648 => 36779, 12649 => 36941, 12650 => 26631,
+	12651 => 24426, 12652 => 33176, 12653 => 34920, 12654 => 40150, 12655 => 24971,
+	12656 => 21035, 12657 => 30250, 12658 => 24428, 12659 => 25996, 12660 => 28626,
+	12661 => 28392, 12662 => 23486, 12663 => 25672, 12664 => 20853, 12665 => 20912,
+	12666 => 26564, 12667 => 19993, 12668 => 31177, 12669 => 39292, 12670 => 28851,
+	12833 => 30149, 12834 => 24182, 12835 => 29627, 12836 => 33760, 12837 => 25773,
+	12838 => 25320, 12839 => 38069, 12840 => 27874, 12841 => 21338, 12842 => 21187,
+	12843 => 25615, 12844 => 38082, 12845 => 31636, 12846 => 20271, 12847 => 24091,
+	12848 => 33334, 12849 => 33046, 12850 => 33162, 12851 => 28196, 12852 => 27850,
+	12853 => 39539, 12854 => 25429, 12855 => 21340, 12856 => 21754, 12857 => 34917,
+	12858 => 22496, 12859 => 19981, 12860 => 24067, 12861 => 27493, 12862 => 31807,
+	12863 => 37096, 12864 => 24598, 12865 => 25830, 12866 => 29468, 12867 => 35009,
+	12868 => 26448, 12869 => 25165, 12870 => 36130, 12871 => 30572, 12872 => 36393,
+	12873 => 37319, 12874 => 24425, 12875 => 33756, 12876 => 34081, 12877 => 39184,
+	12878 => 21442, 12879 => 34453, 12880 => 27531, 12881 => 24813, 12882 => 24808,
+	12883 => 28799, 12884 => 33485, 12885 => 33329, 12886 => 20179, 12887 => 27815,
+	12888 => 34255, 12889 => 25805, 12890 => 31961, 12891 => 27133, 12892 => 26361,
+	12893 => 33609, 12894 => 21397, 12895 => 31574, 12896 => 20391, 12897 => 20876,
+	12898 => 27979, 12899 => 23618, 12900 => 36461, 12901 => 25554, 12902 => 21449,
+	12903 => 33580, 12904 => 33590, 12905 => 26597, 12906 => 30900, 12907 => 25661,
+	12908 => 23519, 12909 => 23700, 12910 => 24046, 12911 => 35815, 12912 => 25286,
+	12913 => 26612, 12914 => 35962, 12915 => 25600, 12916 => 25530, 12917 => 34633,
+	12918 => 39307, 12919 => 35863, 12920 => 32544, 12921 => 38130, 12922 => 20135,
+	12923 => 38416, 12924 => 39076, 12925 => 26124, 12926 => 29462, 13089 => 22330,
+	13090 => 23581, 13091 => 24120, 13092 => 38271, 13093 => 20607, 13094 => 32928,
+	13095 => 21378, 13096 => 25950, 13097 => 30021, 13098 => 21809, 13099 => 20513,
+	13100 => 36229, 13101 => 25220, 13102 => 38046, 13103 => 26397, 13104 => 22066,
+	13105 => 28526, 13106 => 24034, 13107 => 21557, 13108 => 28818, 13109 => 36710,
+	13110 => 25199, 13111 => 25764, 13112 => 25507, 13113 => 24443, 13114 => 28552,
+	13115 => 37108, 13116 => 33251, 13117 => 36784, 13118 => 23576, 13119 => 26216,
+	13120 => 24561, 13121 => 27785, 13122 => 38472, 13123 => 36225, 13124 => 34924,
+	13125 => 25745, 13126 => 31216, 13127 => 22478, 13128 => 27225, 13129 => 25104,
+	13130 => 21576, 13131 => 20056, 13132 => 31243, 13133 => 24809, 13134 => 28548,
+	13135 => 35802, 13136 => 25215, 13137 => 36894, 13138 => 39563, 13139 => 31204,
+13140 => 21507, 13141 => 30196, 13142 => 25345, 13143 => 21273, 13144 => 27744,
+13145 => 36831, 13146 => 24347, 13147 => 39536, 13148 => 32827, 13149 => 40831,
+13150 => 20360, 13151 => 23610, 13152 => 36196, 13153 => 32709, 13154 => 26021,
+13155 => 28861, 13156 => 20805, 13157 => 20914, 13158 => 34411, 13159 => 23815,
+13160 => 23456, 13161 => 25277, 13162 => 37228, 13163 => 30068, 13164 => 36364,
+13165 => 31264, 13166 => 24833, 13167 => 31609, 13168 => 20167, 13169 => 32504,
+13170 => 30597, 13171 => 19985, 13172 => 33261, 13173 => 21021, 13174 => 20986,
+13175 => 27249, 13176 => 21416, 13177 => 36487, 13178 => 38148, 13179 => 38607,
+13180 => 28353, 13181 => 38500, 13182 => 26970, 13345 => 30784, 13346 => 20648,
+13347 => 30679, 13348 => 25616, 13349 => 35302, 13350 => 22788, 13351 => 25571,
+13352 => 24029, 13353 => 31359, 13354 => 26941, 13355 => 20256, 13356 => 33337,
+13357 => 21912, 13358 => 20018, 13359 => 30126, 13360 => 31383, 13361 => 24162,
+13362 => 24202, 13363 => 38383, 13364 => 21019, 13365 => 21561, 13366 => 28810,
+13367 => 25462, 13368 => 38180, 13369 => 22402, 13370 => 26149, 13371 => 26943,
+13372 => 37255, 13373 => 21767, 13374 => 28147, 13375 => 32431, 13376 => 34850,
+13377 => 25139, 13378 => 32496, 13379 => 30133, 13380 => 33576, 13381 => 30913,
+13382 => 38604, 13383 => 36766, 13384 => 24904, 13385 => 29943, 13386 => 35789,
+13387 => 27492, 13388 => 21050, 13389 => 36176, 13390 => 27425, 13391 => 32874,
+13392 => 33905, 13393 => 22257, 13394 => 21254, 13395 => 20174, 13396 => 19995,
+13397 => 20945, 13398 => 31895, 13399 => 37259, 13400 => 31751, 13401 => 20419,
+13402 => 36479, 13403 => 31713, 13404 => 31388, 13405 => 25703, 13406 => 23828,
+13407 => 20652, 13408 => 33030, 13409 => 30209, 13410 => 31929, 13411 => 28140,
+13412 => 32736, 13413 => 26449, 13414 => 23384, 13415 => 23544, 13416 => 30923,
+13417 => 25774, 13418 => 25619, 13419 => 25514, 13420 => 25387, 13421 => 38169,
+13422 => 25645, 13423 => 36798, 13424 => 31572, 13425 => 30249, 13426 => 25171,
+13427 => 22823, 13428 => 21574, 13429 => 27513, 13430 => 20643, 13431 => 25140,
+13432 => 24102, 13433 => 27526, 13434 => 20195, 13435 => 36151, 13436 => 34955,
+13437 => 24453, 13438 => 36910, 13601 => 24608, 13602 => 32829, 13603 => 25285,
+13604 => 20025, 13605 => 21333, 13606 => 37112, 13607 => 25528, 13608 => 32966,
+13609 => 26086, 13610 => 27694, 13611 => 20294, 13612 => 24814, 13613 => 28129,
+13614 => 35806, 13615 => 24377, 13616 => 34507, 13617 => 24403, 13618 => 25377,
+13619 => 20826, 13620 => 33633, 13621 => 26723, 13622 => 20992, 13623 => 25443,
+13624 => 36424, 13625 => 20498, 13626 => 23707, 13627 => 31095, 13628 => 23548,
+13629 => 21040, 13630 => 31291, 13631 => 24764, 13632 => 36947, 13633 => 30423,
+13634 => 24503, 13635 => 24471, 13636 => 30340, 13637 => 36460, 13638 => 28783,
+13639 => 30331, 13640 => 31561, 13641 => 30634, 13642 => 20979, 13643 => 37011,
+13644 => 22564, 13645 => 20302, 13646 => 28404, 13647 => 36842, 13648 => 25932,
+13649 => 31515, 13650 => 29380, 13651 => 28068, 13652 => 32735, 13653 => 23265,
+13654 => 25269, 13655 => 24213, 13656 => 22320, 13657 => 33922, 13658 => 31532,
+13659 => 24093, 13660 => 24351, 13661 => 36882, 13662 => 32532, 13663 => 39072,
+13664 => 25474, 13665 => 28359, 13666 => 30872, 13667 => 28857, 13668 => 20856,
+13669 => 38747, 13670 => 22443, 13671 => 30005, 13672 => 20291, 13673 => 30008,
+13674 => 24215, 13675 => 24806, 13676 => 22880, 13677 => 28096, 13678 => 27583,
+13679 => 30857, 13680 => 21500, 13681 => 38613, 13682 => 20939, 13683 => 20993,
+13684 => 25481, 13685 => 21514, 13686 => 38035, 13687 => 35843, 13688 => 36300,
+13689 => 29241, 13690 => 30879, 13691 => 34678, 13692 => 36845, 13693 => 35853,
+13694 => 21472, 13857 => 19969, 13858 => 30447, 13859 => 21486, 13860 => 38025,
+13861 => 39030, 13862 => 40718, 13863 => 38189, 13864 => 23450, 13865 => 35746,
+13866 => 20002, 13867 => 19996, 13868 => 20908, 13869 => 33891, 13870 => 25026,
+13871 => 21160, 13872 => 26635, 13873 => 20375, 13874 => 24683, 13875 => 20923,
+13876 => 27934, 13877 => 20828, 13878 => 25238, 13879 => 26007, 13880 => 38497,
+13881 => 35910, 13882 => 36887, 13883 => 30168, 13884 => 37117, 13885 => 30563,
+13886 => 27602, 13887 => 29322, 13888 => 29420, 13889 => 35835, 13890 => 22581,
+13891 => 30585, 13892 => 36172, 13893 => 26460, 13894 => 38208, 13895 => 32922,
+13896 => 24230, 13897 => 28193, 13898 => 22930, 13899 => 31471, 13900 => 30701,
+13901 => 38203, 13902 => 27573, 13903 => 26029, 13904 => 32526, 13905 => 22534,
+13906 => 20817, 13907 => 38431, 13908 => 23545, 13909 => 22697, 13910 => 21544,
+13911 => 36466, 13912 => 25958, 13913 => 39039, 13914 => 22244, 13915 => 38045,
+13916 => 30462, 13917 => 36929, 13918 => 25479, 13919 => 21702, 13920 => 22810,
+13921 => 22842, 13922 => 22427, 13923 => 36530, 13924 => 26421, 13925 => 36346,
+13926 => 33333, 13927 => 21057, 13928 => 24816, 13929 => 22549, 13930 => 34558,
+13931 => 23784, 13932 => 40517, 13933 => 20420, 13934 => 39069, 13935 => 35769,
+13936 => 23077, 13937 => 24694, 13938 => 21380, 13939 => 25212, 13940 => 36943,
+13941 => 37122, 13942 => 39295, 13943 => 24681, 13944 => 32780, 13945 => 20799,
+13946 => 32819, 13947 => 23572, 13948 => 39285, 13949 => 27953, 13950 => 20108,
+14113 => 36144, 14114 => 21457, 14115 => 32602, 14116 => 31567, 14117 => 20240,
+14118 => 20047, 14119 => 38400, 14120 => 27861, 14121 => 29648, 14122 => 34281,
+14123 => 24070, 14124 => 30058, 14125 => 32763, 14126 => 27146, 14127 => 30718,
+14128 => 38034, 14129 => 32321, 14130 => 20961, 14131 => 28902, 14132 => 21453,
+14133 => 36820, 14134 => 33539, 14135 => 36137, 14136 => 29359, 14137 => 39277,
+14138 => 27867, 14139 => 22346, 14140 => 33459, 14141 => 26041, 14142 => 32938,
+14143 => 25151, 14144 => 38450, 14145 => 22952, 14146 => 20223, 14147 => 35775,
+14148 => 32442, 14149 => 25918, 14150 => 33778, 14151 => 38750, 14152 => 21857,
+14153 => 39134, 14154 => 32933, 14155 => 21290, 14156 => 35837, 14157 => 21536,
+14158 => 32954, 14159 => 24223, 14160 => 27832, 14161 => 36153, 14162 => 33452,
+14163 => 37210, 14164 => 21545, 14165 => 27675, 14166 => 20998, 14167 => 32439,
+14168 => 22367, 14169 => 28954, 14170 => 27774, 14171 => 31881, 14172 => 22859,
+14173 => 20221, 14174 => 24575, 14175 => 24868, 14176 => 31914, 14177 => 20016,
+14178 => 23553, 14179 => 26539, 14180 => 34562, 14181 => 23792, 14182 => 38155,
+14183 => 39118, 14184 => 30127, 14185 => 28925, 14186 => 36898, 14187 => 20911,
+14188 => 32541, 14189 => 35773, 14190 => 22857, 14191 => 20964, 14192 => 20315,
+14193 => 21542, 14194 => 22827, 14195 => 25975, 14196 => 32932, 14197 => 23413,
+14198 => 25206, 14199 => 25282, 14200 => 36752, 14201 => 24133, 14202 => 27679,
+14203 => 31526, 14204 => 20239, 14205 => 20440, 14206 => 26381, 14369 => 28014,
+14370 => 28074, 14371 => 31119, 14372 => 34993, 14373 => 24343, 14374 => 29995,
+14375 => 25242, 14376 => 36741, 14377 => 20463, 14378 => 37340, 14379 => 26023,
+14380 => 33071, 14381 => 33105, 14382 => 24220, 14383 => 33104, 14384 => 36212,
+14385 => 21103, 14386 => 35206, 14387 => 36171, 14388 => 22797, 14389 => 20613,
+14390 => 20184, 14391 => 38428, 14392 => 29238, 14393 => 33145, 14394 => 36127,
+14395 => 23500, 14396 => 35747, 14397 => 38468, 14398 => 22919, 14399 => 32538,
+14400 => 21648, 14401 => 22134, 14402 => 22030, 14403 => 35813, 14404 => 25913,
+14405 => 27010, 14406 => 38041, 14407 => 30422, 14408 => 28297, 14409 => 24178,
+14410 => 29976, 14411 => 26438, 14412 => 26577, 14413 => 31487, 14414 => 32925,
+14415 => 36214, 14416 => 24863, 14417 => 31174, 14418 => 25954, 14419 => 36195,
+14420 => 20872, 14421 => 21018, 14422 => 38050, 14423 => 32568, 14424 => 32923,
+14425 => 32434, 14426 => 23703, 14427 => 28207, 14428 => 26464, 14429 => 31705,
+14430 => 30347, 14431 => 39640, 14432 => 33167, 14433 => 32660, 14434 => 31957,
+14435 => 25630, 14436 => 38224, 14437 => 31295, 14438 => 21578, 14439 => 21733,
+14440 => 27468, 14441 => 25601, 14442 => 25096, 14443 => 40509, 14444 => 33011,
+14445 => 30105, 14446 => 21106, 14447 => 38761, 14448 => 33883, 14449 => 26684,
+14450 => 34532, 14451 => 38401, 14452 => 38548, 14453 => 38124, 14454 => 20010,
+14455 => 21508, 14456 => 32473, 14457 => 26681, 14458 => 36319, 14459 => 32789,
+14460 => 26356, 14461 => 24218, 14462 => 32697, 14625 => 22466, 14626 => 32831,
+14627 => 26775, 14628 => 24037, 14629 => 25915, 14630 => 21151, 14631 => 24685,
+14632 => 40858, 14633 => 20379, 14634 => 36524, 14635 => 20844, 14636 => 23467,
+14637 => 24339, 14638 => 24041, 14639 => 27742, 14640 => 25329, 14641 => 36129,
+14642 => 20849, 14643 => 38057, 14644 => 21246, 14645 => 27807, 14646 => 33503,
+14647 => 29399, 14648 => 22434, 14649 => 26500, 14650 => 36141, 14651 => 22815,
+14652 => 36764, 14653 => 33735, 14654 => 21653, 14655 => 31629, 14656 => 20272,
+14657 => 27837, 14658 => 23396, 14659 => 22993, 14660 => 40723, 14661 => 21476,
+14662 => 34506, 14663 => 39592, 14664 => 35895, 14665 => 32929, 14666 => 25925,
+14667 => 39038, 14668 => 22266, 14669 => 38599, 14670 => 21038, 14671 => 29916,
+14672 => 21072, 14673 => 23521, 14674 => 25346, 14675 => 35074, 14676 => 20054,
+14677 => 25296, 14678 => 24618, 14679 => 26874, 14680 => 20851, 14681 => 23448,
+14682 => 20896, 14683 => 35266, 14684 => 31649, 14685 => 39302, 14686 => 32592,
+14687 => 24815, 14688 => 28748, 14689 => 36143, 14690 => 20809, 14691 => 24191,
+14692 => 36891, 14693 => 29808, 14694 => 35268, 14695 => 22317, 14696 => 30789,
+14697 => 24402, 14698 => 40863, 14699 => 38394, 14700 => 36712, 14701 => 39740,
+14702 => 35809, 14703 => 30328, 14704 => 26690, 14705 => 26588, 14706 => 36330,
+14707 => 36149, 14708 => 21053, 14709 => 36746, 14710 => 28378, 14711 => 26829,
+14712 => 38149, 14713 => 37101, 14714 => 22269, 14715 => 26524, 14716 => 35065,
+14717 => 36807, 14718 => 21704, 14881 => 39608, 14882 => 23401, 14883 => 28023,
+14884 => 27686, 14885 => 20133, 14886 => 23475, 14887 => 39559, 14888 => 37219,
+14889 => 25000, 14890 => 37039, 14891 => 38889, 14892 => 21547, 14893 => 28085,
+14894 => 23506, 14895 => 20989, 14896 => 21898, 14897 => 32597, 14898 => 32752,
+14899 => 25788, 14900 => 25421, 14901 => 26097, 14902 => 25022, 14903 => 24717,
+14904 => 28938, 14905 => 27735, 14906 => 27721, 14907 => 22831, 14908 => 26477,
+14909 => 33322, 14910 => 22741, 14911 => 22158, 14912 => 35946, 14913 => 27627,
+14914 => 37085, 14915 => 22909, 14916 => 32791, 14917 => 21495, 14918 => 28009,
+14919 => 21621, 14920 => 21917, 14921 => 33655, 14922 => 33743, 14923 => 26680,
+14924 => 31166, 14925 => 21644, 14926 => 20309, 14927 => 21512, 14928 => 30418,
+14929 => 35977, 14930 => 38402, 14931 => 27827, 14932 => 28088, 14933 => 36203,
+14934 => 35088, 14935 => 40548, 14936 => 36154, 14937 => 22079, 14938 => 40657,
+14939 => 30165, 14940 => 24456, 14941 => 29408, 14942 => 24680, 14943 => 21756,
+14944 => 20136, 14945 => 27178, 14946 => 34913, 14947 => 24658, 14948 => 36720,
+14949 => 21700, 14950 => 28888, 14951 => 34425, 14952 => 40511, 14953 => 27946,
+14954 => 23439, 14955 => 24344, 14956 => 32418, 14957 => 21897, 14958 => 20399,
+14959 => 29492, 14960 => 21564, 14961 => 21402, 14962 => 20505, 14963 => 21518,
+14964 => 21628, 14965 => 20046, 14966 => 24573, 14967 => 29786, 14968 => 22774,
+14969 => 33899, 14970 => 32993, 14971 => 34676, 14972 => 29392, 14973 => 31946,
+14974 => 28246, 15137 => 24359, 15138 => 34382, 15139 => 21804, 15140 => 25252,
+15141 => 20114, 15142 => 27818, 15143 => 25143, 15144 => 33457, 15145 => 21719,
+15146 => 21326, 15147 => 29502, 15148 => 28369, 15149 => 30011, 15150 => 21010,
+15151 => 21270, 15152 => 35805, 15153 => 27088, 15154 => 24458, 15155 => 24576,
+15156 => 28142, 15157 => 22351, 15158 => 27426, 15159 => 29615, 15160 => 26707,
+15161 => 36824, 15162 => 32531, 15163 => 25442, 15164 => 24739, 15165 => 21796,
+15166 => 30186, 15167 => 35938, 15168 => 28949, 15169 => 28067, 15170 => 23462,
+15171 => 24187, 15172 => 33618, 15173 => 24908, 15174 => 40644, 15175 => 30970,
+15176 => 34647, 15177 => 31783, 15178 => 30343, 15179 => 20976, 15180 => 24822,
+15181 => 29004, 15182 => 26179, 15183 => 24140, 15184 => 24653, 15185 => 35854,
+15186 => 28784, 15187 => 25381, 15188 => 36745, 15189 => 24509, 15190 => 24674,
+15191 => 34516, 15192 => 22238, 15193 => 27585, 15194 => 24724, 15195 => 24935,
+15196 => 21321, 15197 => 24800, 15198 => 26214, 15199 => 36159, 15200 => 31229,
+15201 => 20250, 15202 => 28905, 15203 => 27719, 15204 => 35763, 15205 => 35826,
+15206 => 32472, 15207 => 33636, 15208 => 26127, 15209 => 23130, 15210 => 39746,
+15211 => 27985, 15212 => 28151, 15213 => 35905, 15214 => 27963, 15215 => 20249,
+15216 => 28779, 15217 => 33719, 15218 => 25110, 15219 => 24785, 15220 => 38669,
+15221 => 36135, 15222 => 31096, 15223 => 20987, 15224 => 22334, 15225 => 22522,
+15226 => 26426, 15227 => 30072, 15228 => 31293, 15229 => 31215, 15230 => 31637,
+15393 => 32908, 15394 => 39269, 15395 => 36857, 15396 => 28608, 15397 => 35749,
+15398 => 40481, 15399 => 23020, 15400 => 32489, 15401 => 32521, 15402 => 21513,
+15403 => 26497, 15404 => 26840, 15405 => 36753, 15406 => 31821, 15407 => 38598,
+15408 => 21450, 15409 => 24613, 15410 => 30142, 15411 => 27762, 15412 => 21363,
+15413 => 23241, 15414 => 32423, 15415 => 25380, 15416 => 20960, 15417 => 33034,
+15418 => 24049, 15419 => 34015, 15420 => 25216, 15421 => 20864, 15422 => 23395,
+15423 => 20238, 15424 => 31085, 15425 => 21058, 15426 => 24760, 15427 => 27982,
+15428 => 23492, 15429 => 23490, 15430 => 35745, 15431 => 35760, 15432 => 26082,
+15433 => 24524, 15434 => 38469, 15435 => 22931, 15436 => 32487, 15437 => 32426,
+15438 => 22025, 15439 => 26551, 15440 => 22841, 15441 => 20339, 15442 => 23478,
+15443 => 21152, 15444 => 33626, 15445 => 39050, 15446 => 36158, 15447 => 30002,
+15448 => 38078, 15449 => 20551, 15450 => 31292, 15451 => 20215, 15452 => 26550,
+15453 => 39550, 15454 => 23233, 15455 => 27516, 15456 => 30417, 15457 => 22362,
+15458 => 23574, 15459 => 31546, 15460 => 38388, 15461 => 29006, 15462 => 20860,
+15463 => 32937, 15464 => 33392, 15465 => 22904, 15466 => 32516, 15467 => 33575,
+15468 => 26816, 15469 => 26604, 15470 => 30897, 15471 => 30839, 15472 => 25315,
+15473 => 25441, 15474 => 31616, 15475 => 20461, 15476 => 21098, 15477 => 20943,
+15478 => 33616, 15479 => 27099, 15480 => 37492, 15481 => 36341, 15482 => 36145,
+15483 => 35265, 15484 => 38190, 15485 => 31661, 15486 => 20214, 15649 => 20581,
+15650 => 33328, 15651 => 21073, 15652 => 39279, 15653 => 28176, 15654 => 28293,
+15655 => 28071, 15656 => 24314, 15657 => 20725, 15658 => 23004, 15659 => 23558,
+15660 => 27974, 15661 => 27743, 15662 => 30086, 15663 => 33931, 15664 => 26728,
+15665 => 22870, 15666 => 35762, 15667 => 21280, 15668 => 37233, 15669 => 38477,
+15670 => 34121, 15671 => 26898, 15672 => 30977, 15673 => 28966, 15674 => 33014,
+15675 => 20132, 15676 => 37066, 15677 => 27975, 15678 => 39556, 15679 => 23047,
+15680 => 22204, 15681 => 25605, 15682 => 38128, 15683 => 30699, 15684 => 20389,
+15685 => 33050, 15686 => 29409, 15687 => 35282, 15688 => 39290, 15689 => 32564,
+15690 => 32478, 15691 => 21119, 15692 => 25945, 15693 => 37237, 15694 => 36735,
+15695 => 36739, 15696 => 21483, 15697 => 31382, 15698 => 25581, 15699 => 25509,
+15700 => 30342, 15701 => 31224, 15702 => 34903, 15703 => 38454, 15704 => 25130,
+15705 => 21163, 15706 => 33410, 15707 => 26708, 15708 => 26480, 15709 => 25463,
+15710 => 30571, 15711 => 31469, 15712 => 27905, 15713 => 32467, 15714 => 35299,
+15715 => 22992, 15716 => 25106, 15717 => 34249, 15718 => 33445, 15719 => 30028,
+15720 => 20511, 15721 => 20171, 15722 => 30117, 15723 => 35819, 15724 => 23626,
+15725 => 24062, 15726 => 31563, 15727 => 26020, 15728 => 37329, 15729 => 20170,
+15730 => 27941, 15731 => 35167, 15732 => 32039, 15733 => 38182, 15734 => 20165,
+15735 => 35880, 15736 => 36827, 15737 => 38771, 15738 => 26187, 15739 => 31105,
+15740 => 36817, 15741 => 28908, 15742 => 28024, 15905 => 23613, 15906 => 21170,
+15907 => 33606, 15908 => 20834, 15909 => 33550, 15910 => 30555, 15911 => 26230,
+15912 => 40120, 15913 => 20140, 15914 => 24778, 15915 => 31934, 15916 => 31923,
+15917 => 32463, 15918 => 20117, 15919 => 35686, 15920 => 26223, 15921 => 39048,
+15922 => 38745, 15923 => 22659, 15924 => 25964, 15925 => 38236, 15926 => 24452,
+15927 => 30153, 15928 => 38742, 15929 => 31455, 15930 => 31454, 15931 => 20928,
+15932 => 28847, 15933 => 31384, 15934 => 25578, 15935 => 31350, 15936 => 32416,
+15937 => 29590, 15938 => 38893, 15939 => 20037, 15940 => 28792, 15941 => 20061,
+15942 => 37202, 15943 => 21417, 15944 => 25937, 15945 => 26087, 15946 => 33276,
+15947 => 33285, 15948 => 21646, 15949 => 23601, 15950 => 30106, 15951 => 38816,
+15952 => 25304, 15953 => 29401, 15954 => 30141, 15955 => 23621, 15956 => 39545,
+15957 => 33738, 15958 => 23616, 15959 => 21632, 15960 => 30697, 15961 => 20030,
+15962 => 27822, 15963 => 32858, 15964 => 25298, 15965 => 25454, 15966 => 24040,
+15967 => 20855, 15968 => 36317, 15969 => 36382, 15970 => 38191, 15971 => 20465,
+15972 => 21477, 15973 => 24807, 15974 => 28844, 15975 => 21095, 15976 => 25424,
+15977 => 40515, 15978 => 23071, 15979 => 20518, 15980 => 30519, 15981 => 21367,
+15982 => 32482, 15983 => 25733, 15984 => 25899, 15985 => 25225, 15986 => 25496,
+15987 => 20500, 15988 => 29237, 15989 => 35273, 15990 => 20915, 15991 => 35776,
+15992 => 32477, 15993 => 22343, 15994 => 33740, 15995 => 38055, 15996 => 20891,
+15997 => 21531, 15998 => 23803, 16161 => 20426, 16162 => 31459, 16163 => 27994,
+16164 => 37089, 16165 => 39567, 16166 => 21888, 16167 => 21654, 16168 => 21345,
+16169 => 21679, 16170 => 24320, 16171 => 25577, 16172 => 26999, 16173 => 20975,
+16174 => 24936, 16175 => 21002, 16176 => 22570, 16177 => 21208, 16178 => 22350,
+16179 => 30733, 16180 => 30475, 16181 => 24247, 16182 => 24951, 16183 => 31968,
+16184 => 25179, 16185 => 25239, 16186 => 20130, 16187 => 28821, 16188 => 32771,
+16189 => 25335, 16190 => 28900, 16191 => 38752, 16192 => 22391, 16193 => 33499,
+16194 => 26607, 16195 => 26869, 16196 => 30933, 16197 => 39063, 16198 => 31185,
+16199 => 22771, 16200 => 21683, 16201 => 21487, 16202 => 28212, 16203 => 20811,
+16204 => 21051, 16205 => 23458, 16206 => 35838, 16207 => 32943, 16208 => 21827,
+16209 => 22438, 16210 => 24691, 16211 => 22353, 16212 => 21549, 16213 => 31354,
+16214 => 24656, 16215 => 23380, 16216 => 25511, 16217 => 25248, 16218 => 21475,
+16219 => 25187, 16220 => 23495, 16221 => 26543, 16222 => 21741, 16223 => 31391,
+16224 => 33510, 16225 => 37239, 16226 => 24211, 16227 => 35044, 16228 => 22840,
+16229 => 22446, 16230 => 25358, 16231 => 36328, 16232 => 33007, 16233 => 22359,
+16234 => 31607, 16235 => 20393, 16236 => 24555, 16237 => 23485, 16238 => 27454,
+16239 => 21281, 16240 => 31568, 16241 => 29378, 16242 => 26694, 16243 => 30719,
+16244 => 30518, 16245 => 26103, 16246 => 20917, 16247 => 20111, 16248 => 30420,
+16249 => 23743, 16250 => 31397, 16251 => 33909, 16252 => 22862, 16253 => 39745,
+16254 => 20608, 16417 => 39304, 16418 => 24871, 16419 => 28291, 16420 => 22372,
+16421 => 26118, 16422 => 25414, 16423 => 22256, 16424 => 25324, 16425 => 25193,
+16426 => 24275, 16427 => 38420, 16428 => 22403, 16429 => 25289, 16430 => 21895,
+16431 => 34593, 16432 => 33098, 16433 => 36771, 16434 => 21862, 16435 => 33713,
+16436 => 26469, 16437 => 36182, 16438 => 34013, 16439 => 23146, 16440 => 26639,
+16441 => 25318, 16442 => 31726, 16443 => 38417, 16444 => 20848, 16445 => 28572,
+16446 => 35888, 16447 => 25597, 16448 => 35272, 16449 => 25042, 16450 => 32518,
+16451 => 28866, 16452 => 28389, 16453 => 29701, 16454 => 27028, 16455 => 29436,
+16456 => 24266, 16457 => 37070, 16458 => 26391, 16459 => 28010, 16460 => 25438,
+16461 => 21171, 16462 => 29282, 16463 => 32769, 16464 => 20332, 16465 => 23013,
+16466 => 37226, 16467 => 28889, 16468 => 28061, 16469 => 21202, 16470 => 20048,
+16471 => 38647, 16472 => 38253, 16473 => 34174, 16474 => 30922, 16475 => 32047,
+16476 => 20769, 16477 => 22418, 16478 => 25794, 16479 => 32907, 16480 => 31867,
+16481 => 27882, 16482 => 26865, 16483 => 26974, 16484 => 20919, 16485 => 21400,
+16486 => 26792, 16487 => 29313, 16488 => 40654, 16489 => 31729, 16490 => 29432,
+16491 => 31163, 16492 => 28435, 16493 => 29702, 16494 => 26446, 16495 => 37324,
+16496 => 40100, 16497 => 31036, 16498 => 33673, 16499 => 33620, 16500 => 21519,
+16501 => 26647, 16502 => 20029, 16503 => 21385, 16504 => 21169, 16505 => 30782,
+16506 => 21382, 16507 => 21033, 16508 => 20616, 16509 => 20363, 16510 => 20432,
+16673 => 30178, 16674 => 31435, 16675 => 31890, 16676 => 27813, 16677 => 38582,
+16678 => 21147, 16679 => 29827, 16680 => 21737, 16681 => 20457, 16682 => 32852,
+16683 => 33714, 16684 => 36830, 16685 => 38256, 16686 => 24265, 16687 => 24604,
+16688 => 28063, 16689 => 24088, 16690 => 25947, 16691 => 33080, 16692 => 38142,
+16693 => 24651, 16694 => 28860, 16695 => 32451, 16696 => 31918, 16697 => 20937,
+16698 => 26753, 16699 => 31921, 16700 => 33391, 16701 => 20004, 16702 => 36742,
+16703 => 37327, 16704 => 26238, 16705 => 20142, 16706 => 35845, 16707 => 25769,
+16708 => 32842, 16709 => 20698, 16710 => 30103, 16711 => 29134, 16712 => 23525,
+16713 => 36797, 16714 => 28518, 16715 => 20102, 16716 => 25730, 16717 => 38243,
+16718 => 24278, 16719 => 26009, 16720 => 21015, 16721 => 35010, 16722 => 28872,
+16723 => 21155, 16724 => 29454, 16725 => 29747, 16726 => 26519, 16727 => 30967,
+16728 => 38678, 16729 => 20020, 16730 => 37051, 16731 => 40158, 16732 => 28107,
+16733 => 20955, 16734 => 36161, 16735 => 21533, 16736 => 25294, 16737 => 29618,
+16738 => 33777, 16739 => 38646, 16740 => 40836, 16741 => 38083, 16742 => 20278,
+16743 => 32666, 16744 => 20940, 16745 => 28789, 16746 => 38517, 16747 => 23725,
+16748 => 39046, 16749 => 21478, 16750 => 20196, 16751 => 28316, 16752 => 29705,
+16753 => 27060, 16754 => 30827, 16755 => 39311, 16756 => 30041, 16757 => 21016,
+16758 => 30244, 16759 => 27969, 16760 => 26611, 16761 => 20845, 16762 => 40857,
+16763 => 32843, 16764 => 21657, 16765 => 31548, 16766 => 31423, 16929 => 38534,
+16930 => 22404, 16931 => 25314, 16932 => 38471, 16933 => 27004, 16934 => 23044,
+16935 => 25602, 16936 => 31699, 16937 => 28431, 16938 => 38475, 16939 => 33446,
+16940 => 21346, 16941 => 39045, 16942 => 24208, 16943 => 28809, 16944 => 25523,
+16945 => 21348, 16946 => 34383, 16947 => 40065, 16948 => 40595, 16949 => 30860,
+16950 => 38706, 16951 => 36335, 16952 => 36162, 16953 => 40575, 16954 => 28510,
+16955 => 31108, 16956 => 24405, 16957 => 38470, 16958 => 25134, 16959 => 39540,
+16960 => 21525, 16961 => 38109, 16962 => 20387, 16963 => 26053, 16964 => 23653,
+16965 => 23649, 16966 => 32533, 16967 => 34385, 16968 => 27695, 16969 => 24459,
+16970 => 29575, 16971 => 28388, 16972 => 32511, 16973 => 23782, 16974 => 25371,
+16975 => 23402, 16976 => 28390, 16977 => 21365, 16978 => 20081, 16979 => 25504,
+16980 => 30053, 16981 => 25249, 16982 => 36718, 16983 => 20262, 16984 => 20177,
+16985 => 27814, 16986 => 32438, 16987 => 35770, 16988 => 33821, 16989 => 34746,
+16990 => 32599, 16991 => 36923, 16992 => 38179, 16993 => 31657, 16994 => 39585,
+16995 => 35064, 16996 => 33853, 16997 => 27931, 16998 => 39558, 16999 => 32476,
+17000 => 22920, 17001 => 40635, 17002 => 29595, 17003 => 30721, 17004 => 34434,
+17005 => 39532, 17006 => 39554, 17007 => 22043, 17008 => 21527, 17009 => 22475,
+17010 => 20080, 17011 => 40614, 17012 => 21334, 17013 => 36808, 17014 => 33033,
+17015 => 30610, 17016 => 39314, 17017 => 34542, 17018 => 28385, 17019 => 34067,
+17020 => 26364, 17021 => 24930, 17022 => 28459, 17185 => 35881, 17186 => 33426,
+17187 => 33579, 17188 => 30450, 17189 => 27667, 17190 => 24537, 17191 => 33725,
+17192 => 29483, 17193 => 33541, 17194 => 38170, 17195 => 27611, 17196 => 30683,
+17197 => 38086, 17198 => 21359, 17199 => 33538, 17200 => 20882, 17201 => 24125,
+17202 => 35980, 17203 => 36152, 17204 => 20040, 17205 => 29611, 17206 => 26522,
+17207 => 26757, 17208 => 37238, 17209 => 38665, 17210 => 29028, 17211 => 27809,
+17212 => 30473, 17213 => 23186, 17214 => 38209, 17215 => 27599, 17216 => 32654,
+17217 => 26151, 17218 => 23504, 17219 => 22969, 17220 => 23194, 17221 => 38376,
+17222 => 38391, 17223 => 20204, 17224 => 33804, 17225 => 33945, 17226 => 27308,
+17227 => 30431, 17228 => 38192, 17229 => 29467, 17230 => 26790, 17231 => 23391,
+17232 => 30511, 17233 => 37274, 17234 => 38753, 17235 => 31964, 17236 => 36855,
+17237 => 35868, 17238 => 24357, 17239 => 31859, 17240 => 31192, 17241 => 35269,
+17242 => 27852, 17243 => 34588, 17244 => 23494, 17245 => 24130, 17246 => 26825,
+17247 => 30496, 17248 => 32501, 17249 => 20885, 17250 => 20813, 17251 => 21193,
+17252 => 23081, 17253 => 32517, 17254 => 38754, 17255 => 33495, 17256 => 25551,
+17257 => 30596, 17258 => 34256, 17259 => 31186, 17260 => 28218, 17261 => 24217,
+17262 => 22937, 17263 => 34065, 17264 => 28781, 17265 => 27665, 17266 => 25279,
+17267 => 30399, 17268 => 25935, 17269 => 24751, 17270 => 38397, 17271 => 26126,
+17272 => 34719, 17273 => 40483, 17274 => 38125, 17275 => 21517, 17276 => 21629,
+17277 => 35884, 17278 => 25720, 17441 => 25721, 17442 => 34321, 17443 => 27169,
+17444 => 33180, 17445 => 30952, 17446 => 25705, 17447 => 39764, 17448 => 25273,
+17449 => 26411, 17450 => 33707, 17451 => 22696, 17452 => 40664, 17453 => 27819,
+17454 => 28448, 17455 => 23518, 17456 => 38476, 17457 => 35851, 17458 => 29279,
+17459 => 26576, 17460 => 25287, 17461 => 29281, 17462 => 20137, 17463 => 22982,
+17464 => 27597, 17465 => 22675, 17466 => 26286, 17467 => 24149, 17468 => 21215,
+17469 => 24917, 17470 => 26408, 17471 => 30446, 17472 => 30566, 17473 => 29287,
+17474 => 31302, 17475 => 25343, 17476 => 21738, 17477 => 21584, 17478 => 38048,
+17479 => 37027, 17480 => 23068, 17481 => 32435, 17482 => 27670, 17483 => 20035,
+17484 => 22902, 17485 => 32784, 17486 => 22856, 17487 => 21335, 17488 => 30007,
+17489 => 38590, 17490 => 22218, 17491 => 25376, 17492 => 33041, 17493 => 24700,
+17494 => 38393, 17495 => 28118, 17496 => 21602, 17497 => 39297, 17498 => 20869,
+17499 => 23273, 17500 => 33021, 17501 => 22958, 17502 => 38675, 17503 => 20522,
+17504 => 27877, 17505 => 23612, 17506 => 25311, 17507 => 20320, 17508 => 21311,
+17509 => 33147, 17510 => 36870, 17511 => 28346, 17512 => 34091, 17513 => 25288,
+17514 => 24180, 17515 => 30910, 17516 => 25781, 17517 => 25467, 17518 => 24565,
+17519 => 23064, 17520 => 37247, 17521 => 40479, 17522 => 23615, 17523 => 25423,
+17524 => 32834, 17525 => 23421, 17526 => 21870, 17527 => 38218, 17528 => 38221,
+17529 => 28037, 17530 => 24744, 17531 => 26592, 17532 => 29406, 17533 => 20957,
+17534 => 23425, 17697 => 25319, 17698 => 27870, 17699 => 29275, 17700 => 25197,
+17701 => 38062, 17702 => 32445, 17703 => 33043, 17704 => 27987, 17705 => 20892,
+17706 => 24324, 17707 => 22900, 17708 => 21162, 17709 => 24594, 17710 => 22899,
+17711 => 26262, 17712 => 34384, 17713 => 30111, 17714 => 25386, 17715 => 25062,
+17716 => 31983, 17717 => 35834, 17718 => 21734, 17719 => 27431, 17720 => 40485,
+17721 => 27572, 17722 => 34261, 17723 => 21589, 17724 => 20598, 17725 => 27812,
+17726 => 21866, 17727 => 36276, 17728 => 29228, 17729 => 24085, 17730 => 24597,
+17731 => 29750, 17732 => 25293, 17733 => 25490, 17734 => 29260, 17735 => 24472,
+17736 => 28227, 17737 => 27966, 17738 => 25856, 17739 => 28504, 17740 => 30424,
+17741 => 30928, 17742 => 30460, 17743 => 30036, 17744 => 21028, 17745 => 21467,
+17746 => 20051, 17747 => 24222, 17748 => 26049, 17749 => 32810, 17750 => 32982,
+17751 => 25243, 17752 => 21638, 17753 => 21032, 17754 => 28846, 17755 => 34957,
+17756 => 36305, 17757 => 27873, 17758 => 21624, 17759 => 32986, 17760 => 22521,
+17761 => 35060, 17762 => 36180, 17763 => 38506, 17764 => 37197, 17765 => 20329,
+17766 => 27803, 17767 => 21943, 17768 => 30406, 17769 => 30768, 17770 => 25256,
+17771 => 28921, 17772 => 28558, 17773 => 24429, 17774 => 34028, 17775 => 26842,
+17776 => 30844, 17777 => 31735, 17778 => 33192, 17779 => 26379, 17780 => 40527,
+17781 => 25447, 17782 => 30896, 17783 => 22383, 17784 => 30738, 17785 => 38713,
+17786 => 25209, 17787 => 25259, 17788 => 21128, 17789 => 29749, 17790 => 27607,
+17953 => 21860, 17954 => 33086, 17955 => 30130, 17956 => 30382, 17957 => 21305,
+17958 => 30174, 17959 => 20731, 17960 => 23617, 17961 => 35692, 17962 => 31687,
+17963 => 20559, 17964 => 29255, 17965 => 39575, 17966 => 39128, 17967 => 28418,
+17968 => 29922, 17969 => 31080, 17970 => 25735, 17971 => 30629, 17972 => 25340,
+17973 => 39057, 17974 => 36139, 17975 => 21697, 17976 => 32856, 17977 => 20050,
+17978 => 22378, 17979 => 33529, 17980 => 33805, 17981 => 24179, 17982 => 20973,
+17983 => 29942, 17984 => 35780, 17985 => 23631, 17986 => 22369, 17987 => 27900,
+17988 => 39047, 17989 => 23110, 17990 => 30772, 17991 => 39748, 17992 => 36843,
+17993 => 31893, 17994 => 21078, 17995 => 25169, 17996 => 38138, 17997 => 20166,
+17998 => 33670, 17999 => 33889, 18000 => 33769, 18001 => 33970, 18002 => 22484,
+18003 => 26420, 18004 => 22275, 18005 => 26222, 18006 => 28006, 18007 => 35889,
+18008 => 26333, 18009 => 28689, 18010 => 26399, 18011 => 27450, 18012 => 26646,
+18013 => 25114, 18014 => 22971, 18015 => 19971, 18016 => 20932, 18017 => 28422,
+18018 => 26578, 18019 => 27791, 18020 => 20854, 18021 => 26827, 18022 => 22855,
+18023 => 27495, 18024 => 30054, 18025 => 23822, 18026 => 33040, 18027 => 40784,
+18028 => 26071, 18029 => 31048, 18030 => 31041, 18031 => 39569, 18032 => 36215,
+18033 => 23682, 18034 => 20062, 18035 => 20225, 18036 => 21551, 18037 => 22865,
+18038 => 30732, 18039 => 22120, 18040 => 27668, 18041 => 36804, 18042 => 24323,
+18043 => 27773, 18044 => 27875, 18045 => 35755, 18046 => 25488, 18209 => 24688,
+18210 => 27965, 18211 => 29301, 18212 => 25190, 18213 => 38030, 18214 => 38085,
+18215 => 21315, 18216 => 36801, 18217 => 31614, 18218 => 20191, 18219 => 35878,
+18220 => 20094, 18221 => 40660, 18222 => 38065, 18223 => 38067, 18224 => 21069,
+18225 => 28508, 18226 => 36963, 18227 => 27973, 18228 => 35892, 18229 => 22545,
+18230 => 23884, 18231 => 27424, 18232 => 27465, 18233 => 26538, 18234 => 21595,
+18235 => 33108, 18236 => 32652, 18237 => 22681, 18238 => 34103, 18239 => 24378,
+18240 => 25250, 18241 => 27207, 18242 => 38201, 18243 => 25970, 18244 => 24708,
+18245 => 26725, 18246 => 30631, 18247 => 20052, 18248 => 20392, 18249 => 24039,
+18250 => 38808, 18251 => 25772, 18252 => 32728, 18253 => 23789, 18254 => 20431,
+18255 => 31373, 18256 => 20999, 18257 => 33540, 18258 => 19988, 18259 => 24623,
+18260 => 31363, 18261 => 38054, 18262 => 20405, 18263 => 20146, 18264 => 31206,
+18265 => 29748, 18266 => 21220, 18267 => 33465, 18268 => 25810, 18269 => 31165,
+18270 => 23517, 18271 => 27777, 18272 => 38738, 18273 => 36731, 18274 => 27682,
+18275 => 20542, 18276 => 21375, 18277 => 28165, 18278 => 25806, 18279 => 26228,
+18280 => 27696, 18281 => 24773, 18282 => 39031, 18283 => 35831, 18284 => 24198,
+18285 => 29756, 18286 => 31351, 18287 => 31179, 18288 => 19992, 18289 => 37041,
+18290 => 29699, 18291 => 27714, 18292 => 22234, 18293 => 37195, 18294 => 27845,
+18295 => 36235, 18296 => 21306, 18297 => 34502, 18298 => 26354, 18299 => 36527,
+18300 => 23624, 18301 => 39537, 18302 => 28192, 18465 => 21462, 18466 => 23094,
+18467 => 40843, 18468 => 36259, 18469 => 21435, 18470 => 22280, 18471 => 39079,
+18472 => 26435, 18473 => 37275, 18474 => 27849, 18475 => 20840, 18476 => 30154,
+18477 => 25331, 18478 => 29356, 18479 => 21048, 18480 => 21149, 18481 => 32570,
+18482 => 28820, 18483 => 30264, 18484 => 21364, 18485 => 40522, 18486 => 27063,
+18487 => 30830, 18488 => 38592, 18489 => 35033, 18490 => 32676, 18491 => 28982,
+18492 => 29123, 18493 => 20873, 18494 => 26579, 18495 => 29924, 18496 => 22756,
+18497 => 25880, 18498 => 22199, 18499 => 35753, 18500 => 39286, 18501 => 25200,
+18502 => 32469, 18503 => 24825, 18504 => 28909, 18505 => 22764, 18506 => 20161,
+18507 => 20154, 18508 => 24525, 18509 => 38887, 18510 => 20219, 18511 => 35748,
+18512 => 20995, 18513 => 22922, 18514 => 32427, 18515 => 25172, 18516 => 20173,
+18517 => 26085, 18518 => 25102, 18519 => 33592, 18520 => 33993, 18521 => 33635,
+18522 => 34701, 18523 => 29076, 18524 => 28342, 18525 => 23481, 18526 => 32466,
+18527 => 20887, 18528 => 25545, 18529 => 26580, 18530 => 32905, 18531 => 33593,
+18532 => 34837, 18533 => 20754, 18534 => 23418, 18535 => 22914, 18536 => 36785,
+18537 => 20083, 18538 => 27741, 18539 => 20837, 18540 => 35109, 18541 => 36719,
+18542 => 38446, 18543 => 34122, 18544 => 29790, 18545 => 38160, 18546 => 38384,
+18547 => 28070, 18548 => 33509, 18549 => 24369, 18550 => 25746, 18551 => 27922,
+18552 => 33832, 18553 => 33134, 18554 => 40131, 18555 => 22622, 18556 => 36187,
+18557 => 19977, 18558 => 21441, 18721 => 20254, 18722 => 25955, 18723 => 26705,
+18724 => 21971, 18725 => 20007, 18726 => 25620, 18727 => 39578, 18728 => 25195,
+18729 => 23234, 18730 => 29791, 18731 => 33394, 18732 => 28073, 18733 => 26862,
+18734 => 20711, 18735 => 33678, 18736 => 30722, 18737 => 26432, 18738 => 21049,
+18739 => 27801, 18740 => 32433, 18741 => 20667, 18742 => 21861, 18743 => 29022,
+18744 => 31579, 18745 => 26194, 18746 => 29642, 18747 => 33515, 18748 => 26441,
+18749 => 23665, 18750 => 21024, 18751 => 29053, 18752 => 34923, 18753 => 38378,
+18754 => 38485, 18755 => 25797, 18756 => 36193, 18757 => 33203, 18758 => 21892,
+18759 => 27733, 18760 => 25159, 18761 => 32558, 18762 => 22674, 18763 => 20260,
+18764 => 21830, 18765 => 36175, 18766 => 26188, 18767 => 19978, 18768 => 23578,
+18769 => 35059, 18770 => 26786, 18771 => 25422, 18772 => 31245, 18773 => 28903,
+18774 => 33421, 18775 => 21242, 18776 => 38902, 18777 => 23569, 18778 => 21736,
+18779 => 37045, 18780 => 32461, 18781 => 22882, 18782 => 36170, 18783 => 34503,
+18784 => 33292, 18785 => 33293, 18786 => 36198, 18787 => 25668, 18788 => 23556,
+18789 => 24913, 18790 => 28041, 18791 => 31038, 18792 => 35774, 18793 => 30775,
+18794 => 30003, 18795 => 21627, 18796 => 20280, 18797 => 36523, 18798 => 28145,
+18799 => 23072, 18800 => 32453, 18801 => 31070, 18802 => 27784, 18803 => 23457,
+18804 => 23158, 18805 => 29978, 18806 => 32958, 18807 => 24910, 18808 => 28183,
+18809 => 22768, 18810 => 29983, 18811 => 29989, 18812 => 29298, 18813 => 21319,
+18814 => 32499, 18977 => 30465, 18978 => 30427, 18979 => 21097, 18980 => 32988,
+18981 => 22307, 18982 => 24072, 18983 => 22833, 18984 => 29422, 18985 => 26045,
+18986 => 28287, 18987 => 35799, 18988 => 23608, 18989 => 34417, 18990 => 21313,
+18991 => 30707, 18992 => 25342, 18993 => 26102, 18994 => 20160, 18995 => 39135,
+18996 => 34432, 18997 => 23454, 18998 => 35782, 18999 => 21490, 19000 => 30690,
+19001 => 20351, 19002 => 23630, 19003 => 39542, 19004 => 22987, 19005 => 24335,
+19006 => 31034, 19007 => 22763, 19008 => 19990, 19009 => 26623, 19010 => 20107,
+19011 => 25325, 19012 => 35475, 19013 => 36893, 19014 => 21183, 19015 => 26159,
+19016 => 21980, 19017 => 22124, 19018 => 36866, 19019 => 20181, 19020 => 20365,
+19021 => 37322, 19022 => 39280, 19023 => 27663, 19024 => 24066, 19025 => 24643,
+19026 => 23460, 19027 => 35270, 19028 => 35797, 19029 => 25910, 19030 => 25163,
+19031 => 39318, 19032 => 23432, 19033 => 23551, 19034 => 25480, 19035 => 21806,
+19036 => 21463, 19037 => 30246, 19038 => 20861, 19039 => 34092, 19040 => 26530,
+19041 => 26803, 19042 => 27530, 19043 => 25234, 19044 => 36755, 19045 => 21460,
+19046 => 33298, 19047 => 28113, 19048 => 30095, 19049 => 20070, 19050 => 36174,
+19051 => 23408, 19052 => 29087, 19053 => 34223, 19054 => 26257, 19055 => 26329,
+19056 => 32626, 19057 => 34560, 19058 => 40653, 19059 => 40736, 19060 => 23646,
+19061 => 26415, 19062 => 36848, 19063 => 26641, 19064 => 26463, 19065 => 25101,
+19066 => 31446, 19067 => 22661, 19068 => 24246, 19069 => 25968, 19070 => 28465,
+19233 => 24661, 19234 => 21047, 19235 => 32781, 19236 => 25684, 19237 => 34928,
+19238 => 29993, 19239 => 24069, 19240 => 26643, 19241 => 25332, 19242 => 38684,
+19243 => 21452, 19244 => 29245, 19245 => 35841, 19246 => 27700, 19247 => 30561,
+19248 => 31246, 19249 => 21550, 19250 => 30636, 19251 => 39034, 19252 => 33308,
+19253 => 35828, 19254 => 30805, 19255 => 26388, 19256 => 28865, 19257 => 26031,
+19258 => 25749, 19259 => 22070, 19260 => 24605, 19261 => 31169, 19262 => 21496,
+19263 => 19997, 19264 => 27515, 19265 => 32902, 19266 => 23546, 19267 => 21987,
+19268 => 22235, 19269 => 20282, 19270 => 20284, 19271 => 39282, 19272 => 24051,
+19273 => 26494, 19274 => 32824, 19275 => 24578, 19276 => 39042, 19277 => 36865,
+19278 => 23435, 19279 => 35772, 19280 => 35829, 19281 => 25628, 19282 => 33368,
+19283 => 25822, 19284 => 22013, 19285 => 33487, 19286 => 37221, 19287 => 20439,
+19288 => 32032, 19289 => 36895, 19290 => 31903, 19291 => 20723, 19292 => 22609,
+19293 => 28335, 19294 => 23487, 19295 => 35785, 19296 => 32899, 19297 => 37240,
+19298 => 33948, 19299 => 31639, 19300 => 34429, 19301 => 38539, 19302 => 38543,
+19303 => 32485, 19304 => 39635, 19305 => 30862, 19306 => 23681, 19307 => 31319,
+19308 => 36930, 19309 => 38567, 19310 => 31071, 19311 => 23385, 19312 => 25439,
+19313 => 31499, 19314 => 34001, 19315 => 26797, 19316 => 21766, 19317 => 32553,
+19318 => 29712, 19319 => 32034, 19320 => 38145, 19321 => 25152, 19322 => 22604,
+19323 => 20182, 19324 => 23427, 19325 => 22905, 19326 => 22612, 19489 => 29549,
+19490 => 25374, 19491 => 36427, 19492 => 36367, 19493 => 32974, 19494 => 33492,
+19495 => 25260, 19496 => 21488, 19497 => 27888, 19498 => 37214, 19499 => 22826,
+19500 => 24577, 19501 => 27760, 19502 => 22349, 19503 => 25674, 19504 => 36138,
+19505 => 30251, 19506 => 28393, 19507 => 22363, 19508 => 27264, 19509 => 30192,
+19510 => 28525, 19511 => 35885, 19512 => 35848, 19513 => 22374, 19514 => 27631,
+19515 => 34962, 19516 => 30899, 19517 => 25506, 19518 => 21497, 19519 => 28845,
+19520 => 27748, 19521 => 22616, 19522 => 25642, 19523 => 22530, 19524 => 26848,
+19525 => 33179, 19526 => 21776, 19527 => 31958, 19528 => 20504, 19529 => 36538,
+19530 => 28108, 19531 => 36255, 19532 => 28907, 19533 => 25487, 19534 => 28059,
+19535 => 28372, 19536 => 32486, 19537 => 33796, 19538 => 26691, 19539 => 36867,
+19540 => 28120, 19541 => 38518, 19542 => 35752, 19543 => 22871, 19544 => 29305,
+19545 => 34276, 19546 => 33150, 19547 => 30140, 19548 => 35466, 19549 => 26799,
+19550 => 21076, 19551 => 36386, 19552 => 38161, 19553 => 25552, 19554 => 39064,
+19555 => 36420, 19556 => 21884, 19557 => 20307, 19558 => 26367, 19559 => 22159,
+19560 => 24789, 19561 => 28053, 19562 => 21059, 19563 => 23625, 19564 => 22825,
+19565 => 28155, 19566 => 22635, 19567 => 30000, 19568 => 29980, 19569 => 24684,
+19570 => 33300, 19571 => 33094, 19572 => 25361, 19573 => 26465, 19574 => 36834,
+19575 => 30522, 19576 => 36339, 19577 => 36148, 19578 => 38081, 19579 => 24086,
+19580 => 21381, 19581 => 21548, 19582 => 28867, 19745 => 27712, 19746 => 24311,
+19747 => 20572, 19748 => 20141, 19749 => 24237, 19750 => 25402, 19751 => 33351,
+19752 => 36890, 19753 => 26704, 19754 => 37230, 19755 => 30643, 19756 => 21516,
+19757 => 38108, 19758 => 24420, 19759 => 31461, 19760 => 26742, 19761 => 25413,
+19762 => 31570, 19763 => 32479, 19764 => 30171, 19765 => 20599, 19766 => 25237,
+19767 => 22836, 19768 => 36879, 19769 => 20984, 19770 => 31171, 19771 => 31361,
+19772 => 22270, 19773 => 24466, 19774 => 36884, 19775 => 28034, 19776 => 23648,
+19777 => 22303, 19778 => 21520, 19779 => 20820, 19780 => 28237, 19781 => 22242,
+19782 => 25512, 19783 => 39059, 19784 => 33151, 19785 => 34581, 19786 => 35114,
+19787 => 36864, 19788 => 21534, 19789 => 23663, 19790 => 33216, 19791 => 25302,
+19792 => 25176, 19793 => 33073, 19794 => 40501, 19795 => 38464, 19796 => 39534,
+19797 => 39548, 19798 => 26925, 19799 => 22949, 19800 => 25299, 19801 => 21822,
+19802 => 25366, 19803 => 21703, 19804 => 34521, 19805 => 27964, 19806 => 23043,
+19807 => 29926, 19808 => 34972, 19809 => 27498, 19810 => 22806, 19811 => 35916,
+19812 => 24367, 19813 => 28286, 19814 => 29609, 19815 => 39037, 19816 => 20024,
+19817 => 28919, 19818 => 23436, 19819 => 30871, 19820 => 25405, 19821 => 26202,
+19822 => 30358, 19823 => 24779, 19824 => 23451, 19825 => 23113, 19826 => 19975,
+19827 => 33109, 19828 => 27754, 19829 => 29579, 19830 => 20129, 19831 => 26505,
+19832 => 32593, 19833 => 24448, 19834 => 26106, 19835 => 26395, 19836 => 24536,
+19837 => 22916, 19838 => 23041, 20001 => 24013, 20002 => 24494, 20003 => 21361,
+20004 => 38886, 20005 => 36829, 20006 => 26693, 20007 => 22260, 20008 => 21807,
+20009 => 24799, 20010 => 20026, 20011 => 28493, 20012 => 32500, 20013 => 33479,
+20014 => 33806, 20015 => 22996, 20016 => 20255, 20017 => 20266, 20018 => 23614,
+20019 => 32428, 20020 => 26410, 20021 => 34074, 20022 => 21619, 20023 => 30031,
+20024 => 32963, 20025 => 21890, 20026 => 39759, 20027 => 20301, 20028 => 28205,
+20029 => 35859, 20030 => 23561, 20031 => 24944, 20032 => 21355, 20033 => 30239,
+20034 => 28201, 20035 => 34442, 20036 => 25991, 20037 => 38395, 20038 => 32441,
+20039 => 21563, 20040 => 31283, 20041 => 32010, 20042 => 38382, 20043 => 21985,
+20044 => 32705, 20045 => 29934, 20046 => 25373, 20047 => 34583, 20048 => 28065,
+20049 => 31389, 20050 => 25105, 20051 => 26017, 20052 => 21351, 20053 => 25569,
+20054 => 27779, 20055 => 24043, 20056 => 21596, 20057 => 38056, 20058 => 20044,
+20059 => 27745, 20060 => 35820, 20061 => 23627, 20062 => 26080, 20063 => 33436,
+20064 => 26791, 20065 => 21566, 20066 => 21556, 20067 => 27595, 20068 => 27494,
+20069 => 20116, 20070 => 25410, 20071 => 21320, 20072 => 33310, 20073 => 20237,
+20074 => 20398, 20075 => 22366, 20076 => 25098, 20077 => 38654, 20078 => 26212,
+20079 => 29289, 20080 => 21247, 20081 => 21153, 20082 => 24735, 20083 => 35823,
+20084 => 26132, 20085 => 29081, 20086 => 26512, 20087 => 35199, 20088 => 30802,
+20089 => 30717, 20090 => 26224, 20091 => 22075, 20092 => 21560, 20093 => 38177,
+20094 => 29306, 20257 => 31232, 20258 => 24687, 20259 => 24076, 20260 => 24713,
+20261 => 33181, 20262 => 22805, 20263 => 24796, 20264 => 29060, 20265 => 28911,
+20266 => 28330, 20267 => 27728, 20268 => 29312, 20269 => 27268, 20270 => 34989,
+20271 => 24109, 20272 => 20064, 20273 => 23219, 20274 => 21916, 20275 => 38115,
+20276 => 27927, 20277 => 31995, 20278 => 38553, 20279 => 25103, 20280 => 32454,
+20281 => 30606, 20282 => 34430, 20283 => 21283, 20284 => 38686, 20285 => 36758,
+20286 => 26247, 20287 => 23777, 20288 => 20384, 20289 => 29421, 20290 => 19979,
+20291 => 21414, 20292 => 22799, 20293 => 21523, 20294 => 25472, 20295 => 38184,
+20296 => 20808, 20297 => 20185, 20298 => 40092, 20299 => 32420, 20300 => 21688,
+20301 => 36132, 20302 => 34900, 20303 => 33335, 20304 => 38386, 20305 => 28046,
+20306 => 24358, 20307 => 23244, 20308 => 26174, 20309 => 38505, 20310 => 29616,
+20311 => 29486, 20312 => 21439, 20313 => 33146, 20314 => 39301, 20315 => 32673,
+20316 => 23466, 20317 => 38519, 20318 => 38480, 20319 => 32447, 20320 => 30456,
+20321 => 21410, 20322 => 38262, 20323 => 39321, 20324 => 31665, 20325 => 35140,
+20326 => 28248, 20327 => 20065, 20328 => 32724, 20329 => 31077, 20330 => 35814,
+20331 => 24819, 20332 => 21709, 20333 => 20139, 20334 => 39033, 20335 => 24055,
+20336 => 27233, 20337 => 20687, 20338 => 21521, 20339 => 35937, 20340 => 33831,
+20341 => 30813, 20342 => 38660, 20343 => 21066, 20344 => 21742, 20345 => 22179,
+20346 => 38144, 20347 => 28040, 20348 => 23477, 20349 => 28102, 20350 => 26195,
+20513 => 23567, 20514 => 23389, 20515 => 26657, 20516 => 32918, 20517 => 21880,
+20518 => 31505, 20519 => 25928, 20520 => 26964, 20521 => 20123, 20522 => 27463,
+20523 => 34638, 20524 => 38795, 20525 => 21327, 20526 => 25375, 20527 => 25658,
+20528 => 37034, 20529 => 26012, 20530 => 32961, 20531 => 35856, 20532 => 20889,
+20533 => 26800, 20534 => 21368, 20535 => 34809, 20536 => 25032, 20537 => 27844,
+20538 => 27899, 20539 => 35874, 20540 => 23633, 20541 => 34218, 20542 => 33455,
+20543 => 38156, 20544 => 27427, 20545 => 36763, 20546 => 26032, 20547 => 24571,
+20548 => 24515, 20549 => 20449, 20550 => 34885, 20551 => 26143, 20552 => 33125,
+20553 => 29481, 20554 => 24826, 20555 => 20852, 20556 => 21009, 20557 => 22411,
+20558 => 24418, 20559 => 37026, 20560 => 34892, 20561 => 37266, 20562 => 24184,
+20563 => 26447, 20564 => 24615, 20565 => 22995, 20566 => 20804, 20567 => 20982,
+20568 => 33016, 20569 => 21256, 20570 => 27769, 20571 => 38596, 20572 => 29066,
+20573 => 20241, 20574 => 20462, 20575 => 32670, 20576 => 26429, 20577 => 21957,
+20578 => 38152, 20579 => 31168, 20580 => 34966, 20581 => 32483, 20582 => 22687,
+20583 => 25100, 20584 => 38656, 20585 => 34394, 20586 => 22040, 20587 => 39035,
+20588 => 24464, 20589 => 35768, 20590 => 33988, 20591 => 37207, 20592 => 21465,
+20593 => 26093, 20594 => 24207, 20595 => 30044, 20596 => 24676, 20597 => 32110,
+20598 => 23167, 20599 => 32490, 20600 => 32493, 20601 => 36713, 20602 => 21927,
+20603 => 23459, 20604 => 24748, 20605 => 26059, 20606 => 29572, 20769 => 36873,
+20770 => 30307, 20771 => 30505, 20772 => 32474, 20773 => 38772, 20774 => 34203,
+20775 => 23398, 20776 => 31348, 20777 => 38634, 20778 => 34880, 20779 => 21195,
+20780 => 29071, 20781 => 24490, 20782 => 26092, 20783 => 35810, 20784 => 23547,
+20785 => 39535, 20786 => 24033, 20787 => 27529, 20788 => 27739, 20789 => 35757,
+20790 => 35759, 20791 => 36874, 20792 => 36805, 20793 => 21387, 20794 => 25276,
+20795 => 40486, 20796 => 40493, 20797 => 21568, 20798 => 20011, 20799 => 33469,
+20800 => 29273, 20801 => 34460, 20802 => 23830, 20803 => 34905, 20804 => 28079,
+20805 => 38597, 20806 => 21713, 20807 => 20122, 20808 => 35766, 20809 => 28937,
+20810 => 21693, 20811 => 38409, 20812 => 28895, 20813 => 28153, 20814 => 30416,
+20815 => 20005, 20816 => 30740, 20817 => 34578, 20818 => 23721, 20819 => 24310,
+20820 => 35328, 20821 => 39068, 20822 => 38414, 20823 => 28814, 20824 => 27839,
+20825 => 22852, 20826 => 25513, 20827 => 30524, 20828 => 34893, 20829 => 28436,
+20830 => 33395, 20831 => 22576, 20832 => 29141, 20833 => 21388, 20834 => 30746,
+20835 => 38593, 20836 => 21761, 20837 => 24422, 20838 => 28976, 20839 => 23476,
+20840 => 35866, 20841 => 39564, 20842 => 27523, 20843 => 22830, 20844 => 40495,
+20845 => 31207, 20846 => 26472, 20847 => 25196, 20848 => 20335, 20849 => 30113,
+20850 => 32650, 20851 => 27915, 20852 => 38451, 20853 => 27687, 20854 => 20208,
+20855 => 30162, 20856 => 20859, 20857 => 26679, 20858 => 28478, 20859 => 36992,
+20860 => 33136, 20861 => 22934, 20862 => 29814, 21025 => 25671, 21026 => 23591,
+21027 => 36965, 21028 => 31377, 21029 => 35875, 21030 => 23002, 21031 => 21676,
+21032 => 33280, 21033 => 33647, 21034 => 35201, 21035 => 32768, 21036 => 26928,
+21037 => 22094, 21038 => 32822, 21039 => 29239, 21040 => 37326, 21041 => 20918,
+21042 => 20063, 21043 => 39029, 21044 => 25494, 21045 => 19994, 21046 => 21494,
+21047 => 26355, 21048 => 33099, 21049 => 22812, 21050 => 28082, 21051 => 19968,
+21052 => 22777, 21053 => 21307, 21054 => 25558, 21055 => 38129, 21056 => 20381,
+21057 => 20234, 21058 => 34915, 21059 => 39056, 21060 => 22839, 21061 => 36951,
+21062 => 31227, 21063 => 20202, 21064 => 33008, 21065 => 30097, 21066 => 27778,
+21067 => 23452, 21068 => 23016, 21069 => 24413, 21070 => 26885, 21071 => 34433,
+21072 => 20506, 21073 => 24050, 21074 => 20057, 21075 => 30691, 21076 => 20197,
+21077 => 33402, 21078 => 25233, 21079 => 26131, 21080 => 37009, 21081 => 23673,
+21082 => 20159, 21083 => 24441, 21084 => 33222, 21085 => 36920, 21086 => 32900,
+21087 => 30123, 21088 => 20134, 21089 => 35028, 21090 => 24847, 21091 => 27589,
+21092 => 24518, 21093 => 20041, 21094 => 30410, 21095 => 28322, 21096 => 35811,
+21097 => 35758, 21098 => 35850, 21099 => 35793, 21100 => 24322, 21101 => 32764,
+21102 => 32716, 21103 => 32462, 21104 => 33589, 21105 => 33643, 21106 => 22240,
+21107 => 27575, 21108 => 38899, 21109 => 38452, 21110 => 23035, 21111 => 21535,
+21112 => 38134, 21113 => 28139, 21114 => 23493, 21115 => 39278, 21116 => 23609,
+21117 => 24341, 21118 => 38544, 21281 => 21360, 21282 => 33521, 21283 => 27185,
+21284 => 23156, 21285 => 40560, 21286 => 24212, 21287 => 32552, 21288 => 33721,
+21289 => 33828, 21290 => 33829, 21291 => 33639, 21292 => 34631, 21293 => 36814,
+21294 => 36194, 21295 => 30408, 21296 => 24433, 21297 => 39062, 21298 => 30828,
+21299 => 26144, 21300 => 21727, 21301 => 25317, 21302 => 20323, 21303 => 33219,
+21304 => 30152, 21305 => 24248, 21306 => 38605, 21307 => 36362, 21308 => 34553,
+21309 => 21647, 21310 => 27891, 21311 => 28044, 21312 => 27704, 21313 => 24703,
+21314 => 21191, 21315 => 29992, 21316 => 24189, 21317 => 20248, 21318 => 24736,
+21319 => 24551, 21320 => 23588, 21321 => 30001, 21322 => 37038, 21323 => 38080,
+21324 => 29369, 21325 => 27833, 21326 => 28216, 21327 => 37193, 21328 => 26377,
+21329 => 21451, 21330 => 21491, 21331 => 20305, 21332 => 37321, 21333 => 35825,
+21334 => 21448, 21335 => 24188, 21336 => 36802, 21337 => 28132, 21338 => 20110,
+21339 => 30402, 21340 => 27014, 21341 => 34398, 21342 => 24858, 21343 => 33286,
+21344 => 20313, 21345 => 20446, 21346 => 36926, 21347 => 40060, 21348 => 24841,
+21349 => 28189, 21350 => 28180, 21351 => 38533, 21352 => 20104, 21353 => 23089,
+21354 => 38632, 21355 => 19982, 21356 => 23679, 21357 => 31161, 21358 => 23431,
+21359 => 35821, 21360 => 32701, 21361 => 29577, 21362 => 22495, 21363 => 33419,
+21364 => 37057, 21365 => 21505, 21366 => 36935, 21367 => 21947, 21368 => 23786,
+21369 => 24481, 21370 => 24840, 21371 => 27442, 21372 => 29425, 21373 => 32946,
+21374 => 35465, 21537 => 28020, 21538 => 23507, 21539 => 35029, 21540 => 39044,
+21541 => 35947, 21542 => 39533, 21543 => 40499, 21544 => 28170, 21545 => 20900,
+21546 => 20803, 21547 => 22435, 21548 => 34945, 21549 => 21407, 21550 => 25588,
+21551 => 36757, 21552 => 22253, 21553 => 21592, 21554 => 22278, 21555 => 29503,
+21556 => 28304, 21557 => 32536, 21558 => 36828, 21559 => 33489, 21560 => 24895,
+21561 => 24616, 21562 => 38498, 21563 => 26352, 21564 => 32422, 21565 => 36234,
+21566 => 36291, 21567 => 38053, 21568 => 23731, 21569 => 31908, 21570 => 26376,
+21571 => 24742, 21572 => 38405, 21573 => 32792, 21574 => 20113, 21575 => 37095,
+21576 => 21248, 21577 => 38504, 21578 => 20801, 21579 => 36816, 21580 => 34164,
+21581 => 37213, 21582 => 26197, 21583 => 38901, 21584 => 23381, 21585 => 21277,
+21586 => 30776, 21587 => 26434, 21588 => 26685, 21589 => 21705, 21590 => 28798,
+21591 => 23472, 21592 => 36733, 21593 => 20877, 21594 => 22312, 21595 => 21681,
+21596 => 25874, 21597 => 26242, 21598 => 36190, 21599 => 36163, 21600 => 33039,
+21601 => 33900, 21602 => 36973, 21603 => 31967, 21604 => 20991, 21605 => 34299,
+21606 => 26531, 21607 => 26089, 21608 => 28577, 21609 => 34468, 21610 => 36481,
+21611 => 22122, 21612 => 36896, 21613 => 30338, 21614 => 28790, 21615 => 29157,
+21616 => 36131, 21617 => 25321, 21618 => 21017, 21619 => 27901, 21620 => 36156,
+21621 => 24590, 21622 => 22686, 21623 => 24974, 21624 => 26366, 21625 => 36192,
+21626 => 25166, 21627 => 21939, 21628 => 28195, 21629 => 26413, 21630 => 36711,
+21793 => 38113, 21794 => 38392, 21795 => 30504, 21796 => 26629, 21797 => 27048,
+21798 => 21643, 21799 => 20045, 21800 => 28856, 21801 => 35784, 21802 => 25688,
+21803 => 25995, 21804 => 23429, 21805 => 31364, 21806 => 20538, 21807 => 23528,
+21808 => 30651, 21809 => 27617, 21810 => 35449, 21811 => 31896, 21812 => 27838,
+21813 => 30415, 21814 => 26025, 21815 => 36759, 21816 => 23853, 21817 => 23637,
+21818 => 34360, 21819 => 26632, 21820 => 21344, 21821 => 25112, 21822 => 31449,
+21823 => 28251, 21824 => 32509, 21825 => 27167, 21826 => 31456, 21827 => 24432,
+21828 => 28467, 21829 => 24352, 21830 => 25484, 21831 => 28072, 21832 => 26454,
+21833 => 19976, 21834 => 24080, 21835 => 36134, 21836 => 20183, 21837 => 32960,
+21838 => 30260, 21839 => 38556, 21840 => 25307, 21841 => 26157, 21842 => 25214,
+21843 => 27836, 21844 => 36213, 21845 => 29031, 21846 => 32617, 21847 => 20806,
+21848 => 32903, 21849 => 21484, 21850 => 36974, 21851 => 25240, 21852 => 21746,
+21853 => 34544, 21854 => 36761, 21855 => 32773, 21856 => 38167, 21857 => 34071,
+21858 => 36825, 21859 => 27993, 21860 => 29645, 21861 => 26015, 21862 => 30495,
+21863 => 29956, 21864 => 30759, 21865 => 33275, 21866 => 36126, 21867 => 38024,
+21868 => 20390, 21869 => 26517, 21870 => 30137, 21871 => 35786, 21872 => 38663,
+21873 => 25391, 21874 => 38215, 21875 => 38453, 21876 => 33976, 21877 => 25379,
+21878 => 30529, 21879 => 24449, 21880 => 29424, 21881 => 20105, 21882 => 24596,
+21883 => 25972, 21884 => 25327, 21885 => 27491, 21886 => 25919, 22049 => 24103,
+22050 => 30151, 22051 => 37073, 22052 => 35777, 22053 => 33437, 22054 => 26525,
+22055 => 25903, 22056 => 21553, 22057 => 34584, 22058 => 30693, 22059 => 32930,
+22060 => 33026, 22061 => 27713, 22062 => 20043, 22063 => 32455, 22064 => 32844,
+22065 => 30452, 22066 => 26893, 22067 => 27542, 22068 => 25191, 22069 => 20540,
+22070 => 20356, 22071 => 22336, 22072 => 25351, 22073 => 27490, 22074 => 36286,
+22075 => 21482, 22076 => 26088, 22077 => 32440, 22078 => 24535, 22079 => 25370,
+22080 => 25527, 22081 => 33267, 22082 => 33268, 22083 => 32622, 22084 => 24092,
+22085 => 23769, 22086 => 21046, 22087 => 26234, 22088 => 31209, 22089 => 31258,
+22090 => 36136, 22091 => 28825, 22092 => 30164, 22093 => 28382, 22094 => 27835,
+22095 => 31378, 22096 => 20013, 22097 => 30405, 22098 => 24544, 22099 => 38047,
+22100 => 34935, 22101 => 32456, 22102 => 31181, 22103 => 32959, 22104 => 37325,
+22105 => 20210, 22106 => 20247, 22107 => 33311, 22108 => 21608, 22109 => 24030,
+22110 => 27954, 22111 => 35788, 22112 => 31909, 22113 => 36724, 22114 => 32920,
+22115 => 24090, 22116 => 21650, 22117 => 30385, 22118 => 23449, 22119 => 26172,
+22120 => 39588, 22121 => 29664, 22122 => 26666, 22123 => 34523, 22124 => 26417,
+22125 => 29482, 22126 => 35832, 22127 => 35803, 22128 => 36880, 22129 => 31481,
+22130 => 28891, 22131 => 29038, 22132 => 25284, 22133 => 30633, 22134 => 22065,
+22135 => 20027, 22136 => 33879, 22137 => 26609, 22138 => 21161, 22139 => 34496,
+22140 => 36142, 22141 => 38136, 22142 => 31569, 22305 => 20303, 22306 => 27880,
+22307 => 31069, 22308 => 39547, 22309 => 25235, 22310 => 29226, 22311 => 25341,
+22312 => 19987, 22313 => 30742, 22314 => 36716, 22315 => 25776, 22316 => 36186,
+22317 => 31686, 22318 => 26729, 22319 => 24196, 22320 => 35013, 22321 => 22918,
+22322 => 25758, 22323 => 22766, 22324 => 29366, 22325 => 26894, 22326 => 38181,
+22327 => 36861, 22328 => 36184, 22329 => 22368, 22330 => 32512, 22331 => 35846,
+22332 => 20934, 22333 => 25417, 22334 => 25305, 22335 => 21331, 22336 => 26700,
+22337 => 29730, 22338 => 33537, 22339 => 37196, 22340 => 21828, 22341 => 30528,
+22342 => 28796, 22343 => 27978, 22344 => 20857, 22345 => 21672, 22346 => 36164,
+22347 => 23039, 22348 => 28363, 22349 => 28100, 22350 => 23388, 22351 => 32043,
+22352 => 20180, 22353 => 31869, 22354 => 28371, 22355 => 23376, 22356 => 33258,
+22357 => 28173, 22358 => 23383, 22359 => 39683, 22360 => 26837, 22361 => 36394,
+22362 => 23447, 22363 => 32508, 22364 => 24635, 22365 => 32437, 22366 => 37049,
+22367 => 36208, 22368 => 22863, 22369 => 25549, 22370 => 31199, 22371 => 36275,
+22372 => 21330, 22373 => 26063, 22374 => 31062, 22375 => 35781, 22376 => 38459,
+22377 => 32452, 22378 => 38075, 22379 => 32386, 22380 => 22068, 22381 => 37257,
+22382 => 26368, 22383 => 32618, 22384 => 23562, 22385 => 36981, 22386 => 26152,
+22387 => 24038, 22388 => 20304, 22389 => 26590, 22390 => 20570, 22391 => 20316,
+22392 => 22352, 22393 => 24231, 22561 => 20109, 22562 => 19980, 22563 => 20800,
+22564 => 19984, 22565 => 24319, 22566 => 21317, 22567 => 19989, 22568 => 20120,
+22569 => 19998, 22570 => 39730, 22571 => 23404, 22572 => 22121, 22573 => 20008,
+22574 => 31162, 22575 => 20031, 22576 => 21269, 22577 => 20039, 22578 => 22829,
+22579 => 29243, 22580 => 21358, 22581 => 27664, 22582 => 22239, 22583 => 32996,
+22584 => 39319, 22585 => 27603, 22586 => 30590, 22587 => 40727, 22588 => 20022,
+22589 => 20127, 22590 => 40720, 22591 => 20060, 22592 => 20073, 22593 => 20115,
+22594 => 33416, 22595 => 23387, 22596 => 21868, 22597 => 22031, 22598 => 20164,
+22599 => 21389, 22600 => 21405, 22601 => 21411, 22602 => 21413, 22603 => 21422,
+22604 => 38757, 22605 => 36189, 22606 => 21274, 22607 => 21493, 22608 => 21286,
+22609 => 21294, 22610 => 21310, 22611 => 36188, 22612 => 21350, 22613 => 21347,
+22614 => 20994, 22615 => 21000, 22616 => 21006, 22617 => 21037, 22618 => 21043,
+22619 => 21055, 22620 => 21056, 22621 => 21068, 22622 => 21086, 22623 => 21089,
+22624 => 21084, 22625 => 33967, 22626 => 21117, 22627 => 21122, 22628 => 21121,
+22629 => 21136, 22630 => 21139, 22631 => 20866, 22632 => 32596, 22633 => 20155,
+22634 => 20163, 22635 => 20169, 22636 => 20162, 22637 => 20200, 22638 => 20193,
+22639 => 20203, 22640 => 20190, 22641 => 20251, 22642 => 20211, 22643 => 20258,
+22644 => 20324, 22645 => 20213, 22646 => 20261, 22647 => 20263, 22648 => 20233,
+22649 => 20267, 22650 => 20318, 22651 => 20327, 22652 => 25912, 22653 => 20314,
+22654 => 20317, 22817 => 20319, 22818 => 20311, 22819 => 20274, 22820 => 20285,
+22821 => 20342, 22822 => 20340, 22823 => 20369, 22824 => 20361, 22825 => 20355,
+22826 => 20367, 22827 => 20350, 22828 => 20347, 22829 => 20394, 22830 => 20348,
+22831 => 20396, 22832 => 20372, 22833 => 20454, 22834 => 20456, 22835 => 20458,
+22836 => 20421, 22837 => 20442, 22838 => 20451, 22839 => 20444, 22840 => 20433,
+22841 => 20447, 22842 => 20472, 22843 => 20521, 22844 => 20556, 22845 => 20467,
+22846 => 20524, 22847 => 20495, 22848 => 20526, 22849 => 20525, 22850 => 20478,
+22851 => 20508, 22852 => 20492, 22853 => 20517, 22854 => 20520, 22855 => 20606,
+22856 => 20547, 22857 => 20565, 22858 => 20552, 22859 => 20558, 22860 => 20588,
+22861 => 20603, 22862 => 20645, 22863 => 20647, 22864 => 20649, 22865 => 20666,
+22866 => 20694, 22867 => 20742, 22868 => 20717, 22869 => 20716, 22870 => 20710,
+22871 => 20718, 22872 => 20743, 22873 => 20747, 22874 => 20189, 22875 => 27709,
+22876 => 20312, 22877 => 20325, 22878 => 20430, 22879 => 40864, 22880 => 27718,
+22881 => 31860, 22882 => 20846, 22883 => 24061, 22884 => 40649, 22885 => 39320,
+22886 => 20865, 22887 => 22804, 22888 => 21241, 22889 => 21261, 22890 => 35335,
+22891 => 21264, 22892 => 20971, 22893 => 22809, 22894 => 20821, 22895 => 20128,
+22896 => 20822, 22897 => 20147, 22898 => 34926, 22899 => 34980, 22900 => 20149,
+22901 => 33044, 22902 => 35026, 22903 => 31104, 22904 => 23348, 22905 => 34819,
+22906 => 32696, 22907 => 20907, 22908 => 20913, 22909 => 20925, 22910 => 20924,
+23073 => 20935, 23074 => 20886, 23075 => 20898, 23076 => 20901, 23077 => 35744,
+23078 => 35750, 23079 => 35751, 23080 => 35754, 23081 => 35764, 23082 => 35765,
+23083 => 35767, 23084 => 35778, 23085 => 35779, 23086 => 35787, 23087 => 35791,
+23088 => 35790, 23089 => 35794, 23090 => 35795, 23091 => 35796, 23092 => 35798,
+23093 => 35800, 23094 => 35801, 23095 => 35804, 23096 => 35807, 23097 => 35808,
+23098 => 35812, 23099 => 35816, 23100 => 35817, 23101 => 35822, 23102 => 35824,
+23103 => 35827, 23104 => 35830, 23105 => 35833, 23106 => 35836, 23107 => 35839,
+23108 => 35840, 23109 => 35842, 23110 => 35844, 23111 => 35847, 23112 => 35852,
+23113 => 35855, 23114 => 35857, 23115 => 35858, 23116 => 35860, 23117 => 35861,
+23118 => 35862, 23119 => 35865, 23120 => 35867, 23121 => 35864, 23122 => 35869,
+23123 => 35871, 23124 => 35872, 23125 => 35873, 23126 => 35877, 23127 => 35879,
+23128 => 35882, 23129 => 35883, 23130 => 35886, 23131 => 35887, 23132 => 35890,
+23133 => 35891, 23134 => 35893, 23135 => 35894, 23136 => 21353, 23137 => 21370,
+23138 => 38429, 23139 => 38434, 23140 => 38433, 23141 => 38449, 23142 => 38442,
+23143 => 38461, 23144 => 38460, 23145 => 38466, 23146 => 38473, 23147 => 38484,
+23148 => 38495, 23149 => 38503, 23150 => 38508, 23151 => 38514, 23152 => 38516,
+23153 => 38536, 23154 => 38541, 23155 => 38551, 23156 => 38576, 23157 => 37015,
+23158 => 37019, 23159 => 37021, 23160 => 37017, 23161 => 37036, 23162 => 37025,
+23163 => 37044, 23164 => 37043, 23165 => 37046, 23166 => 37050, 23329 => 37048,
+23330 => 37040, 23331 => 37071, 23332 => 37061, 23333 => 37054, 23334 => 37072,
+23335 => 37060, 23336 => 37063, 23337 => 37075, 23338 => 37094, 23339 => 37090,
+23340 => 37084, 23341 => 37079, 23342 => 37083, 23343 => 37099, 23344 => 37103,
+23345 => 37118, 23346 => 37124, 23347 => 37154, 23348 => 37150, 23349 => 37155,
+23350 => 37169, 23351 => 37167, 23352 => 37177, 23353 => 37187, 23354 => 37190,
+23355 => 21005, 23356 => 22850, 23357 => 21154, 23358 => 21164, 23359 => 21165,
+23360 => 21182, 23361 => 21759, 23362 => 21200, 23363 => 21206, 23364 => 21232,
+23365 => 21471, 23366 => 29166, 23367 => 30669, 23368 => 24308, 23369 => 20981,
+23370 => 20988, 23371 => 39727, 23372 => 21430, 23373 => 24321, 23374 => 30042,
+23375 => 24047, 23376 => 22348, 23377 => 22441, 23378 => 22433, 23379 => 22654,
+23380 => 22716, 23381 => 22725, 23382 => 22737, 23383 => 22313, 23384 => 22316,
+23385 => 22314, 23386 => 22323, 23387 => 22329, 23388 => 22318, 23389 => 22319,
+23390 => 22364, 23391 => 22331, 23392 => 22338, 23393 => 22377, 23394 => 22405,
+23395 => 22379, 23396 => 22406, 23397 => 22396, 23398 => 22395, 23399 => 22376,
+23400 => 22381, 23401 => 22390, 23402 => 22387, 23403 => 22445, 23404 => 22436,
+23405 => 22412, 23406 => 22450, 23407 => 22479, 23408 => 22439, 23409 => 22452,
+23410 => 22419, 23411 => 22432, 23412 => 22485, 23413 => 22488, 23414 => 22490,
+23415 => 22489, 23416 => 22482, 23417 => 22456, 23418 => 22516, 23419 => 22511,
+23420 => 22520, 23421 => 22500, 23422 => 22493, 23585 => 22539, 23586 => 22541,
+23587 => 22525, 23588 => 22509, 23589 => 22528, 23590 => 22558, 23591 => 22553,
+23592 => 22596, 23593 => 22560, 23594 => 22629, 23595 => 22636, 23596 => 22657,
+23597 => 22665, 23598 => 22682, 23599 => 22656, 23600 => 39336, 23601 => 40729,
+23602 => 25087, 23603 => 33401, 23604 => 33405, 23605 => 33407, 23606 => 33423,
+23607 => 33418, 23608 => 33448, 23609 => 33412, 23610 => 33422, 23611 => 33425,
+23612 => 33431, 23613 => 33433, 23614 => 33451, 23615 => 33464, 23616 => 33470,
+23617 => 33456, 23618 => 33480, 23619 => 33482, 23620 => 33507, 23621 => 33432,
+23622 => 33463, 23623 => 33454, 23624 => 33483, 23625 => 33484, 23626 => 33473,
+23627 => 33449, 23628 => 33460, 23629 => 33441, 23630 => 33450, 23631 => 33439,
+23632 => 33476, 23633 => 33486, 23634 => 33444, 23635 => 33505, 23636 => 33545,
+23637 => 33527, 23638 => 33508, 23639 => 33551, 23640 => 33543, 23641 => 33500,
+23642 => 33524, 23643 => 33490, 23644 => 33496, 23645 => 33548, 23646 => 33531,
+23647 => 33491, 23648 => 33553, 23649 => 33562, 23650 => 33542, 23651 => 33556,
+23652 => 33557, 23653 => 33504, 23654 => 33493, 23655 => 33564, 23656 => 33617,
+23657 => 33627, 23658 => 33628, 23659 => 33544, 23660 => 33682, 23661 => 33596,
+23662 => 33588, 23663 => 33585, 23664 => 33691, 23665 => 33630, 23666 => 33583,
+23667 => 33615, 23668 => 33607, 23669 => 33603, 23670 => 33631, 23671 => 33600,
+23672 => 33559, 23673 => 33632, 23674 => 33581, 23675 => 33594, 23676 => 33587,
+23677 => 33638, 23678 => 33637, 23841 => 33640, 23842 => 33563, 23843 => 33641,
+23844 => 33644, 23845 => 33642, 23846 => 33645, 23847 => 33646, 23848 => 33712,
+23849 => 33656, 23850 => 33715, 23851 => 33716, 23852 => 33696, 23853 => 33706,
+23854 => 33683, 23855 => 33692, 23856 => 33669, 23857 => 33660, 23858 => 33718,
+23859 => 33705, 23860 => 33661, 23861 => 33720, 23862 => 33659, 23863 => 33688,
+23864 => 33694, 23865 => 33704, 23866 => 33722, 23867 => 33724, 23868 => 33729,
+23869 => 33793, 23870 => 33765, 23871 => 33752, 23872 => 22535, 23873 => 33816,
+23874 => 33803, 23875 => 33757, 23876 => 33789, 23877 => 33750, 23878 => 33820,
+23879 => 33848, 23880 => 33809, 23881 => 33798, 23882 => 33748, 23883 => 33759,
+23884 => 33807, 23885 => 33795, 23886 => 33784, 23887 => 33785, 23888 => 33770,
+23889 => 33733, 23890 => 33728, 23891 => 33830, 23892 => 33776, 23893 => 33761,
+23894 => 33884, 23895 => 33873, 23896 => 33882, 23897 => 33881, 23898 => 33907,
+23899 => 33927, 23900 => 33928, 23901 => 33914, 23902 => 33929, 23903 => 33912,
+23904 => 33852, 23905 => 33862, 23906 => 33897, 23907 => 33910, 23908 => 33932,
+23909 => 33934, 23910 => 33841, 23911 => 33901, 23912 => 33985, 23913 => 33997,
+23914 => 34000, 23915 => 34022, 23916 => 33981, 23917 => 34003, 23918 => 33994,
+23919 => 33983, 23920 => 33978, 23921 => 34016, 23922 => 33953, 23923 => 33977,
+23924 => 33972, 23925 => 33943, 23926 => 34021, 23927 => 34019, 23928 => 34060,
+23929 => 29965, 23930 => 34104, 23931 => 34032, 23932 => 34105, 23933 => 34079,
+23934 => 34106, 24097 => 34134, 24098 => 34107, 24099 => 34047, 24100 => 34044,
+24101 => 34137, 24102 => 34120, 24103 => 34152, 24104 => 34148, 24105 => 34142,
+24106 => 34170, 24107 => 30626, 24108 => 34115, 24109 => 34162, 24110 => 34171,
+24111 => 34212, 24112 => 34216, 24113 => 34183, 24114 => 34191, 24115 => 34169,
+24116 => 34222, 24117 => 34204, 24118 => 34181, 24119 => 34233, 24120 => 34231,
+24121 => 34224, 24122 => 34259, 24123 => 34241, 24124 => 34268, 24125 => 34303,
+24126 => 34343, 24127 => 34309, 24128 => 34345, 24129 => 34326, 24130 => 34364,
+24131 => 24318, 24132 => 24328, 24133 => 22844, 24134 => 22849, 24135 => 32823,
+24136 => 22869, 24137 => 22874, 24138 => 22872, 24139 => 21263, 24140 => 23586,
+24141 => 23589, 24142 => 23596, 24143 => 23604, 24144 => 25164, 24145 => 25194,
+24146 => 25247, 24147 => 25275, 24148 => 25290, 24149 => 25306, 24150 => 25303,
+24151 => 25326, 24152 => 25378, 24153 => 25334, 24154 => 25401, 24155 => 25419,
+24156 => 25411, 24157 => 25517, 24158 => 25590, 24159 => 25457, 24160 => 25466,
+24161 => 25486, 24162 => 25524, 24163 => 25453, 24164 => 25516, 24165 => 25482,
+24166 => 25449, 24167 => 25518, 24168 => 25532, 24169 => 25586, 24170 => 25592,
+24171 => 25568, 24172 => 25599, 24173 => 25540, 24174 => 25566, 24175 => 25550,
+24176 => 25682, 24177 => 25542, 24178 => 25534, 24179 => 25669, 24180 => 25665,
+24181 => 25611, 24182 => 25627, 24183 => 25632, 24184 => 25612, 24185 => 25638,
+24186 => 25633, 24187 => 25694, 24188 => 25732, 24189 => 25709, 24190 => 25750,
+24353 => 25722, 24354 => 25783, 24355 => 25784, 24356 => 25753, 24357 => 25786,
+24358 => 25792, 24359 => 25808, 24360 => 25815, 24361 => 25828, 24362 => 25826,
+24363 => 25865, 24364 => 25893, 24365 => 25902, 24366 => 24331, 24367 => 24530,
+24368 => 29977, 24369 => 24337, 24370 => 21343, 24371 => 21489, 24372 => 21501,
+24373 => 21481, 24374 => 21480, 24375 => 21499, 24376 => 21522, 24377 => 21526,
+24378 => 21510, 24379 => 21579, 24380 => 21586, 24381 => 21587, 24382 => 21588,
+24383 => 21590, 24384 => 21571, 24385 => 21537, 24386 => 21591, 24387 => 21593,
+24388 => 21539, 24389 => 21554, 24390 => 21634, 24391 => 21652, 24392 => 21623,
+24393 => 21617, 24394 => 21604, 24395 => 21658, 24396 => 21659, 24397 => 21636,
+24398 => 21622, 24399 => 21606, 24400 => 21661, 24401 => 21712, 24402 => 21677,
+24403 => 21698, 24404 => 21684, 24405 => 21714, 24406 => 21671, 24407 => 21670,
+24408 => 21715, 24409 => 21716, 24410 => 21618, 24411 => 21667, 24412 => 21717,
+24413 => 21691, 24414 => 21695, 24415 => 21708, 24416 => 21721, 24417 => 21722,
+24418 => 21724, 24419 => 21673, 24420 => 21674, 24421 => 21668, 24422 => 21725,
+24423 => 21711, 24424 => 21726, 24425 => 21787, 24426 => 21735, 24427 => 21792,
+24428 => 21757, 24429 => 21780, 24430 => 21747, 24431 => 21794, 24432 => 21795,
+24433 => 21775, 24434 => 21777, 24435 => 21799, 24436 => 21802, 24437 => 21863,
+24438 => 21903, 24439 => 21941, 24440 => 21833, 24441 => 21869, 24442 => 21825,
+24443 => 21845, 24444 => 21823, 24445 => 21840, 24446 => 21820, 24609 => 21815,
+24610 => 21846, 24611 => 21877, 24612 => 21878, 24613 => 21879, 24614 => 21811,
+24615 => 21808, 24616 => 21852, 24617 => 21899, 24618 => 21970, 24619 => 21891,
+24620 => 21937, 24621 => 21945, 24622 => 21896, 24623 => 21889, 24624 => 21919,
+24625 => 21886, 24626 => 21974, 24627 => 21905, 24628 => 21883, 24629 => 21983,
+24630 => 21949, 24631 => 21950, 24632 => 21908, 24633 => 21913, 24634 => 21994,
+24635 => 22007, 24636 => 21961, 24637 => 22047, 24638 => 21969, 24639 => 21995,
+24640 => 21996, 24641 => 21972, 24642 => 21990, 24643 => 21981, 24644 => 21956,
+24645 => 21999, 24646 => 21989, 24647 => 22002, 24648 => 22003, 24649 => 21964,
+24650 => 21965, 24651 => 21992, 24652 => 22005, 24653 => 21988, 24654 => 36756,
+24655 => 22046, 24656 => 22024, 24657 => 22028, 24658 => 22017, 24659 => 22052,
+24660 => 22051, 24661 => 22014, 24662 => 22016, 24663 => 22055, 24664 => 22061,
+24665 => 22104, 24666 => 22073, 24667 => 22103, 24668 => 22060, 24669 => 22093,
+24670 => 22114, 24671 => 22105, 24672 => 22108, 24673 => 22092, 24674 => 22100,
+24675 => 22150, 24676 => 22116, 24677 => 22129, 24678 => 22123, 24679 => 22139,
+24680 => 22140, 24681 => 22149, 24682 => 22163, 24683 => 22191, 24684 => 22228,
+24685 => 22231, 24686 => 22237, 24687 => 22241, 24688 => 22261, 24689 => 22251,
+24690 => 22265, 24691 => 22271, 24692 => 22276, 24693 => 22282, 24694 => 22281,
+24695 => 22300, 24696 => 24079, 24697 => 24089, 24698 => 24084, 24699 => 24081,
+24700 => 24113, 24701 => 24123, 24702 => 24124, 24865 => 24119, 24866 => 24132,
+24867 => 24148, 24868 => 24155, 24869 => 24158, 24870 => 24161, 24871 => 23692,
+24872 => 23674, 24873 => 23693, 24874 => 23696, 24875 => 23702, 24876 => 23688,
+24877 => 23704, 24878 => 23705, 24879 => 23697, 24880 => 23706, 24881 => 23708,
+24882 => 23733, 24883 => 23714, 24884 => 23741, 24885 => 23724, 24886 => 23723,
+24887 => 23729, 24888 => 23715, 24889 => 23745, 24890 => 23735, 24891 => 23748,
+24892 => 23762, 24893 => 23780, 24894 => 23755, 24895 => 23781, 24896 => 23810,
+24897 => 23811, 24898 => 23847, 24899 => 23846, 24900 => 23854, 24901 => 23844,
+24902 => 23838, 24903 => 23814, 24904 => 23835, 24905 => 23896, 24906 => 23870,
+24907 => 23860, 24908 => 23869, 24909 => 23916, 24910 => 23899, 24911 => 23919,
+24912 => 23901, 24913 => 23915, 24914 => 23883, 24915 => 23882, 24916 => 23913,
+24917 => 23924, 24918 => 23938, 24919 => 23961, 24920 => 23965, 24921 => 35955,
+24922 => 23991, 24923 => 24005, 24924 => 24435, 24925 => 24439, 24926 => 24450,
+24927 => 24455, 24928 => 24457, 24929 => 24460, 24930 => 24469, 24931 => 24473,
+24932 => 24476, 24933 => 24488, 24934 => 24493, 24935 => 24501, 24936 => 24508,
+24937 => 34914, 24938 => 24417, 24939 => 29357, 24940 => 29360, 24941 => 29364,
+24942 => 29367, 24943 => 29368, 24944 => 29379, 24945 => 29377, 24946 => 29390,
+24947 => 29389, 24948 => 29394, 24949 => 29416, 24950 => 29423, 24951 => 29417,
+24952 => 29426, 24953 => 29428, 24954 => 29431, 24955 => 29441, 24956 => 29427,
+24957 => 29443, 24958 => 29434, 25121 => 29435, 25122 => 29463, 25123 => 29459,
+25124 => 29473, 25125 => 29450, 25126 => 29470, 25127 => 29469, 25128 => 29461,
+25129 => 29474, 25130 => 29497, 25131 => 29477, 25132 => 29484, 25133 => 29496,
+25134 => 29489, 25135 => 29520, 25136 => 29517, 25137 => 29527, 25138 => 29536,
+25139 => 29548, 25140 => 29551, 25141 => 29566, 25142 => 33307, 25143 => 22821,
+25144 => 39143, 25145 => 22820, 25146 => 22786, 25147 => 39267, 25148 => 39271,
+25149 => 39272, 25150 => 39273, 25151 => 39274, 25152 => 39275, 25153 => 39276,
+25154 => 39284, 25155 => 39287, 25156 => 39293, 25157 => 39296, 25158 => 39300,
+25159 => 39303, 25160 => 39306, 25161 => 39309, 25162 => 39312, 25163 => 39313,
+25164 => 39315, 25165 => 39316, 25166 => 39317, 25167 => 24192, 25168 => 24209,
+25169 => 24203, 25170 => 24214, 25171 => 24229, 25172 => 24224, 25173 => 24249,
+25174 => 24245, 25175 => 24254, 25176 => 24243, 25177 => 36179, 25178 => 24274,
+25179 => 24273, 25180 => 24283, 25181 => 24296, 25182 => 24298, 25183 => 33210,
+25184 => 24516, 25185 => 24521, 25186 => 24534, 25187 => 24527, 25188 => 24579,
+25189 => 24558, 25190 => 24580, 25191 => 24545, 25192 => 24548, 25193 => 24574,
+25194 => 24581, 25195 => 24582, 25196 => 24554, 25197 => 24557, 25198 => 24568,
+25199 => 24601, 25200 => 24629, 25201 => 24614, 25202 => 24603, 25203 => 24591,
+25204 => 24589, 25205 => 24617, 25206 => 24619, 25207 => 24586, 25208 => 24639,
+25209 => 24609, 25210 => 24696, 25211 => 24697, 25212 => 24699, 25213 => 24698,
+25214 => 24642, 25377 => 24682, 25378 => 24701, 25379 => 24726, 25380 => 24730,
+25381 => 24749, 25382 => 24733, 25383 => 24707, 25384 => 24722, 25385 => 24716,
+25386 => 24731, 25387 => 24812, 25388 => 24763, 25389 => 24753, 25390 => 24797,
+25391 => 24792, 25392 => 24774, 25393 => 24794, 25394 => 24756, 25395 => 24864,
+25396 => 24870, 25397 => 24853, 25398 => 24867, 25399 => 24820, 25400 => 24832,
+25401 => 24846, 25402 => 24875, 25403 => 24906, 25404 => 24949, 25405 => 25004,
+25406 => 24980, 25407 => 24999, 25408 => 25015, 25409 => 25044, 25410 => 25077,
+25411 => 24541, 25412 => 38579, 25413 => 38377, 25414 => 38379, 25415 => 38385,
+25416 => 38387, 25417 => 38389, 25418 => 38390, 25419 => 38396, 25420 => 38398,
+25421 => 38403, 25422 => 38404, 25423 => 38406, 25424 => 38408, 25425 => 38410,
+25426 => 38411, 25427 => 38412, 25428 => 38413, 25429 => 38415, 25430 => 38418,
+25431 => 38421, 25432 => 38422, 25433 => 38423, 25434 => 38425, 25435 => 38426,
+25436 => 20012, 25437 => 29247, 25438 => 25109, 25439 => 27701, 25440 => 27732,
+25441 => 27740, 25442 => 27722, 25443 => 27811, 25444 => 27781, 25445 => 27792,
+25446 => 27796, 25447 => 27788, 25448 => 27752, 25449 => 27753, 25450 => 27764,
+25451 => 27766, 25452 => 27782, 25453 => 27817, 25454 => 27856, 25455 => 27860,
+25456 => 27821, 25457 => 27895, 25458 => 27896, 25459 => 27889, 25460 => 27863,
+25461 => 27826, 25462 => 27872, 25463 => 27862, 25464 => 27898, 25465 => 27883,
+25466 => 27886, 25467 => 27825, 25468 => 27859, 25469 => 27887, 25470 => 27902,
+25633 => 27961, 25634 => 27943, 25635 => 27916, 25636 => 27971, 25637 => 27976,
+25638 => 27911, 25639 => 27908, 25640 => 27929, 25641 => 27918, 25642 => 27947,
+25643 => 27981, 25644 => 27950, 25645 => 27957, 25646 => 27930, 25647 => 27983,
+25648 => 27986, 25649 => 27988, 25650 => 27955, 25651 => 28049, 25652 => 28015,
+25653 => 28062, 25654 => 28064, 25655 => 27998, 25656 => 28051, 25657 => 28052,
+25658 => 27996, 25659 => 28000, 25660 => 28028, 25661 => 28003, 25662 => 28186,
+25663 => 28103, 25664 => 28101, 25665 => 28126, 25666 => 28174, 25667 => 28095,
+25668 => 28128, 25669 => 28177, 25670 => 28134, 25671 => 28125, 25672 => 28121,
+25673 => 28182, 25674 => 28075, 25675 => 28172, 25676 => 28078, 25677 => 28203,
+25678 => 28270, 25679 => 28238, 25680 => 28267, 25681 => 28338, 25682 => 28255,
+25683 => 28294, 25684 => 28243, 25685 => 28244, 25686 => 28210, 25687 => 28197,
+25688 => 28228, 25689 => 28383, 25690 => 28337, 25691 => 28312, 25692 => 28384,
+25693 => 28461, 25694 => 28386, 25695 => 28325, 25696 => 28327, 25697 => 28349,
+25698 => 28347, 25699 => 28343, 25700 => 28375, 25701 => 28340, 25702 => 28367,
+25703 => 28303, 25704 => 28354, 25705 => 28319, 25706 => 28514, 25707 => 28486,
+25708 => 28487, 25709 => 28452, 25710 => 28437, 25711 => 28409, 25712 => 28463,
+25713 => 28470, 25714 => 28491, 25715 => 28532, 25716 => 28458, 25717 => 28425,
+25718 => 28457, 25719 => 28553, 25720 => 28557, 25721 => 28556, 25722 => 28536,
+25723 => 28530, 25724 => 28540, 25725 => 28538, 25726 => 28625, 25889 => 28617,
+25890 => 28583, 25891 => 28601, 25892 => 28598, 25893 => 28610, 25894 => 28641,
+25895 => 28654, 25896 => 28638, 25897 => 28640, 25898 => 28655, 25899 => 28698,
+25900 => 28707, 25901 => 28699, 25902 => 28729, 25903 => 28725, 25904 => 28751,
+25905 => 28766, 25906 => 23424, 25907 => 23428, 25908 => 23445, 25909 => 23443,
+25910 => 23461, 25911 => 23480, 25912 => 29999, 25913 => 39582, 25914 => 25652,
+25915 => 23524, 25916 => 23534, 25917 => 35120, 25918 => 23536, 25919 => 36423,
+25920 => 35591, 25921 => 36790, 25922 => 36819, 25923 => 36821, 25924 => 36837,
+25925 => 36846, 25926 => 36836, 25927 => 36841, 25928 => 36838, 25929 => 36851,
+25930 => 36840, 25931 => 36869, 25932 => 36868, 25933 => 36875, 25934 => 36902,
+25935 => 36881, 25936 => 36877, 25937 => 36886, 25938 => 36897, 25939 => 36917,
+25940 => 36918, 25941 => 36909, 25942 => 36911, 25943 => 36932, 25944 => 36945,
+25945 => 36946, 25946 => 36944, 25947 => 36968, 25948 => 36952, 25949 => 36962,
+25950 => 36955, 25951 => 26297, 25952 => 36980, 25953 => 36989, 25954 => 36994,
+25955 => 37000, 25956 => 36995, 25957 => 37003, 25958 => 24400, 25959 => 24407,
+25960 => 24406, 25961 => 24408, 25962 => 23611, 25963 => 21675, 25964 => 23632,
+25965 => 23641, 25966 => 23409, 25967 => 23651, 25968 => 23654, 25969 => 32700,
+25970 => 24362, 25971 => 24361, 25972 => 24365, 25973 => 33396, 25974 => 24380,
+25975 => 39739, 25976 => 23662, 25977 => 22913, 25978 => 22915, 25979 => 22925,
+25980 => 22953, 25981 => 22954, 25982 => 22947, 26145 => 22935, 26146 => 22986,
+26147 => 22955, 26148 => 22942, 26149 => 22948, 26150 => 22994, 26151 => 22962,
+26152 => 22959, 26153 => 22999, 26154 => 22974, 26155 => 23045, 26156 => 23046,
+26157 => 23005, 26158 => 23048, 26159 => 23011, 26160 => 23000, 26161 => 23033,
+26162 => 23052, 26163 => 23049, 26164 => 23090, 26165 => 23092, 26166 => 23057,
+26167 => 23075, 26168 => 23059, 26169 => 23104, 26170 => 23143, 26171 => 23114,
+26172 => 23125, 26173 => 23100, 26174 => 23138, 26175 => 23157, 26176 => 33004,
+26177 => 23210, 26178 => 23195, 26179 => 23159, 26180 => 23162, 26181 => 23230,
+26182 => 23275, 26183 => 23218, 26184 => 23250, 26185 => 23252, 26186 => 23224,
+26187 => 23264, 26188 => 23267, 26189 => 23281, 26190 => 23254, 26191 => 23270,
+26192 => 23256, 26193 => 23260, 26194 => 23305, 26195 => 23319, 26196 => 23318,
+26197 => 23346, 26198 => 23351, 26199 => 23360, 26200 => 23573, 26201 => 23580,
+26202 => 23386, 26203 => 23397, 26204 => 23411, 26205 => 23377, 26206 => 23379,
+26207 => 23394, 26208 => 39541, 26209 => 39543, 26210 => 39544, 26211 => 39546,
+26212 => 39551, 26213 => 39549, 26214 => 39552, 26215 => 39553, 26216 => 39557,
+26217 => 39560, 26218 => 39562, 26219 => 39568, 26220 => 39570, 26221 => 39571,
+26222 => 39574, 26223 => 39576, 26224 => 39579, 26225 => 39580, 26226 => 39581,
+26227 => 39583, 26228 => 39584, 26229 => 39586, 26230 => 39587, 26231 => 39589,
+26232 => 39591, 26233 => 32415, 26234 => 32417, 26235 => 32419, 26236 => 32421,
+26237 => 32424, 26238 => 32425, 26401 => 32429, 26402 => 32432, 26403 => 32446,
+26404 => 32448, 26405 => 32449, 26406 => 32450, 26407 => 32457, 26408 => 32459,
+26409 => 32460, 26410 => 32464, 26411 => 32468, 26412 => 32471, 26413 => 32475,
+26414 => 32480, 26415 => 32481, 26416 => 32488, 26417 => 32491, 26418 => 32494,
+26419 => 32495, 26420 => 32497, 26421 => 32498, 26422 => 32525, 26423 => 32502,
+26424 => 32506, 26425 => 32507, 26426 => 32510, 26427 => 32513, 26428 => 32514,
+26429 => 32515, 26430 => 32519, 26431 => 32520, 26432 => 32523, 26433 => 32524,
+26434 => 32527, 26435 => 32529, 26436 => 32530, 26437 => 32535, 26438 => 32537,
+26439 => 32540, 26440 => 32539, 26441 => 32543, 26442 => 32545, 26443 => 32546,
+26444 => 32547, 26445 => 32548, 26446 => 32549, 26447 => 32550, 26448 => 32551,
+26449 => 32554, 26450 => 32555, 26451 => 32556, 26452 => 32557, 26453 => 32559,
+26454 => 32560, 26455 => 32561, 26456 => 32562, 26457 => 32563, 26458 => 32565,
+26459 => 24186, 26460 => 30079, 26461 => 24027, 26462 => 30014, 26463 => 37013,
+26464 => 29582, 26465 => 29585, 26466 => 29614, 26467 => 29602, 26468 => 29599,
+26469 => 29647, 26470 => 29634, 26471 => 29649, 26472 => 29623, 26473 => 29619,
+26474 => 29632, 26475 => 29641, 26476 => 29640, 26477 => 29669, 26478 => 29657,
+26479 => 39036, 26480 => 29706, 26481 => 29673, 26482 => 29671, 26483 => 29662,
+26484 => 29626, 26485 => 29682, 26486 => 29711, 26487 => 29738, 26488 => 29787,
+26489 => 29734, 26490 => 29733, 26491 => 29736, 26492 => 29744, 26493 => 29742,
+26494 => 29740, 26657 => 29723, 26658 => 29722, 26659 => 29761, 26660 => 29788,
+26661 => 29783, 26662 => 29781, 26663 => 29785, 26664 => 29815, 26665 => 29805,
+26666 => 29822, 26667 => 29852, 26668 => 29838, 26669 => 29824, 26670 => 29825,
+26671 => 29831, 26672 => 29835, 26673 => 29854, 26674 => 29864, 26675 => 29865,
+26676 => 29840, 26677 => 29863, 26678 => 29906, 26679 => 29882, 26680 => 38890,
+26681 => 38891, 26682 => 38892, 26683 => 26444, 26684 => 26451, 26685 => 26462,
+26686 => 26440, 26687 => 26473, 26688 => 26533, 26689 => 26503, 26690 => 26474,
+26691 => 26483, 26692 => 26520, 26693 => 26535, 26694 => 26485, 26695 => 26536,
+26696 => 26526, 26697 => 26541, 26698 => 26507, 26699 => 26487, 26700 => 26492,
+26701 => 26608, 26702 => 26633, 26703 => 26584, 26704 => 26634, 26705 => 26601,
+26706 => 26544, 26707 => 26636, 26708 => 26585, 26709 => 26549, 26710 => 26586,
+26711 => 26547, 26712 => 26589, 26713 => 26624, 26714 => 26563, 26715 => 26552,
+26716 => 26594, 26717 => 26638, 26718 => 26561, 26719 => 26621, 26720 => 26674,
+26721 => 26675, 26722 => 26720, 26723 => 26721, 26724 => 26702, 26725 => 26722,
+26726 => 26692, 26727 => 26724, 26728 => 26755, 26729 => 26653, 26730 => 26709,
+26731 => 26726, 26732 => 26689, 26733 => 26727, 26734 => 26688, 26735 => 26686,
+26736 => 26698, 26737 => 26697, 26738 => 26665, 26739 => 26805, 26740 => 26767,
+26741 => 26740, 26742 => 26743, 26743 => 26771, 26744 => 26731, 26745 => 26818,
+26746 => 26990, 26747 => 26876, 26748 => 26911, 26749 => 26912, 26750 => 26873,
+26913 => 26916, 26914 => 26864, 26915 => 26891, 26916 => 26881, 26917 => 26967,
+26918 => 26851, 26919 => 26896, 26920 => 26993, 26921 => 26937, 26922 => 26976,
+26923 => 26946, 26924 => 26973, 26925 => 27012, 26926 => 26987, 26927 => 27008,
+26928 => 27032, 26929 => 27000, 26930 => 26932, 26931 => 27084, 26932 => 27015,
+26933 => 27016, 26934 => 27086, 26935 => 27017, 26936 => 26982, 26937 => 26979,
+26938 => 27001, 26939 => 27035, 26940 => 27047, 26941 => 27067, 26942 => 27051,
+26943 => 27053, 26944 => 27092, 26945 => 27057, 26946 => 27073, 26947 => 27082,
+26948 => 27103, 26949 => 27029, 26950 => 27104, 26951 => 27021, 26952 => 27135,
+26953 => 27183, 26954 => 27117, 26955 => 27159, 26956 => 27160, 26957 => 27237,
+26958 => 27122, 26959 => 27204, 26960 => 27198, 26961 => 27296, 26962 => 27216,
+26963 => 27227, 26964 => 27189, 26965 => 27278, 26966 => 27257, 26967 => 27197,
+26968 => 27176, 26969 => 27224, 26970 => 27260, 26971 => 27281, 26972 => 27280,
+26973 => 27305, 26974 => 27287, 26975 => 27307, 26976 => 29495, 26977 => 29522,
+26978 => 27521, 26979 => 27522, 26980 => 27527, 26981 => 27524, 26982 => 27538,
+26983 => 27539, 26984 => 27533, 26985 => 27546, 26986 => 27547, 26987 => 27553,
+26988 => 27562, 26989 => 36715, 26990 => 36717, 26991 => 36721, 26992 => 36722,
+26993 => 36723, 26994 => 36725, 26995 => 36726, 26996 => 36728, 26997 => 36727,
+26998 => 36729, 26999 => 36730, 27000 => 36732, 27001 => 36734, 27002 => 36737,
+27003 => 36738, 27004 => 36740, 27005 => 36743, 27006 => 36747, 27169 => 36749,
+27170 => 36750, 27171 => 36751, 27172 => 36760, 27173 => 36762, 27174 => 36558,
+27175 => 25099, 27176 => 25111, 27177 => 25115, 27178 => 25119, 27179 => 25122,
+27180 => 25121, 27181 => 25125, 27182 => 25124, 27183 => 25132, 27184 => 33255,
+27185 => 29935, 27186 => 29940, 27187 => 29951, 27188 => 29967, 27189 => 29969,
+27190 => 29971, 27191 => 25908, 27192 => 26094, 27193 => 26095, 27194 => 26096,
+27195 => 26122, 27196 => 26137, 27197 => 26482, 27198 => 26115, 27199 => 26133,
+27200 => 26112, 27201 => 28805, 27202 => 26359, 27203 => 26141, 27204 => 26164,
+27205 => 26161, 27206 => 26166, 27207 => 26165, 27208 => 32774, 27209 => 26207,
+27210 => 26196, 27211 => 26177, 27212 => 26191, 27213 => 26198, 27214 => 26209,
+27215 => 26199, 27216 => 26231, 27217 => 26244, 27218 => 26252, 27219 => 26279,
+27220 => 26269, 27221 => 26302, 27222 => 26331, 27223 => 26332, 27224 => 26342,
+27225 => 26345, 27226 => 36146, 27227 => 36147, 27228 => 36150, 27229 => 36155,
+27230 => 36157, 27231 => 36160, 27232 => 36165, 27233 => 36166, 27234 => 36168,
+27235 => 36169, 27236 => 36167, 27237 => 36173, 27238 => 36181, 27239 => 36185,
+27240 => 35271, 27241 => 35274, 27242 => 35275, 27243 => 35276, 27244 => 35278,
+27245 => 35279, 27246 => 35280, 27247 => 35281, 27248 => 29294, 27249 => 29343,
+27250 => 29277, 27251 => 29286, 27252 => 29295, 27253 => 29310, 27254 => 29311,
+27255 => 29316, 27256 => 29323, 27257 => 29325, 27258 => 29327, 27259 => 29330,
+27260 => 25352, 27261 => 25394, 27262 => 25520, 27425 => 25663, 27426 => 25816,
+27427 => 32772, 27428 => 27626, 27429 => 27635, 27430 => 27645, 27431 => 27637,
+27432 => 27641, 27433 => 27653, 27434 => 27655, 27435 => 27654, 27436 => 27661,
+27437 => 27669, 27438 => 27672, 27439 => 27673, 27440 => 27674, 27441 => 27681,
+27442 => 27689, 27443 => 27684, 27444 => 27690, 27445 => 27698, 27446 => 25909,
+27447 => 25941, 27448 => 25963, 27449 => 29261, 27450 => 29266, 27451 => 29270,
+27452 => 29232, 27453 => 34402, 27454 => 21014, 27455 => 32927, 27456 => 32924,
+27457 => 32915, 27458 => 32956, 27459 => 26378, 27460 => 32957, 27461 => 32945,
+27462 => 32939, 27463 => 32941, 27464 => 32948, 27465 => 32951, 27466 => 32999,
+27467 => 33000, 27468 => 33001, 27469 => 33002, 27470 => 32987, 27471 => 32962,
+27472 => 32964, 27473 => 32985, 27474 => 32973, 27475 => 32983, 27476 => 26384,
+27477 => 32989, 27478 => 33003, 27479 => 33009, 27480 => 33012, 27481 => 33005,
+27482 => 33037, 27483 => 33038, 27484 => 33010, 27485 => 33020, 27486 => 26389,
+27487 => 33042, 27488 => 35930, 27489 => 33078, 27490 => 33054, 27491 => 33068,
+27492 => 33048, 27493 => 33074, 27494 => 33096, 27495 => 33100, 27496 => 33107,
+27497 => 33140, 27498 => 33113, 27499 => 33114, 27500 => 33137, 27501 => 33120,
+27502 => 33129, 27503 => 33148, 27504 => 33149, 27505 => 33133, 27506 => 33127,
+27507 => 22605, 27508 => 23221, 27509 => 33160, 27510 => 33154, 27511 => 33169,
+27512 => 28373, 27513 => 33187, 27514 => 33194, 27515 => 33228, 27516 => 26406,
+27517 => 33226, 27518 => 33211, 27681 => 33217, 27682 => 33190, 27683 => 27428,
+27684 => 27447, 27685 => 27449, 27686 => 27459, 27687 => 27462, 27688 => 27481,
+27689 => 39121, 27690 => 39122, 27691 => 39123, 27692 => 39125, 27693 => 39129,
+27694 => 39130, 27695 => 27571, 27696 => 24384, 27697 => 27586, 27698 => 35315,
+27699 => 26000, 27700 => 40785, 27701 => 26003, 27702 => 26044, 27703 => 26054,
+27704 => 26052, 27705 => 26051, 27706 => 26060, 27707 => 26062, 27708 => 26066,
+27709 => 26070, 27710 => 28800, 27711 => 28828, 27712 => 28822, 27713 => 28829,
+27714 => 28859, 27715 => 28864, 27716 => 28855, 27717 => 28843, 27718 => 28849,
+27719 => 28904, 27720 => 28874, 27721 => 28944, 27722 => 28947, 27723 => 28950,
+27724 => 28975, 27725 => 28977, 27726 => 29043, 27727 => 29020, 27728 => 29032,
+27729 => 28997, 27730 => 29042, 27731 => 29002, 27732 => 29048, 27733 => 29050,
+27734 => 29080, 27735 => 29107, 27736 => 29109, 27737 => 29096, 27738 => 29088,
+27739 => 29152, 27740 => 29140, 27741 => 29159, 27742 => 29177, 27743 => 29213,
+27744 => 29224, 27745 => 28780, 27746 => 28952, 27747 => 29030, 27748 => 29113,
+27749 => 25150, 27750 => 25149, 27751 => 25155, 27752 => 25160, 27753 => 25161,
+27754 => 31035, 27755 => 31040, 27756 => 31046, 27757 => 31049, 27758 => 31067,
+27759 => 31068, 27760 => 31059, 27761 => 31066, 27762 => 31074, 27763 => 31063,
+27764 => 31072, 27765 => 31087, 27766 => 31079, 27767 => 31098, 27768 => 31109,
+27769 => 31114, 27770 => 31130, 27771 => 31143, 27772 => 31155, 27773 => 24529,
+27774 => 24528, 27937 => 24636, 27938 => 24669, 27939 => 24666, 27940 => 24679,
+27941 => 24641, 27942 => 24665, 27943 => 24675, 27944 => 24747, 27945 => 24838,
+27946 => 24845, 27947 => 24925, 27948 => 25001, 27949 => 24989, 27950 => 25035,
+27951 => 25041, 27952 => 25094, 27953 => 32896, 27954 => 32895, 27955 => 27795,
+27956 => 27894, 27957 => 28156, 27958 => 30710, 27959 => 30712, 27960 => 30720,
+27961 => 30729, 27962 => 30743, 27963 => 30744, 27964 => 30737, 27965 => 26027,
+27966 => 30765, 27967 => 30748, 27968 => 30749, 27969 => 30777, 27970 => 30778,
+27971 => 30779, 27972 => 30751, 27973 => 30780, 27974 => 30757, 27975 => 30764,
+27976 => 30755, 27977 => 30761, 27978 => 30798, 27979 => 30829, 27980 => 30806,
+27981 => 30807, 27982 => 30758, 27983 => 30800, 27984 => 30791, 27985 => 30796,
+27986 => 30826, 27987 => 30875, 27988 => 30867, 27989 => 30874, 27990 => 30855,
+27991 => 30876, 27992 => 30881, 27993 => 30883, 27994 => 30898, 27995 => 30905,
+27996 => 30885, 27997 => 30932, 27998 => 30937, 27999 => 30921, 28000 => 30956,
+28001 => 30962, 28002 => 30981, 28003 => 30964, 28004 => 30995, 28005 => 31012,
+28006 => 31006, 28007 => 31028, 28008 => 40859, 28009 => 40697, 28010 => 40699,
+28011 => 40700, 28012 => 30449, 28013 => 30468, 28014 => 30477, 28015 => 30457,
+28016 => 30471, 28017 => 30472, 28018 => 30490, 28019 => 30498, 28020 => 30489,
+28021 => 30509, 28022 => 30502, 28023 => 30517, 28024 => 30520, 28025 => 30544,
+28026 => 30545, 28027 => 30535, 28028 => 30531, 28029 => 30554, 28030 => 30568,
+28193 => 30562, 28194 => 30565, 28195 => 30591, 28196 => 30605, 28197 => 30589,
+28198 => 30592, 28199 => 30604, 28200 => 30609, 28201 => 30623, 28202 => 30624,
+28203 => 30640, 28204 => 30645, 28205 => 30653, 28206 => 30010, 28207 => 30016,
+28208 => 30030, 28209 => 30027, 28210 => 30024, 28211 => 30043, 28212 => 30066,
+28213 => 30073, 28214 => 30083, 28215 => 32600, 28216 => 32609, 28217 => 32607,
+28218 => 35400, 28219 => 32616, 28220 => 32628, 28221 => 32625, 28222 => 32633,
+28223 => 32641, 28224 => 32638, 28225 => 30413, 28226 => 30437, 28227 => 34866,
+28228 => 38021, 28229 => 38022, 28230 => 38023, 28231 => 38027, 28232 => 38026,
+28233 => 38028, 28234 => 38029, 28235 => 38031, 28236 => 38032, 28237 => 38036,
+28238 => 38039, 28239 => 38037, 28240 => 38042, 28241 => 38043, 28242 => 38044,
+28243 => 38051, 28244 => 38052, 28245 => 38059, 28246 => 38058, 28247 => 38061,
+28248 => 38060, 28249 => 38063, 28250 => 38064, 28251 => 38066, 28252 => 38068,
+28253 => 38070, 28254 => 38071, 28255 => 38072, 28256 => 38073, 28257 => 38074,
+28258 => 38076, 28259 => 38077, 28260 => 38079, 28261 => 38084, 28262 => 38088,
+28263 => 38089, 28264 => 38090, 28265 => 38091, 28266 => 38092, 28267 => 38093,
+28268 => 38094, 28269 => 38096, 28270 => 38097, 28271 => 38098, 28272 => 38101,
+28273 => 38102, 28274 => 38103, 28275 => 38105, 28276 => 38104, 28277 => 38107,
+28278 => 38110, 28279 => 38111, 28280 => 38112, 28281 => 38114, 28282 => 38116,
+28283 => 38117, 28284 => 38119, 28285 => 38120, 28286 => 38122, 28449 => 38121,
+28450 => 38123, 28451 => 38126, 28452 => 38127, 28453 => 38131, 28454 => 38132,
+28455 => 38133, 28456 => 38135, 28457 => 38137, 28458 => 38140, 28459 => 38141,
+28460 => 38143, 28461 => 38147, 28462 => 38146, 28463 => 38150, 28464 => 38151,
+28465 => 38153, 28466 => 38154, 28467 => 38157, 28468 => 38158, 28469 => 38159,
+28470 => 38162, 28471 => 38163, 28472 => 38164, 28473 => 38165, 28474 => 38166,
+28475 => 38168, 28476 => 38171, 28477 => 38173, 28478 => 38174, 28479 => 38175,
+28480 => 38178, 28481 => 38186, 28482 => 38187, 28483 => 38185, 28484 => 38188,
+28485 => 38193, 28486 => 38194, 28487 => 38196, 28488 => 38198, 28489 => 38199,
+28490 => 38200, 28491 => 38204, 28492 => 38206, 28493 => 38207, 28494 => 38210,
+28495 => 38197, 28496 => 38212, 28497 => 38213, 28498 => 38214, 28499 => 38217,
+28500 => 38220, 28501 => 38222, 28502 => 38223, 28503 => 38226, 28504 => 38227,
+28505 => 38228, 28506 => 38230, 28507 => 38231, 28508 => 38232, 28509 => 38233,
+28510 => 38235, 28511 => 38238, 28512 => 38239, 28513 => 38237, 28514 => 38241,
+28515 => 38242, 28516 => 38244, 28517 => 38245, 28518 => 38246, 28519 => 38247,
+28520 => 38248, 28521 => 38249, 28522 => 38250, 28523 => 38251, 28524 => 38252,
+28525 => 38255, 28526 => 38257, 28527 => 38258, 28528 => 38259, 28529 => 38202,
+28530 => 30695, 28531 => 30700, 28532 => 38601, 28533 => 31189, 28534 => 31213,
+28535 => 31203, 28536 => 31211, 28537 => 31238, 28538 => 23879, 28539 => 31235,
+28540 => 31234, 28541 => 31262, 28542 => 31252, 28705 => 31289, 28706 => 31287,
+28707 => 31313, 28708 => 40655, 28709 => 39333, 28710 => 31344, 28711 => 30344,
+28712 => 30350, 28713 => 30355, 28714 => 30361, 28715 => 30372, 28716 => 29918,
+28717 => 29920, 28718 => 29996, 28719 => 40480, 28720 => 40482, 28721 => 40488,
+28722 => 40489, 28723 => 40490, 28724 => 40491, 28725 => 40492, 28726 => 40498,
+28727 => 40497, 28728 => 40502, 28729 => 40504, 28730 => 40503, 28731 => 40505,
+28732 => 40506, 28733 => 40510, 28734 => 40513, 28735 => 40514, 28736 => 40516,
+28737 => 40518, 28738 => 40519, 28739 => 40520, 28740 => 40521, 28741 => 40523,
+28742 => 40524, 28743 => 40526, 28744 => 40529, 28745 => 40533, 28746 => 40535,
+28747 => 40538, 28748 => 40539, 28749 => 40540, 28750 => 40542, 28751 => 40547,
+28752 => 40550, 28753 => 40551, 28754 => 40552, 28755 => 40553, 28756 => 40554,
+28757 => 40555, 28758 => 40556, 28759 => 40561, 28760 => 40557, 28761 => 40563,
+28762 => 30098, 28763 => 30100, 28764 => 30102, 28765 => 30112, 28766 => 30109,
+28767 => 30124, 28768 => 30115, 28769 => 30131, 28770 => 30132, 28771 => 30136,
+28772 => 30148, 28773 => 30129, 28774 => 30128, 28775 => 30147, 28776 => 30146,
+28777 => 30166, 28778 => 30157, 28779 => 30179, 28780 => 30184, 28781 => 30182,
+28782 => 30180, 28783 => 30187, 28784 => 30183, 28785 => 30211, 28786 => 30193,
+28787 => 30204, 28788 => 30207, 28789 => 30224, 28790 => 30208, 28791 => 30213,
+28792 => 30220, 28793 => 30231, 28794 => 30218, 28795 => 30245, 28796 => 30232,
+28797 => 30229, 28798 => 30233, 28961 => 30235, 28962 => 30268, 28963 => 30242,
+28964 => 30240, 28965 => 30272, 28966 => 30253, 28967 => 30256, 28968 => 30271,
+28969 => 30261, 28970 => 30275, 28971 => 30270, 28972 => 30259, 28973 => 30285,
+28974 => 30302, 28975 => 30292, 28976 => 30300, 28977 => 30294, 28978 => 30315,
+28979 => 30319, 28980 => 32714, 28981 => 31462, 28982 => 31352, 28983 => 31353,
+28984 => 31360, 28985 => 31366, 28986 => 31368, 28987 => 31381, 28988 => 31398,
+28989 => 31392, 28990 => 31404, 28991 => 31400, 28992 => 31405, 28993 => 31411,
+28994 => 34916, 28995 => 34921, 28996 => 34930, 28997 => 34941, 28998 => 34943,
+28999 => 34946, 29000 => 34978, 29001 => 35014, 29002 => 34999, 29003 => 35004,
+29004 => 35017, 29005 => 35042, 29006 => 35022, 29007 => 35043, 29008 => 35045,
+29009 => 35057, 29010 => 35098, 29011 => 35068, 29012 => 35048, 29013 => 35070,
+29014 => 35056, 29015 => 35105, 29016 => 35097, 29017 => 35091, 29018 => 35099,
+29019 => 35082, 29020 => 35124, 29021 => 35115, 29022 => 35126, 29023 => 35137,
+29024 => 35174, 29025 => 35195, 29026 => 30091, 29027 => 32997, 29028 => 30386,
+29029 => 30388, 29030 => 30684, 29031 => 32786, 29032 => 32788, 29033 => 32790,
+29034 => 32796, 29035 => 32800, 29036 => 32802, 29037 => 32805, 29038 => 32806,
+29039 => 32807, 29040 => 32809, 29041 => 32808, 29042 => 32817, 29043 => 32779,
+29044 => 32821, 29045 => 32835, 29046 => 32838, 29047 => 32845, 29048 => 32850,
+29049 => 32873, 29050 => 32881, 29051 => 35203, 29052 => 39032, 29053 => 39040,
+29054 => 39043, 29217 => 39049, 29218 => 39052, 29219 => 39053, 29220 => 39055,
+29221 => 39060, 29222 => 39066, 29223 => 39067, 29224 => 39070, 29225 => 39071,
+29226 => 39073, 29227 => 39074, 29228 => 39077, 29229 => 39078, 29230 => 34381,
+29231 => 34388, 29232 => 34412, 29233 => 34414, 29234 => 34431, 29235 => 34426,
+29236 => 34428, 29237 => 34427, 29238 => 34472, 29239 => 34445, 29240 => 34443,
+29241 => 34476, 29242 => 34461, 29243 => 34471, 29244 => 34467, 29245 => 34474,
+29246 => 34451, 29247 => 34473, 29248 => 34486, 29249 => 34500, 29250 => 34485,
+29251 => 34510, 29252 => 34480, 29253 => 34490, 29254 => 34481, 29255 => 34479,
+29256 => 34505, 29257 => 34511, 29258 => 34484, 29259 => 34537, 29260 => 34545,
+29261 => 34546, 29262 => 34541, 29263 => 34547, 29264 => 34512, 29265 => 34579,
+29266 => 34526, 29267 => 34548, 29268 => 34527, 29269 => 34520, 29270 => 34513,
+29271 => 34563, 29272 => 34567, 29273 => 34552, 29274 => 34568, 29275 => 34570,
+29276 => 34573, 29277 => 34569, 29278 => 34595, 29279 => 34619, 29280 => 34590,
+29281 => 34597, 29282 => 34606, 29283 => 34586, 29284 => 34622, 29285 => 34632,
+29286 => 34612, 29287 => 34609, 29288 => 34601, 29289 => 34615, 29290 => 34623,
+29291 => 34690, 29292 => 34594, 29293 => 34685, 29294 => 34686, 29295 => 34683,
+29296 => 34656, 29297 => 34672, 29298 => 34636, 29299 => 34670, 29300 => 34699,
+29301 => 34643, 29302 => 34659, 29303 => 34684, 29304 => 34660, 29305 => 34649,
+29306 => 34661, 29307 => 34707, 29308 => 34735, 29309 => 34728, 29310 => 34770,
+29473 => 34758, 29474 => 34696, 29475 => 34693, 29476 => 34733, 29477 => 34711,
+29478 => 34691, 29479 => 34731, 29480 => 34789, 29481 => 34732, 29482 => 34741,
+29483 => 34739, 29484 => 34763, 29485 => 34771, 29486 => 34749, 29487 => 34769,
+29488 => 34752, 29489 => 34762, 29490 => 34779, 29491 => 34794, 29492 => 34784,
+29493 => 34798, 29494 => 34838, 29495 => 34835, 29496 => 34814, 29497 => 34826,
+29498 => 34843, 29499 => 34849, 29500 => 34873, 29501 => 34876, 29502 => 32566,
+29503 => 32578, 29504 => 32580, 29505 => 32581, 29506 => 33296, 29507 => 31482,
+29508 => 31485, 29509 => 31496, 29510 => 31491, 29511 => 31492, 29512 => 31509,
+29513 => 31498, 29514 => 31531, 29515 => 31503, 29516 => 31559, 29517 => 31544,
+29518 => 31530, 29519 => 31513, 29520 => 31534, 29521 => 31537, 29522 => 31520,
+29523 => 31525, 29524 => 31524, 29525 => 31539, 29526 => 31550, 29527 => 31518,
+29528 => 31576, 29529 => 31578, 29530 => 31557, 29531 => 31605, 29532 => 31564,
+29533 => 31581, 29534 => 31584, 29535 => 31598, 29536 => 31611, 29537 => 31586,
+29538 => 31602, 29539 => 31601, 29540 => 31632, 29541 => 31654, 29542 => 31655,
+29543 => 31672, 29544 => 31660, 29545 => 31645, 29546 => 31656, 29547 => 31621,
+29548 => 31658, 29549 => 31644, 29550 => 31650, 29551 => 31659, 29552 => 31668,
+29553 => 31697, 29554 => 31681, 29555 => 31692, 29556 => 31709, 29557 => 31706,
+29558 => 31717, 29559 => 31718, 29560 => 31722, 29561 => 31756, 29562 => 31742,
+29563 => 31740, 29564 => 31759, 29565 => 31766, 29566 => 31755, 29729 => 31775,
+29730 => 31786, 29731 => 31782, 29732 => 31800, 29733 => 31809, 29734 => 31808,
+29735 => 33278, 29736 => 33281, 29737 => 33282, 29738 => 33284, 29739 => 33260,
+29740 => 34884, 29741 => 33313, 29742 => 33314, 29743 => 33315, 29744 => 33325,
+29745 => 33327, 29746 => 33320, 29747 => 33323, 29748 => 33336, 29749 => 33339,
+29750 => 33331, 29751 => 33332, 29752 => 33342, 29753 => 33348, 29754 => 33353,
+29755 => 33355, 29756 => 33359, 29757 => 33370, 29758 => 33375, 29759 => 33384,
+29760 => 34942, 29761 => 34949, 29762 => 34952, 29763 => 35032, 29764 => 35039,
+29765 => 35166, 29766 => 32669, 29767 => 32671, 29768 => 32679, 29769 => 32687,
+29770 => 32688, 29771 => 32690, 29772 => 31868, 29773 => 25929, 29774 => 31889,
+29775 => 31901, 29776 => 31900, 29777 => 31902, 29778 => 31906, 29779 => 31922,
+29780 => 31932, 29781 => 31933, 29782 => 31937, 29783 => 31943, 29784 => 31948,
+29785 => 31949, 29786 => 31944, 29787 => 31941, 29788 => 31959, 29789 => 31976,
+29790 => 33390, 29791 => 26280, 29792 => 32703, 29793 => 32718, 29794 => 32725,
+29795 => 32741, 29796 => 32737, 29797 => 32742, 29798 => 32745, 29799 => 32750,
+29800 => 32755, 29801 => 31992, 29802 => 32119, 29803 => 32166, 29804 => 32174,
+29805 => 32327, 29806 => 32411, 29807 => 40632, 29808 => 40628, 29809 => 36211,
+29810 => 36228, 29811 => 36244, 29812 => 36241, 29813 => 36273, 29814 => 36199,
+29815 => 36205, 29816 => 35911, 29817 => 35913, 29818 => 37194, 29819 => 37200,
+29820 => 37198, 29821 => 37199, 29822 => 37220, 29985 => 37218, 29986 => 37217,
+29987 => 37232, 29988 => 37225, 29989 => 37231, 29990 => 37245, 29991 => 37246,
+29992 => 37234, 29993 => 37236, 29994 => 37241, 29995 => 37260, 29996 => 37253,
+29997 => 37264, 29998 => 37261, 29999 => 37265, 30000 => 37282, 30001 => 37283,
+30002 => 37290, 30003 => 37293, 30004 => 37294, 30005 => 37295, 30006 => 37301,
+30007 => 37300, 30008 => 37306, 30009 => 35925, 30010 => 40574, 30011 => 36280,
+30012 => 36331, 30013 => 36357, 30014 => 36441, 30015 => 36457, 30016 => 36277,
+30017 => 36287, 30018 => 36284, 30019 => 36282, 30020 => 36292, 30021 => 36310,
+30022 => 36311, 30023 => 36314, 30024 => 36318, 30025 => 36302, 30026 => 36303,
+30027 => 36315, 30028 => 36294, 30029 => 36332, 30030 => 36343, 30031 => 36344,
+30032 => 36323, 30033 => 36345, 30034 => 36347, 30035 => 36324, 30036 => 36361,
+30037 => 36349, 30038 => 36372, 30039 => 36381, 30040 => 36383, 30041 => 36396,
+30042 => 36398, 30043 => 36387, 30044 => 36399, 30045 => 36410, 30046 => 36416,
+30047 => 36409, 30048 => 36405, 30049 => 36413, 30050 => 36401, 30051 => 36425,
+30052 => 36417, 30053 => 36418, 30054 => 36433, 30055 => 36434, 30056 => 36426,
+30057 => 36464, 30058 => 36470, 30059 => 36476, 30060 => 36463, 30061 => 36468,
+30062 => 36485, 30063 => 36495, 30064 => 36500, 30065 => 36496, 30066 => 36508,
+30067 => 36510, 30068 => 35960, 30069 => 35970, 30070 => 35978, 30071 => 35973,
+30072 => 35992, 30073 => 35988, 30074 => 26011, 30075 => 35286, 30076 => 35294,
+30077 => 35290, 30078 => 35292, 30241 => 35301, 30242 => 35307, 30243 => 35311,
+30244 => 35390, 30245 => 35622, 30246 => 38739, 30247 => 38633, 30248 => 38643,
+30249 => 38639, 30250 => 38662, 30251 => 38657, 30252 => 38664, 30253 => 38671,
+30254 => 38670, 30255 => 38698, 30256 => 38701, 30257 => 38704, 30258 => 38718,
+30259 => 40832, 30260 => 40835, 30261 => 40837, 30262 => 40838, 30263 => 40839,
+30264 => 40840, 30265 => 40841, 30266 => 40842, 30267 => 40844, 30268 => 40702,
+30269 => 40715, 30270 => 40717, 30271 => 38585, 30272 => 38588, 30273 => 38589,
+30274 => 38606, 30275 => 38610, 30276 => 30655, 30277 => 38624, 30278 => 37518,
+30279 => 37550, 30280 => 37576, 30281 => 37694, 30282 => 37738, 30283 => 37834,
+30284 => 37775, 30285 => 37950, 30286 => 37995, 30287 => 40063, 30288 => 40066,
+30289 => 40069, 30290 => 40070, 30291 => 40071, 30292 => 40072, 30293 => 31267,
+30294 => 40075, 30295 => 40078, 30296 => 40080, 30297 => 40081, 30298 => 40082,
+30299 => 40084, 30300 => 40085, 30301 => 40090, 30302 => 40091, 30303 => 40094,
+30304 => 40095, 30305 => 40096, 30306 => 40097, 30307 => 40098, 30308 => 40099,
+30309 => 40101, 30310 => 40102, 30311 => 40103, 30312 => 40104, 30313 => 40105,
+30314 => 40107, 30315 => 40109, 30316 => 40110, 30317 => 40112, 30318 => 40113,
+30319 => 40114, 30320 => 40115, 30321 => 40116, 30322 => 40117, 30323 => 40118,
+30324 => 40119, 30325 => 40122, 30326 => 40123, 30327 => 40124, 30328 => 40125,
+30329 => 40132, 30330 => 40133, 30331 => 40134, 30332 => 40135, 30333 => 40138,
+30334 => 40139, 30497 => 40140, 30498 => 40141, 30499 => 40142, 30500 => 40143,
+30501 => 40144, 30502 => 40147, 30503 => 40148, 30504 => 40149, 30505 => 40151,
+30506 => 40152, 30507 => 40153, 30508 => 40156, 30509 => 40157, 30510 => 40159,
+30511 => 40162, 30512 => 38780, 30513 => 38789, 30514 => 38801, 30515 => 38802,
+30516 => 38804, 30517 => 38831, 30518 => 38827, 30519 => 38819, 30520 => 38834,
+30521 => 38836, 30522 => 39601, 30523 => 39600, 30524 => 39607, 30525 => 40536,
+30526 => 39606, 30527 => 39610, 30528 => 39612, 30529 => 39617, 30530 => 39616,
+30531 => 39621, 30532 => 39618, 30533 => 39627, 30534 => 39628, 30535 => 39633,
+30536 => 39749, 30537 => 39747, 30538 => 39751, 30539 => 39753, 30540 => 39752,
+30541 => 39757, 30542 => 39761, 30543 => 39144, 30544 => 39181, 30545 => 39214,
+30546 => 39253, 30547 => 39252, 30548 => 39647, 30549 => 39649, 30550 => 39654,
+30551 => 39663, 30552 => 39659, 30553 => 39675, 30554 => 39661, 30555 => 39673,
+30556 => 39688, 30557 => 39695, 30558 => 39699, 30559 => 39711, 30560 => 39715,
+30561 => 40637, 30562 => 40638, 30563 => 32315, 30564 => 40578, 30565 => 40583,
+30566 => 40584, 30567 => 40587, 30568 => 40594, 30569 => 37846, 30570 => 40605,
+30571 => 40607, 30572 => 40667, 30573 => 40668, 30574 => 40669, 30575 => 40672,
+30576 => 40671, 30577 => 40674, 30578 => 40681, 30579 => 40679, 30580 => 40677,
+30581 => 40682, 30582 => 40687, 30583 => 40738, 30584 => 40748, 30585 => 40751,
+30586 => 40761, 30587 => 40759, 30588 => 40765, 30589 => 40766, 30590 => 40772,
+0 => 0 );
+
+    function gb2utf8($gb) {
+	if( !trim($gb) ) return $gb;
+	$utf8='';
+	while($gb) {
+	    if( ord(substr($gb,0,1)) > 127 ) {
+		$t=substr($gb,0,2);
+		$gb=substr($gb,2);
+		$utf8 .= $this->u2utf8($this->codetable[hexdec(bin2hex($t))-0x8080]);
+	    }
+	    else { 
+		$t=substr($gb,0,1);
+		$gb=substr($gb,1);
+		$utf8 .= $this->u2utf8($t);
+	    }
+	}
+	return $utf8;
+    }
+    
+    function u2utf8($c) {
+	$str='';
+	if ($c < 0x80) {
+	    $str.=$c;
+	    }
+	else if ($c < 0x800) {
+	    $str.=chr(0xC0 | $c>>6);
+	    $str.=chr(0x80 | $c & 0x3F);
+	    }
+	else if ($c < 0x10000) {
+	    $str.=chr(0xE0 | $c>>12);
+	    $str.=chr(0x80 | $c>>6 & 0x3F);
+		$str.=chr(0x80 | $c & 0x3F);
+	}
+	else if ($c < 0x200000) {
+	    $str.=chr(0xF0 | $c>>18);
+	    $str.=chr(0x80 | $c>>12 & 0x3F);
+	    $str.=chr(0x80 | $c>>6 & 0x3F);
+	    $str.=chr(0x80 | $c & 0x3F);
+	}
+	return $str;
+    }
+
+} // END Class 
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_gradient.php php-syslog-ng/html/includes/jpgraph/jpgraph_gradient.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_gradient.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_gradient.php	2006-02-04 07:45:44.000000000 -0500
@@ -0,0 +1,377 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_GRADIENT.PHP
+// Description:	Create a color gradient
+// Created: 	2003-02-01
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_gradient.php 501 2006-02-04 12:45:44Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+// Styles for gradient color fill
+DEFINE("GRAD_VER",1);
+DEFINE("GRAD_VERT",1);
+DEFINE("GRAD_HOR",2);
+DEFINE("GRAD_MIDHOR",3);
+DEFINE("GRAD_MIDVER",4);
+DEFINE("GRAD_CENTER",5);
+DEFINE("GRAD_WIDE_MIDVER",6);
+DEFINE("GRAD_WIDE_MIDHOR",7);
+DEFINE("GRAD_LEFT_REFLECTION",8);
+DEFINE("GRAD_RIGHT_REFLECTION",9);
+DEFINE("GRAD_RAISED_PANEL",10);
+
+  
+//===================================================
+// CLASS Gradient
+// Description: Handles gradient fills. This is to be
+// considered a "friend" class of Class Image.
+//===================================================
+class Gradient {
+    var $img=null;
+    var $numcolors=100;
+//---------------
+// CONSTRUCTOR
+    function Gradient(&$img) {
+	$this->img = &$img;
+    }
+
+
+    function SetNumColors($aNum) {
+	$this->numcolors=$aNum;
+    }
+//---------------
+// PUBLIC METHODS	
+    // Produce a gradient filled rectangle with a smooth transition between
+    // two colors.
+    // ($xl,$yt) 	Top left corner
+    // ($xr,$yb)	Bottom right
+    // $from_color	Starting color in gradient
+    // $to_color	End color in the gradient
+    // $style		Which way is the gradient oriented?
+    function FilledRectangle($xl,$yt,$xr,$yb,$from_color,$to_color,$style=1) {
+	switch( $style ) {	
+	    case GRAD_VER:  
+		$steps = round(abs($xr-$xl));
+		$delta = $xr>=$xl ? 1 : -1;
+		$this->GetColArray($from_color,$to_color,$steps,$colors,$this->numcolors);
+		for( $i=0, $x=$xl; $i < $steps; ++$i ) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yt,$x,$yb);
+		    $x += $delta;
+		}
+		break;
+
+	    case GRAD_HOR: 
+		$steps = round(abs($yb-$yt));
+		$delta = $yb>=$yt ? 1 : -1;
+		$this->GetColArray($from_color,$to_color,$steps,$colors,$this->numcolors);
+		for($i=0,$y=$yt; $i < $steps; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($xl,$y,$xr,$y);
+		    $y += $delta;
+		}
+		break;
+
+	    case GRAD_MIDHOR: 
+		$steps = round(abs($yb-$yt)/2);
+		$delta = $yb >= $yt ? 1 : -1;
+		$this->GetColArray($from_color,$to_color,$steps,$colors,$this->numcolors);
+		for($y=$yt, $i=0; $i < $steps;  ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($xl,$y,$xr,$y);
+		    $y += $delta;
+		}
+		--$i;
+		if( abs($yb-$yt) % 2 == 1 ) --$steps;
+		for($j=0; $j < $steps; ++$j, --$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($xl,$y,$xr,$y);
+		    $y += $delta;
+		}
+		$this->img->Line($xl,$y,$xr,$y);
+		break;
+
+	    case GRAD_MIDVER: 
+		$steps = round(abs($xr-$xl)/2);
+		$delta = $xr>=$xl ? 1 : -1;
+		$this->GetColArray($from_color,$to_color,$steps,$colors,$this->numcolors);
+		for($x=$xl, $i=0; $i < $steps; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		--$i;
+		if( abs($xr-$xl) % 2 == 1 ) --$steps;
+		for($j=0; $j < $steps; ++$j, --$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		$this->img->Line($x,$yb,$x,$yt);		
+		break;
+
+	    case GRAD_WIDE_MIDVER: 
+		$diff = round(abs($xr-$xl));
+		$steps = floor(abs($diff)/3);
+		$firststep = $diff - 2*$steps ; 
+		$delta = $xr >= $xl ? 1 : -1;
+		$this->GetColArray($from_color,$to_color,$firststep,$colors,$this->numcolors);
+		for($x=$xl, $i=0; $i < $firststep; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		--$i;
+		$this->img->current_color = $colors[$i];
+		for($j=0; $j< $steps; ++$j) {
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		
+		for($j=0; $j < $steps; ++$j, --$i) {
+		    $this->img->current_color = $colors[$i];				
+		    $this->img->Line($x,$yb,$x,$yt);	
+		    $x += $delta;
+		}				
+		break;
+
+	    case GRAD_WIDE_MIDHOR:
+		$diff = round(abs($yb-$yt));
+		$steps = floor(abs($diff)/3);
+		$firststep = $diff - 2*$steps ; 
+		$delta = $yb >= $yt? 1 : -1;
+		$this->GetColArray($from_color,$to_color,$firststep,$colors,$this->numcolors);
+		for($y=$yt, $i=0; $i < $firststep;  ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($xl,$y,$xr,$y);
+		    $y += $delta;
+		}
+		--$i;
+		$this->img->current_color = $colors[$i];
+		for($j=0; $j < $steps; ++$j) {
+		    $this->img->Line($xl,$y,$xr,$y);
+		    $y += $delta;
+		}
+		for($j=0; $j < $steps; ++$j, --$i) {
+		    $this->img->current_color = $colors[$i];				
+		    $this->img->Line($xl,$y,$xr,$y);
+		    $y += $delta;
+		}				
+		break;	    
+
+	    case GRAD_LEFT_REFLECTION: 
+		$steps1 = round(0.3*abs($xr-$xl));
+		$delta = $xr>=$xl ? 1 : -1;		
+
+		$from_color = $this->img->rgb->Color($from_color);
+		$adj = 1.4;
+		$m = ($adj-1.0)*(255-min(255,min($from_color[0],min($from_color[1],$from_color[2]))));
+		$from_color2 = array(min(255,$from_color[0]+$m), 
+				    min(255,$from_color[1]+$m), min(255,$from_color[2]+$m));		
+
+		$this->GetColArray($from_color2,$to_color,$steps1,$colors,$this->numcolors);
+		$n = count($colors);
+		for($x=$xl, $i=0; $i < $steps1 && $i < $n; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		$steps2 = max(1,round(0.08*abs($xr-$xl)));
+		$this->img->SetColor($to_color);
+		for($j=0; $j< $steps2; ++$j) {
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		$steps = abs($xr-$xl)-$steps1-$steps2;
+		$this->GetColArray($to_color,$from_color,$steps,$colors,$this->numcolors);   
+		$n = count($colors);
+		for($i=0; $i < $steps && $i < $n; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		break;
+
+	    case GRAD_RIGHT_REFLECTION: 
+		$steps1 = round(0.7*abs($xr-$xl));
+		$delta = $xr>=$xl ? 1 : -1;
+
+		$this->GetColArray($from_color,$to_color,$steps1,$colors,$this->numcolors);
+		$n = count($colors);
+		for($x=$xl, $i=0; $i < $steps1 && $i < $n; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		$steps2 = max(1,round(0.08*abs($xr-$xl)));
+		$this->img->SetColor($to_color);
+		for($j=0; $j< $steps2; ++$j) {
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+
+		$from_color = $this->img->rgb->Color($from_color);
+		$adj = 1.4;
+		$m = ($adj-1.0)*(255-min(255,min($from_color[0],min($from_color[1],$from_color[2]))));
+		$from_color = array(min(255,$from_color[0]+$m), 
+				    min(255,$from_color[1]+$m), min(255,$from_color[2]+$m));		
+
+		$steps = abs($xr-$xl)-$steps1-$steps2;
+		$this->GetColArray($to_color,$from_color,$steps,$colors,$this->numcolors);   
+		$n = count($colors);
+		for($i=0; $i < $steps && $i < $n; ++$i) {
+		    $this->img->current_color = $colors[$i];
+		    $this->img->Line($x,$yb,$x,$yt);
+		    $x += $delta;
+		}
+		break;
+
+	    case GRAD_CENTER: 
+		$steps = ceil(min(($yb-$yt)+1,($xr-$xl)+1)/2);	
+		$this->GetColArray($from_color,$to_color,$steps,$colors,$this->numcolors);
+		$dx = ($xr-$xl)/2;
+		$dy = ($yb-$yt)/2;
+		$x=$xl;$y=$yt;$x2=$xr;$y2=$yb;
+		$n = count($colors);
+		for($x=$xl, $i=0; $x < $xl+$dx && $y < $yt+$dy && $i < $n; ++$x, ++$y, --$x2, --$y2, ++$i) {
+		    $this->img->current_color = $colors[$i];			
+		    $this->img->Rectangle($x,$y,$x2,$y2);
+		}
+		$this->img->Line($x,$y,$x2,$y2);
+		break;
+		
+	    case GRAD_RAISED_PANEL:
+		// right to left 
+		$steps1 = $xr-$xl; 
+		$delta = $xr>=$xl ? 1 : -1; 
+		$this->GetColArray($to_color,$from_color,$steps1,$colors,$this->numcolors); 
+		$n = count($colors);
+		for($x=$xl, $i=0; $i < $steps1 && $i < $n; ++$i) { 
+		    $this->img->current_color = $colors[$i]; 
+		    $this->img->Line($x,$yb,$x,$yt); 
+		    $x += $delta; 
+		} 
+		
+		// left to right 
+		$xr -= 3; 
+		$xl += 3; 
+		$yb -= 3; 
+		$yt += 3; 
+		$steps2 = $xr-$xl; 
+		$delta = $xr>=$xl ? 1 : -1; 
+		for($x=$xl, $j=$steps2; $j >= 0; --$j) { 
+		    $this->img->current_color = $colors[$j]; 
+		    $this->img->Line($x,$yb,$x,$yt); 
+		    $x += $delta; 
+		} 
+		break;
+
+	    default:
+		JpGraphError::RaiseL(7001,$style);
+//("Unknown gradient style (=$style).");
+		break;
+	}
+    }
+
+    // Fill a special case of a polygon with a flat bottom
+    // with a gradient. Can be used for filled line plots.
+    // Please note that this is NOT a generic gradient polygon fill
+    // routine. It assumes that the bottom is flat (like a drawing
+    // of a mountain)
+    function FilledFlatPolygon($pts,$from_color,$to_color) {
+	if( count($pts) == 0 ) return;
+	
+	$maxy=$pts[1];
+	$miny=$pts[1];		
+	$n = count($pts) ;
+	for( $i=0, $idx=0; $i < $n; $i += 2) {
+	    $x = round($pts[$i]);
+	    $y = round($pts[$i+1]);
+	    $miny = min($miny,$y);
+	    $maxy = max($maxy,$y);
+	}
+	    
+	$colors = array();
+	$this->GetColArray($from_color,$to_color,abs($maxy-$miny)+1,$colors,$this->numcolors);
+	for($i=$miny, $idx=0; $i <= $maxy; ++$i ) {
+	    $colmap[$i] = $colors[$idx++]; 
+	}
+
+	$n = count($pts)/2 ;
+	$idx = 0 ;
+	while( $idx < $n-1 ) {
+	    $p1 = array(round($pts[$idx*2]),round($pts[$idx*2+1]));
+	    $p2 = array(round($pts[++$idx*2]),round($pts[$idx*2+1]));
+		
+	    // Find the largest rectangle we can fill
+	    $y = max($p1[1],$p2[1]) ;
+	    for($yy=$maxy; $yy > $y; --$yy) {
+		$this->img->current_color = $colmap[$yy];
+		$this->img->Line($p1[0],$yy,$p2[0]-1,$yy);
+	    }
+	    
+	    if( $p1[1] == $p2[1] ) continue; 
+
+	    // Fill the rest using lines (slow...)
+	    $slope = ($p2[0]-$p1[0])/($p1[1]-$p2[1]);
+	    $x1 = $p1[0];
+	    $x2 = $p2[0]; //-1;
+	    $start = $y;
+	    if( $p1[1] > $p2[1] ) {
+		while( $y >= $p2[1] ) {
+		    $x1=$slope*($start-$y)+$p1[0];
+		    $this->img->current_color = $colmap[$y];
+		    $this->img->Line($x1,$y,$x2,$y);
+		    --$y;
+		} 
+	    }
+	    else {
+		while( $y >= $p1[1] ) {
+		    $x2=$p2[0]+$slope*($start-$y);
+		    $this->img->current_color = $colmap[$y];
+		    $this->img->Line($x1,$y,$x2,$y);
+		    --$y;
+		} 
+	    }
+	}
+    }
+
+//---------------
+// PRIVATE METHODS	
+    // Add to the image color map the necessary colors to do the transition
+    // between the two colors using $numcolors intermediate colors
+    function GetColArray($from_color,$to_color,$arr_size,&$colors,$numcols=100) {
+	if( $arr_size==0 ) return;
+	// If color is given as text get it's corresponding r,g,b values
+	$from_color = $this->img->rgb->Color($from_color);
+	$to_color = $this->img->rgb->Color($to_color);
+		
+	$rdelta=($to_color[0]-$from_color[0])/$numcols;
+	$gdelta=($to_color[1]-$from_color[1])/$numcols;
+	$bdelta=($to_color[2]-$from_color[2])/$numcols;
+	$colorsperstep	= $numcols/$arr_size;
+	$prevcolnum	= -1;
+	$from_alpha = $from_color[3];
+	$to_alpha = $to_color[3];
+	$adelta = ( $to_alpha - $from_alpha ) / $numcols ;
+	for ($i=0; $i < $arr_size; ++$i) {
+	    $colnum = floor($colorsperstep*$i);
+	    if ( $colnum == $prevcolnum ) 
+		$colors[$i]	= $colidx;
+	    else {
+		$r = floor($from_color[0] + $colnum*$rdelta);
+		$g = floor($from_color[1] + $colnum*$gdelta);
+		$b = floor($from_color[2] + $colnum*$bdelta);
+		$alpha = $from_alpha + $colnum*$adelta;
+		$colidx = $this->img->rgb->Allocate(sprintf("#%02x%02x%02x",$r,$g,$b),$alpha);
+		$colors[$i] = $colidx;
+	    }
+	    $prevcolnum = $colnum;
+	}
+    }	
+} // Class
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_iconplot.php php-syslog-ng/html/includes/jpgraph/jpgraph_iconplot.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_iconplot.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_iconplot.php	2006-02-08 16:22:09.000000000 -0500
@@ -0,0 +1,190 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_ICONPLOT.PHP
+// Description:	PHP4 Graph Plotting library. Extension module.
+// Created: 	2004-02-18
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_iconplot.php 521 2006-02-08 21:22:09Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+
+//===================================================
+// CLASS IconPlot
+// Description: Make it possible to add a (small) image
+// to the graph
+//===================================================
+class IconPlot {
+    var $iHorAnchor='left',$iVertAnchor='top';
+    var $iX=0,$iY=0;
+    var $iFile='';
+    var $iScale=1.0,$iMix=100;
+    var $iAnchors = array('left','right','top','bottom','center');
+    var $iCountryFlag='',$iCountryStdSize=3;
+    var $iScalePosY=null,$iScalePosX=null;
+    var $iImgString='';
+
+    function IconPlot($aFile="",$aX=0,$aY=0,$aScale=1.0,$aMix=100) {
+	$this->iFile = $aFile;
+	$this->iX=$aX;
+	$this->iY=$aY;
+	$this->iScale= $aScale;
+	if( $aMix < 0 || $aMix > 100 ) {
+	    JpGraphError::RaiseL(8001); //('Mix value for icon must be between 0 and 100.');
+	}
+	$this->iMix = $aMix ;
+    }
+
+    function CreateFromString($aStr) {
+	$this->iImgString = $aStr;
+    }
+
+    function SetCountryFlag($aFlag,$aX=0,$aY=0,$aScale=1.0,$aMix=100,$aStdSize=3) {
+	$this->iCountryFlag = $aFlag;
+	$this->iX=$aX;
+	$this->iY=$aY;
+	$this->iScale= $aScale;
+	if( $aMix < 0 || $aMix > 100 ) {
+	    JpGraphError::RaiseL(8001);//'Mix value for icon must be between 0 and 100.');
+	}
+	$this->iMix = $aMix;
+	$this->iCountryStdSize = $aStdSize;
+    }
+
+    function SetPos($aX,$aY) {
+	$this->iX=$aX;
+	$this->iY=$aY;
+    }
+
+    function SetScalePos($aX,$aY) {
+	$this->iScalePosX = $aX;
+	$this->iScalePosY = $aY;
+    }
+
+    function SetScale($aScale) {
+	$this->iScale = $aScale;
+    }
+
+    function SetMix($aMix) {
+	if( $aMix < 0 || $aMix > 100 ) {
+	    JpGraphError::RaiseL(8001);//('Mix value for icon must be between 0 and 100.');
+	}
+	$this->iMix = $aMix ;
+    }
+
+    function SetAnchor($aXAnchor='left',$aYAnchor='center') {
+	if( !in_array($aXAnchor,$this->iAnchors) ||
+	    !in_array($aYAnchor,$this->iAnchors) ) {
+	    JpGraphError::RaiseL(8002);//("Anchor position for icons must be one of 'top', 'bottom', 'left', 'right' or 'center'");
+	}
+	$this->iHorAnchor=$aXAnchor;
+	$this->iVertAnchor=$aYAnchor;
+    }
+    
+    function PreStrokeAdjust($aGraph) {
+	// Nothing to do ...
+    }
+
+    function DoLegend($aGraph) {
+	// Nothing to do ...
+    }
+
+    function Max() {
+	return array(false,false);
+    }
+
+
+    // The next four function are framework function tht gets called
+    // from Gantt and is not menaiungfull in the context of Icons but
+    // they must be implemented to avoid errors.
+    function GetMaxDate() { return false;   }
+    function GetMinDate() { return false;   }
+    function GetLineNbr() { return 0;   }
+    function GetAbsHeight() {return 0;  }
+
+
+    function Min() {
+	return array(false,false);
+    }
+
+    function StrokeMargin(&$aImg) {
+	return true;
+    }
+
+    function Stroke(&$aImg,$axscale,$ayscale) {
+	$this->StrokeWithScale($aImg,$axscale,$ayscale);
+    }
+
+    function StrokeWithScale(&$aImg,$axscale,$ayscale) {
+	if( $this->iScalePosX === null ||
+	    $this->iScalePosY === null ) {
+	    $this->_Stroke($aImg);
+	}
+	else {
+	    $this->_Stroke($aImg,
+			  round($axscale->Translate($this->iScalePosX)),
+			  round($ayscale->Translate($this->iScalePosY)));
+	}
+    }
+
+    function GetWidthHeight() {
+	$dummy=0;
+	return $this->_Stroke($dummy,null,null,true);
+    }
+
+    function _Stroke(&$aImg,$x=null,$y=null,$aReturnWidthHeight=false) {
+	if( $this->iFile != '' && $this->iCountryFlag != '' ) {
+	    JpGraphError::RaiseL(8003);//('It is not possible to specify both an image file and a country flag for the same icon.');	
+	}
+	if( $this->iFile != '' ) {
+	    $gdimg = Graph::LoadBkgImage('',$this->iFile);
+	}
+	elseif( $this->iImgString != '') {
+	    $gdimg = Image::CreateFromString($this->iImgString);
+	}
+	else {
+	    if( ! class_exists('FlagImages') ) {
+		JpGraphError::RaiseL(8004);//('In order to use Country flags as icons you must include the "jpgraph_flags.php" file.');
+	    }
+	    $fobj = new FlagImages($this->iCountryStdSize);
+	    $dummy='';
+	    $gdimg = $fobj->GetImgByName($this->iCountryFlag,$dummy);
+	}
+
+	$iconw = imagesx($gdimg);
+	$iconh = imagesy($gdimg);
+	
+	if( $aReturnWidthHeight ) {
+	    return array(round($iconw*$this->iScale),round($iconh*$this->iScale));
+	}
+
+	if( $x !== null && $y !== null ) {
+	    $this->iX = $x; $this->iY = $y;
+	}
+	if( $this->iX >= 0  && $this->iX <= 1.0 ) {
+	    $w = imagesx($aImg->img);
+	    $this->iX = round($w*$this->iX);
+	}
+	if( $this->iY >= 0  && $this->iY <= 1.0 ) {
+	    $h = imagesy($aImg->img);
+	    $this->iY = round($h*$this->iY);
+	}
+
+	if( $this->iHorAnchor == 'center' ) 
+	    $this->iX -= round($iconw*$this->iScale/2);
+	if( $this->iHorAnchor == 'right' ) 
+	    $this->iX -= round($iconw*$this->iScale);
+	if( $this->iVertAnchor == 'center' ) 
+	    $this->iY -= round($iconh*$this->iScale/2);
+	if( $this->iVertAnchor == 'bottom' ) 
+	    $this->iY -= round($iconh*$this->iScale);
+
+	$aImg->CopyMerge($gdimg,$this->iX,$this->iY,0,0,
+			 round($iconw*$this->iScale),round($iconh*$this->iScale),
+			 $iconw,$iconh,
+			 $this->iMix);
+    }
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_imgtrans.php php-syslog-ng/html/includes/jpgraph/jpgraph_imgtrans.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_imgtrans.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_imgtrans.php	2006-02-04 07:16:42.000000000 -0500
@@ -0,0 +1,224 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_IMGTRANS.PHP
+// Description:	Extension for JpGraph to do some simple img transformations
+// Created: 	2003-09-06
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_imgtrans.php 477 2006-02-04 12:16:42Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+//------------------------------------------------------------------------
+// Class ImgTrans
+// Perform some simple image transformations. 
+//------------------------------------------------------------------------
+class ImgTrans {
+    var $gdImg=null;
+
+    function ImgTrans($aGdImg) {
+	// Constructor
+	$this->gdImg = $aGdImg;
+    }
+
+    // --------------------------------------------------------------------
+    // _TransVert3D() and _TransHor3D() are helper methods to 
+    // Skew3D(). 
+    // --------------------------------------------------------------------
+    function _TransVert3D($aGdImg,$aHorizon=100,$aSkewDist=120,$aDir=SKEW3D_DOWN,$aMinSize=true,$aFillColor='#FFFFFF',$aQuality=false,$aBorder=false,$aHorizonPos=0.5) {
+
+
+	// Parameter check
+	if( $aHorizonPos < 0 || $aHorizonPos > 1.0 ) {
+	    JpGraphError::RaiseL(9001);
+//("Value for image transformation out of bounds.\nVanishing point on horizon must be specified as a value between 0 and 1.");
+	}
+
+	$w = imagesx($aGdImg);
+	$h = imagesy($aGdImg);
+
+	// Create new image
+	$ww = $w;
+	if( $aMinSize ) 
+	    $hh = ceil($h * $aHorizon / ($aSkewDist+$h));
+	else 
+	    $hh = $h;
+	
+	$newgdh = imagecreatetruecolor($ww,$hh);
+	$crgb = new RGB( $newgdh );
+	$fillColor = $crgb->Allocate($aFillColor);
+	imagefilledrectangle($newgdh,0,0,$ww-1,$hh-1,$fillColor);
+
+	if( $aBorder ) {
+	    $colidx = $crgb->Allocate($aBorder);
+	    imagerectangle($newgdh,0,0,$ww-1,$hh-1,$colidx);
+	}
+
+	$mid = round($w * $aHorizonPos);
+    
+	$last=$h;
+	for($y=0; $y < $h; ++$y) {	
+
+	    $yp = $h-$y-1;
+	    $yt = floor($yp * $aHorizon / ($aSkewDist + $yp));	    
+
+	    if( !$aQuality ) {
+		if( $last <= $yt ) continue ;
+		$last = $yt;
+	    }
+
+	    for($x=0; $x < $w; ++$x) {	    
+		$xt = ($x-$mid) * $aSkewDist / ($aSkewDist + $yp);
+		if( $aDir == SKEW3D_UP ) 
+		    $rgb = imagecolorat($aGdImg,$x,$h-$y-1);
+		else
+		    $rgb = imagecolorat($aGdImg,$x,$y);
+		$r = ($rgb >> 16) & 0xFF;
+		$g = ($rgb >> 8) & 0xFF;
+		$b = $rgb & 0xFF;    
+		$colidx = imagecolorallocate($newgdh,$r,$g,$b);	
+		$xt = round($xt+$mid);
+		if( $aDir == SKEW3D_UP ) {
+		    $syt = $yt;
+		}
+		else {
+		    $syt = $hh-$yt-1;
+		}
+
+		if( !empty($set[$yt]) ) {
+		    $nrgb = imagecolorat($newgdh,$xt,$syt);
+		    $nr = ($nrgb >> 16) & 0xFF;
+		    $ng = ($nrgb >> 8) & 0xFF;
+		    $nb = $nrgb & 0xFF;    
+		    $colidx = imagecolorallocate($newgdh,floor(($r+$nr)/2),
+						 floor(($g+$ng)/2),floor(($b+$nb)/2));	
+		}	
+
+		imagesetpixel($newgdh,$xt,$syt,$colidx);	
+	    }
+
+	    $set[$yt] = true;	
+	}
+
+	return $newgdh;
+    }
+
+    // --------------------------------------------------------------------
+    // _TransVert3D() and _TransHor3D() are helper methods to 
+    // Skew3D(). 
+    // --------------------------------------------------------------------
+    function _TransHor3D($aGdImg,$aHorizon=100,$aSkewDist=120,$aDir=SKEW3D_LEFT,$aMinSize=true,$aFillColor='#FFFFFF',$aQuality=false,$aBorder=false,$aHorizonPos=0.5) {
+
+	$w = imagesx($aGdImg);
+	$h = imagesy($aGdImg);
+
+	// Create new image
+	$hh = $h;
+	if( $aMinSize ) 
+	    $ww = ceil($w * $aHorizon / ($aSkewDist+$w));
+	else 
+	    $ww = $w;
+	
+	$newgdh = imagecreatetruecolor($ww,$hh);
+	$crgb = new RGB( $newgdh );
+	$fillColor = $crgb->Allocate($aFillColor);
+	imagefilledrectangle($newgdh,0,0,$ww-1,$hh-1,$fillColor);
+
+	if( $aBorder ) {
+	    $colidx = $crgb->Allocate($aBorder);
+	    imagerectangle($newgdh,0,0,$ww-1,$hh-1,$colidx);
+	}
+
+	$mid = round($h * $aHorizonPos);
+
+	$last = -1; 
+	for($x=0; $x < $w-1; ++$x) {	    
+	    $xt = floor($x * $aHorizon / ($aSkewDist + $x));
+	    if( !$aQuality ) {
+		if( $last >= $xt ) continue ;
+		$last = $xt;
+	    }
+
+	    for($y=0; $y < $h; ++$y) {	
+		$yp = $h-$y-1;
+		$yt = ($yp-$mid) * $aSkewDist / ($aSkewDist + $x);
+
+		if( $aDir == SKEW3D_RIGHT ) 
+		    $rgb = imagecolorat($aGdImg,$w-$x-1,$y);
+		else
+		    $rgb = imagecolorat($aGdImg,$x,$y);
+		$r = ($rgb >> 16) & 0xFF;
+		$g = ($rgb >> 8) & 0xFF;
+		$b = $rgb & 0xFF;    
+		$colidx = imagecolorallocate($newgdh,$r,$g,$b);	
+		$yt = floor($hh-$yt-$mid-1);
+		if( $aDir == SKEW3D_RIGHT ) {
+		    $sxt = $ww-$xt-1;
+		}
+		else
+		    $sxt = $xt ;
+
+		if( !empty($set[$xt]) ) {
+		    $nrgb = imagecolorat($newgdh,$sxt,$yt);
+		    $nr = ($nrgb >> 16) & 0xFF;
+		    $ng = ($nrgb >> 8) & 0xFF;
+		    $nb = $nrgb & 0xFF;    
+		    $colidx = imagecolorallocate($newgdh,floor(($r+$nr)/2),
+						 floor(($g+$ng)/2),floor(($b+$nb)/2));	
+		}
+		imagesetpixel($newgdh,$sxt,$yt,$colidx);	
+	    }
+
+	    $set[$xt] = true;
+	}
+
+	return $newgdh;
+    }
+
+    // --------------------------------------------------------------------
+    // Skew image for the apperance of a 3D effect
+    // This transforms an image into a 3D-skewed version
+    // of the image. The transformation is specified by giving the height
+    // of the artificial horizon and specifying a "skew" factor which
+    // is the distance on the horizon line between the point of 
+    // convergence and perspective line.
+    //
+    // The function returns the GD handle of the transformed image
+    // leaving the original image untouched.
+    //
+    // Parameters:
+    // * $aGdImg, GD handle to the image to be transformed
+    // * $aHorizon, Distance to the horizon 
+    // * $aSkewDist, Distance from the horizon point of convergence
+    //   on the horizon line to the perspective points. A larger 
+    //   value will fore-shorten the image more
+    // * $aDir, parameter specifies type of convergence. This of this 
+    //   as the walls in a room you are looking at. This specifies if the
+    //   image should be applied on the left,right,top or bottom walls.
+    // * $aMinSize, true=make the new image just as big as needed,
+    //   false = keep the image the same size as the original image
+    // * $aFillColor, Background fill color in the image
+    // * $aHiQuality, true=performa some interpolation that improves
+    //   the image quality but at the expense of performace. Enabling
+    //   high quality will have a dramatic effect on the time it takes
+    //   to transform an image.
+    // * $aBorder, if set to anything besides false this will draw a 
+    //   a border of the speciied color around the image
+    // --------------------------------------------------------------------
+    function Skew3D($aHorizon=120,$aSkewDist=150,$aDir=SKEW3D_DOWN,$aHiQuality=false,$aMinSize=true,$aFillColor='#FFFFFF',$aBorder=false) {
+	return $this->_Skew3D($this->gdImg,$aHorizon,$aSkewDist,$aDir,$aHiQuality,
+			      $aMinSize,$aFillColor,$aBorder);
+    }
+
+    function _Skew3D($aGdImg,$aHorizon=120,$aSkewDist=150,$aDir=SKEW3D_DOWN,$aHiQuality=false,$aMinSize=true,$aFillColor='#FFFFFF',$aBorder=false) {
+	if( $aDir == SKEW3D_DOWN || $aDir == SKEW3D_UP )
+	    return $this->_TransVert3D($aGdImg,$aHorizon,$aSkewDist,$aDir,$aMinSize,$aFillColor,$aHiQuality,$aBorder);
+	else
+	    return $this->_TransHor3D($aGdImg,$aHorizon,$aSkewDist,$aDir,$aMinSize,$aFillColor,$aHiQuality,$aBorder);
+
+    }
+    
+}
+
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_line.php php-syslog-ng/html/includes/jpgraph/jpgraph_line.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_line.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_line.php	2006-02-04 07:01:03.000000000 -0500
@@ -0,0 +1,625 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_LINE.PHP
+// Description:	Line plot extension for JpGraph
+// Created: 	2001-01-08
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_line.php 455 2006-02-04 12:01:03Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+require_once ('jpgraph_plotmark.inc');
+
+// constants for the (filled) area
+DEFINE("LP_AREA_FILLED", true);
+DEFINE("LP_AREA_NOT_FILLED", false);
+DEFINE("LP_AREA_BORDER",false);
+DEFINE("LP_AREA_NO_BORDER",true);
+
+//===================================================
+// CLASS LinePlot
+// Description: 
+//===================================================
+class LinePlot extends Plot{
+    var $filled=false;
+    var $fill_color='blue';
+    var $mark=null;
+    var $step_style=false, $center=false;
+    var $line_style=1;	// Default to solid
+    var $filledAreas = array(); // array of arrays(with min,max,col,filled in them)
+    var $barcenter=false;  // When we mix line and bar. Should we center the line in the bar.
+    var $fillFromMin = false ;
+    var $fillgrad=false,$fillgrad_fromcolor='navy',$fillgrad_tocolor='silver',$fillgrad_numcolors=100;
+    var $iFastStroke=false;
+
+//---------------
+// CONSTRUCTOR
+    function LinePlot(&$datay,$datax=false) {
+	$this->Plot($datay,$datax);
+	$this->mark = new PlotMark();
+    }
+//---------------
+// PUBLIC METHODS	
+
+    // Set style, filled or open
+    function SetFilled($aFlag=true) {
+    	JpGraphError::RaiseL(10001);//('LinePlot::SetFilled() is deprecated. Use SetFillColor()');
+    }
+	
+    function SetBarCenter($aFlag=true) {
+	$this->barcenter=$aFlag;
+    }
+
+    function SetStyle($aStyle) {
+	$this->line_style=$aStyle;
+    }
+	
+    function SetStepStyle($aFlag=true) {
+	$this->step_style = $aFlag;
+    }
+	
+    function SetColor($aColor) {
+	parent::SetColor($aColor);
+    }
+	
+    function SetFillFromYMin($f=true) {
+	$this->fillFromMin = $f ;
+    }
+    
+    function SetFillColor($aColor,$aFilled=true) {
+	$this->fill_color=$aColor;
+	$this->filled=$aFilled;
+    }
+
+    function SetFillGradient($aFromColor,$aToColor,$aNumColors=100,$aFilled=true) {
+	$this->fillgrad_fromcolor = $aFromColor;
+	$this->fillgrad_tocolor   = $aToColor;
+	$this->fillgrad_numcolors = $aNumColors;
+	$this->filled = $aFilled;
+	$this->fillgrad = true;
+    }
+	
+    function Legend(&$graph) {
+	if( $this->legend!="" ) {
+	    if( $this->filled && !$this->fillgrad ) {
+		$graph->legend->Add($this->legend,
+				    $this->fill_color,$this->mark,0,
+				    $this->legendcsimtarget,$this->legendcsimalt);
+	    } 
+	    elseif( $this->fillgrad ) {
+		$color=array($this->fillgrad_fromcolor,$this->fillgrad_tocolor);
+		// In order to differentiate between gradients and cooors specified as an RGB triple
+		$graph->legend->Add($this->legend,$color,"",-2 /* -GRAD_HOR */,
+				    $this->legendcsimtarget,$this->legendcsimalt);
+	    }	
+	    else {
+		$graph->legend->Add($this->legend,
+				    $this->color,$this->mark,$this->line_style,
+				    $this->legendcsimtarget,$this->legendcsimalt);
+	    }
+	}	
+    }
+
+    function AddArea($aMin=0,$aMax=0,$aFilled=LP_AREA_NOT_FILLED,$aColor="gray9",$aBorder=LP_AREA_BORDER) {
+	if($aMin > $aMax) {
+	    // swap
+	    $tmp = $aMin;
+	    $aMin = $aMax;
+	    $aMax = $tmp;
+	} 
+	$this->filledAreas[] = array($aMin,$aMax,$aColor,$aFilled,$aBorder);
+    }
+	
+    // Gets called before any axis are stroked
+    function PreStrokeAdjust(&$graph) {
+
+	// If another plot type have already adjusted the
+	// offset we don't touch it.
+	// (We check for empty in case the scale is  a log scale 
+	// and hence doesn't contain any xlabel_offset)
+	if( empty($graph->xaxis->scale->ticks->xlabel_offset) ||
+	    $graph->xaxis->scale->ticks->xlabel_offset == 0 ) {
+	    if( $this->center ) {
+		++$this->numpoints;
+		$a=0.5; $b=0.5;
+	    } else {
+		$a=0; $b=0;
+	    }
+	    $graph->xaxis->scale->ticks->SetXLabelOffset($a);
+	    $graph->SetTextScaleOff($b);						
+	    //$graph->xaxis->scale->ticks->SupressMinorTickMarks();
+	}
+    }
+
+    function SetFastStroke($aFlg=true) {
+	$this->iFastStroke = $aFlg;
+    }
+
+    function FastStroke(&$img,&$xscale,&$yscale,$aStartPoint=0,$exist_x=true) {
+	// An optimized stroke for many data points with no extra 
+	// features but 60% faster. You can't have values or line styles, or null
+	// values in plots.
+	$numpoints=count($this->coords[0]);
+	if( $this->barcenter ) 
+	    $textadj = 0.5-$xscale->text_scale_off;
+	else
+	    $textadj = 0;
+
+	$img->SetColor($this->color);
+	$img->SetLineWeight($this->weight);
+	$pnts=$aStartPoint;
+	while( $pnts < $numpoints ) {	    
+	    if( $exist_x ) $x=$this->coords[1][$pnts];
+	    else $x=$pnts+$textadj;
+	    $xt = $xscale->Translate($x);
+	    $y=$this->coords[0][$pnts];
+	    $yt = $yscale->Translate($y);    
+	    if( is_numeric($y) ) {
+		$cord[] = $xt;
+		$cord[] = $yt;
+	    }
+	    elseif( $y == '-' && $pnts > 0 ) {
+		// Just ignore
+	    }
+	    else {
+		JpGraphError::RaiseL(10002);//('Plot too complicated for fast line Stroke. Use standard Stroke()');
+		return;
+	    }
+	    ++$pnts;
+	} // WHILE
+
+	$img->Polygon($cord,false,true);
+
+    }
+	
+    function Stroke(&$img,&$xscale,&$yscale) {
+	$idx=0;
+	$numpoints=count($this->coords[0]);
+	if( isset($this->coords[1]) ) {
+	    if( count($this->coords[1])!=$numpoints )
+		JpGraphError::RaiseL(2003,count($this->coords[1]),$numpoints);
+//("Number of X and Y points are not equal. Number of X-points:".count($this->coords[1])." Number of Y-points:$numpoints");
+	    else
+		$exist_x = true;
+	}
+	else 
+	    $exist_x = false;
+
+	if( $this->barcenter ) 
+	    $textadj = 0.5-$xscale->text_scale_off;
+	else
+	    $textadj = 0;
+
+	// Find the first numeric data point
+	$startpoint=0;
+	while( $startpoint < $numpoints && !is_numeric($this->coords[0][$startpoint]) )
+	    ++$startpoint;
+
+	// Bail out if no data points
+	if( $startpoint == $numpoints ) 
+	    return;
+
+	if( $this->iFastStroke ) {
+	    $this->FastStroke($img,$xscale,$yscale,$startpoint,$exist_x);
+	    return;
+	}
+
+	if( $exist_x )
+	    $xs=$this->coords[1][$startpoint];
+	else
+	    $xs= $textadj+$startpoint;
+
+	$img->SetStartPoint($xscale->Translate($xs),
+			    $yscale->Translate($this->coords[0][$startpoint]));
+
+	if( $this->filled ) {
+	    $min = $yscale->GetMinVal();
+	    if( $min > 0 || $this->fillFromMin )
+		$fillmin = $yscale->scale_abs[0];//Translate($min);
+	    else
+		$fillmin = $yscale->Translate(0);
+
+	    $cord[$idx++] = $xscale->Translate($xs);
+	    $cord[$idx++] = $fillmin;
+	}
+	$xt = $xscale->Translate($xs);
+	$yt = $yscale->Translate($this->coords[0][$startpoint]);
+	$cord[$idx++] = $xt;
+	$cord[$idx++] = $yt;
+	$yt_old = $yt;
+	$xt_old = $xt;
+	$y_old = $this->coords[0][$startpoint];
+
+	$this->value->Stroke($img,$this->coords[0][$startpoint],$xt,$yt);
+
+	$img->SetColor($this->color);
+	$img->SetLineWeight($this->weight);
+	$img->SetLineStyle($this->line_style);
+	$pnts=$startpoint+1;
+	$firstnonumeric = false;
+	while( $pnts < $numpoints ) {
+	    
+	    if( $exist_x ) $x=$this->coords[1][$pnts];
+	    else $x=$pnts+$textadj;
+	    $xt = $xscale->Translate($x);
+	    $yt = $yscale->Translate($this->coords[0][$pnts]);
+	    
+	    $y=$this->coords[0][$pnts];
+	    if( $this->step_style ) {
+		// To handle null values within step style we need to record the
+		// first non numeric value so we know from where to start if the
+		// non value is '-'. 
+		if( is_numeric($y) ) {
+		    $firstnonumeric = false;
+		    if( is_numeric($y_old) ) {
+			$img->StyleLine($xt_old,$yt_old,$xt,$yt_old);
+			$img->StyleLine($xt,$yt_old,$xt,$yt);
+		    }
+		    elseif( $y_old == '-' ) {
+			$img->StyleLine($xt_first,$yt_first,$xt,$yt_first);
+			$img->StyleLine($xt,$yt_first,$xt,$yt);			
+		    }
+		    else {
+			$yt_old = $yt;
+			$xt_old = $xt;
+		    }
+		    $cord[$idx++] = $xt;
+		    $cord[$idx++] = $yt_old;
+		    $cord[$idx++] = $xt;
+		    $cord[$idx++] = $yt;
+		}
+		elseif( $firstnonumeric==false ) {
+		    $firstnonumeric = true;
+		    $yt_first = $yt_old;
+		    $xt_first = $xt_old;
+		}
+	    }
+	    else {
+		$tmp1=$y;
+		$prev=$this->coords[0][$pnts-1]; 		 			
+		if( $tmp1==='' || $tmp1===NULL || $tmp1==='X' ) $tmp1 = 'x';
+		if( $prev==='' || $prev===null || $prev==='X' ) $prev = 'x';
+
+		if( is_numeric($y) || (is_string($y) && $y != '-') ) {
+		    if( is_numeric($y) && (is_numeric($prev) || $prev === '-' ) ) { 
+			$img->StyleLineTo($xt,$yt);
+		    } 
+		    else {
+			$img->SetStartPoint($xt,$yt);
+		    }
+		}
+		if( $this->filled && $tmp1 !== '-' ) {
+		    if( $tmp1 === 'x' ) { 
+			$cord[$idx++] = $cord[$idx-3];
+			$cord[$idx++] = $fillmin;
+		    }
+		    elseif( $prev === 'x' ) {
+			$cord[$idx++] = $xt;
+			$cord[$idx++] = $fillmin;
+			$cord[$idx++] = $xt;
+			$cord[$idx++] = $yt; 			    
+		    }
+		    else {
+			$cord[$idx++] = $xt;
+			$cord[$idx++] = $yt;
+		    }
+		}
+		else {
+		    if( is_numeric($tmp1)  && (is_numeric($prev) || $prev === '-' ) ) {
+			$cord[$idx++] = $xt;
+			$cord[$idx++] = $yt;
+		    } 
+		}
+	    }
+	    $yt_old = $yt;
+	    $xt_old = $xt;
+	    $y_old = $y;
+
+	    $this->StrokeDataValue($img,$this->coords[0][$pnts],$xt,$yt);
+
+	    ++$pnts;
+	}	
+
+	if( $this->filled  ) {
+	    $cord[$idx++] = $xt;
+	    if( $min > 0 || $this->fillFromMin )
+		$cord[$idx++] = $yscale->Translate($min);
+	    else
+		$cord[$idx++] = $yscale->Translate(0);
+	    if( $this->fillgrad ) {
+		$img->SetLineWeight(1);
+		$grad = new Gradient($img);
+		$grad->SetNumColors($this->fillgrad_numcolors);
+		$grad->FilledFlatPolygon($cord,$this->fillgrad_fromcolor,$this->fillgrad_tocolor);
+		$img->SetLineWeight($this->weight);
+	    }
+	    else {
+		$img->SetColor($this->fill_color);	
+		$img->FilledPolygon($cord);
+	    }
+	    if( $this->line_weight > 0 ) {
+		$img->SetColor($this->color);
+		$img->Polygon($cord);
+	    }
+	}
+
+	if(!empty($this->filledAreas)) {
+
+	    $minY = $yscale->Translate($yscale->GetMinVal());
+	    $factor = ($this->step_style ? 4 : 2);
+
+	    for($i = 0; $i < sizeof($this->filledAreas); ++$i) {
+		// go through all filled area elements ordered by insertion
+		// fill polygon array
+		$areaCoords[] = $cord[$this->filledAreas[$i][0] * $factor];
+		$areaCoords[] = $minY;
+
+		$areaCoords =
+		    array_merge($areaCoords,
+				array_slice($cord,
+					    $this->filledAreas[$i][0] * $factor,
+					    ($this->filledAreas[$i][1] - $this->filledAreas[$i][0] + ($this->step_style ? 0 : 1))  * $factor));
+		$areaCoords[] = $areaCoords[sizeof($areaCoords)-2]; // last x
+		$areaCoords[] = $minY; // last y
+	    
+		if($this->filledAreas[$i][3]) {
+		    $img->SetColor($this->filledAreas[$i][2]);
+		    $img->FilledPolygon($areaCoords);
+		    $img->SetColor($this->color);
+		}
+		// Check if we should draw the frame.
+		// If not we still re-draw the line since it might have been
+		// partially overwritten by the filled area and it doesn't look
+		// very good.
+		// TODO: The behaviour is undefined if the line does not have
+		// any line at the position of the area.
+		if( $this->filledAreas[$i][4] )
+		    $img->Polygon($areaCoords);
+		else
+	    	    $img->Polygon($cord);
+
+		$areaCoords = array();
+	    }
+	}	
+
+	if( $this->mark->type == -1 || $this->mark->show == false )
+	    return;
+
+	for( $pnts=0; $pnts<$numpoints; ++$pnts) {
+
+	    if( $exist_x ) $x=$this->coords[1][$pnts];
+	    else $x=$pnts+$textadj;
+	    $xt = $xscale->Translate($x);
+	    $yt = $yscale->Translate($this->coords[0][$pnts]);
+
+	    if( is_numeric($this->coords[0][$pnts]) ) {
+		if( !empty($this->csimtargets[$pnts]) ) {
+		    $this->mark->SetCSIMTarget($this->csimtargets[$pnts]);
+		    $this->mark->SetCSIMAlt($this->csimalts[$pnts]);
+		}
+		if( $exist_x )
+		    $x=$this->coords[1][$pnts];
+		else
+		    $x=$pnts;
+		$this->mark->SetCSIMAltVal($this->coords[0][$pnts],$x);
+		$this->mark->Stroke($img,$xt,$yt);	
+		$this->csimareas .= $this->mark->GetCSIMAreas();
+		$this->StrokeDataValue($img,$this->coords[0][$pnts],$xt,$yt);
+	    }
+	}
+
+
+    }
+} // Class
+
+
+//===================================================
+// CLASS AccLinePlot
+// Description: 
+//===================================================
+class AccLinePlot extends Plot {
+    var $plots=null,$nbrplots=0,$numpoints=0;
+    var $iStartEndZero=true;
+//---------------
+// CONSTRUCTOR
+    function AccLinePlot($plots) {
+        $this->plots = $plots;
+	$this->nbrplots = count($plots);
+	$this->numpoints = $plots[0]->numpoints;
+
+	for($i=0; $i < $this->nbrplots; ++$i ) {
+	    $this->LineInterpolate($this->plots[$i]->coords[0]);
+	}	
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function Legend(&$graph) {
+	$n=count($this->plots);
+	for($i=0; $i < $n; ++$i )
+	    $this->plots[$i]->DoLegend($graph);
+    }
+	
+    function Max() {
+	list($xmax) = $this->plots[0]->Max();
+	$nmax=0;
+	$n = count($this->plots);
+	for($i=0; $i < $n; ++$i) {
+	    $nc = count($this->plots[$i]->coords[0]);
+	    $nmax = max($nmax,$nc);
+	    list($x) = $this->plots[$i]->Max();
+	    $xmax = Max($xmax,$x);
+	}
+	for( $i = 0; $i < $nmax; $i++ ) {
+	    // Get y-value for line $i by adding the
+	    // individual bars from all the plots added.
+	    // It would be wrong to just add the
+	    // individual plots max y-value since that
+	    // would in most cases give to large y-value.
+	    $y=$this->plots[0]->coords[0][$i];
+	    for( $j = 1; $j < $this->nbrplots; $j++ ) {
+		$y += $this->plots[ $j ]->coords[0][$i];
+	    }
+	    $ymax[$i] = $y;
+	}
+	$ymax = max($ymax);
+	return array($xmax,$ymax);
+    }	
+
+    function Min() {
+	$nmax=0;
+	list($xmin,$ysetmin) = $this->plots[0]->Min();
+	$n = count($this->plots);
+	for($i=0; $i < $n; ++$i) {
+	    $nc = count($this->plots[$i]->coords[0]);
+	    $nmax = max($nmax,$nc);
+	    list($x,$y) = $this->plots[$i]->Min();
+	    $xmin = Min($xmin,$x);
+	    $ysetmin = Min($y,$ysetmin);
+	}
+	for( $i = 0; $i < $nmax; $i++ ) {
+	    // Get y-value for line $i by adding the
+	    // individual bars from all the plots added.
+	    // It would be wrong to just add the
+	    // individual plots min y-value since that
+	    // would in most cases give to small y-value.
+	    $y=$this->plots[0]->coords[0][$i];
+	    for( $j = 1; $j < $this->nbrplots; $j++ ) {
+		$y += $this->plots[ $j ]->coords[0][$i];
+	    }
+	    $ymin[$i] = $y;
+	}
+	$ymin = Min($ysetmin,Min($ymin));
+	return array($xmin,$ymin);
+    }
+
+    // Gets called before any axis are stroked
+    function PreStrokeAdjust(&$graph) {
+
+	// If another plot type have already adjusted the
+	// offset we don't touch it.
+	// (We check for empty in case the scale is  a log scale 
+	// and hence doesn't contain any xlabel_offset)
+	
+	if( empty($graph->xaxis->scale->ticks->xlabel_offset) ||
+	    $graph->xaxis->scale->ticks->xlabel_offset == 0 ) {
+	    if( $this->center ) {
+		++$this->numpoints;
+		$a=0.5; $b=0.5;
+	    } else {
+		$a=0; $b=0;
+	    }
+	    $graph->xaxis->scale->ticks->SetXLabelOffset($a);
+	    $graph->SetTextScaleOff($b);						
+	    $graph->xaxis->scale->ticks->SupressMinorTickMarks();
+	}
+	
+    }
+
+    function SetInterpolateMode($aIntMode) {
+	$this->iStartEndZero=$aIntMode;
+    }
+
+    // Replace all '-' with an interpolated value. We use straightforward
+    // linear interpolation. If the data starts with one or several '-' they
+    // will be replaced by the the first valid data point
+    function LineInterpolate(&$aData) {
+
+	$n=count($aData);
+	$i=0;
+    
+	// If first point is undefined we will set it to the same as the first 
+	// valid data
+	if( $aData[$i]==='-' ) {
+	    // Find the first valid data
+	    while( $i < $n && $aData[$i]==='-' ) {
+		++$i;
+	    }
+	    if( $i < $n ) {
+		for($j=0; $j < $i; ++$j ) {
+		    if( $this->iStartEndZero )
+			$aData[$i] = 0;
+		    else
+			$aData[$j] = $aData[$i];
+		}
+	    }
+	    else {
+		// All '-' => Error
+		return false;
+	    }
+	}
+
+	while($i < $n) {
+	    while( $i < $n && $aData[$i] !== '-' ) {
+		++$i;
+	    }
+	    if( $i < $n ) {
+		$pstart=$i-1;
+
+		// Now see how long this segment of '-' are
+		while( $i < $n && $aData[$i] === '-' )
+		    ++$i;
+		if( $i < $n ) {
+		    $pend=$i;
+		    $size=$pend-$pstart;
+		    $k=($aData[$pend]-$aData[$pstart])/$size;
+		    // Replace the segment of '-' with a linear interpolated value.
+		    for($j=1; $j < $size; ++$j ) {
+			$aData[$pstart+$j] = $aData[$pstart] + $j*$k ;
+		    }
+		}
+		else {
+		    // There are no valid end point. The '-' goes all the way to the end
+		    // In that case we just set all the remaining values the the same as the
+		    // last valid data point.
+		    for( $j=$pstart+1; $j < $n; ++$j ) 
+			if( $this->iStartEndZero )
+			    $aData[$j] = 0;
+			else
+			    $aData[$j] = $aData[$pstart] ;		
+		}
+	    }
+	}
+	return true;
+    }
+
+
+
+    // To avoid duplicate of line drawing code here we just
+    // change the y-values for each plot and then restore it
+    // after we have made the stroke. We must do this copy since
+    // it wouldn't be possible to create an acc line plot
+    // with the same graphs, i.e AccLinePlot(array($pl,$pl,$pl));
+    // since this method would have a side effect.
+    function Stroke(&$img,&$xscale,&$yscale) {
+	$img->SetLineWeight($this->weight);
+	$this->numpoints = count($this->plots[0]->coords[0]);
+	// Allocate array
+	$coords[$this->nbrplots][$this->numpoints]=0;
+	for($i=0; $i<$this->numpoints; $i++) {
+	    $coords[0][$i]=$this->plots[0]->coords[0][$i]; 
+	    $accy=$coords[0][$i];
+	    for($j=1; $j<$this->nbrplots; ++$j ) {
+		$coords[$j][$i] = $this->plots[$j]->coords[0][$i]+$accy; 
+		$accy = $coords[$j][$i];
+	    }
+	}
+	for($j=$this->nbrplots-1; $j>=0; --$j) {
+	    $p=$this->plots[$j];
+	    for( $i=0; $i<$this->numpoints; ++$i) {
+		$tmp[$i]=$p->coords[0][$i];
+		$p->coords[0][$i]=$coords[$j][$i];
+	    }
+	    $p->Stroke($img,$xscale,$yscale);
+	    for( $i=0; $i<$this->numpoints; ++$i) 
+		$p->coords[0][$i]=$tmp[$i];
+	    $p->coords[0][]=$tmp;
+	}
+    }
+} // Class
+
+
+/* EOF */
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_log.php php-syslog-ng/html/includes/jpgraph/jpgraph_log.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_log.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_log.php	2006-02-04 07:17:35.000000000 -0500
@@ -0,0 +1,267 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_LOG.PHP
+// Description:	Log scale plot extension for JpGraph
+// Created: 	2001-01-08
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_log.php 479 2006-02-04 12:17:35Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+
+DEFINE('LOGLABELS_PLAIN',0);
+DEFINE('LOGLABELS_MAGNITUDE',1);
+
+//===================================================
+// CLASS LogScale
+// Description: Logarithmic scale between world and screen
+//===================================================
+class LogScale extends LinearScale {
+//---------------
+// CONSTRUCTOR
+
+    // Log scale is specified using the log of min and max
+    function LogScale($min,$max,$type="y") {
+	$this->LinearScale($min,$max,$type);
+	$this->ticks = new LogTicks();
+	$this->name = 'log';
+    }
+
+//----------------
+// PUBLIC METHODS	
+
+    // Translate between world and screen
+    function Translate($a) {
+	if( !is_numeric($a) ) {
+	    if( $a != '' && $a != '-' && $a != 'x' ) 
+		JpGraphError::RaiseL(11001);
+//('Your data contains non-numeric values.');
+	    return 1;
+	}
+	if( $a < 0 ) {
+	    JpGraphError::RaiseL(11002);
+//("Negative data values can not be used in a log scale.");
+	    exit(1);
+	}
+	if( $a==0 ) $a=1;
+	$a=log10($a);
+	return ceil($this->off + ($a*1.0 - $this->scale[0]) * $this->scale_factor); 
+    }
+
+    // Relative translate (don't include offset) usefull when we just want
+    // to know the relative position (in pixels) on the axis	
+    function RelTranslate($a) {
+	if( !is_numeric($a) ) {
+	    if( $a != '' && $a != '-' && $a != 'x' ) 
+		JpGraphError::RaiseL(11001);
+//('Your data contains non-numeric values.');
+	    return 1;
+	}
+	if( $a==0 ) $a=1;
+	$a=log10($a);
+	return round(($a*1.0 - $this->scale[0]) * $this->scale_factor); 
+    }
+		
+    // Use bcpow() for increased precision
+    function GetMinVal() {
+	if( function_exists("bcpow") )
+	    return round(bcpow(10,$this->scale[0],15),14);
+	else
+	    return round(pow(10,$this->scale[0]),14);
+    }
+	
+    function GetMaxVal() {
+	if( function_exists("bcpow") )
+	    return round(bcpow(10,$this->scale[1],15),14);
+	else
+	    return round(pow(10,$this->scale[1]),14);
+    }
+	
+    // Logarithmic autoscaling is much simplier since we just
+    // set the min and max to logs of the min and max values.
+    // Note that for log autoscale the "maxstep" the fourth argument
+    // isn't used. This is just included to give the method the same
+    // signature as the linear counterpart.
+    function AutoScale(&$img,$min,$max,$dummy) {
+	if( $min==0 ) $min=1;
+	
+	if( $max <= 0 ) {
+	    JpGraphError::RaiseL(11004);
+//('Scale error for logarithmic scale. You have a problem with your data values. The max value must be greater than 0. It is mathematically impossible to have 0 in a logarithmic scale.');
+	}
+	$smin = floor(log10($min));
+	$smax = ceil(log10($max));
+	$this->Update($img,$smin,$smax);					
+    }
+//---------------
+// PRIVATE METHODS	
+} // Class
+
+//===================================================
+// CLASS LogTicks
+// Description: 
+//===================================================
+class LogTicks extends Ticks{
+    var $label_logtype=LOGLABELS_MAGNITUDE;
+//---------------
+// CONSTRUCTOR
+    function LogTicks() {
+    }
+//---------------
+// PUBLIC METHODS	
+    function IsSpecified() {
+	return true;
+    }
+
+    function SetLabelLogType($aType) {
+	$this->label_logtype = $aType;
+    }
+	
+    // For log scale it's meaningless to speak about a major step
+    // We just return -1 to make the framework happy (specifically
+    // StrokeLabels() )
+    function GetMajor() {
+	return -1;
+    }
+
+    function SetTextLabelStart($aStart) {
+	JpGraphError::RaiseL(11005);
+//('Specifying tick interval for a logarithmic scale is undefined. Remove any calls to SetTextLabelStart() or SetTextTickInterval() on the logarithmic scale.');
+    }
+
+    function SetXLabelOffset($dummy) {
+	// For log scales we dont care about XLabel offset
+    }
+
+    // Draw ticks on image "img" using scale "scale". The axis absolute
+    // position in the image is specified in pos, i.e. for an x-axis
+    // it specifies the absolute y-coord and for Y-ticks it specified the
+    // absolute x-position.
+    function Stroke(&$img,&$scale,$pos) {
+	$start = $scale->GetMinVal();
+	$limit = $scale->GetMaxVal();
+	$nextMajor = 10*$start;
+	$step = $nextMajor / 10.0;
+		
+		
+	$img->SetLineWeight($this->weight);			
+		
+	if( $scale->type == "y" ) {
+	    // member direction specified if the ticks should be on
+	    // left or right side.
+	    $a=$pos + $this->direction*$this->GetMinTickAbsSize();
+	    $a2=$pos + $this->direction*$this->GetMajTickAbsSize();	
+			
+	    $count=1; 
+	    $this->maj_ticks_pos[0]=$scale->Translate($start);
+	    $this->maj_ticklabels_pos[0]=$scale->Translate($start);
+	    if( $this->supress_first )
+		$this->maj_ticks_label[0]="";
+	    else {
+		if( $this->label_formfunc != '' ) {
+		    $f = $this->label_formfunc;
+		    $this->maj_ticks_label[0]=call_user_func($f,$start);	
+		}
+		elseif( $this->label_logtype == LOGLABELS_PLAIN )
+		    $this->maj_ticks_label[0]=$start;	
+		else
+		    $this->maj_ticks_label[0]='10^'.round(log10($start));
+	    }
+	    $i=1;
+	    for($y=$start; $y<=$limit; $y+=$step,++$count  ) {
+		$ys=$scale->Translate($y);	
+		$this->ticks_pos[]=$ys;
+		$this->ticklabels_pos[]=$ys;
+		if( $count % 10 == 0 ) {
+		    if( !$this->supress_tickmarks ) {
+			if( $this->majcolor!="" ) {
+			    $img->PushColor($this->majcolor);
+			    $img->Line($pos,$ys,$a2,$ys);
+			    $img->PopColor();
+			}
+			else
+			    $img->Line($pos,$ys,$a2,$ys);
+		    }
+
+		    $this->maj_ticks_pos[$i]=$ys;
+		    $this->maj_ticklabels_pos[$i]=$ys;
+		    
+		    if( $this->label_formfunc != '' ) {
+			$f = $this->label_formfunc;
+			$this->maj_ticks_label[$i]=call_user_func($f,$nextMajor);	
+		    }
+		    elseif( $this->label_logtype == 0 )
+			$this->maj_ticks_label[$i]=$nextMajor;	
+		    else
+			$this->maj_ticks_label[$i]='10^'.round(log10($nextMajor));
+		    ++$i;						
+		    $nextMajor *= 10;
+		    $step *= 10;	
+		    $count=1; 				
+		}
+		else {
+		    if( !$this->supress_tickmarks && !$this->supress_minor_tickmarks) {
+			if( $this->mincolor!="" ) $img->PushColor($this->mincolor);
+			$img->Line($pos,$ys,$a,$ys);		
+			if( $this->mincolor!="" ) $img->PopColor();
+		    }
+		}
+	    }		
+	}
+	else {
+	    $a=$pos - $this->direction*$this->GetMinTickAbsSize();
+	    $a2=$pos - $this->direction*$this->GetMajTickAbsSize();	
+	    $count=1; 
+	    $this->maj_ticks_pos[0]=$scale->Translate($start);
+	    $this->maj_ticklabels_pos[0]=$scale->Translate($start);
+	    if( $this->supress_first )
+		$this->maj_ticks_label[0]="";
+	    else {
+		if( $this->label_formfunc != '' ) {
+		    $f = $this->label_formfunc;
+		    $this->maj_ticks_label[0]=call_user_func($f,$start);	
+		}
+		elseif( $this->label_logtype == 0 )
+		    $this->maj_ticks_label[0]=$start;	
+		else
+		    $this->maj_ticks_label[0]='10^'.round(log10($start));
+	    }
+	    $i=1;			
+	    for($x=$start; $x<=$limit; $x+=$step,++$count  ) {
+		$xs=$scale->Translate($x);	
+		$this->ticks_pos[]=$xs;
+		$this->ticklabels_pos[]=$xs;
+		if( $count % 10 == 0 ) {
+		    if( !$this->supress_tickmarks ) {
+			$img->Line($xs,$pos,$xs,$a2);
+		    }
+		    $this->maj_ticks_pos[$i]=$xs;
+		    $this->maj_ticklabels_pos[$i]=$xs;
+
+		    if( $this->label_formfunc != '' ) {
+			$f = $this->label_formfunc;
+			$this->maj_ticks_label[$i]=call_user_func($f,$nextMajor);	
+		    }
+		    elseif( $this->label_logtype == 0 )
+			$this->maj_ticks_label[$i]=$nextMajor;	
+		    else
+			$this->maj_ticks_label[$i]='10^'.round(log10($nextMajor));
+		    ++$i;
+		    $nextMajor *= 10;
+		    $step *= 10;	
+		    $count=1; 				
+		}
+		else {
+		    if( !$this->supress_tickmarks && !$this->supress_minor_tickmarks) {
+			$img->Line($xs,$pos,$xs,$a);		
+		    }
+		}
+	    }		
+	}
+	return true;
+    }
+} // Class
+/* EOF */
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph.php php-syslog-ng/html/includes/jpgraph/jpgraph.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph.php	2006-03-15 18:55:00.000000000 -0500
@@ -0,0 +1,8563 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH.PHP
+// Description:	PHP Graph Plotting library. Base module.
+// Created: 	2001-01-08
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph.php 554 2006-02-18 07:45:31Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+require_once('jpg-config.inc');
+
+// Version info
+DEFINE('JPG_VERSION','1.20.3');
+
+// For internal use only
+DEFINE("_JPG_DEBUG",false);
+DEFINE("_FORCE_IMGTOFILE",false);
+DEFINE("_FORCE_IMGDIR",'/tmp/jpgimg/');
+
+
+//------------------------------------------------------------------------
+// Automatic settings of path for cache and font directory
+// if they have not been previously specified
+//------------------------------------------------------------------------
+if(USE_CACHE) {
+    if (!defined('CACHE_DIR')) {
+	if ( strstr( PHP_OS, 'WIN') ) {
+	    if( empty($_SERVER['TEMP']) ) {
+		$t = new ErrMsgText();
+		$msg = $t->Get(11,$file,$lineno);
+		die($msg);
+	    }
+	    else {
+		DEFINE('CACHE_DIR', $_SERVER['TEMP'] . '/');
+	    }
+	} else {
+	    DEFINE('CACHE_DIR','/tmp/jpgraph_cache/');
+	}
+    }
+}
+elseif( !defined('CACHE_DIR') ) {
+    DEFINE('CACHE_DIR', '');
+}
+
+if (!defined('TTF_DIR')) {
+    if (strstr( PHP_OS, 'WIN') ) {
+	$sroot = getenv('SystemRoot');
+        if( empty($sroot) ) {
+	    $t = new ErrMsgText();
+	    $msg = $t->Get(12,$file,$lineno);
+	    die($msg);
+        }
+	else {
+	  DEFINE('TTF_DIR', $sroot.'/fonts/');
+        }
+    } else {
+	DEFINE('TTF_DIR','/usr/X11R6/lib/X11/fonts/truetype/');
+    }
+}
+
+//------------------------------------------------------------------
+// Constants which are used as parameters for the method calls
+//------------------------------------------------------------------
+
+// TTF Font families
+DEFINE("FF_COURIER",10);
+DEFINE("FF_VERDANA",11);
+DEFINE("FF_TIMES",12);
+DEFINE("FF_COMIC",14);
+DEFINE("FF_ARIAL",15);
+DEFINE("FF_GEORGIA",16);
+DEFINE("FF_TREBUCHE",17);
+
+// Gnome Vera font
+// Available from http://www.gnome.org/fonts/
+DEFINE("FF_VERA",19);
+DEFINE("FF_VERAMONO",20);
+DEFINE("FF_VERASERIF",21);
+
+// Chinese font
+DEFINE("FF_SIMSUN",30);
+DEFINE("FF_CHINESE",31);
+DEFINE("FF_BIG5",31);
+
+// Japanese font
+DEFINE("FF_MINCHO",40);
+DEFINE("FF_PMINCHO",41);
+DEFINE("FF_GOTHIC",42);
+DEFINE("FF_PGOTHIC",43);
+
+// Limits for TTF fonts
+DEFINE('_FF_FIRST',10);
+DEFINE('_FF_LAST',43);
+
+// Older deprecated fonts 
+DEFINE("FF_BOOK",91);    // Deprecated fonts from 1.9
+DEFINE("FF_HANDWRT",92); // Deprecated fonts from 1.9
+
+// TTF Font styles
+DEFINE("FS_NORMAL",9001);
+DEFINE("FS_BOLD",9002);
+DEFINE("FS_ITALIC",9003);
+DEFINE("FS_BOLDIT",9004);
+DEFINE("FS_BOLDITALIC",9004);
+
+//Definitions for internal font, new style
+DEFINE("FF_FONT0",1);
+DEFINE("FF_FONT1",2);
+DEFINE("FF_FONT2",4);
+
+// Tick density
+DEFINE("TICKD_DENSE",1);
+DEFINE("TICKD_NORMAL",2);
+DEFINE("TICKD_SPARSE",3);
+DEFINE("TICKD_VERYSPARSE",4);
+
+// Side for ticks and labels. 
+DEFINE("SIDE_LEFT",-1);
+DEFINE("SIDE_RIGHT",1);
+DEFINE("SIDE_DOWN",-1);
+DEFINE("SIDE_BOTTOM",-1);
+DEFINE("SIDE_UP",1);
+DEFINE("SIDE_TOP",1);
+
+// Legend type stacked vertical or horizontal
+DEFINE("LEGEND_VERT",0);
+DEFINE("LEGEND_HOR",1);
+
+// Mark types for plot marks
+DEFINE("MARK_SQUARE",1);
+DEFINE("MARK_UTRIANGLE",2);
+DEFINE("MARK_DTRIANGLE",3);
+DEFINE("MARK_DIAMOND",4);
+DEFINE("MARK_CIRCLE",5);
+DEFINE("MARK_FILLEDCIRCLE",6);
+DEFINE("MARK_CROSS",7);
+DEFINE("MARK_STAR",8);
+DEFINE("MARK_X",9);
+DEFINE("MARK_LEFTTRIANGLE",10);
+DEFINE("MARK_RIGHTTRIANGLE",11);
+DEFINE("MARK_FLASH",12);
+DEFINE("MARK_IMG",13);
+DEFINE("MARK_FLAG1",14);
+DEFINE("MARK_FLAG2",15);
+DEFINE("MARK_FLAG3",16);
+DEFINE("MARK_FLAG4",17);
+
+// Builtin images
+DEFINE("MARK_IMG_PUSHPIN",50);
+DEFINE("MARK_IMG_SPUSHPIN",50);
+DEFINE("MARK_IMG_LPUSHPIN",51);
+DEFINE("MARK_IMG_DIAMOND",52);
+DEFINE("MARK_IMG_SQUARE",53);
+DEFINE("MARK_IMG_STAR",54);
+DEFINE("MARK_IMG_BALL",55);
+DEFINE("MARK_IMG_SBALL",55);
+DEFINE("MARK_IMG_MBALL",56);
+DEFINE("MARK_IMG_LBALL",57);
+DEFINE("MARK_IMG_BEVEL",58);
+
+// Inline defines
+DEFINE("INLINE_YES",1);
+DEFINE("INLINE_NO",0);
+
+// Format for background images
+DEFINE("BGIMG_FILLPLOT",1);
+DEFINE("BGIMG_FILLFRAME",2);
+DEFINE("BGIMG_COPY",3);
+DEFINE("BGIMG_CENTER",4);
+
+// Depth of objects
+DEFINE("DEPTH_BACK",0);
+DEFINE("DEPTH_FRONT",1);
+
+// Direction
+DEFINE("VERTICAL",1);
+DEFINE("HORIZONTAL",0);
+
+
+// Axis styles for scientific style axis
+DEFINE('AXSTYLE_SIMPLE',1);
+DEFINE('AXSTYLE_BOXIN',2);
+DEFINE('AXSTYLE_BOXOUT',3);
+DEFINE('AXSTYLE_YBOXIN',4);
+DEFINE('AXSTYLE_YBOXOUT',5);
+
+// Style for title backgrounds
+DEFINE('TITLEBKG_STYLE1',1);
+DEFINE('TITLEBKG_STYLE2',2);
+DEFINE('TITLEBKG_STYLE3',3);
+DEFINE('TITLEBKG_FRAME_NONE',0);
+DEFINE('TITLEBKG_FRAME_FULL',1);
+DEFINE('TITLEBKG_FRAME_BOTTOM',2);
+DEFINE('TITLEBKG_FRAME_BEVEL',3);
+DEFINE('TITLEBKG_FILLSTYLE_HSTRIPED',1);
+DEFINE('TITLEBKG_FILLSTYLE_VSTRIPED',2);
+DEFINE('TITLEBKG_FILLSTYLE_SOLID',3);
+
+// Style for background gradient fills
+DEFINE('BGRAD_FRAME',1);
+DEFINE('BGRAD_MARGIN',2);
+DEFINE('BGRAD_PLOT',3);
+
+// Width of tab titles
+DEFINE('TABTITLE_WIDTHFIT',0);
+DEFINE('TABTITLE_WIDTHFULL',-1);
+
+// Defines for 3D skew directions
+DEFINE('SKEW3D_UP',0);
+DEFINE('SKEW3D_DOWN',1);
+DEFINE('SKEW3D_LEFT',2);
+DEFINE('SKEW3D_RIGHT',3);
+
+
+
+//
+// Get hold of gradient class (In Version 2.x)
+// A client of the library has to manually include this
+//
+require_once 'jpgraph_gradient.php';
+
+
+class ErrMsgText {
+    var $lt=NULL;
+    var $supportedLocales = array('en');
+    function ErrMsgText() {
+	GLOBAL $__jpg_err_locale;
+	if( !in_array($__jpg_err_locale,$this->supportedLocales) )
+	    $aLoc = 'en';
+	require_once('lang/'.$__jpg_err_locale.'.inc.php');
+	$this->lt = $_jpg_messages;
+    }
+
+    function Get($errnbr,$a1=null,$a2=null,$a3=null,$a4=null,$a5=null) {
+	if( !isset($this->lt[$errnbr]) ) {
+	    return 'Internal error: The specified error message does not exist in the chosen locale. (Please blame the translator...))';
+	}
+	$ea = $this->lt[$errnbr];
+	$j=0;
+	if( $a1 !== null ) {
+	    $argv[$j++] = $a1;
+	    if( $a2 !== null ) {
+		$argv[$j++] = $a2;
+		if( $a3 !== null ) {
+		    $argv[$j++] = $a3;
+		    if( $a4 !== null ) {
+			$argv[$j++] = $a4;
+			if( $a5 !== null ) {
+			    $argv[$j++] = $a5;
+			}
+		    }
+		}
+	    }
+	}
+	$numargs = $j; 
+	if( $ea[1] != $numargs ) {
+	    // Error message argument count do not match.
+	    // Just return the error message without arguments.
+	    return $ea[0];
+	}
+	switch( $numargs ) {
+	    case 1:
+		$msg = sprintf($ea[0],$argv[0]);
+		break;
+	    case 2:
+		$msg = sprintf($ea[0],$argv[0],$argv[1]);
+		break;
+	    case 3:
+		$msg = sprintf($ea[0],$argv[0],$argv[1],$argv[2]);
+		break;
+	    case 4:
+		$msg = sprintf($ea[0],$argv[0],$argv[1],$argv[2],$argv[3]);
+		break;
+	    case 5:
+		$msg = sprintf($ea[0],$argv[0],$argv[1],$argv[2],$argv[3],$argv[4]);
+		break;
+	    case 0:
+	    default:
+		$msg = sprintf($ea[0]);
+		break;
+	}
+	return $msg;
+    }
+}
+
+//
+// A wrapper class that is used to access the specified error object
+// (to hide the global error parameter and avoid having a GLOBAL directive
+// in all methods.
+//
+GLOBAL $__jpg_err;
+GLOBAL $__jpg_err_locale ;
+$__jpg_err_locale = 'en';
+class JpGraphError {
+    function Install($aErrObject) {
+	GLOBAL $__jpg_err;
+	$__jpg_err = $aErrObject;
+    }
+    function Raise($aMsg,$aHalt=true){
+	GLOBAL $__jpg_err;
+	$tmp = new $__jpg_err;
+	$tmp->Raise($aMsg,$aHalt);
+    }
+    function RaiseL($errnbr,$a1=null,$a2=null,$a3=null,$a4=null,$a5=null) {
+	GLOBAL $__jpg_err;
+	$t = new ErrMsgText();
+	$msg = $t->Get($errnbr,$a1,$a2,$a3,$a4,$a5);
+	$tmp = new $__jpg_err;
+	$tmp->Raise($msg);
+    }
+}
+ 
+//
+// ... and install the default error handler
+//
+if( USE_IMAGE_ERROR_HANDLER ) {
+    $__jpg_err = "JpGraphErrObjectImg";
+}
+else {
+    $__jpg_err = "JpGraphErrObject"; 
+}
+
+//
+// Make GD sanity check
+//
+if( !function_exists("imagetypes") || !function_exists('imagecreatefromstring') ) {
+    JpGraphError::RaiseL(25001);
+//("This PHP installation is not configured with the GD library. Please recompile PHP with GD support to run JpGraph. (Neither function imagetypes() nor imagecreatefromstring() does exist)");
+}
+
+//
+// Routine to determine if GD1 or GD2 is installed
+//
+function CheckGDVersion() {
+    $GDfuncList = get_extension_funcs('gd');
+    if( !$GDfuncList ) return 0 ;
+    else {
+	if( in_array('imagegd2',$GDfuncList) && 
+	    in_array('imagecreatetruecolor',$GDfuncList))
+	    return 2;
+	else
+	    return 1;
+    } 
+}
+
+//
+// Check what version of the GD library is installed.
+//
+$GLOBALS['gd2'] = false;
+if( USE_LIBRARY_GD2 === 'auto' ) {
+    $gdversion = CheckGDVersion();
+    if( $gdversion == 2 ) {
+	$GLOBALS['gd2'] = true;
+	$GLOBALS['copyfunc'] = 'imagecopyresampled';
+    }
+    elseif( $gdversion == 1 ) {
+	$GLOBALS['gd2'] = false;
+	$GLOBALS['copyfunc'] = 'imagecopyresized';
+    }
+    else {
+	JpGraphError::RaiseL(25002);
+//(" Your PHP installation does not seem to have the required GD library. Please see the PHP documentation on how to install and enable the GD library.");
+    }
+}
+else {
+    $GLOBALS['gd2'] = USE_LIBRARY_GD2;
+    $GLOBALS['copyfunc'] = USE_LIBRARY_GD2 ? 'imagecopyresampled' : 'imagecopyresized';
+}
+
+
+//
+// First of all set up a default error handler
+//
+
+
+//=============================================================
+// The default trivial text error handler.
+//=============================================================
+class JpGraphErrObject {
+
+    var $iTitle = "JpGraph Error";
+    var $iDest = false;
+
+    function JpGraphErrObject() {
+	// Empty. Reserved for future use
+    }
+
+    function SetTitle($aTitle) {
+	$this->iTitle = $aTitle;
+    }
+
+    function SetStrokeDest($aDest) { 
+	$this->iDest = $aDest; 
+    }
+
+    // If aHalt is true then execution can't continue. Typical used for fatal errors.
+    function Raise($aMsg,$aHalt=true) {
+	$aMsg = $this->iTitle.' '.$aMsg;
+	if ($this->iDest) {
+	    $f = @fopen($this->iDest,'a');
+	    if( $f ) {
+		@fwrite($f,$aMsg);
+		@fclose($f);
+	    }
+	}
+	else {
+	    echo $aMsg;
+	}
+	if( $aHalt )
+	    die();
+    }
+}
+
+//==============================================================
+// An image based error handler
+//==============================================================
+class JpGraphErrObjectImg extends JpGraphErrObject {
+
+    function Raise($aMsg,$aHalt=true) {
+	$img_iconerror = 
+	    'iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAaV'.
+	    'BMVEX//////2Xy8mLl5V/Z2VvMzFi/v1WyslKlpU+ZmUyMjEh/'.
+	    'f0VyckJlZT9YWDxMTDjAwMDy8sLl5bnY2K/MzKW/v5yyspKlpY'.
+	    'iYmH+MjHY/PzV/f2xycmJlZVlZWU9MTEXY2Ms/PzwyMjLFTjea'.
+	    'AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACx'.
+	    'IAAAsSAdLdfvwAAAAHdElNRQfTBgISOCqusfs5AAABLUlEQVR4'.
+	    '2tWV3XKCMBBGWfkranCIVClKLd/7P2Q3QsgCxjDTq+6FE2cPH+'.
+	    'xJ0Ogn2lQbsT+Wrs+buAZAV4W5T6Bs0YXBBwpKgEuIu+JERAX6'.
+	    'wM2rHjmDdEITmsQEEmWADgZm6rAjhXsoMGY9B/NZBwJzBvn+e3'.
+	    'wHntCAJdGu9SviwIwoZVDxPB9+Rc0TSEbQr0j3SA1gwdSn6Db0'.
+	    '6Tm1KfV6yzWGQO7zdpvyKLKBDmRFjzeB3LYgK7r6A/noDAfjtS'.
+	    'IXaIzbJSv6WgUebTMV4EoRB8a2mQiQjgtF91HdKDKZ1gtFtQjk'.
+	    'YcWaR5OKOhkYt+ZsTFdJRfPAApOpQYJTNHvCRSJR6SJngQadfc'.
+	    'vd69OLMddVOPCGVnmrFD8bVYd3JXfxXPtLR/+mtv59/ALWiiMx'.
+	    'qL72fwAAAABJRU5ErkJggg==' ;
+
+	if( function_exists("imagetypes") )
+	    $supported = imagetypes();
+	else
+	    $supported = 0;
+
+	if( !function_exists('imagecreatefromstring') )
+	    $supported = 0;
+
+	if( ob_get_length() || headers_sent() || !($supported & IMG_PNG) ) {
+	    // Special case for headers already sent or that the installation doesn't support
+	    // the PNG format (which the error icon is encoded in). 
+	    // Dont return an image since it can't be displayed
+	    die($this->iTitle.' '.$aMsg);		
+	}
+
+	$aMsg = wordwrap($aMsg,55);
+	$lines = substr_count($aMsg,"\n");
+
+	// Create the error icon GD
+	$erricon = Image::CreateFromString(base64_decode($img_iconerror));   
+
+	// Create an image that contains the error text.
+	$w=400; 	
+	$h=100 + 15*max(0,$lines-3);
+
+	$img = new Image($w,$h);
+
+	// Drop shadow
+	$img->SetColor("gray");
+	$img->FilledRectangle(5,5,$w-1,$h-1,10);
+	$img->SetColor("gray:0.7");
+	$img->FilledRectangle(5,5,$w-3,$h-3,10);
+	
+	// Window background
+	$img->SetColor("lightblue");
+	$img->FilledRectangle(1,1,$w-5,$h-5);
+	$img->CopyCanvasH($img->img,$erricon,5,30,0,0,40,40);
+
+	// Window border
+	$img->SetColor("black");
+	$img->Rectangle(1,1,$w-5,$h-5);
+	$img->Rectangle(0,0,$w-4,$h-4);
+	
+	// Window top row
+	$img->SetColor("darkred");
+	for($y=3; $y < 18; $y += 2 ) 
+	    $img->Line(1,$y,$w-6,$y);
+
+	// "White shadow"
+	$img->SetColor("white");
+
+	// Left window edge
+	$img->Line(2,2,2,$h-5);
+	$img->Line(2,2,$w-6,2);
+
+	// "Gray button shadow"
+	$img->SetColor("darkgray");
+
+	// Gray window shadow
+	$img->Line(2,$h-6,$w-5,$h-6);
+	$img->Line(3,$h-7,$w-5,$h-7);
+
+	// Window title
+	$m = floor($w/2-5);
+	$l = 100;
+	$img->SetColor("lightgray:1.3");
+	$img->FilledRectangle($m-$l,2,$m+$l,16);
+
+	// Stroke text
+	$img->SetColor("darkred");
+	$img->SetFont(FF_FONT2,FS_BOLD);
+	$img->StrokeText($m-50,15,$this->iTitle);
+	$img->SetColor("black");
+	$img->SetFont(FF_FONT1,FS_NORMAL);
+	$txt = new Text($aMsg,52,25);
+	$txt->Align("left","top");
+	$txt->Stroke($img);
+	if ($this->iDest) {
+           $img->Stream($this->iDest);
+	} else {
+	    $img->Headers();
+	    $img->Stream();
+	}
+	if( $aHalt )
+	    die();
+    }
+}
+
+//
+// Setup PHP error handler
+//
+function _phpErrorHandler($errno,$errmsg,$filename, $linenum, $vars) {
+    // Respect current error level
+    if( $errno & error_reporting() ) {
+	JpGraphError::RaiseL(25003,basename($filename),$linenum,$errmsg); 
+    }
+}
+
+if( INSTALL_PHP_ERR_HANDLER ) {
+    set_error_handler("_phpErrorHandler");
+}
+
+//
+//Check if there were any warnings, perhaps some wrong includes by the user
+//
+if( isset($GLOBALS['php_errormsg']) && CATCH_PHPERRMSG && 
+    !preg_match('|Deprecated|', $GLOBALS['php_errormsg'])) {
+    JpGraphError::RaiseL(25004,$GLOBALS['php_errormsg']);
+}
+
+
+// Useful mathematical function
+function sign($a) {return $a >= 0 ? 1 : -1;}
+
+// Utility function to generate an image name based on the filename we
+// are running from and assuming we use auto detection of graphic format
+// (top level), i.e it is safe to call this function
+// from a script that uses JpGraph
+function GenImgName() {
+    global $_SERVER;
+
+    // Determine what format we should use when we save the images
+    $supported = imagetypes();
+    if( $supported & IMG_PNG )	   $img_format="png";
+    elseif( $supported & IMG_GIF ) $img_format="gif";
+    elseif( $supported & IMG_JPG ) $img_format="jpeg";
+
+    if( !isset($_SERVER['PHP_SELF']) )
+	JpGraphError::RaiseL(25005);
+//(" Can't access PHP_SELF, PHP global variable. You can't run PHP from command line if you want to use the 'auto' naming of cache or image files.");
+    $fname = basename($_SERVER['PHP_SELF']);
+    if( !empty($_SERVER['QUERY_STRING']) ) {
+	$q = @$_SERVER['QUERY_STRING'];
+	$fname .= '?'.preg_replace("/\W/", "_", $q).'.'.$img_format;
+    }
+    else {
+	$fname = substr($fname,0,strlen($fname)-4).'.'.$img_format;
+    }
+    return $fname;
+}
+
+class LanguageConv {
+    var $g2312 = null ;
+
+    function Convert($aTxt,$aFF) {
+	if( LANGUAGE_CYRILLIC ) {
+	    if( CYRILLIC_FROM_WINDOWS ) {
+		$aTxt = convert_cyr_string($aTxt, "w", "k"); 
+	    }
+	    $isostring = convert_cyr_string($aTxt, "k", "i");
+	    $unistring = LanguageConv::iso2uni($isostring);
+	    return $unistring;
+	}
+	elseif( $aFF === FF_SIMSUN ) {
+	    // Do Chinese conversion
+	    if( $this->g2312 == null ) {
+		include_once 'jpgraph_gb2312.php' ;
+		$this->g2312 = new GB2312toUTF8();
+	    }
+	    return $this->g2312->gb2utf8($aTxt);
+	}
+	elseif( $aFF === FF_CHINESE ) {
+	    if( !function_exists('iconv') ) {
+		JpGraphError::RaiseL(25006);
+//('Usage of FF_CHINESE (FF_BIG5) font family requires that your PHP setup has the iconv() function. By default this is not compiled into PHP (needs the "--width-iconv" when configured).');
+	    }
+	    return iconv('BIG5','UTF-8',$aTxt);
+	}
+	else 
+	    return $aTxt;
+    }
+
+    // Translate iso encoding to unicode
+    function iso2uni ($isoline){
+	$uniline='';
+	for ($i=0; $i < strlen($isoline); $i++){
+	    $thischar=substr($isoline,$i,1);
+	    $charcode=ord($thischar);
+	    $uniline.=($charcode>175) ? "&#" . (1040+($charcode-176)). ";" : $thischar;
+	}
+	return $uniline;
+    }
+}
+
+//===================================================
+// CLASS JpgTimer
+// Description: General timing utility class to handle
+// time measurement of generating graphs. Multiple
+// timers can be started.
+//===================================================
+class JpgTimer {
+    var $start;
+    var $idx;	
+//---------------
+// CONSTRUCTOR
+    function JpgTimer() {
+	$this->idx=0;
+    }
+
+//---------------
+// PUBLIC METHODS	
+
+    // Push a new timer start on stack
+    function Push() {
+	list($ms,$s)=explode(" ",microtime());	
+	$this->start[$this->idx++]=floor($ms*1000) + 1000*$s;	
+    }
+
+    // Pop the latest timer start and return the diff with the
+    // current time
+    function Pop() {
+	assert($this->idx>0);
+	list($ms,$s)=explode(" ",microtime());	
+	$etime=floor($ms*1000) + (1000*$s);
+	$this->idx--;
+	return $etime-$this->start[$this->idx];
+    }
+} // Class
+
+$gJpgBrandTiming = BRAND_TIMING;
+//===================================================
+// CLASS DateLocale
+// Description: Hold localized text used in dates
+//===================================================
+class DateLocale {
+ 
+    var $iLocale = 'C'; // environmental locale be used by default
+
+    var $iDayAbb = null;
+    var $iShortDay = null;
+    var $iShortMonth = null;
+    var $iMonthName = null;
+
+//---------------
+// CONSTRUCTOR	
+    function DateLocale() {
+	settype($this->iDayAbb, 'array');
+	settype($this->iShortDay, 'array');
+	settype($this->iShortMonth, 'array');
+	settype($this->iMonthName, 'array');
+
+
+	$this->Set('C');
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function Set($aLocale) {
+	if ( in_array($aLocale, array_keys($this->iDayAbb)) ){ 
+	    $this->iLocale = $aLocale;
+	    return TRUE;  // already cached nothing else to do!
+	}
+
+	$pLocale = setlocale(LC_TIME, 0); // get current locale for LC_TIME
+	$res = @setlocale(LC_TIME, $aLocale);
+	if ( ! $res ){
+	    JpGraphError::RaiseL(25007,$aLocale);
+//("You are trying to use the locale ($aLocale) which your PHP installation does not support. Hint: Use '' to indicate the default locale for this geographic region.");
+	    return FALSE;
+	}
+ 
+	$this->iLocale = $aLocale;
+
+	for ( $i = 0, $ofs = 0 - strftime('%w'); $i < 7; $i++, $ofs++ ){
+	    $day = strftime('%a', strtotime("$ofs day"));
+	    $day{0} = strtoupper($day{0});
+	    $this->iDayAbb[$aLocale][]= $day{0};
+	    $this->iShortDay[$aLocale][]= $day;
+	}
+
+	for($i=1; $i<=12; ++$i) {
+	    list($short ,$full) = explode('|', strftime("%b|%B",strtotime("2001-$i-01")));
+	    $this->iShortMonth[$aLocale][] = ucfirst($short);
+	    $this->iMonthName [$aLocale][] = ucfirst($full);
+	}
+
+	// Return to original locale
+	setlocale(LC_TIME, $pLocale);
+
+	return TRUE;
+    }
+
+
+    function GetDayAbb() {
+	return $this->iDayAbb[$this->iLocale];
+    }
+	
+    function GetShortDay() {
+	return $this->iShortDay[$this->iLocale];
+    }
+
+    function GetShortMonth() {
+	return $this->iShortMonth[$this->iLocale];
+    }
+	
+    function GetShortMonthName($aNbr) {
+	return $this->iShortMonth[$this->iLocale][$aNbr];
+    }
+
+    function GetLongMonthName($aNbr) {
+	return $this->iMonthName[$this->iLocale][$aNbr];
+    }
+
+    function GetMonth() {
+	return $this->iMonthName[$this->iLocale];
+    }
+}
+
+$gDateLocale = new DateLocale();
+$gJpgDateLocale = new DateLocale();
+
+
+//=======================================================
+// CLASS Footer
+// Description: Encapsulates the footer line in the Graph
+//=======================================================
+class Footer {
+    var $left,$center,$right;
+    var $iLeftMargin = 3;
+    var $iRightMargin = 3;
+    var $iBottomMargin = 3;
+
+    function Footer() {
+	$this->left = new Text();
+	$this->left->ParagraphAlign('left');
+	$this->center = new Text();
+	$this->center->ParagraphAlign('center');
+	$this->right = new Text();
+	$this->right->ParagraphAlign('right');
+    }
+
+    function Stroke(&$aImg) {
+	$y = $aImg->height - $this->iBottomMargin;
+	$x = $this->iLeftMargin;
+	$this->left->Align('left','bottom');
+	$this->left->Stroke($aImg,$x,$y);
+
+	$x = ($aImg->width - $this->iLeftMargin - $this->iRightMargin)/2;
+	$this->center->Align('center','bottom');
+	$this->center->Stroke($aImg,$x,$y);
+
+	$x = $aImg->width - $this->iRightMargin;
+	$this->right->Align('right','bottom');
+	$this->right->Stroke($aImg,$x,$y);
+    }
+}
+
+
+//===================================================
+// CLASS Graph
+// Description: Main class to handle graphs
+//===================================================
+class Graph {
+    var $cache=null;		// Cache object (singleton)
+    var $img=null;			// Img object (singleton)
+    var $plots=array();	// Array of all plot object in the graph (for Y 1 axis)
+    var $y2plots=array();// Array of all plot object in the graph (for Y 2 axis)
+    var $ynplots=array();
+    var $xscale=null;		// X Scale object (could be instance of LinearScale or LogScale
+    var $yscale=null,$y2scale=null, $ynscale=array();
+    var $iIcons = array();      // Array of Icons to add to 
+    var $cache_name;		// File name to be used for the current graph in the cache directory
+    var $xgrid=null;		// X Grid object (linear or logarithmic)
+    var $ygrid=null,$y2grid=null; 
+    var $doframe=true,$frame_color=array(0,0,0), $frame_weight=1;	// Frame around graph
+    var $boxed=false, $box_color=array(0,0,0), $box_weight=1;		// Box around plot area
+    var $doshadow=false,$shadow_width=4,$shadow_color=array(102,102,102);	// Shadow for graph
+    var $xaxis=null;		// X-axis (instane of Axis class)
+    var $yaxis=null, $y2axis=null, $ynaxis=array();	// Y axis (instance of Axis class)
+    var $margin_color=array(200,200,200);	// Margin color of graph
+    var $plotarea_color=array(255,255,255);	// Plot area color
+    var $title,$subtitle,$subsubtitle; 	// Title and subtitle(s) text object
+    var $axtype="linlin";		// Type of axis
+    var $xtick_factor;			// Factot to determine the maximum number of ticks depending on the plot with
+    var $texts=null, $y2texts=null; 	// Text object to ge shown in the graph
+    var $lines=null, $y2lines=null;
+    var $bands=null, $y2bands=null;
+    var $text_scale_off=0, $text_scale_abscenteroff=-1; // Text scale offset in fractions and for centering bars in absolute pixels
+    var $background_image="",$background_image_type=-1,$background_image_format="png";
+    var $background_image_bright=0,$background_image_contr=0,$background_image_sat=0;
+    var $image_bright=0, $image_contr=0, $image_sat=0;
+    var $inline;
+    var $showcsim=0,$csimcolor="red"; //debug stuff, draw the csim boundaris on the image if <>0
+    var $grid_depth=DEPTH_BACK;	// Draw grid under all plots as default
+    var $iAxisStyle = AXSTYLE_SIMPLE;
+    var $iCSIMdisplay=false,$iHasStroked = false;
+    var $footer;
+    var $csimcachename = '', $csimcachetimeout = 0;
+    var $iDoClipping = false;
+    var $y2orderback=true;
+    var $tabtitle;
+    var $bkg_gradtype=-1,$bkg_gradstyle=BGRAD_MARGIN;
+    var $bkg_gradfrom='navy', $bkg_gradto='silver';
+    var $titlebackground = false;
+    var	$titlebackground_color = 'lightblue',
+	$titlebackground_style = 1,
+	$titlebackground_framecolor = 'blue',
+	$titlebackground_framestyle = 2,
+	$titlebackground_frameweight = 1,
+	$titlebackground_bevelheight = 3 ;
+    var $titlebkg_fillstyle=TITLEBKG_FILLSTYLE_SOLID;
+    var $titlebkg_scolor1='black',$titlebkg_scolor2='white';
+    var $framebevel = false, $framebeveldepth = 2 ;
+    var $framebevelborder = false, $framebevelbordercolor='black';
+    var $framebevelcolor1='white@0.4', $framebevelcolor2='black@0.4';
+    var $background_image_mix=100;
+    var $background_cflag = '';
+    var $background_cflag_type = BGIMG_FILLPLOT;
+    var $background_cflag_mix = 100;
+    var $iImgTrans=false,
+	$iImgTransHorizon = 100,$iImgTransSkewDist=150,
+	$iImgTransDirection = 1, $iImgTransMinSize = true,
+	$iImgTransFillColor='white',$iImgTransHighQ=false,
+	$iImgTransBorder=false,$iImgTransHorizonPos=0.5;
+    var $iYAxisDeltaPos=50;
+    var $iIconDepth=DEPTH_BACK;
+    var $iAxisLblBgType = 0,
+	$iXAxisLblBgFillColor = 'lightgray', $iXAxisLblBgColor = 'black',
+	$iYAxisLblBgFillColor = 'lightgray', $iYAxisLblBgColor = 'black';
+    var $iTables=NULL;
+
+//---------------
+// CONSTRUCTOR
+
+    // aWIdth 		Width in pixels of image
+    // aHeight  	Height in pixels of image
+    // aCachedName	Name for image file in cache directory 
+    // aTimeOut		Timeout in minutes for image in cache
+    // aInline		If true the image is streamed back in the call to Stroke()
+    //			If false the image is just created in the cache
+    function Graph($aWidth=300,$aHeight=200,$aCachedName="",$aTimeOut=0,$aInline=true) {
+	GLOBAL $gJpgBrandTiming;
+	// If timing is used create a new timing object
+	if( $gJpgBrandTiming ) {
+	    global $tim;
+	    $tim = new JpgTimer();
+	    $tim->Push();
+	}
+
+	if( !is_numeric($aWidth) || !is_numeric($aHeight) ) {
+	    JpGraphError::RaiseL(25008);//('Image width/height argument in Graph::Graph() must be numeric');
+	}
+		
+	// Automatically generate the image file name based on the name of the script that
+	// generates the graph
+	if( $aCachedName=="auto" )
+	    $aCachedName=GenImgName();
+			
+	// Should the image be streamed back to the browser or only to the cache?
+	$this->inline=$aInline;
+		
+	$this->img	= new RotImage($aWidth,$aHeight);
+
+	$this->cache 	= new ImgStreamCache($this->img);
+	$this->cache->SetTimeOut($aTimeOut);
+
+	$this->title = new Text();
+	$this->title->ParagraphAlign('center');
+	$this->title->SetFont(FF_FONT2,FS_BOLD);
+	$this->title->SetMargin(3);
+	$this->title->SetAlign('center');
+
+	$this->subtitle = new Text();
+	$this->subtitle->ParagraphAlign('center');
+	$this->subtitle->SetMargin(2);
+	$this->subtitle->SetAlign('center');
+
+	$this->subsubtitle = new Text();
+	$this->subsubtitle->ParagraphAlign('center');
+	$this->subsubtitle->SetMargin(2);
+	$this->subsubtitle->SetAlign('center');
+
+	$this->legend = new Legend();
+	$this->footer = new Footer();
+
+	// Window doesn't like '?' in the file name so replace it with an '_'
+	$aCachedName = str_replace("?","_",$aCachedName);
+
+	// If the cached version exist just read it directly from the
+	// cache, stream it back to browser and exit
+	if( $aCachedName!="" && READ_CACHE && $aInline )
+	    if( $this->cache->GetAndStream($aCachedName) ) {
+		exit();
+	    }
+				
+	$this->cache_name = $aCachedName;
+	$this->SetTickDensity(); // Normal density
+
+	$this->tabtitle = new GraphTabTitle();
+    }
+//---------------
+// PUBLIC METHODS	
+    // Enable final image perspective transformation
+    function Set3DPerspective($aDir=1,$aHorizon=100,$aSkewDist=120,$aQuality=false,$aFillColor='#FFFFFF',$aBorder=false,$aMinSize=true,$aHorizonPos=0.5) {
+	$this->iImgTrans = true;
+	$this->iImgTransHorizon = $aHorizon;
+	$this->iImgTransSkewDist= $aSkewDist;
+	$this->iImgTransDirection = $aDir;
+	$this->iImgTransMinSize = $aMinSize;
+	$this->iImgTransFillColor=$aFillColor;
+	$this->iImgTransHighQ=$aQuality;
+	$this->iImgTransBorder=$aBorder;
+	$this->iImgTransHorizonPos=$aHorizonPos;
+    }
+
+    // Set Image format and optional quality
+    function SetImgFormat($aFormat,$aQuality=75) {
+	$this->img->SetImgFormat($aFormat,$aQuality);
+    }
+
+    // Should the grid be in front or back of the plot?
+    function SetGridDepth($aDepth) {
+	$this->grid_depth=$aDepth;
+    }
+
+    function SetIconDepth($aDepth) {
+	$this->iIconDepth=$aDepth;
+    }
+	
+    // Specify graph angle 0-360 degrees.
+    function SetAngle($aAngle) {
+	$this->img->SetAngle($aAngle);
+    }
+
+    function SetAlphaBlending($aFlg=true) {
+	$this->img->SetAlphaBlending($aFlg);
+    }
+
+    // Shortcut to image margin
+    function SetMargin($lm,$rm,$tm,$bm) {
+	$this->img->SetMargin($lm,$rm,$tm,$bm);
+    }
+
+    function SetY2OrderBack($aBack=true) {
+	$this->y2orderback = $aBack;
+    }
+
+    // Rotate the graph 90 degrees and set the margin 
+    // when we have done a 90 degree rotation
+    function Set90AndMargin($lm=0,$rm=0,$tm=0,$bm=0) {
+	$lm = $lm ==0 ? floor(0.2 * $this->img->width)  : $lm ;
+	$rm = $rm ==0 ? floor(0.1 * $this->img->width)  : $rm ;
+	$tm = $tm ==0 ? floor(0.2 * $this->img->height) : $tm ;
+	$bm = $bm ==0 ? floor(0.1 * $this->img->height) : $bm ;
+
+	$adj = ($this->img->height - $this->img->width)/2;
+	$this->img->SetMargin($tm-$adj,$bm-$adj,$rm+$adj,$lm+$adj);
+	$this->img->SetCenter(floor($this->img->width/2),floor($this->img->height/2));
+	$this->SetAngle(90);
+	if( empty($this->yaxis) || empty($this->xaxis) ) {
+	    JpgraphError::RaiseL(25009);//('You must specify what scale to use with a call to Graph::SetScale()');
+	}
+	$this->xaxis->SetLabelAlign('right','center');
+	$this->yaxis->SetLabelAlign('center','bottom');
+    }
+	
+    function SetClipping($aFlg=true) {
+	$this->iDoClipping = $aFlg ;
+    }
+
+    // Add a plot object to the graph
+    function Add(&$aPlot) {
+	if( $aPlot == null )
+	    JpGraphError::RaiseL(25010);//("Graph::Add() You tried to add a null plot to the graph.");
+	if( is_array($aPlot) && count($aPlot) > 0 )
+	    $cl = $aPlot[0];
+	else
+	    $cl = $aPlot;
+
+	if( is_a($cl,'Text') ) 
+	    $this->AddText($aPlot);
+	elseif( is_a($cl,'PlotLine') )
+	    $this->AddLine($aPlot);
+	elseif( is_a($cl,'PlotBand') )
+	    $this->AddBand($aPlot);
+	elseif( is_a($cl,'IconPlot') )
+	    $this->AddIcon($aPlot);
+	elseif( is_a($cl,'GTextTable') )
+	    $this->AddTable($aPlot);
+	else
+	    $this->plots[] = &$aPlot;
+    }
+
+
+    function AddTable(&$aTable) {
+	if( is_array($aTable) ) {
+	    for($i=0; $i < count($aTable); ++$i )
+		$this->iTables[]=&$aTable[$i];
+	}
+	else {
+	    $this->iTables[] = &$aTable ;
+	}	
+    }
+
+    function AddIcon(&$aIcon) {
+	if( is_array($aIcon) ) {
+	    for($i=0; $i < count($aIcon); ++$i )
+		$this->iIcons[]=&$aIcon[$i];
+	}
+	else {
+	    $this->iIcons[] = &$aIcon ;
+	}	
+    }
+
+    // Add plot to second Y-scale
+    function AddY2(&$aPlot) {
+	if( $aPlot == null )
+	    JpGraphError::RaiseL(25011);//("Graph::AddY2() You tried to add a null plot to the graph.");	
+
+	if( is_array($aPlot) && count($aPlot) > 0 )
+	    $cl = $aPlot[0];
+	else
+	    $cl = $aPlot;
+
+	if( is_a($cl,'Text') ) 
+	    $this->AddText($aPlot,true);
+	elseif( is_a($cl,'PlotLine') )
+	    $this->AddLine($aPlot,true);
+	elseif( is_a($cl,'PlotBand') )
+	    $this->AddBand($aPlot,true);
+	else
+	    $this->y2plots[] = &$aPlot;
+    }
+
+    // Add plot to second Y-scale
+    function AddY($aN,&$aPlot) {
+
+	if( $aPlot == null )
+	    JpGraphError::RaiseL(25012);//("Graph::AddYN() You tried to add a null plot to the graph.");	
+
+	if( is_array($aPlot) && count($aPlot) > 0 )
+	    $cl = $aPlot[0];
+	else
+	    $cl = $aPlot;
+
+	if( is_a($cl,'Text') || is_a($cl,'PlotLine') || is_a($cl,'PlotBand') )
+	    JpGraph::RaiseL(25013);//('You can only add standard plots to multiple Y-axis');
+	else
+	    $this->ynplots[$aN][] = &$aPlot;
+    }
+    
+    // Add text object to the graph
+    function AddText(&$aTxt,$aToY2=false) {
+	if( $aTxt == null )
+	    JpGraphError::RaiseL(25014);//("Graph::AddText() You tried to add a null text to the graph.");		
+	if( $aToY2 ) {
+	    if( is_array($aTxt) ) {
+		for($i=0; $i < count($aTxt); ++$i )
+		    $this->y2texts[]=&$aTxt[$i];
+	    }
+	    else
+		$this->y2texts[] = &$aTxt;
+	}
+	else {
+	    if( is_array($aTxt) ) {
+		for($i=0; $i < count($aTxt); ++$i )
+		    $this->texts[]=&$aTxt[$i];
+	    }
+	    else
+		$this->texts[] = &$aTxt;
+	}
+    }
+	
+    // Add a line object (class PlotLine) to the graph
+    function AddLine(&$aLine,$aToY2=false) {
+	if( $aLine == null )
+	    JpGraphError::RaiseL(25015);//("Graph::AddLine() You tried to add a null line to the graph.");	
+
+	if( $aToY2 ) {
+ 	    if( is_array($aLine) ) {
+		for($i=0; $i < count($aLine); ++$i )
+		    $this->y2lines[]=&$aLine[$i];
+	    }
+	    else
+		$this->y2lines[] = &$aLine;
+	}
+	else {
+ 	    if( is_array($aLine) ) {
+		for($i=0; $i < count($aLine); ++$i )
+		    $this->lines[]=&$aLine[$i];
+	    }
+	    else
+		$this->lines[] = &$aLine;
+	}
+    }
+
+    // Add vertical or horizontal band
+    function AddBand(&$aBand,$aToY2=false) {
+	if( $aBand == null )
+	    JpGraphError::RaiseL(25016);//(" Graph::AddBand() You tried to add a null band to the graph.");
+
+	if( $aToY2 ) {
+	    if( is_array($aBand) ) {
+		for($i=0; $i < count($aBand); ++$i )
+		    $this->y2bands[] = &$aBand[$i];
+	    }
+	    else
+		$this->y2bands[] = &$aBand;
+	}
+	else {
+	    if( is_array($aBand) ) {
+		for($i=0; $i < count($aBand); ++$i )
+		    $this->bands[] = &$aBand[$i];
+	    }
+	    else
+		$this->bands[] = &$aBand;
+	}
+    }
+
+    function SetBackgroundGradient($aFrom='navy',$aTo='silver',$aGradType=2,$aStyle=BGRAD_FRAME) {
+	$this->bkg_gradtype=$aGradType;
+	$this->bkg_gradstyle=$aStyle;
+	$this->bkg_gradfrom = $aFrom;
+	$this->bkg_gradto = $aTo;
+    } 
+	
+    // Set a country flag in the background
+    function SetBackgroundCFlag($aName,$aBgType=BGIMG_FILLPLOT,$aMix=100) {
+	$this->background_cflag = $aName;
+	$this->background_cflag_type = $aBgType;
+	$this->background_cflag_mix = $aMix;
+    }
+
+    // Alias for the above method
+    function SetBackgroundCountryFlag($aName,$aBgType=BGIMG_FILLPLOT,$aMix=100) {
+	$this->background_cflag = $aName;
+	$this->background_cflag_type = $aBgType;
+	$this->background_cflag_mix = $aMix;
+    }
+
+
+    // Specify a background image
+    function SetBackgroundImage($aFileName,$aBgType=BGIMG_FILLPLOT,$aImgFormat="auto") {
+
+	if( $GLOBALS['gd2'] && !USE_TRUECOLOR ) {
+	    JpGraphError::RaiseL(25017);//("You are using GD 2.x and are trying to use a background images on a non truecolor image. To use background images with GD 2.x you <b>must</b> enable truecolor by setting the USE_TRUECOLOR constant to TRUE. Due to a bug in GD 2.0.1 using any truetype fonts with truecolor images will result in very poor quality fonts.");
+	}
+
+	// Get extension to determine image type
+	if( $aImgFormat == "auto" ) {
+	    $e = explode('.',$aFileName);
+	    if( !$e ) {
+		JpGraphError::RaiseL(25018,$aFileName);//('Incorrect file name for Graph::SetBackgroundImage() : '.$aFileName.' Must have a valid image extension (jpg,gif,png) when using autodetection of image type');
+	    }
+
+	    $valid_formats = array('png', 'jpg', 'gif');
+	    $aImgFormat = strtolower($e[count($e)-1]);
+	    if ($aImgFormat == 'jpeg')  {
+		$aImgFormat = 'jpg';
+	    }
+	    elseif (!in_array($aImgFormat, $valid_formats) )  {
+		JpGraphError::RaiseL(25019,$aImgFormat);//('Unknown file extension ($aImgFormat) in Graph::SetBackgroundImage() for filename: '.$aFileName);
+	    }    
+	}
+
+	$this->background_image = $aFileName;
+	$this->background_image_type=$aBgType;
+	$this->background_image_format=$aImgFormat;
+    }
+
+    function SetBackgroundImageMix($aMix) {
+	$this->background_image_mix = $aMix ;
+    }
+	
+    // Adjust brightness and constrast for background image
+    function AdjBackgroundImage($aBright,$aContr=0,$aSat=0) {
+	$this->background_image_bright=$aBright;
+	$this->background_image_contr=$aContr;
+	$this->background_image_sat=$aSat;
+    }
+	
+    // Adjust brightness and constrast for image
+    function AdjImage($aBright,$aContr=0,$aSat=0) {
+	$this->image_bright=$aBright;
+	$this->image_contr=$aContr;
+	$this->image_sat=$aSat;
+    }
+
+    // Specify axis style (boxed or single)
+    function SetAxisStyle($aStyle) {
+        $this->iAxisStyle = $aStyle ;
+    }
+	
+    // Set a frame around the plot area
+    function SetBox($aDrawPlotFrame=true,$aPlotFrameColor=array(0,0,0),$aPlotFrameWeight=1) {
+	$this->boxed = $aDrawPlotFrame;
+	$this->box_weight = $aPlotFrameWeight;
+	$this->box_color = $aPlotFrameColor;
+    }
+	
+    // Specify color for the plotarea (not the margins)
+    function SetColor($aColor) {
+	$this->plotarea_color=$aColor;
+    }
+	
+    // Specify color for the margins (all areas outside the plotarea)
+    function SetMarginColor($aColor) {
+	$this->margin_color=$aColor;
+    }
+	
+    // Set a frame around the entire image
+    function SetFrame($aDrawImgFrame=true,$aImgFrameColor=array(0,0,0),$aImgFrameWeight=1) {
+	$this->doframe = $aDrawImgFrame;
+	$this->frame_color = $aImgFrameColor;
+	$this->frame_weight = $aImgFrameWeight;
+    }
+
+    function SetFrameBevel($aDepth=3,$aBorder=false,$aBorderColor='black',$aColor1='white@0.4',$aColor2='darkgray@0.4',$aFlg=true) {
+	$this->framebevel = $aFlg ;
+	$this->framebeveldepth = $aDepth ;
+	$this->framebevelborder = $aBorder ;
+	$this->framebevelbordercolor = $aBorderColor ;
+	$this->framebevelcolor1 = $aColor1 ;
+	$this->framebevelcolor2 = $aColor2 ;
+
+	$this->doshadow = false ;
+    }
+
+    // Set the shadow around the whole image
+    function SetShadow($aShowShadow=true,$aShadowWidth=5,$aShadowColor=array(102,102,102)) {
+	$this->doshadow = $aShowShadow;
+	$this->shadow_color = $aShadowColor;
+	$this->shadow_width = $aShadowWidth;
+	$this->footer->iBottomMargin += $aShadowWidth;
+	$this->footer->iRightMargin += $aShadowWidth;
+    }
+
+    // Specify x,y scale. Note that if you manually specify the scale
+    // you must also specify the tick distance with a call to Ticks::Set()
+    function SetScale($aAxisType,$aYMin=1,$aYMax=1,$aXMin=1,$aXMax=1) {
+	$this->axtype = $aAxisType;
+
+	if( $aYMax < $aYMin || $aXMax < $aXMin )
+	    JpGraphError::RaiseL(25020);//('Graph::SetScale(): Specified Max value must be larger than the specified Min value.');
+
+	$yt=substr($aAxisType,-3,3);
+	if( $yt=="lin" )
+	    $this->yscale = new LinearScale($aYMin,$aYMax);
+	elseif( $yt == "int" ) {
+	    $this->yscale = new LinearScale($aYMin,$aYMax);
+	    $this->yscale->SetIntScale();
+	}
+	elseif( $yt=="log" )
+	    $this->yscale = new LogScale($aYMin,$aYMax);
+	else
+	    JpGraphError::RaiseL(25021,$aAxisType);//("Unknown scale specification for Y-scale. ($aAxisType)");
+			
+	$xt=substr($aAxisType,0,3);
+	if( $xt == "lin" || $xt == "tex" ) {
+	    $this->xscale = new LinearScale($aXMin,$aXMax,"x");
+	    $this->xscale->textscale = ($xt == "tex");
+	}
+	elseif( $xt == "int" ) {
+	    $this->xscale = new LinearScale($aXMin,$aXMax,"x");
+	    $this->xscale->SetIntScale();
+	}
+	elseif( $xt == "dat" ) {
+	    $this->xscale = new DateScale($aXMin,$aXMax,"x");
+	}
+	elseif( $xt == "log" )
+	    $this->xscale = new LogScale($aXMin,$aXMax,"x");
+	else
+	    JpGraphError::RaiseL(25022,$aAxisType);//(" Unknown scale specification for X-scale. ($aAxisType)");
+
+	$this->xaxis = new Axis($this->img,$this->xscale);
+	$this->yaxis = new Axis($this->img,$this->yscale);
+	$this->xgrid = new Grid($this->xaxis);
+	$this->ygrid = new Grid($this->yaxis);	
+	$this->ygrid->Show();			
+    }
+	
+    // Specify secondary Y scale
+    function SetY2Scale($aAxisType="lin",$aY2Min=1,$aY2Max=1) {
+	if( $aAxisType=="lin" ) 
+	    $this->y2scale = new LinearScale($aY2Min,$aY2Max);
+	elseif( $aAxisType == "int" ) {
+	    $this->y2scale = new LinearScale($aY2Min,$aY2Max);
+	    $this->y2scale->SetIntScale();
+	}
+	elseif( $aAxisType=="log" ) {
+	    $this->y2scale = new LogScale($aY2Min,$aY2Max);
+	}
+	else JpGraphError::RaiseL(25023,$aAxisType);//("JpGraph: Unsupported Y2 axis type: $aAxisType\nMust be one of (lin,log,int)");
+			
+	$this->y2axis = new Axis($this->img,$this->y2scale);
+	$this->y2axis->scale->ticks->SetDirection(SIDE_LEFT); 
+	$this->y2axis->SetLabelSide(SIDE_RIGHT); 
+	$this->y2axis->SetPos('max');
+	$this->y2axis->SetTitleSide(SIDE_RIGHT);
+		
+	// Deafult position is the max x-value
+	$this->y2grid = new Grid($this->y2axis);							
+    }
+
+    // Set the delta position (in pixels) between the multiple Y-axis
+    function SetYDeltaDist($aDist) {
+	$this->iYAxisDeltaPos = $aDist;
+    }
+	
+    // Specify secondary Y scale
+    function SetYScale($aN,$aAxisType="lin",$aYMin=1,$aYMax=1) {
+
+	if( $aAxisType=="lin" ) 
+	    $this->ynscale[$aN] = new LinearScale($aYMin,$aYMax);
+	elseif( $aAxisType == "int" ) {
+	    $this->ynscale[$aN] = new LinearScale($aYMin,$aYMax);
+	    $this->ynscale[$aN]->SetIntScale();
+	}
+	elseif( $aAxisType=="log" ) {
+	    $this->ynscale[$aN] = new LogScale($aYMin,$aYMax);
+	}
+	else JpGraphError::RaiseL(25024,$aAxisType);//("JpGraph: Unsupported Y axis type: $aAxisType\nMust be one of (lin,log,int)");
+			
+	$this->ynaxis[$aN] = new Axis($this->img,$this->ynscale[$aN]);
+	$this->ynaxis[$aN]->scale->ticks->SetDirection(SIDE_LEFT); 
+	$this->ynaxis[$aN]->SetLabelSide(SIDE_RIGHT); 
+    }
+
+	
+    // Specify density of ticks when autoscaling 'normal', 'dense', 'sparse', 'verysparse'
+    // The dividing factor have been determined heuristically according to my aesthetic 
+    // sense (or lack off) y.m.m.v !
+    function SetTickDensity($aYDensity=TICKD_NORMAL,$aXDensity=TICKD_NORMAL) {
+	$this->xtick_factor=30;
+	$this->ytick_factor=25;		
+	switch( $aYDensity ) {
+	    case TICKD_DENSE:
+		$this->ytick_factor=12;			
+		break;
+	    case TICKD_NORMAL:
+		$this->ytick_factor=25;			
+		break;
+	    case TICKD_SPARSE:
+		$this->ytick_factor=40;			
+		break;
+	    case TICKD_VERYSPARSE:
+		$this->ytick_factor=100;			
+		break;		
+	    default:
+		JpGraphError::RaiseL(25025,$densy);//("JpGraph: Unsupported Tick density: $densy");
+	}
+	switch( $aXDensity ) {
+	    case TICKD_DENSE:
+		$this->xtick_factor=15;							
+		break;
+	    case TICKD_NORMAL:
+		$this->xtick_factor=30;			
+		break;
+	    case TICKD_SPARSE:
+		$this->xtick_factor=45;					
+		break;
+	    case TICKD_VERYSPARSE:
+		$this->xtick_factor=60;								
+		break;		
+	    default:
+		JpGraphError::RaiseL(25025,$densx);//("JpGraph: Unsupported Tick density: $densx");
+	}		
+    }
+	
+
+    // Get a string of all image map areas	
+    function GetCSIMareas() {
+	if( !$this->iHasStroked )
+	    $this->Stroke(_CSIM_SPECIALFILE);
+
+	$csim = $this->title->GetCSIMAreas();
+	$csim .= $this->subtitle->GetCSIMAreas();
+	$csim .= $this->subsubtitle->GetCSIMAreas();
+	$csim .= $this->legend->GetCSIMAreas();
+
+	if( $this->y2axis != NULL ) {
+	    $csim .= $this->y2axis->title->GetCSIMAreas();
+	}
+
+	if( $this->texts != null ) {
+	    $n = count($this->texts);
+	    for($i=0; $i < $n; ++$i ) {
+		$csim .= $this->texts[$i]->GetCSIMAreas();
+	    }
+	}
+
+	if( $this->y2texts != null && $this->y2scale != null ) {
+	    $n = count($this->y2texts);
+	    for($i=0; $i < $n; ++$i ) {
+		$csim .= $this->y2texts[$i]->GetCSIMAreas();
+	    }
+	}
+
+	if( $this->yaxis != null && $this->xaxis != null ) {
+	    $csim .= $this->yaxis->title->GetCSIMAreas();	
+	    $csim .= $this->xaxis->title->GetCSIMAreas();
+	}
+
+	$n = count($this->plots);
+	for( $i=0; $i < $n; ++$i ) 
+	    $csim .= $this->plots[$i]->GetCSIMareas();
+
+	$n = count($this->y2plots);
+	for( $i=0; $i < $n; ++$i ) 
+	    $csim .= $this->y2plots[$i]->GetCSIMareas();
+
+	$n = count($this->ynaxis);
+	for( $i=0; $i < $n; ++$i ) {
+	    $m = count($this->ynplots[$i]); 
+	    for($j=0; $j < $m; ++$j ) {
+		$csim .= $this->ynplots[$i][$j]->GetCSIMareas();
+	    }
+	}
+
+	$n = count($this->iTables);
+	for( $i=0; $i < $n; ++$i ) {
+	    $csim .= $this->iTables[$i]->GetCSIMareas();
+	}
+
+	return $csim;
+    }
+	
+    // Get a complete <MAP>..</MAP> tag for the final image map
+    function GetHTMLImageMap($aMapName) {
+	//$im = "<map name=\"$aMapName\" id=\"$aMapName\">\n";
+	$im = "<map name=\"$aMapName\" />\n";
+	$im .= $this->GetCSIMareas();
+	$im .= "</map>"; 
+	return $im;
+    }
+
+    function CheckCSIMCache($aCacheName,$aTimeOut=60) {
+	global $_SERVER;
+
+	if( $aCacheName=='auto' )
+	    $aCacheName=basename($_SERVER['PHP_SELF']);
+
+	$this->csimcachename = CSIMCACHE_DIR.$aCacheName;
+	$this->csimcachetimeout = $aTimeOut;
+
+	// First determine if we need to check for a cached version
+	// This differs from the standard cache in the sense that the
+	// image and CSIM map HTML file is written relative to the directory
+	// the script executes in and not the specified cache directory.
+	// The reason for this is that the cache directory is not necessarily
+	// accessible from the HTTP server.
+	if( $this->csimcachename != '' ) {
+	    $dir = dirname($this->csimcachename);
+	    $base = basename($this->csimcachename);
+	    $base = strtok($base,'.');
+	    $suffix = strtok('.');
+	    $basecsim = $dir.'/'.$base.'_csim_.html';
+	    $baseimg = $dir.'/'.$base.'.'.$this->img->img_format;
+
+	    $timedout=false;
+		
+	    // Does it exist at all ?
+	    
+	    if( file_exists($basecsim) && file_exists($baseimg) ) {
+		// Check that it hasn't timed out
+		$diff=time()-filemtime($basecsim);
+		if( $this->csimcachetimeout>0 && ($diff > $this->csimcachetimeout*60) ) {
+		    $timedout=true;
+		    @unlink($basecsim);
+		    @unlink($baseimg);
+		}
+		else {
+		    if ($fh = @fopen($basecsim, "r")) {
+			fpassthru($fh);
+			return true;
+		    }
+		    else
+			JpGraphError::RaiseL(25027,$basecsim);//(" Can't open cached CSIM \"$basecsim\" for reading.");
+		}
+	    }
+	}
+	return false;
+    }
+
+    function StrokeCSIM($aScriptName='auto',$aCSIMName='',$aBorder=0) {
+	if( $aCSIMName=='' ) {
+	    // create a random map name
+	    srand ((double) microtime() * 1000000);
+	    $r = rand(0,100000);
+	    $aCSIMName='__mapname'.$r.'__';
+	}
+
+	if( $aScriptName=='auto' )
+	    $aScriptName=basename($_SERVER['PHP_SELF']);
+
+	if( empty($_GET[_CSIM_DISPLAY]) ) {
+	    // First determine if we need to check for a cached version
+	    // This differs from the standard cache in the sense that the
+	    // image and CSIM map HTML file is written relative to the directory
+	    // the script executes in and not the specified cache directory.
+	    // The reason for this is that the cache directory is not necessarily
+	    // accessible from the HTTP server.
+	    if( $this->csimcachename != '' ) {
+		$dir = dirname($this->csimcachename);
+		$base = basename($this->csimcachename);
+		$base = strtok($base,'.');
+		$suffix = strtok('.');
+		$basecsim = $dir.'/'.$base.'_csim_.html';
+		$baseimg = $base.'.'.$this->img->img_format;
+
+		// Check that apache can write to directory specified
+
+		if( file_exists($dir) && !is_writeable($dir) ) {
+		    JpgraphError::RaiseL(25028,$dir);//('Apache/PHP does not have permission to write to the CSIM cache directory ('.$dir.'). Check permissions.');
+		}
+		
+		// Make sure directory exists
+		$this->cache->MakeDirs($dir);
+
+		// Write the image file
+		$this->Stroke(CSIMCACHE_DIR.$baseimg);
+
+		// Construct wrapper HTML and write to file and send it back to browser
+		$htmlwrap = $this->GetHTMLImageMap($aCSIMName)."\n".
+		    '<img src="'.htmlentities(CSIMCACHE_HTTP_DIR.$baseimg).'" ismap usemap="#'.$aCSIMName.'" border='.$aBorder.' width='.$this->img->width.' height='.$this->img->height." alt=\"\" />\n";
+		if($fh =  @fopen($basecsim,'w') ) {
+		    fwrite($fh,$htmlwrap);
+		    fclose($fh);
+		    echo $htmlwrap;
+		}
+		else
+		    JpGraphError::RaiseL(25029,$basecsim);//(" Can't write CSIM \"$basecsim\" for writing. Check free space and permissions.");
+	    }
+	    else {
+
+		if( $aScriptName=='' ) {
+		    JpGraphError::RaiseL(25030);//('Missing script name in call to StrokeCSIM(). You must specify the name of the actual image script as the first parameter to StrokeCSIM().');
+		    exit();
+		}
+
+		
+		// This is a JPGRAPH internal defined that prevents
+		// us from recursively coming here again
+		$urlarg='?'._CSIM_DISPLAY.'=1';
+
+		// Now reconstruct any user URL argument
+		reset($_GET);
+		while( list($key,$value) = each($_GET) ) {
+		    if( is_array($value) ) {
+			$n = count($value);
+			for( $i=0; $i < $n; ++$i ) {
+			    $urlarg .= '&'.$key.'%5B%5D='.urlencode($value[$i]);
+			}
+		    }
+		    else {
+			$urlarg .= '&'.$key.'='.urlencode($value);
+		    }
+		}
+
+		// It's not ideal to convert POST argument to GET arguments
+		// but there is little else we can do. One idea for the 
+		// future might be recreate the POST header in case.
+		reset($_POST);
+		while( list($key,$value) = each($_POST) ) {
+		    if( is_array($value) ) {
+			$n = count($value);
+			for( $i=0; $i < $n; ++$i ) {
+			    $urlarg .= '&'.$key.'%5B%5D='.urlencode($value[$i]);
+			}
+		    }
+		    else {
+			$urlarg .= '&'.$key.'='.urlencode($value);
+		    }
+		}
+
+		echo $this->GetHTMLImageMap($aCSIMName);
+
+		echo "<img src='".htmlentities($aScriptName.$urlarg)."' ismap usemap='#".$aCSIMName.'\' border='.$aBorder.'  width='.$this->img->width.' height='.$this->img->height." alt=\"\" />\n";
+	    }
+	}
+	else {
+	    $this->Stroke();
+	}
+    }
+
+    function GetTextsYMinMax($aY2=false) {
+	if( $aY2 ) 
+	    $txts = $this->y2texts;
+	else
+	    $txts = $this->texts;
+	$n = count($txts);
+	$min=null;
+	$max=null;
+	for( $i=0; $i < $n; ++$i ) {
+	    if( $txts[$i]->iScalePosY !== null && 
+		$txts[$i]->iScalePosX !== null  ) {
+		if( $min === null  ) {
+		    $min = $max = $txts[$i]->iScalePosY ;
+		}
+		else {
+		    $min = min($min,$txts[$i]->iScalePosY);
+		    $max = max($max,$txts[$i]->iScalePosY);
+		}
+	    }
+	}
+	if( $min !== null ) {
+	    return array($min,$max);
+	}
+	else
+	    return null;
+    }
+
+    function GetTextsXMinMax($aY2=false) {
+	if( $aY2 ) 
+	    $txts = $this->y2texts;
+	else
+	    $txts = $this->texts;
+	$n = count($txts);
+	$min=null;
+	$max=null;
+	for( $i=0; $i < $n; ++$i ) {
+	    if( $txts[$i]->iScalePosY !== null && 
+		$txts[$i]->iScalePosX !== null  ) {
+		if( $min === null  ) {
+		    $min = $max = $txts[$i]->iScalePosX ;
+		}
+		else {
+		    $min = min($min,$txts[$i]->iScalePosX);
+		    $max = max($max,$txts[$i]->iScalePosX);
+		}
+	    }
+	}
+	if( $min !== null ) {
+	    return array($min,$max);
+	}
+	else
+	    return null;
+    }
+
+    function GetXMinMax() {
+	list($min,$ymin) = $this->plots[0]->Min();
+	list($max,$ymax) = $this->plots[0]->Max();
+	foreach( $this->plots as $p ) {
+	    list($xmin,$ymin) = $p->Min();
+	    list($xmax,$ymax) = $p->Max();			
+	    $min = Min($xmin,$min);
+	    $max = Max($xmax,$max);
+	}
+	if( $this->y2axis != null ) {
+	    foreach( $this->y2plots as $p ) {
+		list($xmin,$ymin) = $p->Min();
+		list($xmax,$ymax) = $p->Max();			
+		$min = Min($xmin,$min);
+		$max = Max($xmax,$max);
+	    }		    
+	}
+
+	$n = count($this->ynaxis);
+	for( $i=0; $i < $n; ++$i ) {
+	    if( $this->ynaxis[$i] != null) {
+		foreach( $this->ynplots[$i] as $p ) {
+		    list($xmin,$ymin) = $p->Min();
+		    list($xmax,$ymax) = $p->Max();			
+		    $min = Min($xmin,$min);
+		    $max = Max($xmax,$max);
+		}		    
+	    }
+	}
+
+	return array($min,$max);
+    }
+
+    function AdjustMarginsForTitles() {
+	$totrequired = 
+	    ($this->title->t != '' ? 
+	     $this->title->GetTextHeight($this->img) + $this->title->margin + 5 : 0 ) +
+	    ($this->subtitle->t != '' ? 
+	     $this->subtitle->GetTextHeight($this->img) + $this->subtitle->margin + 5 : 0 ) + 
+	    ($this->subsubtitle->t != '' ? 
+	     $this->subsubtitle->GetTextHeight($this->img) + $this->subsubtitle->margin + 5 : 0 ) ;
+	
+
+	$btotrequired = 0;
+	if($this->xaxis != null &&  !$this->xaxis->hide && !$this->xaxis->hide_labels ) {
+	    // Minimum bottom margin
+	    if( $this->xaxis->title->t != '' ) {
+		if( $this->img->a == 90 ) 
+		    $btotrequired = $this->yaxis->title->GetTextHeight($this->img) + 5 ;
+		else
+		    $btotrequired = $this->xaxis->title->GetTextHeight($this->img) + 5 ;
+	    }
+	    else
+		$btotrequired = 0;
+	    
+	    if( $this->img->a == 90 ) {
+		$this->img->SetFont($this->yaxis->font_family,$this->yaxis->font_style,
+				    $this->yaxis->font_size);
+		$lh = $this->img->GetTextHeight('Mg',$this->yaxis->label_angle);
+	    }
+	    else {
+		$this->img->SetFont($this->xaxis->font_family,$this->xaxis->font_style,
+				    $this->xaxis->font_size);
+		$lh = $this->img->GetTextHeight('Mg',$this->xaxis->label_angle);
+	    }
+	    
+	    $btotrequired += $lh + 5;
+	}
+
+	if( $this->img->a == 90 ) {
+	    // DO Nothing. It gets too messy to do this properly for 90 deg...
+	}
+	else{
+	    if( $this->img->top_margin < $totrequired ) {
+		$this->SetMargin($this->img->left_margin,$this->img->right_margin,
+				 $totrequired,$this->img->bottom_margin);
+	    }
+	    if( $this->img->bottom_margin < $btotrequired ) {
+		$this->SetMargin($this->img->left_margin,$this->img->right_margin,
+				 $this->img->top_margin,$btotrequired);
+	    }
+	}
+    }
+
+    // Stroke the graph
+    // $aStrokeFileName	If != "" the image will be written to this file and NOT
+    // streamed back to the browser
+    function Stroke($aStrokeFileName="") {		
+
+	// Fist make a sanity check that user has specified a scale
+	if( empty($this->yscale) ) {
+	    JpGraphError::RaiseL(25031);//('You must specify what scale to use with a call to Graph::SetScale().');
+	}
+
+	// Start by adjusting the margin so that potential titles will fit.
+	$this->AdjustMarginsForTitles();
+
+	// Setup scale constants
+	if( $this->yscale ) $this->yscale->InitConstants($this->img);
+	if( $this->xscale ) $this->xscale->InitConstants($this->img);
+	if( $this->y2scale ) $this->y2scale->InitConstants($this->img);
+	
+	$n=count($this->ynscale);
+	for($i=0; $i < $n; ++$i) {
+	  if( $this->ynscale[$i] ) $this->ynscale[$i]->InitConstants($this->img);
+	}
+
+	// If the filename is the predefined value = '_csim_special_'
+	// we assume that the call to stroke only needs to do enough
+	// to correctly generate the CSIM maps.
+	// We use this variable to skip things we don't strictly need
+	// to do to generate the image map to improve performance
+	// a best we can. Therefor you will see a lot of tests !$_csim in the
+	// code below.
+	$_csim = ($aStrokeFileName===_CSIM_SPECIALFILE);
+
+	// We need to know if we have stroked the plot in the
+	// GetCSIMareas. Otherwise the CSIM hasn't been generated
+	// and in the case of GetCSIM called before stroke to generate
+	// CSIM without storing an image to disk GetCSIM must call Stroke.
+	$this->iHasStroked = true;
+
+	// Do any pre-stroke adjustment that is needed by the different plot types
+	// (i.e bar plots want's to add an offset to the x-labels etc)
+	for($i=0; $i < count($this->plots) ; ++$i ) {
+	    $this->plots[$i]->PreStrokeAdjust($this);
+	    $this->plots[$i]->DoLegend($this);
+	}
+		
+	// Any plots on the second Y scale?
+	if( $this->y2scale != null ) {
+	    for($i=0; $i<count($this->y2plots)	; ++$i ) {
+		$this->y2plots[$i]->PreStrokeAdjust($this);
+		$this->y2plots[$i]->DoLegend($this);
+	    }
+	}
+
+	// Any plots on the extra Y axises?
+	$n = count($this->ynaxis);
+	for($i=0; $i<$n	; ++$i ) {
+	    if( $this->ynplots == null || $this->ynplots[$i] == null) {
+		JpGraphError::RaiseL(25032,$i);//("No plots for Y-axis nbr:$i");
+	    } 
+	    $m = count($this->ynplots[$i]); 
+	    for($j=0; $j < $m; ++$j ) {
+		$this->ynplots[$i][$j]->PreStrokeAdjust($this);
+		$this->ynplots[$i][$j]->DoLegend($this);
+	    }
+	}
+
+		
+	// Bail out if any of the Y-axis not been specified and
+	// has no plots. (This means it is impossible to do autoscaling and
+	// no other scale was given so we can't possible draw anything). If you use manual
+	// scaling you also have to supply the tick steps as well.
+	if( (!$this->yscale->IsSpecified() && count($this->plots)==0) ||
+	    ($this->y2scale!=null && !$this->y2scale->IsSpecified() && count($this->y2plots)==0) ) {
+	    //$e = "n=".count($this->y2plots)."\n";
+	    // $e = "Can't draw unspecified Y-scale.<br>\nYou have either:<br>\n";
+	    // $e .= "1. Specified an Y axis for autoscaling but have not supplied any plots<br>\n";
+	    // $e .= "2. Specified a scale manually but have forgot to specify the tick steps";
+	    JpGraphError::RaiseL(25026);
+	}
+		
+	// Bail out if no plots and no specified X-scale
+	if( (!$this->xscale->IsSpecified() && count($this->plots)==0 && count($this->y2plots)==0) )
+	    JpGraphError::RaiseL(25034);//("<strong>JpGraph: Can't draw unspecified X-scale.</strong><br>No plots.<br>");
+
+	//Check if we should autoscale y-axis
+	if( !$this->yscale->IsSpecified() && count($this->plots)>0 ) {
+	    list($min,$max) = $this->GetPlotsYMinMax($this->plots);
+ 	    $lres = $this->GetLinesYMinMax($this->lines);
+	    if( is_array($lres) ) {
+		list($linmin,$linmax) = $lres ;
+		$min = min($min,$linmin);
+		$max = max($max,$linmax);
+	    }
+	    $tres = $this->GetTextsYMinMax();
+	    if( is_array($tres) ) {
+		list($tmin,$tmax) = $tres ;
+		$min = min($min,$tmin);
+		$max = max($max,$tmax);
+	    }
+	    $this->yscale->AutoScale($this->img,$min,$max,
+				     $this->img->plotheight/$this->ytick_factor);
+	}
+	elseif( $this->yscale->IsSpecified() && 
+		( $this->yscale->auto_ticks || !$this->yscale->ticks->IsSpecified()) ) {
+	    // The tick calculation will use the user suplied min/max values to determine
+	    // the ticks. If auto_ticks is false the exact user specifed min and max
+	    // values will be used for the scale. 
+	    // If auto_ticks is true then the scale might be slightly adjusted
+	    // so that the min and max values falls on an even major step.
+	    $min = $this->yscale->scale[0];
+	    $max = $this->yscale->scale[1];
+	    $this->yscale->AutoScale($this->img,$min,$max,
+				     $this->img->plotheight/$this->ytick_factor,
+				     $this->yscale->auto_ticks);
+	}
+
+	if( $this->y2scale != null) {
+	  
+	    if( !$this->y2scale->IsSpecified() && count($this->y2plots)>0 ) {
+		list($min,$max) = $this->GetPlotsYMinMax($this->y2plots);
+		$lres = $this->GetLinesYMinMax($this->y2lines);
+		if( is_array($lres) ) {
+		    list($linmin,$linmax) = $lres ;
+		    $min = min($min,$linmin);
+		    $max = max($max,$linmax);
+		}
+		$tres = $this->GetTextsYMinMax(true);
+		if( is_array($tres) ) {
+		    list($tmin,$tmax) = $tres ;
+		    $min = min($min,$tmin);
+		    $max = max($max,$tmax);
+		}
+		$this->y2scale->AutoScale($this->img,$min,$max,$this->img->plotheight/$this->ytick_factor);
+	    }			
+	    elseif( $this->y2scale->IsSpecified() && 
+		    ( $this->y2scale->auto_ticks || !$this->y2scale->ticks->IsSpecified()) ) {
+		// The tick calculation will use the user suplied min/max values to determine
+		// the ticks. If auto_ticks is false the exact user specifed min and max
+		// values will be used for the scale. 
+		// If auto_ticks is true then the scale might be slightly adjusted
+		// so that the min and max values falls on an even major step.
+		$min = $this->y2scale->scale[0];
+		$max = $this->y2scale->scale[1];
+		$this->y2scale->AutoScale($this->img,$min,$max,
+					  $this->img->plotheight/$this->ytick_factor,
+					  $this->y2scale->auto_ticks);
+	    }
+	}
+
+	//
+	// Autoscale the multiple Y-axis
+	//
+	$n = count($this->ynaxis);
+	for( $i=0; $i < $n; ++$i ) {
+	  if( $this->ynscale[$i] != null) {
+	    if( !$this->ynscale[$i]->IsSpecified() && count($this->ynplots[$i])>0 ) {
+	      list($min,$max) = $this->GetPlotsYMinMax($this->ynplots[$i]);
+	      $this->ynscale[$i]->AutoScale($this->img,$min,$max,$this->img->plotheight/$this->ytick_factor);
+	    }			
+	    elseif( $this->ynscale[$i]->IsSpecified() && 
+		    ( $this->ynscale[$i]->auto_ticks || !$this->ynscale[$i]->ticks->IsSpecified()) ) {
+		// The tick calculation will use the user suplied min/max values to determine
+		// the ticks. If auto_ticks is false the exact user specifed min and max
+		// values will be used for the scale. 
+		// If auto_ticks is true then the scale might be slightly adjusted
+		// so that the min and max values falls on an even major step.
+	      $min = $this->ynscale[$i]->scale[0];
+	      $max = $this->ynscale[$i]->scale[1];
+	      $this->ynscale[$i]->AutoScale($this->img,$min,$max,
+					    $this->img->plotheight/$this->ytick_factor,
+					    $this->ynscale[$i]->auto_ticks);
+	    }
+	  }
+	}
+		
+
+	//Check if we should autoscale x-axis
+	if( !$this->xscale->IsSpecified() ) {
+	    if( substr($this->axtype,0,4) == "text" ) {
+		$max=0;
+		$n = count($this->plots);
+		for($i=0; $i < $n; ++$i ) {
+		    $p = $this->plots[$i];
+		    // We need some unfortunate sub class knowledge here in order
+		    // to increase number of data points in case it is a line plot
+		    // which has the barcenter set. If not it could mean that the
+		    // last point of the data is outside the scale since the barcenter
+		    // settings means that we will shift the entire plot half a tick step
+		    // to the right in oder to align with the center of the bars.
+		    if( is_a($p,'BarPlot') || empty($p->barcenter)) {
+			$max=max($max,$p->numpoints-1);
+		    }
+		    else {
+			$max=max($max,$p->numpoints);
+		    }
+		}
+		$min=0;
+		if( $this->y2axis != null ) {
+		    foreach( $this->y2plots as $p ) {
+			$max=max($max,$p->numpoints-1);
+		    }		    
+		}
+		$n = count($this->ynaxis);
+		for( $i=0; $i < $n; ++$i ) {
+		    if( $this->ynaxis[$i] != null) {
+			foreach( $this->ynplots[$i] as $p ) {
+			    $max=max($max,$p->numpoints-1);
+			}		    
+		    }
+		}
+		
+		$this->xscale->Update($this->img,$min,$max);
+		$this->xscale->ticks->Set($this->xaxis->tick_step,1);
+		$this->xscale->ticks->SupressMinorTickMarks();
+	    }
+	    else {
+		list($min,$max) = $this->GetXMinMax();
+		$lres = $this->GetLinesXMinMax($this->lines);
+		if( $lres ) {
+		    list($linmin,$linmax) = $lres ;
+		    $min = min($min,$linmin);
+		    $max = max($max,$linmax);
+		}
+		$lres = $this->GetLinesXMinMax($this->y2lines);
+		if( $lres ) {
+		    list($linmin,$linmax) = $lres ;
+		    $min = min($min,$linmin);
+		    $max = max($max,$linmax);
+		}
+
+		$tres = $this->GetTextsXMinMax();
+		if( $tres ) {
+		    list($tmin,$tmax) = $tres ;
+		    $min = min($min,$tmin);
+		    $max = max($max,$tmax);
+		}
+
+		$tres = $this->GetTextsXMinMax(true);
+		if( $tres ) {
+		    list($tmin,$tmax) = $tres ;
+		    $min = min($min,$tmin);
+		    $max = max($max,$tmax);
+		}
+
+		$this->xscale->AutoScale($this->img,$min,$max,round($this->img->plotwidth/$this->xtick_factor));
+	    }
+			
+	    //Adjust position of y-axis and y2-axis to minimum/maximum of x-scale
+	    if( !is_numeric($this->yaxis->pos) && !is_string($this->yaxis->pos) )
+	    	$this->yaxis->SetPos($this->xscale->GetMinVal());
+	    if( $this->y2axis != null ) {
+		if( !is_numeric($this->y2axis->pos) && !is_string($this->y2axis->pos) )
+		    $this->y2axis->SetPos($this->xscale->GetMaxVal());
+		$this->y2axis->SetTitleSide(SIDE_RIGHT);
+	    }
+
+	    $n = count($this->ynaxis);
+	    $nY2adj = $this->y2axis != null ? $this->iYAxisDeltaPos : 0;
+	    for( $i=0; $i < $n; ++$i ) { 
+		if( $this->ynaxis[$i] != null ) {
+		    if( !is_numeric($this->ynaxis[$i]->pos) && !is_string($this->ynaxis[$i]->pos) ) {
+			$this->ynaxis[$i]->SetPos($this->xscale->GetMaxVal());
+		  $this->ynaxis[$i]->SetPosAbsDelta($i*$this->iYAxisDeltaPos + $nY2adj);
+		    }
+		    $this->ynaxis[$i]->SetTitleSide(SIDE_RIGHT);
+		}
+	    }
+	}	
+	elseif( $this->xscale->IsSpecified() &&  
+		( $this->xscale->auto_ticks || !$this->xscale->ticks->IsSpecified()) ) {
+	    // The tick calculation will use the user suplied min/max values to determine
+	    // the ticks. If auto_ticks is false the exact user specifed min and max
+	    // values will be used for the scale. 
+	    // If auto_ticks is true then the scale might be slightly adjusted
+	    // so that the min and max values falls on an even major step.
+	    $min = $this->xscale->scale[0];
+	    $max = $this->xscale->scale[1];
+
+
+	    $this->xscale->AutoScale($this->img,$min,$max,
+				     $this->img->plotwidth/$this->xtick_factor,
+				     false);
+
+	    if( $this->y2axis != null ) {
+		if( !is_numeric($this->y2axis->pos) && !is_string($this->y2axis->pos) )
+		    $this->y2axis->SetPos($this->xscale->GetMaxVal());
+		$this->y2axis->SetTitleSide(SIDE_RIGHT);
+	    }
+
+	}
+		
+	// If we have a negative values and x-axis position is at 0
+	// we need to supress the first and possible the last tick since
+	// they will be drawn on top of the y-axis (and possible y2 axis)
+	// The test below might seem strange the reasone being that if
+	// the user hasn't specified a value for position this will not
+	// be set until we do the stroke for the axis so as of now it
+	// is undefined.
+	// For X-text scale we ignore all this since the tick are usually
+	// much further in and not close to the Y-axis. Hence the test 
+	// for 'text'	
+
+	if( ($this->yaxis->pos==$this->xscale->GetMinVal() || 
+	     (is_string($this->yaxis->pos) && $this->yaxis->pos=='min')) &&  
+	    !is_numeric($this->xaxis->pos) && $this->yscale->GetMinVal() < 0 && 
+	    substr($this->axtype,0,4) != 'text' && $this->xaxis->pos!="min" ) {
+
+	    //$this->yscale->ticks->SupressZeroLabel(false);
+	    $this->xscale->ticks->SupressFirst();
+	    if( $this->y2axis != null ) {
+		$this->xscale->ticks->SupressLast();
+	    }
+	}
+	elseif( !is_numeric($this->yaxis->pos) && $this->yaxis->pos=='max' ) {
+	    $this->xscale->ticks->SupressLast();
+	}
+	
+
+	if( !$_csim ) {
+	    $this->StrokePlotArea();
+	    if( $this->iIconDepth == DEPTH_BACK ) {
+		$this->StrokeIcons();
+	    }
+	}
+	$this->StrokeAxis();
+
+	// Stroke bands
+	if( $this->bands != null && !$_csim) 
+	    for($i=0; $i < count($this->bands); ++$i) {
+		// Stroke all bands that asks to be in the background
+		if( $this->bands[$i]->depth == DEPTH_BACK )
+		    $this->bands[$i]->Stroke($this->img,$this->xscale,$this->yscale);
+	    }
+
+	if( $this->y2bands != null && $this->y2scale != null && !$_csim )
+	    for($i=0; $i < count($this->y2bands); ++$i) {
+		// Stroke all bands that asks to be in the foreground
+		if( $this->y2bands[$i]->depth == DEPTH_BACK )
+		    $this->y2bands[$i]->Stroke($this->img,$this->xscale,$this->y2scale);
+	    }
+
+
+	if( $this->grid_depth == DEPTH_BACK && !$_csim) {
+	    $this->ygrid->Stroke();
+	    $this->xgrid->Stroke();
+	}
+				
+	// Stroke Y2-axis 
+	if( $this->y2axis != null && !$_csim) {		
+	    $this->y2axis->Stroke($this->xscale); 				
+	    $this->y2grid->Stroke();
+	}
+
+	// Stroke yn-axis
+	$n = count($this->ynaxis); 
+	for( $i=0; $i < $n; ++$i ) {
+	    $this->ynaxis[$i]->Stroke($this->xscale); 				
+	}
+	
+	$oldoff=$this->xscale->off;
+	if(substr($this->axtype,0,4)=="text") {
+	    if( $this->text_scale_abscenteroff > -1 ) {
+		// For a text scale the scale factor is the number of pixel per step. 
+		// Hence we can use the scale factor as a substitute for number of pixels
+		// per major scale step and use that in order to adjust the offset so that
+		// an object of width "abscenteroff" becomes centered.
+		$this->xscale->off += round($this->xscale->scale_factor/2)-round($this->text_scale_abscenteroff/2);
+	    }
+	    else {
+		$this->xscale->off += 
+		    ceil($this->xscale->scale_factor*$this->text_scale_off*$this->xscale->ticks->minor_step);
+	    }
+	}
+
+	if( $this->iDoClipping ) {
+	    $oldimage = $this->img->CloneCanvasH();
+	}
+
+	if( ! $this->y2orderback ) {
+	    // Stroke all plots for Y axis
+	    for($i=0; $i < count($this->plots); ++$i) {
+		$this->plots[$i]->Stroke($this->img,$this->xscale,$this->yscale);
+		$this->plots[$i]->StrokeMargin($this->img);
+	    }						
+	}
+
+	// Stroke all plots for Y2 axis
+	if( $this->y2scale != null )
+	    for($i=0; $i< count($this->y2plots); ++$i ) {	
+		$this->y2plots[$i]->Stroke($this->img,$this->xscale,$this->y2scale);
+	    }		
+
+	if( $this->y2orderback ) {
+	    // Stroke all plots for Y1 axis
+	    for($i=0; $i < count($this->plots); ++$i) {
+		$this->plots[$i]->Stroke($this->img,$this->xscale,$this->yscale);
+		$this->plots[$i]->StrokeMargin($this->img);
+	    }						
+	}
+
+	$n = count($this->ynaxis); 
+	for( $i=0; $i < $n; ++$i ) {
+	    $m = count($this->ynplots[$i]);
+	    for( $j=0; $j < $m; ++$j ) { 
+		$this->ynplots[$i][$j]->Stroke($this->img,$this->xscale,$this->ynscale[$i]);
+		$this->ynplots[$i][$j]->StrokeMargin($this->img);
+	    }
+	}
+
+	if( $this->iIconDepth == DEPTH_FRONT) {
+	    $this->StrokeIcons();
+	}
+	
+	if( $this->iDoClipping ) {
+	    // Clipping only supports graphs at 0 and 90 degrees
+	    if( $this->img->a == 0 ) {
+		$this->img->CopyCanvasH($oldimage,$this->img->img,
+					$this->img->left_margin,$this->img->top_margin,
+					$this->img->left_margin,$this->img->top_margin,
+					$this->img->plotwidth+1,$this->img->plotheight);
+	    }
+	    elseif( $this->img->a == 90 ) {
+		$adj = ($this->img->height - $this->img->width)/2;
+		$this->img->CopyCanvasH($oldimage,$this->img->img,
+					$this->img->bottom_margin-$adj,$this->img->left_margin+$adj,
+					$this->img->bottom_margin-$adj,$this->img->left_margin+$adj,
+					$this->img->plotheight+1,$this->img->plotwidth);
+	    }
+	    else {
+		JpGraphError::RaiseL(25035,$this->img->a);//('You have enabled clipping. Cliping is only supported for graphs at 0 or 90 degrees rotation. Please adjust you current angle (='.$this->img->a.' degrees) or disable clipping.');
+	    }
+	    $this->img->Destroy();
+	    $this->img->SetCanvasH($oldimage);
+	}
+
+	$this->xscale->off=$oldoff;
+		
+	if( $this->grid_depth == DEPTH_FRONT && !$_csim ) {
+	    $this->ygrid->Stroke();
+	    $this->xgrid->Stroke();
+	}
+
+	// Stroke bands
+	if( $this->bands!= null )
+	    for($i=0; $i < count($this->bands); ++$i) {
+		// Stroke all bands that asks to be in the foreground
+		if( $this->bands[$i]->depth == DEPTH_FRONT )
+		    $this->bands[$i]->Stroke($this->img,$this->xscale,$this->yscale);
+	    }
+
+	if( $this->y2bands!= null && $this->y2scale != null )
+	    for($i=0; $i < count($this->y2bands); ++$i) {
+		// Stroke all bands that asks to be in the foreground
+		if( $this->y2bands[$i]->depth == DEPTH_FRONT )
+		    $this->y2bands[$i]->Stroke($this->img,$this->xscale,$this->y2scale);
+	    }
+
+
+	// Stroke any lines added
+	if( $this->lines != null ) {
+	    for($i=0; $i < count($this->lines); ++$i) {
+		$this->lines[$i]->Stroke($this->img,$this->xscale,$this->yscale);
+	    }
+	}
+
+	if( $this->y2lines != null && $this->y2scale != null ) {
+	    for($i=0; $i < count($this->y2lines); ++$i) {
+		$this->y2lines[$i]->Stroke($this->img,$this->xscale,$this->y2scale);
+	    }
+	}
+
+	// Finally draw the axis again since some plots may have nagged
+	// the axis in the edges.However we do no stroke the labels again
+	// since any user defined callback would be called twice. It also
+	// enhances performance.
+
+	if( !$_csim )
+	    $this->StrokeAxis(false);
+
+	if( $this->y2scale != null && !$_csim ) 
+	    $this->y2axis->Stroke($this->xscale,false); 	
+		
+	if( !$_csim ) {
+	    $this->StrokePlotBox();
+	}
+		
+	// The titles and legends never gets rotated so make sure
+	// that the angle is 0 before stroking them				
+	$aa = $this->img->SetAngle(0);
+	$this->StrokeTitles();
+	$this->footer->Stroke($this->img);
+	$this->legend->Stroke($this->img);		
+	$this->img->SetAngle($aa);	
+	$this->StrokeTexts();	
+	$this->StrokeTables();
+
+	if( !$_csim ) {
+
+	    $this->img->SetAngle($aa);	
+			
+	    // Draw an outline around the image map	
+	    if(_JPG_DEBUG) {
+		$this->DisplayClientSideaImageMapAreas();		
+	    }
+	    
+	    // Adjust the appearance of the image
+	    $this->AdjustSaturationBrightnessContrast();
+
+	    // Should we do any final image transformation
+	    if( $this->iImgTrans ) {
+		if( !class_exists('ImgTrans') ) {
+		    require_once('jpgraph_imgtrans.php');
+		    //JpGraphError::Raise('In order to use image transformation you must include the file jpgraph_imgtrans.php in your script.');
+		}
+	       
+		$tform = new ImgTrans($this->img->img);
+		$this->img->img = $tform->Skew3D($this->iImgTransHorizon,$this->iImgTransSkewDist,
+						 $this->iImgTransDirection,$this->iImgTransHighQ,
+						 $this->iImgTransMinSize,$this->iImgTransFillColor,
+						 $this->iImgTransBorder);
+	    }
+
+	    // If the filename is given as the special "__handle"
+	    // then the image handler is returned and the image is NOT
+	    // streamed back
+	    if( $aStrokeFileName == _IMG_HANDLER ) {
+		return $this->img->img;
+	    }
+	    else {
+		// Finally stream the generated picture					
+		$this->cache->PutAndStream($this->img,$this->cache_name,$this->inline,$aStrokeFileName);		
+	    }
+	}
+    }
+
+    function SetAxisLabelBackground($aType,$aXFColor='lightgray',$aXColor='black',$aYFColor='lightgray',$aYColor='black') {
+	$this->iAxisLblBgType = $aType;
+	$this->iXAxisLblBgFillColor = $aXFColor;
+	$this->iXAxisLblBgColor = $aXColor;
+	$this->iYAxisLblBgFillColor = $aYFColor;
+	$this->iYAxisLblBgColor = $aYColor;
+    }
+
+//---------------
+// PRIVATE METHODS	
+
+    function StrokeAxisLabelBackground() {
+	// Types 
+	// 0 = No background
+	// 1 = Only X-labels, length of axis
+	// 2 = Only Y-labels, length of axis
+	// 3 = As 1 but extends to width of graph
+	// 4 = As 2 but extends to height of graph
+	// 5 = Combination of 3 & 4
+	// 6 = Combination of 1 & 2
+ 
+	$t = $this->iAxisLblBgType ;
+	if( $t < 1 ) return;
+	// Stroke optional X-axis label background color
+	if( $t == 1 || $t == 3 || $t == 5 || $t == 6 ) {
+	    $this->img->PushColor($this->iXAxisLblBgFillColor);
+	    if( $t == 1 || $t == 6 ) {
+		$xl = $this->img->left_margin;
+		$yu = $this->img->height - $this->img->bottom_margin + 1;
+		$xr = $this->img->width - $this->img->right_margin ;
+		$yl = $this->img->height-1-$this->frame_weight;
+	    }
+	    else { // t==3 || t==5
+		$xl = $this->frame_weight;
+		$yu = $this->img->height - $this->img->bottom_margin + 1;
+		$xr = $this->img->width - 1 - $this->frame_weight;
+		$yl = $this->img->height-1-$this->frame_weight;
+	    }
+
+	    $this->img->FilledRectangle($xl,$yu,$xr,$yl);
+	    $this->img->PopColor();
+
+	    // Check if we should add the vertical lines at left and right edge
+	    if( $this->iXAxisLblBgColor !== '' ) {
+		$this->img->PushColor($this->iXAxisLblBgColor);
+		if( $t == 1 || $t == 6 ) {
+		    $this->img->Line($xl,$yu,$xl,$yl);
+		    $this->img->Line($xr,$yu,$xr,$yl);
+		}
+		else {
+		    $xl = $this->img->width - $this->img->right_margin ;
+		    $this->img->Line($xl,$yu-1,$xr,$yu-1);
+		}
+		$this->img->PopColor();
+	    }
+	}
+
+	if( $t == 2 || $t == 4 || $t == 5 || $t == 6 ) {
+	    $this->img->PushColor($this->iYAxisLblBgFillColor);
+	    if( $t == 2 || $t == 6 ) {	    
+		$xl = $this->frame_weight;
+		$yu = $this->frame_weight+$this->img->top_margin;
+		$xr = $this->img->left_margin - 1;
+		$yl = $this->img->height - $this->img->bottom_margin + 1;
+	    }
+	    else {
+		$xl = $this->frame_weight;
+		$yu = $this->frame_weight;
+		$xr = $this->img->left_margin - 1;
+		$yl = $this->img->height-1-$this->frame_weight;
+	    }
+
+	    $this->img->FilledRectangle($xl,$yu,$xr,$yl);
+	    $this->img->PopColor();
+
+	    // Check if we should add the vertical lines at left and right edge
+	    if( $this->iXAxisLblBgColor !== '' ) {
+		$this->img->PushColor($this->iXAxisLblBgColor);
+		if( $t == 2 || $t == 6 ) {
+		    $this->img->Line($xl,$yu-1,$xr,$yu-1);
+		    $this->img->Line($xl,$yl-1,$xr,$yl-1);		    
+		}
+		else {
+		    $this->img->Line($xr+1,$yu,$xr+1,$this->img->top_margin);		    
+		}
+		$this->img->PopColor();
+	    }
+
+	}
+    }
+
+    function StrokeAxis($aStrokeLabels=true) {
+	
+	if( $aStrokeLabels ) {
+	    $this->StrokeAxisLabelBackground();
+	}
+
+	// Stroke axis
+	if( $this->iAxisStyle != AXSTYLE_SIMPLE ) {
+	    switch( $this->iAxisStyle ) {
+	        case AXSTYLE_BOXIN :
+	            $toppos = SIDE_DOWN;
+		    $bottompos = SIDE_UP;
+	            $leftpos = SIDE_RIGHT;
+	            $rightpos = SIDE_LEFT;
+	            break;
+		case AXSTYLE_BOXOUT :
+		    $toppos = SIDE_UP;
+	            $bottompos = SIDE_DOWN;	    
+	            $leftpos = SIDE_LEFT;
+		    $rightpos = SIDE_RIGHT;
+	            break;
+		case AXSTYLE_YBOXIN:
+	            $toppos = -100;
+		    $bottompos = SIDE_UP;
+	            $leftpos = SIDE_RIGHT;
+	            $rightpos = SIDE_LEFT;
+		    break;
+		case AXSTYLE_YBOXOUT:
+		    $toppos = -100;
+	            $bottompos = SIDE_DOWN;	    
+	            $leftpos = SIDE_LEFT;
+		    $rightpos = SIDE_RIGHT;
+		    break;
+		default:
+	            JpGRaphError::RaiseL(25036,$this->iAxisStyle); //('Unknown AxisStyle() : '.$this->iAxisStyle);
+	            break;
+	    }
+	    $this->xaxis->SetPos('min');
+	    
+	    // By default we hide the first label so it doesn't cross the
+	    // Y-axis in case the positon hasn't been set by the user.
+	    // However, if we use a box we always want the first value
+	    // displayed so we make sure it will be displayed.
+	    $this->xscale->ticks->SupressFirst(false);
+	    
+	    $this->xaxis->SetLabelSide(SIDE_DOWN);
+	    $this->xaxis->scale->ticks->SetSide($bottompos);
+	    $this->xaxis->Stroke($this->yscale);
+
+	    if( $toppos != -100 ) {
+		// To avoid side effects we work on a new copy
+		$maxis = $this->xaxis;
+		$maxis->SetPos('max');
+		$maxis->SetLabelSide(SIDE_UP);
+		$maxis->SetLabelMargin(7);
+		$this->xaxis->scale->ticks->SetSide($toppos);
+		$maxis->Stroke($this->yscale);
+	    }
+
+	    $this->yaxis->SetPos('min');
+	    $this->yaxis->SetLabelMargin(10);
+	    $this->yaxis->SetLabelSide(SIDE_LEFT);
+	    $this->yaxis->scale->ticks->SetSide($leftpos);
+	    $this->yaxis->Stroke($this->xscale);
+
+	    $myaxis = $this->yaxis;
+	    $myaxis->SetPos('max');
+	    $myaxis->SetLabelMargin(10);
+	    $myaxis->SetLabelSide(SIDE_RIGHT);
+	    $myaxis->title->Set('');
+	    $myaxis->scale->ticks->SetSide($rightpos);
+	    $myaxis->Stroke($this->xscale);
+	    
+	}
+	else {
+	    $this->xaxis->Stroke($this->yscale,$aStrokeLabels);
+	    $this->yaxis->Stroke($this->xscale,$aStrokeLabels);		
+	}
+    }
+
+
+    // Private helper function for backgound image
+    function LoadBkgImage($aImgFormat='',$aFile='',$aImgStr='') {
+	if( $aImgStr != '' ) {
+	    return Image::CreateFromString($aImgStr);
+	}
+	if( $aFile == '' )
+	    $aFile = $this->background_image;
+	// Remove case sensitivity and setup appropriate function to create image
+	// Get file extension. This should be the LAST '.' separated part of the filename
+	$e = explode('.',$aFile);
+	$ext = strtolower($e[count($e)-1]);
+	if ($ext == "jpeg")  {
+	    $ext = "jpg";
+	}
+	
+	if( trim($ext) == '' ) 
+	    $ext = 'png';  // Assume PNG if no extension specified
+
+	if( $aImgFormat == '' )
+	    $imgtag = $ext;
+	else
+	    $imgtag = $aImgFormat;
+
+	$supported = imagetypes();
+	if( ( $ext == 'jpg' && !($supported & IMG_JPG) ) ||
+	    ( $ext == 'gif' && !($supported & IMG_GIF) ) ||
+	    ( $ext == 'png' && !($supported & IMG_PNG) ) ) {
+	    JpGraphError::RaiseL(25037,$aFile);//('The image format of your background image ('.$aFile.') is not supported in your system configuration. ');
+	}
+
+
+	if( $imgtag == "jpg" || $imgtag == "jpeg")
+	{
+	    $f = "imagecreatefromjpeg";
+	    $imgtag = "jpg";
+	}
+	else
+	{
+	    $f = "imagecreatefrom".$imgtag;
+	}
+
+	// Compare specified image type and file extension
+	if( $imgtag != $ext ) {
+	    //$t = "Background image seems to be of different type (has different file extension) than specified imagetype. Specified: '".$aImgFormat."'File: '".$aFile."'";
+	    JpGraphError::RaiseL(25038, $aImgFormat, $aFile);
+	}
+
+	$img = @$f($aFile);
+	if( !$img ) {
+	    JpGraphError::RaiseL(25039,$aFile);//(" Can't read background image: '".$aFile."'");   
+	}
+	return $img;
+    }	
+
+    function StrokeBackgroundGrad() {
+	if( $this->bkg_gradtype < 0  ) 
+	    return;
+	$grad = new Gradient($this->img);
+	if( $this->bkg_gradstyle == BGRAD_PLOT ) {
+	    $xl = $this->img->left_margin;
+	    $yt = $this->img->top_margin;
+	    $xr = $xl + $this->img->plotwidth+1 ;
+	    $yb = $yt + $this->img->plotheight ;
+	    $grad->FilledRectangle($xl,$yt,$xr,$yb,$this->bkg_gradfrom,$this->bkg_gradto,$this->bkg_gradtype);
+	}
+	else {
+	    $xl = 0;
+	    $yt = 0;
+	    $xr = $xl + $this->img->width - 1;
+	    $yb = $yt + $this->img->height;
+	    if( $this->doshadow  ) {
+		$xr -= $this->shadow_width; 
+		$yb -= $this->shadow_width; 
+	    }
+	    if( $this->doframe ) {
+		$yt += $this->frame_weight;
+		$yb -= $this->frame_weight;
+		$xl += $this->frame_weight;
+		$xr -= $this->frame_weight;
+	    }
+	    $aa = $this->img->SetAngle(0);
+	    $grad->FilledRectangle($xl,$yt,$xr,$yb,$this->bkg_gradfrom,$this->bkg_gradto,$this->bkg_gradtype);
+	    $aa = $this->img->SetAngle($aa);
+	}
+    }
+
+    function StrokeFrameBackground() {
+	if( $this->background_image != "" && $this->background_cflag != "" ) {
+	    JpGraphError::RaiseL(25040);//('It is not possible to specify both a background image and a background country flag.');
+	}
+	if( $this->background_image != "" ) {
+	    $bkgimg = $this->LoadBkgImage($this->background_image_format);
+	    $this->img->_AdjBrightContrast($bkgimg,$this->background_image_bright,
+					   $this->background_image_contr);
+	    $this->img->_AdjSat($bkgimg,$this->background_image_sat);
+	}
+	elseif( $this->background_cflag != "" ) {
+	    if( ! class_exists('FlagImages') ) {
+		JpGraphError::RaiseL(25041);//('In order to use Country flags as backgrounds you must include the "jpgraph_flags.php" file.');
+	    }
+	    $fobj = new FlagImages(FLAGSIZE4);
+	    $dummy='';
+	    $bkgimg = $fobj->GetImgByName($this->background_cflag,$dummy);
+	    $this->background_image_mix = $this->background_cflag_mix;
+	    $this->background_image_type = $this->background_cflag_type;
+	}
+	else {
+	    return ;
+	}
+
+	$bw = ImageSX($bkgimg);
+	$bh = ImageSY($bkgimg);
+
+	// No matter what the angle is we always stroke the image and frame
+	// assuming it is 0 degree
+	$aa = $this->img->SetAngle(0);
+		
+	switch( $this->background_image_type ) {
+	    case BGIMG_FILLPLOT: // Resize to just fill the plotarea
+		$this->FillMarginArea();
+		$this->StrokeFrame();
+		$this->FillPlotArea();
+		$this->img->CopyMerge($bkgimg,
+				 $this->img->left_margin,$this->img->top_margin,
+				 0,0,$this->img->plotwidth+1,$this->img->plotheight,
+				 $bw,$bh,$this->background_image_mix);
+		break;
+	    case BGIMG_FILLFRAME: // Fill the whole area from upper left corner, resize to just fit
+		$hadj=0; $vadj=0;
+		if( $this->doshadow ) {
+		    $hadj = $this->shadow_width;
+		    $vadj = $this->shadow_width;
+		}
+		$this->FillMarginArea();
+		$this->FillPlotArea();
+		$this->img->CopyMerge($bkgimg,0,0,0,0,$this->img->width-$hadj,$this->img->height-$vadj,
+				      $bw,$bh,$this->background_image_mix);
+		$this->StrokeFrame();
+		break;
+	    case BGIMG_COPY: // Just copy the image from left corner, no resizing
+		$this->FillMarginArea();
+		$this->FillPlotArea();
+		$this->img->CopyMerge($bkgimg,0,0,0,0,$bw,$bh,
+				      $bw,$bh,$this->background_image_mix);
+		$this->StrokeFrame();
+		break;
+	    case BGIMG_CENTER: // Center original image in the plot area
+		$this->FillMarginArea();
+		$this->FillPlotArea();
+		$centerx = round($this->img->plotwidth/2+$this->img->left_margin-$bw/2);
+		$centery = round($this->img->plotheight/2+$this->img->top_margin-$bh/2);
+		$this->img->CopyMerge($bkgimg,$centerx,$centery,0,0,$bw,$bh,
+				      $bw,$bh,$this->background_image_mix);
+		$this->StrokeFrame();
+		break;
+	    default:
+		JpGraphError::RaiseL(25042);//(" Unknown background image layout");
+	}			
+	$this->img->SetAngle($aa);		
+    }
+
+    // Private
+    // Draw a frame around the image
+    function StrokeFrame() {
+	if( !$this->doframe ) return;
+
+	if( $this->background_image_type <= 1 && 
+	    ($this->bkg_gradtype < 0 || ($this->bkg_gradtype > 0 && $this->bkg_gradstyle==BGRAD_PLOT)) ) { 
+	    $c = $this->margin_color;
+	}
+	else {
+	    $c = false;
+	}
+	
+	if( $this->doshadow ) {
+	    $this->img->SetColor($this->frame_color);			
+	    $this->img->ShadowRectangle(0,0,$this->img->width,$this->img->height,
+					$c,$this->shadow_width,$this->shadow_color);
+	}
+	elseif( $this->framebevel ) {
+	    if( $c ) {
+		$this->img->SetColor($this->margin_color);
+		$this->img->FilledRectangle(0,0,$this->img->width-1,$this->img->height-1); 
+	    }
+	    $this->img->Bevel(1,1,$this->img->width-2,$this->img->height-2,
+			      $this->framebeveldepth,
+			      $this->framebevelcolor1,$this->framebevelcolor2);
+	    if( $this->framebevelborder ) {
+		$this->img->SetColor($this->framebevelbordercolor);
+		$this->img->Rectangle(0,0,$this->img->width-1,$this->img->height-1);
+	    }
+	}
+	else {
+	    $this->img->SetLineWeight($this->frame_weight);
+	    if( $c ) {
+		$this->img->SetColor($this->margin_color);
+		$this->img->FilledRectangle(0,0,$this->img->width-1,$this->img->height-1); 
+	    }
+	    $this->img->SetColor($this->frame_color);
+	    $this->img->Rectangle(0,0,$this->img->width-1,$this->img->height-1);		
+	}
+    }
+
+    function FillMarginArea() {
+	$hadj=0; $vadj=0;
+	if( $this->doshadow ) {
+	    $hadj = $this->shadow_width;
+	    $vadj = $this->shadow_width;
+	}
+
+	$this->img->SetColor($this->margin_color);
+//	$this->img->FilledRectangle(0,0,$this->img->width-1-$hadj,$this->img->height-1-$vadj); 
+
+	$this->img->FilledRectangle(0,0,$this->img->width-1-$hadj,$this->img->top_margin); 
+	$this->img->FilledRectangle(0,$this->img->top_margin,$this->img->left_margin,$this->img->height-1-$hadj); 
+	$this->img->FilledRectangle($this->img->left_margin+1,
+				    $this->img->height-$this->img->bottom_margin,
+				    $this->img->width-1-$hadj,
+				    $this->img->height-1-$hadj); 
+	$this->img->FilledRectangle($this->img->width-$this->img->right_margin,
+				    $this->img->top_margin+1,
+				    $this->img->width-1-$hadj,
+				    $this->img->height-$this->img->bottom_margin-1); 
+    }
+
+    function FillPlotArea() {
+	$this->img->PushColor($this->plotarea_color);
+	$this->img->FilledRectangle($this->img->left_margin,
+				    $this->img->top_margin,
+				    $this->img->width-$this->img->right_margin,
+				    $this->img->height-$this->img->bottom_margin);	
+	$this->img->PopColor();
+    }
+    
+    // Stroke the plot area with either a solid color or a background image
+    function StrokePlotArea() {
+	// Note: To be consistent we really should take a possible shadow
+	// into account. However, that causes some problem for the LinearScale class
+	// since in the current design it does not have any links to class Graph which
+	// means it has no way of compensating for the adjusted plotarea in case of a 
+	// shadow. So, until I redesign LinearScale we can't compensate for this.
+	// So just set the two adjustment parameters to zero for now.
+	$boxadj = 0; //$this->doframe ? $this->frame_weight : 0 ;
+	$adj = 0; //$this->doshadow ? $this->shadow_width : 0 ;
+
+	if( $this->background_image != "" || $this->background_cflag != "" ) {
+	    $this->StrokeFrameBackground();
+	}
+	else {
+	    $aa = $this->img->SetAngle(0);
+	    $this->StrokeFrame();
+	    $aa = $this->img->SetAngle($aa);
+	    $this->StrokeBackgroundGrad();
+	    if( $this->bkg_gradtype < 0 || 
+		($this->bkg_gradtype > 0 && $this->bkg_gradstyle==BGRAD_MARGIN) ) {
+		$this->FillPlotArea();
+	    }
+	}	
+    }	
+
+    function StrokeIcons() {
+	$n = count($this->iIcons);
+	for( $i=0; $i < $n; ++$i ) {
+	    $this->iIcons[$i]->StrokeWithScale($this->img,$this->xscale,$this->yscale);
+	}
+    }
+	
+    function StrokePlotBox() {
+	// Should we draw a box around the plot area?
+	if( $this->boxed ) {
+	    $this->img->SetLineWeight(1);
+	    $this->img->SetLineStyle('solid');
+	    $this->img->SetColor($this->box_color);
+	    for($i=0; $i < $this->box_weight; ++$i ) {
+		$this->img->Rectangle(
+		    $this->img->left_margin-$i,$this->img->top_margin-$i,
+		    $this->img->width-$this->img->right_margin+$i,
+		    $this->img->height-$this->img->bottom_margin+$i);
+	    }
+	}						
+    }		
+
+    function SetTitleBackgroundFillStyle($aStyle,$aColor1='black',$aColor2='white') {
+	$this->titlebkg_fillstyle = $aStyle;
+	$this->titlebkg_scolor1 = $aColor1;
+	$this->titlebkg_scolor2 = $aColor2;
+    }
+
+    function SetTitleBackground($aBackColor='gray', $aStyle=TITLEBKG_STYLE1, $aFrameStyle=TITLEBKG_FRAME_NONE, $aFrameColor='black', $aFrameWeight=1, $aBevelHeight=3, $aEnable=true) {
+	$this->titlebackground = $aEnable;
+	$this->titlebackground_color = $aBackColor;
+	$this->titlebackground_style = $aStyle;
+	$this->titlebackground_framecolor = $aFrameColor;
+	$this->titlebackground_framestyle = $aFrameStyle;
+	$this->titlebackground_frameweight = $aFrameWeight;	
+	$this->titlebackground_bevelheight = $aBevelHeight ;
+    }
+
+
+    function StrokeTitles() {
+
+	$margin=3;
+
+	if( $this->titlebackground ) {
+
+	    // Find out height
+	    $this->title->margin += 2 ;
+	    $h = $this->title->GetTextHeight($this->img)+$this->title->margin+$margin;
+	    if( $this->subtitle->t != "" && !$this->subtitle->hide ) {
+		$h += $this->subtitle->GetTextHeight($this->img)+$margin+
+		    $this->subtitle->margin;
+		$h += 2;
+	    }
+	    if( $this->subsubtitle->t != "" && !$this->subsubtitle->hide ) {
+		$h += $this->subsubtitle->GetTextHeight($this->img)+$margin+
+		    $this->subsubtitle->margin;
+		$h += 2;
+	    }
+	    $this->img->PushColor($this->titlebackground_color);
+	    if( $this->titlebackground_style === TITLEBKG_STYLE1 ) {
+		// Inside the frame
+		if( $this->framebevel ) {
+		    $x1 = $y1 = $this->framebeveldepth + 1 ;
+		    $x2 = $this->img->width - $this->framebeveldepth - 2 ; 
+		    $this->title->margin += $this->framebeveldepth + 1 ;
+		    $h += $y1 ;
+		    $h += 2;
+		}
+		else {
+		    $x1 = $y1 = $this->frame_weight;
+		    $x2 = $this->img->width - 2*$x1;
+		}
+	    }
+	    elseif( $this->titlebackground_style === TITLEBKG_STYLE2 ) {
+		// Cover the frame as well
+		$x1 = $y1 = 0;
+		$x2 = $this->img->width - 1 ;
+	    }
+	    elseif( $this->titlebackground_style === TITLEBKG_STYLE3 ) {
+		// Cover the frame as well (the difference is that
+		// for style==3 a bevel frame border is on top
+		// of the title background)
+		$x1 = $y1 = 0;
+		$x2 = $this->img->width - 1 ;
+		$h += $this->framebeveldepth ;
+		$this->title->margin += $this->framebeveldepth ;
+	    }
+	    else {
+		JpGraphError::RaiseL(25043);//('Unknown title background style.');
+	    }
+
+	    if( $this->titlebackground_framestyle === 3 ) {
+		$h += $this->titlebackground_bevelheight*2 + 1  ;
+		$this->title->margin += $this->titlebackground_bevelheight ;
+	    }
+
+	    if( $this->doshadow ) {
+		$x2 -= $this->shadow_width ;
+	    }
+	    
+	    $indent=0;
+	    if( $this->titlebackground_framestyle == TITLEBKG_FRAME_BEVEL ) {
+		$ind = $this->titlebackground_bevelheight;
+	    }
+
+	    if( $this->titlebkg_fillstyle==TITLEBKG_FILLSTYLE_HSTRIPED ) {
+		$this->img->FilledRectangle2($x1+$ind,$y1+$ind,$x2-$ind,$h-$ind,
+					     $this->titlebkg_scolor1,
+					     $this->titlebkg_scolor2);
+	    }
+	    elseif( $this->titlebkg_fillstyle==TITLEBKG_FILLSTYLE_VSTRIPED ) {
+		$this->img->FilledRectangle2($x1+$ind,$y1+$ind,$x2-$ind,$h-$ind,
+					     $this->titlebkg_scolor1,
+					     $this->titlebkg_scolor2,2);
+	    }
+	    else {
+		// Solid fill
+		$this->img->FilledRectangle($x1,$y1,$x2,$h);
+	    }
+	    $this->img->PopColor();
+
+	    $this->img->PushColor($this->titlebackground_framecolor);
+	    $this->img->SetLineWeight($this->titlebackground_frameweight);
+	    if( $this->titlebackground_framestyle == TITLEBKG_FRAME_FULL ) {
+		// Frame background
+		$this->img->Rectangle($x1,$y1,$x2,$h);
+	    }
+	    elseif( $this->titlebackground_framestyle == TITLEBKG_FRAME_BOTTOM ) {
+		// Bottom line only
+		$this->img->Line($x1,$h,$x2,$h);
+	    }
+	    elseif( $this->titlebackground_framestyle == TITLEBKG_FRAME_BEVEL ) {
+		$this->img->Bevel($x1,$y1,$x2,$h,$this->titlebackground_bevelheight);
+	    }
+	    $this->img->PopColor();
+
+	    // This is clumsy. But we neeed to stroke the whole graph frame if it is
+	    // set to bevel to get the bevel shading on top of the text background
+	    if( $this->framebevel && $this->doframe && 
+		$this->titlebackground_style === 3 ) {
+		$this->img->Bevel(1,1,$this->img->width-2,$this->img->height-2,
+				  $this->framebeveldepth,
+				  $this->framebevelcolor1,$this->framebevelcolor2);
+		if( $this->framebevelborder ) {
+		    $this->img->SetColor($this->framebevelbordercolor);
+		    $this->img->Rectangle(0,0,$this->img->width-1,$this->img->height-1);
+		}
+	    }
+	}
+
+	// Stroke title
+	$y = $this->title->margin; 
+	if( $this->title->halign == 'center' ) 
+	    $this->title->Center(0,$this->img->width,$y);
+	elseif( $this->title->halign == 'left' ) {
+	    $this->title->SetPos($this->title->margin+2,$y);
+	}
+	elseif( $this->title->halign == 'right' ) {
+	    $indent = 0;
+	    if( $this->doshadow ) 
+		$indent = $this->shadow_width+2;
+	    $this->title->SetPos($this->img->width-$this->title->margin-$indent,$y,'right');	    
+	}
+	$this->title->Stroke($this->img);
+		
+	// ... and subtitle
+	$y += $this->title->GetTextHeight($this->img) + $margin + $this->subtitle->margin;
+	if( $this->subtitle->halign == 'center' ) 
+	    $this->subtitle->Center(0,$this->img->width,$y);
+	elseif( $this->subtitle->halign == 'left' ) {
+	    $this->subtitle->SetPos($this->subtitle->margin+2,$y);
+	}
+	elseif( $this->subtitle->halign == 'right' ) {
+	    $indent = 0;
+	    if( $this->doshadow ) 
+		$indent = $this->shadow_width+2;
+	    $this->subtitle->SetPos($this->img->width-$this->subtitle->margin-$indent,$y,'right'); 
+	}
+	$this->subtitle->Stroke($this->img);
+
+	// ... and subsubtitle
+	$y += $this->subtitle->GetTextHeight($this->img) + $margin + $this->subsubtitle->margin;
+	if( $this->subsubtitle->halign == 'center' ) 
+	    $this->subsubtitle->Center(0,$this->img->width,$y);
+	elseif( $this->subsubtitle->halign == 'left' ) {
+	    $this->subsubtitle->SetPos($this->subsubtitle->margin+2,$y);
+	}
+	elseif( $this->subsubtitle->halign == 'right' ) {
+	    $indent = 0;
+	    if( $this->doshadow ) 
+		$indent = $this->shadow_width+2;
+	    $this->subsubtitle->SetPos($this->img->width-$this->subsubtitle->margin-$indent,$y,'right'); 
+	}
+	$this->subsubtitle->Stroke($this->img);
+
+	// ... and fancy title
+	$this->tabtitle->Stroke($this->img);
+
+    }
+
+    function StrokeTexts() {
+	// Stroke any user added text objects
+	if( $this->texts != null ) {
+	    for($i=0; $i < count($this->texts); ++$i) {
+		$this->texts[$i]->StrokeWithScale($this->img,$this->xscale,$this->yscale);
+	    }
+	}
+
+	if( $this->y2texts != null && $this->y2scale != null ) {
+	    for($i=0; $i < count($this->y2texts); ++$i) {
+		$this->y2texts[$i]->StrokeWithScale($this->img,$this->xscale,$this->y2scale);
+	    }
+	}
+
+    }
+
+    function StrokeTables() {
+	if( $this->iTables != null ) {
+	    $n = count($this->iTables);
+	    for( $i=0; $i < $n; ++$i ) {
+		$this->iTables[$i]->StrokeWithScale($this->img,$this->xscale,$this->yscale);
+	    }
+	}
+    }
+
+    function DisplayClientSideaImageMapAreas() {
+	// Debug stuff - display the outline of the image map areas
+	$csim='';
+	foreach ($this->plots as $p) {
+	    $csim.= $p->GetCSIMareas();
+	}
+	$csim .= $this->legend->GetCSIMareas();
+	if (preg_match_all("/area shape=\"(\w+)\" coords=\"([0-9\, ]+)\"/", $csim, $coords)) {
+	    $this->img->SetColor($this->csimcolor);
+	    $n = count($coords[0]);
+	    for ($i=0; $i < $n; $i++) {
+		if ($coords[1][$i]=="poly") {
+		    preg_match_all('/\s*([0-9]+)\s*,\s*([0-9]+)\s*,*/',$coords[2][$i],$pts);
+		    $this->img->SetStartPoint($pts[1][count($pts[0])-1],$pts[2][count($pts[0])-1]);
+		    $m = count($pts[0]);
+		    for ($j=0; $j < $m; $j++) {
+			$this->img->LineTo($pts[1][$j],$pts[2][$j]);
+		    }
+		} else if ($coords[1][$i]=="rect") {
+		    $pts = preg_split('/,/', $coords[2][$i]);
+		    $this->img->SetStartPoint($pts[0],$pts[1]);
+		    $this->img->LineTo($pts[2],$pts[1]);
+		    $this->img->LineTo($pts[2],$pts[3]);
+		    $this->img->LineTo($pts[0],$pts[3]);
+		    $this->img->LineTo($pts[0],$pts[1]);					
+		}
+	    }
+	}
+    }
+
+    function AdjustSaturationBrightnessContrast() {
+	// Adjust the brightness and contrast of the image
+	if( $this->image_contr || $this->image_bright )
+	    $this->img->AdjBrightContrast($this->image_bright,$this->image_contr);
+	if( $this->image_sat )											 
+	    $this->img->AdjSat($this->image_sat);
+    }
+
+    // Text scale offset in fractions of a major scale step
+    function SetTextScaleOff($aOff) {
+	$this->text_scale_off = $aOff;
+	$this->xscale->text_scale_off = $aOff;
+    }
+
+    // Text width of bar to be centered in absolute pixels
+    function SetTextScaleAbsCenterOff($aOff) {
+	$this->text_scale_abscenteroff = $aOff;
+    }
+
+    // Get Y min and max values for added lines
+    function GetLinesYMinMax( $aLines ) {
+	$n = count($aLines);
+	if( $n == 0 ) return false;
+	$min = $aLines[0]->scaleposition ;
+	$max = $min ;
+	$flg = false;
+	for( $i=0; $i < $n; ++$i ) {
+	    if( $aLines[$i]->direction == HORIZONTAL ) {
+		$flg = true ;
+		$v = $aLines[$i]->scaleposition ;
+		if( $min > $v ) $min = $v ;
+		if( $max < $v ) $max = $v ;
+	    }
+	}
+	return $flg ? array($min,$max) : false ;
+    }
+
+    // Get X min and max values for added lines
+    function GetLinesXMinMax( $aLines ) {
+	$n = count($aLines);
+	if( $n == 0 ) return false ;
+	$min = $aLines[0]->scaleposition ;
+	$max = $min ;
+	$flg = false;
+	for( $i=0; $i < $n; ++$i ) {
+	    if( $aLines[$i]->direction == VERTICAL ) {
+		$flg = true ;
+		$v = $aLines[$i]->scaleposition ;
+		if( $min > $v ) $min = $v ;
+		if( $max < $v ) $max = $v ;
+	    }
+	}
+	return $flg ? array($min,$max) : false ;
+    }
+
+    // Get min and max values for all included plots
+    function GetPlotsYMinMax(&$aPlots) {
+	$n = count($aPlots);
+	$i=0;
+	do {
+	    list($xmax,$max) = $aPlots[$i]->Max();
+	} while( ++$i < $n && !is_numeric($max) );
+	
+	$i=0;
+	do {
+           list($xmin,$min) = $aPlots[$i]->Min();
+       } while( ++$i < $n && !is_numeric($min) );
+	
+	if( !is_numeric($min) || !is_numeric($max) ) {
+	    JpGraphError::RaiseL(25044);//('Cannot use autoscaling since it is impossible to determine a valid min/max value  of the Y-axis (only null values).');
+	}
+
+	list($xmax,$max) = $aPlots[0]->Max();
+	list($xmin,$min) = $aPlots[0]->Min();
+	for($i=0; $i < count($aPlots); ++$i ) {
+	    list($xmax,$ymax)=$aPlots[$i]->Max();
+	    list($xmin,$ymin)=$aPlots[$i]->Min();
+	    if (is_numeric($ymax)) $max=max($max,$ymax);
+	    if (is_numeric($ymin)) $min=min($min,$ymin);
+	}
+	if( $min == '' ) $min = 0;
+	if( $max == '' ) $max = 0;
+	if( $min == 0 && $max == 0 ) {
+	    // Special case if all values are 0
+	    $min=0;$max=1;			
+	}
+	return array($min,$max);
+    }
+
+} // Class
+
+
+//===================================================
+// CLASS TTF
+// Description: Handle TTF font names
+//===================================================
+class TTF {
+    var $font_files,$style_names;
+//---------------
+// CONSTRUCTOR
+    function TTF() {
+	$this->style_names=array(FS_NORMAL=>'normal',FS_BOLD=>'bold',FS_ITALIC=>'italic',FS_BOLDITALIC=>'bolditalic');
+	// File names for available fonts
+	$this->font_files=array(
+	    FF_COURIER => array(FS_NORMAL=>'cour.ttf', FS_BOLD=>'courbd.ttf', FS_ITALIC=>'couri.ttf', FS_BOLDITALIC=>'courbi.ttf' ),
+	    FF_GEORGIA => array(FS_NORMAL=>'georgia.ttf', FS_BOLD=>'georgiab.ttf', FS_ITALIC=>'georgiai.ttf', FS_BOLDITALIC=>'' ),
+	    FF_TREBUCHE =>array(FS_NORMAL=>'trebuc.ttf', FS_BOLD=>'trebucbd.ttf',   FS_ITALIC=>'trebucit.ttf', FS_BOLDITALIC=>'trebucbi.ttf' ),
+	    FF_VERDANA => array(FS_NORMAL=>'verdana.ttf', FS_BOLD=>'verdanab.ttf',  FS_ITALIC=>'verdanai.ttf', FS_BOLDITALIC=>'' ),
+	    FF_TIMES =>   array(FS_NORMAL=>'times.ttf',   FS_BOLD=>'timesbd.ttf',   FS_ITALIC=>'timesi.ttf',   FS_BOLDITALIC=>'timesbi.ttf' ),
+	    FF_COMIC =>   array(FS_NORMAL=>'comic.ttf',   FS_BOLD=>'comicbd.ttf',   FS_ITALIC=>'',         FS_BOLDITALIC=>'' ),
+	    FF_ARIAL =>   array(FS_NORMAL=>'arial.ttf',   FS_BOLD=>'arialbd.ttf',   FS_ITALIC=>'ariali.ttf',   FS_BOLDITALIC=>'arialbi.ttf' ) ,
+	    FF_VERA =>    array(FS_NORMAL=>'Vera.ttf',   FS_BOLD=>'VeraBd.ttf',   FS_ITALIC=>'VeraIt.ttf',   FS_BOLDITALIC=>'VeraBI.ttf' ),
+	    FF_VERAMONO => array(FS_NORMAL=>'VeraMono.ttf', FS_BOLD=>'VeraMoBd.ttf', FS_ITALIC=>'VeraMoIt.ttf', FS_BOLDITALIC=>'VeraMoBI.ttf' ),
+	    FF_VERASERIF => array(FS_NORMAL=>'VeraSe.ttf', FS_BOLD=>'VeraSeBd.ttf', FS_ITALIC=>'', FS_BOLDITALIC=>'' ) ,
+	    FF_SIMSUN =>  array(FS_NORMAL=>'simsun.ttc',  FS_BOLD=>'simhei.ttf',   FS_ITALIC=>'',   FS_BOLDITALIC=>'' ),
+	    FF_CHINESE => array(FS_NORMAL=>CHINESE_TTF_FONT, FS_BOLD=>'', FS_ITALIC=>'', FS_BOLDITALIC=>'' ),
+ 	    FF_MINCHO =>  array(FS_NORMAL=>MINCHO_TTF_FONT,  FS_BOLD=>'',   FS_ITALIC=>'',   FS_BOLDITALIC=>'' ),
+ 	    FF_PMINCHO => array(FS_NORMAL=>PMINCHO_TTF_FONT,  FS_BOLD=>'',   FS_ITALIC=>'',   FS_BOLDITALIC=>'' ),    
+ 	    FF_GOTHIC  => array(FS_NORMAL=>GOTHIC_TTF_FONT,  FS_BOLD=>'',   FS_ITALIC=>'',   FS_BOLDITALIC=>'' ),    
+ 	    FF_PGOTHIC => array(FS_NORMAL=>PGOTHIC_TTF_FONT,  FS_BOLD=>'',   FS_ITALIC=>'',   FS_BOLDITALIC=>'' ),    
+ 	    FF_MINCHO =>  array(FS_NORMAL=>PMINCHO_TTF_FONT,  FS_BOLD=>'',   FS_ITALIC=>'',   FS_BOLDITALIC=>'' )   
+);
+    }
+
+//---------------
+// PUBLIC METHODS	
+    // Create the TTF file from the font specification
+    function File($family,$style=FS_NORMAL) {
+	
+	if( $family == FF_HANDWRT || $family==FF_BOOK ) {
+	    JpGraphError::RaiseL(25045);//('Font families FF_HANDWRT and FF_BOOK are no longer available due to copyright problem with these fonts. Fonts can no longer be distributed with JpGraph. Please download fonts from http://corefonts.sourceforge.net/');
+	}
+
+	$fam = @$this->font_files[$family];
+	if( !$fam ) {
+	    JpGraphError::RaiseL(25046,$family);//("Specified TTF font family (id=$family) is unknown or does not exist. Please note that TTF fonts are not distributed with JpGraph for copyright reasons. You can find the MS TTF WEB-fonts (arial, courier etc) for download at http://corefonts.sourceforge.net/");
+	}
+	$f = @$fam[$style];
+
+	if( $f==='' )
+	    JpGraphError::RaiseL(25047,$this->style_names[$style],$this->font_files[$family][FS_NORMAL]);//('Style "'.$this->style_names[$style].'" is not available for font family '.$this->font_files[$family][FS_NORMAL].'.');
+	if( !$f ) {
+	    JpGraphError::RaiseL(25048,$fam);//("Unknown font style specification [$fam].");
+	}
+
+	if ($family >= FF_MINCHO && $family <= FF_PGOTHIC) {
+	    $f = MBTTF_DIR.$f;
+	} else {
+	    $f = TTF_DIR.$f;
+	}
+
+	if( file_exists($f) === false || is_readable($f) === false ) {
+	    JpGraphError::RaiseL(25049,$f);//("Font file \"$f\" is not readable or does not exist.");
+	}
+	return $f;
+    }
+} // Class
+
+//===================================================
+// CLASS LineProperty
+// Description: Holds properties for a line
+//===================================================
+class LineProperty {
+    var $iWeight=1, $iColor="black",$iStyle="solid";
+    var $iShow=true;
+	
+//---------------
+// PUBLIC METHODS	
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+	
+    function SetWeight($aWeight) {
+	$this->iWeight = $aWeight;
+    }
+	
+    function SetStyle($aStyle) {
+	$this->iStyle = $aStyle;
+    }
+		
+    function Show($aShow=true) {
+	$this->iShow=$aShow;
+    }
+	
+    function Stroke(&$aImg,$aX1,$aY1,$aX2,$aY2) {
+	if( $this->iShow ) {
+	    $aImg->PushColor($this->iColor);
+	    $oldls = $aImg->line_style;
+	    $oldlw = $aImg->line_weight;
+	    $aImg->SetLineWeight($this->iWeight);
+	    $aImg->SetLineStyle($this->iStyle);			
+	    $aImg->StyleLine($aX1,$aY1,$aX2,$aY2);
+	    $aImg->PopColor($this->iColor);
+	    $aImg->line_style = $oldls;
+	    $aImg->line_weight = $oldlw;
+
+	}
+    }
+}
+
+
+//===================================================
+// CLASS Text
+// Description: Arbitrary text object that can be added to the graph
+//===================================================
+class Text {
+    var $t,$x=0,$y=0,$halign="left",$valign="top",$color=array(0,0,0);
+    var $font_family=FF_FONT1,$font_style=FS_NORMAL,$font_size=12;
+    var $hide=false, $dir=0;
+    var $boxed=false;	// Should the text be boxed
+    var $paragraph_align="left";
+    var $margin=0;
+    var $icornerradius=0,$ishadowwidth=3;
+    var $iScalePosY=null,$iScalePosX=null;
+    var $iWordwrap=0;
+    var $fcolor='white',$bcolor='black',$shadow=false;
+    var $iCSIMarea='',$iCSIMalt='',$iCSIMtarget='';
+
+//---------------
+// CONSTRUCTOR
+
+    // Create new text at absolute pixel coordinates
+    function Text($aTxt="",$aXAbsPos=0,$aYAbsPos=0) {
+	if( ! is_string($aTxt) ) {
+	    JpGraphError::RaiseL(25050);//('First argument to Text::Text() must be s atring.');
+	}
+	$this->t = $aTxt;
+	$this->x = round($aXAbsPos);
+	$this->y = round($aYAbsPos);
+	$this->margin = 0;
+    }
+//---------------
+// PUBLIC METHODS	
+    // Set the string in the text object
+    function Set($aTxt) {
+	$this->t = $aTxt;
+    }
+	
+    // Alias for Pos()
+    function SetPos($aXAbsPos=0,$aYAbsPos=0,$aHAlign="left",$aVAlign="top") {
+	$this->Pos($aXAbsPos,$aYAbsPos,$aHAlign,$aVAlign);
+    }
+    
+    // Specify the position and alignment for the text object
+    function Pos($aXAbsPos=0,$aYAbsPos=0,$aHAlign="left",$aVAlign="top") {
+	$this->x = $aXAbsPos;
+	$this->y = $aYAbsPos;
+	$this->halign = $aHAlign;
+	$this->valign = $aVAlign;
+    }
+
+    function SetScalePos($aX,$aY) {
+	$this->iScalePosX = $aX;
+	$this->iScalePosY = $aY;
+    }
+	
+    // Specify alignment for the text
+    function Align($aHAlign,$aVAlign="top",$aParagraphAlign="") {
+	$this->halign = $aHAlign;
+	$this->valign = $aVAlign;
+	if( $aParagraphAlign != "" )
+	    $this->paragraph_align = $aParagraphAlign;
+    }		
+    
+    // Alias
+    function SetAlign($aHAlign,$aVAlign="top",$aParagraphAlign="") {
+	$this->Align($aHAlign,$aVAlign,$aParagraphAlign);
+    }
+
+    // Specifies the alignment for a multi line text
+    function ParagraphAlign($aAlign) {
+	$this->paragraph_align = $aAlign;
+    }
+
+    // Specifies the alignment for a multi line text
+    function SetParagraphAlign($aAlign) {
+	$this->paragraph_align = $aAlign;
+    }
+
+    function SetShadow($aShadowColor='gray',$aShadowWidth=3) {
+	$this->ishadowwidth=$aShadowWidth;
+	$this->shadow=$aShadowColor;
+	$this->boxed=true;
+    }
+
+    function SetWordWrap($aCol) {
+	$this->iWordwrap = $aCol ;
+    }
+	
+    // Specify that the text should be boxed. fcolor=frame color, bcolor=border color,
+    // $shadow=drop shadow should be added around the text.
+    function SetBox($aFrameColor=array(255,255,255),$aBorderColor=array(0,0,0),$aShadowColor=false,$aCornerRadius=4,$aShadowWidth=3) {
+	if( $aFrameColor==false )
+	    $this->boxed=false;
+	else
+	    $this->boxed=true;
+	$this->fcolor=$aFrameColor;
+	$this->bcolor=$aBorderColor;
+	// For backwards compatibility when shadow was just true or false
+	if( $aShadowColor === true )
+	    $aShadowColor = 'gray';
+	$this->shadow=$aShadowColor;
+	$this->icornerradius=$aCornerRadius;
+	$this->ishadowwidth=$aShadowWidth;
+    }
+	
+    // Hide the text
+    function Hide($aHide=true) {
+	$this->hide=$aHide;
+    }
+	
+    // This looks ugly since it's not a very orthogonal design 
+    // but I added this "inverse" of Hide() to harmonize
+    // with some classes which I designed more recently (especially) 
+    // jpgraph_gantt
+    function Show($aShow=true) {
+	$this->hide=!$aShow;
+    }
+	
+    // Specify font
+    function SetFont($aFamily,$aStyle=FS_NORMAL,$aSize=10) {
+	$this->font_family=$aFamily;
+	$this->font_style=$aStyle;
+	$this->font_size=$aSize;
+    }
+			
+    // Center the text between $left and $right coordinates
+    function Center($aLeft,$aRight,$aYAbsPos=false) {
+	$this->x = $aLeft + ($aRight-$aLeft	)/2;
+	$this->halign = "center";
+	if( is_numeric($aYAbsPos) )
+	    $this->y = $aYAbsPos;		
+    }
+	
+    // Set text color
+    function SetColor($aColor) {
+	$this->color = $aColor;
+    }
+	
+    function SetAngle($aAngle) {
+	$this->SetOrientation($aAngle);
+    }
+	
+    // Orientation of text. Note only TTF fonts can have an arbitrary angle
+    function SetOrientation($aDirection=0) {
+	if( is_numeric($aDirection) )
+	    $this->dir=$aDirection;	
+	elseif( $aDirection=="h" )
+	    $this->dir = 0;
+	elseif( $aDirection=="v" )
+	    $this->dir = 90;
+	else JpGraphError::RaiseL(25051);//(" Invalid direction specified for text.");
+    }
+	
+    // Total width of text
+    function GetWidth(&$aImg) {
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$w = $aImg->GetTextWidth($this->t,$this->dir);
+	return $w;	
+    }
+	
+    // Hight of font
+    function GetFontHeight(&$aImg) {
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$h = $aImg->GetFontHeight();
+	return $h;
+
+    }
+
+    function GetTextHeight(&$aImg) {
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);	
+	$h = $aImg->GetTextHeight($this->t,$this->dir);
+	return $h;
+    }
+
+    function GetHeight(&$aImg) {
+	// Synonym for GetTextHeight()
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);	
+	$h = $aImg->GetTextHeight($this->t,$this->dir);
+	return $h;
+    }
+
+    // Set the margin which will be interpretated differently depending
+    // on the context.
+    function SetMargin($aMarg) {
+	$this->margin = $aMarg;
+    }
+
+    function StrokeWithScale(&$aImg,$axscale,$ayscale) {
+	if( $this->iScalePosX === null ||
+	    $this->iScalePosY === null ) {
+	    $this->Stroke($aImg);
+	}
+	else {
+	    $this->Stroke($aImg,
+			  round($axscale->Translate($this->iScalePosX)),
+			  round($ayscale->Translate($this->iScalePosY)));
+	}
+    }
+
+    function SetCSIMTarget($aTarget,$aAlt=null) {
+	$this->iCSIMtarget = $aTarget;
+	$this->iCSIMalt = $aAlt;
+    }
+
+    function GetCSIMareas() {
+	if( $this->iCSIMtarget !== '' ) 
+	    return $this->iCSIMarea;
+	else
+	    return '';
+    }
+
+    // Display text in image
+    function Stroke(&$aImg,$x=null,$y=null) {
+
+	if( !empty($x) ) $this->x = round($x);
+	if( !empty($y) ) $this->y = round($y);
+
+	// Insert newlines
+	if( $this->iWordwrap > 0 ) {
+	    $this->t = wordwrap($this->t,$this->iWordwrap,"\n");
+	}
+
+	// If position been given as a fraction of the image size
+	// calculate the absolute position
+	if( $this->x < 1 && $this->x > 0 ) $this->x *= $aImg->width;
+	if( $this->y < 1 && $this->y > 0 ) $this->y *= $aImg->height;
+
+	$aImg->PushColor($this->color);	
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$aImg->SetTextAlign($this->halign,$this->valign);
+	if( $this->boxed ) {
+	    if( $this->fcolor=="nofill" ) 
+		$this->fcolor=false;		
+	    $aImg->SetLineWeight(1);
+	    $bbox = $aImg->StrokeBoxedText($this->x,$this->y,$this->t,
+				   $this->dir,$this->fcolor,$this->bcolor,$this->shadow,
+				   $this->paragraph_align,5,5,$this->icornerradius,
+				   $this->ishadowwidth);
+	}
+	else {
+	    $bbox = $aImg->StrokeText($this->x,$this->y,$this->t,$this->dir,$this->paragraph_align);
+	}
+
+	// Create CSIM targets
+	$coords = $bbox[0].','.$bbox[1].','.$bbox[2].','.$bbox[3].','.$bbox[4].','.$bbox[5].','.$bbox[6].','.$bbox[7];
+	$this->iCSIMarea = "<area shape=\"poly\" coords=\"$coords\" href=\"".$this->iCSIMtarget."\"";
+	$this->iCSIMarea .= " target=\"main\" alt=\"".$this->iCSIMalt."\" title=\"".$this->iCSIMalt."\" />\n";
+
+	$aImg->PopColor($this->color);	
+
+    }
+} // Class
+
+class GraphTabTitle extends Text{
+    var $corner = 6 , $posx = 7, $posy = 4;
+    var $color='darkred',$fillcolor='lightyellow',$bordercolor='black';
+    var $align = 'left', $width=TABTITLE_WIDTHFIT;
+    function GraphTabTitle() {
+	$this->t = '';
+	$this->font_style = FS_BOLD;
+	$this->hide = true;
+    }
+
+    function SetColor($aTxtColor,$aFillColor='lightyellow',$aBorderColor='black') {
+	$this->color = $aTxtColor;
+	$this->fillcolor = $aFillColor;
+	$this->bordercolor = $aBorderColor;
+    }
+
+    function SetFillColor($aFillColor) {
+	$this->fillcolor = $aFillColor;
+    }
+
+    function SetTabAlign($aAlign) {
+	// Synonym for SetPos
+	$this->align = $aAlign;
+    }
+
+    function SetPos($aAlign) {
+	$this->align = $aAlign;
+    }
+    
+    function SetWidth($aWidth) {
+	$this->width = $aWidth ;
+    }
+
+    function Set($t) {
+	$this->t = $t;
+	$this->hide = false;
+    }
+
+    function SetCorner($aD) {
+	$this->corner = $aD ;
+    }
+
+    function Stroke(&$aImg) {
+	if( $this->hide ) 
+	    return;
+	$this->boxed = false;
+	$w = $this->GetWidth($aImg) + 2*$this->posx;
+	$h = $this->GetTextHeight($aImg) + 2*$this->posy;
+
+	$x = $aImg->left_margin;
+	$y = $aImg->top_margin;
+
+	if( $this->width === TABTITLE_WIDTHFIT ) {
+	    if( $this->align == 'left' ) {
+		$p = array($x,                $y,
+			   $x,                $y-$h+$this->corner,
+			   $x + $this->corner,$y-$h,
+			   $x + $w - $this->corner, $y-$h,
+			   $x + $w, $y-$h+$this->corner,
+			   $x + $w, $y);
+	    }
+	    elseif( $this->align == 'center' ) {
+		$x += round($aImg->plotwidth/2) - round($w/2);
+		$p = array($x, $y,
+			   $x, $y-$h+$this->corner,
+			   $x + $this->corner, $y-$h,
+			   $x + $w - $this->corner, $y-$h,
+			   $x + $w, $y-$h+$this->corner,
+			   $x + $w, $y);
+	    }
+	    else {
+		$x += $aImg->plotwidth -$w;
+		$p = array($x, $y,
+			   $x, $y-$h+$this->corner,
+			   $x + $this->corner,$y-$h,
+			   $x + $w - $this->corner, $y-$h,
+			   $x + $w, $y-$h+$this->corner,
+			   $x + $w, $y);
+	    }
+	}
+	else {
+	    if( $this->width === TABTITLE_WIDTHFULL )
+		$w = $aImg->plotwidth ;
+	    else
+		$w = $this->width ;
+
+	    // Make the tab fit the width of the plot area
+	    $p = array($x,                $y,
+		       $x,                $y-$h+$this->corner,
+		       $x + $this->corner,$y-$h,
+		       $x + $w - $this->corner, $y-$h,
+		       $x + $w, $y-$h+$this->corner,
+		       $x + $w, $y);
+	    
+	}
+	if( $this->halign == 'left' ) {
+	    $aImg->SetTextAlign('left','bottom');
+	    $x += $this->posx;
+	    $y -= $this->posy;
+	}
+	elseif( $this->halign == 'center' ) {
+	    $aImg->SetTextAlign('center','bottom');
+	    $x += $w/2; 
+	    $y -= $this->posy;
+	}
+	else {
+	    $aImg->SetTextAlign('right','bottom');
+	    $x += $w - $this->posx;
+	    $y -= $this->posy;
+	}
+
+	$aImg->SetColor($this->fillcolor);
+	$aImg->FilledPolygon($p);
+
+	$aImg->SetColor($this->bordercolor);
+	$aImg->Polygon($p,true);
+	
+	$aImg->SetColor($this->color);
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$aImg->StrokeText($x,$y,$this->t,0,'center');
+    }
+
+}
+
+//===================================================
+// CLASS SuperScriptText
+// Description: Format a superscript text
+//===================================================
+class SuperScriptText extends Text {
+    var $iSuper="";
+    var $sfont_family="",$sfont_style="",$sfont_size=8;
+    var $iSuperMargin=2,$iVertOverlap=4,$iSuperScale=0.65;
+    var $iSDir=0;
+    var $iSimple=false;
+
+    function SuperScriptText($aTxt="",$aSuper="",$aXAbsPos=0,$aYAbsPos=0) {
+	parent::Text($aTxt,$aXAbsPos,$aYAbsPos);
+	$this->iSuper = $aSuper;
+    }
+
+    function FromReal($aVal,$aPrecision=2) {
+	// Convert a floating point number to scientific notation
+	$neg=1.0;
+	if( $aVal < 0 ) {
+	    $neg = -1.0;
+	    $aVal = -$aVal;
+	}
+		
+	$l = floor(log10($aVal));
+	$a = sprintf("%0.".$aPrecision."f",round($aVal / pow(10,$l),$aPrecision));
+	$a *= $neg;
+	if( $this->iSimple && ($a == 1 || $a==-1) ) $a = '';
+	
+	if( $a != '' )
+	    $this->t = $a.' * 10';
+	else {
+	    if( $neg == 1 )
+		$this->t = '10';
+	    else
+		$this->t = '-10';
+	}
+	$this->iSuper = $l;
+    }
+
+    function Set($aTxt,$aSuper="") {
+	$this->t = $aTxt;
+	$this->iSuper = $aSuper;
+    }
+
+    function SetSuperFont($aFontFam,$aFontStyle=FS_NORMAL,$aFontSize=8) {
+	$this->sfont_family = $aFontFam;
+	$this->sfont_style = $aFontStyle;
+	$this->sfont_size = $aFontSize;
+    }
+
+    // Total width of text
+    function GetWidth(&$aImg) {
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$w = $aImg->GetTextWidth($this->t);
+	$aImg->SetFont($this->sfont_family,$this->sfont_style,$this->sfont_size);
+	$w += $aImg->GetTextWidth($this->iSuper);
+	$w += $this->iSuperMargin;
+	return $w;
+    }
+	
+    // Hight of font (approximate the height of the text)
+    function GetFontHeight(&$aImg) {
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);	
+	$h = $aImg->GetFontHeight();
+	$aImg->SetFont($this->sfont_family,$this->sfont_style,$this->sfont_size);
+	$h += $aImg->GetFontHeight();
+	return $h;
+    }
+
+    // Hight of text
+    function GetTextHeight(&$aImg) {
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$h = $aImg->GetTextHeight($this->t);
+	$aImg->SetFont($this->sfont_family,$this->sfont_style,$this->sfont_size);
+	$h += $aImg->GetTextHeight($this->iSuper);
+	return $h;
+    }
+
+    function Stroke(&$aImg,$ax=-1,$ay=-1) {
+	
+        // To position the super script correctly we need different
+	// cases to handle the alignmewnt specified since that will
+	// determine how we can interpret the x,y coordinates
+	
+	$w = parent::GetWidth($aImg);
+	$h = parent::GetTextHeight($aImg);
+	switch( $this->valign ) {
+	    case 'top':
+		$sy = $this->y;
+		break;
+	    case 'center':
+		$sy = $this->y - $h/2;
+		break;
+	    case 'bottom':
+		$sy = $this->y - $h;
+		break;
+	    default:
+		JpGraphError::RaiseL(25052);//('PANIC: Internal error in SuperScript::Stroke(). Unknown vertical alignment for text');
+		exit();
+	}
+
+	switch( $this->halign ) {
+	    case 'left':
+		$sx = $this->x + $w;
+		break;
+	    case 'center':
+		$sx = $this->x + $w/2;
+		break;
+	    case 'right':
+		$sx = $this->x;
+		break;
+	    default:
+		JpGraphError::RaiseL(25053);//('PANIC: Internal error in SuperScript::Stroke(). Unknown horizontal alignment for text');
+		exit();
+	}
+
+	$sx += $this->iSuperMargin;
+	$sy += $this->iVertOverlap;
+
+	// Should we automatically determine the font or
+	// has the user specified it explicetly?
+	if( $this->sfont_family == "" ) {
+	    if( $this->font_family <= FF_FONT2 ) {
+		if( $this->font_family == FF_FONT0 ) {
+		    $sff = FF_FONT0;
+		}
+		elseif( $this->font_family == FF_FONT1 ) {
+		    if( $this->font_style == FS_NORMAL )
+			$sff = FF_FONT0;
+		    else
+			$sff = FF_FONT1;
+		}
+		else {
+		    $sff = FF_FONT1;
+		}
+		$sfs = $this->font_style;
+		$sfz = $this->font_size;
+	    }
+	    else {
+		// TTF fonts
+		$sff = $this->font_family;
+		$sfs = $this->font_style;
+		$sfz = floor($this->font_size*$this->iSuperScale);		
+		if( $sfz < 8 ) $sfz = 8;
+	    }	    
+	    $this->sfont_family = $sff;
+	    $this->sfont_style = $sfs;
+	    $this->sfont_size = $sfz;	    
+	} 
+	else {
+	    $sff = $this->sfont_family;
+	    $sfs = $this->sfont_style;
+	    $sfz = $this->sfont_size;	    
+	}
+
+	parent::Stroke($aImg,$ax,$ay);
+
+
+	// For the builtin fonts we need to reduce the margins
+	// since the bounding bx reported for the builtin fonts
+	// are much larger than for the TTF fonts.
+	if( $sff <= FF_FONT2 ) {
+	    $sx -= 2;
+	    $sy += 3;
+	}
+
+	$aImg->SetTextAlign('left','bottom');	
+	$aImg->SetFont($sff,$sfs,$sfz);
+	$aImg->PushColor($this->color);	
+	$aImg->StrokeText($sx,$sy,$this->iSuper,$this->iSDir,'left');
+	$aImg->PopColor();	
+    }
+}
+
+
+//===================================================
+// CLASS Grid
+// Description: responsible for drawing grid lines in graph
+//===================================================
+class Grid {
+    var $img;
+    var $scale;
+    var $grid_color='#DDDDDD',$grid_mincolor='#DDDDDD';
+    var $type="solid";
+    var $show=false, $showMinor=false,$weight=1;
+    var $fill=false,$fillcolor=array('#EFEFEF','#BBCCFF');
+//---------------
+// CONSTRUCTOR
+    function Grid(&$aAxis) {
+	$this->scale = &$aAxis->scale;
+	$this->img = &$aAxis->img;
+    }
+//---------------
+// PUBLIC METHODS
+    function SetColor($aMajColor,$aMinColor=false) {
+	$this->grid_color=$aMajColor;
+	if( $aMinColor === false ) 
+	    $aMinColor = $aMajColor ;
+	$this->grid_mincolor = $aMinColor;
+    }
+	
+    function SetWeight($aWeight) {
+	$this->weight=$aWeight;
+    }
+	
+    // Specify if grid should be dashed, dotted or solid
+    function SetLineStyle($aType) {
+	$this->type = $aType;
+    }
+	
+    // Decide if both major and minor grid should be displayed
+    function Show($aShowMajor=true,$aShowMinor=false) {
+	$this->show=$aShowMajor;
+	$this->showMinor=$aShowMinor;
+    }
+    
+    function SetFill($aFlg=true,$aColor1='lightgray',$aColor2='lightblue') {
+	$this->fill = $aFlg;
+	$this->fillcolor = array( $aColor1, $aColor2 );
+    }
+	
+    // Display the grid
+    function Stroke() {
+	if( $this->showMinor ) {
+	    $tmp = $this->grid_color;
+	    $this->grid_color = $this->grid_mincolor;
+	    $this->DoStroke($this->scale->ticks->ticks_pos);
+
+	    $this->grid_color = $tmp;
+	    $this->DoStroke($this->scale->ticks->maj_ticks_pos);
+	}
+	else {
+	    $this->DoStroke($this->scale->ticks->maj_ticks_pos);
+	}
+    }
+	
+//--------------
+// Private methods	
+    // Draw the grid
+    function DoStroke(&$aTicksPos) {
+	if( !$this->show )
+	    return;	
+	$nbrgrids = count($aTicksPos);	
+
+	if( $this->scale->type=="y" ) {
+	    $xl=$this->img->left_margin;
+	    $xr=$this->img->width-$this->img->right_margin;
+	    
+	    if( $this->fill ) {
+		// Draw filled areas
+		$y2 = $aTicksPos[0];
+		$i=1;
+		while( $i < $nbrgrids ) {
+		    $y1 = $y2;
+		    $y2 = $aTicksPos[$i++];
+		    $this->img->SetColor($this->fillcolor[$i & 1]);
+		    $this->img->FilledRectangle($xl,$y1,$xr,$y2);
+		}
+	    }
+
+	    $this->img->SetColor($this->grid_color);
+	    $this->img->SetLineWeight($this->weight);
+
+	    // Draw grid lines
+	    for($i=0; $i<$nbrgrids; ++$i) {
+		$y=$aTicksPos[$i];
+		if( $this->type == "solid" )
+		    $this->img->Line($xl,$y,$xr,$y);
+		elseif( $this->type == "dotted" )
+		    $this->img->DashedLine($xl,$y,$xr,$y,1,6);
+		elseif( $this->type == "dashed" )
+		    $this->img->DashedLine($xl,$y,$xr,$y,2,4);
+		elseif( $this->type == "longdashed" )
+		    $this->img->DashedLine($xl,$y,$xr,$y,8,6);
+	    }
+	}
+	elseif( $this->scale->type=="x" ) {	
+	    $yu=$this->img->top_margin;
+	    $yl=$this->img->height-$this->img->bottom_margin;
+	    $limit=$this->img->width-$this->img->right_margin;
+
+	    if( $this->fill ) {
+		// Draw filled areas
+		$x2 = $aTicksPos[0];
+		$i=1;
+		while( $i < $nbrgrids ) {
+		    $x1 = $x2;
+		    $x2 = min($aTicksPos[$i++],$limit) ;
+		    $this->img->SetColor($this->fillcolor[$i & 1]);
+		    $this->img->FilledRectangle($x1,$yu,$x2,$yl);
+		}
+	    }
+
+	    $this->img->SetColor($this->grid_color);
+	    $this->img->SetLineWeight($this->weight);
+
+	    // We must also test for limit since we might have
+	    // an offset and the number of ticks is calculated with
+	    // assumption offset==0 so we might end up drawing one
+	    // to many gridlines
+	    $i=0;
+	    $x=$aTicksPos[$i];	    
+	    while( $i<count($aTicksPos) && ($x=$aTicksPos[$i]) <= $limit ) {
+		if( $this->type == "solid" )				
+		    $this->img->Line($x,$yl,$x,$yu);
+		elseif( $this->type == "dotted" )
+		    $this->img->DashedLine($x,$yl,$x,$yu,1,6);
+		elseif( $this->type == "dashed" )
+		    $this->img->DashedLine($x,$yl,$x,$yu,2,4);
+		elseif( $this->type == "longdashed" )
+		    $this->img->DashedLine($x,$yl,$x,$yu,8,6);	
+		++$i;  
+	    }
+	}	
+	else {
+	    JpGraphError::RaiseL(25054,$this->scale->type);//('Internal error: Unknown grid axis ['.$this->scale->type.']');
+	}
+	return true;
+    }
+} // Class
+
+//===================================================
+// CLASS Axis
+// Description: Defines X and Y axis. Notes that at the
+// moment the code is not really good since the axis on
+// several occasion must know wheter it's an X or Y axis.
+// This was a design decision to make the code easier to
+// follow. 
+//===================================================
+class Axis {
+    var $pos = false;
+    var $weight=1;
+    var $color=array(0,0,0),$label_color=array(0,0,0);
+    var $img=null,$scale=null; 
+    var $hide=false;
+    var $ticks_label=false, $ticks_label_colors=null;
+    var $show_first_label=true,$show_last_label=true;
+    var $label_step=1; // Used by a text axis to specify what multiple of major steps
+    // should be labeled.
+    var $tick_step=1;
+    var $labelPos=0;   // Which side of the axis should the labels be?
+    var $title=null,$title_adjust,$title_margin,$title_side=SIDE_LEFT;
+    var $font_family=FF_FONT1,$font_style=FS_NORMAL,$font_size=12,$label_angle=0;
+    var $tick_label_margin=5;
+    var $label_halign = '',$label_valign = '', $label_para_align='left';
+    var $hide_line=false,$hide_labels=false;
+    var $iDeltaAbsPos=0;
+    //var $hide_zero_label=false;
+
+//---------------
+// CONSTRUCTOR
+    function Axis(&$img,&$aScale,$color=array(0,0,0)) {
+	$this->img = &$img;
+	$this->scale = &$aScale;
+	$this->color = $color;
+	$this->title=new Text("");
+		
+	if( $aScale->type=="y" ) {
+	    $this->title_margin = 25;
+	    $this->title_adjust="middle";
+	    $this->title->SetOrientation(90);
+	    $this->tick_label_margin=7;
+	    $this->labelPos=SIDE_LEFT;
+	    //$this->SetLabelFormat('%.1f');
+	}
+	else {
+	    $this->title_margin = 5;
+	    $this->title_adjust="high";
+	    $this->title->SetOrientation(0);			
+	    $this->tick_label_margin=5;
+	    $this->labelPos=SIDE_DOWN;
+	    $this->title_side=SIDE_DOWN;
+	    //$this->SetLabelFormat('%.0f');
+	}
+    }
+//---------------
+// PUBLIC METHODS	
+	
+    function SetLabelFormat($aFormStr) {
+	$this->scale->ticks->SetLabelFormat($aFormStr);
+    }
+	
+    function SetLabelFormatString($aFormStr,$aDate=false) {
+	$this->scale->ticks->SetLabelFormat($aFormStr,$aDate);
+    }
+	
+    function SetLabelFormatCallback($aFuncName) {
+	$this->scale->ticks->SetFormatCallback($aFuncName);
+    }
+
+    function SetLabelAlign($aHAlign,$aVAlign="top",$aParagraphAlign='left') {
+	$this->label_halign = $aHAlign;
+	$this->label_valign = $aVAlign;
+	$this->label_para_align = $aParagraphAlign;
+    }		
+
+    // Don't display the first label
+    function HideFirstTickLabel($aShow=false) {
+	$this->show_first_label=$aShow;
+    }
+
+    function HideLastTickLabel($aShow=false) {
+	$this->show_last_label=$aShow;
+    }
+
+    // Manually specify the major and (optional) minor tick position and labels
+    function SetTickPositions($aMajPos,$aMinPos=NULL,$aLabels=NULL) {
+	$this->scale->ticks->SetTickPositions($aMajPos,$aMinPos,$aLabels);
+    }
+
+    // Manually specify major tick positions and optional labels
+    function SetMajTickPositions($aMajPos,$aLabels=NULL) {
+	$this->scale->ticks->SetTickPositions($aMajPos,NULL,$aLabels);
+    }
+
+    // Hide minor or major tick marks
+    function HideTicks($aHideMinor=true,$aHideMajor=true) {
+	$this->scale->ticks->SupressMinorTickMarks($aHideMinor);
+	$this->scale->ticks->SupressTickMarks($aHideMajor);
+    }
+
+    // Hide zero label
+    function HideZeroLabel($aFlag=true) {
+	$this->scale->ticks->SupressZeroLabel();
+	//$this->hide_zero_label = $aFlag;
+    }
+	
+    function HideFirstLastLabel() {
+	// The two first calls to ticks method will supress 
+	// automatically generated scale values. However, that
+	// will not affect manually specified value, e.g text-scales.
+	// therefor we also make a kludge here to supress manually
+	// specified scale labels.
+	$this->scale->ticks->SupressLast();
+	$this->scale->ticks->SupressFirst();
+	$this->show_first_label	= false;
+	$this->show_last_label = false;
+    }
+	
+    // Hide the axis
+    function Hide($aHide=true) {
+	$this->hide=$aHide;
+    }
+
+    // Hide the actual axis-line, but still print the labels
+    function HideLine($aHide=true) {
+	$this->hide_line = $aHide;
+    }
+
+    function HideLabels($aHide=true) {
+	$this->hide_labels = $aHide;
+    }
+    
+
+    // Weight of axis
+    function SetWeight($aWeight) {
+	$this->weight = $aWeight;
+    }
+
+    // Axis color
+    function SetColor($aColor,$aLabelColor=false) {
+	$this->color = $aColor;
+	if( !$aLabelColor ) $this->label_color = $aColor;
+	else $this->label_color = $aLabelColor;
+    }
+	
+    // Title on axis
+    function SetTitle($aTitle,$aAdjustAlign="high") {
+	$this->title->Set($aTitle);
+	$this->title_adjust=$aAdjustAlign;
+    }
+	
+    // Specify distance from the axis
+    function SetTitleMargin($aMargin) {
+	$this->title_margin=$aMargin;
+    }
+	
+    // Which side of the axis should the axis title be?
+    function SetTitleSide($aSideOfAxis) {
+	$this->title_side = $aSideOfAxis;
+    }
+
+    // Utility function to set the direction for tick marks
+    function SetTickDirection($aDir) {
+    	// Will be deprecated from 1.7    	
+    	if( ERR_DEPRECATED )
+	    JpGraphError::RaiseL(25055);//('Axis::SetTickDirection() is deprecated. Use Axis::SetTickSide() instead');
+	$this->scale->ticks->SetSide($aDir);
+    }
+    
+    function SetTickSide($aDir) {
+	$this->scale->ticks->SetSide($aDir);
+    }
+	
+    // Specify text labels for the ticks. One label for each data point
+    function SetTickLabels($aLabelArray,$aLabelColorArray=null) {
+	$this->ticks_label = $aLabelArray;
+	$this->ticks_label_colors = $aLabelColorArray;
+    }
+	
+    // How far from the axis should the labels be drawn
+    function SetTickLabelMargin($aMargin) {
+	if( ERR_DEPRECATED )    	
+	    JpGraphError::RaiseL(25056);//('SetTickLabelMargin() is deprecated. Use Axis::SetLabelMargin() instead.');
+      	$this->tick_label_margin=$aMargin;
+    }
+
+    function SetLabelMargin($aMargin) {
+	$this->tick_label_margin=$aMargin;
+    }
+	
+    // Specify that every $step of the ticks should be displayed starting
+    // at $start
+    // DEPRECATED FUNCTION: USE SetTextTickInterval() INSTEAD
+    function SetTextTicks($step,$start=0) {
+	JpGraphError::RaiseL(25057);//(" SetTextTicks() is deprecated. Use SetTextTickInterval() instead.");		
+    }
+
+    // Specify that every $step of the ticks should be displayed starting
+    // at $start	
+    function SetTextTickInterval($aStep,$aStart=0) {
+	$this->scale->ticks->SetTextLabelStart($aStart);
+	$this->tick_step=$aStep;
+    }
+	 
+    // Specify that every $step tick mark should have a label 
+    // should be displayed starting
+    function SetTextLabelInterval($aStep,$aStart=0) {
+	if( $aStep < 1 )
+	    JpGraphError::RaiseL(25058);//(" Text label interval must be specified >= 1.");
+	$this->scale->ticks->SetTextLabelStart($aStart);
+	$this->label_step=$aStep;
+    }
+	
+    // Which side of the axis should the labels be on?
+    function SetLabelPos($aSidePos) {
+    	// This will be deprecated from 1.7
+	if( ERR_DEPRECATED )    	
+	    JpGraphError::RaiseL(25059);//('SetLabelPos() is deprecated. Use Axis::SetLabelSide() instead.');
+	$this->labelPos=$aSidePos;
+    }
+    
+    function SetLabelSide($aSidePos) {
+	$this->labelPos=$aSidePos;
+    }
+
+    // Set the font
+    function SetFont($aFamily,$aStyle=FS_NORMAL,$aSize=10) {
+	$this->font_family = $aFamily;
+	$this->font_style = $aStyle;
+	$this->font_size = $aSize;
+    }
+
+    // Position for axis line on the "other" scale
+    function SetPos($aPosOnOtherScale) {
+	$this->pos=$aPosOnOtherScale;
+    }
+
+    // Set the position of the axis to be X-pixels delta to the right 
+    // of the max X-position (used to position the multiple Y-axis)
+    function SetPosAbsDelta($aDelta) {
+      $this->iDeltaAbsPos=$aDelta;
+    }
+	
+    // Specify the angle for the tick labels
+    function SetLabelAngle($aAngle) {
+	$this->label_angle = $aAngle;
+    }	
+	
+    // Stroke the axis.
+    function Stroke($aOtherAxisScale,$aStrokeLabels=true) {		
+	if( $this->hide ) return;		
+	if( is_numeric($this->pos) ) {
+	    $pos=$aOtherAxisScale->Translate($this->pos);
+	}
+	else {	// Default to minimum of other scale if pos not set		
+	    if( ($aOtherAxisScale->GetMinVal() >= 0 && $this->pos==false) || $this->pos=="min" ) {
+		$pos = $aOtherAxisScale->scale_abs[0];
+	    }
+	    elseif($this->pos == "max") {
+		$pos = $aOtherAxisScale->scale_abs[1];
+	    }
+	    else { // If negative set x-axis at 0
+		$this->pos=0;
+		$pos=$aOtherAxisScale->Translate(0);
+	    }
+	}	
+	$pos += $this->iDeltaAbsPos;
+	$this->img->SetLineWeight($this->weight);
+	$this->img->SetColor($this->color);		
+	$this->img->SetFont($this->font_family,$this->font_style,$this->font_size);
+	if( $this->scale->type == "x" ) {
+	    if( !$this->hide_line ) 
+		$this->img->FilledRectangle($this->img->left_margin,$pos,
+					    $this->img->width-$this->img->right_margin,$pos+$this->weight-1);
+	    if( $this->title_side == SIDE_DOWN ) {
+		$y = $pos + $this->img->GetFontHeight() + $this->title_margin + $this->title->margin;
+		$yalign = 'top';
+	    }
+	    else {
+		$y = $pos - $this->img->GetFontHeight() - $this->title_margin - $this->title->margin;
+		$yalign = 'bottom';
+	    }
+
+	    if( $this->title_adjust=="high" )
+		$this->title->Pos($this->img->width-$this->img->right_margin,$y,"right",$yalign);
+	    elseif( $this->title_adjust=="middle" || $this->title_adjust=="center" ) 
+		$this->title->Pos(($this->img->width-$this->img->left_margin-$this->img->right_margin)/2+$this->img->left_margin,$y,"center",$yalign);
+	    elseif($this->title_adjust=="low")
+		$this->title->Pos($this->img->left_margin,$y,"left",$yalign);
+	    else {	
+		JpGraphError::RaiseL(25060,$this->title_adjust);//('Unknown alignment specified for X-axis title. ('.$this->title_adjust.')');
+	    }
+	}
+	elseif( $this->scale->type == "y" ) {
+	    // Add line weight to the height of the axis since
+	    // the x-axis could have a width>1 and we want the axis to fit nicely together.
+	    if( !$this->hide_line ) 
+		$this->img->FilledRectangle($pos-$this->weight+1,$this->img->top_margin,
+					    $pos,$this->img->height-$this->img->bottom_margin+$this->weight-1);
+	    $x=$pos ;
+	    if( $this->title_side == SIDE_LEFT ) {
+		$x -= $this->title_margin;
+		$x -= $this->title->margin;
+		$halign="right";
+	    }
+	    else {
+		$x += $this->title_margin;
+		$x += $this->title->margin;
+		$halign="left";
+	    }
+	    // If the user has manually specified an hor. align
+	    // then we override the automatic settings with this
+	    // specifed setting. Since default is 'left' we compare
+	    // with that. (This means a manually set 'left' align
+	    // will have no effect.)
+	    if( $this->title->halign != 'left' ) 
+		$halign = $this->title->halign;
+	    if( $this->title_adjust=="high" ) 
+		$this->title->Pos($x,$this->img->top_margin,$halign,"top"); 
+	    elseif($this->title_adjust=="middle" || $this->title_adjust=="center")  
+		$this->title->Pos($x,($this->img->height-$this->img->top_margin-$this->img->bottom_margin)/2+$this->img->top_margin,$halign,"center");
+	    elseif($this->title_adjust=="low")
+		$this->title->Pos($x,$this->img->height-$this->img->bottom_margin,$halign,"bottom");
+	    else	
+		JpGraphError::RaiseL(25061,$this->title_adjust);//('Unknown alignment specified for Y-axis title. ('.$this->title_adjust.')');
+		
+	}
+	$this->scale->ticks->Stroke($this->img,$this->scale,$pos);
+	if( $aStrokeLabels ) {
+	    if( !$this->hide_labels )
+		$this->StrokeLabels($pos);
+	    $this->title->Stroke($this->img);
+	}
+    }
+
+//---------------
+// PRIVATE METHODS	
+    // Draw all the tick labels on major tick marks
+    function StrokeLabels($aPos,$aMinor=false,$aAbsLabel=false) {
+
+	$this->img->SetColor($this->label_color);
+	$this->img->SetFont($this->font_family,$this->font_style,$this->font_size);
+	$yoff=$this->img->GetFontHeight()/2;
+
+	// Only draw labels at major tick marks
+	$nbr = count($this->scale->ticks->maj_ticks_label);
+
+	// We have the option to not-display the very first mark
+	// (Usefull when the first label might interfere with another
+	// axis.)
+	$i = $this->show_first_label ? 0 : 1 ;
+	if( !$this->show_last_label ) --$nbr;
+	// Now run through all labels making sure we don't overshoot the end
+	// of the scale.	
+	$ncolor=0;
+	if( isset($this->ticks_label_colors) )
+	    $ncolor=count($this->ticks_label_colors);
+	
+	while( $i<$nbr ) {
+	    // $tpos holds the absolute text position for the label
+	    $tpos=$this->scale->ticks->maj_ticklabels_pos[$i];
+
+	    // Note. the $limit is only used for the x axis since we
+	    // might otherwise overshoot if the scale has been centered
+	    // This is due to us "loosing" the last tick mark if we center.
+	    if( $this->scale->type=="x" && $tpos > $this->img->width-$this->img->right_margin+1 ) {
+	    	return; 
+	    }
+	    // we only draw every $label_step label
+	    if( ($i % $this->label_step)==0 ) {
+
+		// Set specific label color if specified
+		if( $ncolor > 0 )
+		    $this->img->SetColor($this->ticks_label_colors[$i % $ncolor]);
+		
+		// If the label has been specified use that and in other case
+		// just label the mark with the actual scale value 
+		$m=$this->scale->ticks->GetMajor();
+				
+		// ticks_label has an entry for each data point and is the array
+		// that holds the labels set by the user. If the user hasn't 
+		// specified any values we use whats in the automatically asigned
+		// labels in the maj_ticks_label
+		if( isset($this->ticks_label[$i*$m]) )
+		    $label=$this->ticks_label[$i*$m];
+		else {
+		    if( $aAbsLabel ) 
+			$label=abs($this->scale->ticks->maj_ticks_label[$i]);
+		    else
+			$label=$this->scale->ticks->maj_ticks_label[$i];
+		    if( $this->scale->textscale && $this->scale->ticks->label_formfunc == '' ) {
+			++$label;
+		    }
+		}
+					
+		//if( $this->hide_zero_label && $label==0.0 ) {
+		//	++$i;
+		//	continue;
+		//}					
+					
+		if( $this->scale->type == "x" ) {
+		    if( $this->labelPos == SIDE_DOWN ) {
+			if( $this->label_angle==0 || $this->label_angle==90 ) {
+			    if( $this->label_halign=='' && $this->label_valign=='')
+				$this->img->SetTextAlign('center','top');
+			    else
+			    	$this->img->SetTextAlign($this->label_halign,$this->label_valign);
+			    
+			}
+			else {
+			    if( $this->label_halign=='' && $this->label_valign=='')
+				$this->img->SetTextAlign("right","top");
+			    else
+				$this->img->SetTextAlign($this->label_halign,$this->label_valign);
+			}
+
+			$this->img->StrokeText($tpos,$aPos+$this->tick_label_margin,$label,
+					       $this->label_angle,$this->label_para_align);
+		    }
+		    else {
+			if( $this->label_angle==0 || $this->label_angle==90 ) {
+			    if( $this->label_halign=='' && $this->label_valign=='')
+				$this->img->SetTextAlign("center","bottom");
+			    else
+			    	$this->img->SetTextAlign($this->label_halign,$this->label_valign);
+			}
+			else {
+			    if( $this->label_halign=='' && $this->label_valign=='')
+				$this->img->SetTextAlign("right","bottom");
+			    else
+			    	$this->img->SetTextAlign($this->label_halign,$this->label_valign);
+			}
+			$this->img->StrokeText($tpos,$aPos-$this->tick_label_margin,$label,
+					       $this->label_angle,$this->label_para_align);
+		    }
+		}
+		else {
+		    // scale->type == "y"
+		    //if( $this->label_angle!=0 ) 
+		    //JpGraphError::Raise(" Labels at an angle are not supported on Y-axis");
+		    if( $this->labelPos == SIDE_LEFT ) { // To the left of y-axis					
+			if( $this->label_halign=='' && $this->label_valign=='')	
+			    $this->img->SetTextAlign("right","center");
+			else
+			    $this->img->SetTextAlign($this->label_halign,$this->label_valign);
+			$this->img->StrokeText($aPos-$this->tick_label_margin,$tpos,$label,$this->label_angle,$this->label_para_align);	
+		    }
+		    else { // To the right of the y-axis
+			if( $this->label_halign=='' && $this->label_valign=='')	
+			    $this->img->SetTextAlign("left","center");
+			else
+			    $this->img->SetTextAlign($this->label_halign,$this->label_valign);
+			$this->img->StrokeText($aPos+$this->tick_label_margin,$tpos,$label,$this->label_angle,$this->label_para_align);	
+		    }
+		}
+	    }
+	    ++$i;	
+	}								
+    }			
+
+} // Class
+
+//===================================================
+// CLASS Ticks
+// Description: Abstract base class for drawing linear and logarithmic
+// tick marks on axis
+//===================================================
+class Ticks {
+    var $minor_abs_size=3, $major_abs_size=5;
+    var $direction=1; // Should ticks be in(=1) the plot area or outside (=-1)?
+    var $scale;
+    var $is_set=false;
+    var $precision;
+    var $supress_zerolabel=false,$supress_first=false;
+    var $supress_last=false,$supress_tickmarks=false,$supress_minor_tickmarks=false;
+    var $mincolor="",$majcolor="";
+    var $weight=1;
+    var $label_formatstr='';   // C-style format string to use for labels
+    var $label_formfunc='';
+    var $label_dateformatstr='';
+    var $label_usedateformat=FALSE;
+
+
+//---------------
+// CONSTRUCTOR
+    function Ticks(&$aScale) {
+	$this->scale=&$aScale;
+	$this->precision = -1;
+    }
+
+//---------------
+// PUBLIC METHODS	
+    // Set format string for automatic labels
+    function SetLabelFormat($aFormatString,$aDate=FALSE) {
+	$this->label_formatstr=$aFormatString;
+	$this->label_usedateformat=$aDate;
+    }
+
+    function SetLabelDateFormat($aFormatString) {
+	$this->label_dateformatstr=$aFormatString;
+    }
+	
+    function SetFormatCallback($aCallbackFuncName) {
+	$this->label_formfunc = $aCallbackFuncName;
+    }
+	
+    // Don't display the first zero label
+    function SupressZeroLabel($aFlag=true) {
+	$this->supress_zerolabel=$aFlag;
+    }
+	
+    // Don't display minor tick marks
+    function SupressMinorTickMarks($aHide=true) {
+	$this->supress_minor_tickmarks=$aHide;
+    }
+	
+    // Don't display major tick marks
+    function SupressTickMarks($aHide=true) {
+	$this->supress_tickmarks=$aHide;
+    }
+	
+    // Hide the first tick mark
+    function SupressFirst($aHide=true) {
+	$this->supress_first=$aHide;
+    }
+	
+    // Hide the last tick mark
+    function SupressLast($aHide=true) {
+	$this->supress_last=$aHide;
+    }
+
+    // Size (in pixels) of minor tick marks
+    function GetMinTickAbsSize() {
+	return $this->minor_abs_size;
+    }
+	
+    // Size (in pixels) of major tick marks
+    function GetMajTickAbsSize() {
+	return $this->major_abs_size;		
+    }
+	
+    function SetSize($aMajSize,$aMinSize=3) {
+	$this->major_abs_size = $aMajSize;		
+	$this->minor_abs_size = $aMinSize;		
+    }
+
+    // Have the ticks been specified
+    function IsSpecified() {
+	return $this->is_set;
+    }
+	
+    // Set the distance between major and minor tick marks
+    function Set($aMaj,$aMin) {
+	// "Virtual method"
+	// Should be implemented by the concrete subclass
+	// if any action is wanted.
+    }
+	
+    // Specify number of decimals in automatic labels
+    // Deprecated from 1.4. Use SetFormatString() instead
+    function SetPrecision($aPrecision) { 	
+    	if( ERR_DEPRECATED )
+	    JpGraphError::RaiseL(25063);//('Ticks::SetPrecision() is deprecated. Use Ticks::SetLabelFormat() (or Ticks::SetFormatCallback()) instead');
+	$this->precision=$aPrecision;
+    }
+
+    function SetSide($aSide) {
+	$this->direction=$aSide;
+    }
+	
+    // Which side of the axis should the ticks be on
+    function SetDirection($aSide=SIDE_RIGHT) {
+	$this->direction=$aSide;
+    }
+	
+    // Set colors for major and minor tick marks
+    function SetMarkColor($aMajorColor,$aMinorColor="") {
+	$this->SetColor($aMajorColor,$aMinorColor);
+    }
+    
+    function SetColor($aMajorColor,$aMinorColor="") {
+	$this->majcolor=$aMajorColor;
+		
+	// If not specified use same as major
+	if( $aMinorColor=="" ) 
+	    $this->mincolor=$aMajorColor;
+	else
+	    $this->mincolor=$aMinorColor;
+    }
+	
+    function SetWeight($aWeight) {
+	$this->weight=$aWeight;
+    }
+	
+} // Class
+
+//===================================================
+// CLASS LinearTicks
+// Description: Draw linear ticks on axis
+//===================================================
+class LinearTicks extends Ticks {
+    var $minor_step=1, $major_step=2;
+    var $xlabel_offset=0,$xtick_offset=0;
+    var $label_offset=0; // What offset should the displayed label have
+    // i.e should we display 0,1,2 or 1,2,3,4 or 2,3,4 etc
+    var $text_label_start=0;
+    var $iManualTickPos = NULL, $iManualMinTickPos = NULL, $iManualTickLabels = NULL;
+    var $maj_ticks_pos = array(), $maj_ticklabels_pos = array(), 
+	$ticks_pos = array(), $maj_ticks_label = array();
+
+//---------------
+// CONSTRUCTOR
+    function LinearTicks() {
+	$this->precision = -1;
+    }
+
+//---------------
+// PUBLIC METHODS	
+	
+	
+    // Return major step size in world coordinates
+    function GetMajor() {
+	return $this->major_step;
+    }
+	
+    // Return minor step size in world coordinates
+    function GetMinor() {
+	return $this->minor_step;
+    }
+	
+    // Set Minor and Major ticks (in world coordinates)
+    function Set($aMajStep,$aMinStep=false) {
+	if( $aMinStep==false ) 
+	    $aMinStep=$aMajStep;
+    	
+	if( $aMajStep <= 0 || $aMinStep <= 0 ) {
+	    JpGraphError::RaiseL(25064);
+//(" Minor or major step size is 0. Check that you haven't got an accidental SetTextTicks(0) in your code. If this is not the case you might have stumbled upon a bug in JpGraph. Please report this and if possible include the data that caused the problem.");
+	}
+		
+	$this->major_step=$aMajStep;
+	$this->minor_step=$aMinStep;
+	$this->is_set = true;
+    }
+
+    function SetMajTickPositions($aMajPos,$aLabels=NULL) {
+	$this->SetTickPositions($aMajPos,NULL,$aLabels);
+    }
+
+    function SetTickPositions($aMajPos,$aMinPos=NULL,$aLabels=NULL) {
+	if( !is_array($aMajPos) || ($aMinPos!==NULL && !is_array($aMinPos)) ) {
+	    JpGraphError::RaiseL(25065);//('Tick positions must be specifued as an array()');
+	    return;
+	}
+	$n=count($aMajPos);
+	if( is_array($aLabels) && (count($aLabels) != $n) ) {
+	    JpGraphError::RaiseL(25066);//('When manually specifying tick positions and labels the number of labels must be the same as the number of specified ticks.');
+	    return;
+	}
+	$this->iManualTickPos = $aMajPos;
+	$this->iManualMinTickPos = $aMinPos;
+	$this->iManualTickLabels = $aLabels;
+    }
+
+    // Specify all the tick positions manually and possible also the exact labels 
+    function _doManualTickPos($aScale) { 
+	$n=count($this->iManualTickPos);
+	$m=count($this->iManualMinTickPos);
+	$doLbl=count($this->iManualTickLabels) > 0;
+	$this->use_manualtickpos=true;
+
+	$this->maj_ticks_pos = array();
+	$this->maj_ticklabels_pos = array();
+	$this->ticks_pos = array();
+
+	// Now loop through the supplied positions and translate them to screen coordinates
+	// and store them in the maj_label_positions
+	$minScale = $aScale->scale[0];
+	$maxScale = $aScale->scale[1];
+	$j=0;
+	for($i=0; $i < $n ; ++$i ) {
+	    // First make sure that the first tick is not lower than the lower scale value
+	    if( !isset($this->iManualTickPos[$i])  || 
+		$this->iManualTickPos[$i] < $minScale  || $this->iManualTickPos[$i] > $maxScale) {
+		continue;
+	    }
+
+
+	    $this->maj_ticks_pos[$j] = $aScale->Translate($this->iManualTickPos[$i]);
+	    $this->maj_ticklabels_pos[$j] = $this->maj_ticks_pos[$j];	
+
+	    // Set the minor tick marks the same as major if not specified
+	    if( $m <= 0 ) {
+		$this->ticks_pos[$j] = $this->maj_ticks_pos[$j];
+	    }
+
+	    if( $doLbl ) { 
+		$this->maj_ticks_label[$j] = $this->iManualTickLabels[$i];
+	    }
+	    else {
+		$this->maj_ticks_label[$j]=$this->_doLabelFormat($this->iManualTickPos[$i],$i,$n);
+	    }
+	    ++$j;
+	}
+
+	// Some sanity check
+	if( count($this->maj_ticks_pos) < 2 ) {
+	    JpGraphError::RaiseL(25067);//('Your manually specified scale and ticks is not correct. The scale seems to be too small to hold any of the specified tickl marks.');
+	}
+
+	// Setup the minor tick marks
+	$j=0;
+	for($i=0; $i < $m; ++$i ) {
+	    if(  empty($this->iManualMinTickPos[$i]) || 
+		 $this->iManualMinTickPos[$i] < $minScale  || $this->iManualMinTickPos[$i] > $maxScale) 
+		continue;
+	    $this->ticks_pos[$j] = $aScale->Translate($this->iManualMinTickPos[$i]);
+	    ++$j;
+	}
+    }
+
+    function _doAutoTickPos($aScale) {
+	$maj_step_abs = $aScale->scale_factor*$this->major_step;		
+	$min_step_abs = $aScale->scale_factor*$this->minor_step;		
+
+	if( $min_step_abs==0 || $maj_step_abs==0 ) {
+	    JpGraphError::RaiseL(25068);//("A plot has an illegal scale. This could for example be that you are trying to use text autoscaling to draw a line plot with only one point or that the plot area is too small. It could also be that no input data value is numeric (perhaps only '-' or 'x')");
+	}
+	// We need to make this an int since comparing it below
+	// with the result from round() can give wrong result, such that
+	// (40 < 40) == TRUE !!!
+	$limit = (int)$aScale->scale_abs[1];	
+
+	if( $aScale->textscale ) {
+	    // This can only be true for a X-scale (horizontal)
+	    // Define ticks for a text scale. This is slightly different from a 
+	    // normal linear type of scale since the position might be adjusted
+	    // and the labels start at on
+	    $label = (float)$aScale->GetMinVal()+$this->text_label_start+$this->label_offset;	
+	    $start_abs=$aScale->scale_factor*$this->text_label_start;
+	    $nbrmajticks=ceil(($aScale->GetMaxVal()-$aScale->GetMinVal()-$this->text_label_start )/$this->major_step)+1;	
+	    $x = $aScale->scale_abs[0]+$start_abs+$this->xlabel_offset*$min_step_abs;	
+	    for( $i=0; $label <= $aScale->GetMaxVal()+$this->label_offset; ++$i ) {
+		// Apply format to label
+		$this->maj_ticks_label[$i]=$this->_doLabelFormat($label,$i,$nbrmajticks);
+		$label+=$this->major_step;
+
+		// The x-position of the tick marks can be different from the labels.
+		// Note that we record the tick position (not the label) so that the grid
+		// happen upon tick marks and not labels.
+		$xtick=$aScale->scale_abs[0]+$start_abs+$this->xtick_offset*$min_step_abs+$i*$maj_step_abs;
+		$this->maj_ticks_pos[$i]=$xtick;
+		$this->maj_ticklabels_pos[$i] = round($x);				
+		$x += $maj_step_abs;
+	    }
+	}
+	else {
+	    $label = $aScale->GetMinVal();	
+	    $abs_pos = $aScale->scale_abs[0];
+	    $j=0; $i=0;
+	    $step = round($maj_step_abs/$min_step_abs);
+	    if( $aScale->type == "x" ) {
+		// For a normal linear type of scale the major ticks will always be multiples
+		// of the minor ticks. In order to avoid any rounding issues the major ticks are
+		// defined as every "step" minor ticks and not calculated separately
+		$nbrmajticks=ceil(($aScale->GetMaxVal()-$aScale->GetMinVal()-$this->text_label_start )/$this->major_step)+1; 
+		while( round($abs_pos) <= $limit ) {
+		    $this->ticks_pos[] = round($abs_pos);
+		    $this->ticks_label[] = $label;
+		    if( $i % $step == 0 && $j < $nbrmajticks ) {
+			$this->maj_ticks_pos[$j] = round($abs_pos);
+			$this->maj_ticklabels_pos[$j] = round($abs_pos);
+			$this->maj_ticks_label[$j]=$this->_doLabelFormat($label,$j,$nbrmajticks);
+			++$j;
+		    }
+		    ++$i;
+		    $abs_pos += $min_step_abs;
+		    $label+=$this->minor_step;
+		}
+	    }
+	    elseif( $aScale->type == "y" ) {
+		$nbrmajticks=floor(($aScale->GetMaxVal()-$aScale->GetMinVal())/$this->major_step)+1;
+		while( round($abs_pos) >= $limit ) {
+		    $this->ticks_pos[$i] = round($abs_pos); 
+		    $this->ticks_label[$i]=$label;
+		    if( $i % $step == 0 && $j < $nbrmajticks) {
+			$this->maj_ticks_pos[$j] = round($abs_pos);
+			$this->maj_ticklabels_pos[$j] = round($abs_pos);
+			$this->maj_ticks_label[$j]=$this->_doLabelFormat($label,$j,$nbrmajticks);
+			++$j;
+		    }
+		    ++$i;
+		    $abs_pos += $min_step_abs;
+		    $label += $this->minor_step;
+		}	
+	    }
+	}	
+    }
+
+    function _doLabelFormat($aVal,$aIdx,$aNbrTicks) {
+
+	// If precision hasn't been specified set it to a sensible value
+	if( $this->precision==-1 ) { 
+	    $t = log10($this->minor_step);
+	    if( $t > 0 )
+		$precision = 0;
+	    else
+		$precision = -floor($t);
+	}
+	else
+	    $precision = $this->precision;
+
+	if( $this->label_formfunc != '' ) {
+	    $f=$this->label_formfunc;
+	    $l = call_user_func($f,$aVal);
+	}	
+	elseif( $this->label_formatstr != '' || $this->label_dateformatstr != '' ) {
+	    if( $this->label_usedateformat ) {
+		$l = date($this->label_formatstr,$aVal);
+	    }
+	    else {
+		if( $this->label_dateformatstr !== '' )
+		    $l = date($this->label_dateformatstr,$aVal);
+		else
+		    $l = sprintf($this->label_formatstr,$aVal);
+	    }
+	}
+	else {
+	    $l = sprintf('%01.'.$precision.'f',round($aVal,$precision));
+	}
+	
+	if( ($this->supress_zerolabel && $l==0) ||  ($this->supress_first && $aIdx==0) ||
+	    ($this->supress_last  && $aIdx==$aNbrTicks-1) ) {
+	    $l='';
+	}
+	return $l;
+    }
+
+    // Stroke ticks on either X or Y axis
+    function _StrokeTicks(&$aImg,$aScale,$aPos) {
+	$hor = $aScale->type == 'x';
+	$aImg->SetLineWeight($this->weight);	
+
+	// We need to make this an int since comparing it below
+	// with the result from round() can give wrong result, such that
+	// (40 < 40) == TRUE !!!
+	$limit = (int)$aScale->scale_abs[1];
+		
+	// A text scale doesn't have any minor ticks
+	if( !$aScale->textscale ) {
+	    // Stroke minor ticks
+	    $yu = $aPos - $this->direction*$this->GetMinTickAbsSize();
+	    $xr = $aPos + $this->direction*$this->GetMinTickAbsSize();
+	    $n = count($this->ticks_pos);
+	    for($i=0; $i < $n; ++$i ) {
+		if( !$this->supress_tickmarks && !$this->supress_minor_tickmarks) {
+		    if( $this->mincolor!="" ) $aImg->PushColor($this->mincolor);
+		    if( $hor ) {
+			//if( $this->ticks_pos[$i] <= $limit ) 
+			$aImg->Line($this->ticks_pos[$i],$aPos,$this->ticks_pos[$i],$yu); 
+		    }
+		    else {
+			//if( $this->ticks_pos[$i] >= $limit ) 
+			$aImg->Line($aPos,$this->ticks_pos[$i],$xr,$this->ticks_pos[$i]); 
+		    }
+		    if( $this->mincolor!="" ) $aImg->PopColor();
+		}
+	    }
+	}
+
+	// Stroke major ticks
+	$yu = $aPos - $this->direction*$this->GetMajTickAbsSize();
+	$xr = $aPos + $this->direction*$this->GetMajTickAbsSize();
+	$nbrmajticks=ceil(($aScale->GetMaxVal()-$aScale->GetMinVal()-$this->text_label_start )/$this->major_step)+1;
+	$n = count($this->maj_ticks_pos);
+	for($i=0; $i < $n ; ++$i ) {
+	    if(!($this->xtick_offset > 0 && $i==$nbrmajticks-1) && !$this->supress_tickmarks) {
+		if( $this->majcolor!="" ) $aImg->PushColor($this->majcolor);
+		if( $hor ) {
+		    //if( $this->maj_ticks_pos[$i] <= $limit ) 
+		    $aImg->Line($this->maj_ticks_pos[$i],$aPos,$this->maj_ticks_pos[$i],$yu); 
+		}
+		else {
+		    //if( $this->maj_ticks_pos[$i] >= $limit ) 
+		    $aImg->Line($aPos,$this->maj_ticks_pos[$i],$xr,$this->maj_ticks_pos[$i]); 
+		}
+		if( $this->majcolor!="" ) $aImg->PopColor();
+	    }
+	}
+	
+    }
+
+    // Draw linear ticks
+    function Stroke(&$aImg,$aScale,$aPos) {
+	if( $this->iManualTickPos != NULL ) 
+	    $this->_doManualTickPos($aScale);
+	else 
+	    $this->_doAutoTickPos($aScale);
+	$this->_StrokeTicks($aImg,$aScale,$aPos, $aScale->type == 'x' );
+    }
+
+//---------------
+// PRIVATE METHODS
+    // Spoecify the offset of the displayed tick mark with the tick "space"
+    // Legal values for $o is [0,1] used to adjust where the tick marks and label 
+    // should be positioned within the major tick-size
+    // $lo specifies the label offset and $to specifies the tick offset
+    // this comes in handy for example in bar graphs where we wont no offset for the
+    // tick but have the labels displayed halfway under the bars.
+    function SetXLabelOffset($aLabelOff,$aTickOff=-1) {
+	$this->xlabel_offset=$aLabelOff;
+	if( $aTickOff==-1 )	// Same as label offset
+	    $this->xtick_offset=$aLabelOff;
+	else
+	    $this->xtick_offset=$aTickOff;
+	if( $aLabelOff>0 )
+	    $this->SupressLast();	// The last tick wont fit
+    }
+
+    // Which tick label should we start with?
+    function SetTextLabelStart($aTextLabelOff) {
+	$this->text_label_start=$aTextLabelOff;
+    }
+	
+} // Class
+
+//===================================================
+// CLASS LinearScale
+// Description: Handle linear scaling between screen and world 
+//===================================================
+class LinearScale {
+    var $scale=array(0,0);
+    var $scale_abs=array(0,0);
+    var $scale_factor; // Scale factor between world and screen
+    var $world_size;	// Plot area size in world coordinates
+    var $world_abs_size; // Plot area size in pixels
+    var $off; // Offset between image edge and plot area
+    var $type; // is this x or y scale ?
+    var $ticks=null; // Store ticks
+    var $text_scale_off = 0;
+    var $autoscale_min=false; // Forced minimum value, auto determine max
+    var $autoscale_max=false; // Forced maximum value, auto determine min
+    var $gracetop=0,$gracebottom=0;
+    var $intscale=false; // Restrict autoscale to integers
+    var $textscale=false; // Just a flag to let the Plot class find out if
+    // we are a textscale or not. This is a cludge since
+    // this ionformatyion is availabale in Graph::axtype but
+    // we don't have access to the graph object in the Plots
+    // stroke method. So we let graph store the status here
+    // when the linear scale is created. A real cludge...
+    var $auto_ticks=false; // When using manual scale should the ticks be automatically set?
+    var $name = 'lin';
+//---------------
+// CONSTRUCTOR
+    function LinearScale($aMin=0,$aMax=0,$aType="y") {
+	assert($aType=="x" || $aType=="y" );
+	assert($aMin<=$aMax);
+		
+	$this->type=$aType;
+	$this->scale=array($aMin,$aMax);		
+	$this->world_size=$aMax-$aMin;	
+	$this->ticks = new LinearTicks();
+    }
+
+//---------------
+// PUBLIC METHODS	
+    // Check if scale is set or if we should autoscale
+    // We should do this is either scale or ticks has not been set
+    function IsSpecified() {
+	if( $this->GetMinVal()==$this->GetMaxVal() ) {		// Scale not set
+	    return false;
+	}
+	return true;
+    }
+	
+    // Set the minimum data value when the autoscaling is used. 
+    // Usefull if you want a fix minimum (like 0) but have an
+    // automatic maximum
+    function SetAutoMin($aMin) {
+	$this->autoscale_min=$aMin;
+    }
+
+    // Set the minimum data value when the autoscaling is used. 
+    // Usefull if you want a fix minimum (like 0) but have an
+    // automatic maximum
+    function SetAutoMax($aMax) {
+	$this->autoscale_max=$aMax;
+    }
+
+    // If the user manually specifies a scale should the ticks
+    // still be set automatically?
+    function SetAutoTicks($aFlag=true) {
+	$this->auto_ticks = $aFlag;
+    }
+
+    // Specify scale "grace" value (top and bottom)
+    function SetGrace($aGraceTop,$aGraceBottom=0) {
+	if( $aGraceTop<0 || $aGraceBottom < 0  )
+	    JpGraphError::RaiseL(25069);//(" Grace must be larger then 0");
+	$this->gracetop=$aGraceTop;
+	$this->gracebottom=$aGraceBottom;
+    }
+	
+    // Get the minimum value in the scale
+    function GetMinVal() {
+	return $this->scale[0];
+    }
+	
+    // get maximum value for scale
+    function GetMaxVal() {
+	return $this->scale[1];
+    }
+		
+    // Specify a new min/max value for sclae	
+    function Update(&$aImg,$aMin,$aMax) {
+	$this->scale=array($aMin,$aMax);		
+	$this->world_size=$aMax-$aMin;		
+	$this->InitConstants($aImg);					
+    }
+	
+    // Translate between world and screen
+    function Translate($aCoord) {
+	if( !is_numeric($aCoord) ) {
+	    if( $aCoord != '' && $aCoord != '-' && $aCoord != 'x' ) 
+		JpGraphError::RaiseL(25070);//('Your data contains non-numeric values.');
+	    return 0;
+	}
+	else {
+	    return $this->off + ($aCoord - $this->scale[0])*$this->scale_factor;
+	}
+    }
+	
+    // Relative translate (don't include offset) usefull when we just want
+    // to know the relative position (in pixels) on the axis
+    function RelTranslate($aCoord) {
+	if( !is_numeric($aCoord) ) {
+	    if( $aCoord != '' && $aCoord != '-' && $aCoord != 'x'  ) 
+		JpGraphError::RaiseL(25070);//('Your data contains non-numeric values.');
+	    return 0;
+	}
+	else { 
+	    return ($aCoord - $this->scale[0]) * $this->scale_factor; 
+	}
+    }
+	
+    // Restrict autoscaling to only use integers
+    function SetIntScale($aIntScale=true) {
+	$this->intscale=$aIntScale;
+    }
+	
+    // Calculate an integer autoscale
+    function IntAutoScale(&$img,$min,$max,$maxsteps,$majend=true) {
+	// Make sure limits are integers
+	$min=floor($min);
+	$max=ceil($max);
+	if( abs($min-$max)==0 ) {
+	    --$min; ++$max;
+	}
+	$maxsteps = floor($maxsteps);
+		
+	$gracetop=round(($this->gracetop/100.0)*abs($max-$min));
+	$gracebottom=round(($this->gracebottom/100.0)*abs($max-$min));
+	if( is_numeric($this->autoscale_min) ) {
+	    $min = ceil($this->autoscale_min);
+	    if( $min >= $max ) {
+		JpGraphError::RaiseL(25071);//('You have specified a min value with SetAutoMin() which is larger than the maximum value used for the scale. This is not possible.');
+	    }
+	}
+
+	if( is_numeric($this->autoscale_max) ) {
+	    $max = ceil($this->autoscale_max);
+	    if( $min >= $max ) {
+		JpGraphError::RaiseL(25072);//('You have specified a max value with SetAutoMax() which is smaller than the miminum value used for the scale. This is not possible.');
+	    }
+	}
+
+	if( abs($min-$max ) == 0 ) {
+	    ++$max;
+	    --$min;
+	}
+			
+	$min -= $gracebottom;
+	$max += $gracetop;		
+
+	// First get tickmarks as multiples of 1, 10, ...	
+	if( $majend ) {
+	    list($num1steps,$adj1min,$adj1max,$maj1step) = 
+		$this->IntCalcTicks($maxsteps,$min,$max,1);
+	}
+	else {
+	    $adj1min = $min;
+	    $adj1max = $max;
+	    list($num1steps,$maj1step) = 
+		$this->IntCalcTicksFreeze($maxsteps,$min,$max,1);
+	}
+
+	if( abs($min-$max) > 2 ) {
+	    // Then get tick marks as 2:s 2, 20, ...
+	    if( $majend ) {
+		list($num2steps,$adj2min,$adj2max,$maj2step) = 
+		    $this->IntCalcTicks($maxsteps,$min,$max,5);
+	    }
+	    else {
+		$adj2min = $min;
+		$adj2max = $max;
+		list($num2steps,$maj2step) = 
+		    $this->IntCalcTicksFreeze($maxsteps,$min,$max,5);
+	    }
+	}
+	else {
+	    $num2steps = 10000;	// Dummy high value so we don't choose this
+	}
+	
+	if( abs($min-$max) > 5 ) {	
+	    // Then get tickmarks as 5:s 5, 50, 500, ...
+	    if( $majend ) {
+		list($num5steps,$adj5min,$adj5max,$maj5step) = 
+		    $this->IntCalcTicks($maxsteps,$min,$max,2);
+	    }
+	    else {
+		$adj5min = $min;
+		$adj5max = $max;
+		list($num5steps,$maj5step) = 
+		    $this->IntCalcTicksFreeze($maxsteps,$min,$max,2);
+	    }
+	}
+	else {
+	    $num5steps = 10000;	// Dummy high value so we don't choose this		
+	}
+	
+	// Check to see whichof 1:s, 2:s or 5:s fit better with
+	// the requested number of major ticks		
+	$match1=abs($num1steps-$maxsteps);		
+	$match2=abs($num2steps-$maxsteps);
+	if( !empty($maj5step) && $maj5step > 1 )
+	    $match5=abs($num5steps-$maxsteps);
+	else
+	    $match5=10000; 	// Dummy high value 
+		
+	// Compare these three values and see which is the closest match
+	// We use a 0.6 weight to gravitate towards multiple of 5:s 
+	if( $match1 < $match2 ) {
+	    if( $match1 < $match5 )
+		$r=1;			
+	    else 
+		$r=3;
+	}
+	else {
+	    if( $match2 < $match5 )
+		$r=2;			
+	    else 
+		$r=3;		
+	}	
+	// Minsteps are always the same as maxsteps for integer scale
+	switch( $r ) {
+	    case 1:
+		$this->ticks->Set($maj1step,$maj1step);
+		$this->Update($img,$adj1min,$adj1max);
+		break;			
+	    case 2:
+		$this->ticks->Set($maj2step,$maj2step);
+		$this->Update($img,$adj2min,$adj2max);		
+		break;									
+	    case 3:
+		$this->ticks->Set($maj5step,$maj5step);		
+		$this->Update($img,$adj5min,$adj5max);
+		break;	
+	    default:
+		JpGraphError::RaiseL(25073,$r);//('Internal error. Integer scale algorithm comparison out of bound (r=$r)');
+	}		
+    }
+	
+	
+    // Calculate autoscale. Used if user hasn't given a scale and ticks
+    // $maxsteps is the maximum number of major tickmarks allowed.
+    function AutoScale(&$img,$min,$max,$maxsteps,$majend=true) {
+	if( $this->intscale ) {	
+	    $this->IntAutoScale($img,$min,$max,$maxsteps,$majend);
+	    return;
+	}
+	if( abs($min-$max) < 0.00001 ) {
+	    // We need some difference to be able to autoscale
+	    // make it 5% above and 5% below value
+	    if( $min==0 && $max==0 ) {		// Special case
+		$min=-1; $max=1;
+	    }
+	    else {
+		$delta = (abs($max)+abs($min))*0.005;
+		$min -= $delta;
+		$max += $delta;
+	    }
+	}
+		
+	$gracetop=($this->gracetop/100.0)*abs($max-$min);
+	$gracebottom=($this->gracebottom/100.0)*abs($max-$min);
+	if( is_numeric($this->autoscale_min) ) {
+	    $min = $this->autoscale_min;
+	    if( $min >= $max ) {
+		JpGraphError::RaiseL(25071);//('You have specified a min value with SetAutoMin() which is larger than the maximum value used for the scale. This is not possible.');
+	    }
+	    if( abs($min-$max ) < 0.00001 )
+		$max *= 1.2;
+	}
+
+	if( is_numeric($this->autoscale_max) ) {
+	    $max = $this->autoscale_max;
+	    if( $min >= $max ) {
+		JpGraphError::RaiseL(25072);//('You have specified a max value with SetAutoMax() which is smaller than the miminum value used for the scale. This is not possible.');
+	    }
+	    if( abs($min-$max ) < 0.00001 )
+		$min *= 0.8;
+	}
+
+	
+	$min -= $gracebottom;
+	$max += $gracetop;
+
+	// First get tickmarks as multiples of 0.1, 1, 10, ...	
+	if( $majend ) {
+	    list($num1steps,$adj1min,$adj1max,$min1step,$maj1step) = 
+		$this->CalcTicks($maxsteps,$min,$max,1,2);
+	}
+	else {
+	    $adj1min=$min;
+	    $adj1max=$max;
+	    list($num1steps,$min1step,$maj1step) = 
+		$this->CalcTicksFreeze($maxsteps,$min,$max,1,2,false);
+	}
+		
+	// Then get tick marks as 2:s 0.2, 2, 20, ...
+	if( $majend ) {
+	    list($num2steps,$adj2min,$adj2max,$min2step,$maj2step) = 
+		$this->CalcTicks($maxsteps,$min,$max,5,2);
+	}
+	else {
+	    $adj2min=$min;
+	    $adj2max=$max;
+	    list($num2steps,$min2step,$maj2step) = 
+		$this->CalcTicksFreeze($maxsteps,$min,$max,5,2,false);
+	}
+		
+	// Then get tickmarks as 5:s 0.05, 0.5, 5, 50, ...
+	if( $majend ) {
+	    list($num5steps,$adj5min,$adj5max,$min5step,$maj5step) = 
+		$this->CalcTicks($maxsteps,$min,$max,2,5);		
+	}
+	else {
+	    $adj5min=$min;
+	    $adj5max=$max;
+	    list($num5steps,$min5step,$maj5step) = 
+		$this->CalcTicksFreeze($maxsteps,$min,$max,2,5,false);
+	}
+
+	// Check to see whichof 1:s, 2:s or 5:s fit better with
+	// the requested number of major ticks		
+	$match1=abs($num1steps-$maxsteps);		
+	$match2=abs($num2steps-$maxsteps);
+	$match5=abs($num5steps-$maxsteps);
+	// Compare these three values and see which is the closest match
+	// We use a 0.8 weight to gravitate towards multiple of 5:s 
+	$r=$this->MatchMin3($match1,$match2,$match5,0.8);
+	switch( $r ) {
+	    case 1:
+		$this->Update($img,$adj1min,$adj1max);
+		$this->ticks->Set($maj1step,$min1step);
+		break;			
+	    case 2:
+		$this->Update($img,$adj2min,$adj2max);		
+		$this->ticks->Set($maj2step,$min2step);
+		break;									
+	    case 3:
+		$this->Update($img,$adj5min,$adj5max);
+		$this->ticks->Set($maj5step,$min5step);		
+		break;			
+	}
+    }
+
+//---------------
+// PRIVATE METHODS	
+
+    // This method recalculates all constants that are depending on the
+    // margins in the image. If the margins in the image are changed
+    // this method should be called for every scale that is registred with
+    // that image. Should really be installed as an observer of that image.
+    function InitConstants(&$img) {
+	if( $this->type=="x" ) {
+	    $this->world_abs_size=$img->width - $img->left_margin - $img->right_margin;
+	    $this->off=$img->left_margin;
+	    $this->scale_factor = 0;
+	    if( $this->world_size > 0 )
+		$this->scale_factor=$this->world_abs_size/($this->world_size*1.0);
+	}
+	else { // y scale
+	    $this->world_abs_size=$img->height - $img->top_margin - $img->bottom_margin; 
+	    $this->off=$img->top_margin+$this->world_abs_size;			
+	    $this->scale_factor = 0;			
+	    if( $this->world_size > 0 ) {
+		$this->scale_factor=-$this->world_abs_size/($this->world_size*1.0);	
+	    }
+	}
+	$size = $this->world_size * $this->scale_factor;
+	$this->scale_abs=array($this->off,$this->off + $size);	
+    }
+	
+    // Initialize the conversion constants for this scale
+    // This tries to pre-calculate as much as possible to speed up the
+    // actual conversion (with Translate()) later on
+    // $start	=scale start in absolute pixels (for x-scale this is an y-position
+    //				 and for an y-scale this is an x-position
+    // $len 		=absolute length in pixels of scale 			
+    function SetConstants($aStart,$aLen) {
+	$this->world_abs_size=$aLen;
+	$this->off=$aStart;
+		
+	if( $this->world_size<=0 ) {
+	    // This should never ever happen !!
+	    JpGraphError::RaiseL(25074);
+//("You have unfortunately stumbled upon a bug in JpGraph. It seems like the scale range is ".$this->world_size." [for ".$this->type." scale] <br> Please report Bug #01 to jpgraph@aditus.nu and include the script that gave this error. This problem could potentially be caused by trying to use \"illegal\" values in the input data arrays (like trying to send in strings or only NULL values) which causes the autoscaling to fail.");
+
+	}
+		
+	// scale_factor = number of pixels per world unit
+	$this->scale_factor=$this->world_abs_size/($this->world_size*1.0);
+		
+	// scale_abs = start and end points of scale in absolute pixels
+	$this->scale_abs=array($this->off,$this->off+$this->world_size*$this->scale_factor);		
+    }
+	
+	
+    // Calculate number of ticks steps with a specific division
+    // $a is the divisor of 10**x to generate the first maj tick intervall
+    // $a=1, $b=2 give major ticks with multiple of 10, ...,0.1,1,10,...
+    // $a=5, $b=2 give major ticks with multiple of 2:s ...,0.2,2,20,...
+    // $a=2, $b=5 give major ticks with multiple of 5:s ...,0.5,5,50,...
+    // We return a vector of
+    // 	[$numsteps,$adjmin,$adjmax,$minstep,$majstep]
+    // If $majend==true then the first and last marks on the axis will be major
+    // labeled tick marks otherwise it will be adjusted to the closest min tick mark
+    function CalcTicks($maxsteps,$min,$max,$a,$b,$majend=true) {
+	$diff=$max-$min; 
+	if( $diff==0 )
+	    $ld=0;
+	else
+	    $ld=floor(log10($diff));
+
+	// Gravitate min towards zero if we are close		
+	if( $min>0 && $min < pow(10,$ld) ) $min=0;
+		
+	//$majstep=pow(10,$ld-1)/$a; 
+	$majstep=pow(10,$ld)/$a; 
+	$minstep=$majstep/$b;
+	
+	$adjmax=ceil($max/$minstep)*$minstep;
+	$adjmin=floor($min/$minstep)*$minstep;	
+	$adjdiff = $adjmax-$adjmin;
+	$numsteps=$adjdiff/$majstep; 
+	
+	while( $numsteps>$maxsteps ) {
+	    $majstep=pow(10,$ld)/$a; 
+	    $numsteps=$adjdiff/$majstep;
+	    ++$ld;
+	}
+
+	$minstep=$majstep/$b;
+	$adjmin=floor($min/$minstep)*$minstep;	
+	$adjdiff = $adjmax-$adjmin;		
+	if( $majend ) {
+	    $adjmin = floor($min/$majstep)*$majstep;	
+	    $adjdiff = $adjmax-$adjmin;		
+	    $adjmax = ceil($adjdiff/$majstep)*$majstep+$adjmin;
+	}
+	else
+	    $adjmax=ceil($max/$minstep)*$minstep;
+
+	return array($numsteps,$adjmin,$adjmax,$minstep,$majstep);
+    }
+
+    function CalcTicksFreeze($maxsteps,$min,$max,$a,$b) {
+	// Same as CalcTicks but don't adjust min/max values
+	$diff=$max-$min; 
+	if( $diff==0 )
+	    $ld=0;
+	else
+	    $ld=floor(log10($diff));
+
+	//$majstep=pow(10,$ld-1)/$a; 
+	$majstep=pow(10,$ld)/$a; 
+	$minstep=$majstep/$b;
+	$numsteps=floor($diff/$majstep); 
+	
+	while( $numsteps > $maxsteps ) {
+	    $majstep=pow(10,$ld)/$a; 
+	    $numsteps=floor($diff/$majstep);
+	    ++$ld;
+	}
+	$minstep=$majstep/$b;
+	return array($numsteps,$minstep,$majstep);
+    }
+
+	
+    function IntCalcTicks($maxsteps,$min,$max,$a,$majend=true) {
+	$diff=$max-$min; 
+	if( $diff==0 )
+	    JpGraphError::RaiseL(25075);//('Can\'t automatically determine ticks since min==max.');
+	else
+	    $ld=floor(log10($diff));
+		
+	// Gravitate min towards zero if we are close		
+	if( $min>0 && $min < pow(10,$ld) ) $min=0;
+		
+	if( $ld == 0 ) $ld=1;
+	
+	if( $a == 1 ) 
+	    $majstep = 1;
+	else
+	    $majstep=pow(10,$ld)/$a; 
+	$adjmax=ceil($max/$majstep)*$majstep;
+
+	$adjmin=floor($min/$majstep)*$majstep;	
+	$adjdiff = $adjmax-$adjmin;
+	$numsteps=$adjdiff/$majstep; 
+	while( $numsteps>$maxsteps ) {
+	    $majstep=pow(10,$ld)/$a; 
+	    $numsteps=$adjdiff/$majstep;
+	    ++$ld;
+	}
+		
+	$adjmin=floor($min/$majstep)*$majstep;	
+	$adjdiff = $adjmax-$adjmin;		
+	if( $majend ) {
+	    $adjmin = floor($min/$majstep)*$majstep;	
+	    $adjdiff = $adjmax-$adjmin;		
+	    $adjmax = ceil($adjdiff/$majstep)*$majstep+$adjmin;
+	}
+	else
+	    $adjmax=ceil($max/$majstep)*$majstep;
+			
+	return array($numsteps,$adjmin,$adjmax,$majstep);		
+    }
+
+
+    function IntCalcTicksFreeze($maxsteps,$min,$max,$a) {
+	// Same as IntCalcTick but don't change min/max values
+	$diff=$max-$min; 
+	if( $diff==0 )
+	    JpGraphError::RaiseL(25075);//('Can\'t automatically determine ticks since min==max.');
+	else
+	    $ld=floor(log10($diff));
+		
+	if( $ld == 0 ) $ld=1;
+	
+	if( $a == 1 ) 
+	    $majstep = 1;
+	else
+	    $majstep=pow(10,$ld)/$a; 
+
+	$numsteps=floor($diff/$majstep); 
+	while( $numsteps > $maxsteps ) {
+	    $majstep=pow(10,$ld)/$a; 
+	    $numsteps=floor($diff/$majstep);
+	    ++$ld;
+	}
+					
+	return array($numsteps,$majstep);		
+    }
+
+
+	
+    // Determine the minimum of three values witha  weight for last value
+    function MatchMin3($a,$b,$c,$weight) {
+	if( $a < $b ) {
+	    if( $a < ($c*$weight) ) 
+		return 1; // $a smallest
+	    else 
+		return 3; // $c smallest
+	}
+	elseif( $b < ($c*$weight) ) 
+	    return 2; // $b smallest
+	return 3; // $c smallest
+    }
+} // Class
+
+//===================================================
+// CLASS RGB
+// Description: Color definitions as RGB triples
+//===================================================
+class RGB {
+    var $rgb_table;
+    var $img;
+    function RGB(&$aImg) {
+	$this->img = &$aImg;
+		
+	// Conversion array between color names and RGB
+	$this->rgb_table = array(
+	    "aqua"=> array(0,255,255),		
+	    "lime"=> array(0,255,0),		
+	    "teal"=> array(0,128,128),
+	    "whitesmoke"=>array(245,245,245),
+	    "gainsboro"=>array(220,220,220),
+	    "oldlace"=>array(253,245,230),
+	    "linen"=>array(250,240,230),
+	    "antiquewhite"=>array(250,235,215),
+	    "papayawhip"=>array(255,239,213),
+	    "blanchedalmond"=>array(255,235,205),
+	    "bisque"=>array(255,228,196),
+	    "peachpuff"=>array(255,218,185),
+	    "navajowhite"=>array(255,222,173),
+	    "moccasin"=>array(255,228,181),
+	    "cornsilk"=>array(255,248,220),
+	    "ivory"=>array(255,255,240),
+	    "lemonchiffon"=>array(255,250,205),
+	    "seashell"=>array(255,245,238),
+	    "mintcream"=>array(245,255,250),
+	    "azure"=>array(240,255,255),
+	    "aliceblue"=>array(240,248,255),
+	    "lavender"=>array(230,230,250),
+	    "lavenderblush"=>array(255,240,245),
+	    "mistyrose"=>array(255,228,225),
+	    "white"=>array(255,255,255),
+	    "black"=>array(0,0,0),
+	    "darkslategray"=>array(47,79,79),
+	    "dimgray"=>array(105,105,105),
+	    "slategray"=>array(112,128,144),
+	    "lightslategray"=>array(119,136,153),
+	    "gray"=>array(190,190,190),
+	    "lightgray"=>array(211,211,211),
+	    "midnightblue"=>array(25,25,112),
+	    "navy"=>array(0,0,128),
+	    "cornflowerblue"=>array(100,149,237),
+	    "darkslateblue"=>array(72,61,139),
+	    "slateblue"=>array(106,90,205),
+	    "mediumslateblue"=>array(123,104,238),
+	    "lightslateblue"=>array(132,112,255),
+	    "mediumblue"=>array(0,0,205),
+	    "royalblue"=>array(65,105,225),
+	    "blue"=>array(0,0,255),
+	    "dodgerblue"=>array(30,144,255),
+	    "deepskyblue"=>array(0,191,255),
+	    "skyblue"=>array(135,206,235),
+	    "lightskyblue"=>array(135,206,250),
+	    "steelblue"=>array(70,130,180),
+	    "lightred"=>array(211,167,168),
+	    "lightsteelblue"=>array(176,196,222),
+	    "lightblue"=>array(173,216,230),
+	    "powderblue"=>array(176,224,230),
+	    "paleturquoise"=>array(175,238,238),
+	    "darkturquoise"=>array(0,206,209),
+	    "mediumturquoise"=>array(72,209,204),
+	    "turquoise"=>array(64,224,208),
+	    "cyan"=>array(0,255,255),
+	    "lightcyan"=>array(224,255,255),
+	    "cadetblue"=>array(95,158,160),
+	    "mediumaquamarine"=>array(102,205,170),
+	    "aquamarine"=>array(127,255,212),
+	    "darkgreen"=>array(0,100,0),
+	    "darkolivegreen"=>array(85,107,47),
+	    "darkseagreen"=>array(143,188,143),
+	    "seagreen"=>array(46,139,87),
+	    "mediumseagreen"=>array(60,179,113),
+	    "lightseagreen"=>array(32,178,170),
+	    "palegreen"=>array(152,251,152),
+	    "springgreen"=>array(0,255,127),
+	    "lawngreen"=>array(124,252,0),
+	    "green"=>array(0,255,0),
+	    "chartreuse"=>array(127,255,0),
+	    "mediumspringgreen"=>array(0,250,154),
+	    "greenyellow"=>array(173,255,47),
+	    "limegreen"=>array(50,205,50),
+	    "yellowgreen"=>array(154,205,50),
+	    "forestgreen"=>array(34,139,34),
+	    "olivedrab"=>array(107,142,35),
+	    "darkkhaki"=>array(189,183,107),
+	    "khaki"=>array(240,230,140),
+	    "palegoldenrod"=>array(238,232,170),
+	    "lightgoldenrodyellow"=>array(250,250,210),
+	    "lightyellow"=>array(255,255,200),
+	    "yellow"=>array(255,255,0),
+	    "gold"=>array(255,215,0),
+	    "lightgoldenrod"=>array(238,221,130),
+	    "goldenrod"=>array(218,165,32),
+	    "darkgoldenrod"=>array(184,134,11),
+	    "rosybrown"=>array(188,143,143),
+	    "indianred"=>array(205,92,92),
+	    "saddlebrown"=>array(139,69,19),
+	    "sienna"=>array(160,82,45),
+	    "peru"=>array(205,133,63),
+	    "burlywood"=>array(222,184,135),
+	    "beige"=>array(245,245,220),
+	    "wheat"=>array(245,222,179),
+	    "sandybrown"=>array(244,164,96),
+	    "tan"=>array(210,180,140),
+	    "chocolate"=>array(210,105,30),
+	    "firebrick"=>array(178,34,34),
+	    "brown"=>array(165,42,42),
+	    "darksalmon"=>array(233,150,122),
+	    "salmon"=>array(250,128,114),
+	    "lightsalmon"=>array(255,160,122),
+	    "orange"=>array(255,165,0),
+	    "darkorange"=>array(255,140,0),
+	    "coral"=>array(255,127,80),
+	    "lightcoral"=>array(240,128,128),
+	    "tomato"=>array(255,99,71),
+	    "orangered"=>array(255,69,0),
+	    "red"=>array(255,0,0),
+	    "hotpink"=>array(255,105,180),
+	    "deeppink"=>array(255,20,147),
+	    "pink"=>array(255,192,203),
+	    "lightpink"=>array(255,182,193),
+	    "palevioletred"=>array(219,112,147),
+	    "maroon"=>array(176,48,96),
+	    "mediumvioletred"=>array(199,21,133),
+	    "violetred"=>array(208,32,144),
+	    "magenta"=>array(255,0,255),
+	    "violet"=>array(238,130,238),
+	    "plum"=>array(221,160,221),
+	    "orchid"=>array(218,112,214),
+	    "mediumorchid"=>array(186,85,211),
+	    "darkorchid"=>array(153,50,204),
+	    "darkviolet"=>array(148,0,211),
+	    "blueviolet"=>array(138,43,226),
+	    "purple"=>array(160,32,240),
+	    "mediumpurple"=>array(147,112,219),
+	    "thistle"=>array(216,191,216),
+	    "snow1"=>array(255,250,250),
+	    "snow2"=>array(238,233,233),
+	    "snow3"=>array(205,201,201),
+	    "snow4"=>array(139,137,137),
+	    "seashell1"=>array(255,245,238),
+	    "seashell2"=>array(238,229,222),
+	    "seashell3"=>array(205,197,191),
+	    "seashell4"=>array(139,134,130),
+	    "AntiqueWhite1"=>array(255,239,219),
+	    "AntiqueWhite2"=>array(238,223,204),
+	    "AntiqueWhite3"=>array(205,192,176),
+	    "AntiqueWhite4"=>array(139,131,120),
+	    "bisque1"=>array(255,228,196),
+	    "bisque2"=>array(238,213,183),
+	    "bisque3"=>array(205,183,158),
+	    "bisque4"=>array(139,125,107),
+	    "peachPuff1"=>array(255,218,185),
+	    "peachpuff2"=>array(238,203,173),
+	    "peachpuff3"=>array(205,175,149),
+	    "peachpuff4"=>array(139,119,101),
+	    "navajowhite1"=>array(255,222,173),
+	    "navajowhite2"=>array(238,207,161),
+	    "navajowhite3"=>array(205,179,139),
+	    "navajowhite4"=>array(139,121,94),
+	    "lemonchiffon1"=>array(255,250,205),
+	    "lemonchiffon2"=>array(238,233,191),
+	    "lemonchiffon3"=>array(205,201,165),
+	    "lemonchiffon4"=>array(139,137,112),
+	    "ivory1"=>array(255,255,240),
+	    "ivory2"=>array(238,238,224),
+	    "ivory3"=>array(205,205,193),
+	    "ivory4"=>array(139,139,131),
+	    "honeydew"=>array(193,205,193),
+	    "lavenderblush1"=>array(255,240,245),
+	    "lavenderblush2"=>array(238,224,229),
+	    "lavenderblush3"=>array(205,193,197),
+	    "lavenderblush4"=>array(139,131,134),
+	    "mistyrose1"=>array(255,228,225),
+	    "mistyrose2"=>array(238,213,210),
+	    "mistyrose3"=>array(205,183,181),
+	    "mistyrose4"=>array(139,125,123),
+	    "azure1"=>array(240,255,255),
+	    "azure2"=>array(224,238,238),
+	    "azure3"=>array(193,205,205),
+	    "azure4"=>array(131,139,139),
+	    "slateblue1"=>array(131,111,255),
+	    "slateblue2"=>array(122,103,238),
+	    "slateblue3"=>array(105,89,205),
+	    "slateblue4"=>array(71,60,139),
+	    "royalblue1"=>array(72,118,255),
+	    "royalblue2"=>array(67,110,238),
+	    "royalblue3"=>array(58,95,205),
+	    "royalblue4"=>array(39,64,139),
+	    "dodgerblue1"=>array(30,144,255),
+	    "dodgerblue2"=>array(28,134,238),
+	    "dodgerblue3"=>array(24,116,205),
+	    "dodgerblue4"=>array(16,78,139),
+	    "steelblue1"=>array(99,184,255),
+	    "steelblue2"=>array(92,172,238),
+	    "steelblue3"=>array(79,148,205),
+	    "steelblue4"=>array(54,100,139),
+	    "deepskyblue1"=>array(0,191,255),
+	    "deepskyblue2"=>array(0,178,238),
+	    "deepskyblue3"=>array(0,154,205),
+	    "deepskyblue4"=>array(0,104,139),
+	    "skyblue1"=>array(135,206,255),
+	    "skyblue2"=>array(126,192,238),
+	    "skyblue3"=>array(108,166,205),
+	    "skyblue4"=>array(74,112,139),
+	    "lightskyblue1"=>array(176,226,255),
+	    "lightskyblue2"=>array(164,211,238),
+	    "lightskyblue3"=>array(141,182,205),
+	    "lightskyblue4"=>array(96,123,139),
+	    "slategray1"=>array(198,226,255),
+	    "slategray2"=>array(185,211,238),
+	    "slategray3"=>array(159,182,205),
+	    "slategray4"=>array(108,123,139),
+	    "lightsteelblue1"=>array(202,225,255),
+	    "lightsteelblue2"=>array(188,210,238),
+	    "lightsteelblue3"=>array(162,181,205),
+	    "lightsteelblue4"=>array(110,123,139),
+	    "lightblue1"=>array(191,239,255),
+	    "lightblue2"=>array(178,223,238),
+	    "lightblue3"=>array(154,192,205),
+	    "lightblue4"=>array(104,131,139),
+	    "lightcyan1"=>array(224,255,255),
+	    "lightcyan2"=>array(209,238,238),
+	    "lightcyan3"=>array(180,205,205),
+	    "lightcyan4"=>array(122,139,139),
+	    "paleturquoise1"=>array(187,255,255),
+	    "paleturquoise2"=>array(174,238,238),
+	    "paleturquoise3"=>array(150,205,205),
+	    "paleturquoise4"=>array(102,139,139),
+	    "cadetblue1"=>array(152,245,255),
+	    "cadetblue2"=>array(142,229,238),
+	    "cadetblue3"=>array(122,197,205),
+	    "cadetblue4"=>array(83,134,139),
+	    "turquoise1"=>array(0,245,255),
+	    "turquoise2"=>array(0,229,238),
+	    "turquoise3"=>array(0,197,205),
+	    "turquoise4"=>array(0,134,139),
+	    "cyan1"=>array(0,255,255),
+	    "cyan2"=>array(0,238,238),
+	    "cyan3"=>array(0,205,205),
+	    "cyan4"=>array(0,139,139),
+	    "darkslategray1"=>array(151,255,255),
+	    "darkslategray2"=>array(141,238,238),
+	    "darkslategray3"=>array(121,205,205),
+	    "darkslategray4"=>array(82,139,139),
+	    "aquamarine1"=>array(127,255,212),
+	    "aquamarine2"=>array(118,238,198),
+	    "aquamarine3"=>array(102,205,170),
+	    "aquamarine4"=>array(69,139,116),
+	    "darkseagreen1"=>array(193,255,193),
+	    "darkseagreen2"=>array(180,238,180),
+	    "darkseagreen3"=>array(155,205,155),
+	    "darkseagreen4"=>array(105,139,105),
+	    "seagreen1"=>array(84,255,159),
+	    "seagreen2"=>array(78,238,148),
+	    "seagreen3"=>array(67,205,128),
+	    "seagreen4"=>array(46,139,87),
+	    "palegreen1"=>array(154,255,154),
+	    "palegreen2"=>array(144,238,144),
+	    "palegreen3"=>array(124,205,124),
+	    "palegreen4"=>array(84,139,84),
+	    "springgreen1"=>array(0,255,127),
+	    "springgreen2"=>array(0,238,118),
+	    "springgreen3"=>array(0,205,102),
+	    "springgreen4"=>array(0,139,69),
+	    "chartreuse1"=>array(127,255,0),
+	    "chartreuse2"=>array(118,238,0),
+	    "chartreuse3"=>array(102,205,0),
+	    "chartreuse4"=>array(69,139,0),
+	    "olivedrab1"=>array(192,255,62),
+	    "olivedrab2"=>array(179,238,58),
+	    "olivedrab3"=>array(154,205,50),
+	    "olivedrab4"=>array(105,139,34),
+	    "darkolivegreen1"=>array(202,255,112),
+	    "darkolivegreen2"=>array(188,238,104),
+	    "darkolivegreen3"=>array(162,205,90),
+	    "darkolivegreen4"=>array(110,139,61),
+	    "khaki1"=>array(255,246,143),
+	    "khaki2"=>array(238,230,133),
+	    "khaki3"=>array(205,198,115),
+	    "khaki4"=>array(139,134,78),
+	    "lightgoldenrod1"=>array(255,236,139),
+	    "lightgoldenrod2"=>array(238,220,130),
+	    "lightgoldenrod3"=>array(205,190,112),
+	    "lightgoldenrod4"=>array(139,129,76),
+	    "yellow1"=>array(255,255,0),
+	    "yellow2"=>array(238,238,0),
+	    "yellow3"=>array(205,205,0),
+	    "yellow4"=>array(139,139,0),
+	    "gold1"=>array(255,215,0),
+	    "gold2"=>array(238,201,0),
+	    "gold3"=>array(205,173,0),
+	    "gold4"=>array(139,117,0),
+	    "goldenrod1"=>array(255,193,37),
+	    "goldenrod2"=>array(238,180,34),
+	    "goldenrod3"=>array(205,155,29),
+	    "goldenrod4"=>array(139,105,20),
+	    "darkgoldenrod1"=>array(255,185,15),
+	    "darkgoldenrod2"=>array(238,173,14),
+	    "darkgoldenrod3"=>array(205,149,12),
+	    "darkgoldenrod4"=>array(139,101,8),
+	    "rosybrown1"=>array(255,193,193),
+	    "rosybrown2"=>array(238,180,180),
+	    "rosybrown3"=>array(205,155,155),
+	    "rosybrown4"=>array(139,105,105),
+	    "indianred1"=>array(255,106,106),
+	    "indianred2"=>array(238,99,99),
+	    "indianred3"=>array(205,85,85),
+	    "indianred4"=>array(139,58,58),
+	    "sienna1"=>array(255,130,71),
+	    "sienna2"=>array(238,121,66),
+	    "sienna3"=>array(205,104,57),
+	    "sienna4"=>array(139,71,38),
+	    "burlywood1"=>array(255,211,155),
+	    "burlywood2"=>array(238,197,145),
+	    "burlywood3"=>array(205,170,125),
+	    "burlywood4"=>array(139,115,85),
+	    "wheat1"=>array(255,231,186),
+	    "wheat2"=>array(238,216,174),
+	    "wheat3"=>array(205,186,150),
+	    "wheat4"=>array(139,126,102),
+	    "tan1"=>array(255,165,79),
+	    "tan2"=>array(238,154,73),
+	    "tan3"=>array(205,133,63),
+	    "tan4"=>array(139,90,43),
+	    "chocolate1"=>array(255,127,36),
+	    "chocolate2"=>array(238,118,33),
+	    "chocolate3"=>array(205,102,29),
+	    "chocolate4"=>array(139,69,19),
+	    "firebrick1"=>array(255,48,48),
+	    "firebrick2"=>array(238,44,44),
+	    "firebrick3"=>array(205,38,38),
+	    "firebrick4"=>array(139,26,26),
+	    "brown1"=>array(255,64,64),
+	    "brown2"=>array(238,59,59),
+	    "brown3"=>array(205,51,51),
+	    "brown4"=>array(139,35,35),
+	    "salmon1"=>array(255,140,105),
+	    "salmon2"=>array(238,130,98),
+	    "salmon3"=>array(205,112,84),
+	    "salmon4"=>array(139,76,57),
+	    "lightsalmon1"=>array(255,160,122),
+	    "lightsalmon2"=>array(238,149,114),
+	    "lightsalmon3"=>array(205,129,98),
+	    "lightsalmon4"=>array(139,87,66),
+	    "orange1"=>array(255,165,0),
+	    "orange2"=>array(238,154,0),
+	    "orange3"=>array(205,133,0),
+	    "orange4"=>array(139,90,0),
+	    "darkorange1"=>array(255,127,0),
+	    "darkorange2"=>array(238,118,0),
+	    "darkorange3"=>array(205,102,0),
+	    "darkorange4"=>array(139,69,0),
+	    "coral1"=>array(255,114,86),
+	    "coral2"=>array(238,106,80),
+	    "coral3"=>array(205,91,69),
+	    "coral4"=>array(139,62,47),
+	    "tomato1"=>array(255,99,71),
+	    "tomato2"=>array(238,92,66),
+	    "tomato3"=>array(205,79,57),
+	    "tomato4"=>array(139,54,38),
+	    "orangered1"=>array(255,69,0),
+	    "orangered2"=>array(238,64,0),
+	    "orangered3"=>array(205,55,0),
+	    "orangered4"=>array(139,37,0),
+	    "deeppink1"=>array(255,20,147),
+	    "deeppink2"=>array(238,18,137),
+	    "deeppink3"=>array(205,16,118),
+	    "deeppink4"=>array(139,10,80),
+	    "hotpink1"=>array(255,110,180),
+	    "hotpink2"=>array(238,106,167),
+	    "hotpink3"=>array(205,96,144),
+	    "hotpink4"=>array(139,58,98),
+	    "pink1"=>array(255,181,197),
+	    "pink2"=>array(238,169,184),
+	    "pink3"=>array(205,145,158),
+	    "pink4"=>array(139,99,108),
+	    "lightpink1"=>array(255,174,185),
+	    "lightpink2"=>array(238,162,173),
+	    "lightpink3"=>array(205,140,149),
+	    "lightpink4"=>array(139,95,101),
+	    "palevioletred1"=>array(255,130,171),
+	    "palevioletred2"=>array(238,121,159),
+	    "palevioletred3"=>array(205,104,137),
+	    "palevioletred4"=>array(139,71,93),
+	    "maroon1"=>array(255,52,179),
+	    "maroon2"=>array(238,48,167),
+	    "maroon3"=>array(205,41,144),
+	    "maroon4"=>array(139,28,98),
+	    "violetred1"=>array(255,62,150),
+	    "violetred2"=>array(238,58,140),
+	    "violetred3"=>array(205,50,120),
+	    "violetred4"=>array(139,34,82),
+	    "magenta1"=>array(255,0,255),
+	    "magenta2"=>array(238,0,238),
+	    "magenta3"=>array(205,0,205),
+	    "magenta4"=>array(139,0,139),
+	    "mediumred"=>array(140,34,34),         
+	    "orchid1"=>array(255,131,250),
+	    "orchid2"=>array(238,122,233),
+	    "orchid3"=>array(205,105,201),
+	    "orchid4"=>array(139,71,137),
+	    "plum1"=>array(255,187,255),
+	    "plum2"=>array(238,174,238),
+	    "plum3"=>array(205,150,205),
+	    "plum4"=>array(139,102,139),
+	    "mediumorchid1"=>array(224,102,255),
+	    "mediumorchid2"=>array(209,95,238),
+	    "mediumorchid3"=>array(180,82,205),
+	    "mediumorchid4"=>array(122,55,139),
+	    "darkorchid1"=>array(191,62,255),
+	    "darkorchid2"=>array(178,58,238),
+	    "darkorchid3"=>array(154,50,205),
+	    "darkorchid4"=>array(104,34,139),
+	    "purple1"=>array(155,48,255),
+	    "purple2"=>array(145,44,238),
+	    "purple3"=>array(125,38,205),
+	    "purple4"=>array(85,26,139),
+	    "mediumpurple1"=>array(171,130,255),
+	    "mediumpurple2"=>array(159,121,238),
+	    "mediumpurple3"=>array(137,104,205),
+	    "mediumpurple4"=>array(93,71,139),
+	    "thistle1"=>array(255,225,255),
+	    "thistle2"=>array(238,210,238),
+	    "thistle3"=>array(205,181,205),
+	    "thistle4"=>array(139,123,139),
+	    "gray1"=>array(10,10,10),
+	    "gray2"=>array(40,40,30),
+	    "gray3"=>array(70,70,70),
+	    "gray4"=>array(100,100,100),
+	    "gray5"=>array(130,130,130),
+	    "gray6"=>array(160,160,160),
+	    "gray7"=>array(190,190,190),
+	    "gray8"=>array(210,210,210),
+	    "gray9"=>array(240,240,240),
+	    "darkgray"=>array(100,100,100),
+	    "darkblue"=>array(0,0,139),
+	    "darkcyan"=>array(0,139,139),
+	    "darkmagenta"=>array(139,0,139),
+	    "darkred"=>array(139,0,0),
+	    "silver"=>array(192, 192, 192),
+	    "eggplant"=>array(144,176,168),
+	    "lightgreen"=>array(144,238,144));		
+    }
+//----------------
+// PUBLIC METHODS
+    // Colors can be specified as either
+    // 1. #xxxxxx			HTML style
+    // 2. "colorname" 	as a named color
+    // 3. array(r,g,b)	RGB triple
+    // This function translates this to a native RGB format and returns an 
+    // RGB triple.
+    function Color($aColor) {
+	if (is_string($aColor)) {
+	    // Strip of any alpha factor
+	    $pos = strpos($aColor,'@');
+	    if( $pos === false ) {
+		$alpha = 0;
+	    }
+	    else {
+		$pos2 = strpos($aColor,':');
+		if( $pos2===false ) 
+		    $pos2 = $pos-1; // Sentinel
+		if( $pos > $pos2 ) {
+		    $alpha = substr($aColor,$pos+1);
+		    $aColor = substr($aColor,0,$pos);
+		}
+		else {
+		    $alpha = substr($aColor,$pos+1,$pos2-$pos-1);
+		    $aColor = substr($aColor,0,$pos).substr($aColor,$pos2);
+		}
+	    }
+
+	    // Extract potential adjustment figure at end of color
+	    // specification
+	    $pos = strpos($aColor,":");
+	    if( $pos === false ) {
+		$adj = 1.0;
+	    }
+	    else {
+		$adj = 0.0 + substr($aColor,$pos+1);
+		$aColor = substr($aColor,0,$pos);
+	    }
+	    if( $adj < 0 )
+		JpGraphError::RaiseL(25077);//('Adjustment factor for color must be > 0');
+
+	    if (substr($aColor, 0, 1) == "#") {
+		$r = hexdec(substr($aColor, 1, 2));
+		$g = hexdec(substr($aColor, 3, 2));
+		$b = hexdec(substr($aColor, 5, 2));
+	    } else {
+      		if(!isset($this->rgb_table[$aColor]) )
+		    JpGraphError::RaiseL(25078,$aColor);//(" Unknown color: $aColor");
+		$tmp=$this->rgb_table[$aColor];
+		$r = $tmp[0];
+		$g = $tmp[1];
+		$b = $tmp[2];
+	    }
+	    // Scale adj so that an adj=2 always
+	    // makes the color 100% white (i.e. 255,255,255. 
+	    // and adj=1 neutral and adj=0 black.
+	    if( $adj > 1 ) {
+		$m = ($adj-1.0)*(255-min(255,min($r,min($g,$b))));
+		return array(min(255,$r+$m), min(255,$g+$m), min(255,$b+$m),$alpha);
+	    }
+	    elseif( $adj < 1 ) {
+		$m = ($adj-1.0)*max(255,max($r,max($g,$b)));
+		return array(max(0,$r+$m), max(0,$g+$m), max(0,$b+$m),$alpha);
+	    }
+	    else {
+		return array($r,$g,$b,$alpha);
+	    }
+
+	} elseif( is_array($aColor) ) {
+	    if( count($aColor)==3 ) {
+		$aColor[3]=0;
+		return $aColor;
+	    }
+	    else
+		return $aColor;
+	}
+	else
+	    JpGraphError::RaiseL(25079,$aColor,count($aColor));//(" Unknown color specification: $aColor , size=".count($aColor));
+    }
+	
+    // Compare two colors
+    // return true if equal
+    function Equal($aCol1,$aCol2) {
+	$c1 = $this->Color($aCol1);
+	$c2 = $this->Color($aCol2);
+	if( $c1[0]==$c2[0] && $c1[1]==$c2[1] && $c1[2]==$c2[2] )
+	    return true;
+	else
+	    return false;
+    }
+	
+    // Allocate a new color in the current image
+    // Return new color index, -1 if no more colors could be allocated
+    function Allocate($aColor,$aAlpha=0.0) {
+	list ($r, $g, $b, $a) = $this->color($aColor);
+	// If alpha is specified in the color string then this
+	// takes precedence over the second argument
+	if( $a > 0 )
+	    $aAlpha = $a;
+	if( $GLOBALS['gd2'] ) {
+	    if( $aAlpha < 0 || $aAlpha > 1 ) {
+		JpGraphError::RaiseL(25080);//('Alpha parameter for color must be between 0.0 and 1.0');
+	    }
+	    return imagecolorresolvealpha($this->img, $r, $g, $b, round($aAlpha * 127));
+	} else {
+	    $index = imagecolorexact($this->img, $r, $g, $b);
+	    if ($index == -1) {
+      		$index = imagecolorallocate($this->img, $r, $g, $b);
+      		if( USE_APPROX_COLORS && $index == -1 )
+		    $index = imagecolorresolve($this->img, $r, $g, $b);
+	    } 
+	    return $index;
+	}
+    }
+} // Class
+
+	
+//===================================================
+// CLASS Image
+// Description: Wrapper class with some goodies to form the
+// Interface to low level image drawing routines.
+//===================================================
+class Image {
+    var $img_format;
+    var $expired=true;
+    var $img=null;
+    var $left_margin=30,$right_margin=20,$top_margin=20,$bottom_margin=30;
+    var $plotwidth=0,$plotheight=0;
+    var $rgb=null;
+    var $current_color,$current_color_name;
+    var $lastx=0, $lasty=0;
+    var $width=0, $height=0;
+    var $line_weight=1;
+    var $line_style=1;	// Default line style is solid
+    var $obs_list=array();
+    var $font_size=12,$font_family=FF_FONT1, $font_style=FS_NORMAL;
+    var $font_file='';
+    var $text_halign="left",$text_valign="bottom";
+    var $ttf=null;
+    var $use_anti_aliasing=false;
+    var $quality=null;
+    var $colorstack=array(),$colorstackidx=0;
+    var $canvascolor = 'white' ;
+    var $langconv = null ;
+
+    //---------------
+    // CONSTRUCTOR
+    function Image($aWidth,$aHeight,$aFormat=DEFAULT_GFORMAT) {
+	$this->CreateImgCanvas($aWidth,$aHeight);
+	$this->SetAutoMargin();		
+
+	if( !$this->SetImgFormat($aFormat) ) {
+	    JpGraphError::RaiseL(25081,$aFormat);//("JpGraph: Selected graphic format is either not supported or unknown [$aFormat]");
+	}
+	$this->ttf = new TTF();
+	$this->langconv = new LanguageConv();
+    }
+
+    // Should we use anti-aliasing. Note: This really slows down graphics!
+    function SetAntiAliasing() {
+	$this->use_anti_aliasing=true;
+    }
+
+    function CreateRawCanvas($aWidth=0,$aHeight=0) {
+	if( $aWidth <= 1 || $aHeight <= 1 ) {
+	    JpGraphError::RaiseL(25082,$aWidth,$aHeight);//("Illegal sizes specified for width or height when creating an image, (width=$aWidth, height=$aHeight)");
+	}
+	if( @$GLOBALS['gd2']==true && USE_TRUECOLOR ) {
+	    $this->img = @imagecreatetruecolor($aWidth, $aHeight);
+	    if( $this->img < 1 ) {
+		JpGraphError::RaiseL(25126);
+		//die("Can't create truecolor image. Check that you really have GD2 library installed.");
+	    }
+	    $this->SetAlphaBlending();
+	} else {
+	    $this->img = @imagecreate($aWidth, $aHeight);	
+	    if( $this->img < 1 ) {
+		JpGraphError::RaiseL(25126);
+		//die("<b>JpGraph Error:</b> Can't create image. Check that you really have the GD library installed.");
+	    }
+	}
+	if( $this->rgb != null ) 
+	    $this->rgb->img = $this->img ;
+	else
+	    $this->rgb = new RGB($this->img);				
+    }
+
+    function CloneCanvasH() {
+	$oldimage = $this->img;
+	$this->CreateRawCanvas($this->width,$this->height);
+	imagecopy($this->img,$oldimage,0,0,0,0,$this->width,$this->height);
+	return $oldimage;
+    }
+    
+    function CreateImgCanvas($aWidth=0,$aHeight=0) {
+
+	$old = array($this->img,$this->width,$this->height);
+	
+	$aWidth = round($aWidth);
+	$aHeight = round($aHeight);
+
+	$this->width=$aWidth;
+	$this->height=$aHeight;		
+
+	
+	if( $aWidth==0 || $aHeight==0 ) {
+	    // We will set the final size later. 
+	    // Note: The size must be specified before any other
+	    // img routines that stroke anything are called.
+	    $this->img = null;
+	    $this->rgb = null;
+	    return $old;
+	}
+	
+	$this->CreateRawCanvas($aWidth,$aHeight);
+		
+	// Set canvas color (will also be the background color for a 
+	// a pallett image
+	$this->SetColor($this->canvascolor);	
+	$this->FilledRectangle(0,0,$aWidth,$aHeight);
+
+	return $old ;
+    }
+
+    function CopyCanvasH($aToHdl,$aFromHdl,$aToX,$aToY,$aFromX,$aFromY,$aWidth,$aHeight,$aw=-1,$ah=-1) {
+	if( $aw === -1 ) {
+	    $aw = $aWidth;
+	    $ah = $aHeight;
+	    $f = 'imagecopyresized';
+	}
+	else {
+	    $f = $GLOBALS['copyfunc'] ;
+	}
+	$f($aToHdl,$aFromHdl,
+	   $aToX,$aToY,$aFromX,$aFromY, $aWidth,$aHeight,$aw,$ah);
+    }
+
+    function Copy($fromImg,$toX,$toY,$fromX,$fromY,$toWidth,$toHeight,$fromWidth=-1,$fromHeight=-1) {
+	$this->CopyCanvasH($this->img,$fromImg,$toX,$toY,$fromX,$fromY,
+			   $toWidth,$toHeight,$fromWidth,$fromHeight);
+    }
+
+    function CopyMerge($fromImg,$toX,$toY,$fromX,$fromY,$toWidth,$toHeight,$fromWidth=-1,$fromHeight=-1,$aMix=100) {
+	if( $aMix == 100 ) {
+	    $this->CopyCanvasH($this->img,$fromImg,
+			       $toX,$toY,$fromX,$fromY,$toWidth,$toHeight,$fromWidth,$fromHeight);
+	}
+	else {
+	    if( ($fromWidth  != -1 && ($fromWidth != $toWidth))  ||
+		($fromHeight != -1 && ($fromHeight != $fromHeight)) ) {
+		// Create a new canvas that will hold the re-scaled original from image
+		if( $toWidth <= 1 || $toHeight <= 1 ) {
+		    JpGraphError::RaiseL(25083);//('Illegal image size when copying image. Size for copied to image is 1 pixel or less.');
+		}
+		if( @$GLOBALS['gd2']==true && USE_TRUECOLOR ) {
+		    $tmpimg = @imagecreatetruecolor($toWidth, $toHeight);
+		} else {
+		    $tmpimg = @imagecreate($toWidth, $toHeight);	
+		}	    
+		if( $tmpimg < 1 ) {
+		    JpGraphError::RaiseL(25084);//('Failed to create temporary GD canvas. Out of memory ?');
+		}
+		$this->CopyCanvasH($tmpimg,$fromImg,0,0,0,0,
+				   $toWidth,$toHeight,$fromWidth,$fromHeight);
+		$fromImg = $tmpimg;
+	    }
+	    imagecopymerge($this->img,$fromImg,$toX,$toY,$fromX,$fromY,$toWidth,$toHeight,$aMix);
+	}
+    }
+
+    function GetWidth($aImg=null) {
+	if( $aImg === null ) 
+	    $aImg = $this->img;
+	return imagesx($aImg);
+    }
+
+    function GetHeight($aImg=null) {
+	if( $aImg === null ) 
+	    $aImg = $this->img;
+	return imagesy($aImg);
+    }
+    
+    function CreateFromString($aStr) {
+	$img = imagecreatefromstring($aStr);
+	if( $img === false ) {
+	    JpGraphError::RaiseL(25085);//('An image can not be created from the supplied string. It is either in a format not supported or the string is representing an corrupt image.');
+	}
+	return $img;
+    }
+
+    function SetCanvasH($aHdl) {
+	$this->img = $aHdl;
+	$this->rgb->img = $aHdl;
+    }
+
+    function SetCanvasColor($aColor) {
+	$this->canvascolor = $aColor ;
+    }
+
+    function SetAlphaBlending($aFlg=true) {
+	if( $GLOBALS['gd2'] )
+	    ImageAlphaBlending($this->img,$aFlg);
+	else 
+	    JpGraphError::RaiseL(25086);//('You only seem to have GD 1.x installed. To enable Alphablending requires GD 2.x or higher. Please install GD or make sure the constant USE_GD2 is specified correctly to reflect your installation. By default it tries to autodetect what version of GD you have installed. On some very rare occasions it may falsely detect GD2 where only GD1 is installed. You must then set USE_GD2 to false.');
+    }
+
+	
+    function SetAutoMargin() {	
+	GLOBAL $gJpgBrandTiming;
+	$min_bm=10;
+	/*
+	if( $gJpgBrandTiming )
+	    $min_bm=15;		
+	*/
+	$lm = min(40,$this->width/7);
+	$rm = min(20,$this->width/10);
+	$tm = max(20,$this->height/7);
+	$bm = max($min_bm,$this->height/7);
+	$this->SetMargin($lm,$rm,$tm,$bm);		
+    }
+
+				
+    //---------------
+    // PUBLIC METHODS	
+	
+    function SetFont($family,$style=FS_NORMAL,$size=10) {
+	$this->font_family=$family;
+	$this->font_style=$style;
+	$this->font_size=$size;
+	$this->font_file='';
+	if( ($this->font_family==FF_FONT1 || $this->font_family==FF_FONT2) && $this->font_style==FS_BOLD ){
+	    ++$this->font_family;
+	}
+	if( $this->font_family > FF_FONT2+1 ) { // A TTF font so get the font file
+
+	    // Check that this PHP has support for TTF fonts
+	    if( !function_exists('imagettfbbox') ) {
+		JpGraphError::RaiseL(25087);//('This PHP build has not been configured with TTF support. You need to recompile your PHP installation with FreeType support.');
+		exit();
+	    }
+	    $this->font_file = $this->ttf->File($this->font_family,$this->font_style);
+	}
+    }
+
+    // Get the specific height for a text string
+    function GetTextHeight($txt="",$angle=0) {
+	$tmp = split("\n",$txt);
+	$n = count($tmp);
+	$m=0;
+	for($i=0; $i< $n; ++$i)
+	    $m = max($m,strlen($tmp[$i]));
+
+	if( $this->font_family <= FF_FONT2+1 ) {
+	    if( $angle==0 ) {
+		$h = imagefontheight($this->font_family);
+		if( $h === false ) {
+		    JpGraphError::RaiseL(25088);//('You have a misconfigured GD font support. The call to imagefontwidth() fails.');
+		}
+
+		return $n*$h;
+	    }
+	    else {
+		$w = @imagefontwidth($this->font_family);
+		if( $w === false ) {
+		    JpGraphError::RaiseL(25088);//('You have a misconfigured GD font support. The call to imagefontwidth() fails.');
+		}
+
+		return $m*$w;
+	    }
+	}
+	else {
+	    $bbox = $this->GetTTFBBox($txt,$angle);
+	    return $bbox[1]-$bbox[5];
+	}
+    }
+	
+    // Estimate font height
+    function GetFontHeight($angle=0) {
+	$txt = "XOMg";
+	return $this->GetTextHeight($txt,$angle);
+    }
+	
+    // Approximate font width with width of letter "O"
+    function GetFontWidth($angle=0) {
+	$txt = 'O';
+	return $this->GetTextWidth($txt,$angle);
+    }
+	
+    // Get actual width of text in absolute pixels
+    function GetTextWidth($txt,$angle=0) {
+
+	$tmp = split("\n",$txt);
+	$n = count($tmp);
+	if( $this->font_family <= FF_FONT2+1 ) {
+
+	    $m=0;
+	    for($i=0; $i < $n; ++$i) {
+		$l=strlen($tmp[$i]);
+		if( $l > $m ) {
+		    $m = $l;
+		}
+	    }
+
+	    if( $angle==0 ) {
+		$w = @imagefontwidth($this->font_family);
+		if( $w === false ) {
+		    JpGraphError::RaiseL(25088);//('You have a misconfigured GD font support. The call to imagefontwidth() fails.');
+		}
+		return $m*$w;
+	    }
+	    else {
+		// 90 degrees internal so height becomes width
+		$h = @imagefontheight($this->font_family); 
+		if( $h === false ) {
+		    JpGraphError::RaiseL(25089);//('You have a misconfigured GD font support. The call to imagefontheight() fails.');
+		}
+		return $n*$h;
+	    }
+	}
+	else {
+	    // For TTF fonts we must walk through a lines and find the 
+	    // widest one which we use as the width of the multi-line
+	    // paragraph
+	    $m=0;
+	    for( $i=0; $i < $n; ++$i ) {
+		$bbox = $this->GetTTFBBox($tmp[$i],$angle);
+		$mm =  $bbox[2] - $bbox[0];
+		if( $mm > $m ) 
+		    $m = $mm;
+	    }
+	    return $m;
+	}
+    }
+	
+    // Draw text with a box around it
+    function StrokeBoxedText($x,$y,$txt,$dir=0,$fcolor="white",$bcolor="black",
+			     $shadowcolor=false,$paragraph_align="left",
+			     $xmarg=6,$ymarg=4,$cornerradius=0,$dropwidth=3) {
+
+	if( !is_numeric($dir) ) {
+	    if( $dir=="h" ) $dir=0;
+	    elseif( $dir=="v" ) $dir=90;
+	    else JpGraphError::RaiseL(25090,$dir);//(" Unknown direction specified in call to StrokeBoxedText() [$dir]");
+	}
+		
+	if( $this->font_family >= FF_FONT0 && $this->font_family <= FF_FONT2+1) {	
+	    $width=$this->GetTextWidth($txt,$dir) ;
+	    $height=$this->GetTextHeight($txt,$dir) ;
+	}
+	else {
+	    $width=$this->GetBBoxWidth($txt,$dir) ;
+	    $height=$this->GetBBoxHeight($txt,$dir) ;
+	}
+
+	$height += 2*$ymarg;
+	$width  += 2*$xmarg;
+
+	if( $this->text_halign=="right" ) $x -= $width;
+	elseif( $this->text_halign=="center" ) $x -= $width/2;
+	if( $this->text_valign=="bottom" ) $y -= $height;
+	elseif( $this->text_valign=="center" ) $y -= $height/2;
+	
+	if( $shadowcolor ) {
+	    $this->PushColor($shadowcolor);
+	    $this->FilledRoundedRectangle($x-$xmarg+$dropwidth,$y-$ymarg+$dropwidth,
+					  $x+$width+$dropwidth,$y+$height-$ymarg+$dropwidth,
+					  $cornerradius);
+	    $this->PopColor();
+	    $this->PushColor($fcolor);
+	    $this->FilledRoundedRectangle($x-$xmarg,$y-$ymarg,
+					  $x+$width,$y+$height-$ymarg,
+					  $cornerradius);		
+	    $this->PopColor();
+	    $this->PushColor($bcolor);
+	    $this->RoundedRectangle($x-$xmarg,$y-$ymarg,
+				    $x+$width,$y+$height-$ymarg,$cornerradius);
+	    $this->PopColor();
+	}
+	else {
+	    if( $fcolor ) {
+		$oc=$this->current_color;
+		$this->SetColor($fcolor);
+		$this->FilledRoundedRectangle($x-$xmarg,$y-$ymarg,$x+$width,$y+$height-$ymarg,$cornerradius);
+		$this->current_color=$oc;
+	    }
+	    if( $bcolor ) {
+		$oc=$this->current_color;
+		$this->SetColor($bcolor);			
+		$this->RoundedRectangle($x-$xmarg,$y-$ymarg,$x+$width,$y+$height-$ymarg,$cornerradius);
+		$this->current_color=$oc;			
+	    }
+	}
+		
+	$h=$this->text_halign;
+	$v=$this->text_valign;
+	$this->SetTextAlign("left","top");
+	$this->StrokeText($x, $y, $txt, $dir, $paragraph_align);
+	$bb = array($x-$xmarg,$y+$height-$ymarg,$x+$width,$y+$height-$ymarg,
+		    $x+$width,$y-$ymarg,$x-$xmarg,$y-$ymarg);
+	$this->SetTextAlign($h,$v);
+	return $bb;
+    }
+
+    // Set text alignment	
+    function SetTextAlign($halign,$valign="bottom") {
+	$this->text_halign=$halign;
+	$this->text_valign=$valign;
+    }
+	
+
+    function _StrokeBuiltinFont($x,$y,$txt,$dir=0,$paragraph_align="left",&$aBoundingBox,$aDebug=false) {
+
+	if( is_numeric($dir) && $dir!=90 && $dir!=0) 
+	    JpGraphError::RaiseL(25091);//(" Internal font does not support drawing text at arbitrary angle. Use TTF fonts instead.");
+
+	$h=$this->GetTextHeight($txt);
+	$fh=$this->GetFontHeight();
+	$w=$this->GetTextWidth($txt);
+	
+	if( $this->text_halign=="right") 				
+	    $x -= $dir==0 ? $w : $h;
+	elseif( $this->text_halign=="center" ) {
+	    // For center we subtract 1 pixel since this makes the middle
+	    // be prefectly in the middle
+	    $x -= $dir==0 ? $w/2-1 : $h/2;
+	}
+	if( $this->text_valign=="top" )
+	    $y += $dir==0 ? $h : $w;
+	elseif( $this->text_valign=="center" ) 				
+	    $y += $dir==0 ? $h/2 : $w/2;
+	
+	if( $dir==90 ) {
+	    imagestringup($this->img,$this->font_family,$x,$y,$txt,$this->current_color);
+	    $aBoundingBox = array(round($x),round($y),round($x),round($y-$w),round($x+$h),round($y-$w),round($x+$h),round($y));
+            if( $aDebug ) {
+		// Draw bounding box
+		$this->PushColor('green');
+		$this->Polygon($aBoundingBox,true);
+		$this->PopColor();
+	    }
+	}
+	else {
+	    if( ereg("\n",$txt) ) { 
+		$tmp = split("\n",$txt);
+		for($i=0; $i < count($tmp); ++$i) {
+		    $w1 = $this->GetTextWidth($tmp[$i]);
+		    if( $paragraph_align=="left" ) {
+			imagestring($this->img,$this->font_family,$x,$y-$h+1+$i*$fh,$tmp[$i],$this->current_color);
+		    }
+		    elseif( $paragraph_align=="right" ) {
+			imagestring($this->img,$this->font_family,$x+($w-$w1),
+				    $y-$h+1+$i*$fh,$tmp[$i],$this->current_color);
+		    }
+		    else {
+			imagestring($this->img,$this->font_family,$x+$w/2-$w1/2,
+				    $y-$h+1+$i*$fh,$tmp[$i],$this->current_color);
+		    }
+		}
+	    } 
+	    else {
+		//Put the text
+		imagestring($this->img,$this->font_family,$x,$y-$h+1,$txt,$this->current_color);
+	    }
+            if( $aDebug ) {
+		// Draw the bounding rectangle and the bounding box
+		$p1 = array(round($x),round($y),round($x),round($y-$h),round($x+$w),round($y-$h),round($x+$w),round($y));
+		
+		// Draw bounding box
+		$this->PushColor('green');
+		$this->Polygon($p1,true);
+		$this->PopColor();
+
+            }
+	    $aBoundingBox=array(round($x),round($y),round($x),round($y-$h),round($x+$w),round($y-$h),round($x+$w),round($y));
+	}
+    }
+
+    function AddTxtCR($aTxt) {
+	// If the user has just specified a '\n'
+	// instead of '\n\t' we have to add '\r' since
+	// the width will be too muchy otherwise since when
+	// we print we stroke the individually lines by hand.
+	$e = explode("\n",$aTxt);
+	$n = count($e);
+	for($i=0; $i<$n; ++$i) {
+	    $e[$i]=str_replace("\r","",$e[$i]);
+	}
+	return implode("\n\r",$e);
+    }
+
+    function GetTTFBBox($aTxt,$aAngle=0) {
+	$bbox = @ImageTTFBBox($this->font_size,$aAngle,$this->font_file,$aTxt);
+	if( $bbox === false ) {
+	    JpGraphError::RaiseL(25092,$this->font_file);
+//("There is either a configuration problem with TrueType or a problem reading font file (".$this->font_file."). Make sure file exists and is in a readable place for the HTTP process. (If 'basedir' restriction is enabled in PHP then the font file must be located in the document root.). It might also be a wrongly installed FreeType library. Try uppgrading to at least FreeType 2.1.13 and recompile GD with the correct setup so it can find the new FT library.");
+	}
+	return $bbox;
+    }
+
+    function GetBBoxTTF($aTxt,$aAngle=0) {
+	// Normalize the bounding box to become a minimum
+	// enscribing rectangle
+
+	$aTxt = $this->AddTxtCR($aTxt);
+
+	if( !is_readable($this->font_file) ) {
+	    JpGraphError::RaiseL(25093,$this->font_file);
+//('Can not read font file ('.$this->font_file.') in call to Image::GetBBoxTTF. Please make sure that you have set a font before calling this method and that the font is installed in the TTF directory.');
+	}
+	$bbox = $this->GetTTFBBox($aTxt,$aAngle);
+
+	if( $aAngle==0 ) 
+	    return $bbox;
+	if( $aAngle >= 0 ) {
+	    if(  $aAngle <= 90 ) { //<=0		
+		$bbox = array($bbox[6],$bbox[1],$bbox[2],$bbox[1],
+			      $bbox[2],$bbox[5],$bbox[6],$bbox[5]);
+	    }
+	    elseif(  $aAngle <= 180 ) { //<= 2
+		$bbox = array($bbox[4],$bbox[7],$bbox[0],$bbox[7],
+			      $bbox[0],$bbox[3],$bbox[4],$bbox[3]);
+	    }
+	    elseif(  $aAngle <= 270 )  { //<= 3
+		$bbox = array($bbox[2],$bbox[5],$bbox[6],$bbox[5],
+			      $bbox[6],$bbox[1],$bbox[2],$bbox[1]);
+	    }
+	    else {
+		$bbox = array($bbox[0],$bbox[3],$bbox[4],$bbox[3],
+			      $bbox[4],$bbox[7],$bbox[0],$bbox[7]);
+	    }
+	}
+	elseif(  $aAngle < 0 ) {
+	    if( $aAngle <= -270 ) { // <= -3
+		$bbox = array($bbox[6],$bbox[1],$bbox[2],$bbox[1],
+			      $bbox[2],$bbox[5],$bbox[6],$bbox[5]);
+	    }
+	    elseif( $aAngle <= -180 ) { // <= -2
+		$bbox = array($bbox[0],$bbox[3],$bbox[4],$bbox[3],
+			      $bbox[4],$bbox[7],$bbox[0],$bbox[7]);
+	    }
+	    elseif( $aAngle <= -90 ) { // <= -1
+		$bbox = array($bbox[2],$bbox[5],$bbox[6],$bbox[5],
+			      $bbox[6],$bbox[1],$bbox[2],$bbox[1]);
+	    }
+	    else {
+		$bbox = array($bbox[0],$bbox[3],$bbox[4],$bbox[3],
+			      $bbox[4],$bbox[7],$bbox[0],$bbox[7]);
+	    }
+	}	
+	return $bbox;
+    }
+
+    function GetBBoxHeight($aTxt,$aAngle=0) {
+	$box = $this->GetBBoxTTF($aTxt,$aAngle);
+	return $box[1]-$box[7]+1;
+    }
+
+    function GetBBoxWidth($aTxt,$aAngle=0) {
+	$box = $this->GetBBoxTTF($aTxt,$aAngle);
+	return $box[2]-$box[0]+1;	
+    }
+
+    function _StrokeTTF($x,$y,$txt,$dir=0,$paragraph_align="left",&$aBoundingBox,$debug=false) {
+
+	// Setupo default inter line margin for paragraphs to
+	// 25% of the font height.
+	$ConstLineSpacing = 0.25 ;
+
+	// Remember the anchor point before adjustment
+	if( $debug ) {
+	    $ox=$x;
+	    $oy=$y;
+	}
+
+	if( !ereg("\n",$txt) || ($dir>0 && ereg("\n",$txt)) ) {
+	    // Format a single line
+
+	    $txt = $this->AddTxtCR($txt);
+
+	    $bbox=$this->GetBBoxTTF($txt,$dir);
+	    
+	    // Align x,y ot lower left corner of bbox
+	    $x -= $bbox[0];
+	    $y -= $bbox[1];
+
+	    // Note to self: "topanchor" is deprecated after we changed the
+	    // bopunding box stuff. 
+	    if( $this->text_halign=="right" || $this->text_halign=="topanchor" ) 
+		$x -= $bbox[2]-$bbox[0];
+	    elseif( $this->text_halign=="center" ) $x -= ($bbox[2]-$bbox[0])/2; 
+	    
+	    if( $this->text_valign=="top" ) $y += abs($bbox[5])+$bbox[1];
+	    elseif( $this->text_valign=="center" ) $y -= ($bbox[5]-$bbox[1])/2; 
+
+	    ImageTTFText ($this->img, $this->font_size, $dir, $x, $y, 
+			  $this->current_color,$this->font_file,$txt); 
+
+	    // Calculate and return the co-ordinates for the bounding box
+	    $box=@ImageTTFBBox($this->font_size,$dir,$this->font_file,$txt);
+	    $p1 = array();
+
+
+	    for($i=0; $i < 4; ++$i) {
+		$p1[] = round($box[$i*2]+$x);
+		$p1[] = round($box[$i*2+1]+$y);
+	    }
+	    $aBoundingBox = $p1;
+
+	    // Debugging code to highlight the bonding box and bounding rectangle
+	    // For text at 0 degrees the bounding box and bounding rectangle are the
+	    // same
+            if( $debug ) {
+		// Draw the bounding rectangle and the bounding box
+		$box=@ImageTTFBBox($this->font_size,$dir,$this->font_file,$txt);
+		$p = array();
+		$p1 = array();
+		for($i=0; $i < 4; ++$i) {
+		    $p[] = $bbox[$i*2]+$x;
+		    $p[] = $bbox[$i*2+1]+$y;
+		    $p1[] = $box[$i*2]+$x;
+		    $p1[] = $box[$i*2+1]+$y;
+		}
+
+		// Draw bounding box
+		$this->PushColor('green');
+		$this->Polygon($p1,true);
+		$this->PopColor();
+		
+		// Draw bounding rectangle
+		$this->PushColor('darkgreen');
+		$this->Polygon($p,true);
+		$this->PopColor();
+		
+		// Draw a cross at the anchor point
+		$this->PushColor('red');
+		$this->Line($ox-15,$oy,$ox+15,$oy);
+		$this->Line($ox,$oy-15,$ox,$oy+15);
+		$this->PopColor();
+            }
+	}
+	else {
+	    // Format a text paragraph
+	    $fh=$this->GetFontHeight();
+
+	    // Line margin is 25% of font height
+	    $linemargin=round($fh*$ConstLineSpacing);
+	    $fh += $linemargin;
+	    $w=$this->GetTextWidth($txt);
+
+	    $y -= $linemargin/2;
+	    $tmp = split("\n",$txt);
+	    $nl = count($tmp);
+	    $h = $nl * $fh;
+
+	    if( $this->text_halign=="right") 				
+		$x -= $dir==0 ? $w : $h;
+	    elseif( $this->text_halign=="center" ) {
+		$x -= $dir==0 ? $w/2 : $h/2;
+	    }
+	    
+	    if( $this->text_valign=="top" )
+		$y +=	$dir==0 ? $h : $w;
+	    elseif( $this->text_valign=="center" ) 				
+		$y +=	$dir==0 ? $h/2 : $w/2;
+
+	    // Here comes a tricky bit. 
+	    // Since we have to give the position for the string at the
+	    // baseline this means thaht text will move slightly up
+	    // and down depending on any of it's character descend below
+	    // the baseline, for example a 'g'. To adjust the Y-position
+	    // we therefore adjust the text with the baseline Y-offset
+	    // as used for the current font and size. This will keep the
+	    // baseline at a fixed positoned disregarding the actual 
+	    // characters in the string. 
+	    $standardbox = $this->GetTTFBBox('Gg',$dir);
+	    $yadj = $standardbox[1];
+	    $xadj = $standardbox[0];
+	    $aBoundingBox = array();
+	    for($i=0; $i < $nl; ++$i) {
+		$wl = $this->GetTextWidth($tmp[$i]);
+		$bbox = $this->GetTTFBBox($tmp[$i],$dir);
+		if( $paragraph_align=="left" ) {
+		    $xl = $x; 
+		}
+		elseif( $paragraph_align=="right" ) {
+		    $xl = $x + ($w-$wl);
+		}
+		else {
+		    // Center
+		    $xl = $x + $w/2 - $wl/2 ;
+		}
+
+		$xl -= $bbox[0];
+		$yl = $y - $yadj; 
+		$xl = $xl - $xadj; 
+		ImageTTFText ($this->img, $this->font_size, $dir, 
+			      $xl, $yl-($h-$fh)+$fh*$i,
+			      $this->current_color,$this->font_file,$tmp[$i]); 
+
+		if( $debug  ) {
+		    // Draw the bounding rectangle around each line
+		    $box=@ImageTTFBBox($this->font_size,$dir,$this->font_file,$tmp[$i]);
+		    $p = array();
+		    for($j=0; $j < 4; ++$j) {
+			$p[] = $bbox[$j*2]+$xl;
+			$p[] = $bbox[$j*2+1]+$yl-($h-$fh)+$fh*$i;
+		    }
+		    
+		    // Draw bounding rectangle
+		    $this->PushColor('darkgreen');
+		    $this->Polygon($p,true);
+		    $this->PopColor();
+		}
+	    }
+
+	    // Get the bounding box
+	    $bbox = $this->GetBBoxTTF($txt,$dir);
+	    for($j=0; $j < 4; ++$j) {
+		$bbox[$j*2]+= round($x);
+		$bbox[$j*2+1]+= round($y - ($h-$fh) - $yadj);
+	    }
+	    $aBoundingBox = $bbox;
+
+	    if( $debug ) {	
+		// Draw a cross at the anchor point
+		$this->PushColor('red');
+		$this->Line($ox-25,$oy,$ox+25,$oy);
+		$this->Line($ox,$oy-25,$ox,$oy+25);
+		$this->PopColor();
+	    }
+
+	}
+    }
+	
+    function StrokeText($x,$y,$txt,$dir=0,$paragraph_align="left",$debug=false) {
+
+	$x = round($x);
+	$y = round($y);
+
+	// Do special language encoding
+	$txt = $this->langconv->Convert($txt,$this->font_family);
+
+	if( !is_numeric($dir) )
+	    JpGraphError::RaiseL(25094);//(" Direction for text most be given as an angle between 0 and 90.");
+			
+	if( $this->font_family >= FF_FONT0 && $this->font_family <= FF_FONT2+1) {	
+	    $this->_StrokeBuiltinFont($x,$y,$txt,$dir,$paragraph_align,$boundingbox,$debug);
+	}
+	elseif($this->font_family >= _FF_FIRST && $this->font_family <= _FF_LAST)  {
+	    $this->_StrokeTTF($x,$y,$txt,$dir,$paragraph_align,$boundingbox,$debug);
+	}
+	else
+	    JpGraphError::RaiseL(25095);//(" Unknown font font family specification. ");
+	return $boundingbox;
+    }
+	
+    function SetMargin($lm,$rm,$tm,$bm) {
+	$this->left_margin=$lm;
+	$this->right_margin=$rm;
+	$this->top_margin=$tm;
+	$this->bottom_margin=$bm;
+	$this->plotwidth=$this->width - $this->left_margin-$this->right_margin ; 
+	$this->plotheight=$this->height - $this->top_margin-$this->bottom_margin ;
+	if( $this->width  > 0 && $this->height > 0 ) {
+	    if( $this->plotwidth < 0  || $this->plotheight < 0 )
+		JpGraphError::raise("Too small plot area. ($lm,$rm,$tm,$bm : $this->plotwidth x $this->plotheight). With the given image size and margins there is to little space left for the plot. Increase the plot size or reduce the margins.");
+	}
+    }
+
+    function SetTransparent($color) {
+	imagecolortransparent ($this->img,$this->rgb->allocate($color));
+    }
+	
+    function SetColor($color,$aAlpha=0) {
+	$this->current_color_name = $color;
+	$this->current_color=$this->rgb->allocate($color,$aAlpha);
+	if( $this->current_color == -1 ) {
+	    $tc=imagecolorstotal($this->img);
+	    JpGraphError::RaiseL(25096);
+//("Can't allocate any more colors. Image has already allocated maximum of <b>$tc colors</b>. This might happen if you have anti-aliasing turned on together with a background image or perhaps gradient fill since this requires many, many colors. Try to turn off anti-aliasing. If there is still a problem try downgrading the quality of the background image to use a smaller pallete to leave some entries for your graphs. You should try to limit the number of colors in your background image to 64. If there is still problem set the constant DEFINE(\"USE_APPROX_COLORS\",true); in jpgraph.php This will use approximative colors when the palette is full. Unfortunately there is not much JpGraph can do about this since the palette size is a limitation of current graphic format and what the underlying GD library suppports."); 
+	}
+	return $this->current_color;
+    }
+	
+    function PushColor($color) {
+	if( $color != "" ) {
+	    $this->colorstack[$this->colorstackidx]=$this->current_color_name;
+	    $this->colorstack[$this->colorstackidx+1]=$this->current_color;
+	    $this->colorstackidx+=2;
+	    $this->SetColor($color);
+	}
+	else {
+	    JpGraphError::RaiseL(25097);//("Color specified as empty string in PushColor().");
+	}
+    }
+	
+    function PopColor() {
+	if($this->colorstackidx<1)
+	    JpGraphError::RaiseL(25098);//(" Negative Color stack index. Unmatched call to PopColor()");
+	$this->current_color=$this->colorstack[--$this->colorstackidx];
+	$this->current_color_name=$this->colorstack[--$this->colorstackidx];
+    }
+	
+	
+    // Why this duplication? Because this way we can call this method
+    // for any image and not only the current objsct
+    function AdjSat($sat) {	
+	if( $GLOBALS['gd2'] && USE_TRUECOLOR )
+	    return;
+	$this->_AdjSat($this->img,$sat);	
+    }	
+	
+    function _AdjSat($img,$sat) {
+	$nbr = imagecolorstotal ($img);
+	for( $i=0; $i<$nbr; ++$i ) {
+	    $colarr = imagecolorsforindex ($img,$i);
+	    $rgb[0]=$colarr["red"];
+	    $rgb[1]=$colarr["green"];
+	    $rgb[2]=$colarr["blue"];
+	    $rgb = $this->AdjRGBSat($rgb,$sat);
+	    imagecolorset ($img, $i, $rgb[0], $rgb[1], $rgb[2]);
+	}
+    }
+	
+    function AdjBrightContrast($bright,$contr=0) {
+	if( $GLOBALS['gd2'] && USE_TRUECOLOR )
+	    return;
+	$this->_AdjBrightContrast($this->img,$bright,$contr);
+    }
+
+    function _AdjBrightContrast($img,$bright,$contr=0) {
+	if( $bright < -1 || $bright > 1 || $contr < -1 || $contr > 1 )
+	    JpGraphError::RaiseL(25099);//(" Parameters for brightness and Contrast out of range [-1,1]");		
+	$nbr = imagecolorstotal ($img);
+	for( $i=0; $i<$nbr; ++$i ) {
+	    $colarr = imagecolorsforindex ($img,$i);
+	    $r = $this->AdjRGBBrightContrast($colarr["red"],$bright,$contr);
+	    $g = $this->AdjRGBBrightContrast($colarr["green"],$bright,$contr);
+	    $b = $this->AdjRGBBrightContrast($colarr["blue"],$bright,$contr);		
+	    imagecolorset ($img, $i, $r, $g, $b);
+	}
+    }
+	
+    // Private helper function for adj sat
+    // Adjust saturation for RGB array $u. $sat is a value between -1 and 1
+    // Note: Due to GD inability to handle true color the RGB values are only between
+    // 8 bit. This makes saturation quite sensitive for small increases in parameter sat.
+    // 
+    // Tip: To get a grayscale picture set sat=-100, values <-100 changes the colors
+    // to it's complement.
+    // 
+    // Implementation note: The saturation is implemented directly in the RGB space
+    // by adjusting the perpendicular distance between the RGB point and the "grey"
+    // line (1,1,1). Setting $sat>0 moves the point away from the line along the perp.
+    // distance and a negative value moves the point closer to the line.
+    // The values are truncated when the color point hits the bounding box along the
+    // RGB axis.
+    // DISCLAIMER: I'm not 100% sure this is he correct way to implement a color 
+    // saturation function in RGB space. However, it looks ok and has the expected effect.
+    function AdjRGBSat($rgb,$sat) {
+	// TODO: Should be moved to the RGB class
+	// Grey vector
+	$v=array(1,1,1);
+
+	// Dot product
+	$dot = $rgb[0]*$v[0]+$rgb[1]*$v[1]+$rgb[2]*$v[2];
+
+	// Normalize dot product
+	$normdot = $dot/3;	// dot/|v|^2
+
+	// Direction vector between $u and its projection onto $v
+	for($i=0; $i<3; ++$i)
+	    $r[$i] = $rgb[$i] - $normdot*$v[$i];
+
+	// Adjustment factor so that sat==1 sets the highest RGB value to 255
+	if( $sat > 0 ) {
+	    $m=0;
+	    for( $i=0; $i<3; ++$i) {
+		if( sign($r[$i]) == 1 && $r[$i]>0)
+		    $m=max($m,(255-$rgb[$i])/$r[$i]);
+	    }
+	    $tadj=$m;
+	}
+	else
+	    $tadj=1;
+		
+	$tadj = $tadj*$sat;	
+	for($i=0; $i<3; ++$i) {
+	    $un[$i] = round($rgb[$i] + $tadj*$r[$i]);		
+	    if( $un[$i]<0 ) $un[$i]=0;		// Truncate color when they reach 0
+	    if( $un[$i]>255 ) $un[$i]=255;// Avoid potential rounding error
+	}		
+	return $un;	
+    }	
+
+    // Private helper function for AdjBrightContrast
+    function AdjRGBBrightContrast($rgb,$bright,$contr) {
+	// TODO: Should be moved to the RGB class
+	// First handle contrast, i.e change the dynamic range around grey
+	if( $contr <= 0 ) {
+	    // Decrease contrast
+	    $adj = abs($rgb-128) * (-$contr);
+	    if( $rgb < 128 ) $rgb += $adj;
+	    else $rgb -= $adj;
+	}
+	else { // $contr > 0
+	    // Increase contrast
+	    if( $rgb < 128 ) $rgb = $rgb - ($rgb * $contr);
+	    else $rgb = $rgb + ((255-$rgb) * $contr);
+	}
+	
+	// Add (or remove) various amount of white
+	$rgb += $bright*255;	
+	$rgb=min($rgb,255);
+	$rgb=max($rgb,0);
+	return $rgb;	
+    }
+	
+    function SetLineWeight($weight) {
+	$this->line_weight = $weight;
+    }
+	
+    function SetStartPoint($x,$y) {
+	$this->lastx=round($x);
+	$this->lasty=round($y);
+    }
+	
+    function Arc($cx,$cy,$w,$h,$s,$e) {
+	// GD Arc doesn't like negative angles
+	while( $s < 0) $s += 360;
+	while( $e < 0) $e += 360;
+    	
+	imagearc($this->img,round($cx),round($cy),round($w),round($h),
+		 $s,$e,$this->current_color);
+    }
+    
+    function FilledArc($xc,$yc,$w,$h,$s,$e,$style="") {
+
+	if( $GLOBALS['gd2'] ) {
+	    while( $s < 0 ) $s += 360;
+	    while( $e < 0 ) $e += 360;
+	    if( $style=="" ) 
+		$style=IMG_ARC_PIE;
+	    imagefilledarc($this->img,round($xc),round($yc),round($w),round($h),
+			   round($s),round($e),$this->current_color,$style);
+	    return;
+	}
+
+
+	// In GD 1.x we have to do it ourself interesting enough there is surprisingly
+	// little difference in time between doing it PHP and using the optimised GD 
+	// library (roughly ~20%) I had expected it to be at least 100% slower doing it
+	// manually with a polygon approximation in PHP.....
+	$fillcolor = $this->current_color_name;
+
+	$w /= 2; // We use radius in our calculations instead
+	$h /= 2;
+
+	// Setup the angles so we have the same conventions as the builtin
+	// FilledArc() which is a little bit strange if you ask me....
+
+	$s = 360-$s;
+	$e = 360-$e;
+
+	if( $e > $s ) {
+	    $e = $e - 360;
+	    $da = $s - $e; 
+	}
+	$da = $s-$e;
+
+	// We use radians
+	$s *= M_PI/180;
+	$e *= M_PI/180;
+	$da *= M_PI/180;
+
+	// Calculate a polygon approximation
+	$p[0] = $xc;
+	$p[1] = $yc;
+
+	// Heuristic on how many polygons we need to make the
+	// arc look good
+	$numsteps = round(8 * abs($da) * ($w+$h)*($w+$h)/1500);
+
+	if( $numsteps == 0 ) return;
+	if( $numsteps < 7 ) $numsteps=7;
+	$delta = abs($da)/$numsteps;
+	
+	$pa=array();
+	$a = $s;
+	for($i=1; $i<=$numsteps; ++$i ) {
+	    $p[2*$i] = round($xc + $w*cos($a));
+	    $p[2*$i+1] = round($yc - $h*sin($a));
+	    //$a = $s + $i*$delta; 
+	    $a -= $delta; 
+	    $pa[2*($i-1)] = $p[2*$i];
+	    $pa[2*($i-1)+1] = $p[2*$i+1];
+	}
+
+	// Get the last point at the exact ending angle to avoid
+	// any rounding errors.
+	$p[2*$i] = round($xc + $w*cos($e));
+	$p[2*$i+1] = round($yc - $h*sin($e));
+	$pa[2*($i-1)] = $p[2*$i];
+	$pa[2*($i-1)+1] = $p[2*$i+1];
+	$i++;
+
+	$p[2*$i] = $xc;
+    	$p[2*$i+1] = $yc;
+	if( $fillcolor != "" ) {
+	    $this->PushColor($fillcolor);
+	    imagefilledpolygon($this->img,$p,count($p)/2,$this->current_color);
+	    $this->PopColor();
+	}
+    }
+
+    function FilledCakeSlice($cx,$cy,$w,$h,$s,$e) {
+	$this->CakeSlice($cx,$cy,$w,$h,$s,$e,$this->current_color_name);
+    }
+
+    function CakeSlice($xc,$yc,$w,$h,$s,$e,$fillcolor="",$arccolor="") {
+	$s = round($s); $e = round($e);
+	$w = round($w); $h = round($h);
+	$xc = round($xc); $yc = round($yc);
+	$this->PushColor($fillcolor);
+	$this->FilledArc($xc,$yc,2*$w,2*$h,$s,$e);
+	$this->PopColor();
+	if( $arccolor != "" ) {
+	    $this->PushColor($arccolor);
+	    // We add 2 pixels to make the Arc() better aligned with the filled arc. 
+	    if( $GLOBALS['gd2'] ) {
+		imagefilledarc($this->img,$xc,$yc,2*$w,2*$h,$s,$e,$this->current_color,IMG_ARC_NOFILL | IMG_ARC_EDGED ) ;
+	    }
+	    else {
+		$this->Arc($xc,$yc,2*$w+2,2*$h+2,$s,$e);
+		$xx = $w * cos(2*M_PI - $s*M_PI/180) + $xc;
+		$yy = $yc - $h * sin(2*M_PI - $s*M_PI/180);
+		$this->Line($xc,$yc,$xx,$yy);
+		$xx = $w * cos(2*M_PI - $e*M_PI/180) + $xc;
+		$yy = $yc - $h * sin(2*M_PI - $e*M_PI/180);
+		$this->Line($xc,$yc,$xx,$yy);
+	    }
+	    $this->PopColor();
+	}
+    }
+
+    function Ellipse($xc,$yc,$w,$h) {
+	$this->Arc($xc,$yc,$w,$h,0,360);
+    }
+	
+    // Breseham circle gives visually better result then using GD
+    // built in arc(). It takes some more time but gives better
+    // accuracy.
+    function BresenhamCircle($xc,$yc,$r) {
+	$d = 3-2*$r;
+	$x = 0;
+	$y = $r;
+	while($x<=$y) {
+	    $this->Point($xc+$x,$yc+$y);			
+	    $this->Point($xc+$x,$yc-$y);
+	    $this->Point($xc-$x,$yc+$y);
+	    $this->Point($xc-$x,$yc-$y);
+			
+	    $this->Point($xc+$y,$yc+$x);
+	    $this->Point($xc+$y,$yc-$x);
+	    $this->Point($xc-$y,$yc+$x);
+	    $this->Point($xc-$y,$yc-$x);
+			
+	    if( $d<0 ) $d += 4*$x+6;
+	    else {
+		$d += 4*($x-$y)+10;		
+		--$y;
+	    }
+	    ++$x;
+	}
+    }
+			
+    function Circle($xc,$yc,$r) {
+	if( USE_BRESENHAM )
+	    $this->BresenhamCircle($xc,$yc,$r);
+	else {
+
+	    /*
+            // Some experimental code snippet to see if we can get a decent 
+	    // result doing a trig-circle
+	    // Create an approximated circle with 0.05 rad resolution
+	    $end = 2*M_PI;
+	    $l = $r/10;
+	    if( $l < 3 ) $l=3;
+	    $step_size = 2*M_PI/(2*$r*M_PI/$l);
+	    $pts = array();
+	    $pts[] = $r + $xc;
+	    $pts[] = $yc;
+	    for( $a=$step_size; $a <= $end; $a += $step_size ) {
+		$pts[] = round($xc + $r*cos($a));
+		$pts[] = round($yc - $r*sin($a));
+	    }
+	    imagepolygon($this->img,$pts,count($pts)/2,$this->current_color);
+	    */
+
+	    $this->Arc($xc,$yc,$r*2,$r*2,0,360);		
+
+	    // For some reason imageellipse() isn't in GD 2.0.1, PHP 4.1.1
+	    //imageellipse($this->img,$xc,$yc,$r,$r,$this->current_color);
+	}
+    }
+	
+    function FilledCircle($xc,$yc,$r) {
+	if( $GLOBALS['gd2'] ) {
+	    imagefilledellipse($this->img,round($xc),round($yc),
+	    		       2*$r,2*$r,$this->current_color);
+	}
+	else {
+	    for( $i=1; $i < 2*$r; $i += 2 ) {
+		// To avoid moire patterns we have to draw some
+		// 1 extra "skewed" filled circles
+		$this->Arc($xc,$yc,$i,$i,0,360);
+		$this->Arc($xc,$yc,$i+1,$i,0,360);
+		$this->Arc($xc,$yc,$i+1,$i+1,0,360);
+	    }
+	}	
+    }
+	
+    // Linear Color InterPolation
+    function lip($f,$t,$p) {
+	$p = round($p,1);
+	$r = $f[0] + ($t[0]-$f[0])*$p;
+	$g = $f[1] + ($t[1]-$f[1])*$p;
+	$b = $f[2] + ($t[2]-$f[2])*$p;
+	return array($r,$g,$b);
+    }
+
+    // Anti-aliased line. 
+    // Note that this is roughly 8 times slower then a normal line!
+    function WuLine($x1,$y1,$x2,$y2) {
+	// Get foreground line color
+	$lc = imagecolorsforindex($this->img,$this->current_color);
+	$lc = array($lc["red"],$lc["green"],$lc["blue"]);
+
+	$dx = $x2-$x1;
+	$dy = $y2-$y1;
+	
+	if( abs($dx) > abs($dy) ) {
+	    if( $dx<0 ) {
+		$dx = -$dx;$dy = -$dy;
+		$tmp=$x2;$x2=$x1;$x1=$tmp;
+		$tmp=$y2;$y2=$y1;$y1=$tmp;
+	    }
+	    $x=$x1<<16; $y=$y1<<16;
+	    $yinc = ($dy*65535)/$dx;
+	    while( ($x >> 16) < $x2 ) {
+				
+		$bc = @imagecolorsforindex($this->img,imagecolorat($this->img,$x>>16,$y>>16));
+		if( $bc <= 0 ) {
+		    JpGraphError::RaiseL(25100);//('Problem with color palette and your GD setup. Please disable anti-aliasing or use GD2 with true-color. If you have GD2 library installed please make sure that you have set the USE_GD2 constant to true and that truecolor is enabled.');
+		}
+		$bc=array($bc["red"],$bc["green"],$bc["blue"]);
+				
+		$this->SetColor($this->lip($lc,$bc,($y & 0xFFFF)/65535));
+		imagesetpixel($this->img,$x>>16,$y>>16,$this->current_color);
+		$this->SetColor($this->lip($lc,$bc,(~$y & 0xFFFF)/65535));
+		imagesetpixel($this->img,$x>>16,($y>>16)+1,$this->current_color);
+		$x += 65536; $y += $yinc;
+	    }
+	}
+	else {
+	    if( $dy<0 ) {
+		$dx = -$dx;$dy = -$dy;
+		$tmp=$x2;$x2=$x1;$x1=$tmp;
+		$tmp=$y2;$y2=$y1;$y1=$tmp;
+	    }
+	    $x=$x1<<16; $y=$y1<<16;
+	    $xinc = ($dx*65535)/$dy;	
+	    while( ($y >> 16) < $y2 ) {
+				
+		$bc = @imagecolorsforindex($this->img,imagecolorat($this->img,$x>>16,$y>>16));
+		if( $bc <= 0 ) {
+		    JpGraphError::RaiseL(25100);//('Problem with color palette and your GD setup. Please disable anti-aliasing or use GD2 with true-color. If you have GD2 library installed please make sure that you have set the USE_GD2 constant to true and truecolor is enabled.');
+
+		}
+
+		$bc=array($bc["red"],$bc["green"],$bc["blue"]);				
+				
+		$this->SetColor($this->lip($lc,$bc,($x & 0xFFFF)/65535));
+		imagesetpixel($this->img,$x>>16,$y>>16,$this->current_color);
+		$this->SetColor($this->lip($lc,$bc,(~$x & 0xFFFF)/65535));
+		imagesetpixel($this->img,($x>>16)+1,$y>>16,$this->current_color);
+		$y += 65536; $x += $xinc;
+	    }
+	}
+	$this->SetColor($lc);
+	imagesetpixel($this->img,$x2,$y2,$this->current_color);		
+	imagesetpixel($this->img,$x1,$y1,$this->current_color);			
+    }
+
+    // Set line style dashed, dotted etc
+    function SetLineStyle($s) {
+	if( is_numeric($s) ) {
+	    if( $s<1 || $s>4 ) 
+		JpGraphError::RaiseL(25101,$s);//(" Illegal numeric argument to SetLineStyle(): ($s)");
+	}
+	elseif( is_string($s) ) {
+	    if( $s == "solid" ) $s=1;
+	    elseif( $s == "dotted" ) $s=2;
+	    elseif( $s == "dashed" ) $s=3;
+	    elseif( $s == "longdashed" ) $s=4;
+	    else JpGraphError::RaiseL(25102,$s);//(" Illegal string argument to SetLineStyle(): $s");
+	}
+	else JpGraphError::RaiseL(25103,$s);//(" Illegal argument to SetLineStyle $s");
+	$this->line_style=$s;
+    }
+	
+    // Same as Line but take the line_style into account
+    function StyleLine($x1,$y1,$x2,$y2) {
+	switch( $this->line_style ) {
+	    case 1:// Solid
+		$this->Line($x1,$y1,$x2,$y2);
+		break;
+	    case 2: // Dotted
+		$this->DashedLine($x1,$y1,$x2,$y2,1,6);
+		break;
+	    case 3: // Dashed
+		$this->DashedLine($x1,$y1,$x2,$y2,2,4);
+		break;
+	    case 4: // Longdashes
+		$this->DashedLine($x1,$y1,$x2,$y2,8,6);
+		break;
+	    default:
+		JpGraphError::RaiseL(25104,$this->line_style);//(" Unknown line style: $this->line_style ");
+		break;
+	}
+    }
+
+    function Line($x1,$y1,$x2,$y2) {
+
+	$x1 = round($x1);
+	$x2 = round($x2);
+	$y1 = round($y1);
+	$y2 = round($y2);
+
+	if( $this->line_weight==0 ) return;
+	if( $this->use_anti_aliasing ) {
+	    $dx = $x2-$x1;
+	    $dy = $y2-$y1;
+	    // Vertical, Horizontal or 45 lines don't need anti-aliasing
+	    if( $dx!=0 && $dy!=0 && $dx!=$dy ) {
+		$this->WuLine($x1,$y1,$x2,$y2);
+		return;
+	    }
+	}
+	if( $this->line_weight==1 ) {
+	    imageline($this->img,$x1,$y1,$x2,$y2,$this->current_color);
+	}
+	elseif( $x1==$x2 ) {		// Special case for vertical lines
+	    imageline($this->img,$x1,$y1,$x2,$y2,$this->current_color);
+	    $w1=floor($this->line_weight/2);
+	    $w2=floor(($this->line_weight-1)/2);
+	    for($i=1; $i<=$w1; ++$i) 
+		imageline($this->img,$x1+$i,$y1,$x2+$i,$y2,$this->current_color);
+	    for($i=1; $i<=$w2; ++$i) 
+		imageline($this->img,$x1-$i,$y1,$x2-$i,$y2,$this->current_color);
+	}
+	elseif( $y1==$y2 ) {		// Special case for horizontal lines
+	    imageline($this->img,$x1,$y1,$x2,$y2,$this->current_color);
+	    $w1=floor($this->line_weight/2);
+	    $w2=floor(($this->line_weight-1)/2);
+	    for($i=1; $i<=$w1; ++$i) 
+		imageline($this->img,$x1,$y1+$i,$x2,$y2+$i,$this->current_color);
+	    for($i=1; $i<=$w2; ++$i) 
+		imageline($this->img,$x1,$y1-$i,$x2,$y2-$i,$this->current_color);		
+	}
+	else {	// General case with a line at an angle
+	    $a = atan2($y1-$y2,$x2-$x1);
+	    // Now establish some offsets from the center. This gets a little
+	    // bit involved since we are dealing with integer functions and we
+	    // want the apperance to be as smooth as possible and never be thicker
+	    // then the specified width.
+			
+	    // We do the trig stuff to make sure that the endpoints of the line
+	    // are perpendicular to the line itself.
+	    $dx=(sin($a)*$this->line_weight/2);
+	    $dy=(cos($a)*$this->line_weight/2);
+
+	    $pnts = array($x2+$dx,$y2+$dy,$x2-$dx,$y2-$dy,$x1-$dx,$y1-$dy,$x1+$dx,$y1+$dy);
+	    imagefilledpolygon($this->img,$pnts,count($pnts)/2,$this->current_color);
+	}		
+	$this->lastx=$x2; $this->lasty=$y2;		
+    }
+
+    function Polygon($p,$closed=FALSE,$fast=FALSE) {
+	if( $this->line_weight==0 ) return;
+	$n=count($p);
+	$oldx = $p[0];
+	$oldy = $p[1];
+	if( $fast ) {
+	    for( $i=2; $i < $n; $i+=2 ) {
+		imageline($this->img,$oldx,$oldy,$p[$i],$p[$i+1],$this->current_color);
+		$oldx = $p[$i];
+		$oldy = $p[$i+1];
+	    }
+	    if( $closed ) {
+		imageline($this->img,$p[$n*2-2],$p[$n*2-1],$p[0],$p[1],$this->current_color);
+	    }
+	}
+	else {
+	    for( $i=2; $i < $n; $i+=2 ) {
+		$this->StyleLine($oldx,$oldy,$p[$i],$p[$i+1]);
+		$oldx = $p[$i];
+		$oldy = $p[$i+1];
+	    }
+	}
+	if( $closed )
+	    $this->Line($oldx,$oldy,$p[0],$p[1]);
+    }
+	
+    function FilledPolygon($pts) {
+	$n=count($pts);
+	if( $n == 0 ) {
+	    JpGraphError::RaiseL(25105);//('NULL data specified for a filled polygon. Check that your data is not NULL.');
+	}
+	for($i=0; $i < $n; ++$i) 
+	    $pts[$i] = round($pts[$i]);
+	imagefilledpolygon($this->img,$pts,count($pts)/2,$this->current_color);
+    }
+	
+    function Rectangle($xl,$yu,$xr,$yl) {
+	$this->Polygon(array($xl,$yu,$xr,$yu,$xr,$yl,$xl,$yl,$xl,$yu));
+    }
+	
+    function FilledRectangle($xl,$yu,$xr,$yl) {
+	$this->FilledPolygon(array($xl,$yu,$xr,$yu,$xr,$yl,$xl,$yl));
+    }
+
+    function FilledRectangle2($xl,$yu,$xr,$yl,$color1,$color2,$style=1) {
+	// Fill a rectangle with lines of two colors
+	if( $style===1 ) {
+	    // Horizontal stripe
+	    if( $yl < $yu ) {
+		$t = $yl; $yl=$yu; $yu=$t;
+	    }
+	    for( $y=$yu; $y <= $yl; ++$y) {
+		$this->SetColor($color1);
+		$this->Line($xl,$y,$xr,$y);
+		++$y;
+		$this->SetColor($color2);
+		$this->Line($xl,$y,$xr,$y);
+	    }
+	}
+	else {
+	    if( $xl < $xl ) {
+		$t = $xl; $xl=$xr; $xr=$t;
+	    }
+	    for( $x=$xl; $x <= $xr; ++$x) {
+		$this->SetColor($color1);
+		$this->Line($x,$yu,$x,$yl);
+		++$x;
+		$this->SetColor($color2);
+		$this->Line($x,$yu,$x,$yl);
+	    }
+	}
+    }
+
+    function ShadowRectangle($xl,$yu,$xr,$yl,$fcolor=false,$shadow_width=3,$shadow_color=array(102,102,102)) {
+	// This is complicated by the fact that we must also handle the case where
+        // the reactangle has no fill color
+	$this->PushColor($shadow_color);
+	$this->FilledRectangle($xr-$shadow_width,$yu+$shadow_width,$xr,$yl-$shadow_width-1);
+	$this->FilledRectangle($xl+$shadow_width,$yl-$shadow_width,$xr,$yl);
+	//$this->FilledRectangle($xl+$shadow_width,$yu+$shadow_width,$xr,$yl);
+	$this->PopColor();
+	if( $fcolor==false )
+	    $this->Rectangle($xl,$yu,$xr-$shadow_width-1,$yl-$shadow_width-1);
+	else {		
+	    $this->PushColor($fcolor);
+	    $this->FilledRectangle($xl,$yu,$xr-$shadow_width-1,$yl-$shadow_width-1);
+	    $this->PopColor();
+	    $this->Rectangle($xl,$yu,$xr-$shadow_width-1,$yl-$shadow_width-1);
+	}
+    }
+
+    function FilledRoundedRectangle($xt,$yt,$xr,$yl,$r=5) {
+	if( $r==0 ) {
+	    $this->FilledRectangle($xt,$yt,$xr,$yl);
+	    return;
+	}
+
+	// To avoid overlapping fillings (which will look strange
+	// when alphablending is enabled) we have no choice but 
+	// to fill the five distinct areas one by one.
+	
+	// Center square
+	$this->FilledRectangle($xt+$r,$yt+$r,$xr-$r,$yl-$r);
+	// Top band
+	$this->FilledRectangle($xt+$r,$yt,$xr-$r,$yt+$r-1);
+	// Bottom band
+	$this->FilledRectangle($xt+$r,$yl-$r+1,$xr-$r,$yl);
+	// Left band
+	$this->FilledRectangle($xt,$yt+$r+1,$xt+$r-1,$yl-$r);
+	// Right band
+	$this->FilledRectangle($xr-$r+1,$yt+$r,$xr,$yl-$r);
+
+	// Topleft & Topright arc
+	$this->FilledArc($xt+$r,$yt+$r,$r*2,$r*2,180,270);
+	$this->FilledArc($xr-$r,$yt+$r,$r*2,$r*2,270,360);
+
+	// Bottomleft & Bottom right arc
+	$this->FilledArc($xt+$r,$yl-$r,$r*2,$r*2,90,180);
+	$this->FilledArc($xr-$r,$yl-$r,$r*2,$r*2,0,90);
+
+    }
+
+    function RoundedRectangle($xt,$yt,$xr,$yl,$r=5) {    
+
+	if( $r==0 ) {
+	    $this->Rectangle($xt,$yt,$xr,$yl);
+	    return;
+	}
+
+	// Top & Bottom line
+	$this->Line($xt+$r,$yt,$xr-$r,$yt);
+	$this->Line($xt+$r,$yl,$xr-$r,$yl);
+
+	// Left & Right line
+	$this->Line($xt,$yt+$r,$xt,$yl-$r);
+	$this->Line($xr,$yt+$r,$xr,$yl-$r);
+
+	// Topleft & Topright arc
+	$this->Arc($xt+$r,$yt+$r,$r*2,$r*2,180,270);
+	$this->Arc($xr-$r,$yt+$r,$r*2,$r*2,270,360);
+
+	// Bottomleft & Bottomright arc
+	$this->Arc($xt+$r,$yl-$r,$r*2,$r*2,90,180);
+	$this->Arc($xr-$r,$yl-$r,$r*2,$r*2,0,90);
+    }
+
+    function FilledBevel($x1,$y1,$x2,$y2,$depth=2,$color1='white@0.4',$color2='darkgray@0.4') {
+	$this->FilledRectangle($x1,$y1,$x2,$y2);
+	$this->Bevel($x1,$y1,$x2,$y2,$depth,$color1,$color2);
+    }
+
+    function Bevel($x1,$y1,$x2,$y2,$depth=2,$color1='white@0.4',$color2='black@0.5') {
+	$this->PushColor($color1);
+	for( $i=0; $i < $depth; ++$i ) {
+	    $this->Line($x1+$i,$y1+$i,$x1+$i,$y2-$i);
+	    $this->Line($x1+$i,$y1+$i,$x2-$i,$y1+$i);
+	}
+	$this->PopColor();
+	
+	$this->PushColor($color2);
+	for( $i=0; $i < $depth; ++$i ) {
+	    $this->Line($x1+$i,$y2-$i,$x2-$i,$y2-$i);
+	    $this->Line($x2-$i,$y1+$i,$x2-$i,$y2-$i-1);
+	}
+	$this->PopColor();
+    }
+
+    function StyleLineTo($x,$y) {
+	$this->StyleLine($this->lastx,$this->lasty,$x,$y);
+	$this->lastx=$x;
+	$this->lasty=$y;
+    }
+	
+    function LineTo($x,$y) {
+	$this->Line($this->lastx,$this->lasty,$x,$y);
+	$this->lastx=$x;
+	$this->lasty=$y;
+    }
+	
+    function Point($x,$y) {
+	imagesetpixel($this->img,round($x),round($y),$this->current_color);
+    }
+	
+    function Fill($x,$y) {
+	imagefill($this->img,round($x),round($y),$this->current_color);
+    }
+
+    function FillToBorder($x,$y,$aBordColor) {
+	$bc = $this->rgb->allocate($aBordColor);
+	if( $bc == -1 ) {
+	    JpGraphError::RaiseL(25106);//('Image::FillToBorder : Can not allocate more colors');
+	    exit();
+	}
+	imagefilltoborder($this->img,round($x),round($y),$bc,$this->current_color);
+    }
+	
+    function DashedLine($x1,$y1,$x2,$y2,$dash_length=1,$dash_space=4) {
+
+	$x1 = round($x1);
+	$x2 = round($x2);
+	$y1 = round($y1);
+	$y2 = round($y2);
+
+	// Code based on, but not identical to, work by Ariel Garza and James Pine
+	$line_length = ceil (sqrt(pow(($x2 - $x1),2) + pow(($y2 - $y1),2)) );
+	$dx = ($line_length) ? ($x2 - $x1) / $line_length : 0;
+	$dy = ($line_length) ? ($y2 - $y1) / $line_length : 0;
+	$lastx = $x1; $lasty = $y1;
+	$xmax = max($x1,$x2);
+	$xmin = min($x1,$x2);
+	$ymax = max($y1,$y2);
+	$ymin = min($y1,$y2);
+	for ($i = 0; $i < $line_length; $i += ($dash_length + $dash_space)) {
+	    $x = ($dash_length * $dx) + $lastx;
+	    $y = ($dash_length * $dy) + $lasty;
+			
+	    // The last section might overshoot so we must take a computational hit
+	    // and check this.
+	    if( $x>$xmax ) $x=$xmax;
+	    if( $y>$ymax ) $y=$ymax;
+			
+	    if( $x<$xmin ) $x=$xmin;
+	    if( $y<$ymin ) $y=$ymin;
+
+	    $this->Line($lastx,$lasty,$x,$y);
+	    $lastx = $x + ($dash_space * $dx);
+	    $lasty = $y + ($dash_space * $dy);
+	} 
+    } 
+
+    function SetExpired($aFlg=true) {
+	$this->expired = $aFlg;
+    }
+	
+    // Generate image header
+    function Headers() {
+	
+	// In case we are running from the command line with the client version of
+	// PHP we can't send any headers.
+	$sapi = php_sapi_name();
+	if( $sapi == 'cli' )
+	    return;
+	
+	if( headers_sent($file,$lineno) ) {
+	    $file=basename($file);
+	    $t = new ErrMsgText();
+	    $msg = $t->Get(10,$file,$lineno);
+	    die($msg);
+	}	
+	
+	if ($this->expired) {
+	    header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");
+	    header("Last-Modified: " . gmdate("D, d M Y H:i:s") . "GMT");
+	    header("Cache-Control: no-cache, must-revalidate");
+	    header("Pragma: no-cache");
+	}
+	header("Content-type: image/$this->img_format");
+    }
+
+    // Adjust image quality for formats that allow this
+    function SetQuality($q) {
+	$this->quality = $q;
+    }
+	
+    // Stream image to browser or to file
+    function Stream($aFile="") {
+	$func="image".$this->img_format;
+	if( $this->img_format=="jpeg" && $this->quality != null ) {
+	    $res = @$func($this->img,$aFile,$this->quality);
+	}
+	else {
+	    if( $aFile != "" ) {
+		$res = @$func($this->img,$aFile);
+		if( !$res )
+		    JpGraphError::RaiseL(25107,$aFile);//("Can't write to file '$aFile'. Check that the process running PHP has enough permission.");
+	    }
+	    else {
+		$res = @$func($this->img);
+		if( !$res )
+		    JpGraphError::RaiseL(25108);//("Can't stream image. This is most likely due to a faulty PHP/GD setup. Try to recompile PHP and use the built-in GD library that comes with PHP.");
+		
+	    }
+	}
+    }
+		
+    // Clear resource tide up by image
+    function Destroy() {
+	imagedestroy($this->img);
+    }
+	
+    // Specify image format. Note depending on your installation
+    // of PHP not all formats may be supported.
+    function SetImgFormat($aFormat,$aQuality=75) {		
+	$this->quality = $aQuality;
+	$aFormat = strtolower($aFormat);
+	$tst = true;
+	$supported = imagetypes();
+	if( $aFormat=="auto" ) {
+	    if( $supported & IMG_PNG )
+		$this->img_format="png";
+	    elseif( $supported & IMG_JPG )
+		$this->img_format="jpeg";
+	    elseif( $supported & IMG_GIF )
+		$this->img_format="gif";
+	    else
+		JpGraphError::RaiseL(25109);//("Your PHP (and GD-lib) installation does not appear to support any known graphic formats. You need to first make sure GD is compiled as a module to PHP. If you also want to use JPEG images you must get the JPEG library. Please see the PHP docs for details.");
+				
+	    return true;
+	}
+	else {
+	    if( $aFormat=="jpeg" || $aFormat=="png" || $aFormat=="gif" ) {
+		if( $aFormat=="jpeg" && !($supported & IMG_JPG) )
+		    $tst=false;
+		elseif( $aFormat=="png" && !($supported & IMG_PNG) ) 
+		    $tst=false;
+		elseif( $aFormat=="gif" && !($supported & IMG_GIF) ) 	
+		    $tst=false;
+		else {
+		    $this->img_format=$aFormat;
+		    return true;
+		}
+	    }
+	    else 
+		$tst=false;
+	    if( !$tst )
+		JpGraphError::RaiseL(25110,$aFormat);//(" Your PHP installation does not support the chosen graphic format: $aFormat");
+	}
+    }	
+} // CLASS
+
+//===================================================
+// CLASS RotImage
+// Description: Exactly as Image but draws the image at
+// a specified angle around a specified rotation point.
+//===================================================
+class RotImage extends Image {
+    var $m=array();
+    var $a=0;
+    var $dx=0,$dy=0,$transx=0,$transy=0; 
+	
+    function RotImage($aWidth,$aHeight,$a=0,$aFormat=DEFAULT_GFORMAT) {
+	$this->Image($aWidth,$aHeight,$aFormat);
+	$this->dx=$this->left_margin+$this->plotwidth/2;
+	$this->dy=$this->top_margin+$this->plotheight/2;
+	$this->SetAngle($a);	
+    }
+	
+    function SetCenter($dx,$dy) {
+	$old_dx = $this->dx;
+	$old_dy = $this->dy;
+	$this->dx=$dx;
+	$this->dy=$dy;
+	$this->SetAngle($this->a);
+	return array($old_dx,$old_dy);
+    }
+	
+    function SetTranslation($dx,$dy) {
+	$old = array($this->transx,$this->transy);
+	$this->transx = $dx;
+	$this->transy = $dy;
+	return $old;
+    }
+
+    function UpdateRotMatrice()  {
+	$a = $this->a;
+	$a *= M_PI/180;
+	$sa=sin($a); $ca=cos($a);		
+	// Create the rotation matrix
+	$this->m[0][0] = $ca;
+	$this->m[0][1] = -$sa;
+	$this->m[0][2] = $this->dx*(1-$ca) + $sa*$this->dy ;
+	$this->m[1][0] = $sa;
+	$this->m[1][1] = $ca;
+	$this->m[1][2] = $this->dy*(1-$ca) - $sa*$this->dx ;
+    }
+
+    function SetAngle($a) {
+	$tmp = $this->a;
+	$this->a = $a;
+	$this->UpdateRotMatrice();
+	return $tmp;
+    }
+
+    function Circle($xc,$yc,$r) {
+	// Circle get's rotated through the Arc() call
+	// made in the parent class
+	parent::Circle($xc,$yc,$r);
+    }
+
+    function FilledCircle($xc,$yc,$r) {
+	// If we use GD1 then Image::FilledCircle will use a 
+	// call to Arc so it will get rotated through the Arc
+	// call.
+	if( $GLOBALS['gd2'] ) {
+	    list($xc,$yc) = $this->Rotate($xc,$yc);
+	}
+	parent::FilledCircle($xc,$yc,$r);
+    }
+	
+    function Arc($xc,$yc,$w,$h,$s,$e) {
+	list($xc,$yc) = $this->Rotate($xc,$yc);
+	$s += $this->a;
+	$e += $this->a;
+	parent::Arc($xc,$yc,$w,$h,$s,$e);
+    }
+
+    function FilledArc($xc,$yc,$w,$h,$s,$e) {
+	list($xc,$yc) = $this->Rotate($xc,$yc);
+	$s += $this->a;
+	$e += $this->a;
+	parent::FilledArc($xc,$yc,$w,$h,$s,$e);
+    }
+
+    function SetMargin($lm,$rm,$tm,$bm) {
+	parent::SetMargin($lm,$rm,$tm,$bm);
+	$this->dx=$this->left_margin+$this->plotwidth/2;
+	$this->dy=$this->top_margin+$this->plotheight/2;
+	$this->UpdateRotMatrice();
+    }
+	
+    function Rotate($x,$y) {
+	// Optimization. Ignore rotation if Angle==0 || ANgle==360
+	if( $this->a == 0 || $this->a == 360 ) {
+	    return array($x + $this->transx, $y + $this->transy );
+	}
+	else {
+	    $x1=round($this->m[0][0]*$x + $this->m[0][1]*$y,1) + $this->m[0][2] + $this->transx;
+	    $y1=round($this->m[1][0]*$x + $this->m[1][1]*$y,1) + $this->m[1][2] + $this->transy;
+	    return array($x1,$y1);
+	}
+    }
+
+    function CopyMerge($fromImg,$toX,$toY,$fromX,$fromY,$toWidth,$toHeight,$fromWidth=-1,$fromHeight=-1,$aMix=100) {
+	list($toX,$toY) = $this->Rotate($toX,$toY);
+	parent::CopyMerge($fromImg,$toX,$toY,$fromX,$fromY,$toWidth,$toHeight,$fromWidth,$fromHeight,$aMix);
+
+    }
+	
+    function ArrRotate($pnts) {
+	$n = count($pnts)-1;
+	for($i=0; $i < $n; $i+=2) {
+	    list ($x,$y) = $this->Rotate($pnts[$i],$pnts[$i+1]);
+	    $pnts[$i] = $x; $pnts[$i+1] = $y;
+	}
+	return $pnts;
+    }
+	
+    function Line($x1,$y1,$x2,$y2) {
+	list($x1,$y1) = $this->Rotate($x1,$y1);
+	list($x2,$y2) = $this->Rotate($x2,$y2);
+	parent::Line($x1,$y1,$x2,$y2);
+    }
+
+    function Rectangle($x1,$y1,$x2,$y2) {
+	// Rectangle uses Line() so it will be rotated through that call
+	parent::Rectangle($x1,$y1,$x2,$y2);
+    }
+	
+    function FilledRectangle($x1,$y1,$x2,$y2) {
+	if( $y1==$y2 || $x1==$x2 )
+	    $this->Line($x1,$y1,$x2,$y2);
+	else 
+	    $this->FilledPolygon(array($x1,$y1,$x2,$y1,$x2,$y2,$x1,$y2));
+    }
+	
+    function Polygon($pnts,$closed=FALSE,$fast=false) {
+	//Polygon uses Line() so it will be rotated through that call
+	parent::Polygon($pnts,$closed,$fast);
+    }
+	
+    function FilledPolygon($pnts) {
+	parent::FilledPolygon($this->ArrRotate($pnts));
+    }
+	
+    function Point($x,$y) {
+	list($xp,$yp) = $this->Rotate($x,$y);
+	parent::Point($xp,$yp);
+    }
+	
+    function StrokeText($x,$y,$txt,$dir=0,$paragraph_align="left",$debug=false) {
+	list($xp,$yp) = $this->Rotate($x,$y);
+	return parent::StrokeText($xp,$yp,$txt,$dir,$paragraph_align,$debug);
+    }
+}
+
+//===================================================
+// CLASS ImgStreamCache
+// Description: Handle caching of graphs to files
+//===================================================
+class ImgStreamCache {
+    var $cache_dir;
+    var $img=null;
+    var $timeout=0; 	// Infinite timeout
+    //---------------
+    // CONSTRUCTOR
+    function ImgStreamCache(&$aImg, $aCacheDir=CACHE_DIR) {
+	$this->img = &$aImg;
+	$this->cache_dir = $aCacheDir;
+    }
+
+//---------------
+// PUBLIC METHODS	
+
+    // Specify a timeout (in minutes) for the file. If the file is older then the
+    // timeout value it will be overwritten with a newer version.
+    // If timeout is set to 0 this is the same as infinite large timeout and if
+    // timeout is set to -1 this is the same as infinite small timeout
+    function SetTimeout($aTimeout) {
+	$this->timeout=$aTimeout;	
+    }
+	
+    // Output image to browser and also write it to the cache
+    function PutAndStream(&$aImage,$aCacheFileName,$aInline,$aStrokeFileName) {
+	// Some debugging code to brand the image with numbe of colors
+	// used
+	GLOBAL $gJpgBrandTiming;
+	
+	if( $gJpgBrandTiming ) {
+	    global $tim;
+	    $t=$tim->Pop()/1000.0;
+	    $c=$aImage->SetColor("black");
+	    $t=sprintf(BRAND_TIME_FORMAT,round($t,3));
+	    imagestring($this->img->img,2,5,$this->img->height-20,$t,$c);			
+	}
+
+	// Check if we should stroke the image to an arbitrary file
+	if( _FORCE_IMGTOFILE ) {
+	    $aStrokeFileName = _FORCE_IMGDIR.GenImgName();
+	}
+
+	if( $aStrokeFileName!="" ) {
+	    if( $aStrokeFileName == "auto" )
+		$aStrokeFileName = GenImgName();
+	    if( file_exists($aStrokeFileName) ) {
+		// Delete the old file
+		if( !@unlink($aStrokeFileName) )
+		    JpGraphError::RaiseL(25111,$aStrokeFileName);//(" Can't delete cached image $aStrokeFileName. Permission problem?");
+	    }
+	    $aImage->Stream($aStrokeFileName);
+	    return;
+	}
+
+	if( $aCacheFileName != "" && USE_CACHE) {
+
+	    $aCacheFileName = $this->cache_dir . $aCacheFileName;
+	    if( file_exists($aCacheFileName) ) {
+		if( !$aInline ) {
+		    // If we are generating image off-line (just writing to the cache)
+		    // and the file exists and is still valid (no timeout)
+		    // then do nothing, just return.
+		    $diff=time()-filemtime($aCacheFileName);
+		    if( $diff < 0 )
+			JpGraphError::RaiseL(25112,$aCacheFileName);//(" Cached imagefile ($aCacheFileName) has file date in the future!!");
+		    if( $this->timeout>0 && ($diff <= $this->timeout*60) ) 
+			return;		
+		}			
+		if( !@unlink($aCacheFileName) )
+		    JpGraphError::RaiseL(25113,$aStrokeFileName);//(" Can't delete cached image $aStrokeFileName. Permission problem?");
+		$aImage->Stream($aCacheFileName);	
+	    }
+	    else {
+		$this->MakeDirs(dirname($aCacheFileName));
+		if( !is_writeable(dirname($aCacheFileName)) ) {
+		    JpGraphError::RaiseL(25114,$aCacheFileName);//('PHP has not enough permissions to write to the cache file '.$aCacheFileName.'. Please make sure that the user running PHP has write permission for this file if you wan to use the cache system with JpGraph.');
+		}
+		$aImage->Stream($aCacheFileName);
+	    }
+			
+	    $res=true;
+	    // Set group to specified
+	    if( CACHE_FILE_GROUP != "" )
+		$res = @chgrp($aCacheFileName,CACHE_FILE_GROUP);
+	    if( CACHE_FILE_MOD != "" )
+		$res = @chmod($aCacheFileName,CACHE_FILE_MOD);
+	    if( !$res )
+		JpGraphError::RaiseL(25115,$aStrokeFileName);//(" Can't set permission for cached image $aStrokeFileName. Permission problem?");
+			
+	    $aImage->Destroy();
+	    if( $aInline ) {
+		if ($fh = @fopen($aCacheFileName, "rb") ) {
+		    $this->img->Headers();
+		    fpassthru($fh);
+		    return;
+		}
+		else
+		    JpGraphError::RaiseL(25116,$aFile);//(" Cant open file from cache [$aFile]"); 
+	    }
+	}
+	elseif( $aInline ) {
+	    $this->img->Headers();	 		
+	    $aImage->Stream();	
+	    return;
+	}
+    }
+	
+    // Check if a given image is in cache and in that case
+    // pass it directly on to web browser. Return false if the
+    // image file doesn't exist or exists but is to old
+    function GetAndStream($aCacheFileName) {
+	$aCacheFileName = $this->cache_dir.$aCacheFileName;		 
+	if ( USE_CACHE && file_exists($aCacheFileName) && $this->timeout>=0 ) {
+	    $diff=time()-filemtime($aCacheFileName);
+	    if( $this->timeout>0 && ($diff > $this->timeout*60) ) {
+		return false;		
+	    }
+	    else {
+		if ($fh = @fopen($aCacheFileName, "rb")) {
+		    $this->img->Headers();
+		    fpassthru($fh);
+		    return true;
+		}
+		else
+		    JpGraphError::RaiseL(25117,$aCacheFileName);//(" Can't open cached image \"$aCacheFileName\" for reading.");
+	    }
+	} 
+	return false;
+    }
+	
+    //---------------
+    // PRIVATE METHODS	
+    // Create all necessary directories in a path
+    function MakeDirs($aFile) {
+	$dirs = array();
+	while ( !(file_exists($aFile)) ) {
+	    $dirs[] = $aFile;
+	    $aFile = dirname($aFile);
+	}
+	for ($i = sizeof($dirs)-1; $i>=0; $i--) {
+	    if(! @mkdir($dirs[$i],0777) )
+		JpGraphError::RaiseL(25118,$aFile);//(" Can't create directory $aFile. Make sure PHP has write permission to this directory.");
+	    // We also specify mode here after we have changed group. 
+	    // This is necessary if Apache user doesn't belong the
+	    // default group and hence can't specify group permission
+	    // in the previous mkdir() call
+	    if( CACHE_FILE_GROUP != "" ) {
+		$res=true;
+		$res =@chgrp($dirs[$i],CACHE_FILE_GROUP);
+		$res &= @chmod($dirs[$i],0777);
+		if( !$res )
+		    JpGraphError::RaiseL(25119,$aFile);//(" Can't set permissions for $aFile. Permission problems?");
+	    }
+	}
+	return true;
+    }	
+} // CLASS Cache
+	
+//===================================================
+// CLASS Legend
+// Description: Responsible for drawing the box containing
+// all the legend text for the graph
+//===================================================
+DEFINE('_DEFAULT_LPM_SIZE',8);
+class Legend {
+    var $color=array(0,0,0); // Default fram color
+    var $fill_color=array(235,235,235); // Default fill color
+    var $shadow=true; // Shadow around legend "box"
+    var $shadow_color='gray';
+    var $txtcol=array();
+    var $mark_abs_hsize=_DEFAULT_LPM_SIZE, $mark_abs_vsize=_DEFAULT_LPM_SIZE;
+    var $xmargin=5,$ymargin=3,$shadow_width=2;
+    var $xlmargin=2, $ylmargin='';
+    var $xpos=0.05, $ypos=0.15, $xabspos=-1, $yabspos=-1;
+	var $halign="right", $valign="top";
+    var $font_family=FF_FONT1,$font_style=FS_NORMAL,$font_size=12;
+    var $font_color='black';
+    var $hide=false,$layout_n=1;
+    var $weight=1,$frameweight=1;
+    var $csimareas='';
+    var $reverse = false ;
+//---------------
+// CONSTRUCTOR
+    function Legend() {
+	// Empty
+    }
+//---------------
+// PUBLIC METHODS	
+    function Hide($aHide=true) {
+	$this->hide=$aHide;
+    }
+	
+    function SetHColMargin($aXMarg) {
+	$this->xmargin = $aXMarg;
+    }
+
+    function SetVColMargin($aSpacing) {
+	$this->ymargin = $aSpacing ;
+    }
+
+    function SetLeftMargin($aXMarg) {
+	$this->xlmargin = $aXMarg;
+    }
+
+    // Synonym
+    function SetLineSpacing($aSpacing) {
+	$this->ymargin = $aSpacing ;
+    }
+
+    function SetShadow($aShow='gray',$aWidth=2) {
+	if( is_string($aShow) ) {
+	    $this->shadow_color = $aShow;
+	    $this->shadow=true;
+	}
+	else
+	    $this->shadow=$aShow;
+	$this->shadow_width=$aWidth;
+    }
+
+    function SetMarkAbsSize($aSize) {
+	$this->mark_abs_vsize = $aSize ;
+	$this->mark_abs_hsize = $aSize ;
+    }
+
+    function SetMarkAbsVSize($aSize) {
+	$this->mark_abs_vsize = $aSize ;
+    }
+
+    function SetMarkAbsHSize($aSize) {
+	$this->mark_abs_hsize = $aSize ;
+    }
+
+    function SetLineWeight($aWeight) {
+	$this->weight = $aWeight;
+    }
+
+    function SetFrameWeight($aWeight) {
+	$this->frameweight = $aWeight;
+    }
+	
+    function SetLayout($aDirection=LEGEND_VERT) {
+	$this->layout_n = $aDirection==LEGEND_VERT ? 1 : 99 ;
+    }
+	
+    function SetColumns($aCols) {
+	$this->layout_n = $aCols ;
+    }
+
+    function SetReverse($f=true) {
+	$this->reverse = $f ;
+    }
+
+    // Set color on frame around box
+    function SetColor($aFontColor,$aColor='black') {
+	$this->font_color=$aFontColor;
+	$this->color=$aColor;
+    }
+	
+    function SetFont($aFamily,$aStyle=FS_NORMAL,$aSize=10) {
+	$this->font_family = $aFamily;
+	$this->font_style = $aStyle;
+	$this->font_size = $aSize;
+    }
+	
+    function SetPos($aX,$aY,$aHAlign="right",$aVAlign="top") {
+	$this->Pos($aX,$aY,$aHAlign,$aVAlign);
+    }
+
+    function SetAbsPos($aX,$aY,$aHAlign="right",$aVAlign="top") {
+	$this->xabspos=$aX;
+	$this->yabspos=$aY;
+	$this->halign=$aHAlign;
+	$this->valign=$aVAlign;
+    }
+
+
+    function Pos($aX,$aY,$aHAlign="right",$aVAlign="top") {
+	if( !($aX<1 && $aY<1) )
+	    JpGraphError::RaiseL(25120);//(" Position for legend must be given as percentage in range 0-1");
+	$this->xpos=$aX;
+	$this->ypos=$aY;
+	$this->halign=$aHAlign;
+	$this->valign=$aVAlign;
+    }
+
+    function SetFillColor($aColor) {
+	$this->fill_color=$aColor;
+    }
+	
+    function Add($aTxt,$aColor,$aPlotmark="",$aLinestyle=0,$csimtarget="",$csimalt="") {
+	$this->txtcol[]=array($aTxt,$aColor,$aPlotmark,$aLinestyle,$csimtarget,$csimalt);
+    }
+
+    function GetCSIMAreas() {
+	return $this->csimareas;
+    }
+	
+    function Stroke(&$aImg) {
+	// Constant
+	$fillBoxFrameWeight=1;
+
+	if( $this->hide ) return;
+
+	$aImg->SetFont($this->font_family,$this->font_style,$this->font_size);		
+
+	if( $this->reverse ) {
+	    $this->txtcol = array_reverse($this->txtcol);
+	}
+
+	$n=count($this->txtcol);
+	if( $n == 0 ) return;
+
+	// Find out the max width and height of each column to be able
+        // to size the legend box.
+	$numcolumns = ($n > $this->layout_n ? $this->layout_n : $n);
+	for( $i=0; $i < $numcolumns; ++$i ) {
+	    $colwidth[$i] = $aImg->GetTextWidth($this->txtcol[$i][0]) +
+		            2*$this->xmargin + 2*$this->mark_abs_hsize;
+	    $colheight[$i] = 0;
+	}
+
+	// Find our maximum height in each row
+	$rows = 0 ; $rowheight[0] = 0;
+	for( $i=0; $i < $n; ++$i ) {
+	    $h = max($this->mark_abs_vsize,$aImg->GetTextHeight($this->txtcol[$i][0]))+$this->ymargin;
+	    if( $i % $numcolumns == 0 ) {
+		$rows++;
+		$rowheight[$rows-1] = 0;
+	    }
+	    $rowheight[$rows-1] = max($rowheight[$rows-1],$h);
+	}
+
+	$abs_height = 0;
+	for( $i=0; $i < $rows; ++$i ) {
+	    $abs_height += $rowheight[$i] ;
+	}
+
+	// Make sure that the height is at least as high as mark size + ymargin
+	$abs_height = max($abs_height,$this->mark_abs_vsize);
+
+	// We add 3 extra pixels height to compensate for the difficult in
+	// calculating font height
+	$abs_height += $this->ymargin+3; 
+						
+	// Find out the maximum width in each column
+	for( $i=$numcolumns; $i < $n; ++$i ) {
+	    $colwidth[$i % $numcolumns] = max(
+		$aImg->GetTextWidth($this->txtcol[$i][0])+2*$this->xmargin+2*$this->mark_abs_hsize,$colwidth[$i % $numcolumns]);
+	}
+
+	// Get the total width
+	$mtw = 0;
+	for( $i=0; $i < $numcolumns; ++$i ) {
+	    $mtw += $colwidth[$i] ;
+	}
+
+	// Find out maximum width we need for legend box
+	$abs_width = $mtw+$this->xlmargin;
+
+	if( $this->xabspos === -1  && $this->yabspos === -1 ) {
+	    $this->xabspos = $this->xpos*$aImg->width ;
+	    $this->yabspos = $this->ypos*$aImg->height ;
+	}
+
+	// Positioning of the legend box
+	if( $this->halign=="left" )
+	    $xp = $this->xabspos; 
+	elseif( $this->halign=="center" )
+	    $xp = $this->xabspos - $abs_width/2; 
+	else  
+	    $xp = $aImg->width - $this->xabspos - $abs_width;
+
+	$yp=$this->yabspos;
+	if( $this->valign=="center" )
+	    $yp-=$abs_height/2;
+	elseif( $this->valign=="bottom" )
+	    $yp-=$abs_height;
+			
+	// Stroke legend box
+	$aImg->SetColor($this->color);	
+	$aImg->SetLineWeight($this->frameweight);
+	$aImg->SetLineStyle('solid');
+
+	if( $this->shadow )
+	    $aImg->ShadowRectangle($xp,$yp,$xp+$abs_width+$this->shadow_width,
+				   $yp+$abs_height+$this->shadow_width,
+				   $this->fill_color,$this->shadow_width,$this->shadow_color);
+	else {
+	    $aImg->SetColor($this->fill_color);				
+	    $aImg->FilledRectangle($xp,$yp,$xp+$abs_width,$yp+$abs_height);
+	    $aImg->SetColor($this->color);							
+	    $aImg->Rectangle($xp,$yp,$xp+$abs_width,$yp+$abs_height);
+	}
+
+	// x1,y1 is the position for the legend mark
+	$x1=$xp+$this->mark_abs_hsize+$this->xlmargin;
+	$y1=$yp + $this->ymargin;		
+	
+	$f2 =  round($aImg->GetTextHeight('X')/2);
+
+	$grad = new Gradient($aImg);
+	$patternFactory = null;
+
+	// Now stroke each legend in turn
+	// Each plot has added the following information to  the legend
+	// p[0] = Legend text
+	// p[1] = Color, 
+	// p[2] = For markers a reference to the PlotMark object
+	// p[3] = For lines the line style, for gradient the negative gradient style
+	// p[4] = CSIM target
+	// p[5] = CSIM Alt text
+	$i = 1 ; $row = 0;
+	foreach($this->txtcol as $p) {
+	 
+	    // STROKE DEBUG BOX
+	    if( _JPG_DEBUG ) {
+	        $aImg->SetLineWeight(1);
+	        $aImg->SetColor('red');
+	        $aImg->SetLineStyle('solid');
+	        $aImg->Rectangle($xp,$y1,$xp+$abs_width,$y1+$rowheight[$row]);
+	    }
+
+	    $aImg->SetLineWeight($this->weight);
+	    $x1 = round($x1); $y1=round($y1);
+	    if ( $p[2] != "" && $p[2]->GetType() > -1 ) {
+		// Make a plot mark legend
+		$aImg->SetColor($p[1]);
+		if( is_string($p[3]) || $p[3]>0 ) {
+		    $aImg->SetLineStyle($p[3]);
+		    $aImg->StyleLine($x1-$this->mark_abs_hsize,$y1+$f2,$x1+$this->mark_abs_hsize,$y1+$f2);
+		}
+		// Stroke a mark with the standard size
+		// (As long as it is not an image mark )
+		if( $p[2]->GetType() != MARK_IMG ) {
+		    $p[2]->iFormatCallback = '';
+
+		    // Since size for circles is specified as the radius
+		    // this means that we must half the size to make the total
+		    // width behave as the other marks
+		    if( $p[2]->GetType() == MARK_FILLEDCIRCLE || $p[2]->GetType() == MARK_CIRCLE ) {
+		        $p[2]->SetSize(min($this->mark_abs_vsize,$this->mark_abs_hsize)/2);
+			$p[2]->Stroke($aImg,$x1,$y1+$f2);
+		    }
+		    else {
+		        $p[2]->SetSize(min($this->mark_abs_vsize,$this->mark_abs_hsize));
+			$p[2]->Stroke($aImg,$x1,$y1+$f2);
+		    }
+		}
+	    } 
+	    elseif ( $p[2] != "" && (is_string($p[3]) || $p[3]>0 ) ) {
+		// Draw a styled line
+		$aImg->SetColor($p[1]);
+		$aImg->SetLineStyle($p[3]);
+		$aImg->StyleLine($x1-1,$y1+$f2,$x1+$this->mark_abs_hsize,$y1+$f2);
+		$aImg->StyleLine($x1-1,$y1+$f2+1,$x1+$this->mark_abs_hsize,$y1+$f2+1);
+	    } 
+	    else {
+		// Draw a colored box
+		$color = $p[1] ;
+		// We make boxes slightly larger to better show
+		$boxsize = min($this->mark_abs_vsize,$this->mark_abs_hsize) + 2 ;
+		$ym =  round($y1 + $f2 - $boxsize/2);
+		// We either need to plot a gradient or a 
+		// pattern. To differentiate we use a kludge.
+		// Patterns have a p[3] value of < -100
+		if( $p[3] < -100 ) { 
+		    // p[1][0] == iPattern, p[1][1] == iPatternColor, p[1][2] == iPatternDensity
+		    if( $patternFactory == null ) {
+			$patternFactory = new RectPatternFactory();
+		    }
+		    $prect = $patternFactory->Create($p[1][0],$p[1][1],1);
+		    $prect->SetBackground($p[1][3]);
+		    $prect->SetDensity($p[1][2]+1);
+		    $prect->SetPos(new Rectangle($x1,$ym,$boxsize,$boxsize));
+		    $prect->Stroke($aImg);
+		    $prect=null;
+		}
+		else {
+		    if( is_array($color) && count($color)==2 ) {
+			// The client want a gradient color
+			$grad->FilledRectangle($x1,$ym,
+					       $x1+$boxsize,$ym+$boxsize,
+					       $color[0],$color[1],-$p[3]);
+		    }
+		    else {
+			$aImg->SetColor($p[1]);
+			$aImg->FilledRectangle($x1,$ym,$x1+$boxsize,$ym+$boxsize);
+		    }
+		    $aImg->SetColor($this->color);
+		    $aImg->SetLineWeight($fillBoxFrameWeight);
+		    $aImg->Rectangle($x1,$ym,$x1+$boxsize,$ym+$boxsize);
+		}
+	    }
+	    $aImg->SetColor($this->font_color);
+	    $aImg->SetFont($this->font_family,$this->font_style,$this->font_size);		
+	    $aImg->SetTextAlign("left","top");			
+	    $aImg->StrokeText(round($x1+$this->mark_abs_hsize+$this->xmargin),$y1,$p[0]);
+
+	    // Add CSIM for Legend if defined
+	    if( $p[4] != "" ) {
+		$xe = $x1 + $this->xmargin+$this->mark_abs_hsize+$aImg->GetTextWidth($p[0]);
+		$ye = $y1 + max($this->mark_abs_vsize,$aImg->GetTextHeight($p[0]));
+		$coords = "$x1,$y1,$xe,$y1,$xe,$ye,$x1,$ye";
+		if( ! empty($p[4]) ) {
+		    $this->csimareas .= "<area shape=\"poly\" coords=\"$coords\" href=\"".$p[4]."\" target=\"main\"";
+		    if( !empty($p[5]) ) {
+			$tmp=sprintf($p[5],$p[0]);
+			$this->csimareas .= " title=\"$tmp\"";
+		    }
+		    $this->csimareas .= " alt=\"\" />\n";
+		}
+	    }
+	    if( $i >= $this->layout_n ) {
+		$x1 = $xp+$this->mark_abs_hsize+$this->xlmargin;
+		$y1 += $rowheight[$row++];
+		$i = 1;
+	    }
+	    else {
+		$x1 += $colwidth[($i-1) % $numcolumns] ;
+		++$i;
+	    }
+	}
+    }
+} // Class
+	
+
+//===================================================
+// CLASS DisplayValue
+// Description: Used to print data values at data points
+//===================================================
+class DisplayValue {
+    var $show=false,$format="%.1f",$negformat="";
+    var $iFormCallback='';
+    var $angle=0;
+    var $ff=FF_FONT1,$fs=FS_NORMAL,$fsize=10;
+    var $color="navy",$negcolor="";
+    var $margin=5,$valign="",$halign="center";
+    var $iHideZero=false;
+
+    function Show($aFlag=true) {
+	$this->show=$aFlag;
+    }
+
+    function SetColor($aColor,$aNegcolor="") {
+	$this->color = $aColor;
+	$this->negcolor = $aNegcolor;
+    }
+
+    function SetFont($aFontFamily,$aFontStyle=FS_NORMAL,$aFontSize=10) {
+	$this->ff=$aFontFamily;
+	$this->fs=$aFontStyle;
+	$this->fsize=$aFontSize;
+    }
+
+    function SetMargin($aMargin) {
+	$this->margin = $aMargin;
+    }
+
+    function SetAngle($aAngle) {
+	$this->angle = $aAngle;
+    }
+
+    function SetAlign($aHAlign,$aVAlign='') {
+	$this->halign = $aHAlign;
+	$this->valign = $aVAlign;
+    }
+
+    function SetFormat($aFormat,$aNegFormat="") {
+	$this->format= $aFormat;
+	$this->negformat= $aNegFormat;
+    }
+
+    function SetFormatCallback($aFunc) {
+	$this->iFormCallback = $aFunc;
+    }
+
+    function HideZero($aFlag=true) {
+	$this->iHideZero=$aFlag;
+    }
+
+    function Stroke($img,$aVal,$x,$y) {
+	
+	if( $this->show ) 
+	{
+	    if( $this->negformat=="" ) $this->negformat=$this->format;
+	    if( $this->negcolor=="" ) $this->negcolor=$this->color;
+
+	    if( $aVal===NULL || (is_string($aVal) && ($aVal=="" || $aVal=="-" || $aVal=="x" ) ) ) 
+		return;
+
+	    if( is_numeric($aVal) && $aVal==0 && $this->iHideZero ) {
+		return;
+	    }
+
+	    // Since the value is used in different cirumstances we need to check what
+	    // kind of formatting we shall use. For example, to display values in a line
+	    // graph we simply display the formatted value, but in the case where the user
+	    // has already specified a text string we don't fo anything.
+	    if( $this->iFormCallback != '' ) {
+		$f = $this->iFormCallback;
+		$sval = call_user_func($f,$aVal);
+	    }
+	    elseif( is_numeric($aVal) ) {
+		if( $aVal >= 0 )
+		    $sval=sprintf($this->format,$aVal);
+		else
+		    $sval=sprintf($this->negformat,$aVal);
+	    }
+	    else
+		$sval=$aVal;
+
+	    $y = $y-sign($aVal)*$this->margin;
+
+	    $txt = new Text($sval,$x,$y);
+	    $txt->SetFont($this->ff,$this->fs,$this->fsize);
+	    if( $this->valign == "" ) {
+		if( $aVal >= 0 )
+		    $valign = "bottom";
+		else
+		    $valign = "top";
+	    }
+	    else
+		$valign = $this->valign;
+	    $txt->Align($this->halign,$valign);
+
+	    $txt->SetOrientation($this->angle);
+	    if( $aVal > 0 )
+		$txt->SetColor($this->color);
+	    else
+		$txt->SetColor($this->negcolor);
+	    $txt->Stroke($img);
+	}
+    }
+}
+
+//===================================================
+// CLASS Plot
+// Description: Abstract base class for all concrete plot classes
+//===================================================
+class Plot {
+    var $line_weight=1;
+    var $coords=array();
+    var $legend='',$hidelegend=false;
+    var $csimtargets=array();	// Array of targets for CSIM
+    var $csimareas="";			// Resultant CSIM area tags	
+    var $csimalts=null;			// ALT:s for corresponding target
+    var $color="black";
+    var $numpoints=0;
+    var $weight=1;	
+    var $value;
+    var $center=false;
+    var $legendcsimtarget='';
+    var $legendcsimalt='';
+//---------------
+// CONSTRUCTOR
+    function Plot(&$aDatay,$aDatax=false) {
+	$this->numpoints = count($aDatay);
+	if( $this->numpoints==0 )
+	    JpGraphError::RaiseL(25121);//("Empty input data array specified for plot. Must have at least one data point.");
+	$this->coords[0]=$aDatay;
+	if( is_array($aDatax) )
+	    $this->coords[1]=$aDatax;
+	$this->value = new DisplayValue();
+    }
+
+//---------------
+// PUBLIC METHODS	
+
+    // Stroke the plot
+    // "virtual" function which must be implemented by
+    // the subclasses
+    function Stroke(&$aImg,&$aXScale,&$aYScale) {
+	JpGraphError::RaiseL(25122);//("JpGraph: Stroke() must be implemented by concrete subclass to class Plot");
+    }
+
+    function HideLegend($f=true) {
+	$this->hidelegend = $f;
+    }
+
+    function DoLegend(&$graph) {
+	if( !$this->hidelegend )
+	    $this->Legend($graph);
+    }
+
+    function StrokeDataValue($img,$aVal,$x,$y) {
+	$this->value->Stroke($img,$aVal,$x,$y);
+    }
+	
+    // Set href targets for CSIM	
+    function SetCSIMTargets($aTargets,$aAlts=null) {
+	$this->csimtargets=$aTargets;
+	$this->csimalts=$aAlts;		
+    }
+ 	
+    // Get all created areas
+    function GetCSIMareas() {
+	return $this->csimareas;
+    }	
+	
+    // "Virtual" function which gets called before any scale
+    // or axis are stroked used to do any plot specific adjustment
+    function PreStrokeAdjust(&$aGraph) {
+	if( substr($aGraph->axtype,0,4) == "text" && (isset($this->coords[1])) )
+	    JpGraphError::RaiseL(25123);//("JpGraph: You can't use a text X-scale with specified X-coords. Use a \"int\" or \"lin\" scale instead.");
+	return true;	
+    }
+	
+    // Get minimum values in plot
+    function Min() {
+	if( isset($this->coords[1]) )
+	    $x=$this->coords[1];
+	else
+	    $x="";
+	if( $x != "" && count($x) > 0 )
+	    $xm=min($x);
+	else 
+	    $xm=0;
+	$y=$this->coords[0];
+	$cnt = count($y);
+	if( $cnt > 0 ) {
+	    /*
+	    if( ! isset($y[0]) ) {
+		JpGraphError('The input data array must have consecutive values from position 0 and forward. The given y-array starts with empty values (NULL)');
+	    }
+	    */
+	    //$ym = $y[0];
+	    $i=0;
+	    while( $i<$cnt && !is_numeric($ym=$y[$i]) )
+		$i++;
+	    while( $i < $cnt) {
+		if( is_numeric($y[$i]) ) 
+		    $ym=min($ym,$y[$i]);
+		++$i;
+	    }			
+	}
+	else 
+	    $ym="";
+	return array($xm,$ym);
+    }
+	
+    // Get maximum value in plot
+    function Max() {
+	if( isset($this->coords[1]) )
+	    $x=$this->coords[1];
+	else
+	    $x="";
+
+	if( $x!="" && count($x) > 0 )
+	    $xm=max($x);
+	else {
+	    $xm = $this->numpoints-1;
+	}
+	$y=$this->coords[0];
+	if( count($y) > 0 ) {
+	    /*
+	    if( !isset($y[0]) ) {
+		JpGraphError::Raise('The input data array must have consecutive values from position 0 and forward. The given y-array starts with empty values (NULL)');
+		//$y[0] = 0;
+// Change in 1.5.1 Don't treat this as an error any more. Just silently convert to 0
+// Change in 1.17 Treat his as an error again !! This is the right way to do !!
+	    }
+	    */
+	    $cnt = count($y);
+	    $i=0;
+	    while( $i<$cnt && !is_numeric($ym=$y[$i]) )
+		$i++;				
+	    while( $i < $cnt ) {
+		if( is_numeric($y[$i]) ) 
+		    $ym=max($ym,$y[$i]);
+		++$i;
+	    }
+	    
+	}
+	else 
+	    $ym="";
+	return array($xm,$ym);
+    }
+	
+    function SetColor($aColor) {
+	$this->color=$aColor;
+    }
+	
+    function SetLegend($aLegend,$aCSIM="",$aCSIMAlt="") {
+	$this->legend = $aLegend;
+	$this->legendcsimtarget = $aCSIM;
+	$this->legendcsimalt = $aCSIMAlt;
+    }
+
+    function SetWeight($aWeight) {
+	$this->weight=$aWeight;
+    }
+		
+    function SetLineWeight($aWeight=1) {
+	$this->line_weight=$aWeight;
+    }
+	
+    function SetCenter($aCenter=true) {
+	$this->center = $aCenter;
+    }
+	
+    // This method gets called by Graph class to plot anything that should go
+    // into the margin after the margin color has been set.
+    function StrokeMargin(&$aImg) {
+	return true;
+    }
+
+    // Framework function the chance for each plot class to set a legend
+    function Legend(&$aGraph) {
+	if( $this->legend != "" )
+	    $aGraph->legend->Add($this->legend,$this->color,"",0,$this->legendcsimtarget,$this->legendcsimalt);    
+    }
+	
+} // Class
+
+
+//===================================================
+// CLASS PlotLine
+// Description: 
+// Data container class to hold properties for a static
+// line that is drawn directly in the plot area.
+// Usefull to add static borders inside a plot to show
+// for example set-values
+//===================================================
+class PlotLine {
+    var $weight=1;
+    var $color="black";
+    var $direction=-1; 
+    var $scaleposition;
+
+//---------------
+// CONSTRUCTOR
+    function PlotLine($aDir=HORIZONTAL,$aPos=0,$aColor="black",$aWeight=1) {
+	$this->direction = $aDir;
+	$this->color=$aColor;
+	$this->weight=$aWeight;
+	$this->scaleposition=$aPos;
+    }
+	
+//---------------
+// PUBLIC METHODS	
+    function SetPosition($aScalePosition) {
+	$this->scaleposition=$aScalePosition;
+    }
+	
+    function SetDirection($aDir) {
+	$this->direction = $aDir;
+    }
+	
+    function SetColor($aColor) {
+	$this->color=$aColor;
+    }
+	
+    function SetWeight($aWeight) {
+	$this->weight=$aWeight;
+    }
+
+    function PreStrokeAdjust($aGraph) {
+	// Nothing to do
+    }
+	
+    function Stroke(&$aImg,&$aXScale,&$aYScale) {
+	$aImg->SetColor($this->color);
+	$aImg->SetLineWeight($this->weight);		
+	if( $this->direction == VERTICAL ) {
+	    $ymin_abs=$aYScale->Translate($aYScale->GetMinVal());
+	    $ymax_abs=$aYScale->Translate($aYScale->GetMaxVal());
+	    $xpos_abs=$aXScale->Translate($this->scaleposition);
+	    $aImg->Line($xpos_abs, $ymin_abs, $xpos_abs, $ymax_abs);
+	}
+	elseif( $this->direction == HORIZONTAL ) {
+	    $xmin_abs=$aXScale->Translate($aXScale->GetMinVal());
+	    $xmax_abs=$aXScale->Translate($aXScale->GetMaxVal());
+	    $ypos_abs=$aYScale->Translate($this->scaleposition);
+	    $aImg->Line($xmin_abs, $ypos_abs, $xmax_abs, $ypos_abs);
+	}
+	else
+	    JpGraphError::RaiseL(25125);//(" Illegal direction for static line");
+    }
+}
+
+// <EOF>
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_pie3d.php php-syslog-ng/html/includes/jpgraph/jpgraph_pie3d.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_pie3d.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_pie3d.php	2006-03-15 18:55:46.000000000 -0500
@@ -0,0 +1,912 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_PIE3D.PHP
+// Description: 3D Pie plot extension for JpGraph
+// Created: 	2001-03-24
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_pie3d.php 459 2006-02-04 12:05:30Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+//===================================================
+// CLASS PiePlot3D
+// Description: Plots a 3D pie with a specified projection 
+// angle between 20 and 70 degrees.
+//===================================================
+class PiePlot3D extends PiePlot {
+    var $labelhintcolor="red",$showlabelhint=true;
+    var $angle=50;	
+    var $edgecolor="", $edgeweight=1;
+    var $iThickness=false;
+	
+//---------------
+// CONSTRUCTOR
+    function PiePlot3d(&$data) {
+	$this->radius = 0.5;
+	$this->data = $data;
+	$this->title = new Text("");
+	$this->title->SetFont(FF_FONT1,FS_BOLD);
+	$this->value = new DisplayValue();
+	$this->value->Show();
+	$this->value->SetFormat('%.0f%%');
+    }
+
+//---------------
+// PUBLIC METHODS	
+	
+    // Set label arrays
+    function SetLegends($aLegend) {
+	$this->legends = array_reverse(array_slice($aLegend,0,count($this->data)));
+    }
+
+    function SetSliceColors($aColors) {
+	$this->setslicecolors = $aColors;
+    }
+
+    function Legend(&$aGraph) {
+	parent::Legend($aGraph);
+	$aGraph->legend->txtcol = array_reverse($aGraph->legend->txtcol);
+    }
+
+    function SetCSIMTargets($targets,$alts=null) {
+	$this->csimtargets = $targets;
+	$this->csimalts = $alts;
+    }
+
+    // Should the slices be separated by a line? If color is specified as "" no line
+    // will be used to separate pie slices.
+    function SetEdge($aColor='black',$aWeight=1) {
+	$this->edgecolor = $aColor;
+	$this->edgeweight = $aWeight;
+    }
+
+    // Dummy function to make Pie3D behave in a similair way to 2D
+    function ShowBorder($exterior=true,$interior=true) {
+	JpGraphError::RaiseL(14001);
+//('Pie3D::ShowBorder() . Deprecated function. Use Pie3D::SetEdge() to control the edges around slices.');
+    }
+
+    // Specify projection angle for 3D in degrees
+    // Must be between 20 and 70 degrees
+    function SetAngle($a) {
+	if( $a<5 || $a>90 )
+	    JpGraphError::RaiseL(14002);
+//("PiePlot3D::SetAngle() 3D Pie projection angle must be between 5 and 85 degrees.");
+	else
+	    $this->angle = $a;
+    }
+
+    function AddSliceToCSIM($i,$xc,$yc,$height,$width,$thick,$sa,$ea) {  //Slice number, ellipse centre (x,y), height, width, start angle, end angle
+
+	$sa *= M_PI/180;
+	$ea *= M_PI/180;
+
+	//add coordinates of the centre to the map
+	$coords = "$xc, $yc";
+
+	//add coordinates of the first point on the arc to the map
+	$xp = floor($width*cos($sa)/2+$xc);
+	$yp = floor($yc-$height*sin($sa)/2);
+	$coords.= ", $xp, $yp";
+
+	//If on the front half, add the thickness offset
+	if ($sa >= M_PI && $sa <= 2*M_PI*1.01) {
+	    $yp = floor($yp+$thick);
+	    $coords.= ", $xp, $yp";
+	}
+		
+	//add coordinates every 0.2 radians
+	$a=$sa+0.2;
+	while ($a<$ea) {
+	    $xp = floor($width*cos($a)/2+$xc);
+	    if ($a >= M_PI && $a <= 2*M_PI*1.01) {
+		$yp = floor($yc-($height*sin($a)/2)+$thick);
+	    } else {
+		$yp = floor($yc-$height*sin($a)/2);
+	    }
+	    $coords.= ", $xp, $yp";
+	    $a += 0.2;
+	}
+		
+	//Add the last point on the arc
+	$xp = floor($width*cos($ea)/2+$xc);
+	$yp = floor($yc-$height*sin($ea)/2);
+
+
+	if ($ea >= M_PI && $ea <= 2*M_PI*1.01) {
+	    $coords.= ", $xp, ".floor($yp+$thick);
+	}
+	$coords.= ", $xp, $yp";
+	$alt='';
+	if( !empty($this->csimalts[$i]) ) {										
+	    $tmp=sprintf($this->csimalts[$i],$this->data[$i]);
+	    $alt="alt=\"$tmp\" title=\"$tmp\"";
+	}
+	if( !empty($this->csimtargets[$i]) )
+	    $this->csimareas .= "<area shape=\"poly\" coords=\"$coords\" href=\"".$this->csimtargets[$i]."\" $alt target=\"main\"/>\n";
+    }
+
+    function SetLabels($aLabels,$aLblPosAdj="auto") {
+	$this->labels = $aLabels;
+	$this->ilabelposadj=$aLblPosAdj;
+    }
+
+	
+    // Distance from the pie to the labels
+    function SetLabelMargin($m) {
+	$this->value->SetMargin($m);
+    }
+	
+    // Show a thin line from the pie to the label for a specific slice
+    function ShowLabelHint($f=true) {
+	$this->showlabelhint=$f;
+    }
+	
+    // Set color of hint line to label for each slice
+    function SetLabelHintColor($c) {
+	$this->labelhintcolor=$c;
+    }
+
+    function SetHeight($aHeight) {
+      $this->iThickness = $aHeight;
+    }
+
+
+// Normalize Angle between 0-360
+    function NormAngle($a) {
+	// Normalize anle to 0 to 2M_PI
+	// 
+	if( $a > 0 ) {
+	    while($a > 360) $a -= 360;
+	}
+	else {
+	    while($a < 0) $a += 360;
+	}
+	if( $a < 0 )
+	    $a = 360 + $a;
+
+	if( $a == 360 ) $a=0;
+	return $a;
+    }
+
+    
+
+// Draw one 3D pie slice at position ($xc,$yc) with height $z
+    function Pie3DSlice($img,$xc,$yc,$w,$h,$sa,$ea,$z,$fillcolor,$shadow=0.65) {
+	
+	// Due to the way the 3D Pie algorithm works we are
+	// guaranteed that any slice we get into this method
+	// belongs to either the left or right side of the
+	// pie ellipse. Hence, no slice will cross 90 or 270
+	// point.
+	if( ($sa < 90 && $ea > 90) || ( ($sa > 90 && $sa < 270) && $ea > 270) ) {
+	    JpGraphError::RaiseL(14003);//('Internal assertion failed. Pie3D::Pie3DSlice');
+	    exit(1);
+	}
+
+	$p[] = array();
+
+	// Setup pre-calculated values
+	$rsa = $sa/180*M_PI;	// to Rad
+	$rea = $ea/180*M_PI;	// to Rad
+	$sinsa = sin($rsa);
+	$cossa = cos($rsa);
+	$sinea = sin($rea);
+	$cosea = cos($rea);
+
+	// p[] is the points for the overall slice and
+	// pt[] is the points for the top pie
+
+	// Angular step when approximating the arc with a polygon train.
+	$step = 0.05;
+
+	if( $sa >= 270 ) {
+	    if( $ea > 360 || ($ea > 0 && $ea <= 90) ) {
+		if( $ea > 0 && $ea <= 90 ) {
+		    // Adjust angle to simplify conditions in loops
+		    $rea += 2*M_PI;
+		}
+
+		$p = array($xc,$yc,$xc,$yc+$z,
+			   $xc+$w*$cossa,$z+$yc-$h*$sinsa);
+		$pt = array($xc,$yc,$xc+$w*$cossa,$yc-$h*$sinsa);
+
+		for( $a=$rsa; $a < 2*M_PI; $a += $step ) {
+		    $tca = cos($a);
+		    $tsa = sin($a);
+		    $p[] = $xc+$w*$tca;
+		    $p[] = $z+$yc-$h*$tsa;
+		    $pt[] = $xc+$w*$tca;
+		    $pt[] = $yc-$h*$tsa;
+		}
+
+		$pt[] = $xc+$w;
+		$pt[] = $yc;
+
+		$p[] = $xc+$w;
+		$p[] = $z+$yc;
+		$p[] = $xc+$w;
+		$p[] = $yc;
+		$p[] = $xc;
+		$p[] = $yc;
+
+		for( $a=2*M_PI+$step; $a < $rea; $a += $step ) {
+		    $pt[] = $xc + $w*cos($a);
+		    $pt[] = $yc - $h*sin($a);
+		}
+		    
+		$pt[] = $xc+$w*$cosea;
+		$pt[] = $yc-$h*$sinea;
+		$pt[] = $xc;
+		$pt[] = $yc;
+
+	    }
+	    else {
+		$p = array($xc,$yc,$xc,$yc+$z,
+			   $xc+$w*$cossa,$z+$yc-$h*$sinsa);
+		$pt = array($xc,$yc,$xc+$w*$cossa,$yc-$h*$sinsa);
+		    
+		$rea = $rea == 0.0 ? 2*M_PI : $rea;
+		for( $a=$rsa; $a < $rea; $a += $step ) {
+		    $tca = cos($a);
+		    $tsa = sin($a);
+		    $p[] = $xc+$w*$tca;
+		    $p[] = $z+$yc-$h*$tsa;
+		    $pt[] = $xc+$w*$tca;
+		    $pt[] = $yc-$h*$tsa;
+		}
+
+		$pt[] = $xc+$w*$cosea;
+		$pt[] = $yc-$h*$sinea;
+		$pt[] = $xc;
+		$pt[] = $yc;
+		    
+		$p[] = $xc+$w*$cosea;
+		$p[] = $z+$yc-$h*$sinea;
+		$p[] = $xc+$w*$cosea;
+		$p[] = $yc-$h*$sinea;
+		$p[] = $xc;
+		$p[] = $yc;
+	    }
+	}
+	elseif( $sa >= 180 ) {
+	    $p = array($xc,$yc,$xc,$yc+$z,$xc+$w*$cosea,$z+$yc-$h*$sinea);
+	    $pt = array($xc,$yc,$xc+$w*$cosea,$yc-$h*$sinea);
+		
+	    for( $a=$rea; $a>$rsa; $a -= $step ) {
+		$tca = cos($a);
+		$tsa = sin($a);
+		$p[] = $xc+$w*$tca;
+		$p[] = $z+$yc-$h*$tsa;
+		$pt[] = $xc+$w*$tca;
+		$pt[] = $yc-$h*$tsa;
+	    }
+
+	    $pt[] = $xc+$w*$cossa;
+	    $pt[] = $yc-$h*$sinsa;
+	    $pt[] = $xc;
+	    $pt[] = $yc;
+		
+	    $p[] = $xc+$w*$cossa;
+	    $p[] = $z+$yc-$h*$sinsa;
+	    $p[] = $xc+$w*$cossa;
+	    $p[] = $yc-$h*$sinsa;
+	    $p[] = $xc;
+	    $p[] = $yc;
+	
+	}
+	elseif( $sa >= 90 ) {
+	    if( $ea > 180 ) {
+		$p = array($xc,$yc,$xc,$yc+$z,$xc+$w*$cosea,$z+$yc-$h*$sinea);
+		$pt = array($xc,$yc,$xc+$w*$cosea,$yc-$h*$sinea);
+
+		for( $a=$rea; $a > M_PI; $a -= $step ) {
+		    $tca = cos($a);
+		    $tsa = sin($a);		    
+		    $p[] = $xc+$w*$tca;
+		    $p[] = $z + $yc - $h*$tsa;
+		    $pt[] = $xc+$w*$tca;
+		    $pt[] = $yc-$h*$tsa;
+		}
+
+		$p[] = $xc-$w;
+		$p[] = $z+$yc;
+		$p[] = $xc-$w;
+		$p[] = $yc;
+		$p[] = $xc;
+		$p[] = $yc;
+
+		$pt[] = $xc-$w;
+		$pt[] = $z+$yc;
+		$pt[] = $xc-$w;
+		$pt[] = $yc;
+
+		for( $a=M_PI-$step; $a > $rsa; $a -= $step ) {
+		    $pt[] = $xc + $w*cos($a);
+		    $pt[] = $yc - $h*sin($a);
+		}
+
+		$pt[] = $xc+$w*$cossa;
+		$pt[] = $yc-$h*$sinsa;
+		$pt[] = $xc;
+		$pt[] = $yc;
+
+	    }
+	    else { // $sa >= 90 && $ea <= 180
+		$p = array($xc,$yc,$xc,$yc+$z,
+			   $xc+$w*$cosea,$z+$yc-$h*$sinea,
+			   $xc+$w*$cosea,$yc-$h*$sinea,
+			   $xc,$yc);
+
+		$pt = array($xc,$yc,$xc+$w*$cosea,$yc-$h*$sinea);
+
+		for( $a=$rea; $a>$rsa; $a -= $step ) {
+		    $pt[] = $xc + $w*cos($a);
+		    $pt[] = $yc - $h*sin($a);
+		}
+
+		$pt[] = $xc+$w*$cossa;
+		$pt[] = $yc-$h*$sinsa;
+		$pt[] = $xc;
+		$pt[] = $yc;
+
+	    }
+	}
+	else { // sa > 0 && ea < 90
+
+	    $p = array($xc,$yc,$xc,$yc+$z,
+		       $xc+$w*$cossa,$z+$yc-$h*$sinsa,
+		       $xc+$w*$cossa,$yc-$h*$sinsa,
+		       $xc,$yc);
+
+	    $pt = array($xc,$yc,$xc+$w*$cossa,$yc-$h*$sinsa);
+
+	    for( $a=$rsa; $a < $rea; $a += $step ) {
+		$pt[] = $xc + $w*cos($a);
+		$pt[] = $yc - $h*sin($a);
+	    }
+
+	    $pt[] = $xc+$w*$cosea;
+	    $pt[] = $yc-$h*$sinea;
+	    $pt[] = $xc;
+	    $pt[] = $yc;
+	}
+	    
+	$img->PushColor($fillcolor.":".$shadow);
+	$img->FilledPolygon($p);
+	$img->PopColor();
+
+	$img->PushColor($fillcolor);
+	$img->FilledPolygon($pt);
+	$img->PopColor();
+    }
+
+    function SetStartAngle($aStart) {
+	if( $aStart < 0 || $aStart > 360 ) {
+	    JpGraphError::RaiseL(14004);//('Slice start angle must be between 0 and 360 degrees.');
+	}
+	$this->startangle = $aStart;
+    }
+    
+// Draw a 3D Pie
+    function Pie3D($aaoption,$img,$data,$colors,$xc,$yc,$d,$angle,$z,
+		   $shadow=0.65,$startangle=0,$edgecolor="",$edgeweight=1) {
+
+	//---------------------------------------------------------------------------
+	// As usual the algorithm get more complicated than I originally
+	// envisioned. I believe that this is as simple as it is possible
+	// to do it with the features I want. It's a good exercise to start
+	// thinking on how to do this to convince your self that all this
+	// is really needed for the general case.
+	//
+	// The algorithm two draw 3D pies without "real 3D" is done in
+	// two steps.
+	// First imagine the pie cut in half through a thought line between
+	// 12'a clock and 6'a clock. It now easy to imagine that we can plot 
+	// the individual slices for each half by starting with the topmost
+	// pie slice and continue down to 6'a clock.
+	// 
+	// In the algortithm this is done in three principal steps
+	// Step 1. Do the knife cut to ensure by splitting slices that extends 
+	// over the cut line. This is done by splitting the original slices into
+	// upto 3 subslices.
+	// Step 2. Find the top slice for each half
+	// Step 3. Draw the slices from top to bottom
+	//
+	// The thing that slightly complicates this scheme with all the
+	// angle comparisons below is that we can have an arbitrary start
+	// angle so we must take into account the different equivalence classes.
+	// For the same reason we must walk through the angle array in a 
+	// modulo fashion.
+	//
+	// Limitations of algorithm: 
+	// * A small exploded slice which crosses the 270 degree point
+	//   will get slightly nagged close to the center due to the fact that
+	//   we print the slices in Z-order and that the slice left part
+	//   get printed first and might get slightly nagged by a larger
+	//   slice on the right side just before the right part of the small
+	//   slice. Not a major problem though. 
+	//---------------------------------------------------------------------------
+
+    
+	// Determine the height of the ellippse which gives an
+	// indication of the inclination angle
+	$h = ($angle/90.0)*$d;
+	$sum = 0;
+	for($i=0; $i<count($data); ++$i ) {
+	    $sum += $data[$i];
+	}
+	
+	// Special optimization
+	if( $sum==0 ) return;
+
+	if( $this->labeltype == 2 ) {
+	    $this->adjusted_data = $this->AdjPercentage($data);
+	}
+
+	// Setup the start
+	$accsum = 0;
+	$a = $startangle;
+	$a = $this->NormAngle($a);
+
+	// 
+	// Step 1 . Split all slices that crosses 90 or 270
+	//
+	$idx=0;
+	$adjexplode=array(); 
+	$numcolors = count($colors);
+	for($i=0; $i<count($data); ++$i, ++$idx ) {
+	    $da = $data[$i]/$sum * 360;
+
+	    if( empty($this->explode_radius[$i]) )
+		$this->explode_radius[$i]=0;
+
+	    $expscale=1;
+	    if( $aaoption == 1 ) 
+		$expscale=2;
+
+	    $la = $a + $da/2;
+	    $explode = array( $xc + $this->explode_radius[$i]*cos($la*M_PI/180)*$expscale,
+		              $yc - $this->explode_radius[$i]*sin($la*M_PI/180) * ($h/$d) *$expscale );
+	    $adjexplode[$idx] = $explode;
+	    $labeldata[$i] = array($la,$explode[0],$explode[1]);
+	    $originalangles[$i] = array($a,$a+$da);
+
+	    $ne = $this->NormAngle($a+$da);
+	    if( $da <= 180 ) {
+		// If the slice size is <= 90 it can at maximum cut across
+		// one boundary (either 90 or 270) where it needs to be split
+		$split=-1; // no split
+		if( ($da<=90 && ($a <= 90 && $ne > 90)) ||
+		    (($da <= 180 && $da >90)  && (($a < 90 || $a >= 270) && $ne > 90)) ) {
+		    $split = 90;
+		}
+		elseif( ($da<=90 && ($a <= 270 && $ne > 270)) ||
+		        (($da<=180 && $da>90) && ($a >= 90 && $a < 270 && ($a+$da) > 270 )) ) {
+		    $split = 270;
+		} 
+		if( $split > 0 ) { // split in two
+		    $angles[$idx] = array($a,$split);
+		    $adjcolors[$idx] = $colors[$i % $numcolors];
+		    $adjexplode[$idx] = $explode;
+		    $angles[++$idx] = array($split,$ne);
+		    $adjcolors[$idx] = $colors[$i % $numcolors];
+		    $adjexplode[$idx] = $explode;
+		}
+		else { // no split
+		    $angles[$idx] = array($a,$ne);
+		    $adjcolors[$idx] = $colors[$i  % $numcolors];
+		    $adjexplode[$idx] = $explode;	
+		}
+	    }
+	    else { 
+		// da>180
+		// Slice may, depending on position, cross one or two
+		// bonudaries
+
+		if( $a < 90 ) 
+		    $split = 90;
+		elseif( $a <= 270 )
+		    $split = 270;
+		else 
+		    $split = 90;
+
+		$angles[$idx] = array($a,$split);
+		$adjcolors[$idx] = $colors[$i % $numcolors];
+		$adjexplode[$idx] = $explode;
+		//if( $a+$da > 360-$split ) { 
+		// For slices larger than 270 degrees we might cross
+		// another boundary as well. This means that we must
+		// split the slice further. The comparison gets a little
+		// bit complicated since we must take into accound that
+		// a pie might have a startangle >0 and hence a slice might
+		// wrap around the 0 angle.
+		// Three cases:
+		//  a) Slice starts before 90 and hence gets a split=90, but 
+		//     we must also check if we need to split at 270
+		//  b) Slice starts after 90 but before 270 and slices
+		//     crosses 90 (after a wrap around of 0)
+		//  c) If start is > 270 (hence the firstr split is at 90)
+		//     and the slice is so large that it goes all the way
+		//     around 270.
+		if( ($a < 90 && ($a+$da > 270)) ||
+		    ($a > 90 && $a<=270 && ($a+$da>360+90) ) ||
+		    ($a > 270 && $this->NormAngle($a+$da)>270) ) { 
+		    $angles[++$idx] = array($split,360-$split);
+		    $adjcolors[$idx] = $colors[$i % $numcolors];
+		    $adjexplode[$idx] = $explode;
+		    $angles[++$idx] = array(360-$split,$ne);
+		    $adjcolors[$idx] = $colors[$i % $numcolors];
+		    $adjexplode[$idx] = $explode;
+		}	
+		else {
+		    // Just a simple split to the previous decided
+		    // angle.
+		    $angles[++$idx] = array($split,$ne);
+		    $adjcolors[$idx] = $colors[$i % $numcolors];
+		    $adjexplode[$idx] = $explode;
+		}
+	    }
+	    $a += $da;
+	    $a = $this->NormAngle($a);
+	}
+
+	// Total number of slices 
+	$n = count($angles);
+
+	for($i=0; $i<$n; ++$i) {
+	    list($dbgs,$dbge) = $angles[$i];
+	}
+
+	// 
+	// Step 2. Find start index (first pie that starts in upper left quadrant)
+	//
+	$minval = $angles[0][0];
+	$min = 0;
+	for( $i=0; $i<$n; ++$i ) {
+	    if( $angles[$i][0] < $minval ) {
+		$minval = $angles[$i][0];
+		$min = $i;
+	    }
+	}
+	$j = $min;
+	$cnt = 0;
+	while( $angles[$j][1] <= 90 ) {
+	    $j++;
+	    if( $j>=$n) {
+		$j=0;
+	    }
+	    if( $cnt > $n ) {
+		JpGraphError::RaiseL(14005);
+//("Pie3D Internal error (#1). Trying to wrap twice when looking for start index");
+	    }
+	    ++$cnt;
+	}
+	$start = $j;
+
+	// 
+	// Step 3. Print slices in z-order
+	//
+	$cnt = 0;
+	
+	// First stroke all the slices between 90 and 270 (left half circle)
+	// counterclockwise
+	    
+	while( $angles[$j][0] < 270  && $aaoption !== 2 ) {
+
+	    list($x,$y) = $adjexplode[$j];
+
+	    $this->Pie3DSlice($img,$x,$y,$d,$h,$angles[$j][0],$angles[$j][1],
+			      $z,$adjcolors[$j],$shadow);
+	
+	    $last = array($x,$y,$j);
+
+	    $j++;
+	    if( $j >= $n ) $j=0;
+	    if( $cnt > $n ) {
+		JpGraphError::RaiseL(14006);
+//("Pie3D Internal Error: Z-Sorting algorithm for 3D Pies is not working properly (2). Trying to wrap twice while stroking.");
+	    }
+	    ++$cnt;
+	}
+     
+	$slice_left = $n-$cnt;
+	$j=$start-1;
+	if($j<0) $j=$n-1;
+	$cnt = 0;
+	
+	// The stroke all slices from 90 to -90 (right half circle)
+	// clockwise
+	while( $cnt < $slice_left  && $aaoption !== 2 ) {
+
+	    list($x,$y) = $adjexplode[$j];
+
+	    $this->Pie3DSlice($img,$x,$y,$d,$h,$angles[$j][0],$angles[$j][1],
+			      $z,$adjcolors[$j],$shadow);
+	    $j--;
+	    if( $cnt > $n ) {
+		JpGraphError::RaiseL(14006);
+//("Pie3D Internal Error: Z-Sorting algorithm for 3D Pies is not working properly (2). Trying to wrap twice while stroking.");
+	    }
+	    if($j<0) $j=$n-1;
+	    $cnt++;
+	}
+	
+	// Now do a special thing. Stroke the last slice on the left
+	// halfcircle one more time.  This is needed in the case where 
+	// the slice close to 270 have been exploded. In that case the
+	// part of the slice close to the center of the pie might be 
+	// slightly nagged.
+	if( $aaoption !== 2 )
+	    $this->Pie3DSlice($img,$last[0],$last[1],$d,$h,$angles[$last[2]][0],
+			      $angles[$last[2]][1],$z,$adjcolors[$last[2]],$shadow);
+
+
+	if( $aaoption !== 1 ) {
+	    // Now print possible labels and add csim
+	    $img->SetFont($this->value->ff,$this->value->fs);
+	    $margin = $img->GetFontHeight()/2 + $this->value->margin ;
+	    for($i=0; $i < count($data); ++$i ) {
+		$la = $labeldata[$i][0];
+		$x = $labeldata[$i][1] + cos($la*M_PI/180)*($d+$margin);
+		$y = $labeldata[$i][2] - sin($la*M_PI/180)*($h+$margin);
+		if( $la > 180 && $la < 360 ) $y += $z;
+		if( $this->labeltype == 0 ) {
+		    if( $sum > 0 )
+			$l = 100*$data[$i]/$sum;
+		    else
+			$l = 0;
+		}
+		elseif( $this->labeltype == 1 ) {
+		    $l = $data[$i];
+		}
+		else {
+		    $l = $this->adjusted_data[$i];
+		}
+		if( isset($this->labels[$i]) && is_string($this->labels[$i]) )
+		    $l=sprintf($this->labels[$i],$l);
+
+		$this->StrokeLabels($l,$img,$labeldata[$i][0]*M_PI/180,$x,$y,$z);
+	    
+		$this->AddSliceToCSIM($i,$labeldata[$i][1],$labeldata[$i][2],$h*2,$d*2,$z,
+				      $originalangles[$i][0],$originalangles[$i][1]);
+	    }	
+	}
+
+	// 
+	// Finally add potential lines in pie
+	//
+
+	if( $edgecolor=="" || $aaoption !== 0 ) return;
+
+	$accsum = 0;
+	$a = $startangle;
+	$a = $this->NormAngle($a);
+
+	$a *= M_PI/180.0;
+
+	$idx=0;
+	$img->PushColor($edgecolor);
+	$img->SetLineWeight($edgeweight);
+	
+	$fulledge = true;
+	for($i=0; $i < count($data) && $fulledge; ++$i ) {
+	    if( empty($this->explode_radius[$i]) )
+		$this->explode_radius[$i]=0;
+	    if( $this->explode_radius[$i] > 0 ) {
+		$fulledge = false;
+	    }
+	}
+	    
+
+	for($i=0; $i < count($data); ++$i, ++$idx ) {
+
+	    $da = $data[$i]/$sum * 2*M_PI;
+	    $this->StrokeFullSliceFrame($img,$xc,$yc,$a,$a+$da,$d,$h,$z,$edgecolor,
+					$this->explode_radius[$i],$fulledge);
+	    $a += $da;
+	}
+	$img->PopColor();
+    }
+
+    function StrokeFullSliceFrame($img,$xc,$yc,$sa,$ea,$w,$h,$z,$edgecolor,$exploderadius,$fulledge) {
+	$step = 0.02;
+
+	if( $exploderadius > 0 ) {
+	    $la = ($sa+$ea)/2;
+	    $xc += $exploderadius*cos($la);
+	    $yc -= $exploderadius*sin($la) * ($h/$w) ;
+	    
+	}
+
+	$p = array($xc,$yc,$xc+$w*cos($sa),$yc-$h*sin($sa));
+
+	for($a=$sa; $a < $ea; $a += $step ) {
+	    $p[] = $xc + $w*cos($a);
+	    $p[] = $yc - $h*sin($a);
+	}
+
+	$p[] = $xc+$w*cos($ea);
+	$p[] = $yc-$h*sin($ea);
+	$p[] = $xc;
+	$p[] = $yc;
+
+	$img->SetColor($edgecolor);
+	$img->Polygon($p);
+
+	// Unfortunately we can't really draw the full edge around the whole of
+	// of the slice if any of the slices are exploded. The reason is that
+	// this algorithm is to simply. There are cases where the edges will
+	// "overwrite" other slices when they have been exploded.
+	// Doing the full, proper 3D hidden lines stiff is actually quite
+	// tricky. So for exploded pies we only draw the top edge. Not perfect
+	// but the "real" solution is much more complicated.
+	if( $fulledge && !( $sa > 0 && $sa < M_PI && $ea < M_PI) ) { 
+
+	    if($sa < M_PI && $ea > M_PI) 
+		$sa = M_PI;
+ 
+	    if($sa < 2*M_PI && (($ea >= 2*M_PI) || ($ea > 0 && $ea < $sa ) ) )
+		$ea = 2*M_PI;
+
+	    if( $sa >= M_PI && $ea <= 2*M_PI ) {
+		$p = array($xc + $w*cos($sa),$yc - $h*sin($sa),
+			   $xc + $w*cos($sa),$z + $yc - $h*sin($sa));
+		
+		for($a=$sa+$step; $a < $ea; $a += $step ) {
+		    $p[] = $xc + $w*cos($a);
+		    $p[] = $z + $yc - $h*sin($a);
+		}
+		$p[] = $xc + $w*cos($ea);
+		$p[] = $z + $yc - $h*sin($ea);
+		$p[] = $xc + $w*cos($ea);
+		$p[] = $yc - $h*sin($ea);
+		$img->SetColor($edgecolor);
+		$img->Polygon($p);	    
+	    }
+	}
+    }
+
+    function Stroke($img,$aaoption=0) {
+	$n = count($this->data);
+
+	// If user hasn't set the colors use the theme array
+   	if( $this->setslicecolors==null ) {
+	    $colors = array_keys($img->rgb->rgb_table);
+	    sort($colors);	
+	    $idx_a=$this->themearr[$this->theme];	
+	    $ca = array();
+	    $m = count($idx_a);
+	    for($i=0; $i < $m; ++$i)
+		$ca[$i] = $colors[$idx_a[$i]];
+	    $ca = array_reverse(array_slice($ca,0,$n));
+	}
+   	else {
+	    $ca = $this->setslicecolors;
+	}
+	
+
+	if( $this->posx <= 1 && $this->posx > 0 )
+	    $xc = round($this->posx*$img->width);
+	else
+	    $xc = $this->posx ;
+	
+	if( $this->posy <= 1 && $this->posy > 0 )
+	    $yc = round($this->posy*$img->height);
+	else
+	    $yc = $this->posy ;
+   			
+	if( $this->radius <= 1 ) {
+	    $width = floor($this->radius*min($img->width,$img->height));
+	    // Make sure that the pie doesn't overflow the image border
+	    // The 0.9 factor is simply an extra margin to leave some space
+	    // between the pie an the border of the image.
+	    $width = min($width,min($xc*0.9,($yc*90/$this->angle-$width/4)*0.9));
+	}
+	else {
+	    $width = $this->radius * ($aaoption === 1 ? 2 : 1 ) ;
+	}
+
+	// Add a sanity check for width
+	if( $width < 1 ) { 
+	    JpGraphError::RaiseL(14007);//("Width for 3D Pie is 0. Specify a size > 0");
+	}
+
+	// Establish a thickness. By default the thickness is a fifth of the
+	// pie slice width (=pie radius) but since the perspective depends
+	// on the inclination angle we use some heuristics to make the edge
+	// slightly thicker the less the angle.
+	
+	// Has user specified an absolute thickness? In that case use
+	// that instead
+
+	if( $this->iThickness ) {
+	  $thick = $this->iThickness;
+	  $thick *= ($aaoption === 1 ? 2 : 1 );
+	}
+	else
+	  $thick = $width/12;
+	$a = $this->angle;
+	if( $a <= 30 ) $thick *= 1.6;
+	elseif( $a <= 40 ) $thick *= 1.4;
+	elseif( $a <= 50 ) $thick *= 1.2;
+	elseif( $a <= 60 ) $thick *= 1.0;
+	elseif( $a <= 70 ) $thick *= 0.8;
+	elseif( $a <= 80 ) $thick *= 0.7;
+	else $thick *= 0.6;
+
+	$thick = floor($thick);
+
+	if( $this->explode_all )
+	    for($i=0; $i < $n; ++$i)
+		$this->explode_radius[$i]=$this->explode_r;
+
+	$this->Pie3D($aaoption,$img,$this->data, $ca, $xc, $yc, $width, $this->angle, 
+	             $thick, 0.65, $this->startangle, $this->edgecolor, $this->edgeweight);
+
+	// Adjust title position
+	if( $aaoption != 1 ) {
+	    $this->title->Pos($xc,$yc-$this->title->GetFontHeight($img)-$width/2-$this->title->margin,			      "center","bottom");
+	    $this->title->Stroke($img);
+	}
+    }
+
+//---------------
+// PRIVATE METHODS	
+
+    // Position the labels of each slice
+    function StrokeLabels($label,$img,$a,$xp,$yp,$z) {
+	$this->value->halign="left";
+	$this->value->valign="top";
+
+	// Position the axis title. 
+	// dx, dy is the offset from the top left corner of the bounding box that sorrounds the text
+	// that intersects with the extension of the corresponding axis. The code looks a little
+	// bit messy but this is really the only way of having a reasonable position of the
+	// axis titles.
+	$img->SetFont($this->value->ff,$this->value->fs,$this->value->fsize);
+	$h=$img->GetTextHeight($label);
+	// For numeric values the format of the display value
+	// must be taken into account
+	if( is_numeric($label) ) {
+	    if( $label >= 0 )
+		$w=$img->GetTextWidth(sprintf($this->value->format,$label));
+	    else
+		$w=$img->GetTextWidth(sprintf($this->value->negformat,$label));
+	}
+	else
+	    $w=$img->GetTextWidth($label);
+	while( $a > 2*M_PI ) $a -= 2*M_PI;
+	if( $a>=7*M_PI/4 || $a <= M_PI/4 ) $dx=0;
+	if( $a>=M_PI/4 && $a <= 3*M_PI/4 ) $dx=($a-M_PI/4)*2/M_PI; 
+	if( $a>=3*M_PI/4 && $a <= 5*M_PI/4 ) $dx=1;
+	if( $a>=5*M_PI/4 && $a <= 7*M_PI/4 ) $dx=(1-($a-M_PI*5/4)*2/M_PI);
+		
+	if( $a>=7*M_PI/4 ) $dy=(($a-M_PI)-3*M_PI/4)*2/M_PI;
+	if( $a<=M_PI/4 ) $dy=(1-$a*2/M_PI);
+	if( $a>=M_PI/4 && $a <= 3*M_PI/4 ) $dy=1;
+	if( $a>=3*M_PI/4 && $a <= 5*M_PI/4 ) $dy=(1-($a-3*M_PI/4)*2/M_PI);
+	if( $a>=5*M_PI/4 && $a <= 7*M_PI/4 ) $dy=0;
+	
+	$x = round($xp-$dx*$w);
+	$y = round($yp-$dy*$h);
+
+	
+        // Mark anchor point for debugging 
+	/*
+	$img->SetColor('red');
+	$img->Line($xp-10,$yp,$xp+10,$yp);
+	$img->Line($xp,$yp-10,$xp,$yp+10);
+	*/
+	$oldmargin = $this->value->margin;
+	$this->value->margin=0;
+	$this->value->Stroke($img,$label,$x,$y);
+	$this->value->margin=$oldmargin;
+
+    }	
+} // Class
+
+/* EOF */
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_pie.php php-syslog-ng/html/includes/jpgraph/jpgraph_pie.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_pie.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_pie.php	2006-02-14 15:10:46.000000000 -0500
@@ -0,0 +1,1341 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_PIE.PHP
+// Description:	Pie plot extension for JpGraph
+// Created: 	2001-02-14
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_pie.php 542 2006-02-14 20:10:46Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+
+// Defines for PiePlot::SetLabelType()
+DEFINE("PIE_VALUE_ABS",1);
+DEFINE("PIE_VALUE_PER",0);
+DEFINE("PIE_VALUE_PERCENTAGE",0);
+DEFINE("PIE_VALUE_ADJPERCENTAGE",2);
+DEFINE("PIE_VALUE_ADJPER",2);
+
+//===================================================
+// CLASS PiePlot
+// Description: Draws a pie plot
+//===================================================
+class PiePlot {
+    var $posx=0.5,$posy=0.5;
+    var $radius=0.3;
+    var $explode_radius=array(),$explode_all=false,$explode_r=20;
+    var $labels=null, $legends=null;
+    var $csimtargets=null;  // Array of targets for CSIM
+    var $csimareas='';		// Generated CSIM text	
+    var $csimalts=null;		// ALT tags for corresponding target
+    var $data=null;
+    var $title;
+    var $startangle=0;
+    var $weight=1, $color="black";
+    var $legend_margin=6,$show_labels=true;
+    var $themearr = array(
+	"earth" 	=> array(136,34,40,45,46,62,63,134,74,10,120,136,141,168,180,77,209,218,346,395,89,430),
+	"pastel" => array(27,415,128,59,66,79,105,110,42,147,152,230,236,240,331,337,405,38),
+	"water"  => array(8,370,24,40,335,56,213,237,268,14,326,387,10,388),
+	"sand"   => array(27,168,34,170,19,50,65,72,131,209,46,393));
+    var $theme="earth";
+    var $setslicecolors=array();
+    var $labeltype=0; // Default to percentage
+    var $pie_border=true,$pie_interior_border=true;
+    var $value;
+    var $ishadowcolor='',$ishadowdrop=4;
+    var $ilabelposadj=1;
+    var $legendcsimtargets = array();
+    var $legendcsimalts = array();
+    var $adjusted_data = array();
+    var $guideline = null,$guidelinemargin=10;
+    var $iShowGuideLineForSingle = false;
+    var $iGuideLineCurve = false,$iGuideVFactor=1.4,$iGuideLineRFactor=0.8;
+//---------------
+// CONSTRUCTOR
+    function PiePlot($data) {
+	$this->data = array_reverse($data);
+	$this->title = new Text("");
+	$this->title->SetFont(FF_FONT1,FS_BOLD);
+	$this->value = new DisplayValue();
+	$this->value->Show();
+	$this->value->SetFormat('%.1f%%');
+	$this->guideline = new LineProperty();
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function SetCenter($x,$y=0.5) {
+	$this->posx = $x;
+	$this->posy = $y;
+    }
+
+    // Enable guideline and set drwaing policy
+    function SetGuideLines($aFlg=true,$aCurved=true,$aAlways=false) {
+	$this->guideline->Show($aFlg);
+	$this->iShowGuideLineForSingle = $aAlways;
+	$this->iGuideLineCurve = $aCurved;
+    }
+
+    // Adjuste the distance between labels and labels and pie
+    function SetGuideLinesAdjust($aVFactor,$aRFactor=0.8) {
+	$this->iGuideVFactor=$aVFactor;
+	$this->iGuideLineRFactor=$aRFactor;
+    }
+
+    function SetColor($aColor) {
+	$this->color = $aColor;
+    }
+	
+    function SetSliceColors($aColors) {
+	$this->setslicecolors = $aColors;
+    }
+	
+    function SetShadow($aColor='darkgray',$aDropWidth=4) {
+	$this->ishadowcolor = $aColor;
+	$this->ishadowdrop = $aDropWidth;
+    }
+
+    function SetCSIMTargets($targets,$alts=null) {
+	$this->csimtargets=array_reverse($targets);
+	if( is_array($alts) )
+	    $this->csimalts=array_reverse($alts);
+    }
+	
+    function GetCSIMareas() {
+	return $this->csimareas;
+    }
+
+    function AddSliceToCSIM($i,$xc,$yc,$radius,$sa,$ea) {  
+
+        //Slice number, ellipse centre (x,y), height, width, start angle, end angle
+	while( $sa > 2*M_PI ) $sa = $sa - 2*M_PI;
+	while( $ea > 2*M_PI ) $ea = $ea - 2*M_PI;
+
+	$sa = 2*M_PI - $sa;
+	$ea = 2*M_PI - $ea;
+
+	// Special case when we have only one slice since then both start and end
+	// angle will be == 0
+	if( abs($sa - $ea) < 0.0001 ) {
+	    $sa=2*M_PI; $ea=0;
+	}
+
+	//add coordinates of the centre to the map
+	$xc = floor($xc);$yc=floor($yc);
+	$coords = "$xc, $yc";
+
+	//add coordinates of the first point on the arc to the map
+	$xp = floor(($radius*cos($ea))+$xc);
+	$yp = floor($yc-$radius*sin($ea));
+	$coords.= ", $xp, $yp";
+	//add coordinates every 0.2 radians
+	$a=$ea+0.2;
+
+	// If we cross the 260-limit with a slice we need to handle
+	// the fact that end angle is smaller than start
+	if( $sa < $ea ) {
+	    while ($a <= 2*M_PI) {
+		$xp = floor($radius*cos($a)+$xc);
+		$yp = floor($yc-$radius*sin($a));
+		$coords.= ", $xp, $yp";
+		$a += 0.2;
+	    }
+	    $a -= 2*M_PI;
+	}
+
+	while ($a < $sa) {
+	    $xp = floor($radius*cos($a)+$xc);
+	    $yp = floor($yc-$radius*sin($a));
+	    $coords.= ", $xp, $yp";
+	    $a += 0.2;
+	}
+		
+	//Add the last point on the arc
+	$xp = floor($radius*cos($sa)+$xc);
+	$yp = floor($yc-$radius*sin($sa));
+	$coords.= ", $xp, $yp";
+	if( !empty($this->csimtargets[$i]) ) {
+	    $this->csimareas .= "<area shape=\"poly\" coords=\"$coords\" href=\"".$this->csimtargets[$i]."\"";
+	    $tmp="";
+	    if( !empty($this->csimalts[$i]) ) {
+		$tmp=sprintf($this->csimalts[$i],$this->data[$i]);
+		$this->csimareas .= " title=\"$tmp\"";
+	    }
+	    $this->csimareas .= " alt=\"$tmp\" />\n";
+	}
+    }
+
+	
+    function SetTheme($aTheme) {
+	if( in_array($aTheme,array_keys($this->themearr)) )
+	    $this->theme = $aTheme;
+	else
+	    JpGraphError::RaiseL(15001,$aTheme);//("PiePLot::SetTheme() Unknown theme: $aTheme");
+    }
+	
+    function ExplodeSlice($e,$radius=20) {
+	if( ! is_integer($e) ) 
+	    JpGraphError::RaiseL(15002);//('Argument to PiePlot::ExplodeSlice() must be an integer');
+	$this->explode_radius[$e]=$radius;
+    }
+
+    function ExplodeAll($radius=20) {
+	$this->explode_all=true;
+	$this->explode_r = $radius;
+    }
+
+    function Explode($aExplodeArr) {
+	if( !is_array($aExplodeArr) ) {
+	    JpGraphError::RaiseL(15003);
+//("Argument to PiePlot::Explode() must be an array with integer distances.");
+	}
+	$this->explode_radius = $aExplodeArr;
+    }
+
+    function SetStartAngle($aStart) {
+	if( $aStart < 0 || $aStart > 360 ) {
+	    JpGraphError::RaiseL(15004);//('Slice start angle must be between 0 and 360 degrees.');
+	}
+	$this->startangle = 360-$aStart;
+	$this->startangle *= M_PI/180;
+    }
+	
+    function SetFont($family,$style=FS_NORMAL,$size=10) {
+	JpGraphError::RaiseL(15005);//('PiePlot::SetFont() is deprecated. Use PiePlot->value->SetFont() instead.');
+    }
+	
+    // Size in percentage
+    function SetSize($aSize) {
+	if( ($aSize>0 && $aSize<=0.5) || ($aSize>10 && $aSize<1000) )
+	    $this->radius = $aSize;
+	else
+	    JpGraphError::RaiseL(15006);
+//("PiePlot::SetSize() Radius for pie must either be specified as a fraction [0, 0.5] of the size of the image or as an absolute size in pixels  in the range [10, 1000]");
+    }
+	
+    function SetFontColor($aColor) {
+	JpGraphError::RaiseL(15007);
+//('PiePlot::SetFontColor() is deprecated. Use PiePlot->value->SetColor() instead.');
+    }
+	
+    // Set label arrays
+    function SetLegends($aLegend) {
+	$this->legends = $aLegend;
+    }
+
+    // Set text labels for slices 
+    function SetLabels($aLabels,$aLblPosAdj="auto") {
+	$this->labels = array_reverse($aLabels);
+	$this->ilabelposadj=$aLblPosAdj;
+    }
+
+    function SetLabelPos($aLblPosAdj) {
+	$this->ilabelposadj=$aLblPosAdj;
+    }
+	
+    // Should we display actual value or percentage?
+    function SetLabelType($t) {
+	if( $t < 0 || $t > 2 ) 
+	    JpGraphError::RaiseL(15008,$t);
+//("PiePlot::SetLabelType() Type for pie plots must be 0 or 1 (not $t).");
+	$this->labeltype=$t;
+    }
+
+    // Deprecated. 
+    function SetValueType($aType) {
+	$this->SetLabelType($aType);
+    }
+
+    // Should the circle around a pie plot be displayed
+    function ShowBorder($exterior=true,$interior=true) {
+	$this->pie_border = $exterior;
+	$this->pie_interior_border = $interior;
+    }
+	
+    // Setup the legends (Framework method)
+    function Legend(&$graph) {
+	$colors = array_keys($graph->img->rgb->rgb_table);
+   	sort($colors);	
+   	$ta=$this->themearr[$this->theme];	
+   	$n = count($this->data);
+
+   	if( $this->setslicecolors==null ) {
+	    $numcolors=count($ta);
+	    if( is_a($this,'PiePlot3D') ) {
+		$ta = array_reverse(array_slice($ta,0,$n));
+	    }
+	}
+   	else {
+	    $this->setslicecolors = array_slice($this->setslicecolors,0,$n);
+	    $numcolors=count($this->setslicecolors); 
+	    if( $graph->pieaa && is_a($this,'PiePlot') ) { 
+		$this->setslicecolors = array_reverse($this->setslicecolors);
+	    }
+	}
+		
+	$sum=0;
+	for($i=0; $i < $n; ++$i)
+	    $sum += $this->data[$i];
+
+	// Bail out with error if the sum is 0
+	if( $sum==0 )
+	    JpGraphError::RaiseL(15009);//("Illegal pie plot. Sum of all data is zero for Pie!");
+
+	// Make sure we don't plot more values than data points
+	// (in case the user added more legends than data points)
+	$n = min(count($this->legends),count($this->data));
+	if( $this->legends != "" ) {
+	    $this->legends = array_reverse(array_slice($this->legends,0,$n));
+	}
+	for( $i=$n-1; $i >= 0; --$i ) {
+	    $l = $this->legends[$i];
+	    // Replace possible format with actual values
+	    if( count($this->csimalts) > $i ) {
+		$fmt = $this->csimalts[$i];
+	    }
+	    else {
+		$fmt = "%d"; // Deafult Alt if no other has been specified
+	    }
+	    if( $this->labeltype==0 ) {
+		$l = sprintf($l,100*$this->data[$i]/$sum);
+		$alt = sprintf($fmt,$this->data[$i]);
+		
+	    }
+	    elseif( $this->labeltype == 1)  {
+		$l = sprintf($l,$this->data[$i]);
+		$alt = sprintf($fmt,$this->data[$i]);
+		
+	    }
+	    else {
+		$l = sprintf($l,$this->adjusted_data[$i]);
+		$alt = sprintf($fmt,$this->adjusted_data[$i]);
+	    }
+
+	    if( $this->setslicecolors==null ) {
+		$graph->legend->Add($l,$colors[$ta[$i%$numcolors]],"",0,$this->csimtargets[$i],$alt);
+	    }
+	    else {
+		$graph->legend->Add($l,$this->setslicecolors[$i%$numcolors],"",0,$this->csimtargets[$i],$alt);
+	    }
+	}
+    }
+	
+    // Adjust the rounded percetage value so that the sum of
+    // of the pie slices are always 100%
+    // Using the Hare/Niemeyer method
+    function AdjPercentage($aData,$aPrec=0) {
+	$mul=100;
+	if( $aPrec > 0 && $aPrec < 3 ) {
+	    if( $aPrec == 1 ) 
+		$mul=1000;
+		else
+		    $mul=10000;
+	}
+	
+	$tmp = array();
+	$result = array();
+	$quote_sum=0;
+	$n = count($aData) ;
+	for( $i=0, $sum=0; $i < $n; ++$i )
+	    $sum+=$aData[$i];
+	foreach($aData as $index => $value) {
+	    $tmp_percentage=$value/$sum*$mul;
+	    $result[$index]=floor($tmp_percentage);
+	    $tmp[$index]=$tmp_percentage-$result[$index];
+	    $quote_sum+=$result[$index];
+	}
+	if( $quote_sum == $mul) {
+	    if( $mul > 100 ) {
+		$tmp = $mul / 100;
+		for( $i=0; $i < $n; ++$i ) {
+		    $result[$i] /= $tmp ;
+		}
+	    }
+	    return $result;
+	}
+	arsort($tmp,SORT_NUMERIC);
+	reset($tmp);
+	for($i=0; $i < $mul-$quote_sum; $i++)
+	{
+	    $result[key($tmp)]++;
+	    next($tmp);
+	}
+	if( $mul > 100 ) {
+	    $tmp = $mul / 100;
+	    for( $i=0; $i < $n; ++$i ) {
+		$result[$i] /= $tmp ;
+	    }
+	}
+	return $result;
+    }
+
+
+    function Stroke(&$img,$aaoption=0) {
+	// aaoption is used to handle antialias
+	// aaoption == 0 a normal pie
+	// aaoption == 1 just the body
+	// aaoption == 2 just the values
+
+	// Explode scaling. If anti anti alias we scale the image
+	// twice and we also need to scale the exploding distance
+	$expscale = $aaoption === 1 ? 2 : 1;
+
+	if( $this->labeltype == 2 ) {
+	    // Adjust the data so that it will add up to 100%
+	    $this->adjusted_data = $this->AdjPercentage($this->data);
+	}
+
+	$colors = array_keys($img->rgb->rgb_table);
+   	sort($colors);	
+   	$ta=$this->themearr[$this->theme];	
+	$n = count($this->data);
+   	
+   	if( $this->setslicecolors==null ) {
+	    $numcolors=count($ta);
+	}
+   	else {
+	    $this->setslicecolors = array_reverse(array_slice($this->setslicecolors,0,$n));
+	    $numcolors=count($this->setslicecolors); 
+	    $tt = array_slice($this->setslicecolors,$n % $numcolors);
+	    $tt2 = array_slice($this->setslicecolors,0,$n % $numcolors);
+	    $tt2 = array_merge($tt, $tt2);
+	    $this->setslicecolors = $tt + $tt2;
+	}
+
+	// Draw the slices
+	$sum=0;
+	for($i=0; $i < $n; ++$i)
+	    $sum += $this->data[$i];
+	
+	// Bail out with error if the sum is 0
+	if( $sum==0 )
+	    JpGraphError::RaiseL(15009);//("Sum of all data is 0 for Pie.");
+	
+	// Set up the pie-circle
+	if( $this->radius <= 1 )
+	    $radius = floor($this->radius*min($img->width,$img->height));
+	else {
+	    $radius = $aaoption === 1 ? $this->radius*2 : $this->radius;
+	}
+
+	if( $this->posx <= 1 && $this->posx > 0 )
+	    $xc = round($this->posx*$img->width);
+	else
+	    $xc = $this->posx ;
+	
+	if( $this->posy <= 1 && $this->posy > 0 )
+	    $yc = round($this->posy*$img->height);
+	else
+	    $yc = $this->posy ;
+		
+	$n = count($this->data);
+
+	if( $this->explode_all )
+	    for($i=0; $i < $n; ++$i)
+		$this->explode_radius[$i]=$this->explode_r;
+
+	if( $this->ishadowcolor != "" && $aaoption !== 2) {
+	    $accsum=0;
+	    $angle2 = $this->startangle;
+	    $img->SetColor($this->ishadowcolor);
+	    for($i=0; $sum > 0 && $i < $n; ++$i) {
+		$j = $n-$i-1;
+		$d = $this->data[$i];
+		$angle1 = $angle2;
+		$accsum += $d;
+		$angle2 = $this->startangle+2*M_PI*$accsum/$sum;
+		if( empty($this->explode_radius[$j]) )
+		    $this->explode_radius[$j]=0;
+
+		$la = 2*M_PI - (abs($angle2-$angle1)/2.0+$angle1);
+
+		$xcm = $xc + $this->explode_radius[$j]*cos($la)*$expscale;
+		$ycm = $yc - $this->explode_radius[$j]*sin($la)*$expscale;
+		
+		$xcm += $this->ishadowdrop*$expscale;
+		$ycm += $this->ishadowdrop*$expscale;
+
+		$img->CakeSlice($xcm,$ycm,$radius,$radius,
+				$angle1*180/M_PI,$angle2*180/M_PI,$this->ishadowcolor);
+		
+	    }
+	}
+
+	$accsum=0;
+	$angle2 = $this->startangle;
+	$img->SetColor($this->color);
+	for($i=0; $sum>0 && $i < $n; ++$i) {
+	    $j = $n-$i-1;
+	    if( empty($this->explode_radius[$j]) )
+		$this->explode_radius[$j]=0;
+	    $d = $this->data[$i];
+	    $angle1 = $angle2;
+	    $accsum += $d;
+	    $angle2 = $this->startangle+2*M_PI*$accsum/$sum;
+	    $this->la[$i] = 2*M_PI - (abs($angle2-$angle1)/2.0+$angle1);
+
+	    if( $d == 0 ) continue;
+
+	    if( $this->setslicecolors==null )
+		$slicecolor=$colors[$ta[$i%$numcolors]];
+	    else
+		$slicecolor=$this->setslicecolors[$i%$numcolors];
+
+	    if( $this->pie_interior_border && $aaoption===0 )
+		$img->SetColor($this->color);
+	    else
+		$img->SetColor($slicecolor);
+
+	    $arccolor = $this->pie_border && $aaoption===0 ? $this->color : "";
+
+	    $xcm = $xc + $this->explode_radius[$j]*cos($this->la[$i])*$expscale;
+	    $ycm = $yc - $this->explode_radius[$j]*sin($this->la[$i])*$expscale;
+
+	    if( $aaoption !== 2 ) {
+		$img->CakeSlice($xcm,$ycm,$radius-1,$radius-1,
+				$angle1*180/M_PI,$angle2*180/M_PI,$slicecolor,$arccolor);
+	    }
+
+	    if( $this->csimtargets && $aaoption !== 1 ) {
+		$this->AddSliceToCSIM($i,$xcm,$ycm,$radius,$angle1,$angle2);
+	    }
+	}
+
+	// Format the titles for each slice
+	if( $aaoption!==2) {
+	    for( $i=0; $i < $n; ++$i) {
+		if( $this->labeltype==0 ) {
+		    if( $sum != 0 )
+			$l = 100.0*$this->data[$i]/$sum;
+		    else
+			$l = 0.0;
+		}
+		elseif( $this->labeltype==1 ) {
+		    $l = $this->data[$i]*1.0;
+		}
+		else {
+		    $l = $this->adjusted_data[$i];
+		}
+		if( isset($this->labels[$i]) && is_string($this->labels[$i]) )
+		    $this->labels[$i]=sprintf($this->labels[$i],$l);
+		else
+		    $this->labels[$i]=$l;
+	    }
+	}
+
+	If( $this->value->show && $aaoption !== 1 ) {
+	    $this->StrokeAllLabels($img,$xc,$yc,$radius);
+	}
+
+	// Adjust title position
+	if( $aaoption !== 1 ) {
+	    $this->title->Pos($xc,
+			  $yc-$this->title->GetFontHeight($img)-$radius-$this->title->margin,
+			  "center","bottom");
+	    $this->title->Stroke($img);
+	}
+
+    }
+
+//---------------
+// PRIVATE METHODS	
+
+    function NormAngle($a) {
+	while( $a < 0 ) $a += 2*M_PI;
+	while( $a > 2*M_PI ) $a -= 2*M_PI;
+	return $a;
+    }
+
+    function Quadrant($a) {
+	$a=$this->NormAngle($a);
+	if( $a > 0 && $a <= M_PI/2 )
+	    return 0;
+	if( $a > M_PI/2 && $a <= M_PI )
+	    return 1;
+	if( $a > M_PI && $a <= 1.5*M_PI )
+	    return 2;
+	if( $a > 1.5*M_PI )
+	    return 3;
+    }
+
+    function StrokeGuideLabels($img,$xc,$yc,$radius) {
+	$n = count($this->labels);
+
+	//-----------------------------------------------------------------------
+	// Step 1 of the algorithm is to construct a number of clusters
+	// a cluster is defined as all slices within the same quadrant (almost)
+	// that has an angualr distance less than the treshold
+	//-----------------------------------------------------------------------
+	$tresh_hold=25 * M_PI/180; // 25 degrees difference to be in a cluster
+	$incluster=false;	// flag if we are currently in a cluster or not
+	$clusters = array();	// array of clusters
+	$cidx=-1;		// running cluster index
+
+	// Go through all the labels and construct a number of clusters
+	for($i=0; $i < $n-1; ++$i) {
+	    // Calc the angle distance between two consecutive slices
+	    $a1=$this->la[$i];
+	    $a2=$this->la[$i+1];
+	    $q1 = $this->Quadrant($a1);
+	    $q2 = $this->Quadrant($a2);
+	    $diff = abs($a1-$a2);
+	    if( $diff < $tresh_hold ) {
+		if( $incluster ) {
+		    $clusters[$cidx][1]++;
+		    // Each cluster can only cover one quadrant
+		    // Do we cross a quadrant ( and must break the cluster)
+		    if( $q1 !=  $q2 ) {
+			// If we cross a quadrant boundary we normally start a 
+			// new cluster. However we need to take the 12'a clock
+			// and 6'a clock positions into a special consideration.
+			// Case 1: WE go from q=1 to q=2 if the last slice on
+			// the cluster for q=1 is close to 12'a clock and the 
+			// first slice in q=0 is small we extend the previous
+			// cluster
+			if( $q1 == 1 && $q2 == 0 && $a2 > (90-15)*M_PI/180 ) {
+			    if( $i < $n-2 ) {
+				$a3 = $this->la[$i+2];
+				// If there isn't a cluster coming up with the next-next slice
+				// we extend the previous cluster to cover this slice as well
+				if( abs($a3-$a2) >= $tresh_hold ) {
+				    $clusters[$cidx][1]++;
+				    $i++;
+				}
+			    }
+			}
+			elseif( $q1 == 3 && $q2 == 2 && $a2 > (270-15)*M_PI/180 ) {
+			    if( $i < $n-2 ) {
+				$a3 = $this->la[$i+2];
+				// If there isn't a cluster coming up with the next-next slice
+				// we extend the previous cluster to cover this slice as well
+				if( abs($a3-$a2) >= $tresh_hold ) {
+				    $clusters[$cidx][1]++;
+				    $i++;
+				}
+			    }
+			}
+
+			if( $q1==2 && $q2==1 && $a2 > (180-15)*M_PI/180 ) {
+			    $clusters[$cidx][1]++;
+			    $i++;			    
+			}
+			
+			$incluster = false;
+		    }
+		}
+		elseif( $q1 == $q2)  {
+		    $incluster = true;
+		    // Now we have a special case for quadrant 0. If we previously
+		    // have a cluster of one in quadrant 0 we just extend that
+		    // cluster. If we don't do this then we risk that the label
+		    // for the cluster of one will cross the guide-line
+		    if( $q1 == 0 && $cidx > -1 && 
+			$clusters[$cidx][1] == 1 && 
+			$this->Quadrant($this->la[$clusters[$cidx][0]]) == 0 ) {
+			$clusters[$cidx][1]++;
+		    }
+		    else {
+			$cidx++;
+			$clusters[$cidx][0] = $i;
+			$clusters[$cidx][1] = 1;
+		    }
+		}
+		else {  
+		    // Create a "cluster" of one since we are just crossing
+		    // a quadrant
+		    $cidx++;
+		    $clusters[$cidx][0] = $i;
+		    $clusters[$cidx][1] = 1;	    
+		}
+	    }
+	    else {
+		if( $incluster ) {
+		    // Add the last slice
+		    $clusters[$cidx][1]++;
+		    $incluster = false;
+		}
+		else { // Create a "cluster" of one
+		    $cidx++;
+		    $clusters[$cidx][0] = $i;
+		    $clusters[$cidx][1] = 1;	    
+		}
+	    }
+	}
+	// Handle the very last slice
+	if( $incluster ) {
+	    $clusters[$cidx][1]++;
+	}
+	else { // Create a "cluster" of one
+	    $cidx++;
+	    $clusters[$cidx][0] = $i;
+	    $clusters[$cidx][1] = 1;	    
+	}
+
+	/*
+	if( true ) { 
+	    // Debug printout in labels
+	    for( $i=0; $i <= $cidx; ++$i ) {
+		for( $j=0; $j < $clusters[$i][1]; ++$j ) {
+		    $a = $this->la[$clusters[$i][0]+$j];
+		    $aa = round($a*180/M_PI);
+		    $q = $this->Quadrant($a);
+		    $this->labels[$clusters[$i][0]+$j]="[$q:$aa] $i:$j";
+		}
+	    }
+	}
+	*/
+
+	//-----------------------------------------------------------------------
+	// Step 2 of the algorithm is use the clusters and draw the labels
+	// and guidelines
+	//-----------------------------------------------------------------------
+
+	// We use the font height as the base factor for how far we need to
+	// spread the labels in the Y-direction.
+	$img->SetFont($this->value->ff,$this->value->fs,$this->value->fsize);
+	$fh = $img->GetFontHeight();
+	$origvstep=$fh*$this->iGuideVFactor;
+	$this->value->SetMargin(0);
+
+	// Number of clusters found
+	$nc = count($clusters);
+
+	// Walk through all the clusters
+	for($i=0; $i < $nc; ++$i) {
+
+	    // Start angle and number of slices in this cluster
+	    $csize = $clusters[$i][1];
+	    $a = $this->la[$clusters[$i][0]];
+	    $q = $this->Quadrant($a);
+
+	    // Now set up the start and end conditions to make sure that
+	    // in each cluster we walk through the all the slices starting with the slice
+	    // closest to the equator. Since all slices are numbered clockwise from "3'a clock"
+	    // we have different conditions depending on in which quadrant the slice lies within.
+	    if( $q == 0 ) {
+		$start = $csize-1; $idx = $start; $step = -1; $vstep = -$origvstep;
+	    }
+	    elseif( $q == 1 ) {
+		$start = 0; $idx = $start; $step = 1; $vstep = -$origvstep;
+	    }
+	    elseif( $q == 2 ) {
+		$start = $csize-1; $idx = $start; $step = -1; $vstep = $origvstep;
+	    }
+	    elseif( $q == 3 ) {
+		$start = 0; $idx = $start; $step = 1; $vstep = $origvstep;
+	    }
+
+	    // Walk through all slices within this cluster
+	    for($j=0; $j < $csize; ++$j) {   
+		// Now adjust the position of the labels in each cluster starting
+		// with the slice that is closest to the equator of the pie
+		$a = $this->la[$clusters[$i][0]+$idx];
+		    
+		// Guide line start in the center of the arc of the slice
+		$r = $radius+$this->explode_radius[$n-1-($clusters[$i][0]+$idx)];
+		$x = round($r*cos($a)+$xc);
+		$y = round($yc-$r*sin($a));
+		
+		// The distance from the arc depends on chosen font and the "R-Factor"
+		$r += $fh*$this->iGuideLineRFactor;
+
+		// Should the labels be placed curved along the pie or in straight columns
+		// outside the pie?
+		if( $this->iGuideLineCurve )
+		    $xt=round($r*cos($a)+$xc);
+
+		// If this is the first slice in the cluster we need some first time
+		// proessing
+		if( $idx == $start ) {
+		    if( ! $this->iGuideLineCurve )
+			$xt=round($r*cos($a)+$xc);
+		    $yt=round($yc-$r*sin($a));
+
+		    // Some special consideration in case this cluster starts
+		    // in quadrant 1 or 3 very close to the "equator" (< 20 degrees) 
+		    // and the previous clusters last slice is within the tolerance. 
+		    // In that case we add a font height to this labels Y-position 
+		    // so it doesn't collide with
+		    // the slice in the previous cluster
+		    $prevcluster = ($i + ($nc-1) ) % $nc;
+		    $previdx=$clusters[$prevcluster][0]+$clusters[$prevcluster][1]-1;
+		    if( $q == 1 && $a > 160*M_PI/180 ) {
+			// Get the angle for the previous clusters last slice
+			$diff = abs($a-$this->la[$previdx]);
+			 if( $diff < $tresh_hold ) {
+			     $yt -= $fh;
+			 }
+		    }
+		    elseif( $q == 3 && $a > 340*M_PI/180 ) {
+			// We need to subtract 360 to compare angle distance between
+			// q=0 and q=3
+			$diff = abs($a-$this->la[$previdx]-360*M_PI/180);
+			if( $diff < $tresh_hold ) {
+			     $yt += $fh;
+			}
+		    }
+
+		}
+		else {
+		    // The step is at minimum $vstep but if the slices are relatively large
+		    // we make sure that we add at least a step that corresponds to the vertical
+		    // distance between the centers at the arc on the slice
+		    $prev_a = $this->la[$clusters[$i][0]+($idx-$step)];
+		    $dy = abs($radius*(sin($a)-sin($prev_a))*1.2);
+		    if( $vstep > 0 )
+			$yt += max($vstep,$dy);
+		    else
+			$yt += min($vstep,-$dy);
+		}
+
+		$label = $this->labels[$clusters[$i][0]+$idx];
+
+		if( $csize == 1 ) {
+		    // A "meta" cluster with only one slice
+		    $r = $radius+$this->explode_radius[$n-1-($clusters[$i][0]+$idx)];
+		    $rr = $r+$img->GetFontHeight()/2;
+		    $xt=round($rr*cos($a)+$xc);
+		    $yt=round($yc-$rr*sin($a));
+		    $this->StrokeLabel($label,$img,$xc,$yc,$a,$r); 
+		    if( $this->iShowGuideLineForSingle ) 
+			$this->guideline->Stroke($img,$x,$y,$xt,$yt);
+		}
+		else {
+		    $this->guideline->Stroke($img,$x,$y,$xt,$yt);
+		    if( $q==1 || $q==2 ) {
+			// Left side of Pie
+			$this->guideline->Stroke($img,$xt,$yt,$xt-$this->guidelinemargin,$yt);
+			$lbladj = -$this->guidelinemargin-5;
+			$this->value->halign = "right";
+			$this->value->valign = "center";
+		    }
+		    else {
+			// Right side of pie
+			$this->guideline->Stroke($img,$xt,$yt,$xt+$this->guidelinemargin,$yt);
+			$lbladj = $this->guidelinemargin+5;
+			$this->value->halign = "left";
+			$this->value->valign = "center";
+		    }
+		    $this->value->Stroke($img,$label,$xt+$lbladj,$yt);
+		}
+
+		// Udate idx to point to next slice in the cluster to process
+		$idx += $step;
+	    }
+	}
+    }
+
+    function StrokeAllLabels($img,$xc,$yc,$radius) {
+	// First normalize all angles for labels
+	$n = count($this->la);
+	for($i=0; $i < $n; ++$i) {
+	    $this->la[$i] = $this->NormAngle($this->la[$i]);
+	}
+	if( $this->guideline->iShow ) {
+	    $this->StrokeGuideLabels($img,$xc,$yc,$radius);
+	}
+	else {
+	    $n = count($this->labels);
+	    for($i=0; $i < $n; ++$i) {
+		$this->StrokeLabel($this->labels[$i],$img,$xc,$yc,
+				   $this->la[$i],
+				   $radius + $this->explode_radius[$n-1-$i]); 
+	    }
+	}
+    }
+
+    // Position the labels of each slice
+    function StrokeLabel($label,$img,$xc,$yc,$a,$radius) {
+
+	// Default value
+	if( $this->ilabelposadj === 'auto' )
+	    $this->ilabelposadj = 0.65;
+	$r = $radius;
+
+	// We position the values diferently depending on if they are inside
+	// or outside the pie
+	if( $this->ilabelposadj < 1.0 ) {
+
+	    $this->value->SetAlign('center','center');
+	    $this->value->margin = 0;
+	    
+	    $xt=round($this->ilabelposadj*$r*cos($a)+$xc);
+	    $yt=round($yc-$this->ilabelposadj*$r*sin($a));
+	    
+	    $this->value->Stroke($img,$label,$xt,$yt);
+	}
+	else {
+
+	    $this->value->halign = "left";
+	    $this->value->valign = "top";
+	    $this->value->margin = 0;
+	    	    
+	    // Position the axis title. 
+	    // dx, dy is the offset from the top left corner of the bounding box that sorrounds the text
+	    // that intersects with the extension of the corresponding axis. The code looks a little
+	    // bit messy but this is really the only way of having a reasonable position of the
+	    // axis titles.
+	    $img->SetFont($this->value->ff,$this->value->fs,$this->value->fsize);
+	    $h=$img->GetTextHeight($label);
+	    // For numeric values the format of the display value
+	    // must be taken into account
+	    if( is_numeric($label) ) {
+		if( $label > 0 )
+		    $w=$img->GetTextWidth(sprintf($this->value->format,$label));
+		else
+		    $w=$img->GetTextWidth(sprintf($this->value->negformat,$label));
+	    }
+	    else
+		$w=$img->GetTextWidth($label);
+	    if( $this->ilabelposadj > 1.0 && $this->ilabelposadj < 5.0) {
+		$r *= $this->ilabelposadj;
+	    }
+	    
+	    $r += $img->GetFontHeight()/1.5;
+
+	    $xt=round($r*cos($a)+$xc);
+	    $yt=round($yc-$r*sin($a));
+
+	    // Normalize angle
+	    while( $a < 0 ) $a += 2*M_PI;
+	    while( $a > 2*M_PI ) $a -= 2*M_PI;
+		
+	    if( $a>=7*M_PI/4 || $a <= M_PI/4 ) $dx=0;
+	    if( $a>=M_PI/4 && $a <= 3*M_PI/4 ) $dx=($a-M_PI/4)*2/M_PI; 
+	    if( $a>=3*M_PI/4 && $a <= 5*M_PI/4 ) $dx=1;
+	    if( $a>=5*M_PI/4 && $a <= 7*M_PI/4 ) $dx=(1-($a-M_PI*5/4)*2/M_PI);
+	    
+	    if( $a>=7*M_PI/4 ) $dy=(($a-M_PI)-3*M_PI/4)*2/M_PI;
+	    if( $a<=M_PI/4 ) $dy=(1-$a*2/M_PI);
+	    if( $a>=M_PI/4 && $a <= 3*M_PI/4 ) $dy=1;
+	    if( $a>=3*M_PI/4 && $a <= 5*M_PI/4 ) $dy=(1-($a-3*M_PI/4)*2/M_PI);
+	    if( $a>=5*M_PI/4 && $a <= 7*M_PI/4 ) $dy=0;
+	    
+	    $this->value->Stroke($img,$label,$xt-$dx*$w,$yt-$dy*$h);
+	}
+    }	
+} // Class
+
+
+//===================================================
+// CLASS PiePlotC
+// Description: Same as a normal pie plot but with a 
+// filled circle in the center
+//===================================================
+class PiePlotC extends PiePlot {
+    var $imidsize=0.5;		// Fraction of total width
+    var $imidcolor='white';
+    var $midtitle='';
+    var $middlecsimtarget="",$middlecsimalt="";
+
+    function PiePlotC($data,$aCenterTitle='') {
+	parent::PiePlot($data);
+	$this->midtitle = new Text();
+	$this->midtitle->ParagraphAlign('center');
+    }
+
+    function SetMid($aTitle,$aColor='white',$aSize=0.5) {
+	$this->midtitle->Set($aTitle);
+
+	$this->imidsize = $aSize ; 
+	$this->imidcolor = $aColor ; 
+    }
+
+    function SetMidTitle($aTitle) {
+	$this->midtitle->Set($aTitle);
+    }
+
+    function SetMidSize($aSize) {
+	$this->imidsize = $aSize ; 
+    }
+
+    function SetMidColor($aColor) {
+	$this->imidcolor = $aColor ; 
+    }
+
+    function SetMidCSIM($aTarget,$aAlt) {
+	$this->middlecsimtarget = $aTarget;
+	$this->middlecsimalt = $aAlt;
+    }
+
+    function AddSliceToCSIM($i,$xc,$yc,$radius,$sa,$ea) {  
+
+        //Slice number, ellipse centre (x,y), radius, start angle, end angle
+	while( $sa > 2*M_PI ) $sa = $sa - 2*M_PI;
+	while( $ea > 2*M_PI ) $ea = $ea - 2*M_PI;
+
+	$sa = 2*M_PI - $sa;
+	$ea = 2*M_PI - $ea;
+
+	// Special case when we have only one slice since then both start and end
+	// angle will be == 0
+	if( abs($sa - $ea) < 0.0001 ) {
+	    $sa=2*M_PI; $ea=0;
+	}
+
+	// Add inner circle first point
+	$xp = floor(($this->imidsize*$radius*cos($ea))+$xc);
+	$yp = floor($yc-($this->imidsize*$radius*sin($ea)));
+	$coords = "$xp, $yp";
+	
+	//add coordinates every 0.25 radians
+	$a=$ea+0.25;
+
+	// If we cross the 260-limit with a slice we need to handle
+	// the fact that end angle is smaller than start
+	if( $sa < $ea ) {
+	    while ($a <= 2*M_PI) {
+		$xp = floor($radius*cos($a)+$xc);
+		$yp = floor($yc-$radius*sin($a));
+		$coords.= ", $xp, $yp";
+		$a += 0.25;
+	    }
+	    $a -= 2*M_PI;
+	}
+
+	while ($a < $sa) {
+	    $xp = floor(($this->imidsize*$radius*cos($a)+$xc));
+	    $yp = floor($yc-($this->imidsize*$radius*sin($a)));
+	    $coords.= ", $xp, $yp";
+	    $a += 0.25;
+	}
+
+	// Make sure we end at the last point
+	$xp = floor(($this->imidsize*$radius*cos($sa)+$xc));
+	$yp = floor($yc-($this->imidsize*$radius*sin($sa)));
+	$coords.= ", $xp, $yp";
+
+	// Straight line to outer circle
+	$xp = floor($radius*cos($sa)+$xc);
+	$yp = floor($yc-$radius*sin($sa));
+	$coords.= ", $xp, $yp";	
+
+	//add coordinates every 0.25 radians
+	$a=$sa - 0.25;
+	while ($a > $ea) {
+	    $xp = floor($radius*cos($a)+$xc);
+	    $yp = floor($yc-$radius*sin($a));
+	    $coords.= ", $xp, $yp";
+	    $a -= 0.25;
+	}
+		
+	//Add the last point on the arc
+	$xp = floor($radius*cos($ea)+$xc);
+	$yp = floor($yc-$radius*sin($ea));
+	$coords.= ", $xp, $yp";
+
+	// Close the arc
+	$xp = floor(($this->imidsize*$radius*cos($ea))+$xc);
+	$yp = floor($yc-($this->imidsize*$radius*sin($ea)));
+	$coords .= ", $xp, $yp";
+
+	if( !empty($this->csimtargets[$i]) ) {
+	    $this->csimareas .= "<area shape=\"poly\" coords=\"$coords\" href=\"".
+		$this->csimtargets[$i]."\"";
+	    if( !empty($this->csimalts[$i]) ) {
+		$tmp=sprintf($this->csimalts[$i],$this->data[$i]);
+		$this->csimareas .= " title=\"$tmp\"";
+	    }
+	    $this->csimareas .= " alt=\"$tmp\" />\n";
+	}
+    }
+
+
+    function Stroke($img,$aaoption=0) {
+
+	// Stroke the pie but don't stroke values
+	$tmp =  $this->value->show;
+	$this->value->show = false;
+	parent::Stroke($img,$aaoption);
+	$this->value->show = $tmp;
+
+ 	$xc = round($this->posx*$img->width);
+	$yc = round($this->posy*$img->height);
+
+	$radius = floor($this->radius * min($img->width,$img->height)) ;
+
+
+	if( $this->imidsize > 0 && $aaoption !== 2 ) {
+
+	    if( $this->ishadowcolor != "" ) {
+		$img->SetColor($this->ishadowcolor);
+		$img->FilledCircle($xc+$this->ishadowdrop,$yc+$this->ishadowdrop,
+				   round($radius*$this->imidsize));
+	    }
+
+	    $img->SetColor($this->imidcolor);
+	    $img->FilledCircle($xc,$yc,round($radius*$this->imidsize));
+
+	    if(  $this->pie_border && $aaoption === 0 ) {
+		$img->SetColor($this->color);
+		$img->Circle($xc,$yc,round($radius*$this->imidsize));
+	    }
+
+	    if( !empty($this->middlecsimtarget) )
+		$this->AddMiddleCSIM($xc,$yc,round($radius*$this->imidsize));
+
+	}
+
+	if( $this->value->show && $aaoption !== 1) {
+	    $this->StrokeAllLabels($img,$xc,$yc,$radius);
+	    $this->midtitle->Pos($xc,$yc,'center','center');
+	    $this->midtitle->Stroke($img);
+	}
+
+    }
+
+    function AddMiddleCSIM($xc,$yc,$r) {
+	$xc=round($xc);$yc=round($yc);$r=round($r);
+	$this->csimareas .= "<area shape=\"circle\" coords=\"$xc,$yc,$r\" href=\"".
+	    $this->middlecsimtarget."\"";
+	if( !empty($this->middlecsimalt) ) {
+	    $tmp = $this->middlecsimalt;
+	    $this->csimareas .= " title=\"$tmp\"";
+	}
+	$this->csimareas .= " alt=\"$tmp\" />\n";
+    }
+
+    function StrokeLabel($label,$img,$xc,$yc,$a,$r) {
+
+	if( $this->ilabelposadj === 'auto' )
+	    $this->ilabelposadj = (1-$this->imidsize)/2+$this->imidsize;
+
+	parent::StrokeLabel($label,$img,$xc,$yc,$a,$r);
+
+    }
+
+}
+
+
+//===================================================
+// CLASS PieGraph
+// Description: 
+//===================================================
+class PieGraph extends Graph {
+    var $posx, $posy, $radius;		
+    var $legends=array();	
+    var $plots=array();
+    var $pieaa = false ;
+//---------------
+// CONSTRUCTOR
+    function PieGraph($width=300,$height=200,$cachedName="",$timeout=0,$inline=1) {
+	$this->Graph($width,$height,$cachedName,$timeout,$inline);
+	$this->posx=$width/2;
+	$this->posy=$height/2;
+	$this->SetColor(array(255,255,255));		
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function Add($aObj) {
+
+	if( is_array($aObj) && count($aObj) > 0 )
+	    $cl = $aObj[0];
+	else
+	    $cl = $aObj;
+
+	if( is_a($cl,'Text') ) 
+	    $this->AddText($aObj);
+	elseif( is_a($cl,'IconPlot') ) 
+	    $this->AddIcon($aObj);
+	else {
+	    if( is_array($aObj) ) {
+		$n = count($aObj);
+		for($i=0; $i < $n; ++$i ) {
+		    $this->plots[] = $aObj[$i];
+		}
+	    }
+	    else {
+		$this->plots[] = $aObj;
+	    }
+	}
+    }
+
+    function SetAntiAliasing($aFlg=true) {
+	$this->pieaa = $aFlg;
+    }
+	
+    function SetColor($c) {
+	$this->SetMarginColor($c);
+    }
+
+    function DisplayCSIMAreas() {
+	    $csim="";
+	    foreach($this->plots as $p ) {
+		$csim .= $p->GetCSIMareas();
+	    }
+	    //$csim.= $this->legend->GetCSIMareas();
+	    if (preg_match_all("/area shape=\"(\w+)\" coords=\"([0-9\, ]+)\"/", $csim, $coords)) {
+		$this->img->SetColor($this->csimcolor);
+		$n = count($coords[0]);
+		for ($i=0; $i < $n; $i++) {
+		    if ($coords[1][$i]=="poly") {
+			preg_match_all('/\s*([0-9]+)\s*,\s*([0-9]+)\s*,*/',$coords[2][$i],$pts);
+			$this->img->SetStartPoint($pts[1][count($pts[0])-1],$pts[2][count($pts[0])-1]);
+			$m = count($pts[0]);
+			for ($j=0; $j < $m; $j++) {
+			    $this->img->LineTo($pts[1][$j],$pts[2][$j]);
+			}
+		    } else if ($coords[1][$i]=="rect") {
+			$pts = preg_split('/,/', $coords[2][$i]);
+			$this->img->SetStartPoint($pts[0],$pts[1]);
+			$this->img->LineTo($pts[2],$pts[1]);
+			$this->img->LineTo($pts[2],$pts[3]);
+			$this->img->LineTo($pts[0],$pts[3]);
+			$this->img->LineTo($pts[0],$pts[1]);
+						
+		    }
+		}
+	    }
+    }
+
+    // Method description
+    function Stroke($aStrokeFileName="") {
+	// If the filename is the predefined value = '_csim_special_'
+	// we assume that the call to stroke only needs to do enough
+	// to correctly generate the CSIM maps.
+	// We use this variable to skip things we don't strictly need
+	// to do to generate the image map to improve performance
+	// a best we can. Therefor you will see a lot of tests !$_csim in the
+	// code below.
+	$_csim = ($aStrokeFileName===_CSIM_SPECIALFILE);
+
+	// We need to know if we have stroked the plot in the
+	// GetCSIMareas. Otherwise the CSIM hasn't been generated
+	// and in the case of GetCSIM called before stroke to generate
+	// CSIM without storing an image to disk GetCSIM must call Stroke.
+	$this->iHasStroked = true;
+		
+	$n = count($this->plots);
+
+	if( $this->pieaa ) {
+
+	    if( !$_csim ) {
+		if( $this->background_image != "" ) {
+		    $this->StrokeFrameBackground();		
+		}
+		else {
+		    $this->StrokeFrame();		
+		}
+	    }
+
+
+	    $w = $this->img->width;
+	    $h = $this->img->height;
+	    $oldimg = $this->img->img;
+
+	    $this->img->CreateImgCanvas(2*$w,2*$h);
+	    
+	    $this->img->SetColor( $this->margin_color );
+	    $this->img->FilledRectangle(0,0,2*$w-1,2*$h-1);
+
+	    // Make all icons *2 i size since we will be scaling down the
+	    // image to do the anti aliasing
+	    $ni = count($this->iIcons);
+	    for($i=0; $i < $ni; ++$i) {
+		$this->iIcons[$i]->iScale *= 2 ;
+	    }
+	    $this->StrokeIcons();
+
+	    for($i=0; $i < $n; ++$i) {
+		if( $this->plots[$i]->posx > 1 ) 
+		    $this->plots[$i]->posx *= 2 ;
+		if( $this->plots[$i]->posy > 1 ) 
+		    $this->plots[$i]->posy *= 2 ;
+
+		$this->plots[$i]->Stroke($this->img,1);
+
+		if( $this->plots[$i]->posx > 1 ) 
+		    $this->plots[$i]->posx /= 2 ;
+		if( $this->plots[$i]->posy > 1 ) 
+		    $this->plots[$i]->posy /= 2 ;
+	    }
+
+	    $indent = $this->doframe ? ($this->frame_weight + ($this->doshadow ? $this->shadow_width : 0 )) : 0 ;
+	    $indent += $this->framebevel ? $this->framebeveldepth + 1 : 0 ;
+	    $this->img->CopyCanvasH($oldimg,$this->img->img,$indent,$indent,$indent,$indent,
+				    $w-2*$indent,$h-2*$indent,2*($w-$indent),2*($h-$indent));
+
+	    $this->img->img = $oldimg ;
+	    $this->img->width = $w ;
+	    $this->img->height = $h ;
+
+	    for($i=0; $i < $n; ++$i) {
+		$this->plots[$i]->Stroke($this->img,2); // Stroke labels
+		$this->plots[$i]->Legend($this);
+	    }
+
+	}
+	else {
+	    // No antialias
+	    if( !$_csim ) {
+		if( $this->background_image != "" ) {
+		    $this->StrokeFrameBackground();		
+		}
+		else {
+		    $this->StrokeFrame();
+		    $this->StrokeBackgroundGrad();		
+		}
+	    }
+
+	    $this->StrokeIcons();
+
+	    for($i=0; $i < $n; ++$i) {
+		$this->plots[$i]->Stroke($this->img);
+		$this->plots[$i]->Legend($this);
+	    }
+	}
+
+	$this->legend->Stroke($this->img);
+	$this->footer->Stroke($this->img);
+	$this->StrokeTitles();
+
+	if( !$_csim ) {	
+
+	    // Stroke texts
+	    if( $this->texts != null ) {
+		$n = count($this->texts);
+		for($i=0; $i < $n; ++$i ) {
+		    $this->texts[$i]->Stroke($this->img);
+		}
+	    }
+
+	    if( _JPG_DEBUG ) {
+		$this->DisplayCSIMAreas();
+	    }
+
+	    // Should we do any final image transformation
+	    if( $this->iImgTrans ) {
+		if( !class_exists('ImgTrans') ) {
+		    require_once('jpgraph_imgtrans.php');
+		    //JpGraphError::Raise('In order to use image transformation you must include the file jpgraph_imgtrans.php in your script.');
+		}
+	       
+		$tform = new ImgTrans($this->img->img);
+		$this->img->img = $tform->Skew3D($this->iImgTransHorizon,$this->iImgTransSkewDist,
+						 $this->iImgTransDirection,$this->iImgTransHighQ,
+						 $this->iImgTransMinSize,$this->iImgTransFillColor,
+						 $this->iImgTransBorder);
+	    }
+
+
+	    // If the filename is given as the special "__handle"
+	    // then the image handler is returned and the image is NOT
+	    // streamed back
+	    if( $aStrokeFileName == _IMG_HANDLER ) {
+		return $this->img->img;
+	    }
+	    else {
+		// Finally stream the generated picture					
+		$this->cache->PutAndStream($this->img,$this->cache_name,$this->inline,
+					   $aStrokeFileName);		
+	    }
+	}
+    }
+} // Class
+
+/* EOF */
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_plotband.php php-syslog-ng/html/includes/jpgraph/jpgraph_plotband.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_plotband.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_plotband.php	2006-02-04 07:19:43.000000000 -0500
@@ -0,0 +1,635 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_PLOTBAND.PHP
+// Description:	PHP4 Graph Plotting library. Extension module.
+// Created: 	2004-02-18
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_plotband.php 483 2006-02-04 12:19:43Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+// Constants for types of static bands in plot area
+DEFINE("BAND_RDIAG",1);	// Right diagonal lines
+DEFINE("BAND_LDIAG",2); // Left diagonal lines
+DEFINE("BAND_SOLID",3); // Solid one color
+DEFINE("BAND_VLINE",4); // Vertical lines
+DEFINE("BAND_HLINE",5);  // Horizontal lines
+DEFINE("BAND_3DPLANE",6);  // "3D" Plane
+DEFINE("BAND_HVCROSS",7);  // Vertical/Hor crosses
+DEFINE("BAND_DIAGCROSS",8); // Diagonal crosses
+
+
+// Utility class to hold coordinates for a rectangle
+class Rectangle {
+    var $x,$y,$w,$h;
+    var $xe, $ye;
+    function Rectangle($aX,$aY,$aWidth,$aHeight) {
+	$this->x=$aX;
+	$this->y=$aY;
+	$this->w=$aWidth;
+	$this->h=$aHeight;
+	$this->xe=$aX+$aWidth-1;
+	$this->ye=$aY+$aHeight-1;
+    }
+}
+
+//=====================================================================
+// Class RectPattern
+// Base class for pattern hierarchi that is used to display patterned
+// bands on the graph. Any subclass that doesn't override Stroke()
+// must at least implement method DoPattern(&$aImg) which is responsible
+// for drawing the pattern onto the graph.
+//=====================================================================
+class RectPattern {
+    var $color;
+    var $weight;
+    var $rect=null;
+    var $doframe=true;
+    var $linespacing;	// Line spacing in pixels
+    var $iBackgroundColor=-1;  // Default is no background fill
+	
+    function RectPattern($aColor,$aWeight=1) {
+	$this->color = $aColor;
+	$this->weight = $aWeight;		
+    }
+
+    function SetBackground($aBackgroundColor) {
+	$this->iBackgroundColor=$aBackgroundColor;
+    }
+
+    function SetPos(&$aRect) {
+	$this->rect = $aRect;
+    }
+	
+    function ShowFrame($aShow=true) {
+	$this->doframe=$aShow;
+    }
+
+    function SetDensity($aDens) {
+	if( $aDens < 1 || $aDens > 100 )
+	    JpGraphError::RaiseL(16001,$aDens);
+//(" Desity for pattern must be between 1 and 100. (You tried $aDens)");
+	// 1% corresponds to linespacing=50
+	// 100 % corresponds to linespacing 1
+	$this->linespacing = floor(((100-$aDens)/100.0)*50)+1;
+
+    }
+
+    function Stroke(&$aImg) {
+	if( $this->rect == null )
+	    JpGraphError::RaiseL(16002);
+//(" No positions specified for pattern.");
+
+	if( !(is_numeric($this->iBackgroundColor) && $this->iBackgroundColor==-1) ) {
+	    $aImg->SetColor($this->iBackgroundColor);
+	    $aImg->FilledRectangle($this->rect->x,$this->rect->y,$this->rect->xe,$this->rect->ye); 
+	}
+
+	$aImg->SetColor($this->color);
+	$aImg->SetLineWeight($this->weight);
+
+	// Virtual function implemented by subclass
+	$this->DoPattern($aImg);
+
+	// Frame around the pattern area
+	if( $this->doframe ) 
+	    $aImg->Rectangle($this->rect->x,$this->rect->y,$this->rect->xe,$this->rect->ye);
+    }
+
+}
+
+
+//=====================================================================
+// Class RectPatternSolid
+// Implements a solid band
+//=====================================================================
+class RectPatternSolid extends RectPattern {
+
+    function RectPatternSolid($aColor="black",$aWeight=1) {
+	parent::RectPattern($aColor,$aWeight);
+    }
+
+    function DoPattern(&$aImg) {
+	$aImg->SetColor($this->color);
+	$aImg->FilledRectangle($this->rect->x,$this->rect->y,
+			       $this->rect->xe,$this->rect->ye);
+    }
+}
+
+//=====================================================================
+// Class RectPatternHor
+// Implements horizontal line pattern
+//=====================================================================
+class RectPatternHor extends RectPattern {
+		
+    function RectPatternHor($aColor="black",$aWeight=1,$aLineSpacing=7) {
+	parent::RectPattern($aColor,$aWeight);
+	$this->linespacing = $aLineSpacing;
+    }
+		
+    function DoPattern(&$aImg) {
+	$x0 = $this->rect->x;		
+	$x1 = $this->rect->xe;
+	$y = $this->rect->y;
+	while( $y < $this->rect->ye ) {
+	    $aImg->Line($x0,$y,$x1,$y);
+	    $y += $this->linespacing;
+	}
+    }
+}
+
+//=====================================================================
+// Class RectPatternVert
+// Implements vertical line pattern
+//=====================================================================
+class RectPatternVert extends RectPattern {
+    var $linespacing=10;	// Line spacing in pixels
+		
+    function RectPatternVert($aColor="black",$aWeight=1,$aLineSpacing=7) {
+	parent::RectPattern($aColor,$aWeight);
+	$this->linespacing = $aLineSpacing;
+    }
+
+    //--------------------
+    // Private methods
+    //
+    function DoPattern(&$aImg) {
+	$x = $this->rect->x;		
+	$y0 = $this->rect->y;
+	$y1 = $this->rect->ye;
+	while( $x < $this->rect->xe ) {
+	    $aImg->Line($x,$y0,$x,$y1);
+	    $x += $this->linespacing;
+	}
+    }
+}
+
+
+//=====================================================================
+// Class RectPatternRDiag
+// Implements right diagonal pattern
+//=====================================================================
+class RectPatternRDiag extends RectPattern {
+    var $linespacing;	// Line spacing in pixels
+		
+    function RectPatternRDiag($aColor="black",$aWeight=1,$aLineSpacing=12) {
+	parent::RectPattern($aColor,$aWeight);
+	$this->linespacing = $aLineSpacing;
+    }
+
+    function DoPattern(&$aImg) {
+	//  --------------------
+	//  | /   /   /   /   /|
+	//  |/   /   /   /   / |
+	//  |   /   /   /   /  |
+	//  --------------------
+	$xe = $this->rect->xe;
+	$ye = $this->rect->ye;
+	$x0 = $this->rect->x + round($this->linespacing/2); 
+	$y0 = $this->rect->y;
+	$x1 = $this->rect->x; 
+	$y1 = $this->rect->y + round($this->linespacing/2);
+
+	while($x0<=$xe && $y1<=$ye) {
+	    $aImg->Line($x0,$y0,$x1,$y1);
+	    $x0 += $this->linespacing;
+	    $y1 += $this->linespacing;
+	}
+
+	if( $xe-$x1 > $ye-$y0 ) { 
+	    // Width larger than height
+	    $x1 = $this->rect->x + ($y1-$ye);
+	    $y1 = $ye; 
+	    $y0 = $this->rect->y; 
+	    while( $x0 <= $xe ) {
+		$aImg->Line($x0,$y0,$x1,$y1);
+		$x0 += $this->linespacing;
+		$x1 += $this->linespacing;
+	    }
+	    
+	    $y0=$this->rect->y + ($x0-$xe);
+	    $x0=$xe;
+	}
+	else {
+	    // Height larger than width
+	    $diff = $x0-$xe;
+	    $y0 = $diff+$this->rect->y;
+	    $x0 = $xe;
+	    $x1 = $this->rect->x;
+	    while( $y1 <= $ye ) {
+		$aImg->Line($x0,$y0,$x1,$y1);
+		$y1 += $this->linespacing;
+		$y0 += $this->linespacing;
+	    }
+	    
+	    $diff = $y1-$ye;
+	    $y1 = $ye;
+	    $x1 = $diff + $this->rect->x;
+	}
+
+	while( $y0 <= $ye ) {
+	    $aImg->Line($x0,$y0,$x1,$y1);
+	    $y0 += $this->linespacing;		
+	    $x1 += $this->linespacing;
+	}
+    }
+}
+ 
+//=====================================================================
+// Class RectPatternLDiag
+// Implements left diagonal pattern
+//=====================================================================
+class RectPatternLDiag extends RectPattern {
+    var $linespacing;	// Line spacing in pixels
+		
+    function RectPatternLDiag($aColor="black",$aWeight=1,$aLineSpacing=12) {
+	$this->linespacing = $aLineSpacing;
+	parent::RectPattern($aColor,$aWeight);
+    }
+
+    function DoPattern(&$aImg) {
+	//  --------------------
+	//  |\   \   \   \   \ |
+	//  | \   \   \   \   \|
+	//  |  \   \   \   \   |
+	//  |------------------|
+	$xe = $this->rect->xe;
+	$ye = $this->rect->ye;
+	$x0 = $this->rect->x + round($this->linespacing/2); 
+	$y0 = $this->rect->ye;
+	$x1 = $this->rect->x; 
+	$y1 = $this->rect->ye - round($this->linespacing/2);
+
+	while($x0<=$xe && $y1>=$this->rect->y) {
+	    $aImg->Line($x0,$y0,$x1,$y1);
+	    $x0 += $this->linespacing;
+	    $y1 -= $this->linespacing;
+	}
+	if( $xe-$x1 > $ye-$this->rect->y ) { 
+	    // Width larger than height
+	    $x1 = $this->rect->x + ($this->rect->y-$y1);
+	    $y0=$ye; $y1=$this->rect->y; 
+	    while( $x0 <= $xe ) {
+		$aImg->Line($x0,$y0,$x1,$y1);
+		$x0 += $this->linespacing;
+		$x1 += $this->linespacing;
+	    }
+	    
+	    $y0=$this->rect->ye - ($x0-$xe);
+	    $x0=$xe;
+	}
+	else {
+	    // Height larger than width
+	    $diff = $x0-$xe;
+	    $y0 = $ye-$diff;
+	    $x0 = $xe;
+	    while( $y1 >= $this->rect->y ) {
+		$aImg->Line($x0,$y0,$x1,$y1);
+		$y0 -= $this->linespacing;
+		$y1 -= $this->linespacing;
+	    }	    
+	    $diff = $this->rect->y - $y1;
+	    $x1 = $this->rect->x + $diff;
+	    $y1 = $this->rect->y;
+	}
+	while( $y0 >= $this->rect->y ) {
+	    $aImg->Line($x0,$y0,$x1,$y1);
+	    $y0 -= $this->linespacing;
+	    $x1 += $this->linespacing;
+	}
+    }
+}
+
+//=====================================================================
+// Class RectPattern3DPlane
+// Implements "3D" plane pattern
+//=====================================================================
+class RectPattern3DPlane extends RectPattern {
+    var $alpha=50;  // Parameter that specifies the distance
+    // to "simulated" horizon in pixel from the
+    // top of the band. Specifies how fast the lines
+    // converge.
+
+    function RectPattern3DPlane($aColor="black",$aWeight=1) {
+	parent::RectPattern($aColor,$aWeight);
+	$this->SetDensity(10);  // Slightly larger default
+    }
+
+    function SetHorizon($aHorizon) {
+	$this->alpha=$aHorizon;
+    }
+	
+    function DoPattern(&$aImg) {
+	// "Fake" a nice 3D grid-effect. 
+	$x0 = $this->rect->x + $this->rect->w/2;
+	$y0 = $this->rect->y;
+	$x1 = $x0;
+	$y1 = $this->rect->ye;
+	$x0_right = $x0;
+	$x1_right = $x1;
+
+	// BTW "apa" means monkey in Swedish but is really a shortform for
+	// "alpha+a" which was the labels I used on paper when I derived the
+	// geometric to get the 3D perspective right. 
+	// $apa is the height of the bounding rectangle plus the distance to the
+	// artifical horizon (alpha)
+	$apa = $this->rect->h + $this->alpha;
+
+	// Three cases and three loops
+	// 1) The endpoint of the line ends on the bottom line
+	// 2) The endpoint ends on the side
+	// 3) Horizontal lines
+
+	// Endpoint falls on bottom line
+	$middle=$this->rect->x + $this->rect->w/2;
+	$dist=$this->linespacing;
+	$factor=$this->alpha /($apa);
+	while($x1>$this->rect->x) {
+	    $aImg->Line($x0,$y0,$x1,$y1);
+	    $aImg->Line($x0_right,$y0,$x1_right,$y1);
+	    $x1 = $middle - $dist;
+	    $x0 = $middle - $dist * $factor;
+	    $x1_right = $middle + $dist;
+	    $x0_right =  $middle + $dist * $factor;
+	    $dist += $this->linespacing;
+	}
+
+	// Endpoint falls on sides
+	$dist -= $this->linespacing;
+	$d=$this->rect->w/2;
+	$c = $apa - $d*$apa/$dist;
+	while( $x0>$this->rect->x ) {
+	    $aImg->Line($x0,$y0,$this->rect->x,$this->rect->ye-$c);
+	    $aImg->Line($x0_right,$y0,$this->rect->xe,$this->rect->ye-$c);
+	    $dist += $this->linespacing;			
+	    $x0 = $middle - $dist * $factor;
+	    $x1 = $middle - $dist;
+	    $x0_right =  $middle + $dist * $factor;			
+	    $c = $apa - $d*$apa/$dist;
+	}		
+		
+	// Horizontal lines
+	// They need some serious consideration since they are a function
+	// of perspective depth (alpha) and density (linespacing)
+	$x0=$this->rect->x;
+	$x1=$this->rect->xe;
+	$y=$this->rect->ye;
+		
+	// The first line is drawn directly. Makes the loop below slightly
+	// more readable.
+	$aImg->Line($x0,$y,$x1,$y);
+	$hls = $this->linespacing;
+		
+	// A correction factor for vertical "brick" line spacing to account for
+	// a) the difference in number of pixels hor vs vert
+	// b) visual apperance to make the first layer of "bricks" look more
+	// square.
+	$vls = $this->linespacing*0.6;
+		
+	$ds = $hls*($apa-$vls)/$apa;
+	// Get the slope for the "perspective line" going from bottom right
+	// corner to top left corner of the "first" brick.
+		
+	// Uncomment the following lines if you want to get a visual understanding
+	// of what this helpline does. BTW this mimics the way you would get the
+	// perspective right when drawing on paper.
+	/*
+	  $x0 = $middle;
+	  $y0 = $this->rect->ye;
+	  $len=floor(($this->rect->ye-$this->rect->y)/$vls);
+	  $x1 = $middle+round($len*$ds);
+	  $y1 = $this->rect->ye-$len*$vls;
+	  $aImg->PushColor("red");
+	  $aImg->Line($x0,$y0,$x1,$y1);
+	  $aImg->PopColor();
+	*/
+		
+	$y -= $vls;		
+	$k=($this->rect->ye-($this->rect->ye-$vls))/($middle-($middle-$ds));
+	$dist = $hls;
+	while( $y>$this->rect->y ) {
+	    $aImg->Line($this->rect->x,$y,$this->rect->xe,$y);
+	    $adj = $k*$dist/(1+$dist*$k/$apa);
+	    if( $adj < 2 ) $adj=1;
+	    $y = $this->rect->ye - round($adj);
+	    $dist += $hls;
+	}
+    }
+}
+
+//=====================================================================
+// Class RectPatternCross
+// Vert/Hor crosses
+//=====================================================================
+class RectPatternCross extends RectPattern {
+    var $vert=null;
+    var $hor=null;
+    function RectPatternCross($aColor="black",$aWeight=1) {
+	parent::RectPattern($aColor,$aWeight);
+	$this->vert = new RectPatternVert($aColor,$aWeight);
+	$this->hor  = new RectPatternHor($aColor,$aWeight);
+    }
+
+    function SetOrder($aDepth) {
+	$this->vert->SetOrder($aDepth);
+	$this->hor->SetOrder($aDepth);
+    }
+
+    function SetPos(&$aRect) {
+	parent::SetPos($aRect);
+	$this->vert->SetPos($aRect);
+	$this->hor->SetPos($aRect);
+    }
+
+    function SetDensity($aDens) {
+	$this->vert->SetDensity($aDens);
+	$this->hor->SetDensity($aDens);
+    }
+
+    function DoPattern(&$aImg) {
+	$this->vert->DoPattern($aImg);
+	$this->hor->DoPattern($aImg);
+    }
+}
+
+//=====================================================================
+// Class RectPatternDiagCross
+// Vert/Hor crosses
+//=====================================================================
+
+class RectPatternDiagCross extends RectPattern {
+    var $left=null;
+    var $right=null;
+    function RectPatternDiagCross($aColor="black",$aWeight=1) {
+	parent::RectPattern($aColor,$aWeight);
+	$this->right = new RectPatternRDiag($aColor,$aWeight);
+	$this->left  = new RectPatternLDiag($aColor,$aWeight);
+    }
+
+    function SetOrder($aDepth) {
+	$this->left->SetOrder($aDepth);
+	$this->right->SetOrder($aDepth);
+    }
+
+    function SetPos(&$aRect) {
+	parent::SetPos($aRect);
+	$this->left->SetPos($aRect);
+	$this->right->SetPos($aRect);
+    }
+
+    function SetDensity($aDens) {
+	$this->left->SetDensity($aDens);
+	$this->right->SetDensity($aDens);
+    }
+
+    function DoPattern(&$aImg) {
+	$this->left->DoPattern($aImg);
+	$this->right->DoPattern($aImg);
+    }
+
+}
+
+//=====================================================================
+// Class RectPatternFactory
+// Factory class for rectangular pattern 
+//=====================================================================
+class RectPatternFactory {
+    function RectPatternFactory() {
+	// Empty
+    }
+    function Create($aPattern,$aColor,$aWeight=1) {
+	switch($aPattern) {
+	    case BAND_RDIAG:
+		$obj =  new RectPatternRDiag($aColor,$aWeight);
+		break;
+	    case BAND_LDIAG:
+		$obj =  new RectPatternLDiag($aColor,$aWeight);
+		break;
+	    case BAND_SOLID:
+		$obj =  new RectPatternSolid($aColor,$aWeight);
+		break;
+	    case BAND_VLINE:
+		$obj =  new RectPatternVert($aColor,$aWeight);
+		break;
+	    case BAND_HLINE:
+		$obj =  new RectPatternHor($aColor,$aWeight);
+		break;
+	    case BAND_3DPLANE:
+		$obj =  new RectPattern3DPlane($aColor,$aWeight);
+		break;
+	    case BAND_HVCROSS:
+		$obj =  new RectPatternCross($aColor,$aWeight);
+		break;
+	    case BAND_DIAGCROSS:
+		$obj =  new RectPatternDiagCross($aColor,$aWeight);
+		break;
+	    default:
+		JpGraphError::RaiseL(16003,$aPattern);
+//(" Unknown pattern specification ($aPattern)");
+	}
+	return $obj;
+    }
+}
+
+
+//=====================================================================
+// Class PlotBand
+// Factory class which is used by the client.
+// It is responsible for factoring the corresponding pattern
+// concrete class.
+//=====================================================================
+class PlotBand {
+    var $prect=null;
+    var $depth;
+    var $dir, $min, $max;
+
+    function PlotBand($aDir,$aPattern,$aMin,$aMax,$aColor="black",$aWeight=1,$aDepth=DEPTH_BACK) {
+	$f =  new RectPatternFactory();
+	$this->prect = $f->Create($aPattern,$aColor,$aWeight);
+	if( is_numeric($aMin) && is_numeric($aMax) && ($aMin > $aMax) ) 
+	    JpGraphError::RaiseL(16004);
+//('Min value for plotband is larger than specified max value. Please correct.');
+	$this->dir = $aDir;
+	$this->min = $aMin;
+	$this->max = $aMax;
+	$this->depth=$aDepth;
+    }
+	
+    // Set position. aRect contains absolute image coordinates
+    function SetPos(&$aRect) {
+	assert( $this->prect != null ) ;
+	$this->prect->SetPos($aRect);
+    }
+	
+    function ShowFrame($aFlag=true) {
+	$this->prect->ShowFrame($aFlag);
+    }
+
+    // Set z-order. In front of pplot or in the back
+    function SetOrder($aDepth) {
+	$this->depth=$aDepth;
+    }
+	
+    function SetDensity($aDens) {
+	$this->prect->SetDensity($aDens);
+    }
+	
+    function GetDir() {
+	return $this->dir;
+    }
+	
+    function GetMin() {
+	return $this->min;
+    }
+	
+    function GetMax() {
+	return $this->max;
+    }
+	
+    // Display band
+    function Stroke(&$aImg,&$aXScale,&$aYScale) {
+	assert( $this->prect != null ) ;
+	if( $this->dir == HORIZONTAL ) {
+	    if( $this->min === 'min' ) $this->min = $aYScale->GetMinVal();
+	    if( $this->max === 'max' ) $this->max = $aYScale->GetMaxVal();
+
+            // Only draw the bar if it actually appears in the range
+            if ($this->min < $aYScale->GetMaxVal() && $this->max > $aYScale->GetMinVal()) {
+	    
+	    // Trucate to limit of axis
+	    $this->min = max($this->min, $aYScale->GetMinVal());
+	    $this->max = min($this->max, $aYScale->GetMaxVal());
+
+	    $x=$aXScale->scale_abs[0];
+	    $y=$aYScale->Translate($this->max);
+	    $width=$aXScale->scale_abs[1]-$aXScale->scale_abs[0]+1;
+	    $height=abs($y-$aYScale->Translate($this->min))+1;
+	    $this->prect->SetPos(new Rectangle($x,$y,$width,$height));
+	    $this->prect->Stroke($aImg);
+            }
+	}
+	else {	// VERTICAL
+	    if( $this->min === 'min' ) $this->min = $aXScale->GetMinVal();
+	    if( $this->max === 'max' ) $this->max = $aXScale->GetMaxVal();
+            
+            // Only draw the bar if it actually appears in the range
+	    if ($this->min < $aXScale->GetMaxVal() && $this->max > $aXScale->GetMinVal()) {
+	    
+	    // Trucate to limit of axis
+	    $this->min = max($this->min, $aXScale->GetMinVal());
+	    $this->max = min($this->max, $aXScale->GetMaxVal());
+
+	    $y=$aYScale->scale_abs[1];
+	    $x=$aXScale->Translate($this->min);
+	    $height=abs($aYScale->scale_abs[1]-$aYScale->scale_abs[0]);
+	    $width=abs($x-$aXScale->Translate($this->max));
+	    $this->prect->SetPos(new Rectangle($x,$y,$width,$height));
+	    $this->prect->Stroke($aImg);
+            }
+	}
+    }
+}
+
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_plotmark.inc php-syslog-ng/html/includes/jpgraph/jpgraph_plotmark.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_plotmark.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_plotmark.inc	2006-02-04 07:20:45.000000000 -0500
@@ -0,0 +1,482 @@
+<?php
+//=======================================================================
+// File:	JPGRAPH_PLOTMARK.PHP
+// Description:	Class file. Handles plotmarks
+// Created: 	2003-03-21
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_plotmark.inc 485 2006-02-04 12:20:45Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+
+
+//========================================================================
+// CLASS ImgData
+// Description: Base class for all image data classes that contains the 
+// real image data.
+//========================================================================
+class ImgData {
+    var $name = '';		// Each subclass gives a name
+    var $an = array();		// Data array names
+    var $colors = array();	// Available colors
+    var $index  = array();	// Index for colors
+    var $maxidx = 0 ;		// Max color index
+    var $anchor_x=0.5, $anchor_y=0.5 ;    // Where is the center of the image
+    // Create a GD image from the data and return a GD handle
+    function GetImg($aMark,$aIdx) {
+	$n = $this->an[$aMark];
+	if( is_string($aIdx) ) {
+	    if( !in_array($aIdx,$this->colors) ) {
+		JpGraphError::RaiseL(23001,$this->name,$aIdx); //('This marker "'.($this->name).'" does not exist in color: '.$aIdx);
+	    }
+	    $idx = $this->index[$aIdx];
+	}
+	elseif( !is_integer($aIdx) || 
+		(is_integer($aIdx) && $aIdx > $this->maxidx ) ) {
+	    JpGraphError::RaiseL(23002,$this->name);
+//('Mark color index too large for marker "'.($this->name).'"');
+	}
+	else
+	    $idx = $aIdx ;
+	return Image::CreateFromString(base64_decode($this->{$n}[$idx][1]));   
+    }
+    function GetAnchor() {
+	return array($this->anchor_x,$this->anchor_y);
+    }
+}
+
+
+// Keep a global flag cache to reduce memory usage
+$_gFlagCache=array(
+    1 => null,
+    2 => null,
+    3 => null,
+    4 => null,
+);
+// Only supposed to b called as statics
+class FlagCache {
+    function GetFlagImgByName($aSize,$aName) {
+	global $_gFlagCache;
+	require_once('jpgraph_flags.php');
+	if( $_gFlagCache[$aSize] === null ) {
+	    $_gFlagCache[$aSize] =& new FlagImages($aSize);
+	}
+	$f =& $_gFlagCache[$aSize];
+	$idx = $f->GetIdxByName($aName,$aFullName);
+	return $f->GetImgByIdx($idx);
+    }
+}
+
+//===================================================
+// CLASS PlotMark
+// Description: Handles the plot marks in graphs
+//===================================================
+class PlotMark {
+    var $title, $show=true;
+    var $type,$weight=1;
+    var $color="black", $width=4, $fill_color="blue";
+    var $yvalue,$xvalue='',$csimtarget,$csimalt,$csimareas;
+    var $iFormatCallback="";
+    var $iFormatCallback2="";
+    var $markimg='',$iScale=1.0;
+    var $oldfilename='',$iFileName='';
+    var $imgdata_balls = null;
+    var $imgdata_diamonds = null;
+    var $imgdata_squares = null;
+    var $imgdata_bevels = null;
+    var $imgdata_stars = null;
+    var $imgdata_pushpins = null;
+
+//--------------
+// CONSTRUCTOR
+    function PlotMark() {
+	$this->title = new Text();
+	$this->title->Hide();
+	$this->csimareas = '';
+	$this->csimalt = '';
+	$this->type=-1;
+    }
+//---------------
+// PUBLIC METHODS	
+    function SetType($aType,$aFileName='',$aScale=1.0) {
+	$this->type = $aType;
+	if( $aType == MARK_IMG && $aFileName=='' ) {
+	    JpGraphError::RaiseL(23003);//('A filename must be specified if you set the mark type to MARK_IMG.');
+	}
+	$this->iFileName = $aFileName;
+	$this->iScale = $aScale;
+    }
+	
+    function SetCallback($aFunc) {
+	$this->iFormatCallback = $aFunc;
+    }
+
+    function SetCallbackYX($aFunc) {
+	$this->iFormatCallback2 = $aFunc;
+    }
+    
+    function GetType() {
+	return $this->type;
+    }
+	
+    function SetColor($aColor) {
+	$this->color=$aColor;
+    }
+	
+    function SetFillColor($aFillColor) {
+	$this->fill_color = $aFillColor;
+    }
+
+    function SetWeight($aWeight) {
+	$this->weight = $aWeight;
+    }
+
+    // Synonym for SetWidth()
+    function SetSize($aWidth) {
+	$this->width=$aWidth;
+    }
+	
+    function SetWidth($aWidth) {
+	$this->width=$aWidth;
+    }
+
+    function SetDefaultWidth() {
+	switch( $this->type ) {
+	    case MARK_CIRCLE: 
+	    case MARK_FILLEDCIRCLE: 
+		$this->width=4;
+		break;
+	    default:
+		$this->width=7;
+	}
+    }
+	
+    function GetWidth() {
+	return $this->width;
+    }
+	
+    function Hide($aHide=true) {
+	$this->show = !$aHide;
+    }
+	
+    function Show($aShow=true) {
+	$this->show = $aShow;
+    }
+
+    function SetCSIMAltVal($aY,$aX='') {
+        $this->yvalue=$aY; 
+        $this->xvalue=$aX; 
+    }
+    
+    function SetCSIMTarget($aTarget) {
+        $this->csimtarget=$aTarget;
+    }
+    
+    function SetCSIMAlt($aAlt) {
+        $this->csimalt=$aAlt;
+    }
+    
+    function GetCSIMAreas(){
+        return $this->csimareas;
+    }
+        
+    function AddCSIMPoly($aPts) {
+        $coords = round($aPts[0]).", ".round($aPts[1]);
+        $n = count($aPts)/2;
+        for( $i=1; $i < $n; ++$i){
+            $coords .= ", ".round($aPts[2*$i]).", ".round($aPts[2*$i+1]);
+        }
+        $this->csimareas="";    
+        if( !empty($this->csimtarget) ) {
+	    $this->csimareas .= "<area shape=\"poly\" coords=\"$coords\" href=\"".$this->csimtarget."\"";
+	    if( !empty($this->csimalt) ) {										
+		$tmp=sprintf($this->csimalt,$this->yvalue,$this->xvalue);
+		$this->csimareas .= " title=\"$tmp\"";
+	    }
+	    $this->csimareas .= " alt=\"$tmp\" />\n";
+	}
+    }
+    
+    function AddCSIMCircle($x,$y,$r) {
+    	$x = round($x); $y=round($y); $r=round($r);
+        $this->csimareas="";    
+        if( !empty($this->csimtarget) ) {
+	    $this->csimareas .= "<area shape=\"circle\" coords=\"$x,$y,$r\" href=\"".$this->csimtarget."\"";
+    	    if( !empty($this->csimalt) ) {										
+		$tmp=sprintf($this->csimalt,$this->yvalue,$this->xvalue);
+		$this->csimareas .= " title=\"$tmp\"";
+	    }
+            $this->csimareas .= " alt=\"$tmp\" />\n";        
+        }
+    }
+    	
+    function Stroke(&$img,$x,$y) {
+	if( !$this->show ) return;
+
+	if( $this->iFormatCallback != '' || $this->iFormatCallback2 != '' ) {
+
+	    if( $this->iFormatCallback != '' ) {
+		$f = $this->iFormatCallback;
+		list($width,$color,$fcolor) = call_user_func($f,$this->yvalue);
+		$filename = $this->iFileName;
+		$imgscale = $this->iScale;
+	    }
+	    else {
+		$f = $this->iFormatCallback2;
+		list($width,$color,$fcolor,$filename,$imgscale) = call_user_func($f,$this->yvalue,$this->xvalue);
+		if( $filename=="" ) $filename = $this->iFileName;
+		if( $imgscale=="" ) $imgscale = $this->iScale;
+	    }
+
+	    if( $width=="" ) $width = $this->width;
+	    if( $color=="" ) $color = $this->color;
+	    if( $fcolor=="" ) $fcolor = $this->fill_color;
+
+	}
+	else {
+	    $fcolor = $this->fill_color;
+	    $color = $this->color;
+	    $width = $this->width;
+	    $filename = $this->iFileName;
+	    $imgscale = $this->iScale;
+	}
+
+	if( $this->type == MARK_IMG ||
+	    ($this->type >= MARK_FLAG1 && $this->type <= MARK_FLAG4 ) ||
+	    $this->type >= MARK_IMG_PUSHPIN ) {
+
+	    // Note: For the builtin images we use the "filename" parameter
+	    // to denote the color
+	    $anchor_x = 0.5;
+	    $anchor_y = 0.5; 
+	    switch( $this->type ) {
+		case MARK_FLAG1:
+		case MARK_FLAG2:
+		case MARK_FLAG3:
+		case MARK_FLAG4:
+		    $this->markimg = FlagCache::GetFlagImgByName($this->type-MARK_FLAG1+1,$filename);
+		    break;
+
+		case MARK_IMG :
+		    // Load an image and use that as a marker
+		    // Small optimization, if we have already read an image don't
+		    // waste time reading it again.
+		    if( $this->markimg == '' || !($this->oldfilename === $filename) ) {
+			$this->markimg = Graph::LoadBkgImage('',$filename);
+			$this->oldfilename = $filename ;
+		    }
+		    break;
+
+		case MARK_IMG_PUSHPIN:
+		case MARK_IMG_SPUSHPIN:
+		case MARK_IMG_LPUSHPIN:
+		    if( $this->imgdata_pushpins == null ) {
+			require_once 'imgdata_pushpins.inc';
+			$this->imgdata_pushpins = new ImgData_PushPins();
+		    }
+		    $this->markimg = $this->imgdata_pushpins->GetImg($this->type,$filename);
+		    list($anchor_x,$anchor_y) = $this->imgdata_pushpins->GetAnchor();
+		    break;
+
+		case MARK_IMG_SQUARE:
+		    if( $this->imgdata_squares == null ) {
+			require_once 'imgdata_squares.inc';
+			$this->imgdata_squares = new ImgData_Squares();
+		    }
+		    $this->markimg = $this->imgdata_squares->GetImg($this->type,$filename);
+		    list($anchor_x,$anchor_y) = $this->imgdata_squares->GetAnchor();
+		    break;
+
+		case MARK_IMG_STAR:
+		    if( $this->imgdata_stars == null ) {
+			require_once 'imgdata_stars.inc';
+			$this->imgdata_stars = new ImgData_Stars();
+		    }
+		    $this->markimg = $this->imgdata_stars->GetImg($this->type,$filename);
+		    list($anchor_x,$anchor_y) = $this->imgdata_stars->GetAnchor();
+		    break;
+
+		case MARK_IMG_BEVEL:
+		    if( $this->imgdata_bevels == null ) {
+			require_once 'imgdata_bevels.inc';
+			$this->imgdata_bevels = new ImgData_Bevels();
+		    }
+		    $this->markimg = $this->imgdata_bevels->GetImg($this->type,$filename);
+		    list($anchor_x,$anchor_y) = $this->imgdata_bevels->GetAnchor();
+		    break;
+
+		case MARK_IMG_DIAMOND:
+		    if( $this->imgdata_diamonds == null ) {
+			require_once 'imgdata_diamonds.inc';
+			$this->imgdata_diamonds = new ImgData_Diamonds();
+		    }
+		    $this->markimg = $this->imgdata_diamonds->GetImg($this->type,$filename);
+		    list($anchor_x,$anchor_y) = $this->imgdata_diamonds->GetAnchor();
+		    break;
+
+		case MARK_IMG_BALL:		    
+		case MARK_IMG_SBALL:		    
+		case MARK_IMG_MBALL:		    
+		case MARK_IMG_LBALL:		    
+		    if( $this->imgdata_balls == null ) {
+			require_once 'imgdata_balls.inc';
+			$this->imgdata_balls = new ImgData_Balls();
+		    }
+		    $this->markimg = $this->imgdata_balls->GetImg($this->type,$filename);
+		    list($anchor_x,$anchor_y) = $this->imgdata_balls->GetAnchor();
+		    break;
+	    }
+
+	    $w = $img->GetWidth($this->markimg);
+	    $h = $img->GetHeight($this->markimg);
+	    
+	    $dw = round($imgscale * $w );
+	    $dh = round($imgscale * $h );
+
+	    // Do potential rotation
+	    list($x,$y) = $img->Rotate($x,$y);
+
+	    $dx = round($x-$dw*$anchor_x);
+	    $dy = round($y-$dh*$anchor_y);
+	    
+	    $this->width = max($dx,$dy);
+	    
+	    $img->Copy($this->markimg,$dx,$dy,0,0,$dw,$dh,$w,$h);
+	    if( !empty($this->csimtarget) ) {
+		$this->csimareas = "<area shape=\"rect\" coords=\"".
+		    $dx.','.$dy.','.round($dx+$dw).','.round($dy+$dh).'" '.
+		    "href=\"".$this->csimtarget."\"";
+		if( !empty($this->csimalt) ) {
+		    $tmp=sprintf($this->csimalt,$this->yvalue,$this->xvalue);
+		    $this->csimareas .= " title=\"$tmp\"";
+		}
+		$this->csimareas .= " alt=\"$tmp\" />\n";
+	    }
+	    
+	    // Stroke title
+	    $this->title->Align("center","top");
+	    $this->title->Stroke($img,$x,$y+round($dh/2));			
+	    return;
+	}
+
+	$weight = $this->weight;
+	$dx=round($width/2,0);
+	$dy=round($width/2,0);
+	$pts=0;		
+
+	switch( $this->type ) {
+	    case MARK_SQUARE:
+		$c[]=$x-$dx;$c[]=$y-$dy;
+		$c[]=$x+$dx;$c[]=$y-$dy;
+		$c[]=$x+$dx;$c[]=$y+$dy;
+		$c[]=$x-$dx;$c[]=$y+$dy;
+		$c[]=$x-$dx;$c[]=$y-$dy;
+		$pts=5;
+		break;
+	    case MARK_UTRIANGLE:
+		++$dx;++$dy;
+		$c[]=$x-$dx;$c[]=$y+0.87*$dy;	// tan(60)/2*$dx
+		$c[]=$x;$c[]=$y-0.87*$dy;
+		$c[]=$x+$dx;$c[]=$y+0.87*$dy;
+		$c[]=$x-$dx;$c[]=$y+0.87*$dy;	// tan(60)/2*$dx
+		$pts=4;
+		break;
+	    case MARK_DTRIANGLE:
+		++$dx;++$dy;			
+		$c[]=$x;$c[]=$y+0.87*$dy;	// tan(60)/2*$dx
+		$c[]=$x-$dx;$c[]=$y-0.87*$dy;
+		$c[]=$x+$dx;$c[]=$y-0.87*$dy;
+		$c[]=$x;$c[]=$y+0.87*$dy;	// tan(60)/2*$dx
+		$pts=4;
+		break;				
+	    case MARK_DIAMOND:
+		$c[]=$x;$c[]=$y+$dy;
+		$c[]=$x-$dx;$c[]=$y;
+		$c[]=$x;$c[]=$y-$dy;
+		$c[]=$x+$dx;$c[]=$y;
+		$c[]=$x;$c[]=$y+$dy;
+		$pts=5;
+		break;	
+	    case MARK_LEFTTRIANGLE:
+		$c[]=$x;$c[]=$y;
+		$c[]=$x;$c[]=$y+2*$dy;
+		$c[]=$x+$dx*2;$c[]=$y;
+		$c[]=$x;$c[]=$y;
+		$pts=4;
+		break;
+	    case MARK_RIGHTTRIANGLE:
+		$c[]=$x-$dx*2;$c[]=$y;
+		$c[]=$x;$c[]=$y+2*$dy;
+		$c[]=$x;$c[]=$y;
+		$c[]=$x-$dx*2;$c[]=$y;
+		$pts=4;
+		break;
+	    case MARK_FLASH:
+		$dy *= 2;
+		$c[]=$x+$dx/2; $c[]=$y-$dy;
+		$c[]=$x-$dx+$dx/2; $c[]=$y+$dy*0.7-$dy;
+		$c[]=$x+$dx/2; $c[]=$y+$dy*1.3-$dy;
+		$c[]=$x-$dx+$dx/2; $c[]=$y+2*$dy-$dy;
+		$img->SetLineWeight($weight);
+		$img->SetColor($color);					
+		$img->Polygon($c);
+		$img->SetLineWeight(1);
+		$this->AddCSIMPoly($c);
+		break;
+	}
+
+	if( $pts>0 ) {
+	    $this->AddCSIMPoly($c);
+	    $img->SetLineWeight($weight);
+	    $img->SetColor($fcolor);								
+	    $img->FilledPolygon($c);
+	    $img->SetColor($color);					
+	    $img->Polygon($c);
+	    $img->SetLineWeight(1);
+	}
+	elseif( $this->type==MARK_CIRCLE ) {
+	    $img->SetColor($color);					
+	    $img->Circle($x,$y,$width);
+	    $this->AddCSIMCircle($x,$y,$width);
+	}
+	elseif( $this->type==MARK_FILLEDCIRCLE ) {
+	    $img->SetColor($fcolor);		
+	    $img->FilledCircle($x,$y,$width);
+	    $img->SetColor($color);	
+	    $img->Circle($x,$y,$width);
+	    $this->AddCSIMCircle($x,$y,$width);
+	}
+	elseif( $this->type==MARK_CROSS ) {
+	    // Oversize by a pixel to match the X
+	    $img->SetColor($color);
+	    $img->SetLineWeight($weight);
+	    $img->Line($x,$y+$dy+1,$x,$y-$dy-1);
+	    $img->Line($x-$dx-1,$y,$x+$dx+1,$y);
+	    $this->AddCSIMCircle($x,$y,$dx);	    
+	}
+	elseif( $this->type==MARK_X ) {
+	    $img->SetColor($color);
+	    $img->SetLineWeight($weight);
+	    $img->Line($x+$dx,$y+$dy,$x-$dx,$y-$dy);
+	    $img->Line($x-$dx,$y+$dy,$x+$dx,$y-$dy);		
+	    $this->AddCSIMCircle($x,$y,$dx+$dy);	    	    
+	}			
+	elseif( $this->type==MARK_STAR ) {
+	    $img->SetColor($color);
+	    $img->SetLineWeight($weight);
+	    $img->Line($x+$dx,$y+$dy,$x-$dx,$y-$dy);
+	    $img->Line($x-$dx,$y+$dy,$x+$dx,$y-$dy);
+	    // Oversize by a pixel to match the X				
+	    $img->Line($x,$y+$dy+1,$x,$y-$dy-1);
+	    $img->Line($x-$dx-1,$y,$x+$dx+1,$y);
+	    $this->AddCSIMCircle($x,$y,$dx+$dy);	    
+	}
+		
+	// Stroke title
+	$this->title->Align("center","center");
+	$this->title->Stroke($img,$x,$y);			
+    }
+} // Class
+
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_polar.php php-syslog-ng/html/includes/jpgraph/jpgraph_polar.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_polar.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_polar.php	2006-02-04 07:25:38.000000000 -0500
@@ -0,0 +1,845 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_POLAR.PHP
+// Description:	Polar plot extension for JpGraph
+// Created: 	2003-02-02
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_polar.php 487 2006-02-04 12:25:38Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+require_once ('jpgraph_plotmark.inc');
+
+
+require_once "jpgraph_log.php";
+
+
+DEFINE('POLAR_360',1);
+DEFINE('POLAR_180',2);
+
+//
+// Note. Don't attempt to make sense of this code.
+// In order not to have to be able to inherit the scaling code
+// from the main graph package we have had to make some "tricks" since
+// the original scaling and axis was not designed to do what is
+// required here.
+// There were two option. 1: Re-implement everything and get a clean design
+// and 2: do some "small" trickery and be able to inherit most of
+// the functionlity from the main graph package. 
+// We choose 2: here in order to save some time.
+// 
+
+//--------------------------------------------------------------------------
+// class PolarPlot
+//--------------------------------------------------------------------------
+class PolarPlot {
+    var $numpoints=0;
+    var $iColor='navy',$iFillColor='';
+    var $iLineWeight=1;
+    var $coord=null;
+    var $legendcsimtarget='';
+    var $legendcsimalt='';
+    var $legend="";
+    var $csimtargets=array();	// Array of targets for CSIM
+    var $csimareas="";			// Resultant CSIM area tags	
+    var $csimalts=null;			// ALT:s for corresponding target
+    var $line_style='solid',$mark;
+
+    function PolarPlot($aData) {
+	$n = count($aData);
+	if( $n & 1 ) {
+	    JpGraphError::RaiseL(17001);
+//('Polar plots must have an even number of data point. Each data point is a tuple (angle,radius).');
+	}
+	$this->numpoints = $n/2;
+	$this->coord = $aData;
+	$this->mark = new PlotMark();
+    }
+
+    function SetWeight($aWeight) {
+	$this->iLineWeight = $aWeight;
+    }
+
+    function SetColor($aColor){
+	$this->iColor = $aColor;
+    }
+
+    function SetFillColor($aColor){
+	$this->iFillColor = $aColor;
+    }
+
+    function Max() {
+	$m = $this->coord[1];
+	$i=1;
+	while( $i < $this->numpoints ) {
+	    $m = max($m,$this->coord[2*$i+1]);  
+	    ++$i;
+	} 
+	return $m;
+    }
+    // Set href targets for CSIM	
+    function SetCSIMTargets($aTargets,$aAlts=null) {
+	$this->csimtargets=$aTargets;
+	$this->csimalts=$aAlts;		
+    }
+ 	
+    // Get all created areas
+    function GetCSIMareas() {
+	return $this->csimareas;
+    }	
+	
+    function SetLegend($aLegend,$aCSIM="",$aCSIMAlt="") {
+	$this->legend = $aLegend;
+	$this->legendcsimtarget = $aCSIM;
+	$this->legendcsimalt = $aCSIMAlt;
+    }
+
+    // Private methods
+
+    function Legend(&$aGraph) {
+	$color = $this->iColor ;
+	if( $this->legend != "" ) {
+	    if( $this->iFillColor!='' ) {
+		$color = $this->iFillColor;
+		$aGraph->legend->Add($this->legend,$color,$this->mark,0,
+				     $this->legendcsimtarget,$this->legendcsimalt);    
+	    }
+	    else {
+		$aGraph->legend->Add($this->legend,$color,$this->mark,$this->line_style,
+				     $this->legendcsimtarget,$this->legendcsimalt);    
+	    }
+	}
+    }
+
+    function Stroke(&$img,$scale) {
+
+	$i=0;
+	$p=array();
+	$this->csimareas='';
+	while($i < $this->numpoints) {
+	    list($x1,$y1) = $scale->PTranslate($this->coord[2*$i],$this->coord[2*$i+1]);
+	    $p[2*$i] = $x1;
+	    $p[2*$i+1] = $y1;
+	
+	    if( isset($this->csimtargets[$i]) ) {
+	        $this->mark->SetCSIMTarget($this->csimtargets[$i]);
+	        $this->mark->SetCSIMAlt($this->csimalts[$i]);
+		$this->mark->SetCSIMAltVal($this->coord[2*$i], $this->coord[2*$i+1]);
+		$this->mark->Stroke($img,$x1,$y1);
+		$this->csimareas .= $this->mark->GetCSIMAreas();
+	    }
+	    else
+		$this->mark->Stroke($img,$x1,$y1);
+
+	    ++$i;
+	}
+
+	if( $this->iFillColor != '' ) {
+	    $img->SetColor($this->iFillColor);
+	    $img->FilledPolygon($p);
+	}
+	$img->SetLineWeight($this->iLineWeight);
+	$img->SetColor($this->iColor);
+	$img->Polygon($p,$this->iFillColor!='');
+    }
+}
+
+//--------------------------------------------------------------------------
+// class PolarAxis
+//--------------------------------------------------------------------------
+class PolarAxis extends Axis {
+    var $angle_step=15,$angle_color='lightgray',$angle_label_color='black';
+    var $angle_fontfam=FF_FONT1,$angle_fontstyle=FS_NORMAL,$angle_fontsize=10;
+    var $angle_fontcolor = 'navy';
+    var $gridminor_color='lightgray',$gridmajor_color='lightgray';
+    var $show_minor_grid = false, $show_major_grid = true ;
+    var $show_angle_mark=true, $show_angle_grid=true, $show_angle_label=true;
+    var $angle_tick_len=3, $angle_tick_len2=3, $angle_tick_color='black';
+    var $show_angle_tick=true;
+    var $radius_tick_color='black';
+
+    function PolarAxis(&$img,&$aScale) {
+	parent::Axis($img,$aScale);
+    }
+
+    function ShowAngleDegreeMark($aFlg=true) {
+	$this->show_angle_mark = $aFlg;
+    }
+
+    function SetAngleStep($aStep) {
+	$this->angle_step=$aStep;
+    }
+
+    function HideTicks($aFlg=true,$aAngleFlg=true) {
+	parent::HideTicks($aFlg,$aFlg);
+	$this->show_angle_tick = !$aAngleFlg;
+    }
+
+    function ShowAngleLabel($aFlg=true) {
+	$this->show_angle_label = $aFlg;
+    }
+
+    function ShowGrid($aMajor=true,$aMinor=false,$aAngle=true) {
+	$this->show_minor_grid = $aMinor;
+	$this->show_major_grid = $aMajor;
+	$this->show_angle_grid = $aAngle ;
+    }
+
+    function SetAngleFont($aFontFam,$aFontStyle=FS_NORMAL,$aFontSize=10) {
+	$this->angle_fontfam = $aFontFam;
+	$this->angle_fontstyle = $aFontStyle;
+	$this->angle_fontsize = $aFontSize;
+    }
+
+    function SetColor($aColor,$aRadColor='',$aAngleColor='') {
+	if( $aAngleColor == '' )
+	    $aAngleColor=$aColor;
+	parent::SetColor($aColor,$aRadColor);
+	$this->angle_fontcolor = $aAngleColor;
+    }
+
+    function SetGridColor($aMajorColor,$aMinorColor='',$aAngleColor='') {
+	if( $aMinorColor == '' ) 
+	    $aMinorColor = $aMajorColor;
+	if( $aAngleColor == '' ) 
+	    $aAngleColor = $aMajorColor;
+
+	$this->gridminor_color = $aMinorColor;
+	$this->gridmajor_color = $aMajorColor;
+	$this->angle_color = $aAngleColor;
+    }
+
+    function SetTickColors($aRadColor,$aAngleColor='') {
+	$this->radius_tick_color = $aRadColor;
+	$this->angle_tick_color = $aAngleColor;
+    }
+    
+    // Private methods
+    function StrokeGrid($pos) {
+	$x = round($this->img->left_margin + $this->img->plotwidth/2);
+	$this->scale->ticks->Stroke($this->img,$this->scale,$pos);
+
+	// Stroke the minor arcs 
+	$pmin = array();
+	$p = $this->scale->ticks->ticks_pos;
+	$n = count($p);
+	$i = 0;
+	$this->img->SetColor($this->gridminor_color);
+	while( $i < $n ) {
+	    $r = $p[$i]-$x+1;
+	    $pmin[]=$r;
+	    if( $this->show_minor_grid ) {
+		$this->img->Circle($x,$pos,$r);
+	    }
+	    $i++;
+	}
+	
+	$limit = max($this->img->plotwidth,$this->img->plotheight)*1.4 ;
+	while( $r < $limit ) {
+	    $off = $r;
+	    $i=1;
+	    $r = $off + round($p[$i]-$x+1);
+	    while( $r < $limit && $i < $n ) {
+		$r = $off+$p[$i]-$x;
+		$pmin[]=$r;
+		if( $this->show_minor_grid ) {
+		    $this->img->Circle($x,$pos,$r);
+		}
+		$i++;
+	    }
+	}
+
+	// Stroke the major arcs 
+	if( $this->show_major_grid ) {
+	    // First determine how many minor step on
+	    // every major step. We have recorded the minor radius
+	    // in pmin and use these values. This is done in order
+	    // to avoid rounding errors if we were to recalculate the
+	    // different major radius.
+	    $pmaj = $this->scale->ticks->maj_ticks_pos;
+	    $p = $this->scale->ticks->ticks_pos;
+	    if( $this->scale->name == 'lin' ) {
+		$step=round(($pmaj[1] - $pmaj[0])/($p[1] - $p[0]));
+	    }
+	    else {
+		$step=9;
+	    }
+	    $n = round(count($pmin)/$step);
+	    $i = 0;
+	    $this->img->SetColor($this->gridmajor_color);
+	    $limit = max($this->img->plotwidth,$this->img->plotheight)*1.4 ;
+	    $off = $r;
+	    $i=0;
+	    $r = $pmin[$i*$step];
+	    while( $r < $limit && $i < $n ) {
+		$r = $pmin[$i*$step];
+		$this->img->Circle($x,$pos,$r);
+		$i++;
+	    }
+	}
+
+	// Draw angles
+	if( $this->show_angle_grid ) {
+	    $this->img->SetColor($this->angle_color);
+	    $d = max($this->img->plotheight,$this->img->plotwidth)*1.4 ;
+	    $a = 0;
+	    $p = $this->scale->ticks->ticks_pos;
+	    $start_radius = $p[1]-$x;
+	    while( $a < 360 ) {
+		if( $a == 90 || $a == 270 ) {
+		    // Make sure there are no rounding problem with
+		    // exactly vertical lines
+		    $this->img->Line($x+$start_radius*cos($a/180*M_PI)+1,
+				     $pos-$start_radius*sin($a/180*M_PI),
+				     $x+$start_radius*cos($a/180*M_PI)+1,
+				     $pos-$d*sin($a/180*M_PI));
+		    
+		}
+		else {
+		    $this->img->Line($x+$start_radius*cos($a/180*M_PI)+1,
+				     $pos-$start_radius*sin($a/180*M_PI),
+				     $x+$d*cos($a/180*M_PI),
+				     $pos-$d*sin($a/180*M_PI));
+		}
+		$a += $this->angle_step;
+	    }
+	}
+    }
+
+    function StrokeAngleLabels($pos,$type) {
+
+	if( !$this->show_angle_label ) 
+	    return;
+	
+	$x0 = round($this->img->left_margin+$this->img->plotwidth/2)+1;
+
+	$d = max($this->img->plotwidth,$this->img->plotheight)*1.42;
+	$a = $this->angle_step;
+	$t = new Text();
+	$t->SetColor($this->angle_fontcolor);
+	$t->SetFont($this->angle_fontfam,$this->angle_fontstyle,$this->angle_fontsize);
+	$xright = $this->img->width - $this->img->right_margin;
+	$ytop = $this->img->top_margin;
+	$xleft = $this->img->left_margin;
+	$ybottom = $this->img->height - $this->img->bottom_margin;
+	$ha = 'left';
+	$va = 'center';
+	$w = $this->img->plotwidth/2;
+	$h = $this->img->plotheight/2;
+	$xt = $x0; $yt = $pos;
+	$margin=5;
+
+	$tl  = $this->angle_tick_len ; // Outer len
+	$tl2 = $this->angle_tick_len2 ; // Interior len
+
+	$this->img->SetColor($this->angle_tick_color);
+	$rot90 = $this->img->a == 90 ;
+
+	if( $type == POLAR_360 ) {
+	    $ca1 = atan($h/$w)/M_PI*180;
+	    $ca2 = 180-$ca1;
+	    $ca3 = $ca1+180;
+	    $ca4 = 360-$ca1;
+	    $end = 360;
+	    while( $a < $end ) {
+		$ca = cos($a/180*M_PI);
+		$sa = sin($a/180*M_PI);
+		$x = $d*$ca;
+		$y = $d*$sa;
+		$xt=1000;$yt=1000;
+		if( $a <= $ca1 || $a >= $ca4 ) {
+		    $yt = $pos - $w * $y/$x;
+		    $xt = $xright + $margin;
+ 		    if( $rot90 ) {
+			$ha = 'center';
+			$va = 'top';
+		    }
+		    else {
+			$ha = 'left';
+			$va = 'center';
+		    }
+		    $x1=$xright-$tl2; $x2=$xright+$tl;
+		    $y1=$y2=$yt;
+		}
+		elseif( $a > $ca1 && $a < $ca2 ) { 
+		    $xt = $x0 + $h * $x/$y;
+		    $yt = $ytop - $margin;
+ 		    if( $rot90 ) {
+			$ha = 'left';
+			$va = 'center';
+		    }
+		    else {
+			$ha = 'center';
+			$va = 'bottom';
+		    }
+		    $y1=$ytop+$tl2;$y2=$ytop-$tl;
+		    $x1=$x2=$xt;
+		}
+		elseif( $a >= $ca2 && $a <= $ca3 ) { 
+		    $yt = $pos + $w * $y/$x;
+		    $xt = $xleft - $margin;
+ 		    if( $rot90 ) {
+			$ha = 'center';
+			$va = 'bottom';
+		    }
+		    else {
+			$ha = 'right';
+			$va = 'center';
+		    }
+		    $x1=$xleft+$tl2;$x2=$xleft-$tl;
+		    $y1=$y2=$yt;
+		}
+		else { 
+		    $xt = $x0 - $h * $x/$y;
+		    $yt = $ybottom + $margin;
+ 		    if( $rot90 ) {
+			$ha = 'right';
+			$va = 'center';
+		    }
+		    else {
+			$ha = 'center';
+			$va = 'top';
+		    }
+		    $y1=$ybottom-$tl2;$y2=$ybottom+$tl;
+		    $x1=$x2=$xt;
+		}
+		if( $a != 0 && $a != 180 ) {
+		    $t->Align($ha,$va);
+		    if( $this->show_angle_mark )
+			$a .= '';
+		    $t->Set($a);
+		    $t->Stroke($this->img,$xt,$yt);   
+		    if( $this->show_angle_tick )
+			$this->img->Line($x1,$y1,$x2,$y2);
+		}
+		$a += $this->angle_step;
+	    }
+	}
+	else {
+	    // POLAR_HALF
+	    $ca1 = atan($h/$w*2)/M_PI*180;
+	    $ca2 = 180-$ca1;
+	    $end = 180;	    
+	    while( $a < $end ) {
+		$ca = cos($a/180*M_PI);
+		$sa = sin($a/180*M_PI);
+		$x = $d*$ca;
+		$y = $d*$sa;
+		if( $a <= $ca1 ) {
+		    $yt = $pos - $w * $y/$x;
+		    $xt = $xright + $margin;
+ 		    if( $rot90 ) {
+			$ha = 'center';
+			$va = 'top';
+		    }
+		    else {
+			$ha = 'left';
+			$va = 'center';
+		    }
+		    $x1=$xright-$tl2; $x2=$xright+$tl;
+		    $y1=$y2=$yt;
+		}
+		elseif( $a > $ca1 && $a < $ca2 ) { 
+		    $xt = $x0 + 2*$h * $x/$y;
+		    $yt = $ytop - $margin;
+ 		    if( $rot90 ) {
+			$ha = 'left';
+			$va = 'center';
+		    }
+		    else {
+			$ha = 'center';
+			$va = 'bottom';
+		    }
+		    $y1=$ytop+$tl2;$y2=$ytop-$tl;
+		    $x1=$x2=$xt;
+		}
+		elseif( $a >= $ca2 ) { 
+		    $yt = $pos + $w * $y/$x;
+		    $xt = $xleft - $margin;
+ 		    if( $rot90 ) {
+			$ha = 'center';
+			$va = 'bottom';
+		    }
+		    else {
+			$ha = 'right';
+			$va = 'center';
+		    }
+		    $x1=$xleft+$tl2;$x2=$xleft-$tl;
+		    $y1=$y2=$yt;
+		}
+		$t->Align($ha,$va);
+		if( $this->show_angle_mark )
+		    $a .= '';
+		$t->Set($a);
+		$t->Stroke($this->img,$xt,$yt);  
+		if( $this->show_angle_tick )
+		    $this->img->Line($x1,$y1,$x2,$y2);  
+		$a += $this->angle_step;
+	    }
+	}
+    }
+
+    function Stroke($pos) {
+
+	$this->img->SetLineWeight($this->weight);
+	$this->img->SetColor($this->color);		
+	$this->img->SetFont($this->font_family,$this->font_style,$this->font_size);
+	if( !$this->hide_line ) 
+	    $this->img->FilledRectangle($this->img->left_margin,$pos,
+		     $this->img->width-$this->img->right_margin,$pos+$this->weight-1);
+	$y=$pos+$this->img->GetFontHeight()+$this->title_margin+$this->title->margin;
+	if( $this->title_adjust=="high" )
+	    $this->title->Pos($this->img->width-$this->img->right_margin,$y,"right","top");
+	elseif( $this->title_adjust=="middle" || $this->title_adjust=="center" ) 
+	    $this->title->Pos(($this->img->width-$this->img->left_margin-
+			       $this->img->right_margin)/2+$this->img->left_margin,
+			      $y,"center","top");
+	elseif($this->title_adjust=="low")
+	    $this->title->Pos($this->img->left_margin,$y,"left","top");
+	else {	
+	    JpGraphError::RaiseL(17002,$this->title_adjust);
+//('Unknown alignment specified for X-axis title. ('.$this->title_adjust.')');
+	}
+
+	
+	if (!$this->hide_labels) {
+	    $this->StrokeLabels($pos,false);
+	}
+	$this->img->SetColor($this->radius_tick_color);
+	$this->scale->ticks->Stroke($this->img,$this->scale,$pos);
+
+	//
+	// Mirror the positions for the left side of the scale
+        //
+	$mid = 2*($this->img->left_margin+$this->img->plotwidth/2);
+	$n = count($this->scale->ticks->ticks_pos);
+	$i=0;
+	while( $i < $n ) {
+	    $this->scale->ticks->ticks_pos[$i] = 
+		$mid-$this->scale->ticks->ticks_pos[$i] ;
+	    ++$i;
+	}
+
+	$n = count($this->scale->ticks->maj_ticks_pos);
+	$i=0;
+	while( $i < $n ) {
+	    $this->scale->ticks->maj_ticks_pos[$i] = 
+		$mid-$this->scale->ticks->maj_ticks_pos[$i] ;
+	    ++$i;
+	}
+	
+	$n = count($this->scale->ticks->maj_ticklabels_pos);
+	$i=1;
+	while( $i < $n ) {
+	    $this->scale->ticks->maj_ticklabels_pos[$i] =
+		$mid-$this->scale->ticks->maj_ticklabels_pos[$i] ;
+	    ++$i;
+	}
+
+	// Draw the left side of the scale
+	$n = count($this->scale->ticks->ticks_pos);
+	$yu = $pos - $this->scale->ticks->direction*$this->scale->ticks->GetMinTickAbsSize();
+
+
+	// Minor ticks
+	if( ! $this->scale->ticks->supress_minor_tickmarks ) {
+	    $i=1;
+	    while( $i < $n/2 ) {
+		$x = round($this->scale->ticks->ticks_pos[$i]) ;
+		$this->img->Line($x,$pos,$x,$yu);
+		++$i;
+	    }
+	}
+
+	$n = count($this->scale->ticks->maj_ticks_pos);
+	$yu = $pos - $this->scale->ticks->direction*$this->scale->ticks->GetMajTickAbsSize();
+
+
+	// Major ticks
+	if( ! $this->scale->ticks->supress_tickmarks ) {
+	    $i=1;
+	    while( $i < $n/2 ) {
+		$x = round($this->scale->ticks->maj_ticks_pos[$i]) ;
+		$this->img->Line($x,$pos,$x,$yu);
+		++$i;
+	    }
+	}
+	if (!$this->hide_labels) {
+	    $this->StrokeLabels($pos,false);
+	}
+	$this->title->Stroke($this->img);	
+    }
+}
+
+class PolarScale extends LinearScale {
+    var $graph;
+    function PolarScale($aMax=0,&$graph) {
+	parent::LinearScale(0,$aMax,'x');
+	$this->graph = &$graph;
+    }
+
+    function _Translate($v) {
+	return parent::Translate($v);
+    }
+
+    function PTranslate($aAngle,$aRad) {
+	
+	$m = $this->scale[1];
+	$w = $this->graph->img->plotwidth/2;
+	$aRad = $aRad/$m*$w;
+
+	$x = cos( $aAngle/180 * M_PI ) * $aRad;
+	$y = sin( $aAngle/180 * M_PI ) * $aRad;
+
+	$x += $this->_Translate(0);
+
+	if( $this->graph->iType == POLAR_360 ) {
+	    $y = ($this->graph->img->top_margin + $this->graph->img->plotheight/2) - $y;
+	}
+	else {
+	    $y = ($this->graph->img->top_margin + $this->graph->img->plotheight) - $y;
+	}
+	return array($x,$y);
+    }
+}
+
+class PolarLogScale extends LogScale {
+    var $graph;
+    function PolarLogScale($aMax=1,&$graph) {
+	parent::LogScale(0,$aMax,'x');
+	$this->graph = &$graph;
+	$this->ticks->SetLabelLogType(LOGLABELS_MAGNITUDE);
+
+    }
+
+    function PTranslate($aAngle,$aRad) {
+
+	if( $aRad == 0 ) 
+	    $aRad = 1;
+	$aRad = log10($aRad);
+	$m = $this->scale[1];
+	$w = $this->graph->img->plotwidth/2;
+	$aRad = $aRad/$m*$w;
+
+	$x = cos( $aAngle/180 * M_PI ) * $aRad;
+	$y = sin( $aAngle/180 * M_PI ) * $aRad;
+
+	$x += $w+$this->graph->img->left_margin;//$this->_Translate(0);
+	if( $this->graph->iType == POLAR_360 ) {
+	    $y = ($this->graph->img->top_margin + $this->graph->img->plotheight/2) - $y;
+	}
+	else {
+	    $y = ($this->graph->img->top_margin + $this->graph->img->plotheight) - $y;
+	}
+	return array($x,$y);
+    }
+}
+
+class PolarGraph extends Graph {
+    var $scale;
+    var $iType=POLAR_360;
+    var $axis;
+    
+    function PolarGraph($aWidth=300,$aHeight=200,$aCachedName="",$aTimeOut=0,$aInline=true) {
+	parent::Graph($aWidth,$aHeight,$aCachedName,$aTimeOut,$aInline) ;
+	$this->SetDensity(TICKD_DENSE);
+	$this->SetBox();
+	$this->SetMarginColor('white');
+    }
+
+    function SetDensity($aDense) {
+	$this->SetTickDensity(TICKD_NORMAL,$aDense);
+    }
+
+    function Set90AndMargin($lm=0,$rm=0,$tm=0,$bm=0) {
+	$adj = ($this->img->height - $this->img->width)/2;
+	$this->SetAngle(90);
+	$this->img->SetMargin($lm-$adj,$rm-$adj,$tm+$adj,$bm+$adj);
+	$this->img->SetCenter(floor($this->img->width/2),floor($this->img->height/2));
+	$this->axis->SetLabelAlign('right','center');
+	//JpGraphError::Raise('Set90AndMargin() is not supported for polar graphs.');
+    }
+
+    function SetScale($aScale,$rmax=0) {
+	if( $aScale == 'lin' ) 
+	    $this->scale = new PolarScale($rmax,$this);
+	elseif( $aScale == 'log' ) {
+	    $this->scale = new PolarLogScale($rmax,$this);
+	}
+	else {
+	    JpGraphError::RaiseL(17004);//('Unknown scale type for polar graph. Must be "lin" or "log"');
+	}
+
+	$this->axis = new PolarAxis($this->img,$this->scale);
+	$this->SetMargin(40,40,50,40);
+    }
+
+    function SetType($aType) {
+	$this->iType = $aType;
+    }
+
+    function SetPlotSize($w,$h) {
+	$this->SetMargin(($this->img->width-$w)/2,($this->img->width-$w)/2,
+			 ($this->img->height-$h)/2,($this->img->height-$h)/2);
+    }
+
+    // Private methods
+    function GetPlotsMax() {
+	$n = count($this->plots);
+	$m = $this->plots[0]->Max();
+	$i=1;
+	while($i < $n) {
+	    $m = max($this->plots[$i]->Max(),$m);
+	    ++$i;
+	}
+	return $m;
+    }
+
+    function Stroke($aStrokeFileName="") {
+
+	// Start by adjusting the margin so that potential titles will fit.
+	$this->AdjustMarginsForTitles();
+	    
+	// If the filename is the predefined value = '_csim_special_'
+	// we assume that the call to stroke only needs to do enough
+	// to correctly generate the CSIM maps.
+	// We use this variable to skip things we don't strictly need
+	// to do to generate the image map to improve performance
+	// a best we can. Therefor you will see a lot of tests !$_csim in the
+	// code below.
+	$_csim = ($aStrokeFileName===_CSIM_SPECIALFILE);
+
+	// We need to know if we have stroked the plot in the
+	// GetCSIMareas. Otherwise the CSIM hasn't been generated
+	// and in the case of GetCSIM called before stroke to generate
+	// CSIM without storing an image to disk GetCSIM must call Stroke.
+	$this->iHasStroked = true;
+
+	//Check if we should autoscale axis
+	if( !$this->scale->IsSpecified() && count($this->plots)>0 ) {
+	    $max = $this->GetPlotsMax();
+	    $t1 = $this->img->plotwidth;
+	    $this->img->plotwidth /= 2;
+	    $t2 = $this->img->left_margin;
+	    $this->img->left_margin += $this->img->plotwidth+1;
+	    $this->scale->AutoScale($this->img,0,$max,
+				     $this->img->plotwidth/$this->xtick_factor/2);
+	    $this->img->plotwidth = $t1;
+	    $this->img->left_margin = $t2;
+	}
+	else {
+	    // The tick calculation will use the user suplied min/max values to determine
+	    // the ticks. If auto_ticks is false the exact user specifed min and max
+	    // values will be used for the scale. 
+	    // If auto_ticks is true then the scale might be slightly adjusted
+	    // so that the min and max values falls on an even major step.
+	    //$min = 0;
+	    $max = $this->scale->scale[1];
+	    $t1 = $this->img->plotwidth;
+	    $this->img->plotwidth /= 2;
+	    $t2 = $this->img->left_margin;
+	    $this->img->left_margin += $this->img->plotwidth+1;
+	    $this->scale->AutoScale($this->img,0,$max,
+				     $this->img->plotwidth/$this->xtick_factor/2);
+	    $this->img->plotwidth = $t1;
+	    $this->img->left_margin = $t2;
+	}
+
+	if( $this->iType ==  POLAR_180 ) 
+	    $pos = $this->img->height - $this->img->bottom_margin;
+	else
+	    $pos = $this->img->plotheight/2 + $this->img->top_margin;
+
+
+	if( !$_csim ) {
+	    $this->StrokePlotArea();
+	}
+
+	$this->iDoClipping = true;
+
+	if( $this->iDoClipping ) {
+	    $oldimage = $this->img->CloneCanvasH();
+	}
+
+	if( !$_csim ) {
+	    $this->axis->StrokeGrid($pos);
+	}
+
+	// Stroke all plots for Y1 axis
+	for($i=0; $i < count($this->plots); ++$i) {
+	    $this->plots[$i]->Stroke($this->img,$this->scale);
+	}						
+
+
+	if( $this->iDoClipping ) {
+	    // Clipping only supports graphs at 0 and 90 degrees
+	    if( $this->img->a == 0  ) {
+		$this->img->CopyCanvasH($oldimage,$this->img->img,
+					$this->img->left_margin,$this->img->top_margin,
+					$this->img->left_margin,$this->img->top_margin,
+					$this->img->plotwidth+1,$this->img->plotheight+1);
+	    }
+	    elseif( $this->img->a == 90 ) {
+		$adj = round(($this->img->height - $this->img->width)/2);
+		$this->img->CopyCanvasH($oldimage,$this->img->img,
+					$this->img->bottom_margin-$adj,$this->img->left_margin+$adj,
+					$this->img->bottom_margin-$adj,$this->img->left_margin+$adj,
+					$this->img->plotheight,$this->img->plotwidth);
+	    }
+	    $this->img->Destroy();
+	    $this->img->SetCanvasH($oldimage);
+	}
+
+	if( !$_csim ) {
+	    $this->axis->Stroke($pos);
+	    $this->axis->StrokeAngleLabels($pos,$this->iType);
+	}
+
+	if( !$_csim ) {
+	    $this->StrokePlotBox();
+	    $this->footer->Stroke($this->img);
+
+	    // The titles and legends never gets rotated so make sure
+	    // that the angle is 0 before stroking them				
+	    $aa = $this->img->SetAngle(0);
+	    $this->StrokeTitles();
+	}
+
+	for($i=0; $i < count($this->plots) ; ++$i ) {
+	    $this->plots[$i]->Legend($this);
+	}
+
+	$this->legend->Stroke($this->img);		
+
+	if( !$_csim ) {
+
+	    $this->StrokeTexts();	
+	    $this->img->SetAngle($aa);	
+			
+	    // Draw an outline around the image map	
+	    if(_JPG_DEBUG)
+		$this->DisplayClientSideaImageMapAreas();		
+	    
+	    // Adjust the appearance of the image
+	    $this->AdjustSaturationBrightnessContrast();
+
+	    // If the filename is given as the special "__handle"
+	    // then the image handler is returned and the image is NOT
+	    // streamed back
+	    if( $aStrokeFileName == _IMG_HANDLER ) {
+		return $this->img->img;
+	    }
+	    else {
+		// Finally stream the generated picture					
+		$this->cache->PutAndStream($this->img,$this->cache_name,$this->inline,
+					   $aStrokeFileName);		
+	    }
+	}
+    }
+}
+
+
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_radar.php php-syslog-ng/html/includes/jpgraph/jpgraph_radar.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_radar.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_radar.php	2006-02-04 07:26:30.000000000 -0500
@@ -0,0 +1,647 @@
+<?php
+/*=======================================================================
+// File:	JPGRAPH_RADAR.PHP
+// Description: Radar plot extension for JpGraph
+// Created: 	2001-02-04
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_radar.php 489 2006-02-04 12:26:30Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+require_once('jpgraph_plotmark.inc');
+
+class RadarLogTicks extends Ticks {
+//---------------
+// CONSTRUCTOR
+    function RadarLogTicks() {
+    }
+//---------------
+// PUBLIC METHODS	
+
+    // TODO: Add Argument grid
+    function Stroke(&$aImg,&$grid,$aPos,$aAxisAngle,&$aScale,&$aMajPos,&$aMajLabel) {
+	$start = $aScale->GetMinVal();
+	$limit = $aScale->GetMaxVal();
+	$nextMajor = 10*$start;
+	$step = $nextMajor / 10.0;
+	$count=1; 
+				
+	$ticklen_maj=5;
+	$dx_maj=round(sin($aAxisAngle)*$ticklen_maj);
+	$dy_maj=round(cos($aAxisAngle)*$ticklen_maj);
+	$ticklen_min=3;
+	$dx_min=round(sin($aAxisAngle)*$ticklen_min);
+	$dy_min=round(cos($aAxisAngle)*$ticklen_min);
+			
+	$aMajPos=array();
+	$aMajLabel=array();
+			
+	if( $this->supress_first )
+	    $aMajLabel[]="";
+	else
+	    $aMajLabel[]=$start;	
+	$yr=$aScale->RelTranslate($start);	
+	$xt=round($yr*cos($aAxisAngle))+$aScale->scale_abs[0];
+	$yt=$aPos-round($yr*sin($aAxisAngle));
+	$aMajPos[]=$xt+2*$dx_maj;
+	$aMajPos[]=$yt-$aImg->GetFontheight()/2;
+	$grid[]=$xt;
+	$grid[]=$yt;
+
+	$aImg->SetLineWeight($this->weight);			
+		
+	for($y=$start; $y<=$limit; $y+=$step,++$count  ) {
+	    $yr=$aScale->RelTranslate($y);	
+	    $xt=round($yr*cos($aAxisAngle))+$aScale->scale_abs[0];
+	    $yt=$aPos-round($yr*sin($aAxisAngle));
+	    if( $count % 10 == 0 ) {
+		$grid[]=$xt;
+		$grid[]=$yt;
+		$aMajPos[]=$xt+2*$dx_maj;
+		$aMajPos[]=$yt-$aImg->GetFontheight()/2;							
+		if( !$this->supress_tickmarks )	{		
+		    if( $this->majcolor!="" ) $aImg->PushColor($this->majcolor);
+		    $aImg->Line($xt+$dx_maj,$yt+$dy_maj,$xt-$dx_maj,$yt-$dy_maj);
+		    if( $this->majcolor!="" ) $aImg->PopColor();
+		}
+		if( $this->label_formfunc != "" ) {
+		    $f=$this->label_formfunc;
+		    $l = call_user_func($f,$nextMajor);
+		}
+		else
+		    $l = $nextMajor;
+		$aMajLabel[]=$l;	
+		$nextMajor *= 10;
+		$step *= 10;	
+		$count=1; 				
+	    }
+	    else
+		if( !$this->supress_minor_tickmarks )	{
+		    if( $this->mincolor!="" ) $aImg->PushColor($this->mincolor);
+		    $aImg->Line($xt+$dx_min,$yt+$dy_min,$xt-$dx_min,$yt-$dy_min);
+		    if( $this->mincolor!="" ) $aImg->PopColor();
+		}
+	}		
+    }		
+}
+	
+class RadarLinearTicks extends LinearTicks {
+//---------------
+// CONSTRUCTOR
+    function RadarLinearTicks() {
+	// Empty
+    }
+
+//---------------
+// PUBLIC METHODS	
+
+    // TODO: Add argument grid
+    function Stroke(&$aImg,&$grid,$aPos,$aAxisAngle,&$aScale,&$aMajPos,&$aMajLabel) {
+	// Prepare to draw linear ticks
+	$maj_step_abs = abs($aScale->scale_factor*$this->major_step);	
+	$min_step_abs = abs($aScale->scale_factor*$this->minor_step);	
+	$nbrmaj = floor(($aScale->world_abs_size)/$maj_step_abs);
+	$nbrmin = floor(($aScale->world_abs_size)/$min_step_abs);
+	$skip = round($nbrmin/$nbrmaj); // Don't draw minor ontop of major
+
+	// Draw major ticks
+	$ticklen2=$this->major_abs_size;
+	$dx=round(sin($aAxisAngle)*$ticklen2);
+	$dy=round(cos($aAxisAngle)*$ticklen2);
+	$label=$aScale->scale[0]+$this->major_step;
+		
+	$aImg->SetLineWeight($this->weight);
+		
+	for($i=1; $i<=$nbrmaj; ++$i) {
+	    $xt=round($i*$maj_step_abs*cos($aAxisAngle))+$aScale->scale_abs[0];
+	    $yt=$aPos-round($i*$maj_step_abs*sin($aAxisAngle));
+
+	    if( $this->label_formfunc != "" ) {
+		$f=$this->label_formfunc;
+		$l = call_user_func($f,$label);
+	    }
+	    else
+		$l = $label;
+
+	    $aMajLabel[]=$l;
+	    $label += $this->major_step;
+	    $grid[]=$xt;
+	    $grid[]=$yt;
+	    $aMajPos[($i-1)*2]=$xt+2*$dx;
+	    $aMajPos[($i-1)*2+1]=$yt-$aImg->GetFontheight()/2;				
+	    if( !$this->supress_tickmarks ) {
+		if( $this->majcolor!="" ) $aImg->PushColor($this->majcolor);
+		$aImg->Line($xt+$dx,$yt+$dy,$xt-$dx,$yt-$dy);
+		if( $this->majcolor!="" ) $aImg->PopColor();
+	    }
+	}
+
+	// Draw minor ticks
+	$ticklen2=$this->minor_abs_size;
+	$dx=round(sin($aAxisAngle)*$ticklen2);
+	$dy=round(cos($aAxisAngle)*$ticklen2);
+	if( !$this->supress_tickmarks && !$this->supress_minor_tickmarks)	{
+	    if( $this->mincolor!="" ) $aImg->PushColor($this->mincolor);						
+	    for($i=1; $i<=$nbrmin; ++$i) {
+		if( ($i % $skip) == 0 ) continue;
+		$xt=round($i*$min_step_abs*cos($aAxisAngle))+$aScale->scale_abs[0];
+		$yt=$aPos-round($i*$min_step_abs*sin($aAxisAngle));
+		$aImg->Line($xt+$dx,$yt+$dy,$xt-$dx,$yt-$dy);
+	    }
+	    if( $this->mincolor!="" ) $aImg->PopColor();
+	}
+    }
+}
+
+	
+
+//===================================================
+// CLASS RadarAxis
+// Description: Implements axis for the radar graph
+//===================================================
+class RadarAxis extends Axis {
+    var $title_color="navy";
+    var $title=null;
+//---------------
+// CONSTRUCTOR
+    function RadarAxis(&$img,&$aScale,$color=array(0,0,0)) {
+	parent::Axis($img,$aScale,$color);
+	$this->len=$img->plotheight;
+	$this->title = new Text();
+	$this->title->SetFont(FF_FONT1,FS_BOLD);
+	$this->color = array(0,0,0);
+    }
+//---------------
+// PUBLIC METHODS	
+    function SetTickLabels($l) {
+	$this->ticks_label = $l;
+    }
+	
+	
+    // Stroke the axis 
+    // $pos 			= Vertical position of axis
+    // $aAxisAngle = Axis angle
+    // $grid			= Returns an array with positions used to draw the grid
+    //	$lf			= Label flag, TRUE if the axis should have labels
+    function Stroke($pos,$aAxisAngle,&$grid,$title,$lf) {
+	$this->img->SetColor($this->color);
+		
+	// Determine end points for the axis
+	$x=round($this->scale->world_abs_size*cos($aAxisAngle)+$this->scale->scale_abs[0]);
+	$y=round($pos-$this->scale->world_abs_size*sin($aAxisAngle));
+		
+	// Draw axis
+	$this->img->SetColor($this->color);
+	$this->img->SetLineWeight($this->weight);
+	if( !$this->hide )
+	    $this->img->Line($this->scale->scale_abs[0],$pos,$x,$y);
+	
+	$this->scale->ticks->Stroke($this->img,$grid,$pos,$aAxisAngle,$this->scale,$majpos,$majlabel);
+		
+	// Draw labels
+	if( $lf && !$this->hide ) {
+	    $this->img->SetFont($this->font_family,$this->font_style,$this->font_size);	
+	    $this->img->SetTextAlign("left","top");
+	    $this->img->SetColor($this->label_color);
+			
+	    // majpos contains (x,y) coordinates for labels
+	    if( ! $this->hide_labels ) {
+		$n = floor(count($majpos)/2);
+		for($i=0; $i < $n; ++$i) {
+		    if( $this->ticks_label != null && isset($this->ticks_label[$i]) )
+			$this->img->StrokeText($majpos[$i*2],$majpos[$i*2+1],$this->ticks_label[$i]);
+		    else
+			$this->img->StrokeText($majpos[$i*2],$majpos[$i*2+1],$majlabel[$i]);
+		}
+	    }
+	}
+	$this->_StrokeAxisTitle($pos,$aAxisAngle,$title);
+    }
+//---------------
+// PRIVATE METHODS	
+	
+    function _StrokeAxisTitle($pos,$aAxisAngle,$title) {
+	$this->title->Set($title);
+	$marg=6+$this->title->margin;
+	$xt=round(($this->scale->world_abs_size+$marg)*cos($aAxisAngle)+$this->scale->scale_abs[0]);
+	$yt=round($pos-($this->scale->world_abs_size+$marg)*sin($aAxisAngle));
+
+	// Position the axis title. 
+	// dx, dy is the offset from the top left corner of the bounding box that sorrounds the text
+	// that intersects with the extension of the corresponding axis. The code looks a little
+	// bit messy but this is really the only way of having a reasonable position of the
+	// axis titles.
+	if( $this->title->iWordwrap > 0 ) {
+	    $title = wordwrap($title,$this->title->iWordwrap,"\n");
+	}
+
+	$h=$this->img->GetTextHeight($title)*1.2;
+	$w=$this->img->GetTextWidth($title)*1.2;
+	while( $aAxisAngle > 2*M_PI ) $aAxisAngle -= 2*M_PI;
+
+	if( $aAxisAngle>=7*M_PI/4 || $aAxisAngle <= M_PI/4 ) $dx=0;
+	if( $aAxisAngle>=M_PI/4 && $aAxisAngle <= 3*M_PI/4 ) $dx=($aAxisAngle-M_PI/4)*2/M_PI; 
+	if( $aAxisAngle>=3*M_PI/4 && $aAxisAngle <= 5*M_PI/4 ) $dx=1;
+	if( $aAxisAngle>=5*M_PI/4 && $aAxisAngle <= 7*M_PI/4 ) $dx=(1-($aAxisAngle-M_PI*5/4)*2/M_PI);
+		
+	if( $aAxisAngle>=7*M_PI/4 ) $dy=(($aAxisAngle-M_PI)-3*M_PI/4)*2/M_PI;
+	if( $aAxisAngle<=M_PI/4 ) $dy=(1-$aAxisAngle*2/M_PI);
+	if( $aAxisAngle>=M_PI/4 && $aAxisAngle <= 3*M_PI/4 ) $dy=1;
+	if( $aAxisAngle>=3*M_PI/4 && $aAxisAngle <= 5*M_PI/4 ) $dy=(1-($aAxisAngle-3*M_PI/4)*2/M_PI);
+	if( $aAxisAngle>=5*M_PI/4 && $aAxisAngle <= 7*M_PI/4 ) $dy=0;
+		
+	if( !$this->hide ) {
+	    $this->title->Stroke($this->img,$xt-$dx*$w,$yt-$dy*$h,$title);
+	}
+    }
+		
+	
+} // Class
+
+
+//===================================================
+// CLASS RadarGrid
+// Description: Draws grid for the radar graph
+//===================================================
+class RadarGrid extends Grid {
+//------------
+// CONSTRUCTOR
+    function RadarGrid() {
+    }
+
+//----------------
+// PRIVATE METHODS	
+    function Stroke(&$img,&$grid) {
+	if( !$this->show ) return;
+	$nbrticks = count($grid[0])/2;
+	$nbrpnts = count($grid);
+	$img->SetColor($this->grid_color);
+	$img->SetLineWeight($this->weight);
+	for($i=0; $i<$nbrticks; ++$i) {
+	    for($j=0; $j<$nbrpnts; ++$j) {
+		$pnts[$j*2]=$grid[$j][$i*2];
+		$pnts[$j*2+1]=$grid[$j][$i*2+1];
+	    }
+	    for($k=0; $k<$nbrpnts; ++$k ){
+		$l=($k+1)%$nbrpnts;
+		if( $this->type == "solid" )
+		    $img->Line($pnts[$k*2],$pnts[$k*2+1],$pnts[$l*2],$pnts[$l*2+1]);
+		elseif( $this->type == "dotted" )
+		    $img->DashedLine($pnts[$k*2],$pnts[$k*2+1],$pnts[$l*2],$pnts[$l*2+1],1,6);
+		elseif( $this->type == "dashed" )
+		    $img->DashedLine($pnts[$k*2],$pnts[$k*2+1],$pnts[$l*2],$pnts[$l*2+1],2,4);
+		elseif( $this->type == "longdashed" )
+		    $img->DashedLine($pnts[$k*2],$pnts[$k*2+1],$pnts[$l*2],$pnts[$l*2+1],8,6);
+	    }
+	    $pnts=array();
+	}
+    }
+} // Class
+
+
+//===================================================
+// CLASS RadarPlot
+// Description: Plot a radarplot
+//===================================================
+class RadarPlot {
+    var $data=array();
+    var $fill=false, $fill_color=array(200,170,180);
+    var $color=array(0,0,0);
+    var $legend="";
+    var $weight=1;
+    var $linestyle='solid';
+    var $mark=null;
+//---------------
+// CONSTRUCTOR
+    function RadarPlot($data) {
+	$this->data = $data;
+	$this->mark = new PlotMark();
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function Min() {
+	return Min($this->data);
+    }
+	
+    function Max() {
+	return Max($this->data);
+    }
+	
+    function SetLegend($legend) {
+	$this->legend=$legend;
+    }
+
+    function SetLineStyle($aStyle) {
+	$this->linestyle=$aStyle;
+    }
+	
+    function SetLineWeight($w) {
+	$this->weight=$w;
+    }
+		
+    function SetFillColor($aColor) {
+	$this->fill_color = $aColor;
+	$this->fill = true;		
+    }
+    
+    function SetFill($f=true) {
+	$this->fill = $f;
+    }
+    
+    function SetColor($aColor,$aFillColor=false) {
+	$this->color = $aColor;
+	if( $aFillColor ) {
+	    $this->SetFillColor($aFillColor);
+	    $this->fill = true;
+	}
+    }
+	
+    function GetCSIMareas() {
+	JpGraphError::RaiseL(18001);
+//("Client side image maps not supported for RadarPlots.");
+    }
+	
+    function Stroke(&$img, $pos, &$scale, $startangle) {
+	$nbrpnts = count($this->data);
+	$astep=2*M_PI/$nbrpnts;		
+	$a=$startangle;
+		
+	// Rotate each point to the correct axis-angle
+	// TODO: Update for LogScale
+	for($i=0; $i<$nbrpnts; ++$i) {
+	    //$c=$this->data[$i];
+	    $cs=$scale->RelTranslate($this->data[$i]);
+	    $x=round($cs*cos($a)+$scale->scale_abs[0]);
+	    $y=round($pos-$cs*sin($a));
+	    /*
+	      $c=log10($c);
+	      $x=round(($c-$scale->scale[0])*$scale->scale_factor*cos($a)+$scale->scale_abs[0]);
+	      $y=round($pos-($c-$scale->scale[0])*$scale->scale_factor*sin($a));		
+	    */
+	    $pnts[$i*2]=$x;
+	    $pnts[$i*2+1]=$y;
+	    $a += $astep;
+	}
+	if( $this->fill ) {
+	    $img->SetColor($this->fill_color);
+	    $img->FilledPolygon($pnts);
+	}
+	$img->SetLineWeight($this->weight);
+	$img->SetColor($this->color);
+	$img->SetLineStyle($this->linestyle);
+	$pnts[]=$pnts[0];
+	$pnts[]=$pnts[1];
+	$img->Polygon($pnts);
+	$img->SetLineStyle('solid'); // Reset line style to default
+	// Add plotmarks on top
+	if( $this->mark->show ) {
+	    for($i=0; $i < $nbrpnts; ++$i) {
+		$this->mark->Stroke($img,$pnts[$i*2],$pnts[$i*2+1]); 
+	    }
+	}
+
+    }
+	
+//---------------
+// PRIVATE METHODS
+    function GetCount() {
+	return count($this->data);
+    }
+	
+    function Legend(&$graph) {
+	if( $this->legend=="" ) return;
+	if( $this->fill )
+	    $graph->legend->Add($this->legend,$this->fill_color,$this->mark);
+	else
+	    $graph->legend->Add($this->legend,$this->color,$this->mark);	
+    }
+	
+} // Class
+
+//===================================================
+// CLASS RadarGraph
+// Description: Main container for a radar graph
+//===================================================
+class RadarGraph extends Graph {
+    var $posx;
+    var $posy;
+    var $len;		
+    var $plots=null, $axis_title=null;
+    var $grid,$axis=null;
+//---------------
+// CONSTRUCTOR
+    function RadarGraph($width=300,$height=200,$cachedName="",$timeout=0,$inline=1) {
+	$this->Graph($width,$height,$cachedName,$timeout,$inline);
+	$this->posx=$width/2;
+	$this->posy=$height/2;
+	$this->len=min($width,$height)*0.35;
+	$this->SetColor(array(255,255,255));
+	$this->SetTickDensity(TICKD_NORMAL);
+	$this->SetScale("lin");
+	$this->SetGridDepth(DEPTH_FRONT);
+
+    }
+
+//---------------
+// PUBLIC METHODS
+    function SupressTickMarks($f=true) {
+    	if( ERR_DEPRECATED )
+	    JpGraphError::RaiseL(18002);
+//('RadarGraph::SupressTickMarks() is deprecated. Use HideTickMarks() instead.');
+	$this->axis->scale->ticks->SupressTickMarks($f);
+    }
+
+    function HideTickMarks($aFlag=true) {
+		$this->axis->scale->ticks->SupressTickMarks($aFlag);
+    }
+    
+    function ShowMinorTickmarks($aFlag=true) {
+    	$this->yscale->ticks->SupressMinorTickMarks(!$aFlag);
+    }
+	
+    function SetScale($axtype,$ymin=1,$ymax=1) {
+	if( $axtype != "lin" && $axtype != "log" ) {
+	    JpGraphError::RaiseL(18003,$axtype);
+//("Illegal scale for radarplot ($axtype). Must be \"lin\" or \"log\"");
+	}
+	if( $axtype=="lin" ) {
+	    $this->yscale = & new LinearScale($ymin,$ymax);
+	    $this->yscale->ticks = & new RadarLinearTicks();
+	    $this->yscale->ticks->SupressMinorTickMarks();
+	}
+	elseif( $axtype=="log" ) {
+	    $this->yscale = & new LogScale($ymin,$ymax);
+	    $this->yscale->ticks = & new RadarLogTicks();
+	}
+		
+	$this->axis = & new RadarAxis($this->img,$this->yscale);
+	$this->grid = & new RadarGrid();		
+    }
+
+    function SetSize($aSize) {
+	if( $aSize < 0.1 || $aSize>1 )
+	    JpGraphError::RaiseL(18004,$aSize);
+//("Radar Plot size must be between 0.1 and 1. (Your value=$s)");
+	$this->len=min($this->img->width,$this->img->height)*$aSize/2;
+    }
+
+    function SetPlotSize($aSize) {
+	$this->SetSize($aSize);
+    }
+
+    function SetTickDensity($densy=TICKD_NORMAL) {
+	$this->ytick_factor=25;		
+	switch( $densy ) {
+	    case TICKD_DENSE:
+		$this->ytick_factor=12;			
+	    break;
+	    case TICKD_NORMAL:
+		$this->ytick_factor=25;			
+	    break;
+	    case TICKD_SPARSE:
+		$this->ytick_factor=40;			
+	    break;
+	    case TICKD_VERYSPARSE:
+		$this->ytick_factor=70;			
+	    break;		
+	    default:
+		JpGraphError::RaiseL(18005,$densy);
+//("RadarPlot Unsupported Tick density: $densy");
+	}
+    }
+
+    function SetPos($px,$py=0.5) {
+	$this->SetCenter($px,$py);
+    }
+
+    function SetCenter($px,$py=0.5) {
+	assert($px > 0 && $py > 0 );
+	$this->posx=$this->img->width*$px;
+	$this->posy=$this->img->height*$py;
+    }
+
+    function SetColor($c) {
+	$this->SetMarginColor($c);
+    }
+			
+    function SetTitles($title) {
+	$this->axis_title = $title;
+    }
+
+    function Add(&$splot) {
+	$this->plots[]=$splot;
+    }
+	
+    function GetPlotsYMinMax() {
+	$min=$this->plots[0]->Min();
+	$max=$this->plots[0]->Max();
+	foreach( $this->plots as $p ) {
+	    $max=max($max,$p->Max());
+	    $min=min($min,$p->Min());
+	}
+	if( $min < 0 ) 
+	    JpGraphError::RaiseL(18006,$min);
+//("Minimum data $min (Radar plots should only be used when all data points > 0)");
+	return array($min,$max);
+    }	
+
+    // Stroke the Radar graph
+    function Stroke($aStrokeFileName="") {
+	$n = count($this->plots);
+	// Set Y-scale
+	if( !$this->yscale->IsSpecified() && count($this->plots)>0 ) {
+	    list($min,$max) = $this->GetPlotsYMinMax();
+	    $this->yscale->AutoScale($this->img,0,$max,$this->len/$this->ytick_factor);
+	}
+	// Set start position end length of scale (in absolute pixels)
+	$this->yscale->SetConstants($this->posx,$this->len);
+		
+	// We need as many axis as there are data points
+	$nbrpnts=$this->plots[0]->GetCount();
+		
+	// If we have no titles just number the axis 1,2,3,...
+	if( $this->axis_title==null ) {
+	    for($i=0; $i < $nbrpnts; ++$i ) 
+		$this->axis_title[$i] = $i+1;
+	}
+	elseif(count($this->axis_title)<$nbrpnts) 
+	    JpGraphError::RaiseL(18007);
+//("Number of titles does not match number of points in plot.");
+	for($i=0; $i < $n; ++$i )
+	    if( $nbrpnts != $this->plots[$i]->GetCount() )
+		JpGraphError::RaiseL(18008);
+//("Each radar plot must have the same number of data points.");
+
+	if( $this->background_image != "" ) {
+	    $this->StrokeFrameBackground();
+	}
+	else {	
+	    $this->StrokeFrame();
+	}
+	$astep=2*M_PI/$nbrpnts;
+
+	// Prepare legends
+	for($i=0; $i < $n; ++$i)
+	    $this->plots[$i]->Legend($this);
+	$this->legend->Stroke($this->img);			
+	$this->footer->Stroke($this->img);			
+
+	if( $this->grid_depth == DEPTH_BACK ) {
+	    // Draw axis and grid
+	    for( $i=0,$a=M_PI/2; $i < $nbrpnts; ++$i, $a += $astep ) {
+		$this->axis->Stroke($this->posy,$a,$grid[$i],$this->axis_title[$i],$i==0);
+	    }	
+	}
+		
+	// Plot points
+	$a=M_PI/2;
+	for($i=0; $i < $n; ++$i )
+	    $this->plots[$i]->Stroke($this->img, $this->posy, $this->yscale, $a);
+		
+	if( $this->grid_depth != DEPTH_BACK ) {
+	    // Draw axis and grid
+	    for( $i=0,$a=M_PI/2; $i < $nbrpnts; ++$i, $a += $astep ) {
+		$this->axis->Stroke($this->posy,$a,$grid[$i],$this->axis_title[$i],$i==0);
+	    }	
+	}
+	$this->grid->Stroke($this->img,$grid);
+	$this->StrokeTitles();
+	
+	// Stroke texts
+	if( $this->texts != null ) {
+	    foreach( $this->texts as $t) 
+		$t->Stroke($this->img);
+	}
+
+	// Should we do any final image transformation
+	if( $this->iImgTrans ) {
+	    if( !class_exists('ImgTrans') ) {
+		require_once('jpgraph_imgtrans.php');
+	    }
+	       
+	    $tform = new ImgTrans($this->img->img);
+	    $this->img->img = $tform->Skew3D($this->iImgTransHorizon,$this->iImgTransSkewDist,
+					     $this->iImgTransDirection,$this->iImgTransHighQ,
+					     $this->iImgTransMinSize,$this->iImgTransFillColor,
+					     $this->iImgTransBorder);
+	}
+	
+	// If the filename is given as the special "__handle"
+	// then the image handler is returned and the image is NOT
+	// streamed back
+	if( $aStrokeFileName == _IMG_HANDLER ) {
+	    return $this->img->img;
+	    }
+	else {
+	    // Finally stream the generated picture					
+	    $this->cache->PutAndStream($this->img,$this->cache_name,$this->inline,
+				       $aStrokeFileName);		
+	}
+    }
+} // Class
+
+/* EOF */
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_regstat.php php-syslog-ng/html/includes/jpgraph/jpgraph_regstat.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_regstat.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_regstat.php	2006-02-04 07:07:36.000000000 -0500
@@ -0,0 +1,202 @@
+<?php 
+/*=======================================================================
+// File:	JPGRAPH_REGSTAT.PHP
+// Description: Regression and statistical analysis helper classes
+// Created: 	2002-12-01
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_regstat.php 463 2006-02-04 12:07:36Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+//------------------------------------------------------------------------
+// CLASS Spline
+// Create a new data array from an existing data array but with more points.
+// The new points are interpolated using a cubic spline algorithm
+//------------------------------------------------------------------------
+class Spline {
+    // 3:rd degree polynom approximation
+
+    var $xdata,$ydata;   // Data vectors
+    var $y2;		 // 2:nd derivate of ydata	
+    var $n=0;
+
+    function Spline($xdata,$ydata) {
+	$this->y2 = array();
+	$this->xdata = $xdata;
+	$this->ydata = $ydata;
+
+	$n = count($ydata);
+	$this->n = $n;
+	if( $this->n !== count($xdata) ) {
+	    JpGraphError::RaiseL(19001);
+//('Spline: Number of X and Y coordinates must be the same');
+	}
+
+	// Natural spline 2:derivate == 0 at endpoints
+	$this->y2[0]    = 0.0;
+	$this->y2[$n-1] = 0.0;
+	$delta[0] = 0.0;
+
+	// Calculate 2:nd derivate
+	for($i=1; $i < $n-1; ++$i) {
+	    $d = ($xdata[$i+1]-$xdata[$i-1]);
+	    if( $d == 0  ) {
+		JpGraphError::RaiseL(19002);
+//('Invalid input data for spline. Two or more consecutive input X-values are equal. Each input X-value must differ since from a mathematical point of view it must be a one-to-one mapping, i.e. each X-value must correspond to exactly one Y-value.');
+	    }
+	    $s = ($xdata[$i]-$xdata[$i-1])/$d;
+	    $p = $s*$this->y2[$i-1]+2.0;
+	    $this->y2[$i] = ($s-1.0)/$p;
+	    $delta[$i] = ($ydata[$i+1]-$ydata[$i])/($xdata[$i+1]-$xdata[$i]) - 
+		         ($ydata[$i]-$ydata[$i-1])/($xdata[$i]-$xdata[$i-1]);
+	    $delta[$i] = (6.0*$delta[$i]/($xdata[$i+1]-$xdata[$i-1])-$s*$delta[$i-1])/$p;
+	}
+
+	// Backward substitution
+	for( $j=$n-2; $j >= 0; --$j ) {
+	    $this->y2[$j] = $this->y2[$j]*$this->y2[$j+1] + $delta[$j];
+	}
+    }
+
+    // Return the two new data vectors
+    function Get($num=50) {
+	$n = $this->n ;
+	$step = ($this->xdata[$n-1]-$this->xdata[0]) / ($num-1);
+	$xnew=array();
+	$ynew=array();
+	$xnew[0] = $this->xdata[0];
+	$ynew[0] = $this->ydata[0];
+	for( $j=1; $j < $num; ++$j ) {
+	    $xnew[$j] = $xnew[0]+$j*$step;
+	    $ynew[$j] = $this->Interpolate($xnew[$j]);
+	}
+	return array($xnew,$ynew);
+    }
+
+    // Return a single interpolated Y-value from an x value
+    function Interpolate($xpoint) {
+
+	$max = $this->n-1;
+	$min = 0;
+
+	// Binary search to find interval
+	while( $max-$min > 1 ) {
+	    $k = ($max+$min) / 2;
+	    if( $this->xdata[$k] > $xpoint ) 
+		$max=$k;
+	    else 
+		$min=$k;
+	}	
+
+	// Each interval is interpolated by a 3:degree polynom function
+	$h = $this->xdata[$max]-$this->xdata[$min];
+
+	if( $h == 0  ) {
+	    JpGraphError::RaiseL(19002);
+//('Invalid input data for spline. Two or more consecutive input X-values are equal. Each input X-value must differ since from a mathematical point of view it must be a one-to-one mapping, i.e. each X-value must correspond to exactly one Y-value.');
+	}
+
+
+	$a = ($this->xdata[$max]-$xpoint)/$h;
+	$b = ($xpoint-$this->xdata[$min])/$h;
+	return $a*$this->ydata[$min]+$b*$this->ydata[$max]+
+	     (($a*$a*$a-$a)*$this->y2[$min]+($b*$b*$b-$b)*$this->y2[$max])*($h*$h)/6.0;
+    }
+}
+
+//------------------------------------------------------------------------
+// CLASS Bezier
+// Create a new data array from a number of control points
+//------------------------------------------------------------------------
+class Bezier {
+/**
+ * @author Thomas Despoix, openXtrem company
+ * @license released under QPL
+ * @abstract Bezier interoplated point generation,
+ * computed from control points data sets, based on Paul Bourke algorithm :
+ * http://astronomy.swin.edu.au/~pbourke/curves/bezier/
+ */
+    var $datax = array();
+    var $datay = array();
+    var $n=0;
+ 
+    function Bezier($datax, $datay, $attraction_factor = 1) {
+	// Adding control point multiple time will raise their attraction power over the curve   
+	$this->n = count($datax);
+	if( $this->n !== count($datay) ) {
+	    JpGraphError::RaiseL(19003);
+//('Bezier: Number of X and Y coordinates must be the same');
+	}
+	$idx=0;
+	foreach($datax as $datumx) {
+	    for ($i = 0; $i < $attraction_factor; $i++) {
+		$this->datax[$idx++] = $datumx;
+	    }
+	}
+   	$idx=0;
+	foreach($datay as $datumy) {
+	    for ($i = 0; $i < $attraction_factor; $i++) {
+		$this->datay[$idx++] = $datumy;
+	    }
+	}
+    }
+
+    function Get($steps) {
+	$datax = array();
+	$datay = array();
+	for ($i = 0; $i < $steps; $i++) {
+	    list($datumx, $datumy) = $this->GetPoint((double) $i / (double) $steps);       
+	    $datax[] = $datumx;
+	    $datay[] = $datumy;
+	}
+   
+	$datax[] = end($this->datax);
+	$datay[] = end($this->datay);
+   
+	return array($datax, $datay);
+    }
+ 
+    function GetPoint($mu) {
+	$n = $this->n - 1;
+	$k = 0;
+	$kn = 0;
+	$nn = 0;
+	$nkn = 0;
+	$blend = 0.0;
+	$newx = 0.0;
+	$newy = 0.0;
+
+	$muk = 1.0;
+	$munk = (double) pow(1-$mu,(double) $n);
+
+	for ($k = 0; $k <= $n; $k++) {
+	    $nn = $n;
+	    $kn = $k;
+	    $nkn = $n - $k;
+	    $blend = $muk * $munk;
+	    $muk *= $mu;
+	    $munk /= (1-$mu);
+	    while ($nn >= 1) {
+		$blend *= $nn;
+		$nn--;
+		if ($kn > 1) {
+		    $blend /= (double) $kn;
+		    $kn--;
+		}
+		if ($nkn > 1) {
+		    $blend /= (double) $nkn;
+		    $nkn--;
+		}
+	    }
+	    $newx += $this->datax[$k] * $blend;
+	    $newy += $this->datay[$k] * $blend;
+	}
+
+	return array($newx, $newy);
+    }
+}
+
+// EOF
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_scatter.php php-syslog-ng/html/includes/jpgraph/jpgraph_scatter.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_scatter.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_scatter.php	2006-02-04 07:28:43.000000000 -0500
@@ -0,0 +1,225 @@
+<?php 
+/*=======================================================================
+// File:	JPGRAPH_SCATTER.PHP
+// Description: Scatter (and impuls) plot extension for JpGraph
+// Created: 	2001-02-11
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_scatter.php 491 2006-02-04 12:28:43Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+require_once ('jpgraph_plotmark.inc');
+
+//===================================================
+// CLASS FieldArrow
+// Description: Draw an arrow at (x,y) with angle a
+//===================================================
+class FieldArrow {
+    var $iSize=10;  // Length in pixels for  arrow
+    var $iArrowSize = 2;
+    var $iColor='black';
+    var $isizespec = array(
+	array(2,1),array(3,2),array(4,3),array(6,4),array(7,4),array(8,5),array(10,6),array(12,7),array(16,8),array(20,10));
+    function FieldArrow() {
+    }
+
+    function SetSize($aSize,$aArrowSize=2) {
+	$this->iSize = $aSize;
+	$this->iArrowSize = $aArrowSize;
+    }
+
+    function SetColor($aColor) {
+	$this->iColor = $aColor;
+    }
+
+    function Stroke(&$aImg,$x,$y,$a) {
+	// First rotate the center coordinates
+	list($x,$y) = $aImg->Rotate($x,$y);
+
+	$old_origin = $aImg->SetCenter($x,$y);
+	$old_a = $aImg->a;
+	$aImg->SetAngle(-$a+$old_a);
+
+	$dx = round($this->iSize/2);
+	$c = array($x-$dx,$y,$x+$dx,$y);
+	$x += $dx;
+
+	list($dx,$dy) = $this->isizespec[$this->iArrowSize];
+	$ca = array($x,$y,$x-$dx,$y-$dy,$x-$dx,$y+$dy,$x,$y);
+
+	$aImg->SetColor($this->iColor);
+	$aImg->Polygon($c);
+	$aImg->FilledPolygon($ca);
+
+	$aImg->SetCenter($old_origin[0],$old_origin[1]);
+	$aImg->SetAngle($old_a);
+    }
+}
+
+//===================================================
+// CLASS FieldPlot
+// Description: Render a field plot
+//===================================================
+class FieldPlot extends Plot {
+    var $iAngles;
+    var $iCallback='';
+    function FieldPlot($datay,$datax,$angles) {
+	if( (count($datax) != count($datay)) )
+	    JpGraphError::RaiseL(20001);//("Fieldplots must have equal number of X and Y points.");
+	if( (count($datax) != count($angles)) )
+	    JpGraphError::RaiseL(20002);//("Fieldplots must have an angle specified for each X and Y points.");
+	
+	$this->iAngles = $angles;
+
+	$this->Plot($datay,$datax);
+	$this->value->SetAlign('center','center');
+	$this->value->SetMargin(15);
+
+	$this->arrow = new FieldArrow();
+    }
+
+    function SetCallback($aFunc) {
+	$this->iCallback = $aFunc;
+    }
+
+    function Stroke(&$img,&$xscale,&$yscale) {
+
+	// Remeber base color and size
+	$bc = $this->arrow->iColor;
+	$bs = $this->arrow->iSize;
+	$bas = $this->arrow->iArrowSize;
+
+	for( $i=0; $i<$this->numpoints; ++$i ) {
+	    // Skip null values
+	    if( $this->coords[0][$i]==="" )
+		continue;
+
+	    $f = $this->iCallback;
+	    if( $f != "" ) {
+		list($cc,$cs,$cas) = call_user_func($f,$this->coords[1][$i],$this->coords[0][$i],$this->iAngles[$i]);
+		// Fall back on global data if the callback isn't set
+		if( $cc  == "" ) $cc = $bc;
+		if( $cs  == "" ) $cs = $bs;
+		if( $cas == "" ) $cas = $bas;
+		//echo "f=$f, cc=$cc, cs=$cs, cas=$cas<br>";
+		$this->arrow->SetColor($cc);	    
+		$this->arrow->SetSize($cs,$cas);
+	    }
+
+	    $xt = $xscale->Translate($this->coords[1][$i]);
+	    $yt = $yscale->Translate($this->coords[0][$i]);	
+
+	    $this->arrow->Stroke($img,$xt,$yt,$this->iAngles[$i]);
+	    $this->value->Stroke($img,$this->coords[0][$i],$xt,$yt);
+	}
+    }
+	
+    // Framework function
+    function Legend(&$aGraph) {
+	if( $this->legend != "" ) {
+	    $aGraph->legend->Add($this->legend,$this->mark->fill_color,$this->mark,0,
+				 $this->legendcsimtarget,$this->legendcsimalt);
+	}
+    }	
+}
+
+//===================================================
+// CLASS ScatterPlot
+// Description: Render X and Y plots
+//===================================================
+class ScatterPlot extends Plot {
+    var $impuls = false;
+    var $linkpoints = false, $linkpointweight=1, $linkpointcolor="black";
+//---------------
+// CONSTRUCTOR
+    function ScatterPlot($datay,$datax=false) {
+	if( (count($datax) != count($datay)) && is_array($datax))
+	    JpGraphError::RaiseL(20003);//("Scatterplot must have equal number of X and Y points.");
+	$this->Plot($datay,$datax);
+	$this->mark = new PlotMark();
+	$this->mark->SetType(MARK_SQUARE);
+	$this->mark->SetColor($this->color);
+	$this->value->SetAlign('center','center');
+	$this->value->SetMargin(0);
+    }
+
+//---------------
+// PUBLIC METHODS	
+    function SetImpuls($f=true) {
+	$this->impuls = $f;
+    }   
+
+    // Combine the scatter plot points with a line
+    function SetLinkPoints($aFlag=true,$aColor="black",$aWeight=1) {
+	$this->linkpoints=$aFlag;
+	$this->linkpointcolor=$aColor;
+	$this->linkpointweight=$aWeight;
+    }
+
+    function Stroke(&$img,&$xscale,&$yscale) {
+
+	$ymin=$yscale->scale_abs[0];
+	if( $yscale->scale[0] < 0 )
+	    $yzero=$yscale->Translate(0);
+	else
+	    $yzero=$yscale->scale_abs[0];
+	    
+	$this->csimareas = '';
+	for( $i=0; $i<$this->numpoints; ++$i ) {
+
+	    // Skip null values
+	    if( $this->coords[0][$i]==="" || $this->coords[0][$i]==='-' || $this->coords[0][$i]==='x')
+		continue;
+
+	    if( isset($this->coords[1]) )
+		$xt = $xscale->Translate($this->coords[1][$i]);
+	    else
+		$xt = $xscale->Translate($i);
+	    $yt = $yscale->Translate($this->coords[0][$i]);	
+
+
+	    if( $this->linkpoints && isset($yt_old) ) {
+		$img->SetColor($this->linkpointcolor);
+		$img->SetLineWeight($this->linkpointweight);
+		$img->Line($xt_old,$yt_old,$xt,$yt);
+	    }
+
+	    if( $this->impuls ) {
+		$img->SetColor($this->color);
+		$img->SetLineWeight($this->weight);
+		$img->Line($xt,$yzero,$xt,$yt);
+	    }
+	
+	    if( !empty($this->csimtargets[$i]) ) {
+	        $this->mark->SetCSIMTarget($this->csimtargets[$i]);
+	        $this->mark->SetCSIMAlt($this->csimalts[$i]);
+	    }
+	    
+	    if( isset($this->coords[1]) ) {
+		$this->mark->SetCSIMAltVal($this->coords[0][$i],$this->coords[1][$i]);
+	    }
+	    else {
+		$this->mark->SetCSIMAltVal($this->coords[0][$i],$i);
+	    }
+
+	    $this->mark->Stroke($img,$xt,$yt);
+	
+	    $this->csimareas .= $this->mark->GetCSIMAreas();
+	    $this->value->Stroke($img,$this->coords[0][$i],$xt,$yt);
+
+	    $xt_old = $xt;
+	    $yt_old = $yt;
+	}
+    }
+	
+    // Framework function
+    function Legend(&$aGraph) {
+	if( $this->legend != "" ) {
+	    $aGraph->legend->Add($this->legend,$this->mark->fill_color,$this->mark,0,
+				 $this->legendcsimtarget,$this->legendcsimalt);
+	}
+    }	
+} // Class
+/* EOF */
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_stock.php php-syslog-ng/html/includes/jpgraph/jpgraph_stock.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_stock.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_stock.php	2006-02-04 07:29:25.000000000 -0500
@@ -0,0 +1,183 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_STOCK.PHP
+// Description:	Stock plot extension for JpGraph
+// Created: 	2003-01-27
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_stock.php 493 2006-02-04 12:29:25Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+//===================================================
+// CLASS StockPlot
+//===================================================
+class StockPlot extends Plot {
+    var $iTupleSize = 4;
+    var $iWidth=9;
+    var $iEndLines=1;
+    var $iStockColor1='white',$iStockColor2='darkred',$iStockColor3='darkred';
+//---------------
+// CONSTRUCTOR
+    function StockPlot(&$datay,$datax=false) {
+	if( count($datay) % $this->iTupleSize ) {
+	    JpGraphError::RaiseL(21001,$this->iTupleSize);//('Data values for Stock charts must contain an even multiple of '.$this->iTupleSize.' data points.');
+	}
+	$this->Plot($datay,$datax);
+	$this->numpoints /= $this->iTupleSize;
+    }
+//---------------
+// PUBLIC METHODS
+	
+    function SetColor($aColor,$aColor1='white',$aColor2='darkred',$aColor3='darkred') {
+	$this->color = $aColor;
+	$this->iStockColor1 = $aColor1;
+	$this->iStockColor2 = $aColor2;
+	$this->iStockColor3 = $aColor3;
+    }
+
+    function SetWidth($aWidth) {
+	// Make sure it's odd
+	$this->iWidth = 2*floor($aWidth/2)+1;
+    }
+
+    function HideEndLines($aHide=true) {
+	$this->iEndLines = !$aHide;
+    }
+
+    // Gets called before any axis are stroked
+    function PreStrokeAdjust(&$graph) {
+	if( $this->center ) {
+	    $a=0.5; $b=0.5;
+	    $this->numpoints++;
+	} else {
+	    $a=0; $b=0;
+	}
+	$graph->xaxis->scale->ticks->SetXLabelOffset($a);
+	$graph->SetTextScaleOff($b);						
+    }
+	
+    // Stroke stock plot
+    function Stroke(&$img,$xscale,$yscale) {
+	$n=$this->numpoints;
+	if( $this->center ) $n--;
+	if( isset($this->coords[1]) ) {
+	    if( count($this->coords[1])!=$n )
+		JpGraphError::RaiseL(2003,count($this->coords[1]),$numpoints);
+//("Number of X and Y points are not equal. Number of X-points:".count($this->coords[1])." Number of Y-points:$numpoints");
+	    else
+		$exist_x = true;
+	}
+	else 
+	    $exist_x = false;
+
+	if( $exist_x )
+	    $xs=$this->coords[1][0];
+	else
+	    $xs=0;
+		
+	$ts = $this->iTupleSize;
+	$this->csimareas = '';
+	for( $i=0; $i<$n; ++$i) {
+
+	    //If value is NULL, then don't draw a bar at all
+ 	    if ($this->coords[0][$i] === null) continue;
+
+	    if( $exist_x ) $x=$this->coords[1][$i];
+	    else $x=$i;
+	    $xt = $xscale->Translate($x);
+	    
+	    $neg = $this->coords[0][$i*$ts] > $this->coords[0][$i*$ts+1] ;
+	    $yopen  = $yscale->Translate($this->coords[0][$i*$ts]);
+	    $yclose = $yscale->Translate($this->coords[0][$i*$ts+1]);
+	    $ymin   = $yscale->Translate($this->coords[0][$i*$ts+2]);
+	    $ymax   = $yscale->Translate($this->coords[0][$i*$ts+3]);
+
+	    $dx = floor($this->iWidth/2);
+	    $xl = $xt - $dx;
+	    $xr = $xt + $dx;
+
+	    if( $neg ) 
+		$img->SetColor($this->iStockColor3);
+	    else
+		$img->SetColor($this->iStockColor1);
+	    $img->FilledRectangle($xl,$yopen,$xr,$yclose);
+	    $img->SetLineWeight($this->weight);
+	    if( $neg ) 
+		$img->SetColor($this->iStockColor2);
+	    else
+		$img->SetColor($this->color);
+	
+	    $img->Rectangle($xl,$yopen,$xr,$yclose);
+
+	    if( $yopen < $yclose ) {
+		$ytop = $yopen ;
+		$ybottom = $yclose ;
+	    }
+	    else {
+		$ytop = $yclose ;
+		$ybottom = $yopen ;
+	    }
+	    $img->SetColor($this->color);
+	    $img->Line($xt,$ytop,$xt,$ymax);
+	    $img->Line($xt,$ybottom,$xt,$ymin);
+
+	    if( $this->iEndLines ) {
+		$img->Line($xl,$ymax,$xr,$ymax);
+		$img->Line($xl,$ymin,$xr,$ymin);
+	    }
+
+	    // A chance for subclasses to add things to the bar
+	    // for data point i
+	    $this->ModBox($img,$xscale,$yscale,$i,$xl,$xr,$neg);
+
+	    // Setup image maps
+	    if( !empty($this->csimtargets[$i]) ) {
+		$this->csimareas.= '<area shape="rect" coords="'.
+		    round($xl).','.round($ytop).','.
+		    round($xr).','.round($ybottom).'" ';   
+		$this->csimareas .= ' href="'.$this->csimtargets[$i].'"';
+		if( !empty($this->csimalts[$i]) ) {
+		    $sval=$this->csimalts[$i];
+		    $this->csimareas .= " title=\"$sval\" ";
+		}
+		$this->csimareas.= " alt=\"$sval\" />\n";
+	    }
+	}			
+	return true;
+    }
+
+    // A hook for subclasses to modify the plot
+    function ModBox($img,$xscale,$yscale,$i,$xl,$xr,$neg) {}
+
+} // Class
+
+//===================================================
+// CLASS BoxPlot
+//===================================================
+class BoxPlot extends StockPlot {
+    var $iPColor='black',$iNColor='white';
+    function BoxPlot($datay,$datax=false) {
+	$this->iTupleSize=5;
+	parent::StockPlot($datay,$datax);
+    }
+
+    function SetMedianColor($aPos,$aNeg) {
+	$this->iPColor = $aPos;
+	$this->iNColor = $aNeg;
+    }
+
+    function ModBox(&$img,$xscale,$yscale,$i,$xl,$xr,$neg) {
+	if( $neg ) 
+	    $img->SetColor($this->iNColor);
+	else
+	    $img->SetColor($this->iPColor);
+	
+	$y = $yscale->Translate($this->coords[0][$i*5+4]);
+	$img->Line($xl,$y,$xr,$y);
+    }
+}
+
+/* EOF */
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_utils.inc php-syslog-ng/html/includes/jpgraph/jpgraph_utils.inc
--- php-syslog-ng-2.9.f/html/includes/jpgraph/jpgraph_utils.inc	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/jpgraph_utils.inc	2006-02-04 10:51:47.000000000 -0500
@@ -0,0 +1,251 @@
+<?php
+/*=======================================================================
+// File: 	JPGRAPH_UTILS.INC
+// Description: Collection of non-essential "nice to have" utilities 
+// Created: 	2005-11-20
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id: jpgraph_utils.inc 504 2006-02-04 15:51:47Z ljp $
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+//===================================================
+// CLASS FuncGenerator
+// Description: Utility class to help generate data for function plots. 
+// The class supports both parametric and regular functions.
+//===================================================
+class FuncGenerator {
+    var $iFunc='',$iXFunc='',$iMin,$iMax,$iStepSize;
+	
+    function FuncGenerator($aFunc,$aXFunc='') {
+	$this->iFunc = $aFunc;
+	$this->iXFunc = $aXFunc;
+    }
+	
+    function E($aXMin,$aXMax,$aSteps=50) {
+	$this->iMin = $aXMin;
+	$this->iMax = $aXMax;
+	$this->iStepSize = ($aXMax-$aXMin)/$aSteps;
+
+	if( $this->iXFunc != '' )
+	    $t = 'for($i='.$aXMin.'; $i<='.$aXMax.'; $i += '.$this->iStepSize.') {$ya[]='.$this->iFunc.';$xa[]='.$this->iXFunc.';}';
+	elseif( $this->iFunc != '' )
+	    $t = 'for($x='.$aXMin.'; $x<='.$aXMax.'; $x += '.$this->iStepSize.') {$ya[]='.$this->iFunc.';$xa[]=$x;} $x='.$aXMax.';$ya[]='.$this->iFunc.';$xa[]=$x;';
+	else
+	    JpGraphError::RaiseL(24001);//('FuncGenerator : No function specified. ');
+			
+	@eval($t);
+		
+	// If there is an error in the function specifcation this is the only
+	// way we can discover that.
+	if( empty($xa) || empty($ya) )
+	    JpGraphError::RaiseL(24002);//('FuncGenerator : Syntax error in function specification ');
+				
+	return array($xa,$ya);
+    }
+}
+
+//=============================================================================
+// CLASS SymChar
+// Description: Code values for some commonly used characters that 
+//              normally isn't available directly on the keyboard, for example
+//              mathematical and greek symbols.
+//=============================================================================
+class  SymChar {
+    function Get($aSymb,$aCapital=FALSE) {
+        static $iSymbols = array(
+    /* Greek */
+	array('alpha','03B1','0391'),
+	array('beta','03B2','0392'),
+	array('gamma','03B3','0393'),
+	array('delta','03B4','0394'),
+	array('epsilon','03B5','0395'),
+	array('zeta','03B6','0396'),
+	array('ny','03B7','0397'),
+	array('eta','03B8','0398'),
+	array('theta','03B8','0398'),
+	array('iota','03B9','0399'),
+	array('kappa','03BA','039A'),
+	array('lambda','03BB','039B'),
+	array('mu','03BC','039C'),
+	array('nu','03BD','039D'),
+	array('xi','03BE','039E'),
+	array('omicron','03BF','039F'),
+	array('pi','03C0','03A0'),
+	array('rho','03C1','03A1'),
+	array('sigma','03C3','03A3'),
+	array('tau','03C4','03A4'),
+	array('upsilon','03C5','03A5'),
+	array('phi','03C6','03A6'),
+	array('chi','03C7','03A7'),
+	array('psi','03C8','03A8'),
+	array('omega','03C9','03A9'),
+    /* Money */
+	array('euro','20AC'),
+	array('yen','00A5'),
+	array('pound','20A4'),
+    /* Math */
+	array('approx','2248'),
+	array('neq','2260'),
+	array('not','2310'),
+	array('def','2261'),
+	array('inf','221E'),
+	array('sqrt','221A'),
+	array('int','222B'),
+    /* Misc */
+	array('copy','00A9'),
+	array('para','00A7'));
+
+	$n = count($iSymbols);
+	$i=0;
+	$found = false;
+	$aSymb = strtolower($aSymb);
+	while( $i < $n && !$found ) {
+	    $found = $aSymb === $iSymbols[$i++][0];
+	}
+	if( $found ) {
+	    $ca = $iSymbols[--$i];
+	    if( $aCapital && count($ca)==3 ) 
+		$s = $ca[2];
+	    else
+		$s = $ca[1];
+	    return sprintf('&#%04d;',hexdec($s));
+	}
+	else
+	    return '';
+    }
+}
+
+
+//=============================================================================
+// CLASS DateScaleUtils
+// Description: Help to create a manual date scale
+//=============================================================================
+DEFINE('DSUTILS_MONTH1',1); // Major and minor ticks on a monthly basis
+
+class DateScaleUtils {
+
+    function GetTicks($aData,$aType=1) {
+
+	//
+	// Find out the range of the data in order to get the limits for the loops
+	// that creates the position for the labels. This code is generic and can be 
+	// used for any ranges of the data.
+	//
+	$n = count($aData);
+	$startmonth = date('n',$aData[0]);
+	$startday = date('j',$aData[0]);
+	$startyear = date('Y',$aData[0]);
+	$endmonth = date('n',$aData[$n-1]);
+	$endyear = date('Y',$aData[$n-1]);
+	$endday = date('j',$aData[$n-1]);
+
+	//
+	// Now create the positions for all the ticks. In this example we
+	// put a tick at the start of every month and also on the very 
+	// first and last X-position.
+	// 
+	$tickPositions = array();
+	$minTickPositions = array();
+	$i=0;$j=0;
+
+	// Uncomment this line to put a label at the very left data pos
+	// $tickPositions[$i++] = $datax[0];
+
+	$m = $startmonth;
+	$y = $startyear;
+	// Skip the first month label if it is before the startdate
+	if( $startday == 1 ) {
+	    $tickPositions[$i++] = mktime(0,0,0,$m,1,$y);
+	}
+	if( $startday < 15 ) {
+	    $minTickPositions[$j++] = mktime(0,0,0,$m,15,$y);
+	}
+	++$m;
+
+	// Loop through all the years included in the scale
+	for($y=$startyear; $y <= $endyear; ++$y ) {
+	    // Loop through all the months. There are three cases to consider:
+	    // 1. We are in the first year and must start with the startmonth
+	    // 2. We are in the end year and we must stop at last month of the scale
+	    // 3. A year in between where we run through all the 12 months
+	    $stopmonth = $y == $endyear ? $endmonth : 12;
+	    while( $m <= $stopmonth ) {
+		switch( $aType ) {
+		    case 1: 
+			// Set minor tick at the middle of the month
+			if( $m <= $stopmonth ) {
+			    if( !($y==$endyear && $m==$stopmonth && $endday < 15) ) 
+				$minTickPositions[$j++] = mktime(0,0,0,$m,15,$y);
+			}
+			// Major at month 
+			// Get timestamp of first hour of first day in each month
+			$tickPositions[$i++] = mktime(0,0,0,$m,1,$y);
+
+			break;
+		}
+		++$m;
+	    }
+	    $m=1;
+	}
+
+	// For the case where all dates are within the same month
+	// we want to make sure we have at least two ticks on the scale
+	// since the scale want work properly otherwise
+	if($startmonth == $endmonth && $startyear == $endyear && $aType==1 ) {
+	    $tickPositions[$i++] = mktime(0 ,0 ,0, $startmonth + 1, 1, $startyear);
+	} 
+
+	// Uncomment this line to put a label at the very right data pos
+	// $tickPositions[$i] = $datax[$n-1];
+
+	return array($tickPositions,$minTickPositions);
+    }
+
+}
+
+//=============================================================================
+// Class ReadFileData
+//=============================================================================
+Class ReadFileData {
+
+    //----------------------------------------------------------------------------
+    // Desciption:
+    // Read numeric data from a file. 
+    // Each value should be separated by either a new line or by a specified 
+    // separator character (default is ',').
+    // Before returning the data each value is converted to a proper float 
+    // value. The routine is robust in the sense that non numeric data in the 
+    // file will be discarded.
+    //
+    // Returns: 
+    // The number of data values read on success, FALSE on failure
+    //----------------------------------------------------------------------------
+    function FromCSV($aFile,&$aData,$aSepChar=',',$aMaxLineLength=1024) {
+	$rh = fopen($aFile,'r');
+	if( $rh === false )
+	    return false;
+	$tmp = array();
+	$lineofdata = fgetcsv($rh, 1000, ',');
+	while ( $lineofdata !== FALSE) {
+	    $tmp = array_merge($tmp,$lineofdata);
+	    $lineofdata = fgetcsv($rh, $aMaxLineLength, $aSepChar);
+	}
+	fclose($rh);
+
+	// Now make sure that all data is numeric. By default
+	// all data is read as strings
+	$n = count($tmp);
+	$aData = array();
+	$cnt=0;
+	for($i=0; $i < $n; ++$i) {
+	    if( $tmp[$i] !== "" ) {
+		$aData[$cnt++] = floatval($tmp[$i]);
+	    }
+	}
+	return $cnt;
+    }
+}
+
+?>
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/jpgraph/lang/en.inc.php php-syslog-ng/html/includes/jpgraph/lang/en.inc.php
--- php-syslog-ng-2.9.f/html/includes/jpgraph/lang/en.inc.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/jpgraph/lang/en.inc.php	2006-02-14 01:51:56.000000000 -0500
@@ -0,0 +1,495 @@
+<?php
+/*=======================================================================
+// File: 	ERRMSG_EN.INC.PHP
+// Description: English language file for error messages
+// Created: 	2006-01-25
+// Author:	Johan Persson (johanp@aditus.nu)
+// Ver:		$Id$
+//
+// Copyright (c) Aditus Consulting. All rights reserved.
+//========================================================================
+*/
+
+// Note: Format of each error message is array(<error message>,<number of arguments>)
+$_jpg_messages = array(
+
+/*
+** Headers already sent error. This is formatted as HTML different since this will be sent back directly as text
+*/
+10  => array('<table border=1><tr><td><font color=darkred size=4><b>JpGraph Error:</b> 
+HTTP headers have already been sent.<br>Caused by output from file <b>%s</b> at line <b>%d</b>.</font></td></tr><tr><td><b>Explanation:</b><br>HTTP headers have already been sent back to the browser indicating the data as text before the library got a chance to send it\'s image HTTP header to this browser. This makes it impossible for the library to send back image data to the browser (since that would be interpretated as text by the browser and show up as junk text).<p>Most likely you have some text in your script before the call to <i>Graph::Stroke()</i>. If this texts gets sent back to the browser the browser will assume that all data is plain text. Look for any text, even spaces and newlines, that might have been sent back to the browser. <p>For example it is a common mistake to leave a blank line before the opening "<b>&lt;?php</b>".</td></tr></table>',2),
+
+/*
+** Setup errors
+*/
+11 => array('No path specified for CACHE_DIR. Please specify CACHE_DIR manually in jpg-config.inc',0),
+12 => array('No path specified for TTF_DIR and path can not be determined automatically. Please specify TTF_DIR manually (in jpg-config.inc).',0),
+
+/*
+**  jpgraph_bar
+*/
+
+2001 => array('Number of colors is not the same as the number of patterns in BarPlot::SetPattern()',0),
+2002 => array('Unknown pattern specified in call to BarPlot::SetPattern()',0),
+2003 => array('Number of X and Y points are not equal. Number of X-points: %d Number of Y-points: %d',2),
+2004 => array('All values for a barplot must be numeric. You have specified value nr [%d] == %s',2),
+2005 => array('You have specified an empty array for shadow colors in the bar plot.',0),
+2006 => array('Unknown position for values on bars : %s',1),
+2007 => array('Cannot create GroupBarPlot from empty plot array.',0),
+2008 => array('Group bar plot element nbr %d is undefined or empty.',0),
+2009 => array('One of the objects submitted to GroupBar is not a BarPlot. Make sure that you create the GroupBar plot from an array of BarPlot or AccBarPlot objects. (Class = %s)',1),
+2010 => array('Cannot create AccBarPlot from empty plot array.',0),
+2011 => array('Acc bar plot element nbr %d is undefined or empty.',1),
+2012 => array('One of the objects submitted to AccBar is not a BarPlot. Make sure that you create the AccBar plot from an array of BarPlot objects. (Class=%s)',1),
+2013 => array('You have specified an empty array for shadow colors in the bar plot.',0),
+2014 => array('Number of datapoints for each data set in accbarplot must be the same',0),
+
+
+/*
+**  jpgraph_date
+*/
+
+3001 => array('It is only possible to use either SetDateAlign() or SetTimeAlign() but not both',0),
+
+/*
+**  jpgraph_error
+*/
+
+4002 => array('Error in input data to LineErrorPlot. Number of data points must be a multiple of 3',0),
+
+/*
+**  jpgraph_flags
+*/
+
+5001 => array('Unknown flag size (%d).',1),
+5002 => array('Flag index %s does not exist.',1),
+5003 => array('Invalid ordinal number (%d) specified for flag index.',1),
+5004 => array('The (partial) country name %s does not have a corresponding flag image. The flag may still exist but under another name, e.g. instead of "usa" try "united states".',1),
+
+
+/*
+**  jpgraph_gantt
+*/
+
+6001 => array('Internal error. Height for ActivityTitles is < 0',0),
+6002 => array('You can\'t specify negative sizes for Gantt graph dimensions. Use 0 to indicate that you want the library to automatically determine a dimension.',0),
+6003 => array('Invalid format for Constrain parameter at index=%d in CreateSimple(). Parameter must start with index 0 and contain arrays of (Row,Constrain-To,Constrain-Type)',1), 
+6004 => array('Invalid format for Progress parameter at index=%d in CreateSimple(). Parameter must start with index 0 and contain arrays of (Row,Progress)',1), 
+6005 => array('SetScale() is not meaningful with Gantt charts.',0),
+6006 => array('Cannot autoscale Gantt chart. No dated activities exist. [GetBarMinMax() start >= n]',0),
+6007 => array('Sanity check for automatic Gantt chart size failed. Either the width (=%d) or height (=%d) is larger than MAX_GANTTIMG_SIZE. This could potentially be caused by a wrong date in one of the activities.',2),
+6008 => array('You have specified a constrain from row=%d to row=%d which does not have any activity',2),
+6009 => array('Unknown constrain type specified from row=%d to row=%d',2),
+6010 => array('Illegal icon index for Gantt builtin icon [%d]',1),
+6011 => array('Argument to IconImage must be string or integer',0),
+6012 => array('Unknown type in Gantt object title specification',0),
+6015 => array('Illegal vertical position %d',1),
+6016 => array('Date string (%s) specified for Gantt activity can not be interpretated. Please make sure it is a valid time string, e.g. 2005-04-23 13:30',1),
+6017 => array('Unknown date format in GanttScale (%s).',1),
+6018 => array('Interval for minutes must divide the hour evenly, e.g. 1,5,10,12,15,20,30 etc You have specified an interval of %d minutes.',1),
+6019 => array('The available width (%d) for minutes are to small for this scale to be displayed. Please use auto-sizing or increase the width of the graph.',1),
+6020 => array('Interval for hours must divide the day evenly, e.g. 0:30, 1:00, 1:30, 4:00 etc. You have specified an interval of %d',1),
+6021 => array('Unknown formatting style for week.',0),
+6022 => array('Gantt scale has not been specified.',0),
+6023 => array('If you display both hour and minutes the hour interval must be 1 (Otherwise it doesn\'t make sense to display minutes).',0),
+6024 => array('CSIM Target must be specified as a string. Start of target is: %d',1),
+6025 => array('CSIM Alt text must be specified as a string. Start of alt text is: %d',1),
+6027 => array('Progress value must in range [0, 1]',0),
+6028 => array('Specified height (%d) for gantt bar is out of range.',1),
+6029 => array('Offset for vertical line must be in range [0,1]',0),
+6030 => array('Unknown arrow direction for link.',0),
+6031 => array('Unknown arrow type for link.',0),
+6032 => array('Internal error: Unknown path type (=%d) specified for link.',1),
+
+/*
+**  jpgraph_gradient
+*/
+
+7001 => array('Unknown gradient style (=%d).',1),
+
+/*
+**  jpgraph_iconplot
+*/
+
+8001 => array('Mix value for icon must be between 0 and 100.',0),
+8002 => array('Anchor position for icons must be one of "top", "bottom", "left", "right" or "center"',0),
+8003 => array('It is not possible to specify both an image file and a country flag for the same icon.',0),
+8004 => array('In order to use Country flags as icons you must include the "jpgraph_flags.php" file.',0),
+
+/*
+**  jpgraph_imgtrans
+*/
+
+9001 => array('Value for image transformation out of bounds. Vanishing point on horizon must be specified as a value between 0 and 1.',0),
+
+/*
+**  jpgraph_lineplot
+*/
+
+10001 => array('LinePlot::SetFilled() is deprecated. Use SetFillColor()',0),
+10002 => array('Plot too complicated for fast line Stroke. Use standard Stroke()',0),
+
+/*
+**  jpgraph_log
+*/
+
+11001 => array('Your data contains non-numeric values.',0),
+11002 => array('Negative data values can not be used in a log scale.',0),
+11003 => array('Your data contains non-numeric values.',0),
+11004 => array('Scale error for logarithmic scale. You have a problem with your data values. The max value must be greater than 0. It is mathematically impossible to have 0 in a logarithmic scale.',0),
+11005 => array('Specifying tick interval for a logarithmic scale is undefined. Remove any calls to SetTextLabelStart() or SetTextTickInterval() on the logarithmic scale.',0),
+
+/*
+**  jpgraph_mgraph
+*/
+
+12001 => array("You are using GD 2.x and are trying to use a background images on a non truecolor image. To use background images with GD 2.x it is necessary to enable truecolor by setting the USE_TRUECOLOR constant to TRUE. Due to a bug in GD 2.0.1 using any truetype fonts with truecolor images will result in very poor quality fonts.",0),
+12002 => array('Incorrect file name for MGraph::SetBackgroundImage() : %s Must have a valid image extension (jpg,gif,png) when using auto detection of image type',1),
+12003 => array('Unknown file extension (%s) in MGraph::SetBackgroundImage() for filename: %s',2),
+12004 => array('The image format of your background image (%s) is not supported in your system configuration. ',1),
+12005 => array('Can\'t read background image: %s',1),
+12006 => array('Illegal sizes specified for width or height when creating an image, (width=%d, height=%d)',2),
+12007 => array('Argument to MGraph::Add() is not a valid GD image handle.',0),
+12008 => array('Your PHP (and GD-lib) installation does not appear to support any known graphic formats.',0),
+12009 => array('Your PHP installation does not support the chosen graphic format: %s',1),
+12010 => array('Can\'t create or stream image to file %s Check that PHP has enough permission to write a file to the current directory.',1),
+12011 => array('Can\'t create truecolor image. Check that you really have GD2 library installed.',0),
+12012 => array('Can\'t create image. Check that you really have GD2 library installed.',0),
+
+/*
+**  jpgraph_pie3d
+*/
+
+14001 => array('Pie3D::ShowBorder() . Deprecated function. Use Pie3D::SetEdge() to control the edges around slices.',0),
+14002 => array('PiePlot3D::SetAngle() 3D Pie projection angle must be between 5 and 85 degrees.',0),
+14003 => array('Internal assertion failed. Pie3D::Pie3DSlice',0),
+14004 => array('Slice start angle must be between 0 and 360 degrees.',0),
+14005 => array('Pie3D Internal error: Trying to wrap twice when looking for start index',0,),
+14006 => array('Pie3D Internal Error: Z-Sorting algorithm for 3D Pies is not working properly (2). Trying to wrap twice while stroking.',0),
+14007 => array('Width for 3D Pie is 0. Specify a size > 0',0),
+
+/*
+**  jpgraph_pie
+*/
+
+15001 => array('PiePLot::SetTheme() Unknown theme: %s',1),
+15002 => array('Argument to PiePlot::ExplodeSlice() must be an integer',0),
+15003 => array('Argument to PiePlot::Explode() must be an array with integer distances.',0),
+15004 => array('Slice start angle must be between 0 and 360 degrees.',0),
+15005 => array('PiePlot::SetFont() is deprecated. Use PiePlot->value->SetFont() instead.',0),
+15006 => array('PiePlot::SetSize() Radius for pie must either be specified as a fraction [0, 0.5] of the size of the image or as an absolute size in pixels  in the range [10, 1000]',0),
+15007 => array('PiePlot::SetFontColor() is deprecated. Use PiePlot->value->SetColor() instead.',0),
+15008 => array('PiePlot::SetLabelType() Type for pie plots must be 0 or 1 (not %d).',1),
+15009 => array('Illegal pie plot. Sum of all data is zero for Pie Plot',0),
+15010 => array('Sum of all data is 0 for Pie.',0),
+15011 => array('In order to use image transformation you must include the file jpgraph_imgtrans.php in your script.',0),
+
+/*
+**  jpgraph_plotband
+*/
+
+16001 => array('Density for pattern must be between 1 and 100. (You tried %f)',1),
+16002 => array('No positions specified for pattern.',0),
+16003 => array('Unknown pattern specification (%d)',0),
+16004 => array('Min value for plotband is larger than specified max value. Please correct.',0),
+
+
+/*
+**  jpgraph_polar
+*/
+
+17001 => array('Polar plots must have an even number of data point. Each data point is a tuple (angle,radius).',0),
+17002 => array('Unknown alignment specified for X-axis title. (%s)',1),
+//17003 => array('Set90AndMargin() is not supported for polar graphs.',0),
+17004 => array('Unknown scale type for polar graph. Must be "lin" or "log"',0),
+
+/*
+**  jpgraph_radar
+*/
+
+18001 => array('Client side image maps not supported for RadarPlots.',0),
+18002 => array('RadarGraph::SupressTickMarks() is deprecated. Use HideTickMarks() instead.',0),
+18003 => array('Illegal scale for radarplot (%s). Must be \'lin\' or \'log\'',1),
+18004 => array('Radar Plot size must be between 0.1 and 1. (Your value=%f)',1),
+18005 => array('RadarPlot Unsupported Tick density: %d',1),
+18006 => array('Minimum data %f (Radar plots should only be used when all data points > 0)',1),
+18007 => array('Number of titles does not match number of points in plot.',0),
+18008 => array('Each radar plot must have the same number of data points.',0),
+
+/*
+**  jpgraph_regstat
+*/
+
+19001 => array('Spline: Number of X and Y coordinates must be the same',0),
+19002 => array('Invalid input data for spline. Two or more consecutive input X-values are equal. Each input X-value must differ since from a mathematical point of view it must be a one-to-one mapping, i.e. each X-value must correspond to exactly one Y-value.',0),
+19003 => array('Bezier: Number of X and Y coordinates must be the same',0),
+
+/*
+**  jpgraph_scatter
+*/
+
+20001 => array('Fieldplots must have equal number of X and Y points.',0),
+20002 => array('Fieldplots must have an angle specified for each X and Y points.',0),
+20003 => array('Scatterplot must have equal number of X and Y points.',0),
+
+/*
+**  jpgraph_stock
+*/
+
+21001 => array('Data values for Stock charts must contain an even multiple of %d data points.',1),
+
+/*
+**  jpgraph_plotmark
+*/
+
+23001 => array('This marker "%s" does not exist in color with index: %d',2),
+23002 => array('Mark color index too large for marker "%s"',1),
+23003 => array('A filename must be specified if you set the mark type to MARK_IMG.',0),
+
+/*
+**  jpgraph_utils
+*/
+
+24001 => array('FuncGenerator : No function specified. ',0),
+24002 => array('FuncGenerator : Syntax error in function specification ',0),
+
+/*
+**  jpgraph
+*/
+
+25001 => array('This PHP installation is not configured with the GD library. Please recompile PHP with GD support to run JpGraph. (Neither function imagetypes() nor imagecreatefromstring() does exist)',0),
+25002 => array('Your PHP installation does not seem to have the required GD library. Please see the PHP documentation on how to install and enable the GD library.',0),
+25003 => array('General PHP error : At %s:%d : %s',3),
+25004 => array('General PHP error : %s ',1),
+25005 => array('Can\'t access PHP_SELF, PHP global variable. You can\'t run PHP from command line if you want to use the \'auto\' naming of cache or image files.',0),
+25006 => array('Usage of FF_CHINESE (FF_BIG5) font family requires that your PHP setup has the iconv() function. By default this is not compiled into PHP (needs the "--width-iconv" when configured).',0),
+25007 => array('You are trying to use the locale (%s) which your PHP installation does not support. Hint: Use \'\' to indicate the default locale for this geographic region.',1),
+25008 => array('Image width/height argument in Graph::Graph() must be numeric',0),
+25009 => array('You must specify what scale to use with a call to Graph::SetScale()',0),
+
+25010 => array('Graph::Add() You tried to add a null plot to the graph.',0),
+25011 => array('Graph::AddY2() You tried to add a null plot to the graph.',0), 
+25012 => array('Graph::AddYN() You tried to add a null plot to the graph.',0), 
+25013 => array('You can only add standard plots to multiple Y-axis',0),
+25014 => array('Graph::AddText() You tried to add a null text to the graph.',0), 
+25015 => array('Graph::AddLine() You tried to add a null line to the graph.',0), 
+25016 => array('Graph::AddBand() You tried to add a null band to the graph.',0),
+25017 => array('You are using GD 2.x and are trying to use a background images on a non truecolor image. To use background images with GD 2.x it is necessary to enable truecolor by setting the USE_TRUECOLOR constant to TRUE. Due to a bug in GD 2.0.1 using any truetype fonts with truecolor images will result in very poor quality fonts.',0),
+25018 => array('Incorrect file name for Graph::SetBackgroundImage() : "%s" Must have a valid image extension (jpg,gif,png) when using auto detection of image type',1),
+25019 => array('Unknown file extension (%s) in Graph::SetBackgroundImage() for filename: "%s"',2),
+
+25020 => array('Graph::SetScale(): Specified Max value must be larger than the specified Min value.',0),
+25021 => array('Unknown scale specification for Y-scale. (%s)',1),
+25022 => array('Unknown scale specification for X-scale. (%s)',1),
+25023 => array('Unsupported Y2 axis type: "%s" Must be one of (lin,log,int)',1),
+25024 => array('Unsupported Y axis type:  "%s" Must be one of (lin,log,int)',1),
+25025 => array('Unsupported Tick density: %d',1),
+25026 => array('Can\'t draw unspecified Y-scale. You have either: 1. Specified an Y axis for auto scaling but have not supplied any plots. 2. Specified a scale manually but have forgot to specify the tick steps',0),
+25027 => array('Can\'t open cached CSIM "%s" for reading.',1),
+25028 => array('Apache/PHP does not have permission to write to the CSIM cache directory (%s). Check permissions.',1),
+25029 => array('Can\'t write CSIM "%s" for writing. Check free space and permissions.',1),
+
+25030 => array('Missing script name in call to StrokeCSIM(). You must specify the name of the actual image script as the first parameter to StrokeCSIM().',0),
+25031 => array('You must specify what scale to use with a call to Graph::SetScale().',0),
+25032 => array('No plots for Y-axis nbr:%d',1),
+25033 => array('',0),
+25034 => array('Can\'t draw unspecified X-scale. No plots specified.',0),
+25035 => array('You have enabled clipping. Clipping is only supported for graphs at 0 or 90 degrees rotation. Please adjust you current angle (=%d degrees) or disable clipping.',1),
+25036 => array('Unknown AxisStyle() : %s',1),
+25037 => array('The image format of your background image (%s) is not supported in your system configuration. ',1),
+25038 => array('Background image seems to be of different type (has different file extension) than specified imagetype. Specified: %s File: %s',2),
+25039 => array('Can\'t read background image: "%s"',1), 
+
+25040 => array('It is not possible to specify both a background image and a background country flag.',0),
+25041 => array('In order to use Country flags as backgrounds you must include the "jpgraph_flags.php" file.',0),
+25042 => array('Unknown background image layout',0),
+25043 => array('Unknown title background style.',0),
+25044 => array('Cannot use auto scaling since it is impossible to determine a valid min/max value of the Y-axis (only null values).',0),
+25045 => array('Font families FF_HANDWRT and FF_BOOK are no longer available due to copyright problem with these fonts. Fonts can no longer be distributed with JpGraph. Please download fonts from http://corefonts.sourceforge.net/',0),
+25046 => array('Specified TTF font family (id=%d) is unknown or does not exist. Please note that TTF fonts are not distributed with JpGraph for copyright reasons. You can find the MS TTF WEB-fonts (arial, courier etc) for download at http://corefonts.sourceforge.net/',1),
+25047 => array('Style %s is not available for font family %s',2),
+25048 => array('Unknown font style specification [%s].',1),
+25049 => array('Font file "%s" is not readable or does not exist.',1),
+
+25050 => array('First argument to Text::Text() must be a string.',0),
+25051 => array('Invalid direction specified for text.',0),
+25052 => array('PANIC: Internal error in SuperScript::Stroke(). Unknown vertical alignment for text',0),
+25053 => array('PANIC: Internal error in SuperScript::Stroke(). Unknown horizontal alignment for text',0),
+25054 => array('Internal error: Unknown grid axis %s',1),
+25055 => array('Axis::SetTickDirection() is deprecated. Use Axis::SetTickSide() instead',0),
+25056 => array('SetTickLabelMargin() is deprecated. Use Axis::SetLabelMargin() instead.',0),
+25057 => array('SetTextTicks() is deprecated. Use SetTextTickInterval() instead.',0), 
+25058 => array('Text label interval must be specified >= 1.',0),
+25059 => array('SetLabelPos() is deprecated. Use Axis::SetLabelSide() instead.',0),
+
+25060 => array('Unknown alignment specified for X-axis title. (%s)',1),
+25061 => array('Unknown alignment specified for Y-axis title. (%s)',1),
+25062 => array('Labels at an angle are not supported on Y-axis',0),
+25063 => array('Ticks::SetPrecision() is deprecated. Use Ticks::SetLabelFormat() (or Ticks::SetFormatCallback()) instead',0),
+25064 => array('Minor or major step size is 0. Check that you haven\'t got an accidental SetTextTicks(0) in your code. If this is not the case you might have stumbled upon a bug in JpGraph. Please report this and if possible include the data that caused the problem',0),
+25065 => array('Tick positions must be specified as an array()',0),
+25066 => array('When manually specifying tick positions and labels the number of labels must be the same as the number of specified ticks.',0),
+25067 => array('Your manually specified scale and ticks is not correct. The scale seems to be too small to hold any of the specified tick marks.',0),
+25068 => array('A plot has an illegal scale. This could for example be that you are trying to use text auto scaling to draw a line plot with only one point or that the plot area is too small. It could also be that no input data value is numeric (perhaps only \'-\' or \'x\')',0),
+25069 => array('Grace must be larger then 0',0),
+
+25070 => array('Your data contains non-numeric values.',0),
+25071 => array('You have specified a min value with SetAutoMin() which is larger than the maximum value used for the scale. This is not possible.',0),
+25072 => array('You have specified a max value with SetAutoMax() which is smaller than the minimum value used for the scale. This is not possible.',0),
+25073 => array('Internal error. Integer scale algorithm comparison out of bound (r=%f)',1),
+25074 => array('Internal error. The scale range is negative (%f) [for %s scale] This problem could potentially be caused by trying to use \"illegal\" values in the input data arrays (like trying to send in strings or only NULL values) which causes the auto scaling to fail.',2),
+25075 => array('Can\'t automatically determine ticks since min==max.',0),
+25077 => array('Adjustment factor for color must be > 0',0),
+25078 => array('Unknown color: %s',1),
+25079 => array('Unknown color specification: %s, size=%d',2),
+
+25080 => array('Alpha parameter for color must be between 0.0 and 1.0',0),
+25081 => array('Selected graphic format is either not supported or unknown [%s]',1),
+25082 => array('Illegal sizes specified for width or height when creating an image, (width=%d, height=%d)',2),
+25083 => array('Illegal image size when copying image. Size for copied to image is 1 pixel or less.',0),
+25084 => array('Failed to create temporary GD canvas. Possible Out of memory problem.',0),
+25085 => array('An image can not be created from the supplied string. It is either in a format not supported or the string is representing an corrupt image.',0),
+25086 => array('You only seem to have GD 1.x installed. To enable Alphablending requires GD 2.x or higher. Please install GD or make sure the constant USE_GD2 is specified correctly to reflect your installation. By default it tries to auto detect what version of GD you have installed. On some very rare occasions it may falsely detect GD2 where only GD1 is installed. You must then set USE_GD2 to false.',0),
+25087 => array('This PHP build has not been configured with TTF support. You need to recompile your PHP installation with FreeType support.',0),
+25088 => array('You have a misconfigured GD font support. The call to imagefontwidth() fails.',0),
+25089 => array('You have a misconfigured GD font support. The call to imagefontheight() fails.',0),
+
+25090 => array('Unknown direction specified in call to StrokeBoxedText() [%s]',1),
+25091 => array('Internal font does not support drawing text at arbitrary angle. Use TTF fonts instead.',0),
+25092 => array('There is either a configuration problem with TrueType or a problem reading font file "%s" Make sure file exists and is in a readable place for the HTTP process. (If \'basedir\' restriction is enabled in PHP then the font file must be located in the document root.). It might also be a wrongly installed FreeType library. Try upgrading to at least FreeType 2.1.13 and recompile GD with the correct setup so it can find the new FT library.',1),
+25093 => array('Can not read font file "%s" in call to Image::GetBBoxTTF. Please make sure that you have set a font before calling this method and that the font is installed in the TTF directory.',1),
+25094 => array('Direction for text most be given as an angle between 0 and 90.',0),
+25095 => array('Unknown font font family specification. ',0),
+25096 => array('Can\'t allocate any more colors in palette image. Image has already allocated maximum of %d colors and the palette  is now full. Change to a truecolor image instead',0),
+25097 => array('Color specified as empty string in PushColor().',0),
+25098 => array('Negative Color stack index. Unmatched call to PopColor()',0),
+25099 => array('Parameters for brightness and Contrast out of range [-1,1]',0), 
+
+25100 => array('Problem with color palette and your GD setup. Please disable anti-aliasing or use GD2 with true-color. If you have GD2 library installed please make sure that you have set the USE_GD2 constant to true and truecolor is enabled.',0),
+25101 => array('Illegal numeric argument to SetLineStyle(): (%d)',1),
+25102 => array('Illegal string argument to SetLineStyle(): %s',1),
+25103 => array('Illegal argument to SetLineStyle %s',1),
+25104 => array('Unknown line style: %s',1),
+25105 => array('NULL data specified for a filled polygon. Check that your data is not NULL.',0),
+25106 => array('Image::FillToBorder : Can not allocate more colors',0),
+25107 => array('Can\'t write to file "%s". Check that the process running PHP has enough permission.',1),
+25108 => array('Can\'t stream image. This is most likely due to a faulty PHP/GD setup. Try to recompile PHP and use the built-in GD library that comes with PHP.',0),
+25109 => array('Your PHP (and GD-lib) installation does not appear to support any known graphic formats. You need to first make sure GD is compiled as a module to PHP. If you also want to use JPEG images you must get the JPEG library. Please see the PHP docs for details.',0),
+
+25110 => array('Your PHP installation does not support the chosen graphic format: %s',1),
+25111 => array('Can\'t delete cached image %s. Permission problem?',1),
+25112 => array('Cached imagefile (%s) has file date in the future.',1),
+25113 => array('Can\'t delete cached image "%s". Permission problem?',1),
+25114 => array('PHP has not enough permissions to write to the cache file "%s". Please make sure that the user running PHP has write permission for this file if you wan to use the cache system with JpGraph.',1),
+25115 => array('Can\'t set permission for cached image "%s". Permission problem?',1),
+25116 => array('Cant open file from cache "%s"',1), 
+25117 => array('Can\'t open cached image "%s" for reading.',1),
+25118 => array('Can\'t create directory "%s". Make sure PHP has write permission to this directory.',1),
+25119 => array('Can\'t set permissions for "%s". Permission problems?',1),
+
+25120 => array('Position for legend must be given as percentage in range 0-1',0),
+25121 => array('Empty input data array specified for plot. Must have at least one data point.',0),
+25122 => array('Stroke() must be implemented by concrete subclass to class Plot',0),
+25123 => array('You can\'t use a text X-scale with specified X-coords. Use a "int" or "lin" scale instead.',0),
+25124 => array('The input data array must have consecutive values from position 0 and forward. The given y-array starts with empty values (NULL)',0),
+25125 => array('Illegal direction for static line',0),
+25126 => array('Can\'t create truecolor image. Check that the GD2 library is properly setup with PHP.',0),
+
+/*
+**---------------------------------------------------------------------------------------------
+** Pro-version strings
+**---------------------------------------------------------------------------------------------
+*/
+
+/*
+**  jpgraph_table 
+*/
+
+24001 => array('GTextTable: Invalid argument to Set(). Array argument must be 2 dimensional',0),
+24002 => array('GTextTable: Invalid argument to Set()',0),
+24003 => array('GTextTable: Wrong number of arguments to GTextTable::SetColor()',0),
+24004 => array('GTextTable: Specified cell range to be merged is not valid.',0),
+24005 => array('GTextTable: Cannot merge already merged cells in the range: (%d,%d) to (%d,%d)',4),
+24006 => array('GTextTable: Column argument = %d is outside specified table size.',1),
+24007 => array('GTextTable: Row argument = %d is outside specified table size.',1),
+24008 => array('GTextTable: Column and row size arrays must match the dimensions of the table',0),
+24009 => array('GTextTable: Number of table columns or rows are 0. Make sure Init() or Set() is called.',0),
+24010 => array('GTextTable: No alignment specified in call to SetAlign()',0),
+24011 => array('GTextTable: Unknown alignment specified in SetAlign(). Horizontal=%s, Vertical=%s',2),
+24012 => array('GTextTable: Internal error. Invalid alignment specified =%s',1),
+24013 => array('GTextTable: Argument to FormatNumber() must be a string.',0),
+24014 => array('GTextTable: Table is not initilaized with either a call to Set() or Init()',0),
+24015 => array('GTextTable: Cell image constrain type must be TIMG_WIDTH or TIMG_HEIGHT',0),
+
+/*
+**  jpgraph_windrose
+*/
+
+22001 => array('Total percentage for all windrose legs in a windrose plot can not exceed 100% !\n(Current max is: %d)',1),
+22002 => array('Graph is too small to have a scale. Please make the graph larger.',0),
+22004 => array('Label specification for windrose directions must have 16 values (one for each compass direction).',0),
+22005 => array('Line style for radial lines must be on of ("solid","dotted","dashed","longdashed") ',0),
+22006 => array('Illegal windrose type specified.',0),
+22007 => array('To few values for the range legend.',0),
+22008 => array('Internal error: Trying to plot free Windrose even though type is not a free windrose',0),
+22009 => array('You have specified the same direction twice, once with an angle and once with a compass direction (%f degrees)',0),
+22010 => array('Direction must either be a numeric value or one of the 16 compass directions',0),
+22011 => array('Windrose index must be numeric or direction label. You have specified index=%d',1),
+22012 => array('Windrose radial axis specification contains a direction which is not enabled.',0),
+22013 => array('You have specified the look&feel for the same compass direction twice, once with text and once with index (Index=%d)',1),
+22014 => array('Index for compass direction must be between 0 and 15.',0),
+22015 => array('You have specified an undefined Windrose plot type.',0),
+22016 => array('Windrose leg index must be numeric or direction label.',0),
+22017 => array('Windrose data contains a direction which is not enabled. Please adjust what labels are displayed.',0),
+22018 => array('You have specified data for the same compass direction twice, once with text and once with index (Index=%d)',1),
+22019 => array('Index for direction must be between 0 and 15. You can\'t specify angles for a Regular Windplot, only index and compass directions.',0),
+22020 => array('Windrose plot is too large to fit the specified Graph size. Please use WindrosePlot::SetSize() to make the plot smaller or increase the size of the Graph in the initial WindroseGraph() call.',0),
+
+/*
+**  jpgraph_odometer
+*/
+
+13001 => array('Unknown needle style (%d).',1),
+13002 => array('Value for odometer (%f) is outside specified scale [%f,%f]',3),
+
+/*
+**  jpgraph_barcode
+*/
+
+1001 => array('Unknown encoder specification: %s',1),
+1002 => array('Data validation failed. Can\'t encode [%s] using encoding "%s"',2),
+1003 => array('Internal encoding error. Trying to encode %s is not possible in Code 128',1),
+1004 => array('Internal barcode error. Unknown UPC-E encoding type: %s',1),
+1005 => array('Internal error. Can\'t encode character tuple (%s, %s) in Code-128 charset C',2),
+1006 => array('Internal encoding error for CODE 128. Trying to encode control character in CHARSET != A',0),
+1007 => array('Internal encoding error for CODE 128. Trying to encode DEL in CHARSET != B',0),
+1008 => array('Internal encoding error for CODE 128. Trying to encode small letters in CHARSET != B',0),
+1009 => array('Encoding using CODE 93 is not yet supported.',0),
+1010 => array('Encoding using POSTNET is not yet supported.',0),
+1011 => array('Non supported barcode backend for type %s',1),
+
+/*
+** PDF417
+*/
+
+26001 => array('PDF417: Number of Columns must be >= 1 and <= 30',0),
+26002 => array('PDF417: Error level must be between 0 and 8',0),
+26003 => array('PDF417: Invalid format for input data to encode with PDF417',0),
+26004 => array('PDF417: Can\'t encode given data with error level %d and %d columns since it results in too many symbols or more than 90 rows.',2),
+26005 => array('PDF417: Can\'t open file "%s" for writing',1),
+26006 => array('PDF417: Internal error. Data files for PDF417 cluster %d is corrupted.',1),
+26007 => array('PDF417: Internal error. GetPattern: Illegal Code Value = %d (row=%d)',2),
+26008 => array('PDF417: Internal error. Mode not found in mode list!! mode=%d',1),
+26009 => array('PDF417: Encode error: Illegal character. Can\'t encode character with ASCII code=%d',1),
+26010 => array('PDF417: Internal error: No input data in decode.',0),
+26011 => array('PDF417: Encoding error. Can\'t use numeric encoding on non-numeric data.',0),
+26012 => array('PDF417: Internal error. No input data to decode for Binary compressor.',0),
+26013 => array('PDF417: Internal error. Checksum error. Coefficient tables corrupted.',0),
+26014 => array('PDF417: Internal error. No data to calculate codewords on.',0),
+26015 => array('PDF417: Internal error. State transition table entry 0 is NULL. Entry 1 = (%s)',1),
+26016 => array('PDF417: Internal error: Unrecognized state transition mode in decode.',0),
+
+
+);
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/js/datetimepicker.js php-syslog-ng/html/includes/js/datetimepicker.js
--- php-syslog-ng-2.9.f/html/includes/js/datetimepicker.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/js/datetimepicker.js	2009-02-23 11:56:36.000000000 -0500
@@ -0,0 +1,574 @@
+//Javascript name: My Date Time Picker
+//Date created: 16-Nov-2003 23:19
+//Scripter: TengYong Ng
+//Website: http://www.rainforestnet.com
+//Copyright (c) 2003 TengYong Ng
+//FileName: DateTimePicker.js
+//Version: 0.8
+//Contact: contact@rainforestnet.com
+// Note: Permission given to use this script in ANY kind of applications if
+//       header lines are left unchanged.
+
+// ------- addition to the original header -------------
+// Modified version of TenyYong's My Date Time Picker Script
+// Modified by Aytekin Tank<atank@interlogy.com>, Interlogy LLC.
+// This modified version is released with same license as above:
+    // Note: Permission given to use this script in ANY kind of applications if
+    //       header lines are left unchanged.
+// Original script is available at www.javascriptkit.com/script/script2/tengcalendar.shtml
+// ------- addition to the original header ends -------------
+
+
+
+//Global variables
+var winCal = null;
+var dtToday=new Date();
+var Cal = null;
+var docCal = null;
+var MonthName=["January", "February", "March", "April", "May", "June","July", 
+	"August", "September", "October", "November", "December"];
+var WeekDayName=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];	
+var exDateTime = null;//Existing Date and Time
+
+//Configurable parameters
+var cnTop="200";//top coordinate of calendar window.
+var cnLeft="500";//left coordinate of calendar window
+var WindowTitle ="Pick a Date";//Date Time Picker title.
+var WeekChar=2;//number of character for week day. if 2 then Mo,Tu,We. if 3 then Mon,Tue,Wed.
+var CellWidth=21;//Width of day cell.
+var CellHeight = 100; //Height of the cell if this is a largecalbox
+var DateSeparator="-";//Date Separator, you can change it to "/" if you want.
+var TimeMode=24;//default TimeMode value. 12 or 24
+
+var ShowLongMonth=true;//Show long month name in Calendar header. example: "January".
+var ShowMonthYear=true;//Show Month and Year in Calendar header.
+var MonthYearColor="#f9621a";//Font Color of Month and Year in Calendar header.
+var WeekHeadColor="#cfcfcf";//Background Color in Week header.
+var SundayColor="#b5cfe9";//Background color of Sunday.
+var SaturdayColor="#b5cfe9";//Background color of Saturday.
+var WeekDayColor="f5f5f5";//Background color of weekdays.
+var FontColor="blue";//color of font in Calendar day cell.
+var TodayColor="#f9621a";//Background color of today.
+var SelDateColor="#f9621a";//Backgrond color of selected date in textbox.
+var YrSelColor="#000000";//color of font of Year selector.
+var ThemeBg="";//Background image of Calendar window.
+//end Configurable parameters
+//end Global variable
+
+function NewCal(pCtrl,pFormat,pShowTime,pTimeMode)
+{
+	Cal=new Calendar(dtToday);
+	if ((pShowTime!=null) && (pShowTime))
+	{
+		Cal.ShowTime=true;
+		if ((pTimeMode!=null) &&((pTimeMode=='12')||(pTimeMode=='24')))
+		{
+			TimeMode=pTimeMode;
+		}		
+	}	
+	if (pCtrl!=null)
+		Cal.Ctrl=pCtrl;
+	if (pFormat!=null)
+		Cal.Format=pFormat.toUpperCase();
+	var exDateTime = "";
+	if (pCtrl!='inline')
+            exDateTime=document.getElementById(pCtrl).value;
+	if (exDateTime!="")//Parse Date String
+	{
+		var Sp1;//Index of Date Separator 1
+		var Sp2;//Index of Date Separator 2 
+		var tSp1;//Index of Time Separator 1
+		var tSp1;//Index of Time Separator 2
+		var strMonth;
+		var strDate;
+		var strYear;
+		var intMonth;
+		var YearPattern;
+		var strHour;
+		var strMinute;
+		//var strSecond;
+		//parse month
+		Sp1=exDateTime.indexOf(DateSeparator,0)
+		Sp2=exDateTime.indexOf(DateSeparator,(parseInt(Sp1)+1));
+		
+		if ((Cal.Format.toUpperCase()=="DDMMYYYY") || (Cal.Format.toUpperCase()=="DDMMMYYYY"))
+		{
+			strMonth=exDateTime.substring(Sp1+1,Sp2);
+			strDate=exDateTime.substring(0,Sp1);
+		}
+		else if ((Cal.Format.toUpperCase()=="MMDDYYYY") || (Cal.Format.toUpperCase()=="MMMDDYYYY"))
+		{
+			strMonth=exDateTime.substring(0,Sp1);
+			strDate=exDateTime.substring(Sp1+1,Sp2);
+		}
+		if (isNaN(strMonth))
+			intMonth=Cal.GetMonthIndex(strMonth);
+		else
+			intMonth=parseInt(strMonth,10)-1;	
+		if ((parseInt(intMonth,10)>=0) && (parseInt(intMonth,10)<12))
+			Cal.Month=intMonth;
+		//end parse month
+		//parse Date
+		if ((parseInt(strDate,10)<=Cal.GetMonDays()) && (parseInt(strDate,10)>=1))
+			Cal.Date=strDate;
+		//end parse Date
+		//parse year
+		strYear=exDateTime.substring(Sp2+1,Sp2+5);
+		YearPattern=/^\d{4}$/;
+		if (YearPattern.test(strYear))
+			Cal.Year=parseInt(strYear,10);
+		//end parse year
+		//parse time
+		if (Cal.ShowTime==true)
+		{
+			tSp1=exDateTime.indexOf(":",0)
+			tSp2=exDateTime.indexOf(":",(parseInt(tSp1)+1));
+			strHour=exDateTime.substring(tSp1,(tSp1)-2);
+			Cal.SetHour(strHour);
+			strMinute=exDateTime.substring(tSp1+1,tSp2);
+			Cal.SetMinute(strMinute);
+			//strSecond=exDateTime.substring(tSp2+1,tSp2+3);
+			//Cal.SetSecond(strSecond);
+		}	
+	}
+        if( pCtrl =='calbox' ){
+            winCal=window.calframe;
+            docCal = winCal.document;
+        }else if( pCtrl =='largecalbox' ){
+            winCal=window.largecalframe;
+            docCal = winCal.document;
+        } else {
+            winCal=window.open("","DateTimePicker","toolbar=0,status=0,menubar=0,fullscreen=no,width=195,height=195,resizable=0,top="+cnTop+",left="+cnLeft);
+            docCal = winCal.document;
+        }
+	RenderCal(pCtrl);
+}
+
+function RenderCal(pCtrl)
+{
+	var vCalHeader;
+	var vCalData;
+	var vCalTime;
+	var i;
+	var j;
+	var SelectStr;
+	var vDayCount=0;
+	var vFirstDay;
+
+	docCal.open();
+        if(pCtrl != "calbox" && pCtrl != "largecalbox"){
+            docCal.writeln("<html><head><title>"+WindowTitle+"</title>");
+            docCal.writeln("<style>a {color: #333333; text-decoration: none; font-weight:none; font-family:'Trebuchet MS' }</style>");
+            docCal.writeln("<script>var winMain=window.opener;</script>");
+            docCal.writeln("</head><body background='"+ThemeBg+"' link="+FontColor+" vlink="+FontColor+">");
+        }else{
+            docCal.writeln("<html><head>");
+            docCal.writeln("<style>a {color: black; text-decoration: none; font-weight:none; font-family:'Trebuchet MS' }</style>");
+            docCal.writeln("<script>var winMain=window.parent ;</script>");
+            docCal.writeln("</head><body background='"+ThemeBg+"' link="+FontColor+" vlink="+FontColor+">");
+        }
+        docCal.writeln("<form name='Calendar'>");
+	vCalHeader="<table border=0 cellpadding=1 cellspacing=1 width='100%' align=\"center\" valign=\"top\">\n";
+
+	//Calendar header shows Month and Year
+	if (ShowMonthYear){
+		vCalHeader+="<tr><td colspan='7' align='center'>";
+                vCalHeader+="<table border=0 width=100% cellspacing=0 cellpadding=0><tr><td align=left>";
+                vCalHeader+="<a href=\"javascript:winMain.Cal.DecYear();winMain.RenderCal('"+pCtrl+"')\"><font color="+MonthYearColor+" size=2><b><<</b></font></a> ";
+                vCalHeader+="<a href=\"javascript:winMain.Cal.DecMonth();winMain.RenderCal('"+pCtrl+"')\"><font color="+MonthYearColor+" size=2><b><</b></font></a> ";
+                if(pCtrl == "largecalbox") vCalHeader+="&nbsp;";
+                vCalHeader+="</td><td align=center> ";
+                if(pCtrl == "largecalbox")
+                    vCalHeader+="<font face='Verdana' size='2' align='center' color='"+MonthYearColor+"'><b>"+Cal.GetMonthName(ShowLongMonth)+" "+Cal.Year+"</b></font>";
+                else
+                    vCalHeader+="<font face='Verdana' size='1' align='center' color='"+MonthYearColor+"'><b>"+Cal.GetMonthName(ShowLongMonth)+" "+Cal.Year+"</b></font>";
+                vCalHeader+="</td><td align=right>";
+                vCalHeader+=" <a href=\"javascript:winMain.Cal.IncMonth();winMain.RenderCal('"+pCtrl+"')\"><font color="+MonthYearColor+" size=2><b>></b></font></a> ";
+                if(pCtrl == "largecalbox") vCalHeader+="&nbsp;";
+                vCalHeader+=" <a href=\"javascript:winMain.Cal.IncYear();winMain.RenderCal('"+pCtrl+"')\"><font color="+MonthYearColor+" size=2><b>>></b></font></a>";
+                vCalHeader+="</td></tr></table>";
+                vCalHeader+="</td></tr>\n";
+        }
+
+	//Week day header
+	vCalHeader+="<tr bgcolor="+WeekHeadColor+">";
+	for (i=0;i<7;i++)
+	{
+		vCalHeader+="<td align='center'><font face='Trebuchet MS' size='2'>"+WeekDayName[i].substr(0,WeekChar)+"</font></td>";
+	}
+	vCalHeader+="</tr>";	
+	docCal.write(vCalHeader);
+	
+	//Calendar detail
+	CalDate=new Date(Cal.Year,Cal.Month);
+	CalDate.setDate(1);
+	vFirstDay=CalDate.getDay();
+	vCalData="<tr>";
+	for (i=0;i<vFirstDay;i++)
+	{
+		vCalData=vCalData+GenCell(pCtrl);
+		vDayCount=vDayCount+1;
+	}
+	for (j=1;j<=Cal.GetMonDays();j++)
+	{
+		var strCell;
+		vDayCount=vDayCount+1;
+		if ((j==dtToday.getDate())&&(Cal.Month==dtToday.getMonth())&&(Cal.Year==dtToday.getFullYear()))
+			strCell=GenCell(pCtrl, j,true,TodayColor);//Highlight today's date
+		else
+		{
+			if (j==Cal.Date)
+			{
+				strCell=GenCell(pCtrl, j,true,SelDateColor);
+			}
+			else
+			{	 
+				if (vDayCount%7==0)
+					strCell=GenCell(pCtrl, j,false,SaturdayColor);
+				else if ((vDayCount+6)%7==0)
+					strCell=GenCell(pCtrl, j,false,SundayColor);
+				else
+					strCell=GenCell(pCtrl, j,null,WeekDayColor);
+			}		
+		}						
+		vCalData=vCalData+strCell;
+
+		if((vDayCount%7==0)&&(j<Cal.GetMonDays()))
+		{
+			vCalData=vCalData+"</tr>\n<tr>";
+		}
+	}
+	docCal.writeln(vCalData);	
+	//Time picker
+	if (Cal.ShowTime)
+	{
+		var showHour;
+		showHour=Cal.getShowHour();		
+		vCalTime="<tr>\n<td colspan='7' align='center'>";
+		vCalTime+="<input type='text' name='hour' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+showHour+" onchange=\"javascript:winMain.Cal.SetHour(this.value)\">";
+		vCalTime+=" : ";
+		vCalTime+="<input type='text' name='minute' maxlength=2 size=1 style=\"WIDTH: 22px\" value="+Cal.Minutes+" onchange=\"javascript:winMain.Cal.SetMinute(this.value)\">";
+		if (TimeMode==12)
+		{
+			var SelectAm =(parseInt(Cal.Hours,10)<12)? "Selected":"";
+			var SelectPm =(parseInt(Cal.Hours,10)>=12)? "Selected":"";
+
+			vCalTime+="<select name=\"ampm\" onchange=\"javascript:winMain.Cal.SetAmPm(this.options[this.selectedIndex].value);\">";
+			vCalTime+="<option "+SelectAm+" value=\"AM\">AM</option>";
+			vCalTime+="<option "+SelectPm+" value=\"PM\">PM<option>";
+			vCalTime+="</select>";
+		}	
+		vCalTime+="\n</td>\n</tr>";
+		docCal.write(vCalTime);
+	}
+	
+
+
+	//end time picker
+	docCal.writeln("\n</table>");
+        //if(pCtrl != "inline"){
+            docCal.writeln("</form></body></html>");
+        //}
+	docCal.close();
+}
+
+function GenCell(pCtrl, pValue,pHighLight,pColor)//Generate table cell with value
+{
+	var PValue;
+	var PCellStr;
+	var vColor;
+	var vHLstr1;//HighLight string
+	var vHlstr2;
+	var vTimeStr;
+	
+	if (pValue==null)
+		PValue="";
+	else
+		PValue=pValue;
+	
+	if (pColor!=null)
+		vColor="bgcolor=\""+pColor+"\"";
+	else
+		vColor="";	
+	if ((pHighLight!=null)&&(pHighLight))
+		{vHLstr1="color='red'><b>";vHLstr2="</b>";}
+	else
+		{vHLstr1=">";vHLstr2="";}	
+	
+	if (Cal.ShowTime)
+	{
+		vTimeStr="winMain.document.getElementById('"+Cal.Ctrl+"').value+=' '+"+"winMain.Cal.getShowHour()"+"+':'+"+"winMain.Cal.Minutes";  //+"+':'+"+"winMain.Cal.Seconds";
+		if (TimeMode==12)
+			vTimeStr+="+' '+winMain.Cal.AMorPM";
+	}	
+	else
+		vTimeStr="";		
+	PCellStr="\n <td width=14% ";  //+CellWidth;
+        if( pCtrl == "largecalbox"){
+            PCellStr+=" height="+CellHeight;
+        }
+        if( pCtrl == "largecalbox" ){
+            if( window.parent.Events[ Cal.FormatDate(PValue) ] != null ){
+                PCellStr+=" "+vColor+" align='center'>";
+                PCellStr+="<font color=navy face='verdana' size='2'"+vHLstr1;
+                PCellStr+= PValue + vHLstr2;
+                desc = window.parent.Events[ Cal.FormatDate(PValue) ];
+                if(desc.length>200){
+                    desc = desc.substr(0, 200) + "...";
+                } 
+                PCellStr+= "<br><font size=1 face=arial>" + desc + "</font></a>";
+            }else{
+                PCellStr+= " "+vColor+" align='center'><font face='verdana' size='2'"+vHLstr1+PValue+vHLstr2+"</font></td>";
+            }
+            PCellStr+="</font></td>";
+        } else if( pCtrl == "calbox" ){
+            if( window.parent.Events[ Cal.FormatDate(PValue) ] != null ){
+                PCellStr+= " bgcolor=gray align='center'>";
+                PCellStr+="<a target=_parent href="+window.parent.pmdir+"pm.cgi?action=app_search&app="+ window.parent.app_name;
+                PCellStr+="&bydate="+window.parent.app_field+"&fromdate=";
+                PCellStr+=Cal.FormatDate(PValue)+"&todate="+Cal.FormatDate(PValue);
+                PCellStr+="&sortby="+window.parent.app_field+">";
+                PCellStr+="<font color=navy face='verdana' size='2'"+vHLstr1;
+                PCellStr+= PValue + vHLstr2;
+                PCellStr+= "</font>";
+                PCellStr+= "</a>";
+            } else {
+                PCellStr+= " "+vColor+" align='center'><font face='verdana' size='2'"+vHLstr1+PValue+vHLstr2+"</font></td>";
+            }
+        }else{
+            PCellStr+=" "+vColor+" align='center'><font face='verdana' size='2'"+vHLstr1+"<a href=\"javascript:winMain.document.getElementById('"+Cal.Ctrl+"').value='"+Cal.FormatDate(PValue)+"';"+vTimeStr+";window.close();\">"+PValue+"</a>"+vHLstr2+"</font></td>";
+        }
+	return PCellStr;
+}
+
+function Calendar(pDate,pCtrl)
+{
+	//Properties
+	this.Date=pDate.getDate();//selected date
+	this.Month=pDate.getMonth();//selected month number
+	this.Year=pDate.getFullYear();//selected year in 4 digits
+	this.Hours=pDate.getHours();	
+	
+	if (pDate.getMinutes()<10)
+		this.Minutes="0"+pDate.getMinutes();
+	else
+		this.Minutes=pDate.getMinutes();
+	
+	//if (pDate.getSeconds()<10)
+	//	this.Seconds="0"+pDate.getSeconds();
+	//else		
+	//	this.Seconds=pDate.getSeconds();
+		
+	this.MyWindow=winCal;
+	this.Ctrl=pCtrl;
+	this.Format="ddMMyyyy";
+	this.Separator=DateSeparator;
+	this.ShowTime=false;
+	if (pDate.getHours()<12)
+		this.AMorPM="AM";
+	else
+		this.AMorPM="PM";	
+}
+
+function GetMonthIndex(shortMonthName)
+{
+	for (i=0;i<12;i++)
+	{
+		if (MonthName[i].substring(0,3).toUpperCase()==shortMonthName.toUpperCase())
+		{	return i;}
+	}
+}
+Calendar.prototype.GetMonthIndex=GetMonthIndex;
+
+function IncYear()
+{	Cal.Year++;}
+Calendar.prototype.IncYear=IncYear;
+
+function DecYear()
+{	Cal.Year--;}
+Calendar.prototype.DecYear=DecYear;
+
+function IncMonth()
+{	
+    if(Cal.Month==11) {
+        Cal.Month=0; 
+        Cal.Year++; 
+    } else  {
+        Cal.Month++;
+    }
+}
+Calendar.prototype.IncMonth=IncMonth;
+
+function DecMonth()
+{
+    if(Cal.Month==0) {
+        Cal.Month=11; 
+        Cal.Year--; 
+    } else { 
+        Cal.Month--;
+    }
+}
+Calendar.prototype.DecMonth=DecMonth;
+
+function SwitchMth(intMth)
+{	Cal.Month=intMth;}
+Calendar.prototype.SwitchMth=SwitchMth;
+
+function SetHour(intHour)
+{	
+	var MaxHour;
+	var MinHour;
+	if (TimeMode==24)
+	{	MaxHour=23;MinHour=0}
+	else if (TimeMode==12)
+	{	MaxHour=12;MinHour=1}
+	else
+		alert("TimeMode can only be 12 or 24");		
+	var HourExp=new RegExp("^\\d\\d$");
+	if (HourExp.test(intHour) && (parseInt(intHour,10)<=MaxHour) && (parseInt(intHour,10)>=MinHour))
+	{	
+		if ((TimeMode==12) && (Cal.AMorPM=="PM"))
+		{
+			if (parseInt(intHour,10)==12)
+				Cal.Hours=12;
+			else	
+				Cal.Hours=parseInt(intHour,10)+12;
+		}	
+		else if ((TimeMode==12) && (Cal.AMorPM=="AM"))
+		{
+			if (intHour==12)
+				intHour-=12;
+			Cal.Hours=parseInt(intHour,10);
+		}
+		else if (TimeMode==24)
+			Cal.Hours=parseInt(intHour,10);	
+	}
+}
+Calendar.prototype.SetHour=SetHour;
+
+function SetMinute(intMin)
+{
+	var MinExp=new RegExp("^\\d\\d$");
+	if (MinExp.test(intMin) && (intMin<60))
+		Cal.Minutes=intMin;
+}
+Calendar.prototype.SetMinute=SetMinute;
+
+function SetSecond(intSec)
+{	
+	var SecExp=new RegExp("^\\d\\d$");
+	if (SecExp.test(intSec) && (intSec<60))
+		Cal.Seconds=intSec;
+}
+//Calendar.prototype.SetSecond=SetSecond;
+
+function SetAmPm(pvalue)
+{
+	this.AMorPM=pvalue;
+	if (pvalue=="PM")
+	{
+		this.Hours=(parseInt(this.Hours,10))+12;
+		if (this.Hours==24)
+			this.Hours=12;
+	}	
+	else if (pvalue=="AM")
+		this.Hours-=12;	
+}
+Calendar.prototype.SetAmPm=SetAmPm;
+
+function getShowHour()
+{
+	var finalHour;
+    if (TimeMode==12)
+    {
+    	if (parseInt(this.Hours,10)==0)
+		{
+			this.AMorPM="AM";
+			finalHour=parseInt(this.Hours,10)+12;	
+		}
+		else if (parseInt(this.Hours,10)==12)
+		{
+			this.AMorPM="PM";
+			finalHour=12;
+		}		
+		else if (this.Hours>12)
+		{
+			this.AMorPM="PM";
+			if ((this.Hours-12)<10)
+				finalHour="0"+((parseInt(this.Hours,10))-12);
+			else
+				finalHour=parseInt(this.Hours,10)-12;	
+		}
+		else
+		{
+			this.AMorPM="AM";
+			if (this.Hours<10)
+				finalHour="0"+parseInt(this.Hours,10);
+			else
+				finalHour=this.Hours;	
+		}
+	}
+	else if (TimeMode==24)
+	{
+		if (this.Hours<10)
+			finalHour="0"+parseInt(this.Hours,10);
+		else	
+			finalHour=this.Hours;
+	}	
+	return finalHour;	
+}				
+Calendar.prototype.getShowHour=getShowHour;		
+
+function GetMonthName(IsLong)
+{
+	var Month=MonthName[this.Month];
+	if (IsLong)
+		return Month;
+	else
+		return Month.substr(0,3);
+}
+Calendar.prototype.GetMonthName=GetMonthName;
+
+function GetMonDays()//Get number of days in a month
+{
+	var DaysInMonth=[31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
+	if (this.IsLeapYear())
+	{
+		DaysInMonth[1]=29;
+	}	
+	return DaysInMonth[this.Month];	
+}
+Calendar.prototype.GetMonDays=GetMonDays;
+
+function IsLeapYear()
+{
+	if ((this.Year%4)==0)
+	{
+		if ((this.Year%100==0) && (this.Year%400)!=0)
+		{
+			return false;
+		}
+		else
+		{
+			return true;
+		}
+	}
+	else
+	{
+		return false;
+	}
+}
+Calendar.prototype.IsLeapYear=IsLeapYear;
+
+function FormatDate(pDate)
+{
+	if (this.Format.toUpperCase()=="DDMMYYYY")
+		return (pDate+DateSeparator+(this.Month+1)+DateSeparator+this.Year);
+	else if (this.Format.toUpperCase()=="DDMMMYYYY")
+		return (pDate+DateSeparator+this.GetMonthName(false)+DateSeparator+this.Year);
+	else if (this.Format.toUpperCase()=="MMDDYYYY")
+		return ((this.Month+1)+DateSeparator+pDate+DateSeparator+this.Year);
+	else if (this.Format.toUpperCase()=="MMMDDYYYY")
+		return (this.GetMonthName(false)+DateSeparator+pDate+DateSeparator+this.Year);			
+}
+Calendar.prototype.FormatDate=FormatDate;	
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/js/overlib.js php-syslog-ng/html/includes/js/overlib.js
--- php-syslog-ng-2.9.f/html/includes/js/overlib.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/js/overlib.js	2006-07-07 11:44:35.000000000 -0400
@@ -0,0 +1,1275 @@
+//\//////////////////////////////////////////////////////////////////////////////////
+//\  overLIB 3.51  --  This notice must remain untouched at all times.
+//\  Copyright Erik Bosrup 1998-2002. All rights reserved.
+//\
+//\  By Erik Bosrup (erik@bosrup.com).  Last modified 2002-11-01.
+//\  Portions by Dan Steinman (dansteinman.com). Additions by other people are
+//\  listed on the overLIB homepage.
+//\
+//\  Get the latest version at http://www.bosrup.com/web/overlib/
+//\
+//\  This script is published under an open source license. Please read the license
+//\  agreement online at: http://www.bosrup.com/web/overlib/license.html
+//\  If you have questions regarding the license please contact erik@bosrup.com.
+//\
+//\  This script library was originally created for personal use. By request it has
+//\  later been made public. This is free software. Do not sell this as your own
+//\  work, or remove this copyright notice. For full details on copying or changing
+//\  this script please read the license agreement at the link above.
+//\
+//\  Please give credit on sites that use overLIB and submit changes of the script
+//\  so other people can use them as well. This script is free to use, don't abuse.
+//\//////////////////////////////////////////////////////////////////////////////////
+//\mini
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// CONSTANTS
+// Don't touch these. :)
+////////////////////////////////////////////////////////////////////////////////////
+var INARRAY		=	1;
+var CAPARRAY		=	2;
+var STICKY		=	3;
+var BACKGROUND		=	4;
+var NOCLOSE		=	5;
+var CAPTION		=	6;
+var LEFT		=	7;
+var RIGHT		=	8;
+var CENTER		=	9;
+var OFFSETX		=	10;
+var OFFSETY		=	11;
+var FGCOLOR		=	12;
+var BGCOLOR		=	13;
+var TEXTCOLOR		=	14;
+var CAPCOLOR		=	15;
+var CLOSECOLOR		=	16;
+var WIDTH		=	17;
+var BORDER		=	18;
+var STATUS		=	19;
+var AUTOSTATUS		=	20;
+var AUTOSTATUSCAP	=	21;
+var HEIGHT		=	22;
+var CLOSETEXT		=	23;
+var SNAPX		=	24;
+var SNAPY		=	25;
+var FIXX		=	26;
+var FIXY		=	27;
+var FGBACKGROUND	=	28;
+var BGBACKGROUND	=	29;
+var PADX		=	30; // PADX2 out
+var PADY		=	31; // PADY2 out
+var FULLHTML		=	34;
+var ABOVE		=	35;
+var BELOW		=	36;
+var CAPICON		=	37;
+var TEXTFONT		=	38;
+var CAPTIONFONT		=	39;
+var CLOSEFONT		=	40;
+var TEXTSIZE		=	41;
+var CAPTIONSIZE		=	42;
+var CLOSESIZE		=	43;
+var FRAME		=	44;
+var TIMEOUT		=	45;
+var FUNCTION		=	46;
+var DELAY		=	47;
+var HAUTO		=	48;
+var VAUTO		=	49;
+var CLOSECLICK		=	50;
+var CSSOFF		=	51;
+var CSSSTYLE		=	52;
+var CSSCLASS		=	53;
+var FGCLASS		=	54;
+var BGCLASS		=	55;
+var TEXTFONTCLASS	=	56;
+var CAPTIONFONTCLASS	=	57;
+var CLOSEFONTCLASS	=	58;
+var PADUNIT		=	59;
+var HEIGHTUNIT		=	60;
+var WIDTHUNIT		=	61;
+var TEXTSIZEUNIT	=	62;
+var TEXTDECORATION	=	63;
+var TEXTSTYLE		=	64;
+var TEXTWEIGHT		=	65;
+var CAPTIONSIZEUNIT	=	66;
+var CAPTIONDECORATION	=	67;
+var CAPTIONSTYLE	=	68;
+var CAPTIONWEIGHT	=	69;
+var CLOSESIZEUNIT	=	70;
+var CLOSEDECORATION	=	71;
+var CLOSESTYLE		=	72;
+var CLOSEWEIGHT		=	73;
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// DEFAULT CONFIGURATION
+// You don't have to change anything here if you don't want to. All of this can be
+// changed on your html page or through an overLIB call.
+////////////////////////////////////////////////////////////////////////////////////
+
+// Main background color (the large area)
+// Usually a bright color (white, yellow etc)
+if (typeof ol_fgcolor == 'undefined') { var ol_fgcolor = "#CCCCFF";}
+	
+// Border color and color of caption
+// Usually a dark color (black, brown etc)
+if (typeof ol_bgcolor == 'undefined') { var ol_bgcolor = "#333399";}
+	
+// Text color
+// Usually a dark color
+if (typeof ol_textcolor == 'undefined') { var ol_textcolor = "#000000";}
+	
+// Color of the caption text
+// Usually a bright color
+if (typeof ol_capcolor == 'undefined') { var ol_capcolor = "#FFFFFF";}
+	
+// Color of "Close" when using Sticky
+// Usually a semi-bright color
+if (typeof ol_closecolor == 'undefined') { var ol_closecolor = "#9999FF";}
+
+// Font face for the main text
+if (typeof ol_textfont == 'undefined') { var ol_textfont = "Verdana,Arial,Helvetica";}
+
+// Font face for the caption
+if (typeof ol_captionfont == 'undefined') { var ol_captionfont = "Verdana,Arial,Helvetica";}
+
+// Font face for the close text
+if (typeof ol_closefont == 'undefined') { var ol_closefont = "Verdana,Arial,Helvetica";}
+
+// Font size for the main text
+// When using CSS this will be very small.
+if (typeof ol_textsize == 'undefined') { var ol_textsize = "1";}
+
+// Font size for the caption
+// When using CSS this will be very small.
+if (typeof ol_captionsize == 'undefined') { var ol_captionsize = "1";}
+
+// Font size for the close text
+// When using CSS this will be very small.
+if (typeof ol_closesize == 'undefined') { var ol_closesize = "1";}
+
+// Width of the popups in pixels
+// 100-300 pixels is typical
+if (typeof ol_width == 'undefined') { var ol_width = "200";}
+
+// How thick the ol_border should be in pixels
+// 1-3 pixels is typical
+if (typeof ol_border == 'undefined') { var ol_border = "1";}
+
+// How many pixels to the right/left of the cursor to show the popup
+// Values between 3 and 12 are best
+if (typeof ol_offsetx == 'undefined') { var ol_offsetx = 10;}
+	
+// How many pixels to the below the cursor to show the popup
+// Values between 3 and 12 are best
+if (typeof ol_offsety == 'undefined') { var ol_offsety = 10;}
+
+// Default text for popups
+// Should you forget to pass something to overLIB this will be displayed.
+if (typeof ol_text == 'undefined') { var ol_text = "Default Text"; }
+
+// Default caption
+// You should leave this blank or you will have problems making non caps popups.
+if (typeof ol_cap == 'undefined') { var ol_cap = ""; }
+
+// Decides if sticky popups are default.
+// 0 for non, 1 for stickies.
+if (typeof ol_sticky == 'undefined') { var ol_sticky = 0; }
+
+// Default background image. Better left empty unless you always want one.
+if (typeof ol_background == 'undefined') { var ol_background = ""; }
+
+// Text for the closing sticky popups.
+// Normal is "Close".
+if (typeof ol_close == 'undefined') { var ol_close = "Close"; }
+
+// Default vertical alignment for popups.
+// It's best to leave RIGHT here. Other options are LEFT and CENTER.
+if (typeof ol_hpos == 'undefined') { var ol_hpos = RIGHT; }
+
+// Default status bar text when a popup is invoked.
+if (typeof ol_status == 'undefined') { var ol_status = ""; }
+
+// If the status bar automatically should load either text or caption.
+// 0=nothing, 1=text, 2=caption
+if (typeof ol_autostatus == 'undefined') { var ol_autostatus = 0; }
+
+// Default height for popup. Often best left alone.
+if (typeof ol_height == 'undefined') { var ol_height = -1; }
+
+// Horizontal grid spacing that popups will snap to.
+// 0 makes no grid, anything else will cause a snap to that grid spacing.
+if (typeof ol_snapx == 'undefined') { var ol_snapx = 0; }
+
+// Vertical grid spacing that popups will snap to.
+// 0 makes no grid, andthing else will cause a snap to that grid spacing.
+if (typeof ol_snapy == 'undefined') { var ol_snapy = 0; }
+
+// Sets the popups horizontal position to a fixed column.
+// Anything above -1 will cause fixed position.
+if (typeof ol_fixx == 'undefined') { var ol_fixx = -1; }
+
+// Sets the popups vertical position to a fixed row.
+// Anything above -1 will cause fixed position.
+if (typeof ol_fixy == 'undefined') { var ol_fixy = -1; }
+
+// Background image for the popups inside.
+if (typeof ol_fgbackground == 'undefined') { var ol_fgbackground = ""; }
+
+// Background image for the popups frame.
+if (typeof ol_bgbackground == 'undefined') { var ol_bgbackground = ""; }
+
+// How much horizontal left padding text should get by default when BACKGROUND is used.
+if (typeof ol_padxl == 'undefined') { var ol_padxl = 1; }
+
+// How much horizontal right padding text should get by default when BACKGROUND is used.
+if (typeof ol_padxr == 'undefined') { var ol_padxr = 1; }
+
+// How much vertical top padding text should get by default when BACKGROUND is used.
+if (typeof ol_padyt == 'undefined') { var ol_padyt = 1; }
+
+// How much vertical bottom padding text should get by default when BACKGROUND is used.
+if (typeof ol_padyb == 'undefined') { var ol_padyb = 1; }
+
+// If the user by default must supply all html for complete popup control.
+// Set to 1 to activate, 0 otherwise.
+if (typeof ol_fullhtml == 'undefined') { var ol_fullhtml = 0; }
+
+// Default vertical position of the popup. Default should normally be BELOW.
+// ABOVE only works when HEIGHT is defined.
+if (typeof ol_vpos == 'undefined') { var ol_vpos = BELOW; }
+
+// Default height of popup to use when placing the popup above the cursor.
+if (typeof ol_aboveheight == 'undefined') { var ol_aboveheight = 0; }
+
+// Default icon to place next to the popups caption.
+if (typeof ol_capicon == 'undefined') { var ol_capicon = ""; }
+
+// Default frame. We default to current frame if there is no frame defined.
+if (typeof ol_frame == 'undefined') { var ol_frame = self; }
+
+// Default timeout. By default there is no timeout.
+if (typeof ol_timeout == 'undefined') { var ol_timeout = 0; }
+
+// Default javascript funktion. By default there is none.
+if (typeof ol_function == 'undefined') { var ol_function = null; }
+
+// Default timeout. By default there is no timeout.
+if (typeof ol_delay == 'undefined') { var ol_delay = 0; }
+
+// If overLIB should decide the horizontal placement.
+if (typeof ol_hauto == 'undefined') { var ol_hauto = 0; }
+
+// If overLIB should decide the vertical placement.
+if (typeof ol_vauto == 'undefined') { var ol_vauto = 0; }
+
+
+
+// If the user has to click to close stickies.
+if (typeof ol_closeclick == 'undefined') { var ol_closeclick = 0; }
+
+// This variable determines if you want to use CSS or inline definitions.
+// CSSOFF=no CSS    CSSSTYLE=use CSS inline styles    CSSCLASS=use classes
+if (typeof ol_css == 'undefined') { var ol_css = CSSOFF; }
+
+// Main background class (eqv of fgcolor)
+// This is only used if CSS is set to use classes (ol_css = CSSCLASS)
+if (typeof ol_fgclass == 'undefined') { var ol_fgclass = ""; }
+
+// Frame background class (eqv of bgcolor)
+// This is only used if CSS is set to use classes (ol_css = CSSCLASS)
+if (typeof ol_bgclass == 'undefined') { var ol_bgclass = ""; }
+
+// Main font class
+// This is only used if CSS is set to use classes (ol_css = CSSCLASS)
+if (typeof ol_textfontclass == 'undefined') { var ol_textfontclass = ""; }
+
+// Caption font class
+// This is only used if CSS is set to use classes (ol_css = CSSCLASS)
+if (typeof ol_captionfontclass == 'undefined') { var ol_captionfontclass = ""; }
+
+// Close font class
+// This is only used if CSS is set to use classes (ol_css = CSSCLASS)
+if (typeof ol_closefontclass == 'undefined') { var ol_closefontclass = ""; }
+
+// Unit to be used for the text padding above
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+// Options include "px", "%", "in", "cm"
+if (typeof ol_padunit == 'undefined') { var ol_padunit = "px";}
+
+// Unit to be used for height of popup
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+// Options include "px", "%", "in", "cm"
+if (typeof ol_heightunit == 'undefined') { var ol_heightunit = "px";}
+
+// Unit to be used for width of popup
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+// Options include "px", "%", "in", "cm"
+if (typeof ol_widthunit == 'undefined') { var ol_widthunit = "px";}
+
+// Font size unit for the main text
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_textsizeunit == 'undefined') { var ol_textsizeunit = "px";}
+
+// Decoration of the main text ("none", "underline", "line-through" or "blink")
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_textdecoration == 'undefined') { var ol_textdecoration = "none";}
+
+// Font style of the main text ("normal" or "italic")
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_textstyle == 'undefined') { var ol_textstyle = "normal";}
+
+// Font weight of the main text ("normal", "bold", "bolder", "lighter", ect.)
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_textweight == 'undefined') { var ol_textweight = "normal";}
+
+// Font size unit for the caption
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_captionsizeunit == 'undefined') { var ol_captionsizeunit = "px";}
+
+// Decoration of the caption ("none", "underline", "line-through" or "blink")
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_captiondecoration == 'undefined') { var ol_captiondecoration = "none";}
+
+// Font style of the caption ("normal" or "italic")
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_captionstyle == 'undefined') { var ol_captionstyle = "normal";}
+
+// Font weight of the caption ("normal", "bold", "bolder", "lighter", ect.)
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_captionweight == 'undefined') { var ol_captionweight = "bold";}
+
+// Font size unit for the close text
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_closesizeunit == 'undefined') { var ol_closesizeunit = "px";}
+
+// Decoration of the close text ("none", "underline", "line-through" or "blink")
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_closedecoration == 'undefined') { var ol_closedecoration = "none";}
+
+// Font style of the close text ("normal" or "italic")
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_closestyle == 'undefined') { var ol_closestyle = "normal";}
+
+// Font weight of the close text ("normal", "bold", "bolder", "lighter", ect.)
+// Only used if CSS inline styles are being used (ol_css = CSSSTYLE)
+if (typeof ol_closeweight == 'undefined') { var ol_closeweight = "normal";}
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// ARRAY CONFIGURATION
+// You don't have to change anything here if you don't want to. The following
+// arrays can be filled with text and html if you don't wish to pass it from
+// your html page.
+////////////////////////////////////////////////////////////////////////////////////
+
+// Array with texts.
+if (typeof ol_texts == 'undefined') { var ol_texts = new Array("Text 0", "Text 1"); }
+
+// Array with captions.
+if (typeof ol_caps == 'undefined') { var ol_caps = new Array("Caption 0", "Caption 1"); }
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// END CONFIGURATION
+// Don't change anything below this line, all configuration is above.
+////////////////////////////////////////////////////////////////////////////////////
+
+
+
+
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// INIT
+////////////////////////////////////////////////////////////////////////////////////
+
+// Runtime variables init. Used for runtime only, don't change, not for config!
+var o3_text = "";
+var o3_cap = "";
+var o3_sticky = 0;
+var o3_background = "";
+var o3_close = "Close";
+var o3_hpos = RIGHT;
+var o3_offsetx = 2;
+var o3_offsety = 2;
+var o3_fgcolor = "";
+var o3_bgcolor = "";
+var o3_textcolor = "";
+var o3_capcolor = "";
+var o3_closecolor = "";
+var o3_width = 100;
+var o3_border = 1;
+var o3_status = "";
+var o3_autostatus = 0;
+var o3_height = -1;
+var o3_snapx = 0;
+var o3_snapy = 0;
+var o3_fixx = -1;
+var o3_fixy = -1;
+var o3_fgbackground = "";
+var o3_bgbackground = "";
+var o3_padxl = 0;
+var o3_padxr = 0;
+var o3_padyt = 0;
+var o3_padyb = 0;
+var o3_fullhtml = 0;
+var o3_vpos = BELOW;
+var o3_aboveheight = 0;
+var o3_capicon = "";
+var o3_textfont = "Verdana,Arial,Helvetica";
+var o3_captionfont = "Verdana,Arial,Helvetica";
+var o3_closefont = "Verdana,Arial,Helvetica";
+var o3_textsize = "1";
+var o3_captionsize = "1";
+var o3_closesize = "1";
+var o3_frame = self;
+var o3_timeout = 0;
+var o3_timerid = 0;
+var o3_allowmove = 0;
+var o3_function = null; 
+var o3_delay = 0;
+var o3_delayid = 0;
+var o3_hauto = 0;
+var o3_vauto = 0;
+var o3_closeclick = 0;
+
+var o3_css = CSSOFF;
+var o3_fgclass = "";
+var o3_bgclass = "";
+var o3_textfontclass = "";
+var o3_captionfontclass = "";
+var o3_closefontclass = "";
+var o3_padunit = "px";
+var o3_heightunit = "px";
+var o3_widthunit = "px";
+var o3_textsizeunit = "px";
+var o3_textdecoration = "";
+var o3_textstyle = "";
+var o3_textweight = "";
+var o3_captionsizeunit = "px";
+var o3_captiondecoration = "";
+var o3_captionstyle = "";
+var o3_captionweight = "";
+var o3_closesizeunit = "px";
+var o3_closedecoration = "";
+var o3_closestyle = "";
+var o3_closeweight = "";
+
+
+
+// Display state variables
+var o3_x = 0;
+var o3_y = 0;
+var o3_allow = 0;
+var o3_showingsticky = 0;
+var o3_removecounter = 0;
+
+// Our layer
+var over = null;
+var fnRef;
+
+// Decide browser version
+var ns4 = (navigator.appName == 'Netscape' && parseInt(navigator.appVersion) == 4);
+var ns6 = (document.getElementById)? true:false;
+var ie4 = (document.all)? true:false;
+if (ie4) var docRoot = 'document.body';
+var ie5 = false;
+if (ns4) {
+	var oW = window.innerWidth;
+	var oH = window.innerHeight;
+	window.onresize = function () {if (oW!=window.innerWidth||oH!=window.innerHeight) location.reload();}
+}
+
+
+// Microsoft Stupidity Check(tm).
+if (ie4) {
+	if ((navigator.userAgent.indexOf('MSIE 5') > 0) || (navigator.userAgent.indexOf('MSIE 6') > 0)) {
+		if(document.compatMode && document.compatMode == 'CSS1Compat') docRoot = 'document.documentElement';
+		ie5 = true;
+	}
+	if (ns6) {
+		ns6 = false;
+	}
+}
+
+
+// Capture events, alt. diffuses the overlib function.
+if ( (ns4) || (ie4) || (ns6)) {
+	document.onmousemove = mouseMove
+	if (ns4) document.captureEvents(Event.MOUSEMOVE)
+} else {
+	overlib = no_overlib;
+	nd = no_overlib;
+	ver3fix = true;
+}
+
+
+// Fake function for 3.0 users.
+function no_overlib() {
+	return ver3fix;
+}
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// PUBLIC FUNCTIONS
+////////////////////////////////////////////////////////////////////////////////////
+
+
+// overlib(arg0, ..., argN)
+// Loads parameters into global runtime variables.
+function overlib() {
+	
+	// Load defaults to runtime.
+	o3_text = ol_text;
+	o3_cap = ol_cap;
+	o3_sticky = ol_sticky;
+	o3_background = ol_background;
+	o3_close = ol_close;
+	o3_hpos = ol_hpos;
+	o3_offsetx = ol_offsetx;
+	o3_offsety = ol_offsety;
+	o3_fgcolor = ol_fgcolor;
+	o3_bgcolor = ol_bgcolor;
+	o3_textcolor = ol_textcolor;
+	o3_capcolor = ol_capcolor;
+	o3_closecolor = ol_closecolor;
+	o3_width = ol_width;
+	o3_border = ol_border;
+	o3_status = ol_status;
+	o3_autostatus = ol_autostatus;
+	o3_height = ol_height;
+	o3_snapx = ol_snapx;
+	o3_snapy = ol_snapy;
+	o3_fixx = ol_fixx;
+	o3_fixy = ol_fixy;
+	o3_fgbackground = ol_fgbackground;
+	o3_bgbackground = ol_bgbackground;
+	o3_padxl = ol_padxl;
+	o3_padxr = ol_padxr;
+	o3_padyt = ol_padyt;
+	o3_padyb = ol_padyb;
+	o3_fullhtml = ol_fullhtml;
+	o3_vpos = ol_vpos;
+	o3_aboveheight = ol_aboveheight;
+	o3_capicon = ol_capicon;
+	o3_textfont = ol_textfont;
+	o3_captionfont = ol_captionfont;
+	o3_closefont = ol_closefont;
+	o3_textsize = ol_textsize;
+	o3_captionsize = ol_captionsize;
+	o3_closesize = ol_closesize;
+	o3_timeout = ol_timeout;
+	o3_function = ol_function;
+	o3_delay = ol_delay;
+	o3_hauto = ol_hauto;
+	o3_vauto = ol_vauto;
+	o3_closeclick = ol_closeclick;
+	
+	o3_css = ol_css;
+	o3_fgclass = ol_fgclass;
+	o3_bgclass = ol_bgclass;
+	o3_textfontclass = ol_textfontclass;
+	o3_captionfontclass = ol_captionfontclass;
+	o3_closefontclass = ol_closefontclass;
+	o3_padunit = ol_padunit;
+	o3_heightunit = ol_heightunit;
+	o3_widthunit = ol_widthunit;
+	o3_textsizeunit = ol_textsizeunit;
+	o3_textdecoration = ol_textdecoration;
+	o3_textstyle = ol_textstyle;
+	o3_textweight = ol_textweight;
+	o3_captionsizeunit = ol_captionsizeunit;
+	o3_captiondecoration = ol_captiondecoration;
+	o3_captionstyle = ol_captionstyle;
+	o3_captionweight = ol_captionweight;
+	o3_closesizeunit = ol_closesizeunit;
+	o3_closedecoration = ol_closedecoration;
+	o3_closestyle = ol_closestyle;
+	o3_closeweight = ol_closeweight;
+	fnRef = '';
+	
+
+	// Special for frame support, over must be reset...
+	if ( (ns4) || (ie4) || (ns6) ) {
+		if (over) cClick();
+		o3_frame = ol_frame;
+		if (ns4) over = o3_frame.document.overDiv
+		if (ie4) over = o3_frame.overDiv.style
+		if (ns6) over = o3_frame.document.getElementById("overDiv");
+	}
+	
+	
+	// What the next argument is expected to be.
+	var parsemode = -1, udf, v = null;
+	
+	var ar = arguments;
+	udf = (!ar.length ? 1 : 0);
+
+	for (i = 0; i < ar.length; i++) {
+
+		if (parsemode < 0) {
+			// Arg is maintext, unless its a PARAMETER
+			if (typeof ar[i] == 'number') {
+				udf = (ar[i] == FUNCTION ? 0 : 1);
+				i--;
+			} else {
+				o3_text = ar[i];
+			}
+
+			parsemode = 0;
+		} else {
+			// Note: NS4 doesn't like switch cases with vars.
+			if (ar[i] == INARRAY) { udf = 0; o3_text = ol_texts[ar[++i]]; continue; }
+			if (ar[i] == CAPARRAY) { o3_cap = ol_caps[ar[++i]]; continue; }
+			if (ar[i] == STICKY) { o3_sticky = 1; continue; }
+			if (ar[i] == BACKGROUND) { o3_background = ar[++i]; continue; }
+			if (ar[i] == NOCLOSE) { o3_close = ""; continue; }
+			if (ar[i] == CAPTION) { o3_cap = ar[++i]; continue; }
+			if (ar[i] == CENTER || ar[i] == LEFT || ar[i] == RIGHT) { o3_hpos = ar[i]; continue; }
+			if (ar[i] == OFFSETX) { o3_offsetx = ar[++i]; continue; }
+			if (ar[i] == OFFSETY) { o3_offsety = ar[++i]; continue; }
+			if (ar[i] == FGCOLOR) { o3_fgcolor = ar[++i]; continue; }
+			if (ar[i] == BGCOLOR) { o3_bgcolor = ar[++i]; continue; }
+			if (ar[i] == TEXTCOLOR) { o3_textcolor = ar[++i]; continue; }
+			if (ar[i] == CAPCOLOR) { o3_capcolor = ar[++i]; continue; }
+			if (ar[i] == CLOSECOLOR) { o3_closecolor = ar[++i]; continue; }
+			if (ar[i] == WIDTH) { o3_width = ar[++i]; continue; }
+			if (ar[i] == BORDER) { o3_border = ar[++i]; continue; }
+			if (ar[i] == STATUS) { o3_status = ar[++i]; continue; }
+			if (ar[i] == AUTOSTATUS) { o3_autostatus = (o3_autostatus == 1) ? 0 : 1; continue; }
+			if (ar[i] == AUTOSTATUSCAP) { o3_autostatus = (o3_autostatus == 2) ? 0 : 2; continue; }
+			if (ar[i] == HEIGHT) { o3_height = ar[++i]; o3_aboveheight = ar[i]; continue; } // Same param again.
+			if (ar[i] == CLOSETEXT) { o3_close = ar[++i]; continue; }
+			if (ar[i] == SNAPX) { o3_snapx = ar[++i]; continue; }
+			if (ar[i] == SNAPY) { o3_snapy = ar[++i]; continue; }
+			if (ar[i] == FIXX) { o3_fixx = ar[++i]; continue; }
+			if (ar[i] == FIXY) { o3_fixy = ar[++i]; continue; }
+			if (ar[i] == FGBACKGROUND) { o3_fgbackground = ar[++i]; continue; }
+			if (ar[i] == BGBACKGROUND) { o3_bgbackground = ar[++i]; continue; }
+			if (ar[i] == PADX) { o3_padxl = ar[++i]; o3_padxr = ar[++i]; continue; }
+			if (ar[i] == PADY) { o3_padyt = ar[++i]; o3_padyb = ar[++i]; continue; }
+			if (ar[i] == FULLHTML) { o3_fullhtml = 1; continue; }
+			if (ar[i] == BELOW || ar[i] == ABOVE) { o3_vpos = ar[i]; continue; }
+			if (ar[i] == CAPICON) { o3_capicon = ar[++i]; continue; }
+			if (ar[i] == TEXTFONT) { o3_textfont = ar[++i]; continue; }
+			if (ar[i] == CAPTIONFONT) { o3_captionfont = ar[++i]; continue; }
+			if (ar[i] == CLOSEFONT) { o3_closefont = ar[++i]; continue; }
+			if (ar[i] == TEXTSIZE) { o3_textsize = ar[++i]; continue; }
+			if (ar[i] == CAPTIONSIZE) { o3_captionsize = ar[++i]; continue; }
+			if (ar[i] == CLOSESIZE) { o3_closesize = ar[++i]; continue; }
+			if (ar[i] == FRAME) { opt_FRAME(ar[++i]); continue; }
+			if (ar[i] == TIMEOUT) { o3_timeout = ar[++i]; continue; }
+			if (ar[i] == FUNCTION) { udf = 0; if (typeof ar[i+1] != 'number') v = ar[++i]; opt_FUNCTION(v); continue; } 
+			if (ar[i] == DELAY) { o3_delay = ar[++i]; continue; }
+			if (ar[i] == HAUTO) { o3_hauto = (o3_hauto == 0) ? 1 : 0; continue; }
+			if (ar[i] == VAUTO) { o3_vauto = (o3_vauto == 0) ? 1 : 0; continue; }
+			if (ar[i] == CLOSECLICK) { o3_closeclick = (o3_closeclick == 0) ? 1 : 0; continue; }
+			if (ar[i] == CSSOFF) { o3_css = ar[i]; continue; }
+			if (ar[i] == CSSSTYLE) { o3_css = ar[i]; continue; }
+			if (ar[i] == CSSCLASS) { o3_css = ar[i]; continue; }
+			if (ar[i] == FGCLASS) { o3_fgclass = ar[++i]; continue; }
+			if (ar[i] == BGCLASS) { o3_bgclass = ar[++i]; continue; }
+			if (ar[i] == TEXTFONTCLASS) { o3_textfontclass = ar[++i]; continue; }
+			if (ar[i] == CAPTIONFONTCLASS) { o3_captionfontclass = ar[++i]; continue; }
+			if (ar[i] == CLOSEFONTCLASS) { o3_closefontclass = ar[++i]; continue; }
+			if (ar[i] == PADUNIT) { o3_padunit = ar[++i]; continue; }
+			if (ar[i] == HEIGHTUNIT) { o3_heightunit = ar[++i]; continue; }
+			if (ar[i] == WIDTHUNIT) { o3_widthunit = ar[++i]; continue; }
+			if (ar[i] == TEXTSIZEUNIT) { o3_textsizeunit = ar[++i]; continue; }
+			if (ar[i] == TEXTDECORATION) { o3_textdecoration = ar[++i]; continue; }
+			if (ar[i] == TEXTSTYLE) { o3_textstyle = ar[++i]; continue; }
+			if (ar[i] == TEXTWEIGHT) { o3_textweight = ar[++i]; continue; }
+			if (ar[i] == CAPTIONSIZEUNIT) { o3_captionsizeunit = ar[++i]; continue; }
+			if (ar[i] == CAPTIONDECORATION) { o3_captiondecoration = ar[++i]; continue; }
+			if (ar[i] == CAPTIONSTYLE) { o3_captionstyle = ar[++i]; continue; }
+			if (ar[i] == CAPTIONWEIGHT) { o3_captionweight = ar[++i]; continue; }
+			if (ar[i] == CLOSESIZEUNIT) { o3_closesizeunit = ar[++i]; continue; }
+			if (ar[i] == CLOSEDECORATION) { o3_closedecoration = ar[++i]; continue; }
+			if (ar[i] == CLOSESTYLE) { o3_closestyle = ar[++i]; continue; }
+			if (ar[i] == CLOSEWEIGHT) { o3_closeweight = ar[++i]; continue; }
+		}
+	}
+	if (udf && o3_function) o3_text = o3_function();
+
+	if (o3_delay == 0) {
+		return overlib351();
+	} else {
+		o3_delayid = setTimeout("overlib351()", o3_delay);
+		return false;
+	}
+}
+
+
+
+// Clears popups if appropriate
+function nd() {
+	if ( o3_removecounter >= 1 ) { o3_showingsticky = 0 };
+	if ( (ns4) || (ie4) || (ns6) ) {
+		if ( o3_showingsticky == 0 ) {
+			o3_allowmove = 0;
+			if (over != null) hideObject(over);
+		} else {
+			o3_removecounter++;
+		}
+	}
+	
+	return true;
+}
+
+
+
+
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// OVERLIB 3.51 FUNCTION
+////////////////////////////////////////////////////////////////////////////////////
+
+
+// This function decides what it is we want to display and how we want it done.
+function overlib351() {
+
+	// Make layer content
+	var layerhtml;
+
+	if (o3_background != "" || o3_fullhtml) {
+		// Use background instead of box.
+		layerhtml = ol_content_background(o3_text, o3_background, o3_fullhtml);
+	} else {
+		// They want a popup box.
+
+		// Prepare popup background
+		if (o3_fgbackground != "" && o3_css == CSSOFF) {
+			o3_fgbackground = "BACKGROUND=\""+o3_fgbackground+"\"";
+		}
+		if (o3_bgbackground != "" && o3_css == CSSOFF) {
+			o3_bgbackground = "BACKGROUND=\""+o3_bgbackground+"\"";
+		}
+
+		// Prepare popup colors
+		if (o3_fgcolor != "" && o3_css == CSSOFF) {
+			o3_fgcolor = "BGCOLOR=\""+o3_fgcolor+"\"";
+		}
+		if (o3_bgcolor != "" && o3_css == CSSOFF) {
+			o3_bgcolor = "BGCOLOR=\""+o3_bgcolor+"\"";
+		}
+
+		// Prepare popup height
+		if (o3_height > 0 && o3_css == CSSOFF) {
+			o3_height = "HEIGHT=" + o3_height;
+		} else {
+			o3_height = "";
+		}
+
+		// Decide which kinda box.
+		if (o3_cap == "") {
+			// Plain
+			layerhtml = ol_content_simple(o3_text);
+		} else {
+			// With caption
+			if (o3_sticky) {
+				// Show close text
+				layerhtml = ol_content_caption(o3_text, o3_cap, o3_close);
+			} else {
+				// No close text
+				layerhtml = ol_content_caption(o3_text, o3_cap, "");
+			}
+		}
+	}
+	
+	// We want it to stick!
+	if (o3_sticky) {
+		if (o3_timerid > 0) {
+			clearTimeout(o3_timerid);
+			o3_timerid = 0;
+		}
+		o3_showingsticky = 1;
+		o3_removecounter = 0;
+	}
+	
+	// Write layer
+	layerWrite(layerhtml);
+	
+	// Prepare status bar
+	if (o3_autostatus > 0) {
+		o3_status = o3_text;
+		if (o3_autostatus > 1) {
+			o3_status = o3_cap;
+		}
+	}
+
+	// When placing the layer the first time, even stickies may be moved.
+	o3_allowmove = 0;
+
+	// Initiate a timer for timeout
+	if (o3_timeout > 0) {
+		if (o3_timerid > 0) clearTimeout(o3_timerid);
+		o3_timerid = setTimeout("cClick()", o3_timeout);
+	}
+
+	// Show layer
+	disp(o3_status);
+
+	// Stickies should stay where they are.	
+	if (o3_sticky) o3_allowmove = 0;
+
+	return (o3_status != '');
+}
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// LAYER GENERATION FUNCTIONS
+////////////////////////////////////////////////////////////////////////////////////
+
+// Makes simple table without caption
+function ol_content_simple(text) {
+	if (o3_css == CSSCLASS) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING="+o3_border+" CELLSPACING=0 class=\""+o3_bgclass+"\"><TR><TD><TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=0 class=\""+o3_fgclass+"\"><TR><TD VALIGN=TOP><FONT class=\""+o3_textfontclass+"\">"+text+"</FONT></TD></TR></TABLE></TD></TR></TABLE>";
+	if (o3_css == CSSSTYLE) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING="+o3_border+" CELLSPACING=0 style=\"background-color: "+o3_bgcolor+"; height: "+o3_height+o3_heightunit+";\"><TR><TD><TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=0 style=\"color: "+o3_fgcolor+"; background-color: "+o3_fgcolor+"; height: "+o3_height+o3_heightunit+";\"><TR><TD VALIGN=TOP><FONT style=\"font-family: "+o3_textfont+"; color: "+o3_textcolor+"; font-size: "+o3_textsize+o3_textsizeunit+"; text-decoration: "+o3_textdecoration+"; font-weight: "+o3_textweight+"; font-style:"+o3_textstyle+"\">"+text+"</FONT></TD></TR></TABLE></TD></TR></TABLE>";
+	if (o3_css == CSSOFF) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING="+o3_border+" CELLSPACING=0 "+o3_bgcolor+" "+o3_height+"><TR><TD><TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=0 "+o3_fgcolor+" "+o3_fgbackground+" "+o3_height+"><TR><TD VALIGN=TOP><FONT FACE=\""+o3_textfont+"\" COLOR=\""+o3_textcolor+"\" SIZE=\""+o3_textsize+"\">"+text+"</FONT></TD></TR></TABLE></TD></TR></TABLE>";
+
+	set_background("");
+	return txt;
+}
+
+
+
+
+// Makes table with caption and optional close link
+function ol_content_caption(text, title, close) {
+	closing = "";
+	closeevent = "onMouseOver";
+
+	if (o3_closeclick == 1) closeevent = "onClick";
+	if (o3_capicon != "") o3_capicon = "<IMG SRC=\""+o3_capicon+"\"> ";
+
+	if (close != "") {
+		if (o3_css == CSSCLASS) closing = "<TD ALIGN=RIGHT><A HREF=\"javascript:return "+fnRef+"cClick();\" "+closeevent+"=\"return " + fnRef + "cClick();\" class=\""+o3_closefontclass+"\">"+close+"</A></TD>";
+		if (o3_css == CSSSTYLE) closing = "<TD ALIGN=RIGHT><A HREF=\"javascript:return "+fnRef+"cClick();\" "+closeevent+"=\"return " + fnRef + "cClick();\" style=\"color: "+o3_closecolor+"; font-family: "+o3_closefont+"; font-size: "+o3_closesize+o3_closesizeunit+"; text-decoration: "+o3_closedecoration+"; font-weight: "+o3_closeweight+"; font-style:"+o3_closestyle+";\">"+close+"</A></TD>";
+		if (o3_css == CSSOFF) closing = "<TD ALIGN=RIGHT><A HREF=\"javascript:return "+fnRef+"cClick();\" "+closeevent+"=\"return " + fnRef + "cClick();\"><FONT COLOR=\""+o3_closecolor+"\" FACE=\""+o3_closefont+"\" SIZE=\""+o3_closesize+"\">"+close+"</FONT></A></TD>";
+	}
+
+	if (o3_css == CSSCLASS) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING="+o3_border+" CELLSPACING=0 class=\""+o3_bgclass+"\"><TR><TD><TABLE WIDTH=100% BORDER=0 CELLPADDING=0 CELLSPACING=0><TR><TD><FONT class=\""+o3_captionfontclass+"\">"+o3_capicon+title+"</FONT></TD>"+closing+"</TR></TABLE><TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=0 class=\""+o3_fgclass+"\"><TR><TD VALIGN=TOP><FONT class=\""+o3_textfontclass+"\">"+text+"</FONT></TD></TR></TABLE></TD></TR></TABLE>";
+	if (o3_css == CSSSTYLE) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING="+o3_border+" CELLSPACING=0 style=\"background-color: "+o3_bgcolor+"; background-image: url("+o3_bgbackground+"); height: "+o3_height+o3_heightunit+";\"><TR><TD><TABLE WIDTH=100% BORDER=0 CELLPADDING=0 CELLSPACING=0><TR><TD><FONT style=\"font-family: "+o3_captionfont+"; color: "+o3_capcolor+"; font-size: "+o3_captionsize+o3_captionsizeunit+"; font-weight: "+o3_captionweight+"; font-style: "+o3_captionstyle+"; text-decoration: " + o3_captiondecoration + ";\">"+o3_capicon+title+"</FONT></TD>"+closing+"</TR></TABLE><TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=0 style=\"color: "+o3_fgcolor+"; background-color: "+o3_fgcolor+"; height: "+o3_height+o3_heightunit+";\"><TR><TD VALIGN=TOP><FONT style=\"font-family: "+o3_textfont+"; color: "+o3_textcolor+"; font-size: "+o3_textsize+o3_textsizeunit+"; text-decoration: "+o3_textdecoration+"; font-weight: "+o3_textweight+"; font-style:"+o3_textstyle+"\">"+text+"</FONT></TD></TR></TABLE></TD></TR></TABLE>";
+	if (o3_css == CSSOFF) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING="+o3_border+" CELLSPACING=0 "+o3_bgcolor+" "+o3_bgbackground+" "+o3_height+"><TR><TD><TABLE WIDTH=100% BORDER=0 CELLPADDING=0 CELLSPACING=0><TR><TD><B><FONT COLOR=\""+o3_capcolor+"\" FACE=\""+o3_captionfont+"\" SIZE=\""+o3_captionsize+"\">"+o3_capicon+title+"</FONT></B></TD>"+closing+"</TR></TABLE><TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=0 "+o3_fgcolor+" "+o3_fgbackground+" "+o3_height+"><TR><TD VALIGN=TOP><FONT COLOR=\""+o3_textcolor+"\" FACE=\""+o3_textfont+"\" SIZE=\""+o3_textsize+"\">"+text+"</FONT></TD></TR></TABLE></TD></TR></TABLE>";
+
+	set_background("");
+	return txt;
+}
+
+// Sets the background picture, padding and lots more. :)
+function ol_content_background(text, picture, hasfullhtml) {
+	var txt;
+	if (hasfullhtml) {
+		txt = text;
+	} else {
+		var pU, hU, wU;
+		pU = (o3_padunit == '%' ? '%' : '');
+		hU = (o3_heightunit == '%' ? '%' : '');
+		wU = (o3_widthunit == '%' ? '%' : '');
+
+		if (o3_css == CSSCLASS) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING=0 CELLSPACING=0 HEIGHT="+o3_height+"><TR><TD COLSPAN=3 HEIGHT="+o3_padyt+"></TD></TR><TR><TD WIDTH="+o3_padxl+"></TD><TD VALIGN=TOP WIDTH="+(o3_width-o3_padxl-o3_padxr)+"><FONT class=\""+o3_textfontclass+"\">"+text+"</FONT></TD><TD WIDTH="+o3_padxr+"></TD></TR><TR><TD COLSPAN=3 HEIGHT="+o3_padyb+"></TD></TR></TABLE>";
+		if (o3_css == CSSSTYLE) txt = "<TABLE WIDTH="+o3_width+wU+" BORDER=0 CELLPADDING=0 CELLSPACING=0 HEIGHT="+o3_height+hU+"><TR><TD COLSPAN=3 HEIGHT="+o3_padyt+pU+"></TD></TR><TR><TD WIDTH="+o3_padxl+pU+"></TD><TD VALIGN=TOP WIDTH="+(o3_width-o3_padxl-o3_padxr)+pU+"><FONT style=\"font-family: "+o3_textfont+"; color: "+o3_textcolor+"; font-size: "+o3_textsize+o3_textsizeunit+";\">"+text+"</FONT></TD><TD WIDTH="+o3_padxr+pU+"></TD></TR><TR><TD COLSPAN=3 HEIGHT="+o3_padyb+pU+"></TD></TR></TABLE>";
+		if (o3_css == CSSOFF) txt = "<TABLE WIDTH="+o3_width+" BORDER=0 CELLPADDING=0 CELLSPACING=0 HEIGHT="+o3_height+"><TR><TD COLSPAN=3 HEIGHT="+o3_padyt+"></TD></TR><TR><TD WIDTH="+o3_padxl+"></TD><TD VALIGN=TOP WIDTH="+(o3_width-o3_padxl-o3_padxr)+"><FONT FACE=\""+o3_textfont+"\" COLOR=\""+o3_textcolor+"\" SIZE=\""+o3_textsize+"\">"+text+"</FONT></TD><TD WIDTH="+o3_padxr+"></TD></TR><TR><TD COLSPAN=3 HEIGHT="+o3_padyb+"></TD></TR></TABLE>";
+	}
+	set_background(picture);
+	return txt;
+}
+
+// Loads a picture into the div.
+function set_background(pic) {
+	if (pic == "") {
+		if (ns4) over.background.src = null;
+		if (ie4) over.backgroundImage = "none";
+		if (ns6) over.style.backgroundImage = "none";
+	} else {
+		if (ns4) {
+			over.background.src = pic;
+		} else if (ie4) {
+			over.backgroundImage = "url("+pic+")";
+		} else if (ns6) {
+			over.style.backgroundImage = "url("+pic+")";
+		}
+	}
+}
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// HANDLING FUNCTIONS
+////////////////////////////////////////////////////////////////////////////////////
+
+
+// Displays the popup
+function disp(statustext) {
+	if ( (ns4) || (ie4) || (ns6) ) {
+		if (o3_allowmove == 0) 	{
+			placeLayer();
+			showObject(over);
+			o3_allowmove = 1;
+		}
+	}
+
+	if (statustext != "") {
+		self.status = statustext;
+	}
+}
+
+// Decides where we want the popup.
+function placeLayer() {
+	var placeX, placeY;
+	
+	// HORIZONTAL PLACEMENT
+	if (o3_fixx > -1) {
+		// Fixed position
+		placeX = o3_fixx;
+	} else {
+		winoffset = (ie4) ? eval('o3_frame.'+docRoot+'.scrollLeft') : o3_frame.pageXOffset;
+		if (ie4) iwidth = eval('o3_frame.'+docRoot+'.clientWidth');
+		if (ns4 || ns6) iwidth = o3_frame.innerWidth;
+		
+		// If HAUTO, decide what to use.
+		if (o3_hauto == 1) {
+			if ( (o3_x - winoffset) > ((eval(iwidth)) / 2)) {
+				o3_hpos = LEFT;
+			} else {
+				o3_hpos = RIGHT;
+			}
+		}
+		
+		// From mouse
+		if (o3_hpos == CENTER) { // Center
+			placeX = o3_x+o3_offsetx-(o3_width/2);
+			if (placeX < winoffset) placeX = winoffset;
+		}
+		if (o3_hpos == RIGHT) { // Right
+			placeX = o3_x+o3_offsetx;
+			if ( (eval(placeX) + eval(o3_width)) > (winoffset + iwidth) ) {
+				placeX = iwidth + winoffset - o3_width;
+				if (placeX < 0) placeX = 0;
+			}
+		}
+		if (o3_hpos == LEFT) { // Left
+			placeX = o3_x-o3_offsetx-o3_width;
+			if (placeX < winoffset) placeX = winoffset;
+		}
+	
+		// Snapping!
+		if (o3_snapx > 1) {
+			var snapping = placeX % o3_snapx;
+			if (o3_hpos == LEFT) {
+				placeX = placeX - (o3_snapx + snapping);
+			} else {
+				// CENTER and RIGHT
+				placeX = placeX + (o3_snapx - snapping);
+			}
+			if (placeX < winoffset) placeX = winoffset;
+		}
+	}
+
+	
+	
+	// VERTICAL PLACEMENT
+	if (o3_fixy > -1) {
+		// Fixed position
+		placeY = o3_fixy;
+	} else {
+		scrolloffset = (ie4) ? eval('o3_frame.'+docRoot+'.scrollTop') : o3_frame.pageYOffset;
+
+		// If VAUTO, decide what to use.
+		if (o3_vauto == 1) {
+			if (ie4) iheight = eval('o3_frame.'+docRoot+'.clientHeight');
+			if (ns4 || ns6) iheight = o3_frame.innerHeight;
+
+			iheight = (eval(iheight)) / 2;
+			if ( (o3_y - scrolloffset) > iheight) {
+				o3_vpos = ABOVE;
+			} else {
+				o3_vpos = BELOW;
+			}
+		}
+
+
+		// From mouse
+		if (o3_vpos == ABOVE) {
+			if (o3_aboveheight == 0) {
+				var divref = (ie4) ? o3_frame.document.all['overDiv'] : over;
+				o3_aboveheight = (ns4) ? divref.clip.height : divref.offsetHeight;
+			}
+
+			placeY = o3_y - (o3_aboveheight + o3_offsety);
+			if (placeY < scrolloffset) placeY = scrolloffset;
+		} else {
+			// BELOW
+			placeY = o3_y + o3_offsety;
+		}
+
+		// Snapping!
+		if (o3_snapy > 1) {
+			var snapping = placeY % o3_snapy;
+			
+			if (o3_aboveheight > 0 && o3_vpos == ABOVE) {
+				placeY = placeY - (o3_snapy + snapping);
+			} else {
+				placeY = placeY + (o3_snapy - snapping);
+			}
+			
+			if (placeY < scrolloffset) placeY = scrolloffset;
+		}
+	}
+
+
+	// Actually move the object.	
+	repositionTo(over, placeX, placeY);
+}
+
+
+// Moves the layer
+function mouseMove(e) {
+	if ( (ns4) || (ns6) ) {o3_x=e.pageX; o3_y=e.pageY;}
+	if (ie4) {o3_x=event.x; o3_y=event.y;}
+	if (ie5) {o3_x=eval('event.x+o3_frame.'+docRoot+'.scrollLeft'); o3_y=eval('event.y+o3_frame.'+docRoot+'.scrollTop');}
+	
+	if (o3_allowmove == 1) {
+		placeLayer();
+	}
+}
+
+// The Close onMouseOver function for stickies
+function cClick() {
+	hideObject(over);
+	o3_showingsticky = 0;
+	
+	return false;
+}
+
+
+// Makes sure target frame has overLIB
+function compatibleframe(frameid) {
+	if (ns4) {
+		if (typeof frameid.document.overDiv =='undefined') return false;
+	} else if (ie4) {
+		if (typeof frameid.document.all["overDiv"] =='undefined') return false;
+	} else if (ns6) {
+		if (frameid.document.getElementById('overDiv') == null) return false;
+	}
+
+	return true;
+}
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// LAYER FUNCTIONS
+////////////////////////////////////////////////////////////////////////////////////
+
+
+// Writes to a layer
+function layerWrite(txt) {
+	txt += "\n";
+	
+	if (ns4) {
+		var lyr = o3_frame.document.overDiv.document
+		lyr.write(txt)
+		lyr.close()
+	} else if (ie4) {
+		o3_frame.document.all["overDiv"].innerHTML = txt
+	} else if (ns6) {
+		range = o3_frame.document.createRange();
+		range.setStartBefore(over);
+		domfrag = range.createContextualFragment(txt);
+		while (over.hasChildNodes()) {
+			over.removeChild(over.lastChild);
+		}
+		over.appendChild(domfrag);
+	}
+}
+
+// Make an object visible
+function showObject(obj) {
+	if (ns4) obj.visibility = "show";
+	else if (ie4) obj.visibility = "visible";
+	else if (ns6) obj.style.visibility = "visible";
+}
+
+// Hides an object
+function hideObject(obj) {
+	if (ns4) obj.visibility = "hide";
+	else if (ie4) obj.visibility = "hidden";
+	else if (ns6) obj.style.visibility = "hidden";
+
+	if (o3_timerid > 0) clearTimeout(o3_timerid);
+	if (o3_delayid > 0) clearTimeout(o3_delayid);
+	o3_timerid = 0;
+	o3_delayid = 0;
+	self.status = "";
+}
+
+// Move a layer
+function repositionTo(obj,xL,yL) {
+	if ( (ns4) || (ie4) ) {
+		obj.left = (ie4 ? xL + 'px' : xL);
+		obj.top = (ie4 ? yL + 'px' : yL);
+	} else if (ns6) {
+		obj.style.left = xL + "px";
+		obj.style.top = yL+ "px";
+	}
+}
+
+function getFrameRef(thisFrame, ofrm) {
+	var retVal = '';
+	for (var i=0; i<thisFrame.length; i++) {
+		if (thisFrame[i].length > 0) { 
+			retVal = getFrameRef(thisFrame[i],ofrm);
+			if (retVal == '') continue;
+		} else if (thisFrame[i] != ofrm) continue;
+		
+		retVal = '['+i+']' + retVal;
+		break;
+	}
+	
+	return retVal;
+}
+
+
+
+
+////////////////////////////////////////////////////////////////////////////////////
+// PARSER FUNCTIONS
+////////////////////////////////////////////////////////////////////////////////////
+
+
+// Defines which frame we should point to.
+function opt_FRAME(frm) {
+	o3_frame = compatibleframe(frm) ? frm : ol_frame;
+
+	if (o3_frame != ol_frame) {
+		var tFrm = getFrameRef(top.frames, o3_frame);
+		var sFrm = getFrameRef(top.frames, ol_frame);
+
+		if (sFrm.length == tFrm.length) { 
+			l = tFrm.lastIndexOf('['); 
+			if (l) {
+				while(sFrm.substring(0,l) != tFrm.substring(0,l)) l = tFrm.lastIndexOf('[',l-1);
+				tFrm = tFrm.substr(l);
+				sFrm = sFrm.substr(l);
+			}
+		}
+			
+		var cnt = 0, p = '', str = tFrm;
+			
+		while((k = str.lastIndexOf('[')) != -1) {
+			cnt++;
+			str = str.substring(0,k);
+		}
+
+		for (var i=0; i<cnt; i++) p = p + 'parent.';
+		fnRef = p + 'frames' + sFrm + '.';
+	}
+
+	if ( (ns4) || (ie4 || (ns6)) ) {
+		if (ns4) over = o3_frame.document.overDiv;
+		if (ie4) over = o3_frame.overDiv.style;
+		if (ns6) over = o3_frame.document.getElementById("overDiv");
+	}
+
+	return 0;
+}
+
+// Calls an external function
+function opt_FUNCTION(callme) {
+	o3_text = (callme ? callme() : (o3_function ? o3_function() : 'No Function'));
+	return 0;
+}
+
+
+
+
+//end (For internal purposes.)
+////////////////////////////////////////////////////////////////////////////////////
+// OVERLIB 2 COMPATABILITY FUNCTIONS
+// If you aren't upgrading you can remove the below section.
+////////////////////////////////////////////////////////////////////////////////////
+
+// Converts old 0=left, 1=right and 2=center into constants.
+function vpos_convert(d) {
+	if (d == 0) {
+		d = LEFT;
+	} else {
+		if (d == 1) {
+			d = RIGHT;
+		} else {
+			d = CENTER;
+		}
+	}
+	
+	return d;
+}
+
+// Simple popup
+function dts(d,text) {
+	o3_hpos = vpos_convert(d);
+	overlib(text, o3_hpos, CAPTION, "");
+}
+
+// Caption popup
+function dtc(d,text, title) {
+	o3_hpos = vpos_convert(d);
+	overlib(text, CAPTION, title, o3_hpos);
+}
+
+// Sticky
+function stc(d,text, title) {
+	o3_hpos = vpos_convert(d);
+	overlib(text, CAPTION, title, o3_hpos, STICKY);
+}
+
+// Simple popup right
+function drs(text) {
+	dts(1,text);
+}
+
+// Caption popup right
+function drc(text, title) {
+	dtc(1,text,title);
+}
+
+// Sticky caption right
+function src(text,title) {
+	stc(1,text,title);
+}
+
+// Simple popup left
+function dls(text) {
+	dts(0,text);
+}
+
+// Caption popup left
+function dlc(text, title) {
+	dtc(0,text,title);
+}
+
+// Sticky caption left
+function slc(text,title) {
+	stc(0,text,title);
+}
+
+// Simple popup center
+function dcs(text) {
+	dts(2,text);
+}
+
+// Caption popup center
+function dcc(text, title) {
+	dtc(2,text,title);
+}
+
+// Sticky caption center
+function scc(text,title) {
+	stc(2,text,title);
+}
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/mailer.php php-syslog-ng/html/includes/mailer.php
--- php-syslog-ng-2.9.f/html/includes/mailer.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/mailer.php	2008-02-03 22:38:56.000000000 -0500
@@ -0,0 +1,69 @@
+<?php 
+/**
+ * Mailer.php
+ *
+ * The Mailer class is meant to simplify the task of sending
+ * emails to users. Note: this email system will not work
+ * if your server is not setup to send mail.
+ *
+ * If you are running Windows and want a mail server, check
+ * out this website to see a list of freeware programs:
+ * <http://www.snapfiles.com/freeware/server/fwmailserver.html>
+ *
+ * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)
+ * Last Updated: August 19, 2004
+ */
+ 
+class Mailer
+{
+   /**
+    * sendWelcome - Sends a welcome message to the newly
+    * registered user, also supplying the username and
+    * password.
+    */
+   function sendWelcome($user, $email, $pass){
+      $from = "From: ".EMAIL_FROM_NAME." <".EMAIL_FROM_ADDR.">";
+      $subject = SITENAME . " - Welcome!";
+      $body = $user.",\n\n"
+             ."Welcome! You've just registered at " . SITENAME
+             ."with the following information:\n\n"
+             ."Username: ".$user."\n"
+             ."Password: ".$pass."\n\n"
+             ."If you ever lose or forget your password, a new "
+             ."password will be generated for you and sent to this "
+             ."email address, if you would like to change your "
+             ."email address you can do so by going to the "
+             ."My Account page after signing in.\n\n"
+             ."- " . SITENAME;
+
+      return mail($email,$subject,$body,$from);
+   }
+   
+   /**
+    * sendNewPass - Sends the newly generated password
+    * to the user's email address that was specified at
+    * sign-up.
+    */
+   function sendNewPass($user, $email, $pass){
+      $from = "From: ".EMAIL_FROM_NAME." <".EMAIL_FROM_ADDR.">";
+      $subject = SITENAME . " - Your new password";
+      $body = $user.",\n\n"
+             ."We've generated a new password for you at your "
+             ."request, you can use this new password with your "
+             ."username to log in to " . SITENAME . "\n\n"
+             ."Username: ".$user."\n"
+             ."New Password: ".$pass."\n\n"
+             ."It is recommended that you change your password "
+             ."to something that is easier to remember, which "
+             ."can be done by going to the My Account page "
+             ."after signing in.\n\n"
+             ."- " . SITENAME;
+             
+      return mail($email,$subject,$body,$from);
+   }
+};
+
+/* Initialize mailer object */
+$mailer = new Mailer;
+ 
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/pageload.php php-syslog-ng/html/includes/pageload.php
--- php-syslog-ng-2.9.f/html/includes/pageload.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/pageload.php	2008-03-20 19:23:28.000000000 -0400
@@ -0,0 +1,130 @@
+<?php
+include_once '../config/config.php';
+include_once ("common_funcs.php");
+
+?>
+<html> 
+<head> 
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2"> 
+<link rel=stylesheet href=meta2.css type=text/css> 
+<title>Searching for messages from <?php echo $host?> - please be patient</title> 
+<style> 
+.brd{border-width: 0px 0px 0px 0px;border-style: none;} 
+</style> 
+<script>
+
+
+var colors=new Array("","#274957","#2c4d5b","#305260","#355764","#3a5b69","#3E606E","#436472","#486977","#4C6E7B","#517380","#567785","#5A7C89","#5F818E","#648593","#688A97","#6D8E9C","#7293A0","#7798A5","#7B9CA9","#BCEEF4");
+
+nsaz=50; 
+iqq=1; 
+var borne=1; 
+var ns=document.layers?1:0; 
+var bx=document; 
+var nbx=document;
+
+function zx(){ 
+	if(ns) { 
+		qx="<center><font color=white face=verdana size=1>"+(iqq*2)+"%</font></center><table border=1 width="+(iqq*4)+" bgcolor=#6C8D9B><tr><td></td></tr></table><br><br>g"; 
+		bx.write(""+qx); 
+		bx.close(); 
+	} 
+	else { 
+		temp=eval("document.all.t"+iqq); 
+		temp.style.background=colors[iqq]; 
+		//bx.innerHTML="<table border=0 width="+(iqq*4)+" bgcolor=#6C8D9B height=8><tr><td>"+(document.all?'':' ')+"</td></tr></table>" 
+		nbx.innerHTML="<center><font face=verdana color=white size=1 >"+(iqq*5)+"% </font></center>" 
+	} 
+	iqq++; 
+	if(iqq<21) { 
+		setTimeout("zx()",nsaz); 
+	} 
+	if(iqq>Math.round(borne/2.5)){ 
+		if(nsaz<1000) nsaz+=30; 
+		else nsaz+=500; 
+	} 
+	else{ 
+		if(nsaz>250) nsaz=-150; 
+	}
+
+	if(iqq==20){ 
+		if(!ns) { 
+			//nbx.innerHTML=""; 
+			//bx.innerHTML="<center><font color=white size=1 >loaded 100%</font></center>"; 
+		} 
+		parent.changeIt(); 
+	} 
+}
+
+	function make(){ 
+		if(ns) 
+			bx=eval("document.xz_.document.xz__.document"); 
+		else bx=eval("document.getElementById('xz')"); 
+		if(ns) 
+			nbx=eval("document.nxz_.document.nxz__.document"); 
+		else nbx=eval("document.getElementById('nxz')"); 
+		zx(); 
+	} 
+</script> 
+<style> 
+#xz{} 
+</style> 
+</head>
+
+<body bgcolor="#224452" background="up.gif" scroll="no" onload="make();">
+
+<table border="0" width=100% height=100%> 
+<tr> 
+<td valign=middle align=center> 
+<font color=white face=verdana size=1>Searching for <?php echo $host?></font>
+<table width="200" border="0" cellpadding="2"> 
+<tr> 
+<td align=left style="border-width: 1px 1px 1px 1px;border-style:solid;border-color:#80a1ae" class=brd>
+
+<font size=2 face=verdana> 
+<table summary="" border="0" width=100% height=12> 
+<tr> 
+<td id=t1></td> 
+<td id=t2></td> 
+<td id=t3></td> 
+<td id=t4></td> 
+<td id=t5></td> 
+<td id=t6></td> 
+<td id=t7></td> 
+<td id=t8></td> 
+<td id=t9></td> 
+<td id=t10></td> 
+<td id=t11></td> 
+<td id=t12></td> 
+<td id=t13></td> 
+<td id=t14></td> 
+<td id=t15></td> 
+<td id=t16></td> 
+<td id=t17></td> 
+<td id=t18></td> 
+<td id=t19></td> 
+<td id=t20></td> 
+</tr> 
+</table>
+
+<script> 
+if(document.layers) document.write("<ILAYER id=xz_ width=200 height=25><LAYER id=xz__ width=200 height=25> </layer></ilayer>"); 
+else document.write('<div id=xz></div>'); 
+</script> 
+</font> 
+</td> 
+</tr> 
+<tr><td> 
+<script> 
+if(document.layers) document.write("<ILAYER id=nxz_ width=200 height=25><LAYER id=nxz__ width=200 height=25> </layer></ilayer>"); 
+else document.write('<div id=nxz></div>'); 
+</script> 
+</td></tr> 
+</table>
+
+</td> 
+</tr> 
+</table>
+
+</body> 
+</html> 
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/regularresult.php php-syslog-ng/html/includes/regularresult.php
--- php-syslog-ng-2.9.f/html/includes/regularresult.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/regularresult.php	2009-02-23 12:36:07.000000000 -0500
@@ -0,0 +1,987 @@
+<?php
+// Copyright (c) 2001-2004 by Michael Earls, michael@michaelearls.com
+// Copyright (c) 2004-2005 Jason Taylor, j@jtaylor.ca
+// Copyright (c) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (c) 2006-2008 Clayton Dukes, cdukes@cdukes.com
+
+require_once 'includes/html_header.php';
+
+//========================================================================
+// BEGIN: GET THE INPUT VARIABLES
+//========================================================================
+$host = get_input('host', false);
+$host2 = get_input('host2', false);
+$excludeHost = get_input('excludeHost', false);
+/* BEGIN: RegExp and Program additions by BPK */
+$regexpHost = get_input('regexpHost', false);
+$program = get_input('program', false);
+$program2 = get_input('program2', false);
+$excludeProgram = get_input('excludeProgram', false);
+$regexpProgram = get_input('regexpProgram', false);
+/* END: RegExp and Program additions by BPK */
+$facility = get_input('facility', false);
+$excludeFacility = get_input('excludeFacility', false);
+$priority = get_input('priority', false);
+$excludePriority = get_input('excludePriority', false);
+$date = get_input('date', false); 
+/* BEGIN: Switched by BPK - if this is the default it should be displayed as such
+   It's preferable to be able to search through an entire table structure without
+   the need to know which dates it encompasses.
+   if (! $date) { 
+   $date = "yesterday"; 
+   }   
+   $date2 = get_input('date2'); 
+   if (! $date2) { 
+   $date = "today"; 
+   }   
+ */
+$date2 = get_input('date2', false); 
+/* END: Switched by BPK */
+$time = get_input('time', false);
+$time2 = get_input('time2', false);
+$limit = get_input('limit', false);
+$orderby = get_input('orderby', false);
+$dupop = get_input('dupop', false);
+$dupcount = get_input('dupcount', false);
+$order = get_input('order', false);
+$offset = get_input('offset', false);
+if(!$offset) {
+   	$offset = 0;
+}
+$collapse = get_input('collapse', false);
+$table = get_input('table', false);
+
+// Set an arbitrary number of msg# and ExcludeMsg# vars
+$msgvarnum=1;
+$msgvarname="msg".$msgvarnum;
+$excmsgvarname="ExcludeMsg".$msgvarnum;
+$regexpmsgvarname="RegExpMsg".$msgvarnum;
+
+while(get_input($msgvarname, false)) {
+   	${$msgvarname} = get_input($msgvarname, false);
+   	${$excmsgvarname} = get_input($excmsgvarname, false);
+   	${$regexpmsgvarname} = get_input($regexpmsgvarname, false);
+
+	$msgvarnum++;
+   	$msgvarname="msg".$msgvarnum;
+   	$excmsgvarname="ExcludeMsg".$msgvarnum;
+   	$regexpmsgvarname="RegExpMsg".$msgvarnum;
+}
+//========================================================================
+// END: GET THE INPUT VARIABLES
+//========================================================================
+
+/* BEGIN: Added by BPK to save search form variables into the session. */
+$_SESSION['host'] = (isset($host)) ? $host : '';
+$_SESSION['host2'] = (isset($host2)) ? $host2 : '';
+$_SESSION['excludeHost'] = (isset($excludeHost)) ? $excludeHost : '';
+$_SESSION['regexpHost'] = (isset($regexpHost)) ? $regexpHost : '';
+$_SESSION['program'] = (isset($program)) ? $program : '';
+$_SESSION['program2'] = (isset($program2)) ? $program2 : '';
+$_SESSION['excludeProgram'] = (isset($excludeProgram)) ? $excludeProgram : '';
+$_SESSION['regexpProgram'] = (isset($regexpProgram)) ? $regexpProgram : '';
+$_SESSION['facility'] = (isset($facility)) ? $facility : '';
+$_SESSION['excludeFacility'] = (isset($excludeFacility)) ? $excludeFacility : '';
+$_SESSION['priority'] = (isset($priority)) ? $priority : '';
+$_SESSION['excludePriority'] = (isset($excludePriority)) ? $excludePriority : '';
+$_SESSION['date'] = (isset($date)) ? $date : '';
+$_SESSION['date2'] = (isset($date2)) ? $date2 : '';
+$_SESSION['time'] = (isset($time)) ? $time : '';
+$_SESSION['time2'] = (isset($time2)) ? $time2 : '';
+$_SESSION['limit'] = (isset($limit)) ? $limit : '';
+$_SESSION['orderby'] = (isset($orderby)) ? $orderby : '';
+$_SESSION['order'] = (isset($order)) ? $order : '';
+$_SESSION['offset'] = (isset($offset)) ? $offset : '';
+$_SESSION['collapse'] = (isset($collapse)) ? $collapse : '';
+$_SESSION['table'] = (isset($table)) ? $table : '';
+$_SESSION['dupop'] = (isset($dupop)) ? $dupop : '';
+$_SESSION['dupcount'] = (isset($dupcount)) ? $dupcount : '';
+$_SESSION['topx'] = (isset($topx)) ? $topx : '';
+for ($i=1; $i<=3; $i++) {
+   	$_SESSION['msg'.$i] = (isset(${'msg'.$i})?${'msg'.$i}:'');
+   	$_SESSION['ExcludeMsg'.$i] = (isset(${'ExcludeMsg'.$i})?${'ExcludeMsg'.$i}:'');
+   	$_SESSION['RegExpMsg'.$i] = (isset(${'RegExpMsg'.$i})?${'RegExpMsg'.$i}:'');
+}
+/* END: Added by BPK to save search form variables info the session. */
+
+//========================================================================
+// BEGIN: INPUT VALIDATION
+//========================================================================
+$inputValError = array();
+
+if($excludeHost && !validate_input($excludeHost, 'excludeX')) {
+   	array_push($inputValError, "excludeHost");
+}
+if($host && !validate_input($host, 'host')) {
+   	array_push($inputValError, "host1");
+}
+/* BEGIN: RegExp and Program additions by BPK
+   if($host2 && !validate_input($host2, 'host')) {
+   array_push($inputValError, "host2");
+   }
+ */
+if($regexpHost && !validate_input($regexpHost, 'regexpX')) {
+   	array_push($inputValError, 'regexpHost');
+}
+if($host2 && (!$regexpHost && !validate_input($host2, 'host'))
+	   	|| ($regexpHost && !validate_input($host2, 'hostRegExp'))) {
+   	array_push($inputValError, 'host2');
+}
+if($excludeProgram && !validate_input($excludeProgram, 'excludeX')) {
+   	array_push($inputValError, "excludeProgram");
+}
+if($program && !validate_input($program, 'program')) {
+   	array_push($inputValError, "program1");
+}
+if($regexpProgram && !validate_input($regexpProgram, 'regexpX')) {
+   	array_push($inputValError, 'regexpProgram');
+}
+if($program2 && (!$regexpProgram && !validate_input($program2, 'program'))
+	   	|| ($regexpProgram && !validate_input($program2, 'programRegExp'))) {
+   	array_push($inputValError, 'program2');
+}
+/* END: RegExp and Program additions by BPK */
+if($excludeFacility && !validate_input($excludeFacility, 'excludeX')) {
+   	array_push($inputValError, "excludeFacility");
+}
+if($facility && !validate_input($facility, 'facility')) {
+   	array_push($inputValError, "facility");
+}
+if($excludePriority && !validate_input($excludePriority, 'excludeX')) {
+   	array_push($inputValError, "excludePriority");
+}
+if($priority && !validate_input($priority, 'priority')) {
+   	array_push($inputValError, "priority");
+}
+if($date && !validate_input($date, 'date')) {
+   	array_push($inputValError, "date1");
+}
+if($date2 && !validate_input($date2, 'date')) {
+   	array_push($inputValError, "date2");
+}
+if($time && !validate_input($time, 'time')) {
+   	array_push($inputValError, "time1");
+}
+if($time2 && !validate_input($time2, 'time')) {
+   	array_push($inputValError, "time2");
+}
+if($limit && !validate_input($limit, 'limit')) {
+   	array_push($inputValError, "limit");
+}
+if($orderby && !validate_input($orderby, 'orderby')) {
+   	array_push($inputValError, "orderby");
+}
+if($dupop && !validate_input($dupop, 'dupop')) {
+   	array_push($inputValError, "dupop");
+}
+if($dupcount && !validate_input($dupcount, 'dupcount')) {
+   	array_push($inputValError, "dupcount");
+}
+if($order && !validate_input($order, 'order')) {
+   	array_push($inputValError, "order");
+}
+if(!validate_input($offset, 'offset')) {
+   	array_push($inputValError, "offset");
+}
+if($collapse && !validate_input($collapse, 'collapse')) {
+   	array_push($inputValError, "collapse");
+}
+if($table && !validate_input($table, 'table')) {
+   	array_push($inputValError, "table");
+}
+
+if($inputValError) {
+   	require_once 'includes/html_header.php';
+   	echo "Input validation error! The following fields had the wrong format:<p>";
+   	foreach($inputValError as $value) {
+	   	echo $value."<br>";
+   	}
+   	require_once 'includes/html_footer.php';
+   	exit;
+}
+//========================================================================
+// END: INPUT VALIDATION
+//========================================================================
+
+
+//========================================================================
+// BEGIN: BUILD AND EXECUTE SQL STATEMENT
+// AND BUILD PARAMETER LIST FOR HTML GETS
+//========================================================================
+//------------------------------------------------------------------------
+// Create WHERE statement and GET parameter list
+//------------------------------------------------------------------------
+$where = "";
+$ParamsGET = "&";
+
+if($table) {
+   	$ParamsGET=$ParamsGET."table=".$table."&";
+}
+
+if($limit) {
+   	$ParamsGET=$ParamsGET."limit=".$limit."&";
+}
+
+if($orderby) {
+   	$ParamsGET=$ParamsGET."orderby=".$orderby."&";
+}
+if($dupop) {
+   	$ParamsGET=$ParamsGET."dupop=".$dupop."&";
+}
+if($dupcount) {
+   	$ParamsGET=$ParamsGET."dupcount=".$dupcount."&";
+}
+
+if($order) {
+   	$ParamsGET=$ParamsGET."order=".$order."&";
+}
+
+if($collapse) {
+   	$ParamsGET=$ParamsGET."collapse=".$collapse."&";
+}
+
+if($pageId) {
+   	$ParamsGET=$ParamsGET."pageId=".$pageId."&";
+}
+
+/* BEGIN: Switched by BPK to allow for host lists and regexp
+   if($host2) {
+   if ($where!="") {
+   $where=$where." and ";
+   }
+   if($excludeHost==1) {
+   $where = $where." host not like '%".$host2."%' ";
+   }
+   else {
+   $where = $where." host like '%".$host2."%' ";
+   }
+   $ParamsGET=$ParamsGET."host2=".$host2."&excludeHost=".$excludeHost."&";
+   }	
+ */
+if($host2) {
+   	if ($where!="") {
+	   	$where=$where." AND ";
+   	}
+   	$clause = '';
+   	if ($regexpHost==1) {
+	   	$clause = "host RLIKE '".$host2."'";
+   	}
+   	else {
+	   	$parts = preg_split('/\s*[,;]+\s*/', $host2);
+	   	foreach ($parts as $part) {
+		   	if (empty($part)) continue;
+		   	$clause .= ($clause!='') ? ' OR ' : '';
+		   	$clause .= "host LIKE '%${part}%'"; 
+		}
+   	}
+   	$where .= (($excludeHost==1) ? 'NOT ' : '')."($clause)";
+   	$ParamsGET=$ParamsGET."host2=".$host2."&excludeHost=".$excludeHost.
+	  	"&regexpHost=".$regexpHost."&";
+}
+/* END: Switched by BPK to allow for host lists, programs, and regexp */
+
+if($host) {
+   	$hostGET=implode("&host[]=",$host);
+   	$hostSQL=implode("','",$host);
+   	if($where!="") {
+	   	$where = $where." AND ";
+   	}
+   	if($excludeHost==1) {
+	   	$where = $where." host NOT IN ('".$hostSQL."') ";
+   	}
+   	else {
+	   	$where = $where." host IN ('".$hostSQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."host[]=".$hostGET."&excludeHost=".$excludeHost."&";	
+}
+/* BEGIN: Added by BPK to allow for program lists and regexp */
+if($program2) {
+   	if ($where!="") {
+	   	$where=$where." AND ";
+   	}
+   	$clause = '';
+   	if ($regexpProgram==1) {
+	   	$clause = "program RLIKE '".$program2."'";
+   	}
+   	else {
+	   	$parts = preg_split('/\s*[,;]+\s*/', $program2);
+	   	foreach ($parts as $part) {
+		   	if (empty($part)) continue;
+		   	$clause .= ($clause!='') ? ' OR ' : '';
+		   	$clause .= "program LIKE '%${part}%'";
+	   	}
+   	}
+   	$where .= (($excludeProgram==1) ? 'NOT ' : '')."($clause)";
+   	$ParamsGET=$ParamsGET."program2=".$program2."&excludeProgram=".$excludeProgram.
+	  	"&regexpProgram=".$regexpProgram."&";
+}
+
+if($program) {
+   	$programGET=implode("&program[]=",$program);
+   	$programSQL=implode("','",$program);
+   	if($where!="") {
+	   	$where = $where." AND ";
+   	}
+   	if($excludeProgram==1) {
+	   	$where = $where." program NOT IN ('".$programSQL."') ";
+   	}
+   	else {
+	   	$where = $where." program IN ('".$programSQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."program[]=".$programGET."&excludeProgram=".$excludeProgram."&";
+}
+/* END: Added by BPK to allow for program lists and regexp */
+
+if($facility) {
+   	$facilityGET=implode("&facility[]=",$facility);
+   	$facilitySQL=implode("','",$facility);
+   	if($where!="") {
+	   	$where = $where." AND ";
+   	}
+   	if($excludeFacility==1) {
+	   	$where = $where." facility NOT IN ('".$facilitySQL."') ";
+   	}
+   	else {
+	   	$where = $where." facility IN ('".$facilitySQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."facility[]=".$facilityGET."&excludeFacility=".$excludeFacility."&";
+}
+
+if($priority) {
+   	$priorityGET=implode("&priority[]=",$priority);
+   	$prioritySQL=implode("','",$priority);
+   	if($where!="") {
+	   	$where = $where." AND ";
+   	}
+   	if($excludePriority==1) {
+	   	$where = $where." priority NOT IN ('".$prioritySQL."') ";
+   	}
+   	else {
+	   	$where = $where." priority IN ('".$prioritySQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."priority[]=".$priorityGET."&excludePriority=".$excludePriority."&";
+}
+
+$datetime = "";
+$datetime2 = "";
+
+if($date) {
+   	$ParamsGET=$ParamsGET."date=".$date."&time=".$time."&";
+   	if(strcasecmp($date, 'now') == 0 || strcasecmp($date, 'today') == 0) {
+	   	$date = date("Y-m-d");
+   	}
+   	elseif(strcasecmp($date, 'yesterday') == 0) {
+	   	$date = date("Y-m-d", mktime(0, 0, 0, date("m")  , date("d")-1, date("Y")));
+   	}
+   	if(!$time) {
+	   	$time = "00:00:00";
+   	}
+   	elseif(strcasecmp($time, 'now') == 0) {
+	   	$time = date("H:i:s");
+   	}
+	$date = list($month, $day, $year) = split('[/.-]', $date);
+   	$datetime = $year ."-" .$month ."-" .$day ." ".$time ;
+}
+if($date2) {
+   	$ParamsGET=$ParamsGET."date2=".$date2."&time2=".$time2."&";
+   	if(strcasecmp($date2, 'now') == 0 || strcasecmp($date2, 'today') == 0) {
+	   	$date2 = date("Y-m-d");
+   	}
+   	elseif(strcasecmp($date2, 'yesterday') == 0) {
+	   	$date2 = date("Y-m-d", mktime(0, 0, 0, date("m")  , date("d")-1, date("Y")));
+   	}
+   	if(!$time2) {
+	   	$time2 = "23:59:59";
+   	}
+   	elseif(strcasecmp($time2, 'now') == 0) {
+	   	$time2 = date("H:i:s");
+   	}
+	$date2 = list($month2, $day2, $year2) = split('[/.-]', $date2);
+   	$datetime2 = $year2 ."-" .$month2 ."-" .$day2 ." ".$time2 ;
+}
+
+if($datetime && $datetime2) {
+   	if($where != "") {
+	   	$where = $where." AND ";
+   	}
+   	$where = $where." datetime between '".$datetime."' AND '".$datetime2."' ";
+}
+elseif($datetime) {
+   	if($where != "") {
+	   	$where = $where." AND ";
+   	}
+   	$where = $where." datetime > '".$datetime."' ";
+}
+elseif($datetime2) {
+   	if($where != "") {
+	   	$where = $where." AND ";
+   	}
+   	$where = $where." datetime < '".$datetime2."' ";
+}
+(!$dupcount) ? ($dupcount = 0) : ($dupcount);
+if($dupop) {
+   	if($where != "") {
+	   	$where = $where." AND ";
+   	}
+   	switch ($dupop) {
+	   	case "gt":
+		   	$dupop = ">";
+	   	break;
+
+		case "lt":
+		   	$dupop = "<";
+	   	break;
+
+		case "eq":
+		   	$dupop = "=";
+	   	break;
+
+		case "gte":
+		   	$dupop = ">=";
+	   	break;
+
+		case "lte":
+		   	$dupop = "<=";
+	   	break;
+
+		default:
+	   	$dupop = ">=";
+   	}
+   	$where = $where." counter $dupop '".$dupcount."' ";
+}
+
+$msgvarnum=1;
+$msgvarname="msg".$msgvarnum;
+$excmsgvarname="ExcludeMsg".$msgvarnum;
+$regexpmsgvarname="RegExpMsg".$msgvarnum;
+
+/** BEGIN: Switched by BPK to allow from regexp
+  while(${$msgvarname}) {
+  if($where !="") {
+  $where = $where." AND ";
+  }
+  if(${$excmsgvarname} == "on") {
+  $where = $where." msg NOT LIKE '%".${$msgvarname}."%' ";
+  $ParamsGET=$ParamsGET.$excmsgvarname."=".${$excmsgvarname}."&";
+  }
+  else {
+  $where = $where." msg LIKE '%".${$msgvarname}."%' ";
+  }
+  $ParamsGET=$ParamsGET.$msgvarname."=".${$msgvarname}."&";
+  $msgvarnum++;
+  $msgvarname="msg".$msgvarnum;
+  $excmsgvarname="ExcludeMsg".$msgvarnum;
+  }
+ */
+while(isset(${$msgvarname})) {
+   	if($where !="") {
+	   	$where = $where." AND ";
+   	}
+   	$where .= 'msg ';
+   	if(${$excmsgvarname} == "on") {
+	   	$where .= 'NOT ';
+	   	$ParamsGET = $ParamsGET.$excmsgvarname."=".${$excmsgvarname}."&";
+   	}
+   	if(${$regexpmsgvarname} == "on") {
+	   	$where .= "RLIKE '".${$msgvarname}."' ";
+	   	$ParamsGET = $ParamsGET.$regexpmsgvarname."=".${$regexpmsgvarname}."&";
+   	}
+   	else {
+	   	$where .= "LIKE '%".${$msgvarname}."%' ";
+   	}
+   	$ParamsGET=$ParamsGET.$msgvarname."=".${$msgvarname}."&";
+   	$msgvarnum++;
+   	$msgvarname="msg".$msgvarnum;
+   	$excmsgvarname="ExcludeMsg".$msgvarnum;
+   	$regexpmsgvarname = "RegExpMsg".$msgvarnum;
+}
+/** END: Switched by BPK to allow from regexp */
+
+//------------------------------------------------------------------------
+// Create the GET string without host variables
+//------------------------------------------------------------------------
+$pieces = explode("&", $ParamsGET);
+$hostParamsGET = "";
+foreach($pieces as $value) {
+   	// if(!strstr($value, "host[]=") && !strstr($value, 'excludeHost=') && !strstr($value, 'offset=') && $value) {
+   	if(!strstr($value, "host[]=") && !strstr($value, 'excludeHost=') && !strstr($value, 'regexpHost=') && !strstr($value, 'offset=') && $value) {
+	   	$hostParamsGET = $hostParamsGET.$value."&";
+   	}
+}
+
+/* BEGIN: added by BPK to create GET string without facility, program, order* variables */
+$pieces = explode("&", $ParamsGET);
+$programParamsGET = "";
+foreach($pieces as $value) {
+   	if(!strstr($value, "program[]=") && !strstr($value, 'excludeProgram=') && !strstr($value, 'regexpProgram=') && !strstr($value, 'offset=') && $value) {
+	   	$programParamsGET = $programParamsGET.$value."&";
+   	}
+}
+
+$pieces = explode("&", $ParamsGET);
+$facilityParamsGET = "";
+foreach($pieces as $value) {
+   	if(!strstr($value, "facility[]=") && !strstr($value, 'excludeFacility=') && !strstr($value, 'offset=') && $value) {
+	   	$facilityParamsGET = $facilityParamsGET.$value."&";
+   	}
+}
+
+$pieces = explode("&", $ParamsGET);
+$orderParamsGET = "";
+foreach($pieces as $value) {
+   	if(!strstr($value, "order=") && !strstr($value, 'orderby=') && !strstr($value, 'offset=') && $value) {
+	   	$orderParamsGET = $orderParamsGET.$value."&";
+   	}
+}
+/* END: added by BPK to create GET string without facility, program, order* variables */
+
+//------------------------------------------------------------------------
+// Create the complete SQL statement
+// SQL_CALC_FOUND_ROWS is a MySQL 4.0 feature that allows you to get the
+// total number of results if you had not used a LIMIT statement. Using
+// it saves an extra query to get the total number of rows.
+//------------------------------------------------------------------------
+if($table) {
+   	$srcTable = $table;
+}
+else {
+   	$srcTable = DEFAULTLOGTABLE;
+}
+
+if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+   	$query = "SELECT SQL_CALC_FOUND_ROWS * FROM ".$srcTable." ";
+}
+else {
+   	$query = "SELECT * FROM ".$srcTable." ";
+}
+
+if($where) {
+   	$query = $query."WHERE ".$where." ORDER BY ".$orderby." ".$order." LIMIT ".$offset.", ".$limit;
+}
+else {
+   	$query = $query."ORDER BY ".$orderby." ".$order." LIMIT ".$offset.", ".$limit;
+}
+
+//------------------------------------------------------------------------
+// Execute the query
+// The FOUND_ROWS function returns the value from the SQL_CALC_FOUND_ROWS
+// count.
+//------------------------------------------------------------------------
+$results = perform_query($query, $dbLink);
+if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+   	$num_results_array = perform_query("SELECT FOUND_ROWS()", $dbLink);
+   	$num_results_array = fetch_array($num_results_array);
+   	$num_results = $num_results_array[0];
+}
+//========================================================================
+// END: BUILD AND EXECUTE SQL STATEMENT
+// AND BUILD PARAMETER LIST FOR HTML GETS
+//========================================================================
+
+//========================================================================
+// BEGIN: PREPARE RESULT ARRAY
+//========================================================================
+//------------------------------------------------------------------------
+// Collapse consecutive identical messages into one line
+//------------------------------------------------------------------------
+if($collapse == 1) {
+   	$n = 0;
+   	while($row = fetch_array($results)) {
+	   	//		if($n>0 && $row['msg'] == $result_array[$n-1]['msg'] 
+		if($row['msg'] == $result_array[$n-1]['msg'] 
+				&& $row['host'] == $result_array[$n-1]['host']) {
+		   	$result_array[$n-1]['count'] = $result_array[$n-1]['count'] + 1;
+		   	$n--;
+	   	}
+	   	else {
+		   	$row['count'] = 1;
+		   	$result_array[$n] = $row;
+	   	}
+	   	$n++;
+   	}
+}
+else {
+   	$n = 0;
+   	while($row = fetch_array($results)) {
+	   	$row['count'] = 1;
+	   	$result_array[$n] = $row;
+	   	$n++;
+   	}
+}	
+//========================================================================
+// END: PREPARE RESULT ARRAY
+//========================================================================
+
+//========================================================================
+// BEGIN: BUILDING THE HTML PAGE
+//========================================================================
+// Print result sub-header
+require_once 'includes/html_result_subheader.php';
+
+// If there is a result list then print it
+if (count($result_array)){
+
+	//------------------------------------------------------------------------
+   	// If the query returned some results then start the table with the
+   	// results
+   	//------------------------------------------------------------------------
+   	?>
+	   	<table width=100%>
+	   	<tr class="resultsheader">
+	   	<!-- BEGIN: Switched by BPK to allow for sorting via links
+	   	<td>SEQ</td>
+	   	<td>HOST</td>
+	   	<td>FACILITY</td>
+	   	<td>DATE TIME</td>
+	   	<td>MESSAGE</td>
+	   	-->
+	   	<?php
+	   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=seq&order='
+	   	.(($orderby=='seq' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">SEQ</a></td>';
+   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=host&order='
+	   	.(($orderby=='host' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">HOST</a></td>';
+   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=facility&order='
+	   	.(($orderby=='facility' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">FACILITY</a></td>';
+   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+	   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=fo&order='
+		   	.(($orderby=='fo' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">FO</a></td>';
+	   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=lo&order='
+		   	.(($orderby=='lo' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">LO</a></td>';
+	   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=counter&order='
+		   	.(($orderby=='counter' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">COUNT</a></td>';
+   	}
+   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=datetime&order='
+	   	.(($orderby=='datetime' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">DATE TIME</a></td>';
+   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=program&order='
+	   	.(($orderby=='program' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">PROGRAM</a></td>';
+   	echo '<td><a href="'.$_SERVER['PHP_SELF'].'?orderby=msg&order='
+	   	.(($orderby=='program' && $order=='DESC') ? 'ASC' : 'DESC').'&'.$orderParamsGET.'">MESSAGE</a></td>';
+   	?>
+	   	<!-- END: Switched by BPK to allow for sorting via links -->
+	   	</tr>
+	   	<?php
+	   	//------------------------------------------------------------------------
+	   	// Output the table with the results
+	   	// Use an alternating background and color code the priority column
+	   	//------------------------------------------------------------------------
+	   	if(CEMDB == "ON") {
+		   	require_once 'includes/CEMDB.class.php';
+		   	$cemdb = new CEMDB($dbLink);
+	   	}
+
+	$color = "lighter";
+   	$today = date('Y-m-d');
+   	for($i=0; $i < count($result_array); $i++) {
+	   	$row = $result_array[$i];
+	   	if($color == "darker") {
+		   	$color = "lighter";
+	   	}
+	   	else {
+		   	$color = "darker";
+	   	}
+	   	echo "<tr class=\"$color\">";
+	   	echo "<td>".$row['seq']."</td>";
+
+		echo "<td><a href=\"".$_SERVER["PHP_SELF"]."?excludeHost=0&host[]=".$row['host']."&".$hostParamsGET."\">";
+	   	echo $row['host']."</a></td>";
+
+		// 3rd column: Spit out the colour-coded FACILITY/PRIORITY fields.
+	  	/* BEGIN: Switched by BPK to allow filtering based on facility
+		   if($row['priority'] == "debug") {
+		   echo "<td class=\"sev0\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif($row['priority'] == "info") {
+		   echo "<td class=\"sev1\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif ($row['priority'] == "notice") {
+		   echo "<td class=\"sev2\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif ($row['priority'] == "warning") {
+		   echo "<td class=\"sev3\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif ($row['priority'] == "err") {
+		   echo "<td class=\"sev4\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif ($row['priority'] == "crit") {
+		   echo "<td class=\"sev5\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif ($row['priority'] == "alert") {
+		   echo "<td class=\"sev6\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		   elseif ($row['priority'] == "emerg") {
+		   echo "<td class=\"sev7\">".$row['facility']."-".$row['priority']."</td>";
+		   }
+		 */
+
+		echo "<td class=\"";
+	   	switch ($row['priority']) {
+		   	case 'debug':
+			   	echo 'sev0';
+			   	break;
+		   	case 'info':
+			   	echo 'sev1';
+			   	break;
+		   	case 'notice':
+			   	echo 'sev2';
+			   	break;
+		   	case 'warning':
+			   	echo 'sev3';
+			   	break;
+		   	case 'err':
+			   	echo 'sev4';
+			   	break;
+		   	case 'crit':
+			   	echo 'sev5';
+			   	break;
+		   	case 'alert':
+			   	echo 'sev6';
+			   	break;
+		   	case 'emerg':
+			   	echo 'sev7';
+			   	break;
+	   	}
+	   	echo "\"><a href=\"".$_SERVER['PHP_SELF']."?excludeFacility=0&facility[]=".$row['facility']."&".$facilityParamsGET."\">";
+	   	echo $row['facility']."</a></td>\n";
+
+		// echo "<td>".$row['fo']."</td>";
+	   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+		   	$pieces = explode(' ', $row['fo']);
+		   	echo '<td>';
+		   	if ($pieces[0]!=$today) {
+			   	echo $pieces[0]."&nbsp;";
+		   	}
+		   	echo $pieces[1];
+		   	echo "</td>\n";
+		   	// echo "<td>".$row['fo']."</td>";
+		   	$pieces = explode(' ', $row['lo']);
+		   	echo '<td>';
+		   	if ($pieces[0]!=$today) {
+			   	echo $pieces[0]."&nbsp;";
+		   	}
+		   	echo $pieces[1];
+		   	echo "</td>\n";
+		   	// Counter row follows
+		   	echo "<td>".$row['counter']."</td>";
+	   	}
+	   	/* END: Switched by BPK to allow filtering based on facility */
+
+
+		/* BEGIN: Added by BPK to hide the date if it's the same as today
+		   echo "<td>".$row['datetime']."</td>";
+		 */
+	   	$pieces = explode(' ', $row['datetime']);
+	   	echo '<td>';
+	   	if ($pieces[0]!=$today) {
+		   	echo $pieces[0]."&nbsp;";
+	   	}
+	   	echo $pieces[1];
+	   	echo "</td>\n";
+	   	echo '<td>';
+	   	$program = htmlspecialchars($row['program']);
+	   	if (!empty($program)) {
+		   	$pattern = '/^'.addcslashes($program, '.()[]/\\').'/';
+		   	$replacement = '<a href="'.$_SERVER['PHP_SELF'].'?excludeProgram=0&program[]='.$program.'&'.$programParamsGET.'">'.$program.'</a>';
+		   	$program = preg_replace($pattern, $replacement, $program);
+	   	}
+	   	echo $program;
+	   	echo "</td>\n";
+	   	/* END: Added by BPK to hide the date if it's the same as today */
+
+		/* BEGIN: Switched by BPK to show count along with extras like
+		   filtering by program, and disabled popups with no information
+		   if($row['count'] > 1) {
+		   echo "<td><b>".$row['count']." *</b> ".htmlentities($row['msg'])."</td>";
+		   }
+		   else {
+		 */
+	   	/* BEGIN: CEMDB Mod */
+	   	/* CONTINUE: Switched by BPK ... (cdukes - note - added close comment to end of this line due to no match found) 
+		   if(CEMDB == "ON") {
+
+		// Added below to remove whitespace between delimiters (% and :)
+	   	// example:
+	   	// "%SYS-5-CONFIG :" is now
+	   	// "%SYS-5-CONFIG:"
+	   	$row['msg'] = preg_replace('/\s:/', ':', $row['msg']);
+
+		// Grab Mnemonic name and Message and leave out the stuff at the front
+	   	$row['msg'] = preg_replace('/.*(%.*?:.*)/', '$1', $row['msg']);
+	   	// Original message:
+	   	// 3852752: DRP/0/0/CPU0:Feb 4 20:12:36.098 EST5: SSHD_[65697]: %SECURITY-SSHD-3-ERR_GENERAL: Failed to get DSA public key
+	   	// New message using regex above: .*(%.*?:.*):
+	   	// SSHD_[65697]: %SECURITY-SSHD-3-ERR_GENERAL: Failed to get DSA public key
+	   	$data = $cemdb->lookup($row['msg']);
+	   	if($data !== false) {
+	   	$info  =     "<b>Name:</b>"                    . $data[0];
+	   	$info .= "<br><b>Message:</b> "                . $data[1];
+	   	$info .= "<br><b>Explanation:</b> "            . $data[2];
+	   	$info .= "<br><b>Action:</b> "                 . $data[3];
+	   	$info .= "<br><b>Record last updated on:</b> " . $data[4];
+	   	$info = str_replace("\n", "", $info);
+	   	$info = htmlentities($info);
+	   	if (!get_magic_quotes_gpc()) {
+	   	$info = stripslashes($info);
+	   	}
+	   	}
+	   	else {
+	   	//if (preg_match("/%[:alpha:].*:/", $row['msg']) == 0) {
+	   	if (preg_match("/%[[:alpha:]]+$/", $row['msg']) == 0) {
+
+		$info = "";
+	   	} else {
+	   	$info = "No Data available for this message.";
+	   	}
+	   	}
+	   	?>				<th  align="left"><A href="#" onmouseover="overlib('<TABLE border=1 cellspacing=0 cellpadding=0 width=100%><TR><TD class=tooltip><?php echo $info?></TD></TR></TABLE>');" onmouseout=nd(); name ="spacer" ><?php echo htmlspecialchars($row['msg']);?></A></th>
+	   	<?			}
+	   	else {
+	   	echo "<td>".htmlspecialchars($row['msg'])."</td>";
+	   	}
+	   	/* END: CEMDB Mod */
+	   	/* CONTINUE: Switched by BPK ...
+		   }
+		 */
+	   	// Grab Mnemonic name and Message and leave out the stuff at the front
+	   	$row['msg'] = preg_replace('/.*(%.*?:.*)/', '$1', $row['msg']);
+	   	// Original message:
+	   	// 3852752: DRP/0/0/CPU0:Feb 4 20:12:36.098 EST5: SSHD_[65697]: %SECURITY-SSHD-3-ERR_GENERAL: Failed to get DSA public key
+	   	// New message using regex above: .*(%.*?:.*):
+	   	// SSHD_[65697]: %SECURITY-SSHD-3-ERR_GENERAL: Failed to get DSA public key
+	   	if(CEMDB == "ON") {
+	   	$data = $cemdb->lookup($row['msg']);
+		}
+	   	// BPK - this is where the revised version begins
+	   	// CDUKES - BETA - FIX THIS
+	   	$printed = false;
+	   	if (CEMDB == "ON") {
+		   	$data = $cemdb->lookup($row['msg']);
+		   	if($data !== false) {
+			   	$info  =     "<b>Name:</b>"                    . $data[0];
+			   	$info .= "<br><b>Message:</b> "                . $data[1];
+			   	$info .= "<br><b>Explanation:</b> "            . $data[2];
+			   	$info .= "<br><b>Action:</b> "                 . $data[3];
+			   	$info .= "<br><b>Record last updated on:</b> " . $data[4];
+			   	$info = str_replace("\n", "", $info);
+			   	$info = htmlentities($info);
+			   	$msg = (($row['count'] > 1) ? '<b>'.$row['count'].' *</b> ' : '') . htmlspecialchars($row['msg']);
+			   	?>				<th  align="left"><A href="#" onmouseover="overlib('<TABLE border=1 cellspacing=0 cellpadding=0 width=100%><TR><TD class=tooltip><?php echo $info?></TD></TR></TABLE>');" onmouseout=nd(); name ="spacer" ><?php echo $msg;?></A></th>
+				   	<?php			$printed = true;
+		   	}
+
+		}
+	   	// if CEMDB off or row wasn't found, print it
+	   	// this will prevent unnecessary popups and allow filtering via a link
+	   	if (!$printed) { 
+			$msg = htmlspecialchars($row['msg']);
+		   	echo "<td>";
+		   	if ($row['count'] > 1) echo '<b>'.$row['count'].' *</b> ';
+		   	echo "$msg</td>\n";
+	   	}
+	   	echo "</tr>\n";
+   	}
+   	echo "</table>\n";
+
+	//------------------------------------------------------------------------
+   	// Create the list with links to other results.
+  	// The list will show a maximum of 11 pages + first and last
+   	//------------------------------------------------------------------------
+   	echo "Result Page: ";
+
+	if($num_results) {
+
+		// If you are not on the first page then show the FIRST link
+	   	if($offset>0) {
+		   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=0".$ParamsGET."\"><BIG>FIRST</BIG></a> ";
+	   	}
+
+		// If you are not on one of the first two pages then also show the PREV link
+	   	if($offset>$limit+1) {
+		   	$prevoffset=$offset-$limit ;
+		   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=".$prevoffset.$ParamsGET."\"><BIG>PREV</BIG></a>\n";
+	   	}
+
+		// Calculate the total number of pages in the query
+	   	$totalpages=intval($num_results/$limit);
+	   	if($num_results%$limit) {
+		   	$totalpages++;
+	   	}
+
+		// Calculate the current page
+	   	$curpage=floor($offset/$limit);
+
+		// Figure out what the first page on the list should be
+	   	if($curpage<5) {
+		   	$firstpage = 0;
+	   	}
+	   	else {
+		   	$firstpage = $curpage - 5;
+	   	}
+	   	if($curpage>$totalpages - 6) {
+		   	$firstpage = $totalpages - 11;
+	   	}
+	   	if($firstpage<5) {
+		   	$firstpage = 0;
+	   	}
+	   	if($totalpages < 11) {
+		   	$listpages = $totalpages;
+	   	}
+	   	else {
+		   	$listpages = 11;
+	   	}
+
+		// Determine what the last page on the list should be
+	   	$lastpage = $firstpage + $listpages;
+
+		// Output the list of numbered links to the 11 closest pages.
+	  	// The current page is high-lighted and the other are created as links
+	   	for($i=$firstpage;$i<$lastpage;$i++) {
+		   	$pageoffset=$i*$limit;
+		   	$pagenum = $i + 1;
+		   	if($curpage==$i) {
+			   	echo "<font size=+1>[$pagenum]</font>\n";
+		   	}
+		   	else {
+			   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=".$pageoffset.$ParamsGET."\">$pagenum</a>\n";
+		   	}
+	   	}
+
+		// If there's a page with a higher offset and that page is not the last
+	   	// on the list then create a NEXT link.
+	  	if((intval($offset/$limit)+2)<$totalpages) {
+		   	$nextoffset=$offset+$limit;
+		   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=".$nextoffset.$ParamsGET."\"><BIG>NEXT</BIG></a> \n";
+	   	}
+
+		// If you are not currently on the last page then create a LAST link.
+	  	if($totalpages>1 && (intval($offset/$limit)+1)!=$totalpages) {
+		   	$lastoffset=($totalpages-1)*$limit;
+		   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=".$lastoffset.$ParamsGET."\"><BIG>LAST</BIG></a>";
+	   	}
+   	}
+   	// This for backwards when total row count is not calculated.
+  	else {
+	   	if($offset>0) {
+		   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=0".$ParamsGET."\"><BIG>FIRST</BIG></a> ";
+	   	}
+
+		// If you are not on one of the first two pages then also show the PREV link
+	   	if($offset>$limit+1) {
+		   	$prevoffset=$offset-$limit ;
+		   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=".$prevoffset.$ParamsGET."\"><BIG>PREV</BIG></a>\n";
+	   	}
+	   	$nextoffset=$offset+$limit;
+	   	echo "<a href=\"".$_SERVER["PHP_SELF"]."?offset=".$nextoffset.$ParamsGET."\"><BIG>NEXT</BIG></a> \n";
+   	}
+   	}
+
+	//------------------------------------------------------------------------
+   	// Else just direct the user back to the form
+   	//------------------------------------------------------------------------
+	   	else {
+		   	echo "No results found.<br><a href=\"index.php?pageId=searchform\">BACK TO SEARCH</a>";
+	   	}
+
+	//========================================================================
+   	// END: BUILDING THE HTML PAGE
+   	//========================================================================
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/search.php php-syslog-ng/html/includes/search.php
--- php-syslog-ng-2.9.f/html/includes/search.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/search.php	2009-02-23 12:24:57.000000000 -0500
@@ -0,0 +1,730 @@
+<?php
+// Copyright (C) 2001-2004 by Michael Earls, michael@michaelearls.com
+// Copyright (C) 2004-2005 Jason Taylor, j@jtaylor.ca
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (C) 2006 Clayton Dukes, cdukes@cdukes.com
+
+$basePath = dirname( __FILE__ );
+require_once ($basePath . "/html_header.php");
+
+//------------------------------------------------------------------------
+// CDUKES - BEGIN Calendar Addon
+//------------------------------------------------------------------------
+
+$todayYear = date("Y");
+$todayMonth = date("m");
+$todayMMonth = date("M");
+$todayDay = date("d");
+$today = "$todayMMonth $todayDay";
+$caltoday = "$todayYear-$todayMonth-$todayDay";
+$thismonth = "$todayYear-$todayMonth-01";
+$twomonths = date("m") + 2;
+$endDay = "$todayYear-$twomonths-$todayDay";
+$weekArr = get_weekdates($todayYear,$todayMonth,$todayDay);
+// die (print_r($weekArr));
+
+//------------------------------------------------------------------------
+// END - BEGIN Calendar Addon
+//------------------------------------------------------------------------
+
+
+//------------------------------------------------------------------------
+// See if the MERGELOGTABLE is configured and available
+//------------------------------------------------------------------------
+$mergelogtable = FALSE;
+if(defined('MERGELOGTABLE') && MERGELOGTABLE) {
+   	if(table_exists(MERGELOGTABLE, $dbLink)) {
+	   	$mergelogtable = TRUE;
+   	}
+}
+
+// Get list of log tables
+$logTableArray = get_logtables($dbLink);
+
+//------------------------------------------------------------------------
+// Print the top of the form and the table SELECTion if there are multiple
+// log tables.
+//------------------------------------------------------------------------
+$table = get_input('table');
+if($table && !validate_input($table, 'table')) {
+   	require_once 'includes/html_header.php';
+   	echo "The table has the wrong format.<p>";
+   	require_once 'includes/html_footer.php';
+   	exit;
+}
+
+?>
+<table class="pagecontent">
+<tr><td>
+<form action="<?php echo $_SERVER["PHP_SELF"]; ?>" method="GET" name="results">
+<table><tr><td>
+<?php
+if(count($logTableArray) > 1) { // && !$table) { 
+	// BPK this doesn't play nice with SESSION being grabed by get_input
+   	// instead, we always default to DEFAULTLOGTABLE, and let the js at the bottom 
+	// set it the the last selection
+   	$selected = '';
+   	if (!$table) {
+	   	$table = DEFAULTLOGTABLE;
+	   	$selected = 'selected';
+   	}
+   	?>
+	   	<table class="searchform">
+	   	<tr class="lighter"><td>
+	   	<b>SELECT TABLE:</b>
+	   	<SELECT name="table" id="table">
+	   	<?php
+	   	echo "<OPTION $selected>".DEFAULTLOGTABLE."</OPTION>";
+   	if($mergelogtable) {
+	   	echo "<OPTION>".MERGELOGTABLE."</OPTION>";
+   	}
+   	rsort($logTableArray);
+   	foreach($logTableArray as $value) {
+	   	if($value != DEFAULTLOGTABLE && $value != MERGELOGTABLE) {
+		   	echo "<OPTION>".htmlentities($value)."</OPTION>";
+	   	}
+   	}
+   	?>
+	   	</SELECT>
+	   	</td></tr></table>
+	   	<?php
+}
+else {
+   	if(!$table) {
+	   	$table = DEFAULTLOGTABLE;
+   	}
+   	echo "<table class=\"searchform\">";
+   	echo "<tr class=\"lighter\"><td>";
+   	echo "<b>USING TABLE: ".$table."</b>";
+   	echo "</td></tr></table>";
+   	echo "<input type=\"hidden\" name=\"table\" value=\"".$table."\">";
+}
+
+
+//------------------------------------------------------------------------
+// If MERGELOGTABLE is not used and there are multiple log tables
+// then make the user pick a table to search before showing the rest of
+// the search form.
+//------------------------------------------------------------------------
+if(!$mergelogtable && count($logTableArray) > 0 && !$table) {
+   	?>
+	   	</td></tr>
+	   	<table class="searchform">
+	   	<tr><td class="darker">
+	   	<input type="hidden" name="pageId" value="searchform">
+	   	<input type="submit" value="Select database">
+	   	</td></tr></table>
+	   	</td></tr></table>
+	   	</form>
+	   	</td></tr></table>
+	   	<?php
+
+}
+//------------------------------------------------------------------------
+// Else show the rest of the form.
+//------------------------------------------------------------------------
+else {
+   	$hostarray = array();
+   	$facilityarray = array();
+   	$programarray = array();
+
+	// What table to use to fill in the HOST and FACILITY fields?
+  	if($mergelogtable) {
+	   	// $useTable = MERGELOGTABLE;
+	   	$useTable = USETABLE;
+   	}
+   	elseif($table) {
+	   	$useTable = $table;
+   	}
+   	else {
+	   	$useTable = DEFAULTLOGTABLE;
+   	}
+
+	//------------------------------------------------------------------------
+   	// Use cache?
+  	//------------------------------------------------------------------------
+   	if(USE_CACHE && table_exists(CACHETABLENAME, $dbLink)) {
+	   	// If the cache table is empty then reload it.
+	  	$sql = "SELECT * FROM ".CACHETABLENAME." WHERE tablename='".$useTable."'";
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	if(num_rows($queryresult) == 0) {
+		   	reload_cache($useTable, $dbLink);
+	   	}
+
+		// Get the timestamp for the last update.
+	  	$sql = "SELECT updatetime FROM ".CACHETABLENAME." WHERE tablename='"
+		   	.$useTable."'";
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	$row = fetch_array($queryresult);
+	   	$cacheUpdate = $row['updatetime'];
+
+		// Print info about the cache.
+	  	echo "<table class=\"searchform\">";
+	   	echo "<tr class=\"lighter\"><td>";
+	   	echo "<b>USING CACHE TO POPULATE HOST, FACILITY, AND PROGRAM FIELDS.</b>";
+	   	echo "<br />Cache last updated on ".$cacheUpdate.".";
+	   	echo "</td></tr></table>";
+
+		// Get the HOST list
+	   	$sql = "SELECT DISTINCT value FROM ".CACHETABLENAME." WHERE type='HOST'
+		   	AND tablename='".$useTable."'";
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	while ($line = fetch_array($queryresult)) {
+		   	array_push($hostarray, $line['value']);
+	   	}
+	   	sort($hostarray);
+	   	/* START - Added by CDUKES for host count */
+	   	$hostcount = count($hostarray);
+	   	/* END - Added by CDUKES for host count */
+
+		// Get the FACILITY list
+	   	$sql = "SELECT DISTINCT value FROM ".CACHETABLENAME." WHERE type='FACILITY'
+		   	AND tablename='".$useTable."'";
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	while ($line = fetch_array($queryresult)) {
+		   	array_push($facilityarray, $line['value']);
+	   	}
+	   	sort($facilityarray);
+
+		/* BEGIN: Added by BPK for program list */
+	   	// Get the PROGRAM list
+	   	$sql = "SELECT DISTINCT value FROM ".CACHETABLENAME." WHERE type='PROGRAM'
+		   	AND tablename='".$useTable."'";
+		// die($sql);
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	while ($line = fetch_array($queryresult)) {
+		   	array_push($programarray, $line['value']);
+	   	}
+	   	sort($programarray);
+	   	$programcount = count($programarray);
+	   	/* END: Added by BPK for program list */
+   	}
+   	else {
+	   	//------------------------------------------------------------------------
+	   	// If no cache then get possible values for facility and host from table.
+	  	//------------------------------------------------------------------------
+	   	$sql = "SELECT DISTINCT host FROM ".$useTable;
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	while ($line = fetch_array($queryresult)) {
+		   	array_push($hostarray, $line['host']);
+	   	}
+	   	sort($hostarray);
+	   	/* START - Added by CDUKES for host count */
+	   	$hostcount = count($hostarray);
+	   	/* END - Added by CDUKES for host count */
+
+		$sql = "SELECT DISTINCT facility FROM ".$useTable;
+	   	$queryresult = perform_query($sql, $dbLink);
+	   	while ($line = fetch_array($queryresult)) {
+		   	array_push($facilityarray, $line['facility']);
+	   	}
+	   	sort($facilityarray);
+   	}
+
+
+	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+	   	// Get the SQZ Savings by finding the hosts with more than 1 counter
+	   	// and converting the ratio of hosts to hosts with > 1 to a percentage
+	   	$sql = "SELECT SUM(counter), count(host) from ".DEFAULTLOGTABLE." WHERE counter>1";
+	   	$query = perform_query($sql, $dbLink);
+	   	$array = fetch_array($query);
+		$sumcnt = $array[0];
+	   	$hosts = $array[1];
+		// below is a simple test for new (or empty) databases
+		if (empty($sumcnt)) {
+			$sumcnt = 1;
+		}
+		if (empty($hosts)) {
+			$hosts = 1;
+		}
+	   	$mph = ($sumcnt/$hosts);
+	   	// subtract 100 from the total below to get the opposite effect (savings = 90% rather than 10%)
+	   	// Calculation is to get the percentage of hosts to messages_per_host (convert a ratio to percentage)
+	   	$tot = (100 - (round(100/($mph * 100),4)) * 100);
+	   	$SQZ_SAVINGS = $tot;
+   	}
+
+//------------------------------------------------------------------------
+   	// Print the rest of the form.
+  	//------------------------------------------------------------------------
+   	?>
+	   	<table class="searchform">
+	   	<tr class="lighter"><td>
+	   	<!--  START - Added by CDUKES for host count -->
+	   	<b>HOSTS: <?php echo $hostcount?></b>
+	   	<!--  END - Added by CDUKES for host count -->
+	   	<table align="center" class="formentry"><tr><td>
+	   	Include
+	   	</td><td>
+	   	<input name="excludeHost" id="excludeHost_0" value="0" type="radio">
+	   	</td></tr>
+	   	<tr><td>
+	   	Exclude
+	   	</td><td>
+	   	<input name="excludeHost" id="excludeHost_1" value="1" type="radio" checked>
+	   	</td></tr>
+	   	<!-- START: Added by BPK for RegExp option -->
+	   	<tr><td>
+	   	RegExp Matching?
+	  	</td><td>
+	   	<input name="regexpHost" id="regexpHost" value="1" type="checkbox">
+	   	</td></tr>
+	   	<!-- END: Added by BPK for RegExp option -->
+	   	<tr><td>
+	   	Hostname match
+	   	</td><td>
+	   	<input type=text name=host2 id="host2" size=20>
+	   	</td></tr>
+	   	<tr><td valign="top">
+	   	=====AND=====
+	   	</td><td>
+	   	<SELECT name="host[]" id="host" multiple size=6>
+	   	<?php
+	   	foreach($hostarray as $value) {
+		   	echo "<OPTION>".htmlentities($value)."</OPTION>";
+	   	}
+   	?>
+	   	</SELECT>
+	   	</td></tr></table>
+	   	</td><td>
+	   	<!--  START: Added by BPK for program list -->
+	   	<b>PROGRAMS: <?php echo $programcount?></b>
+	   	<table align="center" class="formentry"><tr><td>
+	   	Include
+	   	</td><td>
+	   	<input name="excludeProgram" id="excludeProgram_0" value="0" type="radio">
+	   	</td></tr>
+	   	<tr><td>
+	   	Exclude
+	   	</td><td>
+	   	<input name="excludeProgram" id="excludeProgram_1" value="1" type="radio" checked>
+	   	</td></tr>
+	   	<!-- START: Added by BPK for RegExp option -->
+	   	<tr><td>
+	   	RegExp Matching?
+	  	</td><td>
+	   	<input name="regexpProgram" id="regexpProgram" value="1" type="checkbox">
+	   	</td></tr>
+	   	<!-- END: Added by BPK for RegExp option -->
+	   	<tr><td>
+	   	Program match
+	   	</td><td>
+	   	<input type=text name=program2 id="program2" size=20>
+	   	</td></tr>
+	   	<tr><td valign="top">
+	   	=====AND=====
+	   	</td><td>
+	   	<SELECT name="program[]" id="program" multiple size=6>
+	   	<?php
+	   	foreach($programarray as $value) {
+		   	echo "<OPTION>".htmlentities($value)."</OPTION>";
+	   	}
+   	?>
+	   	</SELECT>
+	   	</td></tr></table>
+	   	</td><td>
+	   	<b> SYSLOG FACILITY:</b>
+	   	<table align="center" class="formentry"><tr><td>
+	   	Include
+	   	</td><td>
+	   	<input name="excludeFacility" id="excludeFacility_0" value="0" type="radio">
+	   	</td></tr>
+	   	<tr><td>
+	   	Exclude
+	   	</td><td>
+	   	<input name="excludeFacility" id="excludeFacility_1" value="1" type="radio" checked>
+	   	</td></tr>
+	   	<tr><td colspan=2>
+	   	<SELECT name="facility[]" id="facility" multiple size=8>
+	   	<?php
+	   	foreach($facilityarray as $value) {
+		   	echo "<OPTION>".htmlentities($value)."</OPTION>";
+	   	}
+   	?>
+	   	</SELECT>
+	   	</td></tr></table>
+	   	</td><td>
+	   	<!--  END: Added by BPK for program list -->
+	   	<b> SYSLOG PRIORITY:</b>
+	   	<table align="center" class="formentry"><tr><td>
+	   	Include
+	   	</td><td>
+	   	<input name="excludePriority" id="excludePriority_0" value="0" type="radio">
+	   	</td></tr>
+	   	<tr><td>
+	   	Exclude
+	   	</td><td>
+	   	<input name="excludePriority" id="excludePriority_1" value="1" type="radio" checked>
+	   	</td></tr>
+	   	<tr><td colspan=2>
+	   	<SELECT name="priority[]" id="priority" multiple size=8>
+	   	<OPTION>debug</OPTION>
+	   	<OPTION>info</OPTION>
+	   	<OPTION>notice</OPTION>
+	   	<OPTION>warning</OPTION>
+	   	<OPTION>err</OPTION>
+	   	<OPTION>crit</OPTION>
+	   	<OPTION>alert</OPTION>
+	   	<OPTION>emerg</OPTION>
+	   	</SELECT>
+	   	</td></tr></table>
+	   	</td></tr></table>
+	   	<table class="searchform">
+	   	<tr class="lighter"><td>
+	   	<table align="center" class="formentry">
+	   	<tr><td></td><td>
+	   	DATE
+	   	</td><td>
+	   	TIME
+	   	</td></tr>
+	   	<tr><td>
+	   	<b>From:</b>
+	   	</td><td>
+	   	<script type="text/javascript" src="includes/js/datetimepicker.js?v2.0.502"></script>
+	   	<input type="text" class="text" size="10" name="date" id="date"/>
+	   	<a href="javascript:NewCal('date','mmddyyyy',false,12)">
+	   	<img src="images/cal.gif"border="0" alt="Pick a date" /></a>
+
+		<!--
+	   	<div id="myDatePickerDiv" width="100">
+	   	<input type="text" id="date" name="date" onMouseover="return overlib('<TABLE border=1 cellspacing=0 cellpadding=0 width=100%><TR><TD class=tooltip>Click on the Calendar to SELECT the date.<br>The date format is YYYY-MM-DD and the time format is HH:MM:SS.<br>Yesterday, today and now are also valid dates and now is also valid as a time.<br>If you do not get a calendar popup, then manually enter the date as<br>YYYY-MM-DD<br>eg: <?php echo $caltoday?></TD></TR></TABLE>');" onMouseout="nd();" size="12">
+	   	</td>
+		-->
+		<td>
+	   	<input type="text" size=8 maxlength=8 name="time" id="time">
+	   	</td></tr><tr><td>
+	   	<b>To:</b>
+	   	</td>
+		<td>
+	   	<script type="text/javascript" src="includes/js/datetimepicker.js?v2.0.502"></script>
+	   	<input type="text" class="text" size="10" name="date2" id="date2"/>
+	   	<a href="javascript:NewCal('date2','mmddyyyy',false,12)">
+	   	<img src="images/cal.gif"border="0" alt="Pick a date" /></a>
+		<!--
+	   	<div id="myDatePickerDivR">
+	   	<input type="text" id="date2" name="date2" onMouseover="return overlib('<TABLE border=1 cellspacing=0 cellpadding=0 width=100%><TR><TD class=tooltip>Click on the Calendar to SELECT the date.<br>The date format is YYYY-MM-DD and the time format is HH:MM:SS.<br>Yesterday, today and now are also valid dates and now is also valid as a time.<br>If you do not get a calendar popup, then manually enter the date as<br>YYYY-MM-DD<br>eg: <?php echo $caltoday?></TD></TR></TABLE>');" onMouseout="nd();" size="12">
+	   	<img src="images/buttons/bs_calendar.gif" onClick="todate();"></div>
+	   	</td>
+		-->
+		<td>
+	   	<input type="text" size=8 maxlength=8 name="time2" id="time2">
+	   	</td></tr></table>
+	   	<!-- Middle -->
+	   	<?php
+		// Included below as a block instead of coding directly in here.
+		// This is more in preparation for the upcoming v3.0 model
+	   	if(defined('GRAPH_LPD') && GRAPH_LPD == TRUE) {
+	   	echo "</td><td>\n";
+
+		include("blocks/graph-logs_per_day.php");
+
+	   	echo "</td>\n";
+	   	echo "<!-- End Middle -->\n";
+		}
+	   	?>
+	   	<td>
+	   	<table align="center" class="formentry">
+	   	<tr>
+	   	<td><b>RECORDS PER PAGE</b></td>
+	   	<td>
+	   	<SELECT name="limit" id="limit">
+	   	<OPTION>10</OPTION>
+	   	<OPTION>25</OPTION>
+	   	<OPTION selected>50</OPTION>
+	   	<OPTION>100</OPTION>
+	   	<OPTION>200</OPTION>
+	   	<OPTION>500</OPTION>
+	   	<OPTION>1000</OPTION>
+	   	</SELECT>
+	   	<?php  if ( JPG_GRAPHS == "ON" ) { ?>
+		   	<tr>
+			   	<td><b>TopX</b></td>
+			   	<td>
+			   	<SELECT name="topx" id="topx">
+			   	<OPTION selected>10</OPTION>
+			   	<OPTION>20</OPTION>
+			   	<OPTION>25</OPTION>
+			   	<OPTION>30</OPTION>
+			   	<OPTION>35</OPTION>
+			   	<OPTION>40</OPTION>
+			   	<OPTION>50</OPTION>
+			   	<OPTION>100</OPTION>
+			   	</SELECT>
+			   	</td></tr>
+			   	<?php  } ?>
+	   	<?php  if ( SQZ_ENABLED == TRUE ) { ?>
+		   	<tr>
+			   	<td><b>Duplicates (<?php echo $SQZ_SAVINGS?> %)</b></td>
+			   	<td>
+			   	<SELECT name="dupop" id="dupop">
+			   	<OPTION selected value=""></OPTION>
+			   	<OPTION value="gt">></OPTION>
+			   	<OPTION value="lt"><</OPTION>
+			   	<OPTION value="eq">=</OPTION>
+			   	<OPTION value="gte">>=</OPTION>
+			   	<OPTION value="lte"><=</OPTION>
+			   	</SELECT>
+			   	<input type=text name="dupcount" id="dupcount" value="0" size="3" />
+			   	</td></tr>
+			   	<?php  } ?>
+			   	<tr>
+			   	<td><b>ORDER BY</b></td>
+			   	<td>
+			   	<SELECT name="orderby" id="orderby">
+			   	<OPTION>seq</OPTION>
+			   	<OPTION>host</OPTION>
+			   	<OPTION>program</OPTION>
+			   	<OPTION>facility</OPTION>
+			   	<OPTION>priority</OPTION>
+			   	<OPTION selected>datetime</OPTION>
+			   	</SELECT>
+			   	</td></tr>
+			   	<tr>
+			   	<td><b>SEARCH ORDER</b></td>
+			   	<td>
+			   	<SELECT name="order" id="order">
+			   	<OPTION>ASC</OPTION>
+			   	<OPTION selected>DESC</OPTION>
+			   	</SELECT>
+			   	</td></tr></table>
+			   	</td></tr></table>
+			   	<table class="searchform">
+			   	<tr class="lighter"><td>
+			   	<b>SEARCH MESSAGE:</b><br>
+			   	<!-- START: Switched by BPK
+			   	Exclude <input type=checkbox name="ExcludeMsg1"> <input type=text name="msg1" size=75%> <b>AND</b><br>
+			   	Exclude <input type=checkbox name="ExcludeMsg2"> <input type=text name="msg2" size=75%> <b>AND</b><br>
+			   	Exclude <input type=checkbox name="ExcludeMsg3"> <input type=text name="msg3" size=75%>
+			   	-->
+			   	<table class="msgentry">
+			   	<tr><td>
+			   	Exclude <input type="checkbox" name="ExcludeMsg1" id="ExcludeMsg1" />
+			   	</td><td>
+			   	RegExp <input type="checkbox" name="RegExpMsg1" id="RegExpMsg1" />
+			   	</td><td>
+			   	<input type=text name="msg1" id="msg1" size="75%" />&nbsp;&nbsp;<b>AND</b>
+			   	</td></tr>
+			   	<tr><td>
+			   	Exclude <input type="checkbox" name="ExcludeMsg2" id="ExcludeMsg2" />
+			   	</td><td>
+			   	RegExp <input type="checkbox" name="RegExpMsg2" id="RegExpMsg2" />
+			   	</td><td>
+			   	<input type=text name="msg2" id="msg2" size="75%" />&nbsp;&nbsp;<b>AND</b>
+			   	</td></tr>
+			   	<tr><td>
+			   	Exclude <input type="checkbox" name="ExcludeMsg3" id="ExcludeMsg3" />
+			   	</td><td>
+			   	RegExp <input type="checkbox" name="RegExpMsg3" id="RegExpMsg3" />
+			   	</td><td>
+			   	<input type=text name="msg3" id="msg3" size="75%" />
+			   	</td></tr>
+			   	</table>
+			   	<!-- END: Switch by BPK -->
+			   	</td></tr>
+			   	<table class="searchform">
+			   	<tr><td class="darker">
+			   	<input type="submit" name="pageId" value="Search">
+			   	<input type="submit" name="pageId" value="Tail">
+			   	<?php  if ( JPG_GRAPHS == "ON" ) { ?>
+				   	<input type="submit" name="pageId" value="Graph" onMouseover="return overlib('<TABLE border=1 cellspacing=0 cellpadding=0 width=100%><TR><TD class=tooltip>Please be aware that some graph building searches can take a very long time.<br>Try to make searches as finite as possible (ie, do not try to build a graph for everything, if you do, it will probably just timeout on large databases...)</TD></TR></TABLE>');" onMouseout="nd();" >
+					   	<?php } ?>
+					   	<input type="reset" value="Reset">
+					   	</td></tr></table>
+					   	</td></tr></table>
+					   	</form>
+					   	</td></tr></table>
+					   	<FORM name="dd"> 
+						<?php  if ( JPG_GRAPHS == "ON" ) { ?>
+						   	<b>Common Graphs:</b><br>
+							   	<SELECT name="graph" onChange="window.location=document.dd.graph.options[document.dd.graph.selectedIndex].value"> 
+								<OPTION selected value="#">Select a Graph Type<?php  if ( JPG_DAILY == "ON" ) { ?>
+								   	<OPTION value="<?php echo $_SERVER["PHP_SELF"]; ?>?table=<?php echo DEFAULTLOGTABLE?>&excludeHost=1&host2=&date=yesterday&time=&date2=today&topx=10&pageId=Graph">Today</OPTION>
+									   	<?php  } if ( JPG_WEEKLY == "ON" ) { ?>
+										   	<OPTION value="<?php echo $_SERVER["PHP_SELF"]; ?>?table=<?php echo MERGELOGTABLE?>&excludeHost=1&host2=&date=<?php echo $weekArr[1]['sqldate'];?>&time=&date2=today&topx=10&pageId=Graph">This Week</OPTION>
+											   	<?php  } if ( JPG_MONTHLY == "ON" ) { ?>
+												   	<OPTION value="<?php echo $_SERVER["PHP_SELF"]; ?>?table=<?php echo MERGELOGTABLE?>&excludeHost=1&host2=&date=<?php echo $thismonth?>&time=&date2=today&topx=10&pageId=Graph">This Month</OPTION>
+													   	<?php  } ?>
+													   	</SELECT> 
+														</FORM> 
+														<?php
+													  	if ( JPG_MAIN == "NOTWORKING YET" ) {
+														   	// Set up Graph variables
+														   	$slice = 0;
+														   	$host = "";
+														   	$date = "yesterday";
+														   	$date2 = "today";
+														   	$str = $str;
+														   	$limit = 10; // Equals top 10 percent of hosts
+														   	$type = "pie3d";
+														   	$mapName = 'Top10'; 
+															$fileName = IMG_CACHE_DIR . "Top10.png";
+
+															$imgMap = graph($slice, $host, $date, $date2, $str, $limit, $type, $mapName, $fileName); 
+															echo "$imgMap <img src=\"$fileName\" alt=\"graph\" ismap usemap=\"#$mapName\" border=\"0\">";
+													   	}
+
+						}
+}
+?>
+<?php
+/* BEGIN: Added by BPK to automatically repopulate the search form selections from $_SESSION using JavaScript */
+// Note: we use javascript so the Reset button will still work.
+echo "<script type=\"text/javascript\" language=\"javascript\">\n";
+// begin table restore
+if(isset($_SESSION['table'])) $table = $_SESSION['table'];
+if (!empty($table)) {
+?> 	
+	select = document.getElementById('table');
+	for (i=0; i<select.length; i++) {
+		if (select.options[i].text == '<?php echo $table; ?>') {
+			select.selectedIndex = i;
+			break;
+		}
+	}
+<?php
+} // end table restore
+
+// begin restoring host selections
+if (isset($_SESSION['excludeHost']) && is_numeric($_SESSION['excludeHost']) && $_SESSION['excludeHost'] == 0) {
+   	echo "document.getElementById('excludeHost_0').checked = true;\n";
+}
+if (isset($_SESSION['regexpHost']) && $_SESSION['regexpHost'] == 1) {
+   	echo "document.getElementById('regexpHost').checked = true;\n";
+}
+if(isset($_SESSION['host2'])) $host2 = $_SESSION['host2'];
+if (!empty($host2)) {
+   	echo "document.getElementById('host2').value = '$host2';\n";
+}
+if(isset($_SESSION['host'])) $host = $_SESSION['host'];
+if (!empty($host)) {
+   	$regexp = '/^('.
+		  	addcslashes(join($host, '|'), '.()[]/\\')
+		   	.')$/';
+   	?>
+	   	select = document.getElementById('host');
+   	for (i=0; i<select.length; i++) {
+	   	if (select.options[i].text.match(<?php echo $regexp; ?>)) {
+		   	select.options[i].selected = true;
+	   	}
+   	}
+   	<?php
+} // end host restore
+
+// begin restoring program selections
+if (isset($_SESSION['excludeProgram']) && is_numeric($_SESSION['excludeProgram']) && $_SESSION['excludeProgram'] == 0) {
+   	echo "document.getElementById('excludeProgram_0').checked = true;\n";
+}
+if (isset($_SESSION['regexpProgram']) && $_SESSION['regexpProgram'] == 1) {
+   	echo "document.getElementById('regexpProgram').checked = true;\n";
+}
+if(isset($_SESSION['program2'])) $program2 = $_SESSION['program2'];
+if (!empty($program2)) {
+   	echo "document.getElementById('program2').value = '$program2';\n";
+}
+if(isset($_SESSION['program'])) $program = $_SESSION['program'];
+if (!empty($program)) {
+   	$regexp = '/^('.
+		  	addcslashes(join($program, '|'), '.()[]/\\')
+		   	.')$/';
+   	?>
+	   	select = document.getElementById('program');
+   	for (i=0; i<select.length; i++) {
+	   	if (select.options[i].text.match(<?php echo $regexp; ?>)) {
+		   	select.options[i].selected = true;
+	   	}
+   	}
+   	<?php
+} // end program restore
+
+// begin facility restore
+if (isset($_SESSION['excludeFacility']) && is_numeric($_SESSION['excludeFacility']) && $_SESSION['excludeFacility'] == 0) {
+   	echo "document.getElementById('excludeFacility_0').checked = true;\n";
+}
+if(isset($_SESSION['facility'])) $facility = $_SESSION['facility'];
+if (!empty($facility)) {
+   	$regexp = '/^('.
+		  	addcslashes(join($facility, '|'), '.()[]/\\')
+		   	.')$/';
+   	?>
+	   	select = document.getElementById('facility');
+   	for (i=0; i<select.length; i++) {
+	   	if (select.options[i].text.match(<?php echo $regexp; ?>)) {
+		   	select.options[i].selected = true;
+	   	}
+   	}
+   	<?php
+} // end facility restore
+
+// begin priority restore
+if (isset($_SESSION['excludePriority']) && is_numeric($_SESSION['excludePriority']) && $_SESSION['excludePriority'] == 0) {
+   	echo "document.getElementById('excludePriority_0').checked = true;\n";
+}
+if(isset($_SESSION['priority'])) $priority = $_SESSION['priority'];
+if (!empty($priority)) {
+   	$regexp = '/^('.
+		  	addcslashes(join($priority, '|'), '.()[]/\\')
+		   	.')$/';
+   	?>
+	   	select = document.getElementById('priority');
+   	for (i=0; i<select.length; i++) {
+	   	if (select.options[i].text.match(<?php echo $regexp; ?>)) {
+		   	select.options[i].selected = true;
+	   	}
+   	}
+   	<?php
+} // end priority restore
+
+// begin date/time restore
+echo "document.getElementById('date').value = '".$_SESSION['date']."';\n";
+echo "document.getElementById('time').value = '".$_SESSION['time']."';\n";
+echo "document.getElementById('date2').value = '".$_SESSION['date2']."';\n";
+echo "document.getElementById('time2').value = '".$_SESSION['time2']."';\n";
+// end date/time restore
+
+// begin limit,topx,orderby,order restore
+foreach (array('limit', 'topx', 'orderby', 'order','dupop') as $var) {
+	// We have to convert the comparison symbols back to their original state for the javascipt to restore
+   	switch ($_SESSION[$var]) {
+	   	case gt:
+		   	$_SESSION[$var] = ">";
+		   	break;
+	   	case lt:
+		   	$_SESSION[$var] = "<";
+		   	break;
+	   	case eq:
+		   	$_SESSION[$var] = "=";
+		   	break;
+	   	case gte:
+		   	$_SESSION[$var] = ">=";
+		   	break;
+	   	case lte:
+		   	$_SESSION[$var] = "<=";
+		   	break;
+   	}
+   	?>
+	   	select = document.getElementById('<?php echo $var; ?>');
+   	for (i=0; i<select.length; i++) {
+	   	if (select.options[i].text == '<?php echo $_SESSION[$var]; ?>') {
+		   	select.selectedIndex = i;
+		   	break;
+	   	}
+   	}
+   	<?php
+} // end limit,topx,orderby,order restore
+echo "document.getElementById('dupcount').value = '".$_SESSION['dupcount']."';\n";
+
+// begin msg restore
+for ($i=1; $i<=3; $i++) {
+   	if (isset($_SESSION['ExcludeMsg'.$i]) && $_SESSION['ExcludeMsg'.$i]=='on') {
+	   	echo "document.getElementById('ExcludeMsg${i}').checked = true;\n";
+   	}
+   	if (isset($_SESSION['RegExpMsg'.$i]) && $_SESSION['RegExpMsg'.$i]=='on') {
+	   	echo "document.getElementById('RegExpMsg${i}').checked = true;\n";
+   	}
+   	echo "document.getElementById('msg${i}').value = '".$_SESSION['msg'.$i]."';\n";
+}
+// end msg restore
+
+echo "</script>\n";
+/* END: Added by BPK to automatically repopulate the search form selections from $_SESSION using JavaScript */
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/session.php php-syslog-ng/html/includes/session.php
--- php-syslog-ng-2.9.f/html/includes/session.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/session.php	2007-09-10 20:54:28.000000000 -0400
@@ -0,0 +1,462 @@
+<?
+/**
+ * Session.php
+ * 
+ * The Session class is meant to simplify the task of keeping
+ * track of logged in users and also guests.
+ *
+ * Written by: Jpmaster77 a.k.a. The Grandmaster of C++ (GMC)
+ * Last Updated: August 19, 2004
+ */
+include("database.php");
+include("mailer.php");
+include("form.php");
+
+class Session
+{
+   var $username;     //Username given on sign-up
+   var $userid;       //Random value generated on current login
+   var $userlevel;    //The level to which the user pertains
+   var $time;         //Time user was last active (page loaded)
+   var $logged_in;    //True if user is logged in, false otherwise
+   var $userinfo = array();  //The array holding all user info
+   var $url;          //The page url current being viewed
+   var $referrer;     //Last recorded site page viewed
+   /**
+    * Note: referrer should really only be considered the actual
+    * page referrer in process.php, any other time it may be
+    * inaccurate.
+    */
+
+   /* Class constructor */
+   function Session(){
+      $this->time = time();
+      $this->startSession();
+   }
+
+   /**
+    * startSession - Performs all the actions necessary to 
+    * initialize this session object. Tries to determine if the
+    * the user has logged in already, and sets the variables 
+    * accordingly. Also takes advantage of this page load to
+    * update the active visitors tables.
+    */
+   function startSession(){
+      global $database;  //The database connection
+      session_start();   //Tell PHP to start the session
+
+      /* Determine if user is logged in */
+      $this->logged_in = $this->checkLogin();
+
+      /**
+       * Set guest value to users not logged in, and update
+       * active guests table accordingly.
+       */
+      if(!$this->logged_in){
+         $this->username = $_SESSION['username'] = GUEST_NAME;
+         $this->userlevel = GUEST_LEVEL;
+         $database->addActiveGuest($_SERVER['REMOTE_ADDR'], $this->time);
+      }
+      /* Update users last active timestamp */
+      else{
+         $database->addActiveUser($this->username, $this->time);
+      }
+      
+      /* Remove inactive visitors from database */
+      $database->removeInactiveUsers();
+      $database->removeInactiveGuests();
+      
+      /* Set referrer page */
+      if(isset($_SESSION['url'])){
+         $this->referrer = $_SESSION['url'];
+      }else{
+         $this->referrer = "/";
+      }
+
+      /* Set current url */
+      $this->url = $_SESSION['url'] = $_SERVER['PHP_SELF'];
+   }
+
+   /**
+    * checkLogin - Checks if the user has already previously
+    * logged in, and a session with the user has already been
+    * established. Also checks to see if user has been remembered.
+    * If so, the database is queried to make sure of the user's 
+    * authenticity. Returns true if the user has logged in.
+    */
+   function checkLogin(){
+      global $database;  //The database connection
+      /* Check if user has been remembered */
+      if(isset($_COOKIE['cookname']) && isset($_COOKIE['cookid'])){
+         $this->username = $_SESSION['username'] = $_COOKIE['cookname'];
+         $this->userid   = $_SESSION['userid']   = $_COOKIE['cookid'];
+      }
+
+      /* Username and userid have been set and not guest */
+      if(isset($_SESSION['username']) && isset($_SESSION['userid']) &&
+         $_SESSION['username'] != GUEST_NAME){
+         /* Confirm that username and userid are valid */
+         if($database->confirmUserID($_SESSION['username'], $_SESSION['userid']) != 0){
+            /* Variables are incorrect, user not logged in */
+            unset($_SESSION['username']);
+            unset($_SESSION['userid']);
+            return false;
+         }
+
+         /* User is logged in, set class variables */
+         $this->userinfo  = $database->getUserInfo($_SESSION['username']);
+         $this->username  = $this->userinfo['username'];
+         $this->userid    = $this->userinfo['userid'];
+         $this->userlevel = $this->userinfo['userlevel'];
+         return true;
+      }
+      /* User not logged in */
+      else{
+         return false;
+      }
+   }
+
+   /**
+    * login - The user has submitted his username and password
+    * through the login form, this function checks the authenticity
+    * of that information in the database and creates the session.
+    * Effectively logging in the user if all goes well.
+    */
+   function login($subuser, $subpass, $subremember){
+      global $database, $form;  //The database and form object
+
+      /* Username error checking */
+      $field = "user";  //Use field name for username
+      if(!$subuser || strlen($subuser = trim($subuser)) == 0){
+         $form->setError($field, "* Username not entered");
+      }
+      else{
+         /* Check if username is not alphanumeric */
+         if(!eregi("^([0-9a-z])*$", $subuser)){
+            $form->setError($field, "* Username not alphanumeric");
+         }
+      }
+
+      /* Password error checking */
+      $field = "pass";  //Use field name for password
+      if(!$subpass){
+         $form->setError($field, "* Password not entered");
+      }
+      
+      /* Return if form errors exist */
+      if($form->num_errors > 0){
+         return false;
+      }
+
+      /* Checks that username is in database and password is correct */
+      $subuser = stripslashes($subuser);
+      $result = $database->confirmUserPass($subuser, md5($subpass));
+
+      /* Check error codes */
+      if($result == 1){
+         $field = "user";
+         $form->setError($field, "* Username not found");
+      }
+      else if($result == 2){
+         $field = "pass";
+         $form->setError($field, "* Invalid password");
+      }
+      
+      /* Return if form errors exist */
+      if($form->num_errors > 0){
+         return false;
+      }
+
+      /* Username and password correct, register session variables */
+      $this->userinfo  = $database->getUserInfo($subuser);
+      $this->username  = $_SESSION['username'] = $this->userinfo['username'];
+      $this->userid    = $_SESSION['userid']   = $this->generateRandID();
+      $this->userlevel = $this->userinfo['userlevel'];
+      
+      /* Insert userid into database and update active users table */
+      $database->updateUserField($this->username, "userid", $this->userid);
+      $database->addActiveUser($this->username, $this->time);
+      $database->removeActiveGuest($_SERVER['REMOTE_ADDR']);
+
+      /**
+       * This is the cool part: the user has requested that we remember that
+       * he's logged in, so we set two cookies. One to hold his username,
+       * and one to hold his random value userid. It expires by the time
+       * specified in constants.php. Now, next time he comes to our site, we will
+       * log him in automatically, but only if he didn't log out before he left.
+       */
+      if($subremember){
+         setcookie("cookname", $this->username, time()+COOKIE_EXPIRE, COOKIE_PATH);
+         setcookie("cookid",   $this->userid,   time()+COOKIE_EXPIRE, COOKIE_PATH);
+      }
+
+      /* Login completed successfully */
+      return true;
+   }
+
+   /**
+    * logout - Gets called when the user wants to be logged out of the
+    * website. It deletes any cookies that were stored on the users
+    * computer as a result of him wanting to be remembered, and also
+    * unsets session variables and demotes his user level to guest.
+    */
+   function logout(){
+      global $database;  //The database connection
+      /**
+       * Delete cookies - the time must be in the past,
+       * so just negate what you added when creating the
+       * cookie.
+       */
+      if(isset($_COOKIE['cookname']) && isset($_COOKIE['cookid'])){
+         setcookie("cookname", "", time()-COOKIE_EXPIRE, COOKIE_PATH);
+         setcookie("cookid",   "", time()-COOKIE_EXPIRE, COOKIE_PATH);
+      }
+
+      /* Unset PHP session variables */
+      unset($_SESSION['username']);
+      unset($_SESSION['userid']);
+
+      /* Reflect fact that user has logged out */
+      $this->logged_in = false;
+      
+      /**
+       * Remove from active users table and add to
+       * active guests tables.
+       */
+      $database->removeActiveUser($this->username);
+      $database->addActiveGuest($_SERVER['REMOTE_ADDR'], $this->time);
+      
+      /* Set user level to guest */
+      $this->username  = GUEST_NAME;
+      $this->userlevel = GUEST_LEVEL;
+   }
+
+   /**
+    * register - Gets called when the user has just submitted the
+    * registration form. Determines if there were any errors with
+    * the entry fields, if so, it records the errors and returns
+    * 1. If no errors were found, it registers the new user and
+    * returns 0. Returns 2 if registration failed.
+    */
+   function register($subuser, $subpass, $subemail){
+      global $database, $form, $mailer;  //The database, form and mailer object
+      
+      /* Username error checking */
+      $field = "user";  //Use field name for username
+      if(!$subuser || strlen($subuser = trim($subuser)) == 0){
+         $form->setError($field, "* Username not entered");
+      }
+      else{
+         /* Spruce up username, check length */
+         $subuser = stripslashes($subuser);
+         if(strlen($subuser) < 5){
+            $form->setError($field, "* Username below 5 characters");
+         }
+         else if(strlen($subuser) > 30){
+            $form->setError($field, "* Username above 30 characters");
+         }
+         /* Check if username is not alphanumeric */
+         else if(!eregi("^([0-9a-z])+$", $subuser)){
+            $form->setError($field, "* Username not alphanumeric");
+         }
+         /* Check if username is reserved */
+         else if(strcasecmp($subuser, GUEST_NAME) == 0){
+            $form->setError($field, "* Username reserved word");
+         }
+         /* Check if username is already in use */
+         else if($database->usernameTaken($subuser)){
+            $form->setError($field, "* Username already in use");
+         }
+         /* Check if username is banned */
+         else if($database->usernameBanned($subuser)){
+            $form->setError($field, "* Username banned");
+         }
+      }
+
+      /* Password error checking */
+      $field = "pass";  //Use field name for password
+      if(!$subpass){
+         $form->setError($field, "* Password not entered");
+      }
+      else{
+         /* Spruce up password and check length*/
+         $subpass = stripslashes($subpass);
+         if(strlen($subpass) < 4){
+            $form->setError($field, "* Password too short");
+         }
+         /* Check if password is not alphanumeric */
+         else if(!eregi("^([0-9a-z])+$", ($subpass = trim($subpass)))){
+            $form->setError($field, "* Password not alphanumeric");
+         }
+         /**
+          * Note: I trimmed the password only after I checked the length
+          * because if you fill the password field up with spaces
+          * it looks like a lot more characters than 4, so it looks
+          * kind of stupid to report "password too short".
+          */
+      }
+      
+      /* Email error checking */
+      $field = "email";  //Use field name for email
+      if(!$subemail || strlen($subemail = trim($subemail)) == 0){
+         $form->setError($field, "* Email not entered");
+      }
+      else{
+         /* Check if valid email address */
+         $regex = "^[_+a-z0-9-]+(\.[_+a-z0-9-]+)*"
+                 ."@[a-z0-9-]+(\.[a-z0-9-]{1,})*"
+                 ."\.([a-z]{2,}){1}$";
+         if(!eregi($regex,$subemail)){
+            $form->setError($field, "* Email invalid");
+         }
+         $subemail = stripslashes($subemail);
+      }
+
+      /* Errors exist, have user correct them */
+      if($form->num_errors > 0){
+         return 1;  //Errors with form
+      }
+      /* No errors, add the new account to the */
+      else{
+         if($database->addNewUser($subuser, md5($subpass), $subemail)){
+            if(EMAIL_WELCOME){
+               $mailer->sendWelcome($subuser,$subemail,$subpass);
+            }
+            return 0;  //New user added succesfully
+         }else{
+            return 2;  //Registration attempt failed
+         }
+      }
+   }
+   
+   /**
+    * editAccount - Attempts to edit the user's account information
+    * including the password, which it first makes sure is correct
+    * if entered, if so and the new password is in the right
+    * format, the change is made. All other fields are changed
+    * automatically.
+    */
+   function editAccount($subcurpass, $subnewpass, $subemail){
+      global $database, $form;  //The database and form object
+      /* New password entered */
+      if($subnewpass){
+         /* Current Password error checking */
+         $field = "curpass";  //Use field name for current password
+         if(!$subcurpass){
+            $form->setError($field, "* Current Password not entered");
+         }
+         else{
+            /* Check if password too short or is not alphanumeric */
+            $subcurpass = stripslashes($subcurpass);
+            if(strlen($subcurpass) < 4 ||
+               !eregi("^([0-9a-z])+$", ($subcurpass = trim($subcurpass)))){
+               $form->setError($field, "* Current Password incorrect");
+            }
+            /* Password entered is incorrect */
+            if($database->confirmUserPass($this->username,md5($subcurpass)) != 0){
+               $form->setError($field, "* Current Password incorrect");
+            }
+         }
+         
+         /* New Password error checking */
+         $field = "newpass";  //Use field name for new password
+         /* Spruce up password and check length*/
+         $subpass = stripslashes($subnewpass);
+         if(strlen($subnewpass) < 4){
+            $form->setError($field, "* New Password too short");
+         }
+         /* Check if password is not alphanumeric */
+         else if(!eregi("^([0-9a-z])+$", ($subnewpass = trim($subnewpass)))){
+            $form->setError($field, "* New Password not alphanumeric");
+         }
+      }
+      /* Change password attempted */
+      else if($subcurpass){
+         /* New Password error reporting */
+         $field = "newpass";  //Use field name for new password
+         $form->setError($field, "* New Password not entered");
+      }
+      
+      /* Email error checking */
+      $field = "email";  //Use field name for email
+      if($subemail && strlen($subemail = trim($subemail)) > 0){
+         /* Check if valid email address */
+         $regex = "^[_+a-z0-9-]+(\.[_+a-z0-9-]+)*"
+                 ."@[a-z0-9-]+(\.[a-z0-9-]{1,})*"
+                 ."\.([a-z]{2,}){1}$";
+         if(!eregi($regex,$subemail)){
+            $form->setError($field, "* Email invalid");
+         }
+         $subemail = stripslashes($subemail);
+      }
+      
+      /* Errors exist, have user correct them */
+      if($form->num_errors > 0){
+         return false;  //Errors with form
+      }
+      
+      /* Update password since there were no errors */
+      if($subcurpass && $subnewpass){
+         $database->updateUserField($this->username,"password",md5($subnewpass));
+      }
+      
+      /* Change Email */
+      if($subemail){
+         $database->updateUserField($this->username,"email",$subemail);
+      }
+      
+      /* Success! */
+      return true;
+   }
+   
+   /**
+    * isAdmin - Returns true if currently logged in user is
+    * an administrator, false otherwise.
+    */
+   function isAdmin(){
+      return ($this->userlevel == ADMIN_LEVEL ||
+              $this->username  == ADMIN_NAME);
+   }
+   
+   /**
+    * generateRandID - Generates a string made up of randomized
+    * letters (lower and upper case) and digits and returns
+    * the md5 hash of it to be used as a userid.
+    */
+   function generateRandID(){
+      return md5($this->generateRandStr(16));
+   }
+   
+   /**
+    * generateRandStr - Generates a string made up of randomized
+    * letters (lower and upper case) and digits, the length
+    * is a specified parameter.
+    */
+   function generateRandStr($length){
+      $randstr = "";
+      for($i=0; $i<$length; $i++){
+         $randnum = mt_rand(0,61);
+         if($randnum < 10){
+            $randstr .= chr($randnum+48);
+         }else if($randnum < 36){
+            $randstr .= chr($randnum+55);
+         }else{
+            $randstr .= chr($randnum+61);
+         }
+      }
+      return $randstr;
+   }
+};
+
+
+/**
+ * Initialize session object - This must be initialized before
+ * the form object because the form uses session variables,
+ * which cannot be accessed unless the session has started.
+ */
+$session = new Session;
+
+/* Initialize form object */
+$form = new Form;
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/tailresult.php php-syslog-ng/html/includes/tailresult.php
--- php-syslog-ng-2.9.f/html/includes/tailresult.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/tailresult.php	2008-08-13 22:46:05.000000000 -0400
@@ -0,0 +1,580 @@
+<?php
+// Copyright (C) 2001-2004 by Michael Earls, michael@michaelearls.com
+// Copyright (C) 2004-2005 Jason Taylor, j@jtaylor.ca
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+
+require_once 'includes/html_header.php';
+
+//========================================================================
+// BEGIN: GET THE INPUT VARIABLES
+//========================================================================
+$host = get_input('host', false);
+$host2 = get_input('host2', false);
+$excludeHost = get_input('excludeHost', false);
+/* BEGIN: RegExp and Program additions by BPK */
+$regexpHost = get_input('regexpHost', false);
+$program = get_input('program', false);
+$program2 = get_input('program2', false);
+$excludeProgram = get_input('excludeProgram', false);
+$regexpProgram = get_input('regexpProgram', false);
+/* END: RegExp and Program additions by BPK */
+$facility = get_input('facility', false);
+$excludeFacility = get_input('excludeFacility', false);
+$priority = get_input('priority', false);
+$excludePriority = get_input('excludePriority', false);
+$limit = get_input('limit', false);
+$table = get_input('table', false);
+
+// Set an arbitrary number of msg# and ExcludeMsg# vars
+$msgvarnum=1;
+$msgvarname="msg".$msgvarnum;
+$excmsgvarname="ExcludeMsg".$msgvarnum;
+$regexpmsgvarname="RegExpMsg".$msgvarnum;
+
+while(get_input($msgvarname, false)) {
+   	${$msgvarname} = get_input($msgvarname, false);
+   	${$excmsgvarname} = get_input($excmsgvarname, false);
+   	${$regexpmsgvarname} = get_input($regexpmsgvarname, false);
+
+	$msgvarnum++;
+   	$msgvarname="msg".$msgvarnum;
+   	$excmsgvarname="ExcludeMsg".$msgvarnum;
+   	$regexpmsgvarname="RegExpMsg".$msgvarnum;
+}
+//========================================================================
+// END: GET THE INPUT VARIABLES
+//========================================================================
+
+/* BEGIN: Added by BPK to save search form variables into the session. */
+$_SESSION['host'] = (isset($host)) ? $host : '';
+$_SESSION['host2'] = (isset($host2)) ? $host2 : '';
+$_SESSION['excludeHost'] = (isset($excludeHost)) ? $excludeHost : '';
+$_SESSION['regexpHost'] = (isset($regexpHost)) ? $regexpHost : '';
+$_SESSION['program'] = (isset($program)) ? $program : '';
+$_SESSION['program2'] = (isset($program2)) ? $program2 : '';
+$_SESSION['excludeProgram'] = (isset($excludeProgram)) ? $excludeProgram : '';
+$_SESSION['regexpProgram'] = (isset($regexpProgram)) ? $regexpProgram : '';
+$_SESSION['facility'] = (isset($facility)) ? $facility : '';
+$_SESSION['excludeFacility'] = (isset($excludeFacility)) ? $excludeFacility : '';
+$_SESSION['priority'] = (isset($priority)) ? $priority : '';
+$_SESSION['excludePriority'] = (isset($excludePriority)) ? $excludePriority : '';
+$_SESSION['date'] = (isset($date)) ? $date : '';
+$_SESSION['date2'] = (isset($date2)) ? $date2 : '';
+$_SESSION['time'] = (isset($time)) ? $time : '';
+$_SESSION['time2'] = (isset($time2)) ? $time2 : '';
+$_SESSION['limit'] = (isset($limit)) ? $limit : '';
+$_SESSION['orderby'] = (isset($orderby)) ? $orderby : '';
+$_SESSION['order'] = (isset($order)) ? $order : '';
+$_SESSION['offset'] = (isset($offset)) ? $offset : '';
+$_SESSION['collapse'] = (isset($collapse)) ? $collapse : '';
+$_SESSION['table'] = (isset($table)) ? $table : '';
+$_SESSION['topx'] = (isset($topx)) ? $topx : '';
+for ($i=1; $i<=3; $i++) {
+   	$_SESSION['msg'.$i] = (isset(${'msg'.$i})?${'msg'.$i}:'');
+   	$_SESSION['ExcludeMsg'.$i] = (isset(${'ExcludeMsg'.$i})?${'ExcludeMsg'.$i}:'');
+   	$_SESSION['RegExpMsg'.$i] = (isset(${'RegExpMsg'.$i})?${'RegExpMsg'.$i}:'');
+}
+/* END: Added by BPK to save search form variables info the session. */
+
+// Cdukes: 3/20/08 - Added below to make sure people are only tailing the default log table
+// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=57 
+if (!$table) { $table = DEFAULTLOGTABLE; }
+if ($table != DEFAULTLOGTABLE) {
+   	echo "<br>
+	   	Why would you tail $table? <br>
+	   	The only table with \"live\" data in it is \"" .DEFAULTLOGTABLE ."\"<br>
+	   	Using tail on any other table would not yeild anything useful (and would probably take a really long time). <br>
+	   	<a href=\"index.php?pageId=searchform\">BACK TO SEARCH</a>";
+   	die();
+}
+
+//========================================================================
+// BEGIN: INPUT VALIDATION
+//========================================================================
+$inputValError = array();
+
+if($excludeHost && !validate_input($excludeHost, 'excludeX')) {
+   	array_push($inputValError, "excludeHost");
+}
+if($host && !validate_input($host, 'host')) {
+   	array_push($inputValError, "host1");
+}
+/* BEGIN: RegExp and Program additions by BPK
+   if($host2 && !validate_input($host2, 'host')) {
+   array_push($inputValError, "host2");
+   }
+ */
+if($regexpHost && !validate_input($regexpHost, 'regexpX')) {
+   	array_push($inputValError, 'regexpHost');
+}
+if($host2 && (!$regexpHost && !validate_input($host2, 'host'))
+	   	|| ($regexpHost && !validate_input($host2, 'hostRegExp'))) {
+   	array_push($inputValError, 'host2');
+}
+if($excludeProgram && !validate_input($excludeProgram, 'excludeX')) {
+   	array_push($inputValError, "excludeProgram");
+}
+if($program && !validate_input($program, 'program')) {
+   	array_push($inputValError, "program1");
+}
+if($regexpProgram && !validate_input($regexpProgram, 'regexpX')) {
+   	array_push($inputValError, 'regexpProgram');
+}
+if($program2 && (!$regexpProgram && !validate_input($program2, 'program'))
+	   	|| ($regexpProgram && !validate_input($program2, 'programRegExp'))) {
+   	array_push($inputValError, 'program2');
+}
+/* END: RegExp and Program additions by BPK */
+if($excludeFacility && !validate_input($excludeFacility, 'excludeX')) {
+   	array_push($inputValError, "excludeFacility");
+}
+if($facility && !validate_input($facility, 'facility')) {
+   	array_push($inputValError, "facility");
+}
+if($excludePriority && !validate_input($excludePriority, 'excludeX')) {
+   	array_push($inputValError, "excludePriority");
+}
+if($priority && !validate_input($priority, 'priority')) {
+   	array_push($inputValError, "priority");
+}
+if($limit && !validate_input($limit, 'limit')) {
+   	array_push($inputValError, "limit");
+}
+if($table && !validate_input($table, 'table')) {
+   	array_push($inputValError, "table");
+}
+
+if($inputValError) {
+   	require_once 'includes/html_header.php';
+   	echo "Input validation error! The following fields had the wrong format:<p>";
+   	foreach($inputValError as $value) {
+	   	echo $value."<br>";
+   	}
+   	require_once 'includes/html_footer.php';
+   	exit;
+}
+//========================================================================
+// END: INPUT VALIDATION
+//========================================================================
+
+//========================================================================
+// BEGIN: BUILD AND EXECUTE SQL STATEMENT
+// AND BUILD PARAMETER LIST TO SAVE RESULT
+//========================================================================
+//------------------------------------------------------------------------
+// Create WHERE statement and GET parameter list
+//------------------------------------------------------------------------
+$where = "";
+$ParamsGET="&";
+
+if($limit) {
+   	$ParamsGET=$ParamsGET."limit=".$limit."&";
+}
+
+if($pageId) {
+   	$ParamsGET=$ParamsGET."pageId=".$pageId."&";
+}
+
+/* BEGIN: Switched by BPK to allow for host lists and regexp
+   if($host2) {
+   if ($where!="") {
+   $where=$where." and ";
+   }
+   if($excludeHost==1) {
+   $where = $where." host not like '%".$host2."%' ";
+   }
+   else {
+   $where = $where." host like '%".$host2."%' ";
+   }
+   $ParamsGET=$ParamsGET."host2=".$host2."&excludeHost=".$excludeHost."&";
+   }
+ */
+if($host2) {
+   	if ($where!="") {
+	   	$where=$where." AND ";
+   	}
+   	$clause = '';
+   	if ($regexpHost==1) {
+	   	$clause = "host RLIKE '".$host2."'";
+   	}
+   	else {
+	   	$parts = preg_split('/\s*[,;]+\s*/', $host2);
+	   	foreach ($parts as $part) {
+		   	if (empty($part)) continue;
+		   	$clause .= ($clause!='') ? ' OR ' : '';
+		   	$clause .= "host LIKE '%${part}%'";
+	   	}
+   	}
+   	$where .= (($excludeHost==1) ? 'NOT ' : '')."($clause)";
+   	$ParamsGET=$ParamsGET."host2=".$host2."&excludeHost=".$excludeHost.
+	  	"&regexpHost=".$regexpHost."&";
+}
+/* END: Switched by BPK to allow for host lists, programs, and regexp */
+
+if($host) {
+   	$hostGET=implode("&host[]=",$host);
+   	$hostSQL=implode("','",$host);
+   	if($where!="") {
+	   	$where = $where." and ";
+   	}
+   	if($excludeHost==1) {
+	   	$where = $where." host not in ('".$hostSQL."') ";
+   	}
+   	else {
+	   	$where = $where." host in ('".$hostSQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."host[]=".$hostGET."&excludeHost=".$excludeHost."&";
+}
+
+/* BEGIN: Added by BPK to allow for program lists and regexp */
+if($program2) {
+   	if ($where!="") {
+	   	$where=$where." AND ";
+   	}
+   	$clause = '';
+   	if ($regexpProgram==1) {
+	   	$clause = "program RLIKE '".$program2."'";
+   	}
+   	else {
+	   	$parts = preg_split('/\s*[,;]+\s*/', $program2);
+	   	foreach ($parts as $part) {
+		   	if (empty($part)) continue;
+		   	$clause .= ($clause!='') ? ' OR ' : '';
+		   	$clause .= "program LIKE '%${part}%'";
+	   	}
+   	}
+   	$where .= (($excludeProgram==1) ? 'NOT ' : '')."($clause)";
+   	$ParamsGET=$ParamsGET."program2=".$program2."&excludeProgram=".$excludeProgram.
+	  	"&regexpProgram=".$regexpProgram."&";
+}
+
+if($program) {
+   	$programGET=implode("&program[]=",$program);
+   	$programSQL=implode("','",$program);
+   	if($where!="") {
+	   	$where = $where." AND ";
+   	}
+   	if($excludeProgram==1) {
+	   	$where = $where." program NOT IN ('".$programSQL."') ";
+   	}
+   	else {
+	   	$where = $where." program IN ('".$programSQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."program[]=".$programGET."&excludeProgram=".$excludeProgram."&";
+}
+/* END: Added by BPK to allow for program lists and regexp */
+
+if($facility) {
+   	$facilityGET=implode("&facility[]=",$facility);
+   	$facilitySQL=implode("','",$facility);
+   	if($where!="") {
+	   	$where = $where." and ";
+   	}
+   	if($excludeFacility==1) {
+	   	$where = $where." facility not in ('".$facilitySQL."') ";
+   	}
+   	else {
+	   	$where = $where." facility in ('".$facilitySQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."facility[]=".$facilityGET."&excludeFacility=".$excludeFacility."&";
+}
+
+if($priority) {
+   	$priorityGET=implode("&priority[]=",$priority);
+   	$prioritySQL=implode("','",$priority);
+   	if($where!="") {
+	   	$where = $where." and ";
+   	}
+   	if($excludePriority==1) {
+	   	$where = $where." priority not in ('".$prioritySQL."') ";
+   	}
+   	else {
+	   	$where = $where." priority in ('".$prioritySQL."') ";
+   	}
+   	$ParamsGET=$ParamsGET."priority[]=".$priorityGET."&excludePriority=".$excludePriority."&";
+}
+
+$msgvarnum=1;
+$msgvarname="msg".$msgvarnum;
+$excmsgvarname="ExcludeMsg".$msgvarnum;
+$regexpmsgvarname="RegExpMsg".$msgvarnum;
+
+/** BEGIN: Switched by BPK to allow from regexp
+  while(isset(${$msgvarname})) {
+  if($where !="") {
+  $where = $where." and ";
+  }
+  if(${$excmsgvarname} == "on") {
+  $where = $where." msg not like '%".${$msgvarname}."%' ";
+  $ParamsGET=$ParamsGET.$excmsgvarname."=".${$excmsgvarname}."&";
+  }
+  else {
+  $where = $where." msg like '%".${$msgvarname}."%' ";
+  }
+  $ParamsGET=$ParamsGET.$msgvarname."=".${$msgvarname}."&";
+  $msgvarnum++;
+  $msgvarname="msg".$msgvarnum;
+  $excmsgvarname="ExcludeMsg".$msgvarnum;
+  }
+ */
+while(isset(${$msgvarname})) {
+   	if($where !="") {
+	   	$where = $where." AND ";
+   	}
+   	$where .= 'msg ';
+   	if(${$excmsgvarname} == "on") {
+	   	$where .= 'NOT ';
+	   	$ParamsGET = $ParamsGET.$excmsgvarname."=".${$excmsgvarname}."&";
+   	}
+   	if(${$regexpmsgvarname} == "on") {
+	   	$where .= "RLIKE '".${$msgvarname}."' ";
+	   	$ParamsGET = $ParamsGET.$regexpmsgvarname."=".${$regexpmsgvarname}."&";
+   	}
+   	else {
+	   	$where .= "LIKE '%".${$msgvarname}."%' ";
+   	}
+   	$ParamsGET=$ParamsGET.$msgvarname."=".${$msgvarname}."&";
+   	$msgvarnum++;
+   	$msgvarname="msg".$msgvarnum;
+   	$excmsgvarname="ExcludeMsg".$msgvarnum;
+   	$regexpmsgvarname = "RegExpMsg".$msgvarnum;
+}
+/** END: Switched by BPK to allow from regexp */
+
+//------------------------------------------------------------------------
+// Create the GET string without host variables
+//------------------------------------------------------------------------
+$pieces = explode("&", $ParamsGET);
+$hostParamsGET = "";
+foreach($pieces as $value) {
+   	if(!strstr($value, "host[]=") && !strstr($value, 'excludeHost=') && !strstr($value, 'regexpHost=') && !strstr($value, 'offset=') && $value) {
+	   	$hostParamsGET = $hostParamsGET.$value."&";
+   	}
+}
+
+/* BEGIN: added by BPK to create GET string without facility, program, variables */
+$pieces = explode("&", $ParamsGET);
+$programParamsGET = "";
+foreach($pieces as $value) {
+   	if(!strstr($value, "program[]=") && !strstr($value, 'excludeProgram=') && !strstr($value, 'regexpProgram=') && !strstr($value, 'offset=') && $value) {
+	   	$programParamsGET = $programParamsGET.$value."&";
+   	}
+}
+
+$pieces = explode("&", $ParamsGET);
+$facilityParamsGET = "";
+foreach($pieces as $value) {
+   	if(!strstr($value, "facility[]=") && !strstr($value, 'excludeFacility=') && !strstr($value, 'offset=') && $value) {
+	   	$facilityParamsGET = $facilityParamsGET.$value."&";
+   	}
+}
+/* END: added by BPK to create GET string without facility, program, variables variables */
+
+//------------------------------------------------------------------------
+// Create the complete SQL statement
+//------------------------------------------------------------------------
+if($table) {
+   	$srcTable = $table;
+}
+else {
+   	$srcTable = DEFAULTLOGTABLE;
+}
+
+$query = "SELECT * FROM ".$srcTable." JOIN (select seq from ".$srcTable." FORCE INDEX(PRIMARY) ";
+
+if($where !="") {
+   	$query = $query."WHERE ".$where." ORDER BY seq DESC LIMIT ".$limit;
+}
+else {
+   	$query = $query."ORDER BY seq DESC LIMIT ".$limit;
+}
+
+$query = $query.") as sub USING(seq)";
+
+
+//------------------------------------------------------------------------
+// Execute the query
+//------------------------------------------------------------------------
+$results = perform_query($query, $dbLink);
+
+//========================================================================
+// END: BUILD AND EXECUTE SQL STATEMENT
+// AND BUILD PARAMETER LIST TO SAVE RESULT
+//========================================================================
+
+
+//========================================================================
+// BEGIN: BUILDING THE HTML PAGE
+//========================================================================
+// Print result sub-header
+require_once 'includes/html_result_subheader.php';
+
+//------------------------------------------------------------------------
+// Refresh time = 3 times exe time to this point + 15 seconds
+//------------------------------------------------------------------------
+$curExeTime = get_microtime() - $time_start;
+$refreshTime = round(3*$curExeTime) + TAIL_REFRESH_SECONDS;
+echo "<META HTTP-EQUIV=REFRESH CONTENT=".$refreshTime.">";
+
+?>
+<table>
+<tr>
+<td class="resultsheader">HOST</td>
+<td class="resultsheader">FACILITY</td>
+<td class="resultsheader">TIME</td>
+<td class="resultsheader">PROGRAM</td>
+<td class="resultsheader">MESSAGE</td>
+</tr>
+<?php
+//------------------------------------------------------------------------
+// Output the table with the results
+// Use an alternating background and color code the priority column
+//------------------------------------------------------------------------
+if(CEMDB == "ON") {
+   	require_once 'includes/CEMDB.class.php';
+   	$cemdb = new CEMDB($dbLink);
+}
+
+$color = "lighter";
+$today = date('Y-m-d');
+while($row = fetch_array($results)) {
+   	if($color == "darker") {
+	   	$color = "lighter";
+   	}
+   	else {
+	   	$color = "darker";
+   	}
+   	echo "<tr class=\"$color\">";
+   	echo "<td><a href=\"".$_SERVER["PHP_SELF"]."?excludeHost=0&host[]=".$row['host']."&".$hostParamsGET."\">";
+   	echo $row['host']."</a></td>";
+
+	/* BEGIN: Switched by BPK to allow filtering based on facility
+	   if($row['priority'] == "debug") {
+	   echo "<td class=\"sev0\">".$row['facility']."</td>";
+	   }
+	   elseif($row['priority'] == "info") {
+	   echo "<td class=\"sev1\">".$row['facility']."</td>";
+	   }
+	   elseif($row['priority'] == "notice") {
+	   echo "<td class=\"sev2\">".$row['facility']."</td>";
+	   }
+	   elseif($row['priority'] == "warning") {
+	   echo "<td class=\"sev3\">".$row['facility']."</td>";
+	   }
+	   elseif ($row['priority'] == "err") {
+	   echo "<td class=\"sev4\">".$row['facility']."</td>";
+	   }
+	   elseif ($row['priority'] == "crit") {
+	   echo "<td class=\"sev5\">".$row['facility']."</td>";
+	   }
+	   elseif ($row['priority'] == "alert") {
+	   echo "<td class=\"sev6\">".$row['facility']."</td>";
+	   }
+	   elseif ($row['priority'] == "emerg") {
+	   echo "<td class=\"sev7\">".$row['facility']."</td>";
+	   }
+	 */
+   	echo "<td class=\"";
+   	switch ($row['priority']) {
+	   	case 'debug':
+		   	echo 'sev0';
+		   	break;
+	   	case 'info':
+		   	echo 'sev1';
+		   	break;
+	   	case 'notice':
+		   	echo 'sev2';
+		   	break;
+	   	case 'warning':
+		   	echo 'sev3';
+		   	break;
+	   	case 'err':
+		   	echo 'sev4';
+		   	break;
+	   	case 'crit':
+		   	echo 'sev5';
+		   	break;
+	   	case 'alert':
+		   	echo 'sev6';
+		   	break;
+	   	case 'emerg':
+		   	echo 'sev7';
+		   	break;
+   	}
+   	echo "\"><a href=\"".$_SERVER['PHP_SELF']."?excludeFacility=0&facility[]=".$row['facility']."&".$facilityParamsGET."\">";
+   	echo $row['facility']."</a></td>\n";
+   	/* END: Switched by BPK to allow filtering based on facility */
+
+	// Extract just the time from the timestamp
+   	$pieces = explode(" ", $row['datetime']);
+   	/* BEGIN: BPK - Some queries can extend multiple days, display the one's not equal to today
+	   echo "<td>$pieces[1]</td>";
+	 */
+   	echo '<td>';
+   	if ($pieces[0]!=$today) {
+	   	echo $pieces[0]."&nbsp;";
+	   	// die("Piece 0: " .$pieces[0] ."Today: $today");
+   	}
+   	echo $pieces[1];
+   	echo "</td>\n";
+   	/* END: BPK - Some queries can extend multiple days, display the one's not equal to today */
+   	echo '<td>';
+   	$program = htmlspecialchars($row['program']);
+   	if (!empty($program)) {
+	   	$pattern = '/^'.addcslashes($program, '.()[]/\\').'/';
+	   	$replacement = '<a href="'.$_SERVER['PHP_SELF'].'?excludeProgram=0&program[]='.$program.'&'.$programParamsGET.'">'.$program.'</a>';
+	   	$program = preg_replace($pattern, $replacement, $program);
+   	}
+   	echo $program;
+   	echo "</td>\n";
+
+	/* BEGIN: CEMDB Mod */
+   	// Added below to remove whitespace between delimiters (% and :)
+   	// example:
+   	// "%SYS-5-CONFIG :" is now
+   	// "%SYS-5-CONFIG:"
+   	$row['msg'] = preg_replace('/\s:/', ':', $row['msg']);
+
+	// Grab Mnemonic name and Message and leave out the stuff at the front
+   	$row['msg'] = preg_replace('/.*(%.*?:.*)/', '$1', $row['msg']);
+   	// Original message:
+   	// 3852752: DRP/0/0/CPU0:Feb 4 20:12:36.098 EST5: SSHD_[65697]: %SECURITY-SSHD-3-ERR_GENERAL: Failed to get DSA public key
+   	// New message using regex above: .*(%.*?:.*):
+   	// SSHD_[65697]: %SECURITY-SSHD-3-ERR_GENERAL: Failed to get DSA public key
+   	$printed = false;
+   	if (CEMDB == "ON") {
+	   	$data = $cemdb->lookup($row['msg']);
+	   	if($data !== false) {
+		   	$info  =     "<b>Name:</b>"                    . $data[0];
+		   	$info .= "<br><b>Message:</b> "                . $data[1];
+		   	$info .= "<br><b>Explanation:</b> "            . $data[2];
+		   	$info .= "<br><b>Action:</b> "                 . $data[3];
+		   	$info .= "<br><b>Record last updated on:</b> " . $data[4];
+		   	$info = str_replace("\n", "", $info);
+		   	$info = htmlentities($info);
+		   	$msg = (($row['count'] > 1) ? '<b>'.$row['count'].' *</b> ' : '') . htmlspecialchars($row['msg']);
+		   	?>				<th  align="left"><A href="#" onmouseover="overlib('<TABLE border=1 cellspacing=0 cellpadding=0 width=100%><TR><TD class=tooltip><?php echo $info?></TD></TR></TABLE>');" onmouseout=nd(); name ="spacer" ><?php echo $msg;?></A></th>
+			   	<?php			$printed = true;
+	   	}
+
+	} 
+	// Moved this to else outside the CEMDB loop so it would print when CEMDB was disabled
+   	// REF: http://code.google.com/p/php-syslog-ng/issues/detail?id=68
+   	if (!$printed) { 
+		// if CEMDB off or row wasn't found, print it
+	   	// this will prevent unnecessary popups and allow filtering via a link
+	   	$msg = htmlspecialchars($row['msg']);
+	   	echo "<td>";
+	   	if ($row['count'] > 1) echo '<b>'.$row['count'].' *</b> ';
+	   	echo "$msg</td>\n";
+   	}
+   	/* END: CEMDB Mod */
+
+	echo    "</tr>\n";
+}
+echo "</table>\n";
+
+//========================================================================
+// END: BUILDING THE HTML PAGE
+//========================================================================
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/version.php php-syslog-ng/html/includes/version.php
--- php-syslog-ng-2.9.f/html/includes/version.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/version.php	2008-08-09 17:50:58.000000000 -0400
@@ -0,0 +1,48 @@
+<?php
+/*
+ * version.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2006 http://www.gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2006-06-14 - created
+ *
+ */
+
+/* $Platon$ */
+
+/* Modeline for ViM {{{
+ * vim: set ts=4:
+ * vim600: fdm=marker fdl=0 fdc=0:
+ * }}} */
+
+/** Version information */
+class version {
+        /** @var string Product */
+        var $PRODUCT = 'Php-Syslog-NG';
+        /** @var int Main Release Level */
+        var $RELEASE = '2.9';
+        /** @var string Development Status */
+        var $DEV_STATUS = 'Pretty Stable';
+        /** @var int Sub Release Level */
+        var $DEV_LEVEL = '8e';
+        /** @var string Codename */
+        var $CODENAME = 'cdukes';
+        /** @var string Date */
+        var $RELDATE = '09-Aug-2008';
+        /** @var string Time */
+        var $RELTIME = '17:56';
+        /** @var string Timezone */
+        var $RELTZ = 'EST';
+        /** @var string Copyright Text */
+        var $COPYRIGHT = 'Copyright 2008 -  All rights reserved.';
+        /** @var string URL */
+        var $URL = '<a href="http://php-syslog-ng.gdd.net">Php-Syslog-NG</a> is Free Software released under the GNU/GPL License.';
+}
+$_VERSION =& new version();
+
+$version = $_VERSION->PRODUCT .' '. $_VERSION->RELEASE .'.'. $_VERSION->DEV_LEVEL .' ' . $_VERSION->DEV_STATUS .' [ '.$_VERSION->CODENAME .' ] '. $_VERSION->RELDATE .' ' . $_VERSION->RELTIME .' '. $_VERSION->RELTZ;
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/includes/view_active.php php-syslog-ng/html/includes/view_active.php
--- php-syslog-ng-2.9.f/html/includes/view_active.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/includes/view_active.php	2007-09-10 20:54:28.000000000 -0400
@@ -0,0 +1,25 @@
+<?
+if(!defined('TBL_ACTIVE_USERS')) {
+  die("Error processing page");
+}
+
+$q = "SELECT username FROM ".TBL_ACTIVE_USERS
+    ." ORDER BY timestamp DESC,username";
+$result = $database->query($q);
+/* Error occurred, return given name by default */
+$num_rows = mysql_numrows($result);
+if(!$result || ($num_rows < 0)){
+   echo "Error displaying info";
+}
+else if($num_rows > 0){
+   /* Display active users, with link to their info */
+   echo "<table align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"3\">\n";
+   echo "<tr><td><font size=\"2\">\n";
+   for($i=0; $i<$num_rows; $i++){
+      $uname = mysql_result($result,$i,"username");
+
+      echo "<a href=\"userinfo.php?user=$uname\">$uname</a> / ";
+   }
+   echo "</font></td></tr></table><br>\n";
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/index.php php-syslog-ng/html/index.php
--- php-syslog-ng-2.9.f/html/index.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/index.php	2008-05-10 15:34:54.000000000 -0400
@@ -0,0 +1,96 @@
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (C) 2006 Clayton Dukes, cdukes@cdukes.com
+
+// Check to see if config.php is set, if not we need to run the installer.
+$chk_config = file_get_contents("config/config.php");
+if (strlen($chk_config) < 10) {
+   	header('Location: install/');
+} else {
+   	require_once ("config/config.php");
+   	require_once 'includes/common_funcs.php';
+}
+
+
+
+// Added below for v2.9.4 (LDAP)
+// session handler
+session_start();
+// Secure this page
+secure();
+
+$time_start = get_microtime();
+
+//------------------------------------------------------------------------
+// Determine what page is being requested
+//------------------------------------------------------------------------
+$pageId = get_input('pageId');
+if (!$pageId) { $pageId = "login"; }
+if(!validate_input($pageId, 'pageId')) {
+	echo "Error on pageId validation! <br>Check your regExpArray in config.php!\n";
+   	$pageId = "login";
+}
+
+//------------------------------------------------------------------------
+// Connect to database. If connection fails then set the pageId for the
+// help page.
+//------------------------------------------------------------------------
+$dbProblem = FALSE;
+if(!$dbLink = db_connect_syslog(DBUSER, DBUSERPW)) {
+   	$pageId = "help";
+   	$dbProblem = TRUE;
+}
+
+
+//------------------------------------------------------------------------
+// Load page
+//------------------------------------------------------------------------
+if(strcasecmp($pageId, "searchform") == 0) {
+	$addTitle = "SEARCH";
+	require 'includes/search.php';
+}
+elseif(strcasecmp($pageId, "login") == 0) {
+	$addTitle = "LOGIN";
+	require 'login.php';
+}
+elseif(strcasecmp($pageId, "logout") == 0) {
+	$addTitle = "LOGOUT";
+	require 'logout.php';
+}
+elseif(strcasecmp($pageId, "about") == 0) {
+	$addTitle = "ABOUT";
+	require 'includes/about.php';
+}
+elseif(strcasecmp($pageId, "help") == 0) {
+	$addTitle = "HELP";
+	require 'includes/help.php';
+}
+elseif(strcasecmp($pageId, "config") == 0) {
+	$addTitle = "CONFIG";
+	require 'includes/configure.php';
+}
+elseif(strcasecmp($pageId, "Tail") == 0) {
+	// custom title for tail queries 
+	// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=33
+   	if ($_REQUEST['title'] == '') {
+	   	$addTitle = "TAIL RESULTS";
+   	}
+   	else {
+	   	$addTitle = $_REQUEST['title'];
+   	}
+	require 'includes/tailresult.php';
+}
+elseif(strcasecmp($pageId, "Graph") == 0) {
+	$addTitle = "GRAPH RESULTS";
+	require 'includes/graphit.php';
+}
+elseif(strcasecmp($pageId, "search") == 0) {
+	$addTitle = "REGULAR RESULTS";
+	require 'includes/regularresult.php';
+}
+else {
+	$addTitle = "SEARCH";
+	require 'includes/search.php';
+}
+require_once 'includes/html_footer.php';
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/cemdb/bdimport.php php-syslog-ng/html/install/cemdb/bdimport.php
--- php-syslog-ng-2.9.f/html/install/cemdb/bdimport.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/cemdb/bdimport.php	2008-02-04 15:53:17.000000000 -0500
@@ -0,0 +1,1047 @@
+<?php
+
+// cdukes - most of this came from the Bigdump script, I just modified it for use in the
+// Php-Syslog-NG installation.
+
+// Original bigdump info follows:
+
+// BigDump ver. 0.29b from 2008-01-19
+// Staggered import of an large MySQL Dump (like phpMyAdmin 2.x Dump)
+// Even through the webservers with hard runtime limit and those in safe mode
+// Works fine with Internet Explorer 7.0 and Firefox 2.x
+
+// Author:       Alexey Ozerov (alexey at ozerov dot de) 
+//               AJAX & CSV functionalities: Krzysiek Herod (kr81uni at wp dot pl) 
+// Copyright:    GPL (C) 2003-2008
+// More Infos:   http://www.ozerov.de/bigdump.php
+
+// This program is free software; you can redistribute it and/or modify it under the
+// terms of the GNU General Public License as published by the Free Software Foundation;
+// either version 2 of the License, or (at your option) any later version.
+
+// THIS SCRIPT IS PROVIDED AS IS, WITHOUT ANY WARRANTY OR GUARANTEE OF ANY KIND
+
+// USAGE
+
+// 1. Adjust the database configuration in this file
+// 2. Remove the old tables on the target database if your dump doesn't contain "DROP TABLE"
+// 3. Create the working directory (e.g. dump) on your web server
+// 4. Upload bigdump.php and your dump files (.sql, .gz) via FTP to the working directory
+// 5. Run the bigdump.php from your browser via URL like http://www.yourdomain.com/dump/bigdump.php
+// 6. BigDump can start the next import session automatically if you enable the JavaScript
+// 7. Wait for the script to finish, do not close the browser window
+// 8. IMPORTANT: Remove bigdump.php and your dump files from the web server
+
+// If Timeout errors still occure you may need to adjust the $linepersession setting in this file
+
+// LAST CHANGES
+
+// *** Accurate current directory detection
+// *** Accurate filename handling and urlencode in URLs
+// *** Add Paypal button
+
+ $basePath = dirname( __FILE__ );
+ require_once($basePath . '/../../config/config.php' );
+// Database configuration
+$db_server   = DBHOST;
+$db_name     = DBNAME;
+$db_username = DBADMIN;
+$db_password = DBADMINPW;
+//die("Setttings:" .$db_server);
+
+// Other settings (optional)
+
+$filename         = '../sql/cemdb.sql.gz';     // Specify the dump filename to suppress the file selection dialog
+$csv_insert_table = 'cemdb';     // Destination table for CSV files
+$ajax             = true;   // AJAX mode: import will be done without refreshing the website
+$linespersession  = 3000;   // Lines to be executed per one import session
+$delaypersession  = 0;      // You can specify a sleep time in milliseconds after each session
+                            // Works only if JavaScript is activated. Use to reduce server overrun
+
+// Allowed comment delimiters: lines starting with these strings will be dropped by BigDump
+
+$comment[]='#';                       // Standard comment lines are dropped by default
+$comment[]='-- ';
+// $comment[]='---';                  // Uncomment this line if using proprietary dump created by outdated mysqldump
+// $comment[]='CREATE DATABASE';      // Uncomment this line if your dump contains create database queries in order to ignore them
+// $comment[]='/*!';                  // Or add your own string to leave out other proprietary things
+
+
+
+// Connection character set should be the same as the dump file character set (utf8, latin1, cp1251, koi8r etc.)
+// See http://dev.mysql.com/doc/refman/5.0/en/charset-charsets.html for the full list
+
+$db_connection_charset = '';
+
+
+// *******************************************************************************************
+// If not familiar with PHP please don't change anything below this line
+// *******************************************************************************************
+
+if ($ajax)
+  ob_start();
+
+// define ('VERSION','0.29b');
+define ('DATA_CHUNK_LENGTH',16384);  // How many chars are read per time
+define ('MAX_QUERY_LINES',300);      // How many lines may be considered to be one query (except text lines)
+define ('TESTMODE',false);           // Set to true to process the file without actually accessing the database
+
+header("Expires: Mon, 1 Dec 2003 01:00:00 GMT");
+header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
+header("Cache-Control: no-store, no-cache, must-revalidate");
+header("Cache-Control: post-check=0, pre-check=0", false);
+header("Pragma: no-cache");
+
+@ini_set('auto_detect_line_endings', true);
+@set_time_limit(0);
+
+// Clean and strip anything we don't want from user's input [0.27b]
+
+foreach ($_REQUEST as $key => $val) 
+{
+  $val = preg_replace("/[^_A-Za-z0-9-\.&= ]/i",'', $val);
+  $_REQUEST[$key] = $val;
+}
+
+?>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<html>
+<head>
+<title>CEMDB Import</title>
+<meta http-equiv="CONTENT-TYPE" content="text/html; charset=iso-8859-1"/>
+<meta http-equiv="CONTENT-LANGUAGE" content="EN"/>
+
+<meta http-equiv="Cache-Control" content="no-cache/"/>
+<meta http-equiv="Pragma" content="no-cache"/>
+<meta http-equiv="Expires" content="-1"/>
+
+<style type="text/css">
+<!--
+
+body
+{ background-color:#FFFFF0;
+}
+
+h1 
+{ font-size:20px;
+line-height:24px;
+font-family:Arial,Helvetica,sans-serif;
+margin-top:5px;
+margin-bottom:5px;
+}
+
+p,td,th
+{ font-size:14px;
+line-height:18px;
+font-family:Arial,Helvetica,sans-serif;
+margin-top:5px;
+margin-bottom:5px;
+text-align:justify;
+vertical-align:top;
+}
+
+p.centr
+{ 
+text-align:center;
+}
+
+p.smlcentr
+{ font-size:10px;
+line-height:14px;
+text-align:center;
+}
+
+p.error
+{ color:#FF0000;
+font-weight:bold;
+}
+
+p.success
+{ color:#00DD00;
+font-weight:bold;
+}
+
+p.successcentr
+{ color:#00DD00;
+background-color:#DDDDFF;
+font-weight:bold;
+text-align:center;
+}
+
+td
+{ background-color:#F8F8F8;
+text-align:left;
+}
+
+td.transparent
+{ background-color:#FFFFF0;
+}
+
+th
+{ font-weight:bold;
+color:#FFFFFF;
+background-color:#AAAAEE;
+text-align:left;
+}
+
+td.right
+{ text-align:right;
+}
+
+form
+{ margin-top:5px;
+margin-bottom:5px;
+}
+
+div.skin1
+{
+border-color:#3333EE;
+border-width:5px;
+border-style:solid;
+background-color:#AAAAEE;
+text-align:center;
+vertical-align:middle;
+padding:3px;
+margin:1px;
+}
+
+td.bg3
+{ background-color:#EEEE99;
+text-align:left;
+vertical-align:top;
+width:20%;
+}
+
+th.bg4
+{ background-color:#EEAA55;
+text-align:left;
+vertical-align:top;
+width:20%;
+}
+
+td.bgpctbar
+{ background-color:#EEEEAA;
+text-align:left;
+vertical-align:middle;
+width:80%;
+}
+
+-->
+</style>
+
+</head>
+
+<body>
+
+<center>
+
+<table width="780" cellspacing="0" cellpadding="0">
+<tr><td class="transparent">
+
+<!-- <h1>CEMDB: MySQL Dump Importer</h1> -->
+
+<?php
+
+function skin_open() {
+echo ('<div class="skin1">');
+}
+
+function skin_close() {
+echo ('</div>');
+}
+
+skin_open();
+echo ('<h1>CEMDB: MySQL Dump Import</h1>');
+skin_close();
+
+$error = false;
+$file  = false;
+
+// Check PHP version
+
+if (!$error && !function_exists('version_compare'))
+{ echo ("<p class=\"error\">PHP version 4.1.0 is required for BigDump to proceed. You have PHP ".phpversion()." installed. Sorry!</p>\n");
+  $error=true;
+}
+
+// Calculate PHP max upload size (handle settings like 10M or 100K)
+
+if (!$error)
+{ $upload_max_filesize=ini_get("upload_max_filesize");
+  if (eregi("([0-9]+)K",$upload_max_filesize,$tempregs)) $upload_max_filesize=$tempregs[1]*1024;
+  if (eregi("([0-9]+)M",$upload_max_filesize,$tempregs)) $upload_max_filesize=$tempregs[1]*1024*1024;
+  if (eregi("([0-9]+)G",$upload_max_filesize,$tempregs)) $upload_max_filesize=$tempregs[1]*1024*1024*1024;
+}
+
+// Get the current directory
+
+if (isset($_SERVER["CGIA"]))
+  $upload_dir=dirname($_SERVER["CGIA"]);
+else if (isset($_SERVER["ORIG_PATH_TRANSLATED"]))
+  $upload_dir=dirname($_SERVER["ORIG_PATH_TRANSLATED"]);
+else if (isset($_SERVER["ORIG_SCRIPT_FILENAME"]))
+  $upload_dir=dirname($_SERVER["ORIG_SCRIPT_FILENAME"]);
+else if (isset($_SERVER["PATH_TRANSLATED"]))
+  $upload_dir=dirname($_SERVER["PATH_TRANSLATED"]);
+else 
+  $upload_dir=dirname($_SERVER["SCRIPT_FILENAME"]);
+
+// Handle file upload
+
+if (!$error && isset($_REQUEST["uploadbutton"]))
+{ if (is_uploaded_file($_FILES["dumpfile"]["tmp_name"]) && ($_FILES["dumpfile"]["error"])==0)
+  { 
+    $uploaded_filename=str_replace(" ","_",$_FILES["dumpfile"]["name"]);
+    $uploaded_filename=preg_replace("/[^_A-Za-z0-9-\.]/i",'',$uploaded_filename);
+    $uploaded_filepath=str_replace("\\","/",$upload_dir."/".$uploaded_filename);
+
+    if (file_exists($uploaded_filename))
+    { echo ("<p class=\"error\">File $uploaded_filename already exist! Delete and upload again!</p>\n");
+    }
+    else if (!eregi("(\.(sql|gz|csv))$",$uploaded_filename))
+    { echo ("<p class=\"error\">You may only upload .sql .gz or .csv files.</p>\n");
+    }
+    else if (!@move_uploaded_file($_FILES["dumpfile"]["tmp_name"],$uploaded_filepath))
+    { echo ("<p class=\"error\">Error moving uploaded file ".$_FILES["dumpfile"]["tmp_name"]." to the $uploaded_filepath</p>\n");
+      echo ("<p>Check the directory permissions for $upload_dir (must be 777)!</p>\n");
+    }
+    else
+    { echo ("<p class=\"success\">Uploaded file saved as $uploaded_filename</p>\n");
+    }
+  }
+  else
+  { echo ("<p class=\"error\">Error uploading file ".$_FILES["dumpfile"]["name"]."</p>\n");
+  }
+}
+
+
+// Handle file deletion (delete only in the current directory for security reasons)
+
+if (!$error && isset($_REQUEST["delete"]) && $_REQUEST["delete"]!=basename($_SERVER["SCRIPT_FILENAME"]))
+{ if (eregi("(\.(sql|gz|csv))$",$_REQUEST["delete"]) && @unlink(basename($_REQUEST["delete"])))
+    echo ("<p class=\"success\">".$_REQUEST["delete"]." was removed successfully</p>\n");
+  else
+    echo ("<p class=\"error\">Can't remove ".$_REQUEST["delete"]."</p>\n");
+}
+
+
+// Connect to the database
+
+if (!$error && !TESTMODE)
+{ $dbconnection = @mysql_connect($db_server,$db_username,$db_password);
+  if ($dbconnection) 
+    $db = mysql_select_db($db_name);
+  if (!$dbconnection || !$db) 
+  { echo ("<p class=\"error\">Database connection failed due to ".mysql_error()."</p>\n");
+    echo ("<p>Edit the database settings in ".$_SERVER["SCRIPT_FILENAME"]." or contact your database provider</p>\n");
+    $error=true;
+  }
+  if (!$error && $db_connection_charset!=='')
+    @mysql_query("SET NAMES $db_connection_charset", $dbconnection);
+}
+else
+{ $dbconnection = false;
+}
+
+
+// List uploaded files in multifile mode
+
+if (!$error && !isset($_REQUEST["fn"]) && $filename=="")
+{ if ($dirhandle = opendir($upload_dir)) 
+  { $dirhead=false;
+    while (false !== ($dirfile = readdir($dirhandle)))
+    { if ($dirfile != "." && $dirfile != ".." && $dirfile!=basename($_SERVER["SCRIPT_FILENAME"]))
+      { if (!$dirhead)
+        { echo ("<table width=\"100%\" cellspacing=\"2\" cellpadding=\"2\">\n");
+          echo ("<tr><th>Filename</th><th>Size</th><th>Date&amp;Time</th><th>Type</th><th>&nbsp;</th><th>&nbsp;</th>\n");
+          $dirhead=true;
+        }
+        echo ("<tr><td>$dirfile</td><td class=\"right\">".filesize($dirfile)."</td><td>".date ("Y-m-d H:i:s", filemtime($dirfile))."</td>");
+
+        if (eregi("\.sql$",$dirfile))
+          echo ("<td>SQL</td>");
+        elseif (eregi("\.gz$",$dirfile))
+          echo ("<td>GZip</td>");
+        elseif (eregi("\.csv$",$dirfile))
+          echo ("<td>CSV</td>");
+        else
+          echo ("<td>Misc</td>");
+
+        if ((eregi("\.gz$",$dirfile) && function_exists("gzopen")) || eregi("\.sql$",$dirfile) || eregi("\.csv$",$dirfile))
+          echo ("<td><a href=\"".$_SERVER["PHP_SELF"]."?start=1&amp;fn=".urlencode($dirfile)."&amp;foffset=0&amp;totalqueries=0\">Start Import</a> into $db_name at $db_server</td>\n <td><a href=\"".$_SERVER["PHP_SELF"]."?delete=".urlencode($dirfile)."\">Delete file</a></td></tr>\n");
+        else
+          echo ("<td>&nbsp;</td>\n <td>&nbsp;</td></tr>\n");
+      }
+
+    }
+    if ($dirhead) echo ("</table>\n");
+    else echo ("<p>No uploaded files found in the working directory</p>\n");
+    closedir($dirhandle); 
+  }
+  else
+  { echo ("<p class=\"error\">Error listing directory $upload_dir</p>\n");
+    $error=true;
+  }
+}
+
+
+// Single file mode
+
+if (!$error && !isset ($_REQUEST["fn"]) && $filename!="")
+{ echo ("<p><center><h3><a href=\"".$_SERVER["PHP_SELF"]."?start=1&amp;fn=".urlencode($filename)."&amp;foffset=0&amp;totalqueries=0\">Start Import</a> of CEMDB data into $db_name at $db_server</p></center></h3>\n");
+}
+
+
+// File Upload Form
+
+if (!$error && !isset($_REQUEST["fn"]) && $filename=="")
+{ 
+
+// Test permissions on working directory
+
+  do { $tempfilename=time().".tmp"; } while (file_exists($tempfilename));
+  if (!($tempfile=@fopen($tempfilename,"w")))
+  { echo ("<p>Upload form disabled. Permissions for the working directory <i>$upload_dir</i> <b>must be set to 777</b> in order ");
+    echo ("to upload files from here. Alternatively you can upload your dump files via FTP.</p>\n");
+  }
+  else
+  { fclose($tempfile);
+    unlink ($tempfilename);
+ 
+    echo ("<p>You can now upload your dump file up to $upload_max_filesize bytes (".round ($upload_max_filesize/1024/1024)." Mbytes)  ");
+    echo ("directly from your browser to the server. Alternatively you can upload your dump files of any size via FTP.</p>\n");
+?>
+<form method="POST" action="<?php echo ($_SERVER["PHP_SELF"]); ?>" enctype="multipart/form-data">
+<input type="hidden" name="MAX_FILE_SIZE" value="$upload_max_filesize">
+<p>Dump file: <input type="file" name="dumpfile" accept="*/*" size=60"></p>
+<p><input type="submit" name="uploadbutton" value="Upload"></p>
+</form>
+<?php
+  }
+}
+
+// Print the current mySQL connection charset
+
+if (!$error && !TESTMODE && !isset($_REQUEST["fn"]))
+{ 
+  $result = mysql_query("SHOW VARIABLES LIKE 'character_set_connection';");
+  $row = mysql_fetch_assoc($result);
+  if ($row) 
+  { $charset = $row['Value'];
+  }
+}
+
+// Open the file
+
+if (!$error && isset($_REQUEST["start"]))
+{ 
+
+// Set current filename ($filename overrides $_REQUEST["fn"] if set)
+
+  if ($filename!="")
+    $curfilename=$filename;
+  else if (isset($_REQUEST["fn"]))
+    $curfilename=urldecode($_REQUEST["fn"]);
+  else
+    $curfilename="";
+
+// Recognize GZip filename
+
+  if (eregi("\.gz$",$curfilename)) 
+    $gzipmode=true;
+  else
+    $gzipmode=false;
+
+  if ((!$gzipmode && !$file=@fopen($curfilename,"rt")) || ($gzipmode && !$file=@gzopen($curfilename,"rt")))
+  { echo ("<p class=\"error\">Can't open ".$curfilename." for import</p>\n");
+    echo ("<p>Please, check that your dump file name contains only alphanumerical characters, and rename it accordingly, for example: $curfilename.".
+           "<br>Or, specify \$filename in bigdump.php with the full filename. ".
+           "<br>Or, you have to upload the $curfilename to the server first.</p>\n");
+    $error=true;
+  }
+
+// Get the file size (can't do it fast on gzipped files, no idea how)
+
+  else if ((!$gzipmode && @fseek($file, 0, SEEK_END)==0) || ($gzipmode && @gzseek($file, 0)==0))
+  { if (!$gzipmode) $filesize = ftell($file);
+    else $filesize = gztell($file);                   // Always zero, ignore
+  }
+  else
+  { echo ("<p class=\"error\">I can't seek into $curfilename</p>\n");
+    $error=true;
+  }
+}
+
+// *******************************************************************************************
+// START IMPORT SESSION HERE
+// *******************************************************************************************
+
+if (!$error && isset($_REQUEST["start"]) && isset($_REQUEST["foffset"]) && eregi("(\.(sql|gz|csv))$",$curfilename))
+{
+
+// Check start and foffset are numeric values
+
+  if (!is_numeric($_REQUEST["start"]) || !is_numeric($_REQUEST["foffset"]))
+  { echo ("<p class=\"error\">UNEXPECTED: Non-numeric values for start and foffset</p>\n");
+    $error=true;
+  }
+
+  if (!$error)
+  { $_REQUEST["start"]   = floor($_REQUEST["start"]);
+    $_REQUEST["foffset"] = floor($_REQUEST["foffset"]);
+    skin_open();
+    if (TESTMODE) 
+      echo ("<p class=\"centr\">TEST MODE ENABLED</p>\n");
+    echo ("<p class=\"centr\">Processing...</b></p>\n");
+    echo ("<p class=\"smlcentr\">Starting from line: ".$_REQUEST["start"]."</p>\n");	
+    skin_close();
+  }
+
+// Check $_REQUEST["foffset"] upon $filesize (can't do it on gzipped files)
+
+  if (!$error && !$gzipmode && $_REQUEST["foffset"]>$filesize)
+  { echo ("<p class=\"error\">UNEXPECTED: Can't set file pointer behind the end of file</p>\n");
+    $error=true;
+  }
+
+// Set file pointer to $_REQUEST["foffset"]
+
+  if (!$error && ((!$gzipmode && fseek($file, $_REQUEST["foffset"])!=0) || ($gzipmode && gzseek($file, $_REQUEST["foffset"])!=0)))
+  { echo ("<p class=\"error\">UNEXPECTED: Can't set file pointer to offset: ".$_REQUEST["foffset"]."</p>\n");
+    $error=true;
+  }
+
+// Start processing queries from $file
+
+  if (!$error)
+  { $query="";
+    $queries=0;
+    $totalqueries=$_REQUEST["totalqueries"];
+    $linenumber=$_REQUEST["start"];
+    $querylines=0;
+    $inparents=false;
+
+// Stay processing as long as the $linespersession is not reached or the query is still incomplete
+
+    while ($linenumber<$_REQUEST["start"]+$linespersession || $query!="")
+    {
+
+// Read the whole next line
+
+      $dumpline = "";
+      while (!feof($file) && substr ($dumpline, -1) != "\n")
+      { if (!$gzipmode)
+          $dumpline .= fgets($file, DATA_CHUNK_LENGTH);
+        else
+          $dumpline .= gzgets($file, DATA_CHUNK_LENGTH);
+      }
+      if ($dumpline==="") break;
+
+
+// Stop if csv file is used, but $csv_insert_table is not set
+      if (($csv_insert_table == "") && (eregi("(\.csv)$",$curfilename)))
+      {
+        echo ("<p class=\"error\">Stopped at the line $linenumber. </p>");
+        echo ('<p>At this place the current query is from csv file, but $csv_insert_table was not set.');
+        echo ("You have to tell where you want to send your data.</p>\n");
+        $error=true;
+        break;
+      }
+     
+// Create an SQL query from CSV line
+
+      if (($csv_insert_table != "") && (eregi("(\.csv)$",$curfilename)))
+        $dumpline = 'INSERT INTO '.$csv_insert_table.' VALUES ('.$dumpline.');';
+
+// Handle DOS and Mac encoded linebreaks (I don't know if it will work on Win32 or Mac Servers)
+
+      $dumpline=str_replace("\r\n", "\n", $dumpline);
+      $dumpline=str_replace("\r", "\n", $dumpline);
+            
+// DIAGNOSTIC
+// echo ("<p>Line $linenumber: $dumpline</p>\n");
+
+// Skip comments and blank lines only if NOT in parents
+
+      if (!$inparents)
+      { $skipline=false;
+        reset($comment);
+        foreach ($comment as $comment_value)
+        { if (!$inparents && (trim($dumpline)=="" || strpos ($dumpline, $comment_value) === 0))
+          { $skipline=true;
+            break;
+          }
+        }
+        if ($skipline)
+        { $linenumber++;
+          continue;
+        }
+      }
+
+// Remove double back-slashes from the dumpline prior to count the quotes ('\\' can only be within strings)
+      
+      $dumpline_deslashed = str_replace ("\\\\","",$dumpline);
+
+// Count ' and \' in the dumpline to avoid query break within a text field ending by ;
+// Please don't use double quotes ('"')to surround strings, it wont work
+
+      $parents=substr_count ($dumpline_deslashed, "'")-substr_count ($dumpline_deslashed, "\\'");
+      if ($parents % 2 != 0)
+        $inparents=!$inparents;
+
+// Add the line to query
+
+      $query .= $dumpline;
+
+// Don't count the line if in parents (text fields may include unlimited linebreaks)
+      
+      if (!$inparents)
+        $querylines++;
+      
+// Stop if query contains more lines as defined by MAX_QUERY_LINES
+
+      if ($querylines>MAX_QUERY_LINES)
+      {
+        echo ("<p class=\"error\">Stopped at the line $linenumber. </p>");
+        echo ("<p>At this place the current query includes more than ".MAX_QUERY_LINES." dump lines. That can happen if your dump file was ");
+        echo ("created by some tool which doesn't place a semicolon followed by a linebreak at the end of each query, or if your dump contains ");
+        echo ("extended inserts. Please read the BigDump FAQs for more infos.</p>\n");
+        $error=true;
+        break;
+      }
+
+// Execute query if end of query detected (; as last character) AND NOT in parents
+
+      if (ereg(";$",trim($dumpline)) && !$inparents)
+      { if (!TESTMODE && !mysql_query(trim($query), $dbconnection))
+        { echo ("<p class=\"error\">Error at the line $linenumber: ". trim($dumpline)."</p>\n");
+          echo ("<p>Query: ".trim(nl2br(htmlentities($query)))."</p>\n");
+          echo ("<p>MySQL: ".mysql_error()."</p>\n");
+          $error=true;
+          break;
+        }
+        $totalqueries++;
+        $queries++;
+        $query="";
+        $querylines=0;
+      }
+      $linenumber++;
+    }
+  }
+
+// Get the current file position
+
+  if (!$error)
+  { if (!$gzipmode) 
+      $foffset = ftell($file);
+    else
+      $foffset = gztell($file);
+    if (!$foffset)
+    { echo ("<p class=\"error\">UNEXPECTED: Can't read the file pointer offset</p>\n");
+      $error=true;
+    }
+  }
+
+// Print statistics
+
+skin_open();
+
+// echo ("<p class=\"centr\"><b>Statistics</b></p>\n");
+
+  if (!$error)
+  { 
+    $lines_this   = $linenumber-$_REQUEST["start"];
+    $lines_done   = $linenumber-1;
+    $lines_togo   = ' ? ';
+    $lines_tota   = ' ? ';
+    
+    $queries_this = $queries;
+    $queries_done = $totalqueries;
+    $queries_togo = ' ? ';
+    $queries_tota = ' ? ';
+
+    $bytes_this   = $foffset-$_REQUEST["foffset"];
+    $bytes_done   = $foffset;
+    $kbytes_this  = round($bytes_this/1024,2);
+    $kbytes_done  = round($bytes_done/1024,2);
+    $mbytes_this  = round($kbytes_this/1024,2);
+    $mbytes_done  = round($kbytes_done/1024,2);
+   
+    if (!$gzipmode)
+    {
+      $bytes_togo  = $filesize-$foffset;
+      $bytes_tota  = $filesize;
+      $kbytes_togo = round($bytes_togo/1024,2);
+      $kbytes_tota = round($bytes_tota/1024,2);
+      $mbytes_togo = round($kbytes_togo/1024,2);
+      $mbytes_tota = round($kbytes_tota/1024,2);
+      
+      $pct_this   = ceil($bytes_this/$filesize*100);
+      $pct_done   = ceil($foffset/$filesize*100);
+      $pct_togo   = 100 - $pct_done;
+      $pct_tota   = 100;
+
+      if ($bytes_togo==0) 
+      { $lines_togo   = '0'; 
+        $lines_tota   = $linenumber-1; 
+        $queries_togo = '0'; 
+        $queries_tota = $totalqueries; 
+      }
+
+      $pct_bar    = "<div style=\"height:15px;width:$pct_done%;background-color:#000080;margin:0px;\"></div>";
+    }
+    else
+    {
+      $bytes_togo  = ' ? ';
+      $bytes_tota  = ' ? ';
+      $kbytes_togo = ' ? ';
+      $kbytes_tota = ' ? ';
+      $mbytes_togo = ' ? ';
+      $mbytes_tota = ' ? ';
+      
+      $pct_this    = ' ? ';
+      $pct_done    = ' ? ';
+      $pct_togo    = ' ? ';
+      $pct_tota    = 100;
+      $pct_bar     = str_replace(' ','&nbsp;','<tt>[         Not available for gzipped files          ]</tt>');
+    }
+    
+    echo ("
+    <center>
+    <table width=\"520\" border=\"0\" cellpadding=\"3\" cellspacing=\"1\">
+    <tr><th class=\"bg4\"> </th><th class=\"bg4\">Session</th><th class=\"bg4\">Done</th><th class=\"bg4\">To go</th><th class=\"bg4\">Total</th></tr>
+    <tr><th class=\"bg4\">Lines</th><td class=\"bg3\">$lines_this</td><td class=\"bg3\">$lines_done</td><td class=\"bg3\">$lines_togo</td><td class=\"bg3\">$lines_tota</td></tr>
+    <tr><th class=\"bg4\">Queries</th><td class=\"bg3\">$queries_this</td><td class=\"bg3\">$queries_done</td><td class=\"bg3\">$queries_togo</td><td class=\"bg3\">$queries_tota</td></tr>
+    <tr><th class=\"bg4\">Bytes</th><td class=\"bg3\">$bytes_this</td><td class=\"bg3\">$bytes_done</td><td class=\"bg3\">$bytes_togo</td><td class=\"bg3\">$bytes_tota</td></tr>
+    <tr><th class=\"bg4\">KB</th><td class=\"bg3\">$kbytes_this</td><td class=\"bg3\">$kbytes_done</td><td class=\"bg3\">$kbytes_togo</td><td class=\"bg3\">$kbytes_tota</td></tr>
+    <tr><th class=\"bg4\">MB</th><td class=\"bg3\">$mbytes_this</td><td class=\"bg3\">$mbytes_done</td><td class=\"bg3\">$mbytes_togo</td><td class=\"bg3\">$mbytes_tota</td></tr>
+    <tr><th class=\"bg4\">%</th><td class=\"bg3\">$pct_this</td><td class=\"bg3\">$pct_done</td><td class=\"bg3\">$pct_togo</td><td class=\"bg3\">$pct_tota</td></tr>
+    <tr><th class=\"bg4\">% bar</th><td class=\"bgpctbar\" colspan=\"4\">$pct_bar</td></tr>
+    </table>
+    </center>
+    \n");
+
+// Finish message and restart the script
+
+    if ($linenumber<$_REQUEST["start"]+$linespersession)
+    { echo ("<p class=\"successcentr\">Congratulations: End of file reached, assuming OK</p>\n");
+      echo ("<p class=\"centr\"><a href=\"" . SITEURL ."\">Continue...</a></p>\n");
+?>
+
+<!-- Start Paypal donation code 
+
+<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
+<input type="hidden" name="cmd" value="_xclick" />
+<input type="hidden" name="business" value="alexey@ozerov.de" />
+<input type="hidden" name="item_name" value="BigDump Donation" />
+<input type="hidden" name="no_shipping" value="1" />
+<input type="hidden" name="no_note" value="0" />
+<input type="hidden" name="tax" value="0" />
+<input type="hidden" name="bn" value="PP-DonationsBF" />
+<input type="hidden" name="lc" value="EN" />
+<input type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but04.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!" />
+<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
+</form>
+ End Paypal donation code -->
+
+<?php      
+      $error=true;
+    }
+    else
+    { if ($delaypersession!=0)
+        echo ("<p class=\"centr\">Now I'm <b>waiting $delaypersession milliseconds</b> before starting next session...</p>\n");
+        if (!$ajax) 
+          echo ("<script language=\"JavaScript\" type=\"text/javascript\">window.setTimeout('location.href=\"".$_SERVER["PHP_SELF"]."?start=$linenumber&fn=".urlencode($curfilename)."&foffset=$foffset&totalqueries=$totalqueries\";',500+$delaypersession);</script>\n");
+        echo ("<noscript>\n");
+        echo ("<p class=\"centr\"><a href=\"".$_SERVER["PHP_SELF"]."?start=$linenumber&amp;fn=".urlencode($curfilename)."&amp;foffset=$foffset&amp;totalqueries=$totalqueries\">Continue from the line $linenumber</a> (Enable JavaScript to do it automatically)</p>\n");
+        echo ("</noscript>\n");
+   
+      echo ("<p class=\"centr\">Press <b><a href=\"".$_SERVER["PHP_SELF"]."\">STOP</a></b> to abort the import <b>OR WAIT!</b></p>\n");
+    }
+  }
+  else 
+    echo ("<p class=\"error\">Stopped on error</p>\n");
+
+skin_close();
+
+}
+
+if ($error)
+  echo ("<p class=\"centr\"><a href=\"".$_SERVER["PHP_SELF"]."\">Start from the beginning</a> (DROP the old tables before restarting)</p>\n");
+
+if ($dbconnection) mysql_close();
+if ($file && !$gzipmode) fclose($file);
+else if ($file && $gzipmode) gzclose($file);
+
+?>
+
+
+</td></tr></table>
+
+</center>
+
+</body>
+</html>
+
+<?php
+
+// *******************************************************************************************
+// 				AJAX functionality starts here
+// *******************************************************************************************
+
+// Handle special situations (errors, and finish)
+
+if ($error) 
+{
+  $out1 = ob_get_contents();
+  ob_end_clean();
+  echo $out1;
+  die;
+}
+
+// Creates responses  (XML only or web page)
+
+if (($ajax) && isset($_REQUEST['start']))
+{
+  if (isset($_REQUEST['ajaxrequest'])) 
+  {	ob_end_clean();
+		create_xml_response();
+		die;
+	} 
+	else 
+	{
+	  create_ajax_script();	  
+	}  
+}
+ob_flush();
+
+// *******************************************************************************************
+// 				AJAX utilities
+// *******************************************************************************************
+
+function create_xml_response() 
+{
+  global $linenumber, $foffset, $totalqueries, $curfilename,
+				 $lines_this, $lines_done, $lines_togo, $lines_tota,
+				 $queries_this, $queries_done, $queries_togo, $queries_tota,
+				 $bytes_this, $bytes_done, $bytes_togo, $bytes_tota,
+				 $kbytes_this, $kbytes_done, $kbytes_togo, $kbytes_tota,
+				 $mbytes_this, $mbytes_done, $mbytes_togo, $mbytes_tota,
+				 $pct_this, $pct_done, $pct_togo, $pct_tota,$pct_bar;
+
+	//echo "Content-type: application/xml; charset='iso-8859-1'";
+	header('Content-Type: application/xml');
+	header('Cache-Control: no-cache');
+	/*	
+	echo '<?xml version="1.0"?>'."\n";
+	echo '<root>'."\n";
+	echo 'cos'."\n";
+	echo '</root>'."\n";
+	*/
+	
+	echo '<?xml version="1.0" encoding="ISO-8859-1"?>';
+	echo "<root>";
+	// data - for calculations
+	echo "<linenumber>";
+	echo "$linenumber";
+	echo "</linenumber>";
+	echo "<foffset>";
+	echo "$foffset";
+	echo "</foffset>";
+	echo "<fn>";
+	echo '"'.$curfilename.'"';
+	echo "</fn>";
+	echo "<totalqueries>";
+	echo "$totalqueries";
+	echo "</totalqueries>";
+	// results - for form update
+	echo "<elem1>";
+	echo "$lines_this";
+	echo "</elem1>";
+	echo "<elem2>";
+	echo "$lines_done";
+	echo "</elem2>";
+	echo "<elem3>";
+	echo "$lines_togo";
+	echo "</elem3>";
+	echo "<elem4>";
+	echo "$lines_tota";
+	echo "</elem4>";
+	
+	echo "<elem5>";
+	echo "$queries_this";
+	echo "</elem5>";
+	echo "<elem6>";
+	echo "$queries_done";
+	echo "</elem6>";
+	echo "<elem7>";
+	echo "$queries_togo";
+	echo "</elem7>";
+	echo "<elem8>";
+	echo "$queries_tota";
+	echo "</elem8>";
+	
+	echo "<elem9>";
+	echo "$bytes_this";
+	echo "</elem9>";
+	echo "<elem10>";
+	echo "$bytes_done";
+	echo "</elem10>";
+	echo "<elem11>";
+	echo "$bytes_togo";
+	echo "</elem11>";
+	echo "<elem12>";
+	echo "$bytes_tota";
+	echo "</elem12>";
+			
+	echo "<elem13>";
+	echo "$kbytes_this";
+	echo "</elem13>";
+	echo "<elem14>";
+	echo "$kbytes_done";
+	echo "</elem14>";
+	echo "<elem15>";
+	echo "$kbytes_togo";
+	echo "</elem15>";
+	echo "<elem16>";
+	echo "$kbytes_tota";
+	echo "</elem16>";
+	
+	echo "<elem17>";
+	echo "$mbytes_this";
+	echo "</elem17>";
+	echo "<elem18>";
+	echo "$mbytes_done";
+	echo "</elem18>";
+	echo "<elem19>";
+	echo "$mbytes_togo";
+	echo "</elem19>";
+	echo "<elem20>";
+	echo "$mbytes_tota";
+	echo "</elem20>";
+	
+	echo "<elem21>";
+	echo "$pct_this";
+	echo "</elem21>";
+	echo "<elem22>";
+	echo "$pct_done";
+	echo "</elem22>";
+	echo "<elem23>";
+	echo "$pct_togo";
+	echo "</elem23>";
+	echo "<elem24>";
+	echo "$pct_tota";
+	echo "</elem24>";
+	
+	// converting html to normal text
+	$pct_bar    = htmlentities($pct_bar);	  
+	echo "<elem_bar>";
+	echo "$pct_bar";
+	echo "</elem_bar>";
+				
+	echo "</root>";		
+	
+}
+
+function create_ajax_script() 
+{
+  global $linenumber, $foffset, $totalqueries, $delaypersession, $curfilename;
+	?>
+	<script type="text/javascript" language="javascript">			
+
+	// creates next action url (upload page, or XML response)
+	function get_url(linenumber,fn,foffset,totalqueries) {
+		return "<?php echo $_SERVER['PHP_SELF'] ?>?start="+linenumber+"&fn="+fn+"&foffset="+foffset+"&totalqueries="+totalqueries+"&ajaxrequest=true";
+	}
+	
+	// extracts text from XML element (itemname must be unique)
+	function get_xml_data(itemname,xmld) {
+		return xmld.getElementsByTagName(itemname).item(0).firstChild.data;
+	}
+	
+	// action url (upload page)
+	var url_request =  get_url(<?php echo $linenumber.',"'.urlencode($curfilename).'",'.$foffset.','.$totalqueries;?>);
+	var http_request = false;
+	
+	function makeRequest(url) {
+		http_request = false;
+		if (window.XMLHttpRequest) { 
+		// Mozilla,...
+			http_request = new XMLHttpRequest();
+			if (http_request.overrideMimeType) {
+				http_request.overrideMimeType("text/xml");
+			}
+		} else if (window.ActiveXObject) { 
+		// IE
+			try {
+				http_request = new ActiveXObject("Msxml2.XMLHTTP");
+			} catch(e) {
+				try {
+					http_request = new ActiveXObject("Microsoft.XMLHTTP");
+				} catch(e) {}
+			}
+		}
+		if (!http_request) {
+				alert("Cannot create an XMLHTTP instance");
+				return false;
+		}
+		http_request.onreadystatechange = server_response;
+		http_request.open("GET", url, true);
+		http_request.send(null);
+	}
+	
+	function server_response() 
+	{
+
+	  // waiting for correct response
+	  if (http_request.readyState != 4)
+			return;
+	  if (http_request.status != 200) {
+	    alert("Page unavailable, or wrong url!")
+			return;
+		}
+		
+		// r = xml response
+		var r = http_request.responseXML;
+		
+		//if received not XML but HTML with new page to show
+		if (r.getElementsByTagName('root').length == 0) {                   	//*
+			var text = http_request.responseText;
+			document.open();
+			document.write(text);		
+			document.close();	
+			return;		
+		}
+		
+		// update "Starting from line: "
+		document.getElementsByTagName('p').item(1).innerHTML = 
+			"Starting from line: " + 
+			   r.getElementsByTagName('linenumber').item(0).firstChild.nodeValue;
+		
+		// update table with new values
+		for(i = 1; i <= 24; i++) {						
+			document.getElementsByTagName('td').item(i).firstChild.data = 
+				get_xml_data('elem'+i,r);
+		}				
+		
+		// update color bar
+		document.getElementsByTagName('td').item(25).innerHTML = 
+			r.getElementsByTagName('elem_bar').item(0).firstChild.nodeValue;
+			 
+		// action url (XML response)	 
+		url_request =  get_url(
+			get_xml_data('linenumber',r),
+			get_xml_data('fn',r),
+			get_xml_data('foffset',r),
+			get_xml_data('totalqueries',r));
+		
+		// ask for XML response	
+		window.setTimeout("makeRequest(url_request)",500+<?php echo $delaypersession; ?>);
+	}
+	// ask for upload page
+	window.setTimeout("makeRequest(url_request)",500+<?php echo $delaypersession; ?>);
+	</script>
+	<?php
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/cemdb/bigdump.php php-syslog-ng/html/install/cemdb/bigdump.php
--- php-syslog-ng-2.9.f/html/install/cemdb/bigdump.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/cemdb/bigdump.php	2008-02-04 14:43:50.000000000 -0500
@@ -0,0 +1,1043 @@
+<?php
+
+// BigDump ver. 0.29b from 2008-01-19
+// Staggered import of an large MySQL Dump (like phpMyAdmin 2.x Dump)
+// Even through the webservers with hard runtime limit and those in safe mode
+// Works fine with Internet Explorer 7.0 and Firefox 2.x
+
+// Author:       Alexey Ozerov (alexey at ozerov dot de) 
+//               AJAX & CSV functionalities: Krzysiek Herod (kr81uni at wp dot pl) 
+// Copyright:    GPL (C) 2003-2008
+// More Infos:   http://www.ozerov.de/bigdump.php
+
+// This program is free software; you can redistribute it and/or modify it under the
+// terms of the GNU General Public License as published by the Free Software Foundation;
+// either version 2 of the License, or (at your option) any later version.
+
+// THIS SCRIPT IS PROVIDED AS IS, WITHOUT ANY WARRANTY OR GUARANTEE OF ANY KIND
+
+// USAGE
+
+// 1. Adjust the database configuration in this file
+// 2. Remove the old tables on the target database if your dump doesn't contain "DROP TABLE"
+// 3. Create the working directory (e.g. dump) on your web server
+// 4. Upload bigdump.php and your dump files (.sql, .gz) via FTP to the working directory
+// 5. Run the bigdump.php from your browser via URL like http://www.yourdomain.com/dump/bigdump.php
+// 6. BigDump can start the next import session automatically if you enable the JavaScript
+// 7. Wait for the script to finish, do not close the browser window
+// 8. IMPORTANT: Remove bigdump.php and your dump files from the web server
+
+// If Timeout errors still occure you may need to adjust the $linepersession setting in this file
+
+// LAST CHANGES
+
+// *** Accurate current directory detection
+// *** Accurate filename handling and urlencode in URLs
+// *** Add Paypal button
+
+// Database configuration
+
+$db_server   = 'localhost';
+$db_name     = '';
+$db_username = '';
+$db_password = '';
+
+// Other settings (optional)
+
+$filename         = '';     // Specify the dump filename to suppress the file selection dialog
+$csv_insert_table = '';     // Destination table for CSV files
+$ajax             = true;   // AJAX mode: import will be done without refreshing the website
+$linespersession  = 3000;   // Lines to be executed per one import session
+$delaypersession  = 0;      // You can specify a sleep time in milliseconds after each session
+                            // Works only if JavaScript is activated. Use to reduce server overrun
+
+// Allowed comment delimiters: lines starting with these strings will be dropped by BigDump
+
+$comment[]='#';                       // Standard comment lines are dropped by default
+$comment[]='-- ';
+// $comment[]='---';                  // Uncomment this line if using proprietary dump created by outdated mysqldump
+// $comment[]='CREATE DATABASE';      // Uncomment this line if your dump contains create database queries in order to ignore them
+// $comment[]='/*!';                  // Or add your own string to leave out other proprietary things
+
+
+
+// Connection character set should be the same as the dump file character set (utf8, latin1, cp1251, koi8r etc.)
+// See http://dev.mysql.com/doc/refman/5.0/en/charset-charsets.html for the full list
+
+$db_connection_charset = '';
+
+
+// *******************************************************************************************
+// If not familiar with PHP please don't change anything below this line
+// *******************************************************************************************
+
+if ($ajax)
+  ob_start();
+
+define ('VERSION','0.29b');
+define ('DATA_CHUNK_LENGTH',16384);  // How many chars are read per time
+define ('MAX_QUERY_LINES',300);      // How many lines may be considered to be one query (except text lines)
+define ('TESTMODE',false);           // Set to true to process the file without actually accessing the database
+
+header("Expires: Mon, 1 Dec 2003 01:00:00 GMT");
+header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
+header("Cache-Control: no-store, no-cache, must-revalidate");
+header("Cache-Control: post-check=0, pre-check=0", false);
+header("Pragma: no-cache");
+
+@ini_set('auto_detect_line_endings', true);
+@set_time_limit(0);
+
+// Clean and strip anything we don't want from user's input [0.27b]
+
+foreach ($_REQUEST as $key => $val) 
+{
+  $val = preg_replace("/[^_A-Za-z0-9-\.&= ]/i",'', $val);
+  $_REQUEST[$key] = $val;
+}
+
+?>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<html>
+<head>
+<title>BigDump ver. <?php echo (VERSION); ?></title>
+<meta http-equiv="CONTENT-TYPE" content="text/html; charset=iso-8859-1"/>
+<meta http-equiv="CONTENT-LANGUAGE" content="EN"/>
+
+<meta http-equiv="Cache-Control" content="no-cache/"/>
+<meta http-equiv="Pragma" content="no-cache"/>
+<meta http-equiv="Expires" content="-1"/>
+
+<style type="text/css">
+<!--
+
+body
+{ background-color:#FFFFF0;
+}
+
+h1 
+{ font-size:20px;
+line-height:24px;
+font-family:Arial,Helvetica,sans-serif;
+margin-top:5px;
+margin-bottom:5px;
+}
+
+p,td,th
+{ font-size:14px;
+line-height:18px;
+font-family:Arial,Helvetica,sans-serif;
+margin-top:5px;
+margin-bottom:5px;
+text-align:justify;
+vertical-align:top;
+}
+
+p.centr
+{ 
+text-align:center;
+}
+
+p.smlcentr
+{ font-size:10px;
+line-height:14px;
+text-align:center;
+}
+
+p.error
+{ color:#FF0000;
+font-weight:bold;
+}
+
+p.success
+{ color:#00DD00;
+font-weight:bold;
+}
+
+p.successcentr
+{ color:#00DD00;
+background-color:#DDDDFF;
+font-weight:bold;
+text-align:center;
+}
+
+td
+{ background-color:#F8F8F8;
+text-align:left;
+}
+
+td.transparent
+{ background-color:#FFFFF0;
+}
+
+th
+{ font-weight:bold;
+color:#FFFFFF;
+background-color:#AAAAEE;
+text-align:left;
+}
+
+td.right
+{ text-align:right;
+}
+
+form
+{ margin-top:5px;
+margin-bottom:5px;
+}
+
+div.skin1
+{
+border-color:#3333EE;
+border-width:5px;
+border-style:solid;
+background-color:#AAAAEE;
+text-align:center;
+vertical-align:middle;
+padding:3px;
+margin:1px;
+}
+
+td.bg3
+{ background-color:#EEEE99;
+text-align:left;
+vertical-align:top;
+width:20%;
+}
+
+th.bg4
+{ background-color:#EEAA55;
+text-align:left;
+vertical-align:top;
+width:20%;
+}
+
+td.bgpctbar
+{ background-color:#EEEEAA;
+text-align:left;
+vertical-align:middle;
+width:80%;
+}
+
+-->
+</style>
+
+</head>
+
+<body>
+
+<center>
+
+<table width="780" cellspacing="0" cellpadding="0">
+<tr><td class="transparent">
+
+<!-- <h1>BigDump: Staggered MySQL Dump Importer ver. <?php echo (VERSION); ?></h1> -->
+
+<?php
+
+function skin_open() {
+echo ('<div class="skin1">');
+}
+
+function skin_close() {
+echo ('</div>');
+}
+
+skin_open();
+echo ('<h1>BigDump: Staggered MySQL Dump Importer v'.VERSION.'</h1>');
+skin_close();
+
+$error = false;
+$file  = false;
+
+// Check PHP version
+
+if (!$error && !function_exists('version_compare'))
+{ echo ("<p class=\"error\">PHP version 4.1.0 is required for BigDump to proceed. You have PHP ".phpversion()." installed. Sorry!</p>\n");
+  $error=true;
+}
+
+// Calculate PHP max upload size (handle settings like 10M or 100K)
+
+if (!$error)
+{ $upload_max_filesize=ini_get("upload_max_filesize");
+  if (eregi("([0-9]+)K",$upload_max_filesize,$tempregs)) $upload_max_filesize=$tempregs[1]*1024;
+  if (eregi("([0-9]+)M",$upload_max_filesize,$tempregs)) $upload_max_filesize=$tempregs[1]*1024*1024;
+  if (eregi("([0-9]+)G",$upload_max_filesize,$tempregs)) $upload_max_filesize=$tempregs[1]*1024*1024*1024;
+}
+
+// Get the current directory
+
+if (isset($_SERVER["CGIA"]))
+  $upload_dir=dirname($_SERVER["CGIA"]);
+else if (isset($_SERVER["ORIG_PATH_TRANSLATED"]))
+  $upload_dir=dirname($_SERVER["ORIG_PATH_TRANSLATED"]);
+else if (isset($_SERVER["ORIG_SCRIPT_FILENAME"]))
+  $upload_dir=dirname($_SERVER["ORIG_SCRIPT_FILENAME"]);
+else if (isset($_SERVER["PATH_TRANSLATED"]))
+  $upload_dir=dirname($_SERVER["PATH_TRANSLATED"]);
+else 
+  $upload_dir=dirname($_SERVER["SCRIPT_FILENAME"]);
+
+// Handle file upload
+
+if (!$error && isset($_REQUEST["uploadbutton"]))
+{ if (is_uploaded_file($_FILES["dumpfile"]["tmp_name"]) && ($_FILES["dumpfile"]["error"])==0)
+  { 
+    $uploaded_filename=str_replace(" ","_",$_FILES["dumpfile"]["name"]);
+    $uploaded_filename=preg_replace("/[^_A-Za-z0-9-\.]/i",'',$uploaded_filename);
+    $uploaded_filepath=str_replace("\\","/",$upload_dir."/".$uploaded_filename);
+
+    if (file_exists($uploaded_filename))
+    { echo ("<p class=\"error\">File $uploaded_filename already exist! Delete and upload again!</p>\n");
+    }
+    else if (!eregi("(\.(sql|gz|csv))$",$uploaded_filename))
+    { echo ("<p class=\"error\">You may only upload .sql .gz or .csv files.</p>\n");
+    }
+    else if (!@move_uploaded_file($_FILES["dumpfile"]["tmp_name"],$uploaded_filepath))
+    { echo ("<p class=\"error\">Error moving uploaded file ".$_FILES["dumpfile"]["tmp_name"]." to the $uploaded_filepath</p>\n");
+      echo ("<p>Check the directory permissions for $upload_dir (must be 777)!</p>\n");
+    }
+    else
+    { echo ("<p class=\"success\">Uploaded file saved as $uploaded_filename</p>\n");
+    }
+  }
+  else
+  { echo ("<p class=\"error\">Error uploading file ".$_FILES["dumpfile"]["name"]."</p>\n");
+  }
+}
+
+
+// Handle file deletion (delete only in the current directory for security reasons)
+
+if (!$error && isset($_REQUEST["delete"]) && $_REQUEST["delete"]!=basename($_SERVER["SCRIPT_FILENAME"]))
+{ if (eregi("(\.(sql|gz|csv))$",$_REQUEST["delete"]) && @unlink(basename($_REQUEST["delete"])))
+    echo ("<p class=\"success\">".$_REQUEST["delete"]." was removed successfully</p>\n");
+  else
+    echo ("<p class=\"error\">Can't remove ".$_REQUEST["delete"]."</p>\n");
+}
+
+
+// Connect to the database
+
+if (!$error && !TESTMODE)
+{ $dbconnection = @mysql_connect($db_server,$db_username,$db_password);
+  if ($dbconnection) 
+    $db = mysql_select_db($db_name);
+  if (!$dbconnection || !$db) 
+  { echo ("<p class=\"error\">Database connection failed due to ".mysql_error()."</p>\n");
+    echo ("<p>Edit the database settings in ".$_SERVER["SCRIPT_FILENAME"]." or contact your database provider</p>\n");
+    $error=true;
+  }
+  if (!$error && $db_connection_charset!=='')
+    @mysql_query("SET NAMES $db_connection_charset", $dbconnection);
+}
+else
+{ $dbconnection = false;
+}
+
+
+// List uploaded files in multifile mode
+
+if (!$error && !isset($_REQUEST["fn"]) && $filename=="")
+{ if ($dirhandle = opendir($upload_dir)) 
+  { $dirhead=false;
+    while (false !== ($dirfile = readdir($dirhandle)))
+    { if ($dirfile != "." && $dirfile != ".." && $dirfile!=basename($_SERVER["SCRIPT_FILENAME"]))
+      { if (!$dirhead)
+        { echo ("<table width=\"100%\" cellspacing=\"2\" cellpadding=\"2\">\n");
+          echo ("<tr><th>Filename</th><th>Size</th><th>Date&amp;Time</th><th>Type</th><th>&nbsp;</th><th>&nbsp;</th>\n");
+          $dirhead=true;
+        }
+        echo ("<tr><td>$dirfile</td><td class=\"right\">".filesize($dirfile)."</td><td>".date ("Y-m-d H:i:s", filemtime($dirfile))."</td>");
+
+        if (eregi("\.sql$",$dirfile))
+          echo ("<td>SQL</td>");
+        elseif (eregi("\.gz$",$dirfile))
+          echo ("<td>GZip</td>");
+        elseif (eregi("\.csv$",$dirfile))
+          echo ("<td>CSV</td>");
+        else
+          echo ("<td>Misc</td>");
+
+        if ((eregi("\.gz$",$dirfile) && function_exists("gzopen")) || eregi("\.sql$",$dirfile) || eregi("\.csv$",$dirfile))
+          echo ("<td><a href=\"".$_SERVER["PHP_SELF"]."?start=1&amp;fn=".urlencode($dirfile)."&amp;foffset=0&amp;totalqueries=0\">Start Import</a> into $db_name at $db_server</td>\n <td><a href=\"".$_SERVER["PHP_SELF"]."?delete=".urlencode($dirfile)."\">Delete file</a></td></tr>\n");
+        else
+          echo ("<td>&nbsp;</td>\n <td>&nbsp;</td></tr>\n");
+      }
+
+    }
+    if ($dirhead) echo ("</table>\n");
+    else echo ("<p>No uploaded files found in the working directory</p>\n");
+    closedir($dirhandle); 
+  }
+  else
+  { echo ("<p class=\"error\">Error listing directory $upload_dir</p>\n");
+    $error=true;
+  }
+}
+
+
+// Single file mode
+
+if (!$error && !isset ($_REQUEST["fn"]) && $filename!="")
+{ echo ("<p><a href=\"".$_SERVER["PHP_SELF"]."?start=1&amp;fn=".urlencode($filename)."&amp;foffset=0&amp;totalqueries=0\">Start Import</a> from $filename into $db_name at $db_server</p>\n");
+}
+
+
+// File Upload Form
+
+if (!$error && !isset($_REQUEST["fn"]) && $filename=="")
+{ 
+
+// Test permissions on working directory
+
+  do { $tempfilename=time().".tmp"; } while (file_exists($tempfilename));
+  if (!($tempfile=@fopen($tempfilename,"w")))
+  { echo ("<p>Upload form disabled. Permissions for the working directory <i>$upload_dir</i> <b>must be set to 777</b> in order ");
+    echo ("to upload files from here. Alternatively you can upload your dump files via FTP.</p>\n");
+  }
+  else
+  { fclose($tempfile);
+    unlink ($tempfilename);
+ 
+    echo ("<p>You can now upload your dump file up to $upload_max_filesize bytes (".round ($upload_max_filesize/1024/1024)." Mbytes)  ");
+    echo ("directly from your browser to the server. Alternatively you can upload your dump files of any size via FTP.</p>\n");
+?>
+<form method="POST" action="<?php echo ($_SERVER["PHP_SELF"]); ?>" enctype="multipart/form-data">
+<input type="hidden" name="MAX_FILE_SIZE" value="$upload_max_filesize">
+<p>Dump file: <input type="file" name="dumpfile" accept="*/*" size=60"></p>
+<p><input type="submit" name="uploadbutton" value="Upload"></p>
+</form>
+<?php
+  }
+}
+
+// Print the current mySQL connection charset
+
+if (!$error && !TESTMODE && !isset($_REQUEST["fn"]))
+{ 
+  $result = mysql_query("SHOW VARIABLES LIKE 'character_set_connection';");
+  $row = mysql_fetch_assoc($result);
+  if ($row) 
+  { $charset = $row['Value'];
+    echo ("<p>Note: The current mySQL connection charset is <i>$charset</i>. Your dump file must be encoded in <i>$charset</i> in order to avoid problems with non-latin characters. You can change the connection charset using the \$db_connection_charset variable in bigdump.php</p>\n");
+  }
+}
+
+// Open the file
+
+if (!$error && isset($_REQUEST["start"]))
+{ 
+
+// Set current filename ($filename overrides $_REQUEST["fn"] if set)
+
+  if ($filename!="")
+    $curfilename=$filename;
+  else if (isset($_REQUEST["fn"]))
+    $curfilename=urldecode($_REQUEST["fn"]);
+  else
+    $curfilename="";
+
+// Recognize GZip filename
+
+  if (eregi("\.gz$",$curfilename)) 
+    $gzipmode=true;
+  else
+    $gzipmode=false;
+
+  if ((!$gzipmode && !$file=@fopen($curfilename,"rt")) || ($gzipmode && !$file=@gzopen($curfilename,"rt")))
+  { echo ("<p class=\"error\">Can't open ".$curfilename." for import</p>\n");
+    echo ("<p>Please, check that your dump file name contains only alphanumerical characters, and rename it accordingly, for example: $curfilename.".
+           "<br>Or, specify \$filename in bigdump.php with the full filename. ".
+           "<br>Or, you have to upload the $curfilename to the server first.</p>\n");
+    $error=true;
+  }
+
+// Get the file size (can't do it fast on gzipped files, no idea how)
+
+  else if ((!$gzipmode && @fseek($file, 0, SEEK_END)==0) || ($gzipmode && @gzseek($file, 0)==0))
+  { if (!$gzipmode) $filesize = ftell($file);
+    else $filesize = gztell($file);                   // Always zero, ignore
+  }
+  else
+  { echo ("<p class=\"error\">I can't seek into $curfilename</p>\n");
+    $error=true;
+  }
+}
+
+// *******************************************************************************************
+// START IMPORT SESSION HERE
+// *******************************************************************************************
+
+if (!$error && isset($_REQUEST["start"]) && isset($_REQUEST["foffset"]) && eregi("(\.(sql|gz|csv))$",$curfilename))
+{
+
+// Check start and foffset are numeric values
+
+  if (!is_numeric($_REQUEST["start"]) || !is_numeric($_REQUEST["foffset"]))
+  { echo ("<p class=\"error\">UNEXPECTED: Non-numeric values for start and foffset</p>\n");
+    $error=true;
+  }
+
+  if (!$error)
+  { $_REQUEST["start"]   = floor($_REQUEST["start"]);
+    $_REQUEST["foffset"] = floor($_REQUEST["foffset"]);
+    skin_open();
+    if (TESTMODE) 
+      echo ("<p class=\"centr\">TEST MODE ENABLED</p>\n");
+    echo ("<p class=\"centr\">Processing file: <b>".$curfilename."</b></p>\n");
+    echo ("<p class=\"smlcentr\">Starting from line: ".$_REQUEST["start"]."</p>\n");	
+    skin_close();
+  }
+
+// Check $_REQUEST["foffset"] upon $filesize (can't do it on gzipped files)
+
+  if (!$error && !$gzipmode && $_REQUEST["foffset"]>$filesize)
+  { echo ("<p class=\"error\">UNEXPECTED: Can't set file pointer behind the end of file</p>\n");
+    $error=true;
+  }
+
+// Set file pointer to $_REQUEST["foffset"]
+
+  if (!$error && ((!$gzipmode && fseek($file, $_REQUEST["foffset"])!=0) || ($gzipmode && gzseek($file, $_REQUEST["foffset"])!=0)))
+  { echo ("<p class=\"error\">UNEXPECTED: Can't set file pointer to offset: ".$_REQUEST["foffset"]."</p>\n");
+    $error=true;
+  }
+
+// Start processing queries from $file
+
+  if (!$error)
+  { $query="";
+    $queries=0;
+    $totalqueries=$_REQUEST["totalqueries"];
+    $linenumber=$_REQUEST["start"];
+    $querylines=0;
+    $inparents=false;
+
+// Stay processing as long as the $linespersession is not reached or the query is still incomplete
+
+    while ($linenumber<$_REQUEST["start"]+$linespersession || $query!="")
+    {
+
+// Read the whole next line
+
+      $dumpline = "";
+      while (!feof($file) && substr ($dumpline, -1) != "\n")
+      { if (!$gzipmode)
+          $dumpline .= fgets($file, DATA_CHUNK_LENGTH);
+        else
+          $dumpline .= gzgets($file, DATA_CHUNK_LENGTH);
+      }
+      if ($dumpline==="") break;
+
+
+// Stop if csv file is used, but $csv_insert_table is not set
+      if (($csv_insert_table == "") && (eregi("(\.csv)$",$curfilename)))
+      {
+        echo ("<p class=\"error\">Stopped at the line $linenumber. </p>");
+        echo ('<p>At this place the current query is from csv file, but $csv_insert_table was not set.');
+        echo ("You have to tell where you want to send your data.</p>\n");
+        $error=true;
+        break;
+      }
+     
+// Create an SQL query from CSV line
+
+      if (($csv_insert_table != "") && (eregi("(\.csv)$",$curfilename)))
+        $dumpline = 'INSERT INTO '.$csv_insert_table.' VALUES ('.$dumpline.');';
+
+// Handle DOS and Mac encoded linebreaks (I don't know if it will work on Win32 or Mac Servers)
+
+      $dumpline=str_replace("\r\n", "\n", $dumpline);
+      $dumpline=str_replace("\r", "\n", $dumpline);
+            
+// DIAGNOSTIC
+// echo ("<p>Line $linenumber: $dumpline</p>\n");
+
+// Skip comments and blank lines only if NOT in parents
+
+      if (!$inparents)
+      { $skipline=false;
+        reset($comment);
+        foreach ($comment as $comment_value)
+        { if (!$inparents && (trim($dumpline)=="" || strpos ($dumpline, $comment_value) === 0))
+          { $skipline=true;
+            break;
+          }
+        }
+        if ($skipline)
+        { $linenumber++;
+          continue;
+        }
+      }
+
+// Remove double back-slashes from the dumpline prior to count the quotes ('\\' can only be within strings)
+      
+      $dumpline_deslashed = str_replace ("\\\\","",$dumpline);
+
+// Count ' and \' in the dumpline to avoid query break within a text field ending by ;
+// Please don't use double quotes ('"')to surround strings, it wont work
+
+      $parents=substr_count ($dumpline_deslashed, "'")-substr_count ($dumpline_deslashed, "\\'");
+      if ($parents % 2 != 0)
+        $inparents=!$inparents;
+
+// Add the line to query
+
+      $query .= $dumpline;
+
+// Don't count the line if in parents (text fields may include unlimited linebreaks)
+      
+      if (!$inparents)
+        $querylines++;
+      
+// Stop if query contains more lines as defined by MAX_QUERY_LINES
+
+      if ($querylines>MAX_QUERY_LINES)
+      {
+        echo ("<p class=\"error\">Stopped at the line $linenumber. </p>");
+        echo ("<p>At this place the current query includes more than ".MAX_QUERY_LINES." dump lines. That can happen if your dump file was ");
+        echo ("created by some tool which doesn't place a semicolon followed by a linebreak at the end of each query, or if your dump contains ");
+        echo ("extended inserts. Please read the BigDump FAQs for more infos.</p>\n");
+        $error=true;
+        break;
+      }
+
+// Execute query if end of query detected (; as last character) AND NOT in parents
+
+      if (ereg(";$",trim($dumpline)) && !$inparents)
+      { if (!TESTMODE && !mysql_query(trim($query), $dbconnection))
+        { echo ("<p class=\"error\">Error at the line $linenumber: ". trim($dumpline)."</p>\n");
+          echo ("<p>Query: ".trim(nl2br(htmlentities($query)))."</p>\n");
+          echo ("<p>MySQL: ".mysql_error()."</p>\n");
+          $error=true;
+          break;
+        }
+        $totalqueries++;
+        $queries++;
+        $query="";
+        $querylines=0;
+      }
+      $linenumber++;
+    }
+  }
+
+// Get the current file position
+
+  if (!$error)
+  { if (!$gzipmode) 
+      $foffset = ftell($file);
+    else
+      $foffset = gztell($file);
+    if (!$foffset)
+    { echo ("<p class=\"error\">UNEXPECTED: Can't read the file pointer offset</p>\n");
+      $error=true;
+    }
+  }
+
+// Print statistics
+
+skin_open();
+
+// echo ("<p class=\"centr\"><b>Statistics</b></p>\n");
+
+  if (!$error)
+  { 
+    $lines_this   = $linenumber-$_REQUEST["start"];
+    $lines_done   = $linenumber-1;
+    $lines_togo   = ' ? ';
+    $lines_tota   = ' ? ';
+    
+    $queries_this = $queries;
+    $queries_done = $totalqueries;
+    $queries_togo = ' ? ';
+    $queries_tota = ' ? ';
+
+    $bytes_this   = $foffset-$_REQUEST["foffset"];
+    $bytes_done   = $foffset;
+    $kbytes_this  = round($bytes_this/1024,2);
+    $kbytes_done  = round($bytes_done/1024,2);
+    $mbytes_this  = round($kbytes_this/1024,2);
+    $mbytes_done  = round($kbytes_done/1024,2);
+   
+    if (!$gzipmode)
+    {
+      $bytes_togo  = $filesize-$foffset;
+      $bytes_tota  = $filesize;
+      $kbytes_togo = round($bytes_togo/1024,2);
+      $kbytes_tota = round($bytes_tota/1024,2);
+      $mbytes_togo = round($kbytes_togo/1024,2);
+      $mbytes_tota = round($kbytes_tota/1024,2);
+      
+      $pct_this   = ceil($bytes_this/$filesize*100);
+      $pct_done   = ceil($foffset/$filesize*100);
+      $pct_togo   = 100 - $pct_done;
+      $pct_tota   = 100;
+
+      if ($bytes_togo==0) 
+      { $lines_togo   = '0'; 
+        $lines_tota   = $linenumber-1; 
+        $queries_togo = '0'; 
+        $queries_tota = $totalqueries; 
+      }
+
+      $pct_bar    = "<div style=\"height:15px;width:$pct_done%;background-color:#000080;margin:0px;\"></div>";
+    }
+    else
+    {
+      $bytes_togo  = ' ? ';
+      $bytes_tota  = ' ? ';
+      $kbytes_togo = ' ? ';
+      $kbytes_tota = ' ? ';
+      $mbytes_togo = ' ? ';
+      $mbytes_tota = ' ? ';
+      
+      $pct_this    = ' ? ';
+      $pct_done    = ' ? ';
+      $pct_togo    = ' ? ';
+      $pct_tota    = 100;
+      $pct_bar     = str_replace(' ','&nbsp;','<tt>[         Not available for gzipped files          ]</tt>');
+    }
+    
+    echo ("
+    <center>
+    <table width=\"520\" border=\"0\" cellpadding=\"3\" cellspacing=\"1\">
+    <tr><th class=\"bg4\"> </th><th class=\"bg4\">Session</th><th class=\"bg4\">Done</th><th class=\"bg4\">To go</th><th class=\"bg4\">Total</th></tr>
+    <tr><th class=\"bg4\">Lines</th><td class=\"bg3\">$lines_this</td><td class=\"bg3\">$lines_done</td><td class=\"bg3\">$lines_togo</td><td class=\"bg3\">$lines_tota</td></tr>
+    <tr><th class=\"bg4\">Queries</th><td class=\"bg3\">$queries_this</td><td class=\"bg3\">$queries_done</td><td class=\"bg3\">$queries_togo</td><td class=\"bg3\">$queries_tota</td></tr>
+    <tr><th class=\"bg4\">Bytes</th><td class=\"bg3\">$bytes_this</td><td class=\"bg3\">$bytes_done</td><td class=\"bg3\">$bytes_togo</td><td class=\"bg3\">$bytes_tota</td></tr>
+    <tr><th class=\"bg4\">KB</th><td class=\"bg3\">$kbytes_this</td><td class=\"bg3\">$kbytes_done</td><td class=\"bg3\">$kbytes_togo</td><td class=\"bg3\">$kbytes_tota</td></tr>
+    <tr><th class=\"bg4\">MB</th><td class=\"bg3\">$mbytes_this</td><td class=\"bg3\">$mbytes_done</td><td class=\"bg3\">$mbytes_togo</td><td class=\"bg3\">$mbytes_tota</td></tr>
+    <tr><th class=\"bg4\">%</th><td class=\"bg3\">$pct_this</td><td class=\"bg3\">$pct_done</td><td class=\"bg3\">$pct_togo</td><td class=\"bg3\">$pct_tota</td></tr>
+    <tr><th class=\"bg4\">% bar</th><td class=\"bgpctbar\" colspan=\"4\">$pct_bar</td></tr>
+    </table>
+    </center>
+    \n");
+
+// Finish message and restart the script
+
+    if ($linenumber<$_REQUEST["start"]+$linespersession)
+    { echo ("<p class=\"successcentr\">Congratulations: End of file reached, assuming OK</p>\n");
+      echo ("<p class=\"centr\">Thank you for using this tool! Please rate <a href=\"http://www.hotscripts.com/Detailed/20922.html\" target=\"_blank\">Bigdump at Hotscripts.com</a></p>\n");
+      echo ("<p class=\"centr\">You can send me some bucks or euros as appreciation via PayPal. Thank you!</p>\n");
+?>
+
+<!-- Start Paypal donation code -->
+
+<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
+<input type="hidden" name="cmd" value="_xclick" />
+<input type="hidden" name="business" value="alexey@ozerov.de" />
+<input type="hidden" name="item_name" value="BigDump Donation" />
+<input type="hidden" name="no_shipping" value="1" />
+<input type="hidden" name="no_note" value="0" />
+<input type="hidden" name="tax" value="0" />
+<input type="hidden" name="bn" value="PP-DonationsBF" />
+<input type="hidden" name="lc" value="EN" />
+<input type="image" src="https://www.paypal.com/en_US/i/btn/x-click-but04.gif" border="0" name="submit" alt="Make payments with PayPal - it's fast, free and secure!" />
+<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
+</form>
+<!-- End Paypal donation code -->
+
+<?php      
+      $error=true;
+    }
+    else
+    { if ($delaypersession!=0)
+        echo ("<p class=\"centr\">Now I'm <b>waiting $delaypersession milliseconds</b> before starting next session...</p>\n");
+        if (!$ajax) 
+          echo ("<script language=\"JavaScript\" type=\"text/javascript\">window.setTimeout('location.href=\"".$_SERVER["PHP_SELF"]."?start=$linenumber&fn=".urlencode($curfilename)."&foffset=$foffset&totalqueries=$totalqueries\";',500+$delaypersession);</script>\n");
+        echo ("<noscript>\n");
+        echo ("<p class=\"centr\"><a href=\"".$_SERVER["PHP_SELF"]."?start=$linenumber&amp;fn=".urlencode($curfilename)."&amp;foffset=$foffset&amp;totalqueries=$totalqueries\">Continue from the line $linenumber</a> (Enable JavaScript to do it automatically)</p>\n");
+        echo ("</noscript>\n");
+   
+      echo ("<p class=\"centr\">Press <b><a href=\"".$_SERVER["PHP_SELF"]."\">STOP</a></b> to abort the import <b>OR WAIT!</b></p>\n");
+    }
+  }
+  else 
+    echo ("<p class=\"error\">Stopped on error</p>\n");
+
+skin_close();
+
+}
+
+if ($error)
+  echo ("<p class=\"centr\"><a href=\"".$_SERVER["PHP_SELF"]."\">Start from the beginning</a> (DROP the old tables before restarting)</p>\n");
+
+if ($dbconnection) mysql_close();
+if ($file && !$gzipmode) fclose($file);
+else if ($file && $gzipmode) gzclose($file);
+
+?>
+
+<p class="centr"> 2003-2008 <a href="mailto:alexey@ozerov.de">Alexey Ozerov</a> - <a href="http://www.ozerov.de/bigdump.php" target="_blank">BigDump Home</a></p>
+
+</td></tr></table>
+
+</center>
+
+</body>
+</html>
+
+<?php
+
+// *******************************************************************************************
+// 				AJAX functionality starts here
+// *******************************************************************************************
+
+// Handle special situations (errors, and finish)
+
+if ($error) 
+{
+  $out1 = ob_get_contents();
+  ob_end_clean();
+  echo $out1;
+  die;
+}
+
+// Creates responses  (XML only or web page)
+
+if (($ajax) && isset($_REQUEST['start']))
+{
+  if (isset($_REQUEST['ajaxrequest'])) 
+  {	ob_end_clean();
+		create_xml_response();
+		die;
+	} 
+	else 
+	{
+	  create_ajax_script();	  
+	}  
+}
+ob_flush();
+
+// *******************************************************************************************
+// 				AJAX utilities
+// *******************************************************************************************
+
+function create_xml_response() 
+{
+  global $linenumber, $foffset, $totalqueries, $curfilename,
+				 $lines_this, $lines_done, $lines_togo, $lines_tota,
+				 $queries_this, $queries_done, $queries_togo, $queries_tota,
+				 $bytes_this, $bytes_done, $bytes_togo, $bytes_tota,
+				 $kbytes_this, $kbytes_done, $kbytes_togo, $kbytes_tota,
+				 $mbytes_this, $mbytes_done, $mbytes_togo, $mbytes_tota,
+				 $pct_this, $pct_done, $pct_togo, $pct_tota,$pct_bar;
+
+	//echo "Content-type: application/xml; charset='iso-8859-1'";
+	header('Content-Type: application/xml');
+	header('Cache-Control: no-cache');
+	/*	
+	echo '<?xml version="1.0"?>'."\n";
+	echo '<root>'."\n";
+	echo 'cos'."\n";
+	echo '</root>'."\n";
+	*/
+	
+	echo '<?xml version="1.0" encoding="ISO-8859-1"?>';
+	echo "<root>";
+	// data - for calculations
+	echo "<linenumber>";
+	echo "$linenumber";
+	echo "</linenumber>";
+	echo "<foffset>";
+	echo "$foffset";
+	echo "</foffset>";
+	echo "<fn>";
+	echo '"'.$curfilename.'"';
+	echo "</fn>";
+	echo "<totalqueries>";
+	echo "$totalqueries";
+	echo "</totalqueries>";
+	// results - for form update
+	echo "<elem1>";
+	echo "$lines_this";
+	echo "</elem1>";
+	echo "<elem2>";
+	echo "$lines_done";
+	echo "</elem2>";
+	echo "<elem3>";
+	echo "$lines_togo";
+	echo "</elem3>";
+	echo "<elem4>";
+	echo "$lines_tota";
+	echo "</elem4>";
+	
+	echo "<elem5>";
+	echo "$queries_this";
+	echo "</elem5>";
+	echo "<elem6>";
+	echo "$queries_done";
+	echo "</elem6>";
+	echo "<elem7>";
+	echo "$queries_togo";
+	echo "</elem7>";
+	echo "<elem8>";
+	echo "$queries_tota";
+	echo "</elem8>";
+	
+	echo "<elem9>";
+	echo "$bytes_this";
+	echo "</elem9>";
+	echo "<elem10>";
+	echo "$bytes_done";
+	echo "</elem10>";
+	echo "<elem11>";
+	echo "$bytes_togo";
+	echo "</elem11>";
+	echo "<elem12>";
+	echo "$bytes_tota";
+	echo "</elem12>";
+			
+	echo "<elem13>";
+	echo "$kbytes_this";
+	echo "</elem13>";
+	echo "<elem14>";
+	echo "$kbytes_done";
+	echo "</elem14>";
+	echo "<elem15>";
+	echo "$kbytes_togo";
+	echo "</elem15>";
+	echo "<elem16>";
+	echo "$kbytes_tota";
+	echo "</elem16>";
+	
+	echo "<elem17>";
+	echo "$mbytes_this";
+	echo "</elem17>";
+	echo "<elem18>";
+	echo "$mbytes_done";
+	echo "</elem18>";
+	echo "<elem19>";
+	echo "$mbytes_togo";
+	echo "</elem19>";
+	echo "<elem20>";
+	echo "$mbytes_tota";
+	echo "</elem20>";
+	
+	echo "<elem21>";
+	echo "$pct_this";
+	echo "</elem21>";
+	echo "<elem22>";
+	echo "$pct_done";
+	echo "</elem22>";
+	echo "<elem23>";
+	echo "$pct_togo";
+	echo "</elem23>";
+	echo "<elem24>";
+	echo "$pct_tota";
+	echo "</elem24>";
+	
+	// converting html to normal text
+	$pct_bar    = htmlentities($pct_bar);	  
+	echo "<elem_bar>";
+	echo "$pct_bar";
+	echo "</elem_bar>";
+				
+	echo "</root>";		
+	
+}
+
+function create_ajax_script() 
+{
+  global $linenumber, $foffset, $totalqueries, $delaypersession, $curfilename;
+	?>
+	<script type="text/javascript" language="javascript">			
+
+	// creates next action url (upload page, or XML response)
+	function get_url(linenumber,fn,foffset,totalqueries) {
+		return "<?php echo $_SERVER['PHP_SELF'] ?>?start="+linenumber+"&fn="+fn+"&foffset="+foffset+"&totalqueries="+totalqueries+"&ajaxrequest=true";
+	}
+	
+	// extracts text from XML element (itemname must be unique)
+	function get_xml_data(itemname,xmld) {
+		return xmld.getElementsByTagName(itemname).item(0).firstChild.data;
+	}
+	
+	// action url (upload page)
+	var url_request =  get_url(<?php echo $linenumber.',"'.urlencode($curfilename).'",'.$foffset.','.$totalqueries;?>);
+	var http_request = false;
+	
+	function makeRequest(url) {
+		http_request = false;
+		if (window.XMLHttpRequest) { 
+		// Mozilla,...
+			http_request = new XMLHttpRequest();
+			if (http_request.overrideMimeType) {
+				http_request.overrideMimeType("text/xml");
+			}
+		} else if (window.ActiveXObject) { 
+		// IE
+			try {
+				http_request = new ActiveXObject("Msxml2.XMLHTTP");
+			} catch(e) {
+				try {
+					http_request = new ActiveXObject("Microsoft.XMLHTTP");
+				} catch(e) {}
+			}
+		}
+		if (!http_request) {
+				alert("Cannot create an XMLHTTP instance");
+				return false;
+		}
+		http_request.onreadystatechange = server_response;
+		http_request.open("GET", url, true);
+		http_request.send(null);
+	}
+	
+	function server_response() 
+	{
+
+	  // waiting for correct response
+	  if (http_request.readyState != 4)
+			return;
+	  if (http_request.status != 200) {
+	    alert("Page unavailable, or wrong url!")
+			return;
+		}
+		
+		// r = xml response
+		var r = http_request.responseXML;
+		
+		//if received not XML but HTML with new page to show
+		if (r.getElementsByTagName('root').length == 0) {                   	//*
+			var text = http_request.responseText;
+			document.open();
+			document.write(text);		
+			document.close();	
+			return;		
+		}
+		
+		// update "Starting from line: "
+		document.getElementsByTagName('p').item(1).innerHTML = 
+			"Starting from line: " + 
+			   r.getElementsByTagName('linenumber').item(0).firstChild.nodeValue;
+		
+		// update table with new values
+		for(i = 1; i <= 24; i++) {						
+			document.getElementsByTagName('td').item(i).firstChild.data = 
+				get_xml_data('elem'+i,r);
+		}				
+		
+		// update color bar
+		document.getElementsByTagName('td').item(25).innerHTML = 
+			r.getElementsByTagName('elem_bar').item(0).firstChild.nodeValue;
+			 
+		// action url (XML response)	 
+		url_request =  get_url(
+			get_xml_data('linenumber',r),
+			get_xml_data('fn',r),
+			get_xml_data('foffset',r),
+			get_xml_data('totalqueries',r));
+		
+		// ask for XML response	
+		window.setTimeout("makeRequest(url_request)",500+<?php echo $delaypersession; ?>);
+	}
+	// ask for upload page
+	window.setTimeout("makeRequest(url_request)",500+<?php echo $delaypersession; ?>);
+	</script>
+	<?php
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/common.php php-syslog-ng/html/install/common.php
--- php-syslog-ng-2.9.f/html/install/common.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/common.php	2007-04-20 11:53:58.000000000 -0400
@@ -0,0 +1,111 @@
+<?php
+/**
+* @version $Id: common.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+error_reporting( E_ALL );
+
+header ("Cache-Control: no-cache, must-revalidate");	// HTTP/1.1
+header ("Pragma: no-cache");	// HTTP/1.0
+
+/**
+* Utility function to return a value from a named array or a specified default
+*/
+define( "_MOS_NOTRIM", 0x0001 );
+define( "_MOS_ALLOWHTML", 0x0002 );
+function mosGetParam( &$arr, $name, $def=null, $mask=0 ) {
+	$return = null;
+	if (isset( $arr[$name] )) {
+		if (is_string( $arr[$name] )) {
+			if (!($mask&_MOS_NOTRIM)) {
+				$arr[$name] = trim( $arr[$name] );
+			}
+			if (!($mask&_MOS_ALLOWHTML)) {
+				$arr[$name] = strip_tags( $arr[$name] );
+			}
+			if (!get_magic_quotes_gpc()) {
+				$arr[$name] = addslashes( $arr[$name] );
+			}
+		}
+		return $arr[$name];
+	} else {
+		return $def;
+	}
+}
+
+function mosMakePassword($length) {
+	$salt = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
+	$len = strlen($salt);
+	$makepass="";
+	mt_srand(10000000*(double)microtime());
+	for ($i = 0; $i < $length; $i++)
+	$makepass .= $salt[mt_rand(0,$len - 1)];
+	return $makepass;
+}
+
+/**
+* Chmods files and directories recursively to given permissions
+* @param path The starting file or directory (no trailing slash)
+* @param filemode Integer value to chmod files. NULL = dont chmod files.
+* @param dirmode Integer value to chmod directories. NULL = dont chmod directories.
+* @return TRUE=all succeeded FALSE=one or more chmods failed
+*/
+function mosChmodRecursive($path, $filemode=NULL, $dirmode=NULL)
+{
+	$ret = TRUE;
+	if (is_dir($path)) {
+	    $dh = opendir($path);
+	    while ($file = readdir($dh)) {
+	        if ($file != '.' && $file != '..') {
+	            $fullpath = $path.'/'.$file;
+	            if (is_dir($fullpath)) {
+                    if (!mosChmodRecursive($fullpath, $filemode, $dirmode))
+                        $ret = FALSE;
+	            } else {
+	                if (isset($filemode))
+	                    if (!@chmod($fullpath, $filemode))
+	                        $ret = FALSE;
+	            } // if
+	        } // if
+	    } // while
+	    closedir($dh);
+	    if (isset($dirmode))
+	        if (!@chmod($path, $dirmode))
+	            $ret = FALSE;
+	} else {
+		if (isset($filemode))
+			$ret = @chmod($path, $filemode);
+    } // if
+	return $ret;
+} // mosChmodRecursive
+
+// Get the 'memory_limit' setting for this php installation
+function get_memory_limit_in_metabytes() {
+	$memory_limit = ini_get('memory_limit');
+	$units        = substr($memory_limit,-1,1);
+
+	if (!is_numeric($units)) {
+		$memory_limit = intval(substr($memory_limit,0,-1));
+		$units        = strtolower($units);
+	} else {
+		// $memory_limit is in bytes
+		$memory_limit = intval($memory_limit);
+	}
+
+	// sanity check
+	if ($memory_limit <= 0) {
+		return 0;
+	}
+
+	switch ($units) {
+		case 'g': return ($memory_limit * 1024);
+		case 'm': return ($memory_limit);
+		case 'k': return ($memory_limit / 1024);
+		default:  return ($memory_limit / 1024 / 1024);
+	}
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/gpl.txt php-syslog-ng/html/install/gpl.txt
--- php-syslog-ng-2.9.f/html/install/gpl.txt	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/gpl.txt	2006-06-15 16:32:47.000000000 -0400
@@ -0,0 +1,340 @@
+		    GNU GENERAL PUBLIC LICENSE
+		       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.
+51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Library General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+		    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
+
+In addition, mere aggregation of another work not based on the Program
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
+
+The source code for a work means the preferred form of the work for
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Program.
+
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+			    NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+		     END OF TERMS AND CONDITIONS
+
+	    How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  <signature of Ty Coon>, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Library General
+Public License instead of this License.
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/index.php php-syslog-ng/html/install/index.php
--- php-syslog-ng-2.9.f/html/install/index.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/index.php	2007-07-06 10:17:41.000000000 -0400
@@ -0,0 +1,308 @@
+<?php
+/**
+* @version $Id: index.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+if (file_exists( '../config/config.php' ) && filesize( '../config/config.php' ) > 10) {
+	header( "Location: ../index.php" );
+	exit();
+}
+require_once( '../includes/version.php' );
+
+/** Include common.php */
+include_once( "common.php" );
+
+function get_php_setting($val) {
+	$r =  (ini_get($val) == '1' ? 1 : 0);
+	return $r ? 'ON' : 'OFF';
+}
+
+function writableCell( $folder ) {
+	echo '<tr>';
+	echo '<td class="item">' . $folder . '/</td>';
+	echo '<td align="left">';
+	echo is_writable( "../$folder" ) ? '<b><font color="green">Writeable</font></b>' : '<b><font color="red">Unwriteable</font></b>' . '</td>';
+	echo '</tr>';
+}
+
+echo "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?".">";
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title>PHP-Syslog-NG - Web Installer</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link rel="shortcut icon" href="../../images/favicon.ico" />
+<link rel="stylesheet" href="install.css" type="text/css" />
+<script type="text/javascript">
+<!--
+var checkobj
+function agreesubmit(el){
+	checkobj=el
+	if (document.all||document.getElementById){
+		for (i=0;i<checkobj.form.length;i++){  //hunt down submit button
+		var tempobj=checkobj.form.elements[i]
+		if(tempobj.type.toLowerCase()=="submit")
+		tempobj.disabled=!checkobj.checked
+		}
+	}
+}
+
+function defaultagree(el){
+	if (!document.all&&!document.getElementById){
+		if (window.checkobj&&checkobj.checked)
+		return true
+		else{
+			alert("Please read/accept license to continue installation")
+			return false
+		}
+	}
+}
+//-->
+</script>
+</head>
+<body>
+
+<div id="wrapper">
+<div id="header">
+<div id="psng"><img src="header_install.png" alt="PHP-Syslog-NG Installation" /></div>
+</div>
+</div>
+
+<div id="ctr" align="center">
+<div class="install">
+<div id="stepbar">
+<div class="step-on">pre-installation check</div>
+<div class="step-off">license</div>
+<div class="step-off">step 1</div>
+<div class="step-off">step 2</div>
+<div class="step-off">step 3</div>
+<div class="step-off">step 4</div>
+</div>
+
+<div id="right">
+
+<div id="step">pre-installation check</div>
+
+<div class="far-right">
+<input name="Button2" type="submit" class="button" value="Next >>" onclick="window.location='install.php';" />
+</div>
+<div class="clr"></div>
+
+<h1>Pre-installation check for:<br/><?php echo $version; ?></h1>
+<div class="install-text">
+If any of these items are highlighted
+in red then please take actions to correct them. Failure to do so
+could lead to your PHP-Syslog-NG installation not functioning
+correctly.
+<div class="ctr"></div>
+</div>
+
+<div class="install-form">
+<div class="form-block">
+
+<table class="content">
+<tr>
+	<td class="item">
+	PHP version >= 4.1.0
+	</td>
+	<td align="left">
+	<?php echo phpversion() < '4.1' ? '<b><font color="red">No</font></b>' : '<b><font color="green">Yes</font></b>';?>
+	</td>
+</tr>
+<tr>
+	<td>
+	&nbsp; - zlib compression support
+	</td>
+	<td align="left">
+	<?php echo extension_loaded('zlib') ? '<b><font color="green">Available</font></b>' : '<b><font color="red">Unavailable</font></b>';?>
+	</td>
+</tr>
+<tr>
+	<td>
+	&nbsp; - XML support
+	</td>
+	<td align="left">
+	<?php echo extension_loaded('xml') ? '<b><font color="green">Available</font></b>' : '<b><font color="red">Unavailable</font></b>';?>
+	</td>
+</tr>
+<tr>
+	<td>
+	&nbsp; - GD support
+	</td>
+	<td align="left">
+	<?php echo extension_loaded('gd') ? '<b><font color="green">Available</font></b>' : '<b><font color="red">Unavailable</font></b>';?>
+	</td>
+</tr>
+<tr>
+	<td>
+	&nbsp; - MySQL support
+	</td>
+	<td align="left">
+	<?php echo function_exists( 'mysql_connect' ) ? '<b><font color="green">Available</font></b>' : '<b><font color="red">Unavailable</font></b>';?>
+	</td>
+</tr>
+<tr>
+	<td valign="top" class="item">
+	config.php
+	</td>
+	<td align="left">
+	<?php
+	if (@file_exists('../config/config.php') &&  @is_writable( '../config/config.php' )){
+		echo '<b><font color="green">Writeable</font></b>';
+	} else if (is_writable( '..' )) {
+		echo '<b><font color="green">Writeable</font></b>';
+	} else {
+		echo '<b><font color="red">Unwriteable</font></b><br /><span class="small">Either create an empty file (config.php) with write permissions or continue the install and the configuration will be displayed at the end so you can copy & paste or upload it to the config directory.</span>';
+	} ?>
+	</td>
+</tr>
+<tr>
+	<td class="item">
+	Session save path
+	</td>
+	<td align="left">
+	<b><?php echo (($sp=ini_get('session.save_path'))?$sp:'Not set'); ?></b>,
+	<?php echo is_writable( $sp ) ? '<b><font color="green">Writeable</font></b>' : '<b><font color="red">Unwriteable</font></b>';?>
+	</td>
+</tr>
+</table>
+</div>
+</div>
+<div class="clr"></div>
+
+<h1>Recommended settings:</h1>
+<div class="install-text">
+These settings are recommended for PHP in order to ensure full
+compatibility with PHP-Syslog-NG.
+<br />
+However, PHP-Syslog-NG will still operate if your settings do not quite match the recommended
+<div class="ctr"></div>
+</div>
+
+<div class="install-form">
+<div class="form-block">
+
+<table class="content">
+<tr>
+	<td class="toggle">
+	Directive
+	</td>
+	<td class="toggle">
+	Recommended
+	</td>
+	<td class="toggle">
+	Actual
+	</td>
+</tr>
+<?php
+$php_recommended_settings = array(array ('Safe Mode','safe_mode','OFF'),
+array ('Display Errors','display_errors','ON'),
+array ('File Uploads','file_uploads','ON'),
+array ('Magic Quotes GPC','magic_quotes_gpc','ON'),
+array ('Magic Quotes Runtime','magic_quotes_runtime','OFF'),
+array ('Register Globals','register_globals','OFF'),
+array ('Output Buffering','output_buffering','OFF'),
+array ('Session auto start','session.auto_start','OFF')
+);
+
+foreach ($php_recommended_settings as $phprec) {
+?>
+<tr>
+	<td class="item"><?php echo $phprec[0]; ?>:</td>
+	<td class="toggle"><?php echo $phprec[2]; ?>:</td>
+	<td>
+	<?php
+	if ( get_php_setting($phprec[1]) == $phprec[2] ) {
+	?>
+		<font color="green"><b>
+	<?php
+	} else {
+	?>
+		<font color="red"><b>
+	<?php
+	}
+	echo get_php_setting($phprec[1]);
+	?>
+	</b></font>
+	</td>
+</tr>
+<?php
+}
+?>
+<tr>
+	<td class="item">Memory Limit:</td>
+	<td class="toggle">&gt;= 128MB:</td>
+	<td>
+	<?php
+	if (get_memory_limit_in_metabytes() >= 128) {
+	?>
+		<font color="green"><b>
+	<?php
+	} else {
+	?>
+		<font color="red"><b>
+	<?php
+	}
+	echo get_memory_limit_in_metabytes();
+	?>
+	</b></font>
+	</td>
+</tr>
+<tr>
+	<td class="item">Max Execution Time:</td>
+	<td class="toggle"> &gt;= 60 sec:</td>
+	<td>
+	<?php
+	if (ini_get("max_execution_time") >= 60) {
+	?>
+		<font color="green"><b>
+	<?php
+	} else {
+	?>
+		<font color="red"><b>
+	<?php
+	}
+		echo ini_get("max_execution_time");
+	?>
+	</b></font>
+	</td>
+</tr>
+</table>
+</div>
+</div>
+<div class="clr"></div>
+
+<h1>Directory and File Permissions:</h1>
+<div class="install-text">
+In order for PHP-Syslog-NG to function
+correctly it needs to be able to access or write to certain files
+or directories. If you see "Unwriteable" you need to change the
+permissions on the file or directory to allow PHP-Syslog-NG
+to write to it.
+<div class="clr">&nbsp;&nbsp;</div>
+<div class="ctr"></div>
+</div>
+
+<div class="install-form">
+<div class="form-block">
+
+<table class="content">
+<?php
+writableCell( 'config' );
+writableCell( 'jpcache' );
+?>
+</table>
+</div>
+<div class="clr"></div>
+</div>
+<div class="clr"></div>
+</div>
+<div class="clr"></div>
+</div>
+</div>
+</body>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/install1.php php-syslog-ng/html/install/install1.php
--- php-syslog-ng-2.9.f/html/install/install1.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/install1.php	2009-02-23 13:04:44.000000000 -0500
@@ -0,0 +1,215 @@
+<?php
+/**
+* @version $Id: install1.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+/** Include common.php */
+include_once( 'common.php' );
+include_once( '../includes/version.php' );
+
+$DBhostname = mosGetParam( $_POST, 'DBhostname', 'localhost' );
+$DBuserName = mosGetParam( $_POST, 'DBuserName', 'root' );
+$DBpassword = mosGetParam( $_POST, 'DBpassword', '' );
+$DBverifypassword = mosGetParam( $_POST, 'DBverifypassword', '' );
+$SLuserName = mosGetParam( $_POST, 'SLuserName', 'sysloguser' );
+$SLUpassword = mosGetParam( $_POST, 'SLUpassword', 'sysloguser' );
+$SLUverifypassword = mosGetParam( $_POST, 'SLUverifypassword', 'sysloguser' );
+$SLAuserName = mosGetParam( $_POST, 'SLAuserName', 'syslogadmin' );
+$SLApassword = mosGetParam( $_POST, 'SLApassword', 'syslogadmin' );
+$SLAverifypassword = mosGetParam( $_POST, 'SLAverifypassword', 'syslogadmin' );
+$DBname  	= mosGetParam( $_POST, 'DBname', 'syslog' );
+$DBPort     = mosGetParam( $_POST, 'DBPort', '3306' );
+$DBPrefix  	= mosGetParam( $_POST, 'DBPrefix', '' );
+$DBDel  	= intval( mosGetParam( $_POST, 'DBDel', 0 ) );
+$DBBackup  	= intval( mosGetParam( $_POST, 'DBBackup', 0 ) );
+$DBSample  	= intval( mosGetParam( $_POST, 'DBSample', 1 ) );
+$CEMDB  	= intval( mosGetParam( $_POST, 'CEMDB', 1 ) );
+
+echo "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?".">";
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title><?php echo $_VERSION->PRODUCT; ?> - Web Installer</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link rel="shortcut icon" href="../../images/favicon.ico" />
+<link rel="stylesheet" href="install.css" type="text/css" />
+<script  type="text/javascript">
+<!--
+function check()
+{
+	// form validation check
+	var formValid=false;
+	var f = document.form;
+	if ( f.DBhostname.value == '' ) {
+		alert('Please enter a Host name');
+		f.DBhostname.focus();
+		formValid=false;
+	} else if ( f.DBuserName.value == '' ) {
+		alert('Please enter a Database User Name');
+		f.DBuserName.focus();
+		formValid=false;	
+	} else if ( f.DBname.value == '' ) {
+		alert('Please enter a Name for your new Database');
+		f.DBname.focus();
+		formValid=false;
+	} else if ( confirm('Are you sure these settings are correct? \n<?php echo $_VERSION->PRODUCT; ?> will now attempt to populate a Database with the settings you have supplied\n')) {
+		formValid=true;
+	} 
+	return formValid;
+}
+//-->
+</script>
+</head>
+<body onload="document.form.DBhostname.focus();">
+<div id="wrapper">
+	<div id="header">
+		<div id="psng"><img src="header_install.png" alt="<?php echo $_VERSION->PRODUCT; ?> Installation" /></div>
+	</div>
+</div>
+<div id="ctr" align="center">
+	<form action="install2.php" method="post" name="form" id="form" onsubmit="return check();">
+	<div class="install">
+		<div id="stepbar">
+			<div class="step-off">pre-installation check</div>
+			<div class="step-off">license</div>
+			<div class="step-on">step 1</div>
+			<div class="step-off">step 2</div>
+			<div class="step-off">step 3</div>
+			<div class="step-off">step 4</div>
+		</div>
+		<div id="right">
+			<div class="far-right">
+				<input class="button" type="submit" name="next" value="Next >>"/>
+  			</div>
+	  		<div id="step">step 1</div>
+  			<div class="clr"></div>
+  			<h1>MySQL database configuration:</h1>
+	  		<div class="install-text">
+  	   			<p>Setting up <?php echo $_VERSION->PRODUCT; ?> to run on your server involves 4 simple steps...</p>
+  	   			<p>Please enter the hostname of the server <?php echo $_VERSION->PRODUCT; ?> is to be installed on.</p>
+				<p>Enter the MySQL username, password and database name you wish to use with <?php echo $_VERSION->PRODUCT; ?>.</p>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				<p>Enter the table name prefix (if any) to be used by this <?php echo $_VERSION->PRODUCT; ?> instance and select what
+				   to do in case there are existing tables from former installations.</p>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				   <br>
+				<p>Install the samples unless you want to start with a completely empty site.<br>
+  			</div>
+			<div class="install-form">
+  	   			<div class="form-block">
+  		 			<table class="content2">
+  		  			<tr>
+  						<td></td>
+  						<td></td>
+  						<td></td>
+  					</tr>
+  		  			<tr>
+  						<td colspan="2">Host Name<br/><input class="inputbox" type="text" name="DBhostname" value="<?php echo "$DBhostname"; ?>" /></td>
+			  			<td><em>This is usually 'localhost'</em></td>
+  					</tr>
+					<tr>
+			  			<td colspan="2">MySQL User Name<br/><input class="inputbox" type="text" name="DBuserName" value="<?php echo "$DBuserName"; ?>" /></td>
+			  			<td><em>Enter a valid username such as 'root' or a username given by your server administrator.</em></td>
+  					</tr>
+			  		<tr>
+			  			<td colspan="2">MySQL Password<br/><input class="inputbox" type="password" name="DBpassword" value="<?php echo "$DBpassword"; ?>" /></td>
+			  			<td><em>For site security using a password for the mysql account is mandatory</em></td>
+					</tr>
+					<tr>
+			  			<td colspan="2">Verify MySQL Password<br/><input class="inputbox" type="password" name="DBverifypassword" value="<?php echo "$DBverifypassword"; ?>" /></td>
+			  			<td><em>Retype password for verification</em></td>
+					</tr>
+  		  			<tr>
+  						<td colspan="2">MySQL Database Name<br/><input class="inputbox" type="text" name="DBname" value="<?php echo "$DBname"; ?>" /></td>
+			  			<td><em>Some hosts only allow a certain DB name per site. If this is the case, set that name here and use the Prefix option below. </em></td>
+  					</tr>
+  		  			<tr>
+  						<td colspan="2">MySQL Port<br/><input class="inputbox" type="text" name="DBPort" value="<?php echo "$DBPort"; ?>" /></td>
+			  			<td><em>Specify the port which MySQL is running on (Default is 3306)</em></td>
+  					</tr>
+  		  			<tr>
+  						<td colspan="2">MySQL Table Prefix<br/><input class="inputbox" type="text" name="DBPrefix" value="<?php echo "$DBPrefix"; ?>" /></td>
+			  			<td><em>Do NOT use 'old_' since this is used for backup tables</em></td>
+  					</tr>
+					<tr>
+			  			<td colspan="2">Syslog User Name<br/><input class="inputbox" type="text" name="SLuserName" value="<?php echo "$SLuserName"; ?>" /></td>
+			  			<td><em>This user is used to access the SQL (read) data on the backend, there's probably no need to change it from the default (sysloguser) </em></td>
+  					</tr>
+			  		<tr>
+			  			<td colspan="2">Syslog User Password<br/><input class="inputbox" type="password" name="SLUpassword" value="<?php echo "$SLUpassword"; ?>" /></td>
+			  			<td><em>For site security using a password for the mysql account is mandatory</em></td>
+					</tr>
+					<tr>
+			  			<td colspan="2">Verify Password<br/><input class="inputbox" type="password" name="SLUverifypassword" value="<?php echo "$SLUverifypassword"; ?>" /></td>
+			  			<td><em>Retype password for verification</em></td>
+					</tr>
+					<tr>
+			  			<td colspan="2">Syslog Admin Name<br/><input class="inputbox" type="text" name="SLAuserName" value="<?php echo "$SLAuserName"; ?>" /></td>
+			  			<td><em>This user is used to access the SQL (write) data on the backend, there's probably no need to change it from the default (syslogadmin) </em></td>
+  					</tr>
+			  		<tr>
+			  			<td colspan="2">Syslog Admin Password<br/><input class="inputbox" type="password" name="SLApassword" value="<?php echo "$SLApassword"; ?>" /></td>
+			  			<td><em>For site security using a password for the mysql account is mandatory</em></td>
+					</tr>
+					<tr>
+			  			<td colspan="2">Verify Password<br/><input class="inputbox" type="password" name="SLAverifypassword" value="<?php echo "$SLAverifypassword"; ?>" /></td>
+			  			<td><em>Retype password for verification</em></td>
+					</tr>
+  		  			<tr>
+			  			<td><input type="checkbox" name="DBDel" id="DBDel" value="1" <?php if ($DBDel) echo 'checked="checked"'; ?> /></td>
+						<td><label for="DBDel">Drop Existing Tables</label></td>
+  						<td>&nbsp;</td>
+			  		</tr>
+  		  			<tr>
+			  			<td><input type="checkbox" name="DBBackup" id="DBBackup" value="1" <?php if ($DBBackup) echo 'checked="checked"'; ?> /></td>
+						<td><label for="DBBackup">Backup Old Tables</label></td>
+  						<td><em>Any existing backup tables from former installations will be replaced</em></td>
+			  		</tr>
+					<!--
+  		  			<tr>
+			  			<td><input type="checkbox" name="DBSample" id="DBSample" value="1" <?php if ($DBSample) echo 'checked="checked"'; ?> /></td>
+						<td><label for="DBSample">Install Sample Data</label></td>
+			  			<td><em>Checking this option will install sample data</em></td>
+			  		</tr>
+					-->
+  		  			<tr>
+			  			<td><input type="checkbox" name="CEMDB" id="CEMDB" value="1" <?php if ($CEMDB) echo 'checked="checked"'; ?> /></td>
+						<td><label for="CEMDB">Install CEMDB Data</label></td>
+			  			<td><em>Checking this option will install data for the Cisco Error Message Database</em></td>
+			  		</tr>
+		  		 	</table>
+  				</div>
+			</div>
+		</div>
+		<div class="clr"></div>
+	</div>
+	</form>
+</div>
+<div class="clr"></div>
+</body>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/install2.php php-syslog-ng/html/install/install2.php
--- php-syslog-ng-2.9.f/html/install/install2.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/install2.php	2008-03-20 21:20:21.000000000 -0400
@@ -0,0 +1,329 @@
+<?php
+/**
+* @version $Id: install2.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+// Set flag that this is a parent file
+define( "_VALID_MOS", 1 );
+
+// Include common.php
+require_once( 'common.php' );
+require_once( '../includes/database.php' );
+require_once( '../includes/version.php' );
+
+$DBhostname = mosGetParam( $_POST, 'DBhostname', '' );
+$DBuserName = mosGetParam( $_POST, 'DBuserName', '' );
+$DBpassword = mosGetParam( $_POST, 'DBpassword', '' );
+$DBverifypassword = mosGetParam( $_POST, 'DBverifypassword', '' );
+$SLuserName = mosGetParam( $_POST, 'SLuserName', '' );
+$SLUpassword = mosGetParam( $_POST, 'SLUpassword', '' );
+$SLUverifypassword = mosGetParam( $_POST, 'SLUverifypassword', '' );
+$SLAuserName = mosGetParam( $_POST, 'SLAuserName', '' );
+$SLApassword = mosGetParam( $_POST, 'SLApassword', '' );
+$SLAverifypassword = mosGetParam( $_POST, 'SLAverifypassword', '' );
+$DBname  	= mosGetParam( $_POST, 'DBname', '' );
+$DBPort     = mosGetParam( $_POST, 'DBPort', '' );
+$DBPrefix  	= mosGetParam( $_POST, 'DBPrefix', '' );
+$DBDel  	= intval( mosGetParam( $_POST, 'DBDel', 0 ) );
+$DBBackup  	= intval( mosGetParam( $_POST, 'DBBackup', 0 ) );
+$DBSample	= intval( mosGetParam( $_POST, 'DBSample', 0 ) );
+$CEMDB	= intval( mosGetParam( $_POST, 'CEMDB', 0 ) );
+$DBcreated	= intval( mosGetParam( $_POST, 'DBcreated', 0 ) );
+$BUPrefix = 'old_';
+$configArray['sitename'] = trim( mosGetParam( $_POST, 'sitename', '' ) );
+
+$database = null;
+
+$errors = array();
+if (!$DBcreated){
+	if (!$DBhostname || !$DBuserName || !$DBname) {
+		db_err ("stepBack3","The database details provided are incorrect and/or empty.");
+	}
+	
+	if ($DBpassword !== $DBverifypassword) {
+		db_err ("stepBack3","The database passwords provided do not match.  Please try again.");
+	}
+
+	/*
+	   if ($DBPort) {
+	   $DBserver = "$DBhostname:$DBPort";
+	   } else {
+	   $DBserver = $DBhostname;
+	   }	
+	 */
+	$DBserver = ($DBPort) ? "$DBhostname:$DBPort" : "$DBhostname";
+	if (!($mysql_link = @mysql_connect( $DBserver, $DBuserName,
+					$DBpassword ))) {
+		db_err ("stepBack2","MySQL Error: " . mysql_error());
+	}
+	if($DBname == "") {
+		db_err ("stepBack","The database name provided is empty.");
+	}
+
+	$configArray['DBhostname'] = $DBhostname;
+	$configArray['DBuserName'] = $DBuserName;
+	$configArray['DBpassword'] = $DBpassword;
+	$configArray['DBname']	 = $DBname;
+	$configArray['DBPort']	 = $DBPort;
+	$configArray['DBPrefix']   = $DBPrefix;
+
+	$sql = "CREATE DATABASE `$DBname`";
+	$mysql_result = mysql_query( $sql );
+	$test = mysql_errno();
+
+	if ($test <> 0 && $test <> 1007) {
+		db_err( "stepBack", "A database error occurred: " . (mysql_error()) );
+	}
+
+	// db is now new or existing, create the db object connector to do the serious work
+    $DBserver = ($DBPort) ? "$DBhostname:$DBPort" : "$DBhostname";
+	$database = new database( $DBserver, $DBuserName, $DBpassword, $DBname, $DBPrefix );
+
+	// delete existing mos table if requested
+	if ($DBDel) {
+		$database->setQuery( "SHOW TABLES FROM `$DBname`" );
+		$errors = array();
+		if ($tables = $database->loadResultArray()) {
+			foreach ($tables as $table) {
+				if ($DBPrefix) {
+					if (strpos( $table, $DBPrefix ) === 0) {
+						if ($DBBackup) {
+							$butable = str_replace( $DBPrefix, $BUPrefix, $table );
+							$database->setQuery( "DROP TABLE IF EXISTS `$butable`" );
+							$database->query();
+							if ($database->getErrorNum()) {
+								$errors[$database->getQuery()] = $database->getErrorMsg();
+							}
+							$database->setQuery( "RENAME TABLE `$table` TO `$butable`" );
+							$database->query();
+							if ($database->getErrorNum()) {
+								$errors[$database->getQuery()] = $database->getErrorMsg();
+							}
+						}
+					}
+				} else {
+					if ($DBBackup) {
+						$butable = $BUPrefix .$table;
+						$database->setQuery( "DROP TABLE IF EXISTS `$butable`" );
+						$database->query();
+						if ($database->getErrorNum()) {
+							$errors[$database->getQuery()] = $database->getErrorMsg();
+						}
+						$database->setQuery( "RENAME TABLE `$table` TO `$butable`" );
+						$database->query();
+						if ($database->getErrorNum()) {
+							$errors[$database->getQuery()] = $database->getErrorMsg();
+						}
+					}
+				}
+				$database->setQuery( "DROP TABLE IF EXISTS `$table`" );
+				$database->query();
+				if ($database->getErrorNum()) {
+					$errors[$database->getQuery()] = $database->getErrorMsg();
+				}
+			}
+		}
+	}
+
+	populate_db($DBname,$DBPrefix,'dbsetup.sql');
+	if ($DBSample) {
+		populate_db($DBname,$DBPrefix,'sample_data.sql');
+	}
+	if ($CEMDB) {
+		// Removed for now - database is too large to import here
+		// it must be done manually from the command line
+		// populate_db($DBname,$DBPrefix,'cemdb.sql');
+	}
+	$DBcreated = 1;
+}
+
+function db_err($step, $alert) {
+	global $DBhostname,$DBuserName,$DBpassword,$DBDel,$DBname,$DBPort;
+	echo "<form name=\"$step\" method=\"post\" action=\"install1.php\">
+	<input type=\"hidden\" name=\"DBhostname\" value=\"$DBhostname\">
+	<input type=\"hidden\" name=\"DBuserName\" value=\"$DBuserName\">
+	<input type=\"hidden\" name=\"DBpassword\" value=\"$DBpassword\">
+	<input type=\"hidden\" name=\"DBDel\" value=\"$DBDel\">
+	<input type=\"hidden\" name=\"DBname\" value=\"$DBname\">
+	</form>\n";
+	//echo "<script>alert(\"$alert\"); document.$step.submit();</script>";
+	echo "<script>alert(\"$alert\"); window.history.go(-1);</script>";  //this wasn't working
+	exit();
+}
+
+function populate_db($DBname, $DBPrefix, $sqlfile='dbsetup.sql') {
+	global $errors;
+
+	mysql_select_db($DBname);
+	$mqr = @get_magic_quotes_runtime();
+	@set_magic_quotes_runtime(0);
+	$query = fread(fopen("sql/".$sqlfile, "r"), filesize("sql/".$sqlfile));
+	@set_magic_quotes_runtime($mqr);
+	$pieces  = split_sql($query);
+
+	for ($i=0; $i<count($pieces); $i++) {
+		$pieces[$i] = trim($pieces[$i]);
+		if(!empty($pieces[$i]) && $pieces[$i] != "#") {
+			$pieces[$i] = str_replace( "#__", $DBPrefix, $pieces[$i]);
+			if (!$result = mysql_query ($pieces[$i])) {
+				$errors[] = array ( mysql_error(), $pieces[$i] );
+			}
+		}
+	}
+}
+
+function split_sql($sql) {
+	$sql = trim($sql);
+	$sql = ereg_replace("\n#[^\n]*\n", "\n", $sql);
+
+	$buffer = array();
+	$ret = array();
+	$in_string = false;
+
+	for($i=0; $i<strlen($sql)-1; $i++) {
+		if($sql[$i] == ";" && !$in_string) {
+			$ret[] = substr($sql, 0, $i);
+			$sql = substr($sql, $i + 1);
+			$i = 0;
+		}
+
+		if($in_string && ($sql[$i] == $in_string) && $buffer[1] != "\\") {
+			$in_string = false;
+		}
+		elseif(!$in_string && ($sql[$i] == '"' || $sql[$i] == "'") && (!isset($buffer[0]) || $buffer[0] != "\\")) {
+			$in_string = $sql[$i];
+		}
+		if(isset($buffer[1])) {
+			$buffer[0] = $buffer[1];
+		}
+		$buffer[1] = $sql[$i];
+	}
+
+	if(!empty($sql)) {
+		$ret[] = $sql;
+	}
+	return($ret);
+}
+
+$isErr = intval( count( $errors ) );
+
+echo "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?".">";
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title><?php echo $_VERSION->PRODUCT; ?> - Web Installer</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link rel="shortcut icon" href="../../images/favicon.ico" />
+<link rel="stylesheet" href="install.css" type="text/css" />
+<script type="text/javascript">
+<!--
+function check() {
+	// form validation check
+	var formValid = true;
+	var f = document.form;
+	if ( f.sitename.value == '' ) {
+		alert('Please enter a Site Name');
+		f.sitename.focus();
+		formValid = false
+	}
+	return formValid;
+}
+//-->
+</script>
+</head>
+<body onload="document.form.sitename.focus();">
+<div id="wrapper">
+	<div id="header">
+	  <div id="psng"><img src="header_install.png" alt="<?php echo $_VERSION->PRODUCT; ?> Installation" /></div>
+	</div>
+</div>
+
+<div id="ctr" align="center">
+	<form action="install3.php" method="post" name="form" id="form" onsubmit="return check();">
+	<input type="hidden" name="DBhostname" value="<?php echo "$DBhostname"; ?>" />
+	<input type="hidden" name="DBuserName" value="<?php echo "$DBuserName"; ?>" />
+	<input type="hidden" name="DBpassword" value="<?php echo "$DBpassword"; ?>" />
+	<input type="hidden" name="DBname" value="<?php echo "$DBname"; ?>" />
+	<input type="hidden" name="DBPort" value="<?php echo "$DBPort"; ?>" />
+	<input type="hidden" name="SLuserName" value="<?php echo "$SLuserName"; ?>" />
+	<input type="hidden" name="SLUpassword" value="<?php echo "$SLUpassword"; ?>" />
+	<input type="hidden" name="SLAuserName" value="<?php echo "$SLAuserName"; ?>" />
+	<input type="hidden" name="SLApassword" value="<?php echo "$SLApassword"; ?>" />
+	<input type="hidden" name="DBPrefix" value="<?php echo "$DBPrefix"; ?>" />
+	<input type="hidden" name="DBcreated" value="<?php echo "$DBcreated"; ?>" />
+	<div class="install">
+		<div id="stepbar">
+		  	<div class="step-off">pre-installation check</div>
+	  		<div class="step-off">license</div>
+		  	<div class="step-off">step 1</div>
+		  	<div class="step-on">step 2</div>
+	  		<div class="step-off">step 3</div>
+		  	<div class="step-off">step 4</div>
+		</div>
+		<div id="right">
+  			<div class="far-right">
+<?php if (!$isErr) { ?>
+  		  		<input class="button" type="submit" name="next" value="Next >>"/>
+<?php } ?>
+  			</div>
+	  		<div id="step">step 2</div>
+  			<div class="clr"></div>
+
+  			<h1>Enter the name of your <?php echo $_VERSION->PRODUCT; ?> site:</h1>
+			<div class="install-text">
+<?php if ($isErr) { ?>
+			Looks like there have been some errors with inserting data into your database!<br />
+  			You cannot continue.
+<?php } else { ?>
+			SUCCESS!
+			<br/>
+			<br/>
+  			Type in the name for your <?php echo $_VERSION->PRODUCT; ?> site. This
+			name is used in email messages so make it something meaningful.
+<?php } ?>
+  		</div>
+  		<div class="install-form">
+  			<div class="form-block">
+  				<table class="content2">
+<?php
+			if ($isErr) {
+				echo '<tr><td colspan="2">';
+				echo '<b></b>';
+				echo "<br/><br />Error log:<br />\n";
+				// abrupt failure
+				echo '<textarea rows="10" cols="50">';
+				foreach($errors as $error) {
+					echo "SQL=$error[0]:\n- - - - - - - - - -\n$error[1]\n= = = = = = = = = =\n\n";
+				}
+				echo '</textarea>';
+				echo "</td></tr>\n";
+  			} else {
+?>
+  				<tr>
+  					<td width="100">Site name</td>
+  					<td align="center"><input class="inputbox" type="text" name="sitename" size="50" value="<?php echo "{$configArray['sitename']}"; ?>" /></td>
+  				</tr>
+  				<tr>
+  					<td width="100">&nbsp;</td>
+  					<td align="center" class="small">e.g. The Home of <?php echo $_VERSION->PRODUCT; ?></td>
+  				</tr>
+  				</table>
+<?php
+  			} // if
+?>
+  			</div>
+  		</div>
+  		<div class="clr"></div>
+  		<div id="break"></div>
+	</div>
+	<div class="clr"></div>
+	</form>
+</div>
+<div class="clr"></div>
+</div>
+</body>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/install3.php php-syslog-ng/html/install/install3.php
--- php-syslog-ng-2.9.f/html/install/install3.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/install3.php	2008-03-20 21:20:21.000000000 -0400
@@ -0,0 +1,340 @@
+<?php
+/**
+* @version $Id: install3.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+/** Include common.php */
+require_once( 'common.php' );
+require_once( '../includes/version.php' );
+
+$DBhostname = mosGetParam( $_POST, 'DBhostname', '' );
+$DBuserName = mosGetParam( $_POST, 'DBuserName', '' );
+$DBpassword = mosGetParam( $_POST, 'DBpassword', '' );
+$SLuserName = mosGetParam( $_POST, 'SLuserName', '' );
+$SLUpassword = mosGetParam( $_POST, 'SLUpassword', '' );
+$SLAuserName = mosGetParam( $_POST, 'SLAuserName', '' );
+$SLApassword = mosGetParam( $_POST, 'SLApassword', '' );
+$DBname  	= mosGetParam( $_POST, 'DBname', '' );
+$DBPort     = mosGetParam( $_POST, 'DBPort', '' );
+$DBPrefix  	= mosGetParam( $_POST, 'DBPrefix', '' );
+$sitename  	= mosGetParam( $_POST, 'sitename', '' );
+$adminEmail = mosGetParam( $_POST, 'adminEmail', '');
+$filePerms	= mosGetParam( $_POST, 'filePerms', '');
+$dirPerms	= mosGetParam( $_POST, 'dirPerms', '');
+$SITEURL	= mosGetParam( $_POST, 'SITEURL', '/');
+$configArray['siteUrl'] = trim( mosGetParam( $_POST, 'siteUrl', '' ) );
+$configArray['absolutePath'] = trim( mosGetParam( $_POST, 'absolutePath', '' ) );
+if (get_magic_quotes_gpc()) {
+	$configArray['absolutePath'] = stripslashes(stripslashes($configArray['absolutePath']));
+	$sitename = stripslashes(stripslashes($sitename));
+}
+
+if ($sitename == '') {
+	echo "<form name=\"stepBack\" method=\"post\" action=\"install2.php\">
+			<input type=\"hidden\" name=\"DBhostname\" value=\"$DBhostname\">
+			<input type=\"hidden\" name=\"DBuserName\" value=\"$DBuserName\">
+			<input type=\"hidden\" name=\"DBpassword\" value=\"$DBpassword\">
+			<input type=\"hidden\" name=\"DBname\" value=\"$DBname\">
+			<input type=\"hidden\" name=\"DBPort\" value=\"$DBPort\">
+			<input type=\"hidden\" name=\"SLuserName\" value=\"$SLuserName\">
+			<input type=\"hidden\" name=\"SLUpassword\" value=\"$SLUpassword\">
+			<input type=\"hidden\" name=\"SLAuserName\" value=\"$SLAuserName\">
+			<input type=\"hidden\" name=\"SLApassword\" value=\"$SLApassword\">
+			<input type=\"hidden\" name=\"DBPrefix\" value=\"$DBPrefix\">
+			<input type=\"hidden\" name=\"DBcreated\" value=1>
+		</form>";
+
+	echo "<script>alert('The sitename has not been provided'); document.stepBack.submit();</script>";
+	return;
+}
+
+echo "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?".">";
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title><?php echo $_VERSION->PRODUCT ?> - Web Installer</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link rel="shortcut icon" href="../../images/favicon.ico" />
+<link rel="stylesheet" href="install.css" type="text/css" />
+<script type="text/javascript">
+<!--
+function check() {
+	// form validation check
+	var formValid = true;
+	var f = document.form;
+	if ( f.siteUrl.value == '' ) {
+		alert('Please enter Site URL');
+		f.siteUrl.focus();
+		formValid = false;
+	} else if ( f.absolutePath.value == '' ) {
+		alert('Please enter the absolute path to your site');
+		f.absolutePath.focus();
+		formValid = false;
+	} else if ( f.adminEmail.value == '' ) {
+		alert('Please enter an email address to contact your administrator');
+		f.adminEmail.focus();
+		formValid = false;
+	} else if ( f.adminPassword.value == '' ) {
+		alert('Please enter a password for you administrator');
+		f.adminPassword.focus();
+		formValid = false;
+	}
+
+	return formValid;
+}
+
+function changeFilePermsMode(mode)
+{
+	if(document.getElementById) {
+		switch (mode) {
+			case 0:
+				document.getElementById('filePermsFlags').style.display = 'none';
+				break;
+			default:
+				document.getElementById('filePermsFlags').style.display = '';
+		} // switch
+	} // if
+}
+
+function changeDirPermsMode(mode)
+{
+	if(document.getElementById) {
+		switch (mode) {
+			case 0:
+				document.getElementById('dirPermsFlags').style.display = 'none';
+				break;
+			default:
+				document.getElementById('dirPermsFlags').style.display = '';
+		} // switch
+	} // if
+}
+//-->
+</script>
+</head>
+<body onload="document.form.siteUrl.focus();">
+<div id="wrapper">
+	<div id="header">
+		<div id="psng"><img src="header_install.png" alt="<?php echo $_VERSION->PRODUCT; ?> Installation" /></div>
+	</div>
+</div>
+<div id="ctr" align="center">
+	<form action="install4.php" method="post" name="form" id="form" onsubmit="return check();">
+	<input type="hidden" name="DBhostname" value="<?php echo "$DBhostname"; ?>" />
+	<input type="hidden" name="DBuserName" value="<?php echo "$DBuserName"; ?>" />
+	<input type="hidden" name="DBpassword" value="<?php echo "$DBpassword"; ?>" />
+	<input type="hidden" name="DBname" value="<?php echo "$DBname"; ?>" />
+	<input type="hidden" name="DBPort" value="<?php echo "$DBPort"; ?>" />
+	<input type="hidden" name="SLuserName" value="<?php echo "$SLuserName"; ?>" />
+	<input type="hidden" name="SLUpassword" value="<?php echo "$SLUpassword"; ?>" />
+	<input type="hidden" name="SLAuserName" value="<?php echo "$SLAuserName"; ?>" />
+	<input type="hidden" name="SLApassword" value="<?php echo "$SLApassword"; ?>" />
+	<input type="hidden" name="DBPrefix" value="<?php echo "$DBPrefix"; ?>" />
+	<input type="hidden" name="sitename" value="<?php echo "$sitename"; ?>" />
+	<div class="install">
+		<div id="stepbar">
+			<div class="step-off">pre-installation check</div>
+			<div class="step-off">license</div>
+			<div class="step-off">step 1</div>
+			<div class="step-off">step 2</div>
+			<div class="step-on">step 3</div>
+			<div class="step-off">step 4</div>
+		</div>
+		<div id="right">
+			<div id="step">step 3</div>
+			<div class="far-right">
+				<input class="button" type="submit" name="next" value="Next >>"/>
+			</div>
+			<div class="clr"></div>
+			<h1>Confirm the site URL, path, admin e-mail and file/directory chmods</h1>
+			<div class="install-text">
+				  <p>If URL and Path looks correct then please do not change.
+				  If you are not sure then please contact your ISP or administrator. Usually
+				  the values displayed will work for your site. <br><p>SITEURL is used to indicate
+				  that this server is installed in a subdirectory such as <u>http://server/syslog/</u>
+				  <br> Be sure to include a trailing slash on SITEURL
+				  <br/>
+				  <br/>
+				  Enter your e-mail address, this will be the e-mail address of the site
+				  SuperAdministrator.<br />
+				  <br/>
+				  The permission settings will be used while installing <?php echo $_VERSION->PRODUCT; ?> itself, by
+				  the <?php echo $_VERSION->PRODUCT; ?> addon-installers and by the media manager. If you are unsure
+				  what flags should be set, leave the default settings at the moment.
+				  You can still change these flags later in the site global configuration.</p>
+			</div>
+			<div class="install-form">
+				<div class="form-block">
+					<table class="content2">
+					<tr>
+						<td width="100">URL</td>
+<?php
+	$url = "";
+	if ($configArray['siteUrl'])
+		$url = $configArray['siteUrl'];
+	else {
+		$root = $_SERVER['SERVER_NAME'].$_SERVER['PHP_SELF'];
+		$root = str_replace("install/","",$root);
+		$root = str_replace("/install3.php","",$root);
+		$url = "http://".$root;
+	}
+?>						<td align="center"><input class="inputbox" type="text" name="siteUrl" value="<?php echo $url; ?>" size="50"/></td>
+					</tr>
+					<tr>
+						<td>Install Path</td>
+<?php
+	$abspath = "";
+	if ($configArray['absolutePath'])
+		$abspath = $configArray['absolutePath'];
+	else {
+		$path = getcwd();
+		if (preg_match("/\/install/i", "$path"))
+			$abspath = str_replace('/install',"",$path);
+		else
+			$abspath = str_replace('\install',"",$path);
+	}
+?>						<td align="center"><input class="inputbox" type="text" name="absolutePath" value="<?php echo $abspath; ?>" size="50"/></td>
+					</tr>
+					<tr>
+						<td>Site URL</td>
+						<td align="center"><input class="inputbox" type="text" name="SITEURL" value="<?php echo $SITEURL; ?>" size="50"/></td>
+					</tr>
+					<tr>
+						<td>Your E-mail</td>
+						<td align="center"><input class="inputbox" type="text" name="adminEmail" value="<?php echo "$adminEmail"; ?>" size="50" /></td>
+					</tr>
+					<tr>
+						<td>Admin password</td>
+						<td align="center"><input class="inputbox" type="text" name="adminPassword" value="<?php echo mosMakePassword(8); ?>" size="50"/></td>
+					</tr>
+					<tr>
+<?php
+	$mode = 0;
+	$flags = 0644;
+	if ($filePerms!='') {
+		$mode = 1;
+		$flags = octdec($filePerms);
+	} // if
+?>
+						<td colspan="2">
+  							<fieldset><legend>File Permissions</legend>
+								<table cellpadding="1" cellspacing="1" border="0">
+									<tr>
+										<td><input type="radio" id="filePermsMode0" name="filePermsMode" value="0" onclick="changeFilePermsMode(0)"<?php if (!$mode) echo ' checked="checked"'; ?>/></td>
+										<td><label for="filePermsMode0">Dont CHMOD files (use server defaults)</label></td>
+									</tr>
+									<tr>
+										<td><input type="radio" id="filePermsMode1" name="filePermsMode" value="1" onclick="changeFilePermsMode(1)"<?php if ($mode) echo ' checked="checked"'; ?>/></td>
+										<td><label for="filePermsMode1"> CHMOD files to:</label></td>
+									</tr>
+									<tr id="filePermsFlags"<?php if (!$mode) echo ' style="display:none"'; ?>>
+										<td>&nbsp;</td>
+										<td>
+											<table cellpadding="1" cellspacing="0" border="0">
+												<tr>
+													<td>User:</td>
+													<td><input type="checkbox" id="filePermsUserRead" name="filePermsUserRead" value="1"<?php if ($flags & 0400) echo ' checked="checked"'; ?>/></td>
+													<td><label for="filePermsUserRead">read</label></td>
+													<td><input type="checkbox" id="filePermsUserWrite" name="filePermsUserWrite" value="1"<?php if ($flags & 0200) echo ' checked="checked"'; ?>/></td>
+													<td><label for="filePermsUserWrite">write</label></td>
+													<td><input type="checkbox" id="filePermsUserExecute" name="filePermsUserExecute" value="1"<?php if ($flags & 0100) echo ' checked="checked"'; ?>/></td>
+													<td width="100%"><label for="filePermsUserExecute">execute</label></td>
+												</tr>
+												<tr>
+													<td>Group:</td>
+													<td><input type="checkbox" id="filePermsGroupRead" name="filePermsGroupRead" value="1"<?php if ($flags & 040) echo ' checked="checked"'; ?>/></td>
+													<td><label for="filePermsGroupRead">read</label></td>
+													<td><input type="checkbox" id="filePermsGroupWrite" name="filePermsGroupWrite" value="1"<?php if ($flags & 020) echo ' checked="checked"'; ?>/></td>
+													<td><label for="filePermsGroupWrite">write</label></td>
+													<td><input type="checkbox" id="filePermsGroupExecute" name="filePermsGroupExecute" value="1"<?php if ($flags & 010) echo ' checked="checked"'; ?>/></td>
+													<td width="100%"><label for="filePermsGroupExecute">execute</label></td>
+												</tr>
+												<tr>
+													<td>World:</td>
+													<td><input type="checkbox" id="filePermsWorldRead" name="filePermsWorldRead" value="1"<?php if ($flags & 04) echo ' checked="checked"'; ?>/></td>
+													<td><label for="filePermsWorldRead">read</label></td>
+													<td><input type="checkbox" id="filePermsWorldWrite" name="filePermsWorldWrite" value="1"<?php if ($flags & 02) echo ' checked="checked"'; ?>/></td>
+													<td><label for="filePermsWorldWrite">write</label></td>
+													<td><input type="checkbox" id="filePermsWorldExecute" name="filePermsWorldExecute" value="1"<?php if ($flags & 01) echo ' checked="checked"'; ?>/></td>
+													<td width="100%"><label for="filePermsWorldExecute">execute</label></td>
+												</tr>
+											</table>
+										</td>
+									</tr>
+								</table>
+							</fieldset>
+						</td>
+					</tr>
+					<tr>
+<?php
+	$mode = 0;
+	$flags = 0755;
+	if ($dirPerms!='') {
+		$mode = 1;
+		$flags = octdec($dirPerms);
+	} // if
+?>
+						<td colspan="2">
+  							<fieldset><legend>Directory Permissions</legend>
+								<table cellpadding="1" cellspacing="1" border="0">
+									<tr>
+										<td><input type="radio" id="dirPermsMode0" name="dirPermsMode" value="0" onclick="changeDirPermsMode(0)"<?php if (!$mode) echo ' checked="checked"'; ?>/></td>
+										<td><label for="dirPermsMode0">Dont CHMOD directories (use server defaults)</label></td>
+									</tr>
+									<tr>
+										<td><input type="radio" id="dirPermsMode1" name="dirPermsMode" value="1" onclick="changeDirPermsMode(1)"<?php if ($mode) echo ' checked="checked"'; ?>/></td>
+										<td><label for="dirPermsMode1"> CHMOD directories to:</label></td>
+									</tr>
+									<tr id="dirPermsFlags"<?php if (!$mode) echo ' style="display:none"'; ?>>
+										<td>&nbsp;</td>
+										<td>
+											<table cellpadding="1" cellspacing="0" border="0">
+												<tr>
+													<td>User:</td>
+													<td><input type="checkbox" id="dirPermsUserRead" name="dirPermsUserRead" value="1"<?php if ($flags & 0400) echo ' checked="checked"'; ?>/></td>
+													<td><label for="dirPermsUserRead">read</label></td>
+													<td><input type="checkbox" id="dirPermsUserWrite" name="dirPermsUserWrite" value="1"<?php if ($flags & 0200) echo ' checked="checked"'; ?>/></td>
+													<td><label for="dirPermsUserWrite">write</label></td>
+													<td><input type="checkbox" id="dirPermsUserSearch" name="dirPermsUserSearch" value="1"<?php if ($flags & 0100) echo ' checked="checked"'; ?>/></td>
+													<td width="100%"><label for="dirPermsUserSearch">search</label></td>
+												</tr>
+												<tr>
+													<td>Group:</td>
+													<td><input type="checkbox" id="dirPermsGroupRead" name="dirPermsGroupRead" value="1"<?php if ($flags & 040) echo ' checked="checked"'; ?>/></td>
+													<td><label for="dirPermsGroupRead">read</label></td>
+													<td><input type="checkbox" id="dirPermsGroupWrite" name="dirPermsGroupWrite" value="1"<?php if ($flags & 020) echo ' checked="checked"'; ?>/></td>
+													<td><label for="dirPermsGroupWrite">write</label></td>
+													<td><input type="checkbox" id="dirPermsGroupSearch" name="dirPermsGroupSearch" value="1"<?php if ($flags & 010) echo ' checked="checked"'; ?>/></td>
+													<td width="100%"><label for="dirPermsGroupSearch">search</label></td>
+												</tr>
+												<tr>
+													<td>World:</td>
+													<td><input type="checkbox" id="dirPermsWorldRead" name="dirPermsWorldRead" value="1"<?php if ($flags & 04) echo ' checked="checked"'; ?>/></td>
+													<td><label for="dirPermsWorldRead">read</label></td>
+													<td><input type="checkbox" id="dirPermsWorldWrite" name="dirPermsWorldWrite" value="1"<?php if ($flags & 02) echo ' checked="checked"'; ?>/></td>
+													<td><label for="dirPermsWorldWrite">write</label></td>
+													<td><input type="checkbox" id="dirPermsWorldSearch" name="dirPermsWorldSearch" value="1"<?php if ($flags & 01) echo ' checked="checked"'; ?>/></td>
+													<td width="100%"><label for="dirPermsWorldSearch">search</label></td>
+												</tr>
+											</table>
+										</td>
+									</tr>
+								</table>
+							</fieldset>
+						</td>
+					</tr>
+					</table>
+				</div>
+			</div>
+			<div id="break"></div>
+		</div>
+		<div class="clr"></div>
+	</div>
+	</form>
+</div>
+<div class="clr"></div>
+</body>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/install4.php php-syslog-ng/html/install/install4.php
--- php-syslog-ng-2.9.f/html/install/install4.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/install4.php	2009-02-23 12:57:48.000000000 -0500
@@ -0,0 +1,568 @@
+<?php
+/**
+* @version $Id: install4.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+// Set flag that this is a parent file
+define( "_VALID_MOS", 1 );
+
+// Include common.php
+$basePath = dirname( __FILE__ );
+require_once($basePath . '/common.php' );
+require_once($basePath . '/../includes/version.php' );
+
+$DBhostname = mosGetParam( $_POST, 'DBhostname', '' );
+$DBuserName = mosGetParam( $_POST, 'DBuserName', '' );
+$DBpassword = mosGetParam( $_POST, 'DBpassword', '' );
+$SLuserName = mosGetParam( $_POST, 'SLuserName', '' );
+$SLUpassword = mosGetParam( $_POST, 'SLUpassword', '' );
+$SLAuserName = mosGetParam( $_POST, 'SLAuserName', '' );
+$SLApassword = mosGetParam( $_POST, 'SLApassword', '' );
+$DBname  	= mosGetParam( $_POST, 'DBname', '' );
+$DBPort  	= mosGetParam( $_POST, 'DBPort', '' );
+$DBPrefix  	= mosGetParam( $_POST, 'DBPrefix', '' );
+$sitename  	= mosGetParam( $_POST, 'sitename', '' );
+$SITEURL  	= mosGetParam( $_POST, 'SITEURL', '' );
+$adminEmail = mosGetParam( $_POST, 'adminEmail', '');
+$siteUrl  	= mosGetParam( $_POST, 'siteUrl', '' );
+$absolutePath = mosGetParam( $_POST, 'absolutePath', '' );
+$adminPassword = mosGetParam( $_POST, 'adminPassword', '');
+$CEMDB	= intval( mosGetParam( $_POST, 'CEMDB', 1 ) );
+
+$filePerms = '';
+if (mosGetParam($_POST,'filePermsMode',0))
+	$filePerms = '0'.
+		(mosGetParam($_POST,'filePermsUserRead',0) * 4 +
+		 mosGetParam($_POST,'filePermsUserWrite',0) * 2 +
+		 mosGetParam($_POST,'filePermsUserExecute',0)).
+		(mosGetParam($_POST,'filePermsGroupRead',0) * 4 +
+		 mosGetParam($_POST,'filePermsGroupWrite',0) * 2 +
+		 mosGetParam($_POST,'filePermsGroupExecute',0)).
+		(mosGetParam($_POST,'filePermsWorldRead',0) * 4 +
+		 mosGetParam($_POST,'filePermsWorldWrite',0) * 2 +
+		 mosGetParam($_POST,'filePermsWorldExecute',0));
+
+$dirPerms = '';
+if (mosGetParam($_POST,'dirPermsMode',0))
+	$dirPerms = '0'.
+		(mosGetParam($_POST,'dirPermsUserRead',0) * 4 +
+		 mosGetParam($_POST,'dirPermsUserWrite',0) * 2 +
+		 mosGetParam($_POST,'dirPermsUserSearch',0)).
+		(mosGetParam($_POST,'dirPermsGroupRead',0) * 4 +
+		 mosGetParam($_POST,'dirPermsGroupWrite',0) * 2 +
+		 mosGetParam($_POST,'dirPermsGroupSearch',0)).
+		(mosGetParam($_POST,'dirPermsWorldRead',0) * 4 +
+		 mosGetParam($_POST,'dirPermsWorldWrite',0) * 2 +
+		 mosGetParam($_POST,'dirPermsWorldSearch',0));
+
+if ((trim($adminEmail== "")) || (preg_match("/[\w\.\-]+@\w+[\w\.\-]*?\.\w{1,4}/", $adminEmail )==false)) {
+	echo "<form name=\"stepBack\" method=\"post\" action=\"install3.php\">
+		<input type=\"hidden\" name=\"DBhostname\" value=\"$DBhostname\" />
+		<input type=\"hidden\" name=\"DBuserName\" value=\"$DBuserName\" />
+		<input type=\"hidden\" name=\"DBpassword\" value=\"$DBpassword\" />
+		<input type=\"hidden\" name=\"DBname\" value=\"$DBname\" />
+		<input type=\"hidden\" name=\"DBPort\" value=\"$DBPort\" />
+		<input type=\"hidden\" name=\"SLuserName\" value=\"$SLuserName\">
+		<input type=\"hidden\" name=\"SLUpassword\" value=\"$SLUpassword\">
+		<input type=\"hidden\" name=\"SLAuserName\" value=\"$SLAuserName\">
+		<input type=\"hidden\" name=\"SLApassword\" value=\"$SLApassword\">
+		<input type=\"hidden\" name=\"DBPrefix\" value=\"$DBPrefix\" />
+		<input type=\"hidden\" name=\"DBcreated\" value=\"1\" />
+		<input type=\"hidden\" name=\"sitename\" value=\"$sitename\" />
+		<input type=\"hidden\" name=\"SITEURL\" value=\"$SITEURL\" />
+		<input type=\"hidden\" name=\"adminEmail\" value=\"$adminEmail\" />
+		<input type=\"hidden\" name=\"siteUrl\" value=\"$siteUrl\" />
+		<input type=\"hidden\" name=\"absolutePath\" value=\"$absolutePath\" />
+		<input type=\"hidden\" name=\"filePerms\" value=\"$filePerms\" />
+		<input type=\"hidden\" name=\"dirPerms\" value=\"$dirPerms\" />
+		</form>";
+	echo "<script>alert('You must provide a valid admin email address.'); document.stepBack.submit(); </script>";
+	return;
+}
+
+if($DBhostname && $DBuserName && $DBname) {
+	$configArray['DBhostname'] = $DBhostname;
+	$configArray['DBuserName'] = $DBuserName;
+	$configArray['DBpassword'] = $DBpassword;
+	$configArray['DBname']	 = $DBname;
+	$configArray['DBPort']	 = $DBPort;
+	$configArray['DBPrefix']   = $DBPrefix;
+} else {
+	echo "<form name=\"stepBack\" method=\"post\" action=\"install3.php\">
+		<input type=\"hidden\" name=\"DBhostname\" value=\"$DBhostname\" />
+		<input type=\"hidden\" name=\"DBuserName\" value=\"$DBuserName\" />
+		<input type=\"hidden\" name=\"DBpassword\" value=\"$DBpassword\" />
+		<input type=\"hidden\" name=\"DBname\" value=\"$DBname\" />
+		<input type=\"hidden\" name=\"DBPort\" value=\"$DBPort\" />
+		<input type=\"hidden\" name=\"DBPrefix\" value=\"$DBPrefix\" />
+		<input type=\"hidden\" name=\"DBcreated\" value=\"1\" />
+		<input type=\"hidden\" name=\"sitename\" value=\"$sitename\" />
+		<input type=\"hidden\" name=\"SITEURL\" value=\"$SITEURL\" />
+		<input type=\"hidden\" name=\"adminEmail\" value=\"$adminEmail\" />
+		<input type=\"hidden\" name=\"siteUrl\" value=\"$siteUrl\" />
+		<input type=\"hidden\" name=\"absolutePath\" value=\"$absolutePath\" />
+		<input type=\"hidden\" name=\"filePerms\" value=\"$filePerms\" />
+		<input type=\"hidden\" name=\"dirPerms\" value=\"$dirPerms\" />
+		</form>";
+
+	echo "<script>alert('The database details provided are incorrect and/or empty'); document.stepBack.submit(); </script>";
+	return;
+}
+
+if ($sitename) {
+	if (!get_magic_quotes_gpc()) {
+		$configArray['sitename'] = addslashes($sitename);
+	} else {
+		$configArray['sitename'] = $sitename;
+	}
+} else {
+	echo "<form name=\"stepBack\" method=\"post\" action=\"install3.php\">
+		<input type=\"hidden\" name=\"DBhostname\" value=\"$DBhostname\" />
+		<input type=\"hidden\" name=\"DBuserName\" value=\"$DBuserName\" />
+		<input type=\"hidden\" name=\"DBpassword\" value=\"$DBpassword\" />
+		<input type=\"hidden\" name=\"DBname\" value=\"$DBname\" />
+		<input type=\"hidden\" name=\"DBPort\" value=\"$DBPort\" />
+		<input type=\"hidden\" name=\"DBPrefix\" value=\"$DBPrefix\" />
+		<input type=\"hidden\" name=\"DBcreated\" value=\"1\" />
+		<input type=\"hidden\" name=\"sitename\" value=\"$sitename\" />
+		<input type=\"hidden\" name=\"SITEURL\" value=\"$SITEURL\" />
+		<input type=\"hidden\" name=\"adminEmail\" value=\"$adminEmail\" />
+		<input type=\"hidden\" name=\"siteUrl\" value=\"$siteUrl\" />
+		<input type=\"hidden\" name=\"absolutePath\" value=\"$absolutePath\" />
+		<input type=\"hidden\" name=\"filePerms\" value=\"$filePerms\" />
+		<input type=\"hidden\" name=\"dirPerms\" value=\"$dirPerms\" />
+		</form>";
+
+	echo "<script>alert('The sitename has not been provided'); document.stepBack2.submit();</script>";
+	return;
+}
+
+if (file_exists( '../config/config.php' )) {
+	$canWrite = is_writable( '../config/config.php' );
+} else {
+	$canWrite = is_writable( '..' );
+}
+ 
+if ($siteUrl) {
+	$configArray['siteUrl']=$siteUrl;
+	// Fix for Windows
+	$absolutePath= str_replace("\\","/", $absolutePath);
+	$absolutePath= str_replace("//","/", $absolutePath);
+	$configArray['absolutePath']=$absolutePath;
+	$configArray['filePerms']=$filePerms;
+	$configArray['dirPerms']=$dirPerms;
+
+	$config = "<?php\n";
+	$config .= "define('PAGETITLE', '$_VERSION->PRODUCT' );\n";
+	$config .= "define('VERSION', '$_VERSION->RELEASE.".$_VERSION->DEV_LEVEL."');\n";
+	$config .= "define('COUNT_ROWS', TRUE);\n";
+	$config .= "define('DEFAULTLOGTABLE', '{$DBPrefix}logs');\n";
+	$config .= "define('MERGELOGTABLE', '{$DBPrefix}all_logs');\n";
+	$config .= "define('USETABLE', DEFAULTLOGTABLE); // This tells the main page to calculate hostcount based on \"all_logs\" or \"logs\"\n";
+	$config .= "define('LOGROTATERETENTION', 30);\n";
+	$config .= "define('DBUSER', '$SLuserName');\n";
+	$config .= "define('DBUSERPW', '$SLUpassword');\n";
+	$config .= "define('DBADMIN', '$SLAuserName');\n";
+	$config .= "define('DBADMINPW', '$SLApassword');\n";
+	$config .= "define('DBNAME', '$DBname');\n";
+	$config .= "define('DBHOST', '$DBhostname');\n";
+	$config .= "define('DBPORT', '$DBPort');\n";
+	$config .= "define('REQUIRE_AUTH', TRUE);\n";
+	$config .= "define('AUTHTABLENAME', '{$DBPrefix}users');\n";
+	$config .= "define('RENEW_SESSION_ON_EACH_PAGE', TRUE);\n";
+	$config .= "define('SESSION_EXP_TIME', '3600');\n";
+	$config .= "define('TAIL_REFRESH_SECONDS', '25');\n";
+ 	$config .= "define('USE_ACL', TRUE);\n";
+ 	$config .= "define('USER_ACCESS_TABLE', '{$DBPrefix}user_access');\n";
+ 	$config .= "define('ACTION_TABLE', '{$DBPrefix}actions');\n";
+	$config .= "define('USE_CACHE', TRUE);\n";
+	$config .= "define('CACHETABLENAME', '{$DBPrefix}search_cache');\n";
+ 	$config .= "define('SITEADMIN', 'admin');\n";
+ 	$config .= "define('SITENAME', '$sitename');\n";
+ 	$config .= "define('ADMINEMAIL', '$adminEmail');\n";
+	$config .= "define('CEMDB', 'ON');\n";
+	$config .= "define('CISCO_ERROR_TABLE', 'cemdb');\n";
+	$config .= "define('DEBUG', FALSE);\n";
+	$config .= "define('SITEURL', '$SITEURL');\n";
+   	$config .= '$regExpArray = array(
+		   	// "username"=>"(^\w{4,}\$)",
+		   	// Cdukes - 05/10/08: Modified username to allow email address as username
+		   	// This is an enhancement change for
+		   	// http://code.google.com/p/php-syslog-ng/issues/detail?id=62
+		   	"username" => "(^[A-Za-z_.@]{4,}\$)",
+			"password"=>"(^.{4,}\$)",
+			"pageId"=>"(^\w+$)",
+			"sessionId"=>"(^\w{32}\$)",
+			// "date"=>"/^yesterday$|^today$|^now$|^(\d){4}-([01]*\d)-([0123]*\d)$/i",
+			"date"=>"/^yesterday$|^today$|^now$|^([0123]*\d)-([012]*\d)-(\d){4}$/i",
+			"time"=>"/^now$|^([012]*\d):([012345]*\d):([012345]*\d)$/i",
+			"limit"=>"(^\d+$)",
+			"topx"=>"(^\d+$)",
+			// BPK added program to orderby filter
+			"orderby"=>"/^seq$|^host$|^program$|^facility$|^priority$|^datetime$|^msg$|^fo$|^lo$|^counter$/i",
+			"order"=>"/^asc$|^desc$/i",
+			"offset"=>"(^\d+$)",
+			"collapse"=>"/^1$/",
+			"table"=>"(^\w+$)",
+			"excludeX"=>"(^[01]$)",
+			/* BEGIN: changes by BPK to allow for regexp matching, lists of hosts, and programs
+			"host"=>"(^[\w-.]+$)",
+			*/
+			"regexpX"=>"(^[01]$)",
+			"host"=>"(^([\w_.%-]+[,;]\s*)*[\w_.%-]+$)",
+			"program"=>"(^([\w/_.%-]+[,;]\s*)*[\w/_.%-]+$)",
+			"hostRegExp"=>"(^\S+$)",
+			"programRegExp"=>"(^\S+$)",
+			/* END: changes by BPK to allow for regexp matching, lists of hosts, and programs */
+			"facility"=>"(^\w+$)",
+		   	"priority"=>"/^debug$|^info$|^notice$|^warning$|^err$|^crit$|^alert$|^emerg$/i",
+		   	// Cdukes - 05/10/08: Below is an enhancement addition for SqueezeDB duplicate searching
+		   	"dupop"=>"(^lt|gt|eq$)",
+		   	"dupcount"=>"(^\d+$)",
+			);';
+	$config .= "\n//------------------------------------------------------------------------\n";
+	$config .= "// CDUKES - BEGIN jpgraph Addon\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "\n";
+	$config .= "// Enable Graphing\n";
+	$config .= "define('JPG_GRAPHS', 'ON');\n";
+	$config .= "// Make sure this directory exists and has write permission\n";
+	$config .= "define('IMG_CACHE_DIR', 'jpcache/');\n";
+	$config .= "\n";
+	$config .= "// Enable Daily Graph in dropdown on main page\n";
+	$config .= "define('JPG_DAILY', 'ON');\n";
+	$config .= "// Enable Weekly Graph in dropdown on main page\n";
+	$config .= "define('JPG_WEEKLY', 'ON');\n";
+	$config .= "// Enable Monthly Graph in dropdown on main page\n";
+	$config .= "define('JPG_MONTHLY', 'ON');\n";
+	$config .= "// Enable Overall Statistics Graph on main page (This will slow down main page rendering)\n";
+	$config .= "define('JPG_MAIN', 'OFF'); // Not implemented yet\n";
+	$config .= "\n";
+	$config .= "\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "// CDUKES - END jpgraph Addon\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "// CDUKES - Begin LDAP Addon\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "define('LOGIN_URL', SITEURL . \"login.php\");\n";
+	$config .= "define('LOGOUT_URL', SITEURL . \"logout.php\");\n";
+	$config .= "define('INDEX_URL', SITEURL . \"index.php\");\n";
+	$config .= "define('LDAP_ENABLE', \"NO\");\n";
+	$config .= "define('LDAP_SRV', \"ldap.company.com\");\n";
+	$config .= "define('LDAP_BASE_DN', \"ou=active, ou=employees, ou=people, o=company.com\");\n";
+	$config .= "// variable to search for user (container name) - in my case, this is \"uid\", but normally it is \"cn\"\n";
+	$config .= "define('LDAP_CN', \"uid\");\n";
+	$config .= "// if using MS Active Directory, put it to \"sAMAccountName\"\n";
+	$config .= "// define('LDAP_CN', \"sAMAccountName\");\n";
+	$config .= "// Set to Yes if using MS Active Directory for Authentication\n";
+	$config .= "define('LDAP_MSAD', \"NO\");\n";
+	$config .= "// Required when if LDAP_MSAD set to YES and using MS Active Directory, ex. mydomain.com\n";
+	$config .= "define('LDAP_DOMAIN', \"mydomain.com\");\n";
+	$config .= "\n";
+	$config .= "// privilege levels for editing records \n";
+	$config .= "// (not implemented yet - this will be used to define RW and RO groups from LDAP)\n";
+	$config .= "// use privilege level authentication for record editing?\n";
+	$config .= "define  ('LDAP_USEPRIV', 'OFF');\n";
+	$config .= "// if USEPRIV is enabled, what LDAP group name is the \"privileged\" group?\n";
+	$config .= "define  ('LDAP_RW_GROUP', 'admin');\n";
+	$config .= "define  ('LDAP_RO_GROUP', 'users');\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "// CDUKES - END LDAP Addon\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "// cdukes - I added this just in case someone felt generous\n";
+	$config .= "// If you don't want it on the menu bar, just disable it here :-)\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "define  ('PAYPAL_ENABLE', 'YES');\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "// CDUKES - Just a simple addition for my demo site at http://php-syslog-ng.gdd.net\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "define  ('DEMO', FALSE);\n";
+	$config .= "// Cdukes - 05/10/08: WEBBASIC_ENABLE\n";
+	$config .= "// This is an enhancement change for\n";
+	$config .= "// http://code.google.com/p/php-syslog-ng/issues/detail?id=62\n";
+	$config .= "define('WEBBASIC_ENABLE', FALSE);\n";
+	$config .= "// Cdukes - 05/10/08: SQZ_ENABLED\n";
+	$config .= "// This is an enhancement change for SqueezeDB functionality\n";
+	$config .= "// http://code.google.com/p/php-syslog-ng/issues/detail?id=47\n";
+	$config .= "define('SQZ_ENABLED', FALSE);\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "// CDUKES - Added front page bar graph for daily log count\n";
+	$config .= "//------------------------------------------------------------------------\n";
+	$config .= "define('GRAPH_LPD', TRUE);\n";
+	$config .= "define('LPD_CACHE', TRUE);\n";
+	$config .= "\n?>";
+
+	if ($canWrite && ($fp = fopen("../config/config.php", "w"))) {
+		fputs( $fp, $config, strlen( $config ) );
+		fclose( $fp );
+	} else {
+		$canWrite = false;
+	} // if
+
+	$cryptpass=md5($adminPassword);
+
+    $DBserver = ($DBPort) ? "$DBhostname:$DBPort" : "$DBhostname";
+	mysql_connect($DBserver, $DBuserName, $DBpassword);
+	mysql_select_db($DBname);
+
+	// create the admin user
+	// $installdate = date("Y-m-d H:i:s");
+	$query = "INSERT INTO `{$DBPrefix}users` (username, pwhash) VALUES('admin', '$cryptpass');";
+	mysql_query( $query );
+
+	// create the mysql users
+	mysql_select_db("mysql");
+
+	$query = "DELETE FROM user where User='$SLuserName';";
+		mysql_query( $query );
+		$query = "INSERT INTO user (Host, User, Password) VALUES ('$DBhostname','$SLuserName', password('$SLUpassword'));";
+		mysql_query( $query );
+	$query = "INSERT INTO db (Host, Db, User) VALUES ('$DBhostname','$DBname','$SLuserName');";
+		mysql_query( $query );
+
+		/* CDUKES - It doesn't appear that feeder is used anymore? */
+	$query = "DELETE FROM user where User='syslogfeeder';";
+		mysql_query( $query );
+		/*
+	$query = "INSERT INTO user (Host, User, Password) VALUES ('$DBhostname','syslogfeeder', password('syslogfeeder'));";
+		mysql_query( $query );
+	$query = "INSERT INTO db (Host, Db, User) VALUES ('$DBhostname','$DBname','syslogfeeder');";
+		mysql_query( $query );
+		*/
+
+	$query = "DELETE FROM user where User='$SLAuserName';";
+		mysql_query( $query );
+	$query = "INSERT INTO user (Host, User, Password) VALUES ('$DBhostname','$SLAuserName',password('$SLApassword'));";
+		mysql_query( $query );
+	// cdukes - added below since, for some reason, Mysql 5.0 doesn't grant when using GRANT ALL
+	$query = "UPDATE user SET Drop_priv='Y',Alter_priv='Y' where User='$SLAuserName';";
+		mysql_query( $query );
+	$query = "INSERT INTO db (Host, Db, User) VALUES ('$DBhostname','$DBname','$SLAuserName');";
+		mysql_query( $query );
+	$query = "COMMIT;";
+		mysql_query( $query );
+	$query = "FLUSH PRIVILEGES;";
+		mysql_query( $query );
+
+# grant rights to user $SLAuserName for backup purpose
+	$query = "GRANT USAGE ON *.* TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT ALL ON $DBname.* TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT RELOAD ON *.* TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+		// cdukes - added below since, for some reason, Mysql 5.0 doesn't grant when using GRANT ALL
+	$query = "GRANT DROP ON $DBname.* TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+		// cdukes - added below since, for some reason, Mysql 5.0 doesn't grant when using GRANT ALL
+	$query = "GRANT ALTER ON $DBname.* TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+
+	$query = "REVOKE ALL PRIVILEGES ON $DBname.* FROM $SLuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT USAGE ON *.* TO $SLuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT SELECT ON $DBname.* TO $SLuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT UPDATE ON $DBname.{$DBPrefix}users TO $SLuserName@$DBhostname;";
+		mysql_query( $query );
+
+		/* CDUKES - It doesn't appear that feeder is used anymore */
+	$query = "REVOKE ALL PRIVILEGES ON $DBname.* FROM syslogfeeder@$DBhostname;";
+		mysql_query( $query );
+		/*
+	$query = "GRANT USAGE ON *.* TO syslogfeeder@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT INSERT ON $DBname.* TO syslogfeeder@$DBhostname;";
+		mysql_query( $query );
+		*/
+
+	$query = "GRANT ALL ON $DBname.{$DBPrefix}search_cache TO $SLuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT SELECT ON $DBname.{$DBPrefix}user_access TO $SLuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT ALL ON $DBname.{$DBPrefix}user_access TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT SELECT ON $DBname.{$DBPrefix}actions TO $SLuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT ALL ON $DBname.{$DBPrefix}actions TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+	$query = "GRANT ALL ON $DBname.{$DBPrefix}cemdb TO $SLAuserName@$DBhostname;";
+		mysql_query( $query );
+
+	$query = "COMMIT;";
+		mysql_query( $query );
+	$query = "FLUSH PRIVILEGES;";
+		mysql_query( $query );
+
+
+	// chmod files and directories if desired
+   	$chmod_report = "Directory and file permissions left unchanged.";
+	if ($filePerms != '' || $dirPerms != '') {
+		$mosrootfiles = array(
+			'config',
+			'includes',
+			'scripts',
+			'css',
+			'CHANGELOG',
+			'htaccess.txt',
+			'index.php',
+			'README',
+			'LICENSE',
+			'robots.txt'
+		);
+		$filemode = NULL;
+		if ($filePerms != '') $filemode = octdec($filePerms);
+		$dirmode = NULL;
+		if ($dirPerms != '') $dirmode = octdec($dirPerms);
+		$chmodOk = TRUE;
+		foreach ($mosrootfiles as $file)
+			if (!mosChmodRecursive($absolutePath.'/'.$file, $filemode, $dirmode))
+				$chmodOk = FALSE;
+		if ($chmodOk)
+			$chmod_report = 'File and directory permissions successfully changed.';
+		else
+			$chmod_report = 'File and directory permissions could not be changed.<br/>'.
+							'Please CHMOD ' .$_VERSION->PRODUCT .'files and directories manually.';
+	} // if chmod wanted
+} else {
+?>
+	<form action="install3.php" method="post" name="stepBack3" id="stepBack3">
+	  <input type="hidden" name="DBhostname" value="<?php echo $DBhostname;?>" />
+	  <input type="hidden" name="DBusername" value="<?php echo $DBuserName;?>" />
+	  <input type="hidden" name="DBpassword" value="<?php echo $DBpassword;?>" />
+	  <input type="hidden" name="DBname" value="<?php echo $DBname;?>" />
+	  <input type="hidden" name="DBPrefix" value="<?php echo $DBPrefix;?>" />
+	  <input type="hidden" name="DBcreated" value="1" />
+	  <input type="hidden" name="sitename" value="<?php echo $sitename;?>" />
+	  <input type="hidden" name="SITEURL" value="<?php echo $SITEURL;?>" />
+	  <input type="hidden" name="adminEmail" value="<?php echo $adminEmail?>" />
+	  <input type="hidden" name="siteUrl" value="<?php echo $siteUrl?>" />
+	  <input type="hidden" name="absolutePath" value="<?php echo $absolutePath?>" />
+	  <input type="hidden" name="filePerms" value="<?php echo $filePerms?>" />
+	  <input type="hidden" name="dirPerms" value="<?php echo $dirPerms?>" />
+	</form>
+	<script>alert('The site url has not been provided'); document.stepBack3.submit();</script>
+<?php
+}
+echo "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?".">";
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title><?php echo $_VERSION->PRODUCT; ?> - Web Installer</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link rel="stylesheet" href="install.css" type="text/css" />
+</head>
+<body>
+<div id="wrapper">
+	<div id="header">
+		<div id="psng"><img src="header_install.png" alt="<?php echo $_VERSION->PRODUCT; ?> Installation" /></div>
+	</div>
+</div>
+<div id="ctr" align="center">
+	<?php if ($CEMDB) { ?>
+	<form action="cemdb/bdimport.php" name="form" id="form">
+	<div class="install">
+		<div id="stepbar">
+			<div class="step-off">pre-installation check</div>
+			<div class="step-off">license</div>
+			<div class="step-off">step 1</div>
+			<div class="step-off">step 2</div>
+			<div class="step-off">step 3</div>
+			<div class="step-on">step 4</div>
+		</div>
+		<div id="right">
+			<div id="step">step 4</div>
+			<div class="far-right">
+	<?php 
+	echo "
+		<input type=\"hidden\" name=\"DBhostname\" value=\"$DBhostname\" />
+		<input type=\"hidden\" name=\"DBuserName\" value=\"$DBuserName\" />
+		<input type=\"hidden\" name=\"DBpassword\" value=\"$DBpassword\" />
+		<input type=\"hidden\" name=\"DBname\" value=\"$DBname\" />
+		</form>";
+			?>
+				<input class="button" type="submit" name="cemdb" value="Install CEMDB">
+			</div>
+			<div class="clr"></div>
+			<h1>Final Step: CEMDB Install</h1>
+			<?php } else { ?>
+	<form action="dummy" name="form" id="form">
+	<div class="install">
+		<div id="stepbar">
+			<div class="step-off">pre-installation check</div>
+			<div class="step-off">license</div>
+			<div class="step-off">step 1</div>
+			<div class="step-off">step 2</div>
+			<div class="step-off">step 3</div>
+			<div class="step-on">step 4</div>
+		</div>
+		<div id="right">
+			<div id="step">step 4</div>
+			<div class="far-right">
+			<div class="far-right">
+				<input class="button" type="button" name="runSite" value="View Site"
+<?php
+				if ($siteUrl) {
+					echo "onClick='window.location.href=\"$siteUrl"."/index.php\" '";
+				} else {
+					echo "onClick='window.location.href=\"{$configArray['siteURL']}"."/index.php\" '";
+				}
+?>/>
+			</div>
+			<div class="clr"></div>
+			<h1>Congratulations! <?php echo $_VERSION->PRODUCT; ?> is installed</h1>
+
+			<?php } ?>
+	<?php if ($CEMDB) { ?>
+			<div class="install-text">
+				<p>Next: Be sure to click the "Install CEMDB" button to start CEMDB import!</p>
+			</div>
+			<?php } else { ?>
+			<div class="install-text">
+				<p>Click the "View Site" button to start <?php echo $_VERSION->PRODUCT; ?></p>
+			</div>
+			<?php } ?>
+			<div class="install-form">
+				<div class="form-block">
+					<table width="100%">
+						<tr><td class="error" align="center">PLEASE REMEMBER TO COMPLETELY<br/>REMOVE THE INSTALLATION DIRECTORY</td></tr>
+						<tr><td align="center"><h5>Administration Login Details</h5></td></tr>
+						<tr><td align="center" class="notice"><b>Username : admin</b></td></tr>
+						<tr><td align="center" class="notice"><b>Password : <?php echo $adminPassword; ?></b></td></tr>
+						<tr><td>&nbsp;</td></tr>
+						<tr><td align="right">&nbsp;</td></tr>
+<?php					   if (!$canWrite) { ?>
+						<tr>
+							<td class="small">
+								Your configuration file or directory is not writeable,
+								or there was a problem creating the configuration file. You'll have to
+								upload the following code by hand. Click in the textarea to highlight
+								all of the code.
+							</td>
+						</tr>
+						<tr>
+							<td align="center">
+								<textarea rows="5" cols="60" name="configcode" onclick="javascript:this.form.configcode.focus();this.form.configcode.select();" ><?php echo htmlspecialchars( $config );?></textarea>
+							</td>
+						</tr>
+<?php					   } ?>
+						<tr><td class="small"><?php /*echo $chmod_report*/; ?></td></tr>
+					</table>
+				</div>
+			</div>
+			<div id="break"></div>
+		</div>
+		<div class="clr"></div>
+	</div>
+	</form>
+</div>
+<div class="clr"></div>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/install.css php-syslog-ng/html/install/install.css
--- php-syslog-ng-2.9.f/html/install/install.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/install.css	2006-06-16 09:57:19.000000000 -0400
@@ -0,0 +1,283 @@
+/**
+* @version $Id: install.css,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+body {
+	margin: 0px;
+	padding: 0px;
+	color : #333;
+	background-color : #FFF;
+	font-size : 11px;
+	font-family : Arial, Helvetica, sans-serif;
+}
+
+#wrapper {
+        border: 0px;
+        margin: 0px;
+        margin-left: auto;
+        margin-right: auto;
+        padding: 0px;
+}
+
+#header {
+        background-color: #FFF;
+        background-position: right top;
+        border-bottom: 4px solid #80B5D7;
+}
+
+#psng {
+        position: relative;
+        width: 100%;
+        background: url(header_blue.jpg) #30569D no-repeat;
+        background-position: top right;
+        margin: 0px;
+        padding: 0px;
+}
+
+#stepbar {
+    background-color: #F1F3F5;
+	width: 170px !important;
+	width: 170px;
+	height: 400px;
+	font-size: 11px;
+	float: left;
+	text-align: left;
+	background: url(site.png) no-repeat;
+	background-position: bottom;
+}
+
+#step {
+	background: url(install_logo.png) no-repeat;
+	font-size: 30px;
+	font-weight: bold;
+	text-align: left;
+	color: #666666;
+	padding: 10px 0px 20px 80px;
+	white-space: nowrap;
+	position: relative;
+	float: left;
+}
+
+.step-on {
+	color: #ff9900;
+	background: #30559C;
+	font-weight: bold;
+	font-size: 13px;
+	padding: 10px;
+	border: 1px solid #cccccc;
+	margin-bottom: 2px;
+}
+
+.step-off {
+  font-size: 13px;
+	color: #999999;
+	font-weight: bold;
+	padding: 10px;
+	border: 1px solid #cccccc;
+	margin-bottom: 2px;
+}
+
+#right {
+  float: right;
+  width: 555px !important;
+  width: 545px;
+  border-left: 1px solid #cccccc;
+  padding-left: 10px;
+
+}
+
+#break {
+	height: 20px;
+}
+
+.licensetext {
+  text-align: left;
+}
+
+.license {
+  padding: 0px;
+  width: 530px;
+  height: 300px;
+}
+
+.license-form {
+  float: left;
+}
+
+.install {
+	margin-left: auto;
+	margin-right: auto;
+	margin-top: 3em;
+	margin-bottom: 3em;
+	padding: 10px;
+	border: 1px solid #cccccc;
+	width: 750px;
+	background: #F1F3F5;
+}
+	
+.install h1 {
+	font-size: 15px;
+	font-weight: bold;
+ 	color: #FF9900;
+	padding: 10px 10px 4px 0px;
+ 	text-align: left;
+	border-bottom: 1px solid #FF9900;
+	margin-bottom: 10px;
+
+}
+
+.install-form {
+  position: relative;
+	text-align: left;
+	float: right;
+	width: 69%;
+}
+
+.install-text {
+  position: relative;
+	text-align: left;
+	width: 30%;
+	float: left;
+}
+
+.form-block {
+	border: 1px solid #cccccc;
+	background: #E9ECEF;
+	padding-top: 5px;
+	padding-left: 5px;
+	padding-bottom: 5px;
+	padding-right: 5px;
+}
+
+.left {
+  position: relative;
+	text-align: left;
+	float: left;
+	width: 50%;
+}
+
+.right {
+  position: relative;
+	text-align: left;
+	float: right;
+	width: 50%;
+}
+
+.far-right {
+  position: relative;
+	text-align: right;
+	float: right;
+}
+
+.far-left {
+  position: relative; 
+	text-align: left;
+	float: left;
+}
+
+.clr {
+    clear:both;
+    }
+
+.ctr {
+	text-align: center;
+}
+
+.button {
+	border : solid 1px #cccccc;
+	background: #E9ECEF;
+	color : #666666;
+	font-weight : bold;
+	font-size : 11px;
+	padding: 4px;
+}
+
+table.content {
+	width: 80%;
+}
+
+table.content td {
+	color : #333333;
+	font-size: 11px;
+	width: 50%;
+}
+
+table.content2 {
+	width: 90%;
+}
+
+table.content2 td {
+	color : #333333;
+	font-size: 11px;
+}
+
+.toggle {
+	font-weight: bold;
+}
+
+
+/*  old stuff */
+
+
+a {
+	color : #FF9900;
+	text-decoration : none;
+}
+a:hover {
+	color : #999999;
+	text-decoration : underline;
+}
+a:active {
+	color : #FF6600;
+	text-decoration : underline;
+}
+
+.inputbox {
+
+	color: blue;
+	font-family: Arial, Helvetica, sans-serif;
+	z-index: -3;
+	font-size: 11px;
+}
+
+.small {
+	color : #333;
+	font-size : 10px;
+}
+
+.error {
+	color : #cc0000;
+	font-size : 12px;
+	font-weight : bold;
+	padding-top: 10px;
+	padding-bottom: 10px;
+}
+
+
+select.options, input.options {
+	font-size: 8pt;
+	border: 1px solid #999;
+}
+
+form {
+	margin: 0px 0px 0px 0px;
+}
+
+
+.dottedline {
+	border-bottom: 1px solid #333;
+}
+
+.installheader {
+	color : #FFF;
+	font-size : 24px;
+}
+
+textarea {
+	color : #0000dd;
+	font-family : Arial;
+	font-size : 11px;
+	border: 1px;
+}
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/install.php php-syslog-ng/html/install/install.php
--- php-syslog-ng-2.9.f/html/install/install.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/install.php	2008-03-20 21:20:21.000000000 -0400
@@ -0,0 +1,110 @@
+<?php
+/**
+* @version $Id: install.php,v 1.0 2006/06/16 09:00:00 cdukes Exp $
+* @package PHP-Syslog-NG
+* @license http://www.gnu.org/copyleft/gpl.html GNU/GPL
+* PHP-Syslog-NG is Free Software
+*/
+
+if (file_exists( '../config/config.php' ) && filesize( '../config/config.php' ) > 10) {
+	header( 'Location: ../index.php' );
+	exit();
+}
+/** Include common.php */
+include_once( 'common.php' );
+include_once( '../includes/version.php' );
+function writableCell( $folder ) {
+	echo "<tr>";
+	echo "<td class=\"item\">" . $folder . "/</td>";
+	echo "<td align=\"left\">";
+	echo is_writable( "../$folder" ) ? '<b><font color="green">Writeable</font></b>' : '<b><font color="red">Unwriteable</font></b>' . "</td>";
+	echo "</tr>";
+}
+?>
+<?php echo "<?xml version=\"1.0\" encoding=\"iso-8859-1\"?".">"; ?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title><?php echo $_VERSION->PRODUCT; ?> - Web Installer</title>
+<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+<link rel="shortcut icon" href="../../images/favicon.ico" />
+<link rel="stylesheet" href="install.css" type="text/css" />
+<script type="text/javascript">
+<!--
+var checkobj;
+
+function agreesubmit(el){
+	checkobj=el;
+	if (document.all||document.getElementById){
+		for (i=0;i<checkobj.form.length;i++){  //hunt down submit button
+			var tempobj=checkobj.form.elements[i];
+			if(tempobj.type.toLowerCase()=="submit")
+				tempobj.disabled=!checkobj.checked;
+		}
+	}
+}
+
+function defaultagree(el){
+	if (!document.all&&!document.getElementById){
+		if (window.checkobj&&checkobj.checked)
+			return true;
+		else{
+			alert("Please read/accept license to continue installation");
+			return false;
+		}
+	}
+}
+//-->
+</script>
+</head>
+<body onload="document.adminForm.next.disabled=true;">
+<div id="wrapper">
+	<div id="header">
+		<div id="psng"><img src="header_install.png" alt="<?php echo $_VERSION->PRODUCT; ?> Installation" /></div>
+	</div>
+</div>
+<div id="ctr" align="center">
+	<form action="install1.php" method="post" name="adminForm" id="adminForm" onSubmit="return defaultagree(this)">
+	<div class="install">
+	<div id="stepbar">
+		<div class="step-off">pre-installation check</div>
+		<div class="step-on">license</div>
+		<div class="step-off">step 1</div>
+		<div class="step-off">step 2</div>
+		<div class="step-off">step 3</div>
+		<div class="step-off">step 4</div>
+	</div>
+	<div id="right">
+		<div id="step">license</div>
+		<div class="far-right">
+		<input class="button" type="submit" name="next" value="Next &gt;&gt;" disabled="disabled"/>
+		</div>
+		<div class="clr"></div>
+		<h1>GNU/GPL License:</h1>
+		<div class="licensetext">
+				<a href="https://sourceforge.net/projects/php-syslog-ng"><?php echo $_VERSION->PRODUCT; ?> </a> is Free Software released under the <a href="http://www.gnu.org/copyleft/gpl.html">GNU/GPL License </a>.
+				<div class="error">*** To continue installing <?php echo $_VERSION->PRODUCT; ?> you must check the box under the license ***</div>
+
+		</div>
+		<div class="clr"></div>
+		<div class="license-form">
+			<div class="form-block" style="padding: 0px;">
+				<iframe src="gpl.txt" class="license" frameborder="0" scrolling="auto"></iframe>
+			</div>
+		</div>
+		<div class="clr"></div>
+		<div class="ctr">
+				<input type="checkbox" name="agreecheck" id="agreecheck" class="inputbox" onClick="agreesubmit(this)" />
+				<label for="agreecheck">
+					I understand that this software is released under the GNU/GPL License</label>
+				</div>
+		<div class="clr"></div>
+		</div>
+		<div id="break"></div>
+	<div class="clr"></div>
+	<div class="clr"></div>
+	</div>
+	</form>
+</div>
+</body>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/sql/dbsetup.sql php-syslog-ng/html/install/sql/dbsetup.sql
--- php-syslog-ng-2.9.f/html/install/sql/dbsetup.sql	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/sql/dbsetup.sql	2009-02-23 11:49:05.000000000 -0500
@@ -0,0 +1,73 @@
+CREATE TABLE logs (
+host varchar(128) default NULL,
+facility varchar(10) default NULL,
+priority varchar(10) default NULL,
+level varchar(10) default NULL,
+tag varchar(10) default NULL,
+datetime datetime default NULL,
+program varchar(15) default NULL,
+msg text,
+seq bigint(20) NOT NULL default '0',
+counter int(11) NOT NULL default '1',
+fo datetime default NULL,
+lo datetime default NULL,
+PRIMARY KEY  (seq),
+KEY datetime (datetime),
+KEY priority (priority),
+KEY facility (facility),
+KEY program (program),
+KEY host (host)
+) ENGINE=MyISAM;
+
+
+CREATE TABLE users (
+username varchar(32) default NULL,
+pwhash char(40) default NULL,
+sessionid char(32) default NULL,
+exptime datetime default NULL,
+PRIMARY KEY (username)
+) TYPE=MyISAM;
+
+CREATE TABLE search_cache (
+tablename varchar(32) DEFAULT NULL,
+type ENUM('HOST','FACILITY','PROGRAM','LPD'),
+value varchar(128) DEFAULT NULL,
+updatetime datetime DEFAULT NULL,
+INDEX type_name (type, tablename)
+) TYPE=MEMORY;
+
+CREATE TABLE user_access (
+username varchar(32) DEFAULT NULL,
+actionname varchar(32) DEFAULT NULL,
+access ENUM('TRUE','FALSE'),
+INDEX user_action (username, actionname)
+) TYPE=MyISAM;
+
+INSERT INTO user_access VALUES ('admin','add_user','TRUE'),('admin','edit_user','TRUE'),('admin','reload_cache','TRUE'),('admin','edit_acl','TRUE'),('admin','add_server','TRUE'),('admin','chg_auth','TRUE'),('admin','del_server','TRUE'); 
+
+CREATE TABLE actions (
+actionname varchar(32) NOT NULL,
+actiondescr varchar(64) DEFAULT NULL,
+defaultaccess ENUM('TRUE','FALSE'),
+PRIMARY KEY (actionname)
+) TYPE=MyISAM;
+--
+-- Table structure for table cemdb
+--
+
+CREATE TABLE cemdb (
+id int(5) unsigned NOT NULL auto_increment,
+name varchar(128) NOT NULL default '',
+message text,
+explanation text,
+action text,
+datetime datetime default NULL,
+PRIMARY KEY  (id),
+UNIQUE KEY name (name)
+) ENGINE=MyISAM  COMMENT='Cisco Error Message Database';
+
+INSERT INTO actions (actionname, actiondescr, defaultaccess) VALUES ('add_user', 'Add users', 'TRUE');
+INSERT INTO actions (actionname, actiondescr, defaultaccess) VALUES ('edit_user', 'Edit users (delete and change password)', 'TRUE');
+INSERT INTO actions (actionname, actiondescr, defaultaccess) VALUES ('reload_cache', 'Reload search cache', 'TRUE');
+INSERT INTO actions (actionname, actiondescr, defaultaccess) VALUES ('edit_acl', 'Edit access control settings', 'TRUE');
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/sql/drop_table.sql php-syslog-ng/html/install/sql/drop_table.sql
--- php-syslog-ng-2.9.f/html/install/sql/drop_table.sql	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/sql/drop_table.sql	2007-04-26 08:31:59.000000000 -0400
@@ -0,0 +1,9 @@
+# Used to drop tables...duh
+# --------------------------------------------------------
+
+DROP TABLE IF EXISTS logs 
+DROP TABLE IF EXISTS users 
+DROP TABLE IF EXISTS search_cache 
+DROP TABLE IF EXISTS user_access 
+DROP TABLE IF EXISTS actions 
+DROP TABLE IF EXISTS cemdb 
diff -Nur -Nur php-syslog-ng-2.9.f/html/install/sql/sample_data.sql php-syslog-ng/html/install/sql/sample_data.sql
--- php-syslog-ng-2.9.f/html/install/sql/sample_data.sql	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/install/sql/sample_data.sql	2006-06-28 15:02:50.000000000 -0400
@@ -0,0 +1,3 @@
+INSERT INTO `logs` VALUES ('srv-www-001','daemon','warning','alert','Tag','2006-06-15 22:25:32','Test Script','%AAA-3-IPILLEGALMSG: Fan 1 had a rotation error reported.',1),('as-3550-2','kern','info','alert','Tag','2006-06-15 22:25:34','Test Script','Duplicate address 10.10.2.2 on Vlan20',2),('as-3550-2','mail','warning','crit','Tag','2006-06-15 22:25:36','Test Script','Line protocol on Interface FastEthernet0/7, changed state to up',3);
+INSERT INTO `search_cache` VALUES ('logs','HOST','as-3550-2','2006-06-15 18:25:54'),('logs','HOST','srv-www-001','2006-06-15 18:25:54'),('logs','FACILITY','daemon','2006-06-15 18:25:54'),('logs','FACILITY','kern','2006-06-15 18:25:54'),('logs','FACILITY','mail','2006-06-15 18:25:54');
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/INSTALL-STEPS php-syslog-ng/html/INSTALL-STEPS
--- php-syslog-ng-2.9.f/html/INSTALL-STEPS	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/INSTALL-STEPS	2008-05-10 15:15:59.000000000 -0400
@@ -0,0 +1,2 @@
+Moved to Wiki @
+http://nms.gdd.net/index.php/Installation_Guide
diff -Nur -Nur php-syslog-ng-2.9.f/html/LICENSE php-syslog-ng/html/LICENSE
--- php-syslog-ng-2.9.f/html/LICENSE	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/LICENSE	2005-05-23 15:32:28.000000000 -0400
@@ -0,0 +1,340 @@
+		    GNU GENERAL PUBLIC LICENSE
+		       Version 2, June 1991
+
+ Copyright (C) 1989, 1991 Free Software Foundation, Inc.
+                       51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+ Everyone is permitted to copy and distribute verbatim copies
+ of this license document, but changing it is not allowed.
+
+			    Preamble
+
+  The licenses for most software are designed to take away your
+freedom to share and change it.  By contrast, the GNU General Public
+License is intended to guarantee your freedom to share and change free
+software--to make sure the software is free for all its users.  This
+General Public License applies to most of the Free Software
+Foundation's software and to any other program whose authors commit to
+using it.  (Some other Free Software Foundation software is covered by
+the GNU Library General Public License instead.)  You can apply it to
+your programs, too.
+
+  When we speak of free software, we are referring to freedom, not
+price.  Our General Public Licenses are designed to make sure that you
+have the freedom to distribute copies of free software (and charge for
+this service if you wish), that you receive source code or can get it
+if you want it, that you can change the software or use pieces of it
+in new free programs; and that you know you can do these things.
+
+  To protect your rights, we need to make restrictions that forbid
+anyone to deny you these rights or to ask you to surrender the rights.
+These restrictions translate to certain responsibilities for you if you
+distribute copies of the software, or if you modify it.
+
+  For example, if you distribute copies of such a program, whether
+gratis or for a fee, you must give the recipients all the rights that
+you have.  You must make sure that they, too, receive or can get the
+source code.  And you must show them these terms so they know their
+rights.
+
+  We protect your rights with two steps: (1) copyright the software, and
+(2) offer you this license which gives you legal permission to copy,
+distribute and/or modify the software.
+
+  Also, for each author's protection and ours, we want to make certain
+that everyone understands that there is no warranty for this free
+software.  If the software is modified by someone else and passed on, we
+want its recipients to know that what they have is not the original, so
+that any problems introduced by others will not reflect on the original
+authors' reputations.
+
+  Finally, any free program is threatened constantly by software
+patents.  We wish to avoid the danger that redistributors of a free
+program will individually obtain patent licenses, in effect making the
+program proprietary.  To prevent this, we have made it clear that any
+patent must be licensed for everyone's free use or not licensed at all.
+
+  The precise terms and conditions for copying, distribution and
+modification follow.
+
+		    GNU GENERAL PUBLIC LICENSE
+   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
+
+  0. This License applies to any program or other work which contains
+a notice placed by the copyright holder saying it may be distributed
+under the terms of this General Public License.  The "Program", below,
+refers to any such program or work, and a "work based on the Program"
+means either the Program or any derivative work under copyright law:
+that is to say, a work containing the Program or a portion of it,
+either verbatim or with modifications and/or translated into another
+language.  (Hereinafter, translation is included without limitation in
+the term "modification".)  Each licensee is addressed as "you".
+
+Activities other than copying, distribution and modification are not
+covered by this License; they are outside its scope.  The act of
+running the Program is not restricted, and the output from the Program
+is covered only if its contents constitute a work based on the
+Program (independent of having been made by running the Program).
+Whether that is true depends on what the Program does.
+
+  1. You may copy and distribute verbatim copies of the Program's
+source code as you receive it, in any medium, provided that you
+conspicuously and appropriately publish on each copy an appropriate
+copyright notice and disclaimer of warranty; keep intact all the
+notices that refer to this License and to the absence of any warranty;
+and give any other recipients of the Program a copy of this License
+along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and
+you may at your option offer warranty protection in exchange for a fee.
+
+  2. You may modify your copy or copies of the Program or any portion
+of it, thus forming a work based on the Program, and copy and
+distribute such modifications or work under the terms of Section 1
+above, provided that you also meet all of these conditions:
+
+    a) You must cause the modified files to carry prominent notices
+    stating that you changed the files and the date of any change.
+
+    b) You must cause any work that you distribute or publish, that in
+    whole or in part contains or is derived from the Program or any
+    part thereof, to be licensed as a whole at no charge to all third
+    parties under the terms of this License.
+
+    c) If the modified program normally reads commands interactively
+    when run, you must cause it, when started running for such
+    interactive use in the most ordinary way, to print or display an
+    announcement including an appropriate copyright notice and a
+    notice that there is no warranty (or else, saying that you provide
+    a warranty) and that users may redistribute the program under
+    these conditions, and telling the user how to view a copy of this
+    License.  (Exception: if the Program itself is interactive but
+    does not normally print such an announcement, your work based on
+    the Program is not required to print an announcement.)
+
+These requirements apply to the modified work as a whole.  If
+identifiable sections of that work are not derived from the Program,
+and can be reasonably considered independent and separate works in
+themselves, then this License, and its terms, do not apply to those
+sections when you distribute them as separate works.  But when you
+distribute the same sections as part of a whole which is a work based
+on the Program, the distribution of the whole must be on the terms of
+this License, whose permissions for other licensees extend to the
+entire whole, and thus to each and every part regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest
+your rights to work written entirely by you; rather, the intent is to
+exercise the right to control the distribution of derivative or
+collective works based on the Program.
+
+In addition, mere aggregation of another work not based on the Program
+with the Program (or with a work based on the Program) on a volume of
+a storage or distribution medium does not bring the other work under
+the scope of this License.
+
+  3. You may copy and distribute the Program (or a work based on it,
+under Section 2) in object code or executable form under the terms of
+Sections 1 and 2 above provided that you also do one of the following:
+
+    a) Accompany it with the complete corresponding machine-readable
+    source code, which must be distributed under the terms of Sections
+    1 and 2 above on a medium customarily used for software interchange; or,
+
+    b) Accompany it with a written offer, valid for at least three
+    years, to give any third party, for a charge no more than your
+    cost of physically performing source distribution, a complete
+    machine-readable copy of the corresponding source code, to be
+    distributed under the terms of Sections 1 and 2 above on a medium
+    customarily used for software interchange; or,
+
+    c) Accompany it with the information you received as to the offer
+    to distribute corresponding source code.  (This alternative is
+    allowed only for noncommercial distribution and only if you
+    received the program in object code or executable form with such
+    an offer, in accord with Subsection b above.)
+
+The source code for a work means the preferred form of the work for
+making modifications to it.  For an executable work, complete source
+code means all the source code for all modules it contains, plus any
+associated interface definition files, plus the scripts used to
+control compilation and installation of the executable.  However, as a
+special exception, the source code distributed need not include
+anything that is normally distributed (in either source or binary
+form) with the major components (compiler, kernel, and so on) of the
+operating system on which the executable runs, unless that component
+itself accompanies the executable.
+
+If distribution of executable or object code is made by offering
+access to copy from a designated place, then offering equivalent
+access to copy the source code from the same place counts as
+distribution of the source code, even though third parties are not
+compelled to copy the source along with the object code.
+
+  4. You may not copy, modify, sublicense, or distribute the Program
+except as expressly provided under this License.  Any attempt
+otherwise to copy, modify, sublicense or distribute the Program is
+void, and will automatically terminate your rights under this License.
+However, parties who have received copies, or rights, from you under
+this License will not have their licenses terminated so long as such
+parties remain in full compliance.
+
+  5. You are not required to accept this License, since you have not
+signed it.  However, nothing else grants you permission to modify or
+distribute the Program or its derivative works.  These actions are
+prohibited by law if you do not accept this License.  Therefore, by
+modifying or distributing the Program (or any work based on the
+Program), you indicate your acceptance of this License to do so, and
+all its terms and conditions for copying, distributing or modifying
+the Program or works based on it.
+
+  6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the
+original licensor to copy, distribute or modify the Program subject to
+these terms and conditions.  You may not impose any further
+restrictions on the recipients' exercise of the rights granted herein.
+You are not responsible for enforcing compliance by third parties to
+this License.
+
+  7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues),
+conditions are imposed on you (whether by court order, agreement or
+otherwise) that contradict the conditions of this License, they do not
+excuse you from the conditions of this License.  If you cannot
+distribute so as to satisfy simultaneously your obligations under this
+License and any other pertinent obligations, then as a consequence you
+may not distribute the Program at all.  For example, if a patent
+license would not permit royalty-free redistribution of the Program by
+all those who receive copies directly or indirectly through you, then
+the only way you could satisfy both it and this License would be to
+refrain entirely from distribution of the Program.
+
+If any portion of this section is held invalid or unenforceable under
+any particular circumstance, the balance of the section is intended to
+apply and the section as a whole is intended to apply in other
+circumstances.
+
+It is not the purpose of this section to induce you to infringe any
+patents or other property right claims or to contest validity of any
+such claims; this section has the sole purpose of protecting the
+integrity of the free software distribution system, which is
+implemented by public license practices.  Many people have made
+generous contributions to the wide range of software distributed
+through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing
+to distribute software through any other system and a licensee cannot
+impose that choice.
+
+This section is intended to make thoroughly clear what is believed to
+be a consequence of the rest of this License.
+
+  8. If the distribution and/or use of the Program is restricted in
+certain countries either by patents or by copyrighted interfaces, the
+original copyright holder who places the Program under this License
+may add an explicit geographical distribution limitation excluding
+those countries, so that distribution is permitted only in or among
+countries not thus excluded.  In such case, this License incorporates
+the limitation as if written in the body of this License.
+
+  9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time.  Such new versions will
+be similar in spirit to the present version, but may differ in detail to
+address new problems or concerns.
+
+Each version is given a distinguishing version number.  If the Program
+specifies a version number of this License which applies to it and "any
+later version", you have the option of following the terms and conditions
+either of that version or of any later version published by the Free
+Software Foundation.  If the Program does not specify a version number of
+this License, you may choose any version ever published by the Free Software
+Foundation.
+
+  10. If you wish to incorporate parts of the Program into other free
+programs whose distribution conditions are different, write to the author
+to ask for permission.  For software which is copyrighted by the Free
+Software Foundation, write to the Free Software Foundation; we sometimes
+make exceptions for this.  Our decision will be guided by the two goals
+of preserving the free status of all derivatives of our free software and
+of promoting the sharing and reuse of software generally.
+
+			    NO WARRANTY
+
+  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
+FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
+OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
+PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
+OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
+MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
+TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
+REPAIR OR CORRECTION.
+
+  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
+WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
+INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
+OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
+TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
+YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
+PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
+POSSIBILITY OF SUCH DAMAGES.
+
+		     END OF TERMS AND CONDITIONS
+
+	    How to Apply These Terms to Your New Programs
+
+  If you develop a new program, and you want it to be of the greatest
+possible use to the public, the best way to achieve this is to make it
+free software which everyone can redistribute and change under these terms.
+
+  To do so, attach the following notices to the program.  It is safest
+to attach them to the start of each source file to most effectively
+convey the exclusion of warranty; and each file should have at least
+the "copyright" line and a pointer to where the full notice is found.
+
+    <one line to give the program's name and a brief idea of what it does.>
+    Copyright (C) <year>  <name of author>
+
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or
+    (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU General Public License for more details.
+
+    You should have received a copy of the GNU General Public License
+    along with this program; if not, write to the Free Software
+    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+
+
+Also add information on how to contact you by electronic and paper mail.
+
+If the program is interactive, make it output a short notice like this
+when it starts in an interactive mode:
+
+    Gnomovision version 69, Copyright (C) year name of author
+    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
+    This is free software, and you are welcome to redistribute it
+    under certain conditions; type `show c' for details.
+
+The hypothetical commands `show w' and `show c' should show the appropriate
+parts of the General Public License.  Of course, the commands you use may
+be called something other than `show w' and `show c'; they could even be
+mouse-clicks or menu items--whatever suits your program.
+
+You should also get your employer (if you work as a programmer) or your
+school, if any, to sign a "copyright disclaimer" for the program, if
+necessary.  Here is a sample; alter the names:
+
+  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
+  `Gnomovision' (which makes passes at compilers) written by James Hacker.
+
+  <signature of Ty Coon>, 1 April 1989
+  Ty Coon, President of Vice
+
+This General Public License does not permit incorporating your program into
+proprietary programs.  If your program is a subroutine library, you may
+consider it more useful to permit linking proprietary applications with the
+library.  If this is what you want to do, use the GNU Library General
+Public License instead of this License.
diff -Nur -Nur php-syslog-ng-2.9.f/html/login.php php-syslog-ng/html/login.php
--- php-syslog-ng-2.9.f/html/login.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/login.php	2008-08-12 18:21:52.000000000 -0400
@@ -0,0 +1,210 @@
+<?php
+
+/*
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2006-12-11 - created
+ *
+ */
+
+session_start();
+include_once ("config/config.php");
+include_once ("includes/common_funcs.php");
+
+// If Access system is not used, then skip all this - i.e. Open system
+if(!defined('USE_ACL') || !USE_ACL || !defined('REQUIRE_AUTH') || !REQUIRE_AUTH) {
+   	$_SESSION["member_id"] = "NoACL_localuser";
+	$_SESSION["username"] = "NoACL_localuser";
+   	$sessionId = md5(mt_rand());
+   	$_SESSION["pageId"] = "searchform" ;
+   	Header("Location: " .INDEX_URL); // Redirect authenticated member
+   	exit();
+}
+
+if ($_POST) {
+   	$error = login_check($_POST);
+   	if (trim($error)=="") {
+	   	$_SESSION["member_id"] = login($_POST);
+	   	if ((stristr($_SESSION["member_id"], "Invalid") == TRUE) || 
+				(stristr($_SESSION["member_id"], "Sorry") == TRUE)) {
+		   	die($_SESSION["member_id"] ."<br><a href=" .INDEX_URL .">Return</a>");
+	   	}
+		// Cdukes: 3/20/08: Carry post variables through login
+		// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=35
+	   	// Header("Location: " .INDEX_URL); // Redirect authenticated member
+		$destination = INDEX_URL;
+	   	// Remember search query across login
+	   	if (!empty($_POST['searchQuery']))
+	   	{
+		   	$destination .= '?' . ($_POST['searchQuery']);
+	   	}
+	   	Header("Location: " . $destination); // Redirect authenticated member
+	   	exit();
+   	} else {
+	   	print "Error:$error";
+   	}
+} elseif (defined('CERTAUTH_ENABLE') && (CERTAUTH_ENABLE == TRUE)) {
+    $_POST['username'] = $_SERVER['SSL_CLIENT_S_DN'];
+    $_POST['password'] = "nothing";
+    $_POST['authtype'] = "cert";
+
+    $error = login_check($_POST);
+    if (trim($error)=="") {
+        $_SESSION["member_id"] = login($_POST);
+        if ((stristr($_SESSION["member_id"], "Invalid") == TRUE) ||
+                (stristr($_SESSION["member_id"], "Sorry") == TRUE)) {
+            die($_SESSION["member_id"] ."<br><a href=" .INDEX_URL .">Return</a>");
+        }
+        // Cdukes: 3/20/08: Carry post variables through login
+        // Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=35
+        // Header("Location: " .INDEX_URL); // Redirect authenticated member
+        $destination = INDEX_URL;
+        // Remember search query across login
+        if (!empty($_POST['searchQuery']))
+        {
+            $destination .= '?' . ($_POST['searchQuery']);
+        }
+        Header("Location: " . $destination); // Redirect authenticated member
+        exit();
+    } else {
+        print "Error:$error";
+    }
+
+} else {
+   	?>
+	   	<html>
+	   	<head>
+	   	<title><?php echo PAGETITLE;?> Login</title>
+	   	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+	   	<meta http-equiv="expires" content="0">
+	   	<meta http-equiv="pragma" content="no-cache">
+	   	</head>
+	   	<SCRIPT LANGUAGE="JavaScript">
+	   	<!--
+	   	document.onmousedown=click;
+   	function click()
+   	{
+	   	if (event.button==2) {alert('Right-clicking has been disabled by the administrator.');}
+   	}
+
+	//-->
+   	</SCRIPT>
+	   	<div align="center">
+	   	<form method="post" action="<?php echo  $_SERVER['PHP_SELF']; ?>">
+		<?php
+		// Cdukes: 3/20/08: Carry post variables through login
+		// Ref: http://code.google.com/p/php-syslog-ng/issues/detail?id=35
+	   	// Remember search query across login
+	   	if (!empty($_SERVER['QUERY_STRING']))
+	   	{
+		   	$queryString = htmlspecialchars($_SERVER['QUERY_STRING']);
+		   	echo '<input type="hidden" name="searchQuery" value="' . $queryString . '">';
+	   	}
+   	?>
+	   	<div align="center">
+
+		<br><br><br><br>
+	   	<table width="210" border="0" cellspacing="0" cellpadding="0">
+	   	<tr>
+	   	<td align="center">
+	   	<fieldset>
+	   	<Legend><font face="Verdana,Tahoma,Arial,sans-serif" size="1"
+	   	color="gray">
+	   	<image src="images/php-syslog-ng.png" alt="Authorization Check" name="image">
+		</font>
+		</Legend>
+	   	<table border="0" cellspacing="3" cellpadding="0">
+	   	<tr>
+	   	<td align="right" valign="middle"><b><font
+	   	face="Verdana,Tahoma,Arial,sans-
+	   	serif" size="1" color="gray">Username:</font></td>
+	   	<td align="center" valign="middle">
+	   	<?php if(defined('DEMO') && DEMO == TRUE) { ?>
+	   	<input class="clear" type="text" size="15" name="username" value="demo">
+		   	<?php } elseif(defined('WEBBASIC_ENABLE') && (WEBBASIC_ENABLE == TRUE)) { ?>
+			   	<input class="clear" type="text" size="35" name="username" value="<?php print $_SERVER['REMOTE_USER']; ?>">
+			<?php } else { ?>
+	   	<input class="clear" type="text" size="15" name="username">
+			<?php } ?>
+	   	</td>
+	   	</tr>
+	   	<tr>
+	   	<td align="right" valign="middle"><b><font
+	   	face="Verdana,Tahoma,Arial,sans-
+	   	serif" size="1" color="gray">Password:</font></td>
+	   	<td align="center" valign="middle">
+	   	<?php if(defined('DEMO') && DEMO == TRUE) { ?>
+	   	<input class="pass" type="password" size="15" name="password" value="demo">
+		   	<?php } elseif(defined('WEBBASIC_ENABLE') && (WEBBASIC_ENABLE == TRUE)) { ?>
+			   	<input class="pass" type="password" size="35" name="password">
+			<?php } else { ?>
+	   	<input class="pass" type="password" size="15" name="password">
+			<?php } ?>
+	   	</td>
+		</tr>
+	   	<!-- Begin LDAP Mod -->
+        <?php if ((LDAP_ENABLE == "YES") || (WEBBASIC_ENABLE == TRUE)) { ?>
+	   	<tr>
+	   	<td align="right" valign="middle"><b><font
+	   	face="Verdana,Tahoma,Arial,sans-
+	   	serif" size="1" color="gray">Auth Type:</font></td>
+	   	<td align="center" valign="middle">
+	   	<SELECT NAME="authtype" STYLE="width: 115px">  
+       <?php if (LDAP_ENABLE == "YES") { ?> <OPTION VALUE="ldap" selected> LDAP <?php } ?>
+       <?php if (WEBBASIC_ENABLE == TRUE) { ?> <OPTION VALUE="basic" selected> Web Basic <?php } ?>
+		<OPTION VALUE="local"> Local
+	   	</SELECT>    
+	   	</td>
+	   	</tr>
+		<?php } ?>
+	   	<!-- END LDAP Mod -->
+	   	</table>
+	   	<input type=image src="images/go.gif" alt="Login" name="image">
+	   	<br>
+	   	</div>
+	   	</td>
+	   	</tr>
+	   	</fieldset>
+	   	</table>
+	   	<br>
+	   	<table width="640"><tr><td align="center">
+	   	<?php if(defined('DEMO') && DEMO == TRUE) { ?>
+	   	<font face="Verdana,Tahoma,Arial,sans-serif" size="1"
+	   	color="red">This demo system is typically running beta code, so don't be surprised if something doesn't work exactly as you expected. <br>For the latest stable version's changelog, please follow <a href="http://php-syslog-ng.gdd.net/CHANGELOG">this link</a>.
+		<?php } else { ?>
+	   	<font face="Verdana,Tahoma,Arial,sans-serif" size="1"
+	   	color="silver">This System is
+	   	for the use of authorized users only. Individuals using this computer system
+		   	without
+			   	authority, or in excess of their authority, are subject to having their activities
+			   	on this system
+			   	monitored and recorded by system personnel. In the course of monitoring individuals
+			   	improperly using this system, or in the course of system maintenance, the activities
+			   	of
+			   	authorized users may also be monitored. Anyone using this system expressly consents
+			   	to
+			   	such monitoring and is advised that if such monitoring reveals possible criminal
+			   	activity,
+			   	system personnel may provide the evidence of such monitoring to law enforcement
+				   	officals.
+				  	This warning has been provided by the United States Department of Justice and is
+				   	intended to
+				   	ensure that monitoring of user activity is not in violation of the Communications
+				   	Privacy Act of
+				   	1986.
+					<?php } ?>
+					</font>
+				   	</td></tr>
+					</table>
+
+					</div>
+				   	</form>
+
+					</div>
+				   	</body>
+				   	</html>
+<?php } ?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/logout.php php-syslog-ng/html/logout.php
--- php-syslog-ng-2.9.f/html/logout.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/logout.php	2008-02-06 15:53:30.000000000 -0500
@@ -0,0 +1,16 @@
+<?php
+require_once ("config/config.php");
+	/* BEGIN: Added by BPK to reset search selections memory */
+	session_start();
+	foreach ($_SESSION as $key => $value) {
+		unset($_SESSION[$key]);
+		session_unregister($key);
+	}
+	session_unset();
+	session_destroy();
+	/* END: Added by BPK to reset search selections memory */
+// session_start();
+// session_destroy();
+header("Location: " . INDEX_URL);
+exit;
+?> 
diff -Nur -Nur php-syslog-ng-2.9.f/html/README php-syslog-ng/html/README
--- php-syslog-ng-2.9.f/html/README	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/README	2008-02-28 17:14:03.000000000 -0500
@@ -0,0 +1,120 @@
+
+*** IMPORTANT ***
+Please READ this and the CHANGELOG document, it has some important stuff too :)
+******************
+
+To install, just browse to http://<url>/install
+Now, if you go right to doing this without reading this and the changelog, you are totally on your own.
+(you might also want to look at TROUBLESHOOTING-INSTALL if you have problems)
+
+/*********************************************************************/
+Release notes for php-syslog-ng 2.9.1:
+I've taken the 2.8 version, fixed a few bugs/annoyances and added an install interface.
+To use the installer, just create an empty (writeable) config.php in the config/ directory and point
+your browser to http://yourserver/install
+
+I've also added a perl script to generate fake events located at scripts/dbgen.pl
+
+Added the Cisco Error Message Database (CEMDB)
+ - The CEMDB includes a MySQL table of all cisco errors available (~25k entries).
+ - It will automatically display more information about any Cisco-based event that comes in.
+ - Note that you must have javascript enabled for this to display.
+To enable this feature, your config file requires two entries:
+define('CEMDB', 'ON');
+define('CISCO_ERROR_TABLE', 'cemdb');
+These entries are created if you use the installer.
+
+I'm including the dumpfile for the CEMDB stuff - it can be found in install/sql/cemdb.sql
+Note that scripts/cemdb/* is not needed, it's there for future updates of the cemdb.
+All you need is the cemdb.sql file in the install directory.
+* You may want to GZIP this file to save space, I'm leaving it uncompressed to the installer can use it
+* Someone should write code to automatically uncompress and compress it as needed using the installer
+* (I may if I have time)
+
+- Clayton Dukes
+- Lot's-o-props to Michael Freeman for his help on the emd.pl script! (mfreeman451@gmail.com)
+/*********************************************************************/
+
+/*********************************************************************/
+* Release notes for php-syslog-ng 2.9.2:
+* NEW CONFIG - If you are not using the install utility provided, please note that the 
+* config/config.php file has changed -- see config.php.dist for an example.
+/*********************************************************************/
+- Lot's of minor fixes to 2.9.1
+- Added Graphing capability on the main page
+- To enable/disable Graphs, modify config.php
+ * Be sure to create a cache directory (jpcache is the default) and make it writeable by the web user.
+ * You may also want to add a cronjob to clean out the cache on a daily basis, like so:
+ @daily find /path/to/web/directory/html/jpcache -atime 1 -exec rm -f '{}' ';'
+ * This will delete files in that directory older then 1 day
+- Note: If you see an error about a missing font, the be sure to install the MS ttf's (verdana.ttf). In Ubuntu, just type "aptitude install msttcorefonts", other OS's, please read http://www.mail-archive.com/php-syslog-ng-support@lists.sourceforge.net/msg00126.html
+- Please read more about JPGraph here:
+ http://www.aditus.nu/jpgraph/pdf/jpgraphddda.pdf
+ Specifically, please note that it required GD libs to run!
+- The full JPGRAPH library is included with this distribution located under includes/jpgraph
+  It is the standard download - no modifications have been made to the source.
+
+
+- Changed the size of host tables in the database from varchar(32) to varchar(128) -- my customer has *really* long dns names and they were getting truncated.
+ To modify your installation, do the following from mysql:
+ * alter table logs modify host varchar(128) default NULL; 
+ * alter table search_cache modify value varchar(128) default NULL; 
+ Then, be sure to clear your search cache:
+ * delete from search_cache;
+
+- Changed default searches to include only yesterday to today. In other words, if you leave the date fields blank on the main page and click search, it will only search from yesterday until today, not everything. I did this because users at my client site would just click search without selecting anything just to see what it does and then complain that it was slow :-)
+ * To do this, I just modified regularresult.php and changed the following:
+ $date = get_input('date'); 
+ if (! $date) { 
+ $date = "yesterday"; 
+ }   
+ $date2 = get_input('date2'); 
+ if (! $date2) { 
+ $date = "today"; 
+ }   
+
+- A couple of people have asked how to create a password for the admin manually through the DB interface, here's how:
+ insert into users (username, pwhash) values ('admin', MD5("somepassword"));
+
+- Modified reloadcache.php and added:
+ $basePath = dirname( __FILE__ );
+ include_once "$basePath/../includes/common_funcs.php";
+ include_once "$basePath/../config/config.php";
+ So that I could run a cron job every 5 minutes to update the cache:
+ 0,5,10,15,20,25,30,35,40,45,50,55 * * * * php /www/php-syslog-ng/html/scripts/reloadcache.php >> /var/log/reloadcache.log
+
+- Modified dbgen.pl and made it more random -- including random hosts now.
+  * Also cleaned up the code some in it.
+
+- Modified scripts/syslog2mysql.sh so that it uses syslogadmin instead of syslogfeeder (I don't see a need for a separate syslogfeeder account)
+
+- Modified many of the files to use $basePath parameter instead of relative paths
+$basePath = dirname( __FILE__ );
+include_once "$basePath/../includes/common_funcs.php";
+include_once "$basePath/../config/config.php";
+
+- Modified META refresh tags on login and logout to use JS instead of META since it's faster and doesn't try to modify header information.
+
+- Overlib (javascript popup)
+You guys are more than welcome to make it better if you like.
+The javascript being used is from overLIB
+3.51(http://www.bosrup.com/web/overlib)
+Yes, I am aware there are later version available, but this version is
+much smaller and easier to use (but sacrifices more features).
+
+/*********************************************************************/
+/* The scripts directory contains some sample scripts that can be    */
+/* used to set up all the pieces needed by php-syslog-ng. Make sure  */
+/* you edit those scripts to match your environment before using     */
+/* them.                                                             */
+/*********************************************************************/
+ * General *
+php-syslog-ng is licensed under the terms of the GNU Public License (GPL) Version 2 as published by the Free Software Foundation. This gives you legal permission to copy, distribute and/or modify php-syslog-ng under certain conditions. Read the 'LICENSE' file in the php-syslog-ng distribution or read the online version of the license for more details. php-syslog-ng is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE WARRANTY OF DESIGN, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE.
+
+Release notes for php-syslog-ng 2.7:
+This release only contains bug fixes. See the changelog for the complete list of changes.
+If you are using the merge table then you need to use MySQL 4.0.18 or later.
+
+-Claus
+
+# END
diff -Nur -Nur php-syslog-ng-2.9.f/html/robots.txt php-syslog-ng/html/robots.txt
--- php-syslog-ng-2.9.f/html/robots.txt	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/robots.txt	2006-06-15 09:13:31.000000000 -0400
@@ -0,0 +1,8 @@
+User-agent: * 
+Disallow: /scripts/
+Disallow: /installation/
+Disallow: /config/
+Disallow: /css/
+Disallow: /includes/
+
+ 
diff -Nur -Nur php-syslog-ng-2.9.f/html/TROUBLESHOOTING-INSTALL php-syslog-ng/html/TROUBLESHOOTING-INSTALL
--- php-syslog-ng-2.9.f/html/TROUBLESHOOTING-INSTALL	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/TROUBLESHOOTING-INSTALL	2007-09-05 00:49:25.000000000 -0400
@@ -0,0 +1,37 @@
+/ ** General Installation Issues **/
+
+- MAKE SURE YOU SET YOUR PHP.INI file to these minimum specifications:
+max_execution_time = 300     ; Maximum execution time of each script, in seconds
+max_input_time = 120 ; Maximum amount of time each script may spend parsing request data
+memory_limit = 128M      ; Maximum amount of memory a script may consume (8MB)
+
+- If you get: "Error in perform_query function: No DB link"
+when accessing http://URL/install, then zero out your config.php file by doing:
+echo " " > config/config.php
+Make sure the files still exists and is writeable though or the installer won't work properly.
+
+- If you see something similar to:
+  Fatal error: Allowed memory size of 8388608 bytes exhausted (tried to allocate 10191457 bytes) in 
+  /www/install/install2.php on line 161
+  Then it means you haven't set your php_ini memory_limit parameter to >= 128M
+
+- Note: If you see an error about a missing font, the be sure to install the MS ttf's (verdana.ttf). 
+In Ubuntu, just type "aptitude install msttcorefonts"
+Other OS's, please read http://www.mail-archive.com/php-syslog-ng-support@lists.sourceforge.net/msg00126.html
+- Please read more about JPGraph here:
+ http://www.aditus.nu/jpgraph/pdf/jpgraphddda.pdf
+ Specifically, please note that it requires GD libs to run!
+
+- If you get an error using the dbgen.pl script such as "send: Cannot determine peer address at /usr/local/share/perl/5.8.8/Net/MySQL.pm" then use the MySQL.pm file located in the scripts directory (this is known bug for Net::MySql 0.09 and > Mysql 5.x)
+Ref: http://rt.cpan.org/Public/Bug/Display.html?id=21462
+
+- If you get an error like this:
+Parse error: parse error, unexpected T_STRING, expecting
+T_OLD_FUNCTION or T_FUNCTION or T_VAR or '}' in /var/www/html/syslog/
+includes/CEMDB.class.php on line 11
+Then chances are your using PHP v4 which doesn't like the syntax on the CEMDB.class file.
+You can get a v4 class file from:
+http://code.google.com/p/php-syslog-ng/issues/detail?id=13
+
+# END
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/wap/index.php php-syslog-ng/html/wap/index.php
--- php-syslog-ng-2.9.f/html/wap/index.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/wap/index.php	2008-08-14 15:43:17.000000000 -0400
@@ -0,0 +1,48 @@
+<?php require_once ("../config/config.php"); 
+$url ="";
+if (preg_match("/\w+/", SITEURL)) {
+	$url = SITEURL;
+}
+?>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
+<html><head>
+<img src="<?php echo $url ?>/images/php-syslog-ng.png" width="35" height="35" align="left">
+<title>
+Log Browser
+</title>
+    <meta name="viewport" content="width=320"/>
+    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
+    <link rel="stylesheet" type="text/css" href="<?php echo $url ?>/wap/wap.css" />
+    <script src="<?php echo $url ?>/wap/wap.js" type="text/javascript"></script>
+</head>
+
+<body>
+    <div id="iphone_header">
+        <div id="iphone_backbutton">
+            <img src="<?php echo $url ?>/images/wap/back-button-tip.png" border="0" align="left" />
+            <a id="iphone_backbutton_text" href="#" class="go_back">Back</a>
+        </div>
+    	<div id="iphone_title"></div>
+	</div>
+
+	<div id="iphone_body" style="clear:both;">
+		<ul class="menu">
+			<!-- <li><a href="wform.php?demo=1" class="go_forward" title="Search">Search</a></li>-->
+			<!-- <li><a href="wap_form.php?demo=2" class="go_forward" title="Form Demo 2">Form Demo 2</a></li> -->
+			<li><a href="wres.php?page=tail&limit=10" class="go_forward" title="Latest Events">Latest Events</a></li>
+			<li><a href="wres.php?page=topx&limit=10" class="go_forward" title="Top Talkers">Top Talkers</a></li>
+			<!--<li><a href="wap_page.php?page=2" class="go_forward" title="Item 2">Item 2</a></li> -->
+			<!--<li><a href="wap_page.php?page=3" class="go_forward" title="Item 3">Item 3</a></li> -->
+		</ul>
+	</div>
+
+	<div id="iphone_footer">PHP-Sysog-NG</div>
+
+	<div id="iphone_loading_page">
+		<div id='loading' class="info_msg">
+			<img src="<?php echo $url ?>/images/wap/loading.gif" /><br />
+			loading...
+		</div>
+	</div>
+</body>
+</html>
diff -Nur -Nur php-syslog-ng-2.9.f/html/wap/wap.css php-syslog-ng/html/wap/wap.css
--- php-syslog-ng-2.9.f/html/wap/wap.css	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/wap/wap.css	2008-08-14 11:00:42.000000000 -0400
@@ -0,0 +1,257 @@
+/*
+File: CiUI.css
+
+Style sheet complementing CiUI library.
+
+License:
+	http://clientside.cnet.com/wiki/cnet-libraries#license
+*/
+
+* {
+	padding: 0;
+	margin: 0;
+	font-family:Helvetica,"Lucida Grande",Verdana,Arial,sans-serif;
+}
+
+body {
+	overflow: visible;
+	padding: 0;
+	margin: 0;
+	width: 320px;
+}
+
+#iphone_header {
+	left: 0px;
+	top: 0px;
+	height:44px;
+	background: #ca2026;
+}
+
+#iphone_body {
+	position: relative;
+	overflow: hidden;	
+	width: 100%;
+	min-height: 316px;
+}
+
+.iphone_page {
+	position: absolute;
+	width: 100%;
+}
+
+#iphone_footer {
+	position: relative;
+	font-size: 10px;
+	color: #666;
+	text-align: center;
+}
+
+#iphone_backbutton {
+	position: relative;
+	float: left;
+	top: 7px;
+	left: 5px;
+	cursor: pointer;
+	display: none;
+}
+
+#iphone_backbutton_text {
+	background:transparent url(images/back-button-body.png) no-repeat scroll right top;
+	color:white;
+	display:block;
+	font-size:12px;
+	font-weight:bold;
+	height:30px;
+	margin-left:11px;
+	padding-right:5px;
+	padding-top:9px;
+	text-decoration:none;
+}
+
+#iphone_loading_page {
+	display: none;
+}
+
+#iphone_title {
+	color: white;
+	position: relative;
+	text-align: center;
+	padding: 0;
+	top: 13px;
+	font-weight: bold;
+	font-size: 18px;
+	text-shadow: rgba(0, 0, 0, 0.4) 0px -1px 0;
+	text-overflow: ellipsis;
+	white-space: nowrap;
+	overflow: hidden;
+	left: 5px;
+}
+
+.refresh {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 10px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background-color: #eee;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+}
+
+a.refresh:before {
+	content: "Refresh...";
+}
+
+.refresh_loading {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 23px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background:#194fdb url(images/loading-small.gif) no-repeat 1% center;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+	color: white;
+}
+
+a.refresh_loading:after {
+	content: "Refreshig...";
+}
+.load_more {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 10px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background-color: #eee;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+}
+
+a.load_more:before {
+	content: "Load more content...";
+}
+
+.load_more_loading {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 23px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background:#194fdb url(images/loading-small.gif) no-repeat 1% center;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+	color: white;
+}
+
+a.load_more_loading:after {
+	content: "Loading...";
+}
+
+.info_msg {
+	font-size:18px;
+	font-weight:bold;
+	text-align:center;
+	vertical-align:middle;
+	height:300px;
+	width:100%;
+	margin-bottom:150px;
+	margin-top:100px;
+}
+
+#cancel_button {
+	font-size: 16px;
+	font-weight: bold;
+	margin-top: 5px;
+	color: #333;
+}
+
+.menu {
+	width: 100%;
+	list-style-type: none;
+}
+
+.menu > li {
+	clear: both;
+	height: 30px;
+	font-weight: bold;
+	font-size: 16px;
+	cursor: pointer;
+	margin: 0;
+	padding: 8px 0pt 8px 10px;
+	border-bottom: 1px solid #ddd;	
+}
+
+.menu > li > a {
+	text-overflow: ellipsis;
+	text-decoration: none;
+	color: #333;
+	display: block;
+	padding: 8px 32px 8px 10px;
+	margin: 0px 0pt -8px -10px;
+	background: url(images/arrow-right.png) no-repeat right center;
+}
+
+.menu li button {
+	font-size:16px;
+	font-weight:bold;
+	vertical-align: middle;
+}
+
+.menu li img {
+	border: 0px;
+	vertical-align:middle;
+	margin-right: 5px;
+}
+.wapdarker {
+  background-color: #C0C0C0;
+  font-size: 9px;
+}
+.waplighter {
+  background-color: #E0E0E0;
+  font-size: 9px;
+}
+.wapresultsheader {
+  background-color: #484848;
+  color: #ffffff;
+  text-align: left;
+  font-weight: bold;
+  font-size: 9px;
+}
+.debug {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 10px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background-color: #eee;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+}
+
+a.debug:before {
+	content: "Debug...";
+}
+
+.debug {
+	display: block; 
+	height: 17px; 
+	padding: 8px 32px 8px 23px; 
+	font-weight: bold; 
+	font-size: 14px; 
+	background:#194fdb url(images/loading-small.gif) no-repeat 1% center;
+	text-decoration: none;
+	border-top: 1px solid #ddd;
+	border-bottom: 1px solid #ddd;
+	color: white;
+}
+
+a.debug:after {
+	content: "Debug...";
+}
+
diff -Nur -Nur php-syslog-ng-2.9.f/html/wap/wap.js php-syslog-ng/html/wap/wap.js
--- php-syslog-ng-2.9.f/html/wap/wap.js	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/wap/wap.js	2008-04-11 20:01:44.000000000 -0400
@@ -0,0 +1,341 @@
+/*
+Script: CiUI.js
+
+Handles iPhone-optimized pages and mimics iPhone UI behavior
+
+License:
+	http://clientside.cnet.com/wiki/cnet-libraries#license
+*/
+
+(function() {
+
+var bodyEl; // see ciUI.initialize() for details
+var buttonForward = "go_forward";
+var buttonBackward = "go_back";
+var buttonLoadMore = "load_more";
+var backButtonEl; // see ciUI.initialize() for details
+var backButtonTextEl; // see ciUI.initialize() for details
+var pageTitleEl; // see ciUI.initialize() for details
+var update = "do_update";
+var updateAttr = "update";
+
+var pages = []; // see ciUI.initialize() for details
+var pageHistory = []; 
+
+var homePage = location.href;
+var hashPrefix = "#__";
+var currentHash = location.hash;
+var currentPage = 1; // possible values are 1 or -1 (1: from, -1: to)
+
+var animSpeed = 20; // smaller number means slower animation
+var navigationCheckInterval = 300;
+var navigtionChangeTimer;
+var uiIsActive;
+
+window.ciUI = {
+	initialize: function() {
+		bodyEl = $("iphone_body");
+		backButtonEl = $("iphone_backbutton");
+		backButtonTextEl = $("iphone_backbutton_text");
+		pageTitleEl = $("iphone_title");
+		if (!bodyEl || !backButtonEl || !backButtonTextEl || !pageTitleEl) return;
+		if (pageTitleEl && pageTitleEl.innerHTML == "") pageTitleEl.innerHTML = document.title;
+		this.setupPages();
+		this.animating = false;
+		setTimeout(scrollTo, 100, 0, 1);
+		return true;
+	},
+	
+	setupPages: function() {
+		var page1 = document.createElement('div');
+		var page2 = document.createElement('div');
+		var home  = document.createElement('div');
+		var ascrolltop = document.createElement('a');
+
+		page1.id = "__page1__";
+		page1.className = "iphone_page";
+		page1.style.left = "0%";
+		page1.style.display = "block";
+		
+		page2.id = "__page2__";
+		page2.className = "iphone_page";
+		page2.style.left = "100%";
+		page2.style.display = "none";
+		
+		home.id	= "__home__";
+		home.style.display = "none";
+		ascrolltop.id = "__scroll_top__";
+		ascrolltop.name = "";
+		
+		page1.innerHTML = home.innerHTML = bodyEl.innerHTML;
+		bodyEl.innerHTML = "";
+		bodyEl.appendChild(page1);
+		bodyEl.appendChild(page2);		
+		document.body.appendChild(home);
+		document.body.insertBefore(ascrolltop, document.body.firstChild);
+
+		this.adjustBodyToEl(page1);
+	
+		pages[1] = $(page1.id);
+		pages[0] = $(home.id);
+		pages[-1] = $(page2.id);
+	},
+	
+	goToPage: function(target, backwards) {
+		if (backwards === undefined) backwards = false;
+
+		this.slidePages(backwards);
+		// BACKWARD
+		if (backwards) { 
+			currentHash = location.hash;
+			pageHistory.splice(pageHistory.indexOf(target)+1, pageHistory.length);
+		}
+		// FORWARD
+		else {
+   			pageHistory.push(target);								
+		}
+		this.updatePage(target);				
+	},
+	
+	loadMore: function(target) {
+		target.className = "load_more_loading";
+		(new this.ajax(target.href, updatePage)).run();
+		
+		function updatePage(content) {
+			target.parentNode.removeChild(target);
+			pages[currentPage].innerHTML += content;
+			ciUI.adjustBodyToEl(pages[currentPage]);
+		}
+	},
+	
+	updatePage: function(target) {
+		var nextHash = hashPrefix + (pageHistory.length);
+		backButtonEl.style.display = (pageIndexFromHash(nextHash) == 0 || !target) ? "none" : "block";
+		// Update body with new page content
+		if (pageIndexFromHash(nextHash) == 0 || !target) {
+			pageTitleEl.innerHTML = trim(document.title);
+			this.updatePageContent(pages[0].innerHTML); // page[0] is home, no need for AJAX
+		}			
+		else {
+			backButtonTextEl.innerHTML = (pageHistory[pageHistory.length-2]) ? trim(pageHistory[pageHistory.length-2].title, 15) : "Back";
+			pageTitleEl.innerHTML = trim(target.title);			
+			var url = target.href;
+			if (!url && target.tagName.toLowerCase() == "form") url = target.action+"?"+target.toQueryString();
+			(new this.ajax(url, this.updatePageContent)).run();
+		}
+	},
+	
+	updatePageContent: function(content) {
+		var updateTimer = setInterval(update, 0);
+			
+		function update() {
+			if (!ciUI.animating) {
+				$("__scroll_top__").name = currentHashName(true);
+				pages[currentPage].innerHTML = content;
+				pages[-currentPage].innerHTML = "";
+				clearInterval(updateTimer);								
+				ciUI.adjustBodyToEl(pages[currentPage]);				
+				location.href = currentHash = currentHashName();
+				if (ciUI.callbackFunct) ciUI.callbackFunct();
+			}			
+		}		
+	},
+	
+	slidePages: function(backwards) {
+		this.animating = true;
+		
+		var fromPage = pages[currentPage];
+		var toPage = pages[-currentPage];
+		var progress = 100;
+		
+		toPage.innerHTML = this.loadingPage();
+		toPage.style.display = "block";
+		
+		if (!backwards) toPage.style.left = "100%";
+		
+		clearInterval(navigationChangeTimer); // pause the history daemon during animation.
+		setTimeout(scrollTo, 100, 0, 1);
+		var animTimer = setInterval(animate, 0);
+		
+		function animate() {
+			progress -= animSpeed;
+			
+			if (progress <= 0) {
+				clearInterval(animTimer);				
+				navigationChangeTimer = setInterval(navigationChangeAgent, navigationCheckInterval); // restart the history daemon
+				currentPage *= -1;
+				progress = 0;
+				ciUI.animating = false;
+			}			
+			fromPage.style.left = (backwards ? (100 - progress) : (progress - 100)) + "%";
+			toPage.style.left = (backwards ? -progress : progress) + "%";
+		}
+	},
+	
+	ajax: function(sourceURL, responseConsumer, responseType) {
+		var httpRequest = false;
+		
+		this.run = function()
+		{
+			if (responseType === undefined) responseType = "TEXT";
+			responseType = responseType.toUpperCase();
+			
+			if (window.XMLHttpRequest) { 
+				httpRequest = new XMLHttpRequest();
+				if (httpRequest.overrideMimeType) {
+					httpRequest.overrideMimeType('text/xml');
+				}
+			} 
+			else if (window.ActiveXObject) { 
+				try {
+					httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
+				} 
+				catch (e) {
+					try {
+						httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
+					} 
+					catch (e) {}
+				}
+			}
+			
+			if (!httpRequest) {
+				//console.log('Giving up, cannot create an XMLHTTP instance');
+				return false;
+			}
+	
+			httpRequest.open('GET', sourceURL, true);
+			httpRequest.onreadystatechange = getResponse;
+			httpRequest.send(null);	
+		};
+		
+		function getResponse() {	
+			if (httpRequest.readyState == 4)
+				if (httpRequest.status == 200) {
+					if (responseType == "XML")
+						responseConsumer(httpRequest.responseXML);
+					else
+						responseConsumer(httpRequest.responseText);
+				}
+				else
+					;//console.log("There was a problem with the request: " + sourceUrl);
+		}
+	},
+	
+	update: function(url, element) {	
+		(new this.ajax(url, function(html){
+			if (!element.tagName) element = $(element);
+			element.innerHTML = html;
+		})).run();
+	},
+		
+	cancel: function(event) {
+		pageHistory = [];
+		location.reload(true);
+		location.hash = "";
+		location.href = homePage;
+		return false;
+	},
+	
+	loadingPage: function() {
+		return $("iphone_loading_page").innerHTML;
+	},
+	
+	// a dirty hack to move the footer to proper location since iphone_body doesn't expand with content
+	adjustBodyToEl: function(el) {
+		bodyEl.style.height = el.offsetHeight + "px";
+	}	
+};
+
+addEventListener("load", function(event) {
+	uiIsActive = ciUI.initialize();
+	if (uiIsActive) navigationChangeTimer = setInterval(navigationChangeAgent, navigationCheckInterval);
+}, false);
+
+addEventListener("click", function(event) {
+	if (!uiIsActive) return;
+	var a = findParent(event.target, "a");
+	// We don't want to prevent defaults by default because there may be actual hrefs going to outside pages
+	if (a && a.hasClass(buttonForward)) {
+		ciUI.goToPage(a);
+		event.preventDefault();
+	} else if (a && a.hasClass(buttonBackward)) {
+		history.back();	
+		event.preventDefault();
+	} else if (a && a.hasClass(buttonLoadMore)) {
+		ciUI.loadMore(a);
+		event.preventDefault();	
+	}	
+}, true);
+
+addEventListener("submit", function(event) {
+	if (!uiIsActive) return;
+	var a;
+	var form = findParent(event.target, "form");
+	if (!form) return;
+	if (form.hasClass(buttonForward)) {	
+		event.preventDefault();
+		return ciUI.goToPage(form);
+	} else if (form.hasClass(update)) {
+		event.preventDefault();
+		ciUI.update(form.action+"?"+form.toQueryString(), form.getAttribute(updateAttr));
+		}
+}, true);
+
+addEventListener("click", function(event) {
+	if (!uiIsActive) return;
+	var a = findParent(event.target, ("a"));
+	if (!a || !a.hasClass(update)) return;
+	ciUI.update(a.href, a.getAttribute(updateAttr));
+}, true);
+
+function trim(text, maxLength) {
+	if (maxLength === undefined) maxLength = 20;
+	return (text.length > maxLength) ? text.substring(0, maxLength - 3) + "..." : text;
+};
+
+function currentHashName(ommitHashSymbol) {
+	return (ommitHashSymbol) ? hashPrefix.substr(1, hashPrefix.length) + (pageHistory.length) : hashPrefix + (pageHistory.length);
+};
+
+function navigationChangeAgent() {
+	if (currentHash != location.hash) {
+		ciUI.goToPage(pageHistory[pageHistory.length-2], true);
+	}
+};
+
+function pageIndexFromHash(hash) {
+	return (hash) ? hash.substr(hash.lastIndexOf("_") + 1, hash.length) : 0;
+};
+
+Element.prototype.hasClass = function(name) {
+	return this.className.indexOf(name) != -1;
+};
+
+Element.prototype.toQueryString = function(){
+	var qs = "";
+	var getvals = function(element){
+		var kids = element.childNodes;
+		for (var i=0; i < kids.length; i++) {
+			var el = kids[i];
+			if (el.tagName) {
+				var t = el.tagName.toLowerCase();
+				if (t.toLowerCase() == "input" || t.toLowerCase() == "textarea") qs += el.name + "=" + escape(el.value) + "&";
+				else if (t == "select") qs += el.name + "=" + escape(el.options[el.selectedIndex].value) + "&"; //no support for multiselect yet
+				else getvals(el);
+			}
+		}
+	};
+	getvals(this);
+	return qs;
+}
+
+// This function is courtesy of iUI
+function findParent(node, localName) {
+    while (node && (node.nodeType != 1 || node.localName.toLowerCase() != localName))
+        node = node.parentNode;
+    return node;
+};
+
+function $(id) { return document.getElementById(id); };
+
+})();
\ No newline at end of file
diff -Nur -Nur php-syslog-ng-2.9.f/html/wap/wform.php php-syslog-ng/html/wap/wform.php
--- php-syslog-ng-2.9.f/html/wap/wform.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/wap/wform.php	2008-08-14 14:30:33.000000000 -0400
@@ -0,0 +1,40 @@
+<?php 
+
+$form1 = '
+<p style="padding: 5px;">This form will be submitted and its response outputted in console below</p>
+<hr size="1" noshade/>
+<form action="wform.php" class="do_update" update="console" style="margin-bottom: 10px; margin-top: 10px;">
+<span style="font-weight: bold;font-size: 10px;">This textarea will be submitted as "myText"</span>
+<textarea name="myText" style="width: 320px; height: 100px; border: 1px solid #aaa;"></textarea>
+<br/>
+<input type="submit" value="Submit"/>
+</form>
+<span style="font-weight: bold;font-size: 10px;">Console</span>
+<div id="console" style="width: 320px; height: 75px; border: 1px solid #aaa; background-color: #eee;"></div>';
+
+$form2 = '
+<p style="padding: 5px;">This form will be submitted and its response outputted on the next page</p>
+<hr size="1" noshade/>
+<form action="wform.php" class="do_update go_forward" update="console" style="margin-bottom: 10px; margin-top: 10px;">
+<span style="font-weight: bold;font-size: 10px;">This textarea will be submitted as "myText"</span>
+<textarea name="myText" style="width: 320px; height: 100px; border: 1px solid #aaa;"></textarea>
+<br/>
+<input type="submit" value="Submit"/>
+</form>
+';
+
+
+if (isset($_GET['myText'])) {
+	foreach ($_GET as $key => $value) {
+		echo "<div style='font-size: 12px;'>$key: $value</div>";
+	}
+}
+else {
+	switch ($_GET['demo']) {
+		default:
+		case "1" : echo $form1; break;
+		case "2" : echo $form2; break;
+	}
+}
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/html/wap/wres.php php-syslog-ng/html/wap/wres.php
--- php-syslog-ng-2.9.f/html/wap/wres.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/html/wap/wres.php	2008-08-14 18:14:41.000000000 -0400
@@ -0,0 +1,77 @@
+<?php
+// sleep(1);
+require_once ("../config/config.php");
+require_once ("../includes/common_funcs.php");
+
+function echoPage($page, $limit) {
+   	$dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+	   	if ($limit <= 10) {
+	   	echo " <a href='wres.php?page=$page&limit=" . ($limit + 10) . "' class='load_more'></a	";
+	   	$sqllimit = "0,$limit";
+		} else {
+	   	$sqllimit = "10,$limit";
+		}
+   	echo "<div style=\"width: 310px; margin-bottom: 5px; margin-left: 5px; text-align: center; font-size: 5px;\">";
+   	echo " <table> ";
+   	if ($page == "tail"){
+	   	if ($limit <= 10) {
+		   	echo "
+			   	<td class=\"wapresultsheader\">HOST</td>
+			   	<td class=\"wapresultsheader\">TIME</td>
+			   	<td class=\"wapresultsheader\">MESSAGE</td>
+			   	";
+	   	}
+	   	$query = "SELECT * FROM logs JOIN (select seq from logs FORCE INDEX(PRIMARY) ORDER BY seq DESC LIMIT $sqllimit) as sub USING(seq)";
+   	}
+   	if ($page == "topx" ){
+	   	if ($limit <= 10) {
+		   	echo "
+			   	<td class=\"wapresultsheader\">HOST</td>
+			   	<td class=\"wapresultsheader\">COUNT</td>
+			   	<td class=\"wapresultsheader\">MESSAGE</td>
+			   	";
+	   	}
+	   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+		   	$query = "SELECT host,counter as count,msg from logs WHERE counter>1 ORDER BY counter DESC LIMIT $sqllimit";
+	   	} else {
+		   	$query = "SELECT host,count(*) as count,msg from logs GROUP BY host ORDER BY count DESC LIMIT $sqllimit";
+	   	}
+   	}
+   	$results = perform_query($query, $dbLink);
+   	$color = "waplighter";
+   	$today = date('Y-m-d');
+   	while($row = fetch_array($results)) {
+	   	if($color == "wapdarker") {
+		   	$color = "waplighter";
+	   	}
+	   	else {
+		   	$color = "wapdarker";
+	   	}
+	   	echo "<tr class=\"$color\">";
+	   	echo "<td>".$row['host']."</td>";
+	   	if ($page == "tail") {
+		   	$pieces = explode(" ", $row['datetime']);
+		   	echo '<td>';
+		   	if ($pieces[0]!=$today) {
+			   	echo $pieces[0]."&nbsp;";
+		   	}
+		   	echo $pieces[1];
+	   	}
+	   	if ($page == "topx") {
+		   	echo '<td>';
+		   	echo $row['count']."&nbsp;";
+	   	}
+	   	echo "</td>\n";
+	   	$row['msg'] = preg_replace('/\s:/', ':', $row['msg']);
+	   	$row['msg'] = preg_replace('/.*(%.*?:.*)/', '$1', $row['msg']);
+	   	$msg = htmlspecialchars($row['msg']);
+	   	echo "<td>";
+	   	echo "$msg</td>\n";
+	   	echo    "</tr>\n";
+   	}
+	   	echo    "</div>\n";
+}
+
+echoPage($_GET['page'],$_GET['limit']);
+
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/apache.vhost php-syslog-ng/scripts/apache.vhost
--- php-syslog-ng-2.9.f/scripts/apache.vhost	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/apache.vhost	2007-09-04 22:16:01.000000000 -0400
@@ -0,0 +1,30 @@
+# PHP-SYSLOG-NG
+<VirtualHost *>
+    ServerName php-syslog-ng.gdd.net
+    ServerAlias php-syslog-ng.gdd.net *.php-syslog-ng.gdd.net
+    ServerAdmin cdukes
+
+    DocumentRoot /www/php-syslog-ng/html
+    <Directory />
+        Options FollowSymLinks
+        AllowOverride All
+    </Directory>
+    <Directory /www/php-syslog-ng/html>
+        # pcw No directory listings
+        # Options Indexes FollowSymLinks MultiViews
+        Options -Indexes FollowSymLinks MultiViews
+        AllowOverride All
+        Order allow,deny
+        allow from all
+    </Directory>
+
+    ErrorLog /var/log/apache2/php-syslog-ng/error.log
+
+    # Possible values include: debug, info, notice, warn, error, crit,
+    # alert, emerg.
+    LogLevel warn
+
+    CustomLog /var/log/apache2/php-syslog-ng/access.log combined
+    ServerSignature On
+
+</VirtualHost>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/crontab php-syslog-ng/scripts/crontab
--- php-syslog-ng-2.9.f/scripts/crontab	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/crontab	2008-02-04 16:50:25.000000000 -0500
@@ -0,0 +1,10 @@
+# PHP-Syslog-NG
+@daily php /www/php-syslog-ng/scripts/logrotate.php >> /var/log/php-syslog-ng/logrotate.log 
+@daily find /www/php-syslog-ng/html/jpcache/ -atime 1 -exec rm -f '{}' ';' 
+0,5,10,15,20,25,30,35,40,45,50,55 * * * * php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log
+# Removed below as of v2.9.4
+# @reboot /www/php-syslog-ng/scripts/syslog2mysql.sh >> /var/log/php-syslog-ng/mysql.log 2>&1
+
+# Demo PHP-Syslog-NG
+# CHANGE TO MATCH YOUR DIRECTORY PATHS
+# @hourly /www/php-syslog-ng/scripts/dbgen.pl >> /var/log/php-syslog-ng/dbgen.log
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/dbgen.pl php-syslog-ng/scripts/dbgen.pl
--- php-syslog-ng-2.9.f/scripts/dbgen.pl	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/dbgen.pl	2008-07-22 19:07:03.000000000 -0400
@@ -0,0 +1,270 @@
+#!/usr/bin/perl
+
+#
+# dbgen.pl
+#
+# Developed by Clayton Dukes <cdukes@cdukes.com>
+# Copyright (c) 2006 
+# Licensed under terms of GNU General Public License.
+# All rights reserved.
+#
+# Changelog:
+# 2006-04-14 - created
+#
+
+# $Platon$
+
+$| = 1;
+# Note - requires:
+# Digest::SHA1
+# and
+# Net-Mysql
+use Net::MySQL;
+use POSIX qw(strftime);
+use File::Basename;
+use strict;
+my $sleeptime = (1 + rand(5)); # Set sleep time as random or as an integer
+#my $sleeptime = ".0001"; # Use this to just blast a whole bunch into the database
+
+# Change below to match your config path (use full path if you run this from cron)
+my $ngconfig = "/www/php-syslog-ng/html/config/config.php"; 
+
+open( CONFIG, $ngconfig ) or die "Can't open $ngconfig : $!"; 
+my @config = <CONFIG>; 
+close( CONFIG );
+
+my($table,$dbadmin,$dbpw,$dbname,$dbhost,$dbport,$DEBUG);
+foreach my $var (@config) {
+	next unless $var =~ /^define/; # read only def's
+	$table = $1 if ($var =~ /'DEFAULTLOGTABLE', '(\w+)'/);
+	$dbadmin = $1 if ($var =~ /'DBADMIN', '(\w+)'/);
+	$dbpw = $1 if ($var =~ /'DBADMINPW', '(\w+)'/);
+	$dbname = $1 if ($var =~ /'DBNAME', '(\w+)'/);
+	$dbhost = $1 if ($var =~ /'DBHOST', '(\w+)'/);
+	$dbport = $1 if ($var =~ /'DBPORT', '(\w+)'/);
+	$DEBUG = $1 if ($var =~ /'DEBUG', '(\w+)'/);
+}
+if ( ! $table ) {
+	print "Error: Unable to read config variables from $ngconfig\n";
+	exit;
+}
+if ($DEBUG > 0) { 
+	print "Table: $table\n";
+	print "Adminuser: $dbadmin\n";
+	print "PW: $dbpw\n";
+	print "DB: $dbname\n";
+	print "DB Host: $dbhost\n";
+	print "DB Port: $dbport\n";
+#exit;
+}
+
+### our fake stuff
+our %myevents = (
+	'pagp' => [
+	'%AAA-3-ACCT_IOMEM_LOW: Line protocol on Interface FastEthernet0/5, changed state to up',
+	'%AAA-3-IPILLEGALMSG: Line protocol on Interface FastEthernet0/7, changed state to up',
+	'%FWSM-5-111008: User \'\'2g456\'\' executed the \'\'exit\'\' command',
+	'%AAAA-3-ACCTFORKFAIL:Configured from console by vty0 (192.168.4.35)',
+	'%AAAA-3-BADSTATE:Attempted to connect to RSHELL from 10.15.10.121',
+	'%AAA-3-BADHDL:Authentication failure for SNMP req from host 10.6.1.36',
+	],
+	'mls' => [
+	'%AAAA-4-NOSERVER: IP Multilayer switching is enabled',
+	'%C4K_HWACLMAN-4-CAMAUDIT: Netflow Data Export disabled',
+	'%FWSM-5-111008: User \'\'2g456\'\' executed the \'\'exit\'\' command',
+	'%NCDP-5-UNABLETOREACHCL: Duplicate address 10.10.2.2 on Vlan20',
+	'%NEVADA-0-BADADD: Duplicate address 10.10.7.2 on Vlan70',
+	],
+	'sys' => [
+	'%FABRIC-5-FABRIC_MODULE_ACTIVE: Module 1 is online',
+	'%FABRIC-5-FABRIC_MODULE_ACTIVE: Module 3 is online',
+	'%FWSM-5-111008: User \'\'2g456\'\' executed the \'\'exit\'\' command',
+	'%C6KENV-2-FANUPGREQ: Fan 1 had a rotation error reported.',
+	'%C6KENV-2-FANUPGREQ: Fan 1 had earlier reported a rotation error. It is ok now',
+	'%LINK-3-BADENCAP: FastEthernet0/11 link down/up 5 times per min',
+	'%LINK-3-BADENCAP: FastEthernet0/12 link down/up 5 times per min',
+	'%LINK-3-BADENCAP: FastEthernet0/15 link down/up 5 times per min',
+	]
+);
+
+our %mynames = (
+	'sys' => [
+	'%AAA-1-AAA_SESSION_LIMIT_REJECT:',
+	'%AAA-2-AAAMULTILINKERROR:',
+	'%AAA-2-AAA_NVRAM_UPGRADE_FAILURE',
+	'%AAA-2-AAA_PROGRAM_EXIT:',
+	'%AAA-2-FORKFAIL:',
+	'%AAA-3-AAA_NVRAMFAILURE:',
+	'%AAA-3-ACCT_IOMEM_LOW:',
+	'%AAA-3-ACCT_LOW_MEM_TRASH:',
+	'%AAA-3-ACCT_LOW_MEM_UID_FAIL:',
+	'%AAA-3-ATTRFORMATERR:',
+	'%AAAA-3-BADLIST:',
+	'%AAAA-3-BADREG:',
+	'%AAAA-3-BADSTATE:',
+	'%AAAA-3-BADSTR:',
+	'%AAAA-3-DLRFORKFAIL:',
+	'%AAAA-3-DROPACCTFULLQ:',
+	'%AAAA-3-DROPACCTLOWMEM:',
+	'%AAAA-3-DROPACCTSNDFAIL:',
+	'%AAAA-3-ILLEGALNAME:',
+	'%AAAA-3-ILLSGNAME:',
+	'%AAAA-3-INTERNAL_ERROR:',
+	'%APBR-4-PRTR_ARP_IPV6_ERR:',
+	'%APBR-4-PRTR_ARP_IP_BAD:',
+	'%APBR-4-PRTR_ARP_PROT_BAD:',
+	'%APBR-4-PRTR_DHCP_XID_EXP:',
+	],
+	'mls' => [
+	'%AAAA-3-INVALIDLIST:',
+	'%ACLMGR-2-NOVLB:',
+	'%ACLMGR-2-NOVMR:',
+	'%ACLMGR-3-ACLTCAMFULL:',
+	'%ACLMGR-3-AUGMENTFAIL:',
+	'%ACLMGR-3-IECPORTLABELERROR:',
+	'%ACLMGR-3-INSERTFAIL:',
+	'%APBR-4-DNS_CON_FAILED:',
+	'%APBR-4-EAP_AUTH_FAILED:',
+	'%APBR-4-EAP_SRV_VRF_FAILED:',
+	'%APBR-4-EAP_TOUT:',
+	'%APBR-4-FWDTBL_GIVE_FAILED:',
+	'%APBR-4-FWDTBL_TAKE_FAILED:',
+	'%APBR-4-FWDTBL_UNKNW_HOST:',
+	'%APBR-4-LOSS_ETHERNET_ACTION:',
+	'%APBR-4-MACAUTH_CON_FAIL:',
+	'%APBR-4-MACAUTH_DENY:',
+	'%APBR-4-MACAUTH_NORESP:',
+	'%APBR-4-NET_ADMSTAT_SET_FAILED:',
+	'%APBR-4-PRO80211_MNGPKT_RCV_ERR1',
+	'%APBR-4-PRO80211_MNGPKT_RCV_ERR2',
+	'%APBR-4-PRO80211_MNGPKT_TRNC:',
+	'%APBR-4-PRO80211_PKTALLOC_ERR:',
+	'%APBR-4-PRO80211_PKTBSS_ERR:',
+	'%APBR-4-PRO80211_RCV_INV_CTRL:',
+	'%APBR-4-PRO80211_RCV_INV_PORT:',
+	'%APBR-4-PRO80211_RCV_TRNC_CTRL:',
+	'%APBR-4-PRO80211_SND_ERROR:',
+	'%APBR-4-PRTR_ADDR_ERR:',
+	'%APBR-4-PRTR_ARP_FMT_BAD:',
+	'%MLS-5-MLSENABLED:',
+	'%MLS-5-NDEDISABLED:',
+	],
+	'pagp' => [
+	'%ACLMGR-3-INTTABLE:',
+	'%ACLMGR-3-MAXRECURSION:',
+	'%APBR-0-SYS_REBOOT_CFG_RESETALL:',
+	'%APBR-0-SYS_REBOOT_CFG_RSTR:',
+	'%APBR-0-SYS_REBOOT_EBUF:',
+	'%APBR-0-SYS_REBOOT_FWDTSIZE:',
+	'%APBR-0-SYS_REBOOT_FW_UPD:',
+	'%APBR-0-SYS_REBOOT_HW_ADDR:',
+	'%APBR-1-RCV_PCKT_ALERT:',
+	'%APBR-4-BKP_INF_PTR_ERR:',
+	'%APBR-4-BKR_KEY1_BADSIZE:',
+	'%APBR-4-BKR_KEY1_NORADIOCTRL:',
+	'%APBR-4-BKR_KEY1_NORADIOINF:',
+	'%APBR-4-BKR_KEY1_NOT_INIT:',
+	'%APBR-4-BKR_MANY_RADIOS:',
+	'%APBR-4-BKR_NOT_INIT:',
+	'%APBR-4-BKR_VLAN_DISABLED:',
+	'%APBR-4-BKR_VLAN_NOT_INIT:',
+	'%APBR-4-BRLP_SADDR_PKT:',
+	'%APBR-4-DDP_RCV_PKT_ERR:',
+	]
+);
+
+our @facilities = ("kern", "user", "mail", "daemon", "auth", "syslog", "lpr", "news", "uucp", "cron", "authpriv", "ftp", "local0", "local1", "local2", "local3", "local4", "local5", "local6");
+our @priorities = ("debug", "info", "notice", "warning", "err", "crit", "alert", "emerg");
+
+my $c = 0;
+our @devicelist; 
+until ($c > 50) {
+
+	# cdukes - 2-28-08: Modified sections below to generate fewer random hostnames, it was a bit overkill :-)
+	#my @devs = ("router","switch","server","firewall");
+	my @devs = ("router","switch","server","fw","css","www","ftp","sun","linux","as400","6509","2811","1701","2911");
+	my @chars = ( 'a' .. 'z', 'A' .. 'Z', 0 .. 9 ); 
+	#my @nums = ( '0' .. '9'); 
+	my @nums = ( '0' .. '6'); 
+	my $num = join '', map $nums[ rand @nums ], 0 .. 0; 
+	my $string1 = join '', map $devs[ rand @devs ], 1 ; 
+	my $string2 = join '', map $chars[ rand @chars ], 1 .. 3;
+
+	#push(@devicelist, "$string1-$num-$string2");
+	push(@devicelist, "$string1-$num");
+	$c++;
+}
+
+if ($DEBUG > 0) { 
+	my $DEBUG = "true"; 
+	print "DEBUG: $DEBUG\n";
+} else { 
+	my $DEBUG = ""; 
+	print "Debug off, showing only inserted data...\n";
+}
+my $mysql = Net::MySQL->new(
+	debug		=> "$DEBUG",		# enable debug
+	unixsocket	=> "$dbport",	# Default use UNIX socket
+	hostname	=> "$dbhost",   
+	database	=> "$dbname",
+	user		=> "$dbadmin",
+	password	=> "$dbpw",
+);
+
+### main ###
+
+my $i = 0;
+my $total = 1500;
+# Set Loopcount
+#while (1) # runs in a continuous loop
+until ($i > $total)
+{
+	my	@evtypes = ('sys', 'mls', 'pagp');
+
+	foreach my $eventtype (@evtypes)
+	{
+		my $index   = rand @priorities;
+		my $pri = $priorities[$index];  
+		my $index   = rand @priorities;
+		my $lvl = $priorities[$index];  
+		my $index   = rand @facilities;
+		my $fac = $facilities[$index];  
+		my $index   = rand @devicelist;
+		my $devlist = $devicelist[$index];  
+		my $curr_fakeevent = get_rand_event ($eventtype);
+
+		my $YMDHMS = strftime "%Y-%m-%d %H:%M:%S", localtime;
+		my $HOST	 = "$devlist";
+		my $FACILITY = "$fac";
+		my $PRIORITY = "$pri";
+		my $LEVEL	 = "$lvl";
+		my $TAG	 = "Tag";
+		my $PRG	 = "DBGen";
+		my $MSG		 = "$curr_fakeevent";
+		$mysql->query(qq{
+			INSERT INTO $table (host, facility, priority, level, tag, datetime, program, msg)
+			VALUES ( '$HOST', '$FACILITY', '$PRIORITY', '$LEVEL', '$TAG', '$YMDHMS', '$PRG', '$PRG: $MSG' )
+			});
+		print "\n\nHost: $HOST\nFacility: $FACILITY\nPriority: $PRIORITY\nLevel: $LEVEL\nTag: $TAG\nYMDHMS: $YMDHMS\nProgram: $PRG\nMessage: $PRG: $MSG \n";
+		printf "Affected row: %d\n", $mysql->get_affected_rows_length;
+		sleep $sleeptime;
+	}
+	print "Loopcount: $i of $total";
+	$i++;
+}
+
+### our subs ###
+
+sub get_rand_event
+{
+	my $evttype = shift;
+	$evttype = "sys" if ((!defined($evttype)) or ($evttype eq ""));
+	my @namesarr = @{$mynames{$evttype}};
+	my @msgarr = @{$myevents{$evttype}};
+	return ( $namesarr[rand($#namesarr+1)], $msgarr[rand($#msgarr+1)] );
+}
+
+
+
+# vim: ts=4
+# vim600: fdm=marker fdl=0 fdc=3
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/drop-old-tables.php php-syslog-ng/scripts/drop-old-tables.php
--- php-syslog-ng-2.9.f/scripts/drop-old-tables.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/drop-old-tables.php	2007-07-18 18:22:51.000000000 -0400
@@ -0,0 +1,62 @@
+<?php
+/*
+ * drop-old-tables.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2007 http://www.gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2007-02-05 - created
+ *
+ */
+
+/* $Platon$ */
+
+/* Modeline for ViM {{{
+ * vim: set ts=4:
+ * vim600: fdm=marker fdl=0 fdc=0:
+ * }}} */
+
+// This script will make DROP queries for getting rid of tables that have the same prefix
+// (i.e. tables logs_*). This makes it easier to clean up old data.
+//
+
+$basePath = dirname( __FILE__ );
+include_once "$basePath/../html/includes/common_funcs.php";
+include_once "$basePath/../html/config/config.php";
+
+if (!mysql_connect(DBHOST, DBADMIN, DBADMINPW)) {
+	print 'Could not connect to mysql';
+	exit;
+}
+
+$result = mysql_list_tables(DBNAME);
+
+if (!$result) {
+	print "DB Error, could not list tables\n";
+	print 'MySQL Error: ' . mysql_error();
+	exit;
+}
+
+if ($_GET['prefix'] == null) {
+	print "<b>TABLE LIST:</b><br>";
+
+	while ($row = mysql_fetch_row($result)) {
+		print "Table: $row[0]<br>";
+	}
+	print "<br><b>Syntax to make a DROP TABLE is 'drop_tables.php?prefix=\"prefix that the tables have\"'.</b>";
+} else {
+
+	echo "<b>DROP TABLE QUERY FOR TABLES WITH PREFIX '".$_GET['prefix']."'</b><br>Copy this query into your MySQL program and execute to remove these tables.<br><br>";
+
+	while ($row = mysql_fetch_row($result)) {
+		if (substr($row[0], 0, strlen($_GET['prefix'])) == $_GET['prefix']) {
+			print "DROP TABLE $row[0];<br>";
+		}
+	}
+}
+
+mysql_free_result($result);
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/init-d_program php-syslog-ng/scripts/init-d_program
--- php-syslog-ng-2.9.f/scripts/init-d_program	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/init-d_program	2008-02-26 21:59:34.000000000 -0500
@@ -0,0 +1 @@
+SELECT DISTINCT program FROM all_logs WHERE LENGTH(program)<80 AND program RLIKE '^[a-zA-Z]+[a-zA-Z0-9/()._\-]+$';
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/logrotate.d php-syslog-ng/scripts/logrotate.d
--- php-syslog-ng-2.9.f/scripts/logrotate.d	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/logrotate.d	2006-09-20 22:35:07.000000000 -0400
@@ -0,0 +1,15 @@
+# $Header: /var/cvsroot/gentoo-x86/app-admin/php-syslog-ng/files/php-syslog-ng.logrotate,v 1.0 2006/09/11 04:05:11 cdukes Exp $
+#
+# Php-Syslog-ng logrotate snippet for Gentoo Linux
+# contributed by Clayton Dukes
+#
+
+/var/log/php-syslog-ng/*.log {
+  missingok
+  compress
+  rotate 5
+  daily
+  postrotate
+  /etc/init.d/syslog-ng reload > /dev/null 2>&1 || true
+  endscript
+}
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/logrotate.php php-syslog-ng/scripts/logrotate.php
--- php-syslog-ng-2.9.f/scripts/logrotate.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/logrotate.php	2008-08-07 11:31:37.000000000 -0400
@@ -0,0 +1,181 @@
+#!/usr/bin/php
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+// Copyright (C) 2006 Clayton Dukes cdukes@cdukes.com
+
+echo "\nStarting logrotate\n";
+echo date("Y-m-d H:i:s")."\n";
+
+
+include_once "/www/php-syslog-ng/html/includes/common_funcs.php";
+include_once "/www/php-syslog-ng/html/config/config.php";
+
+$dbLink = db_connect_syslog(DBADMIN, DBADMINPW);
+
+// Drop temp table if it exists
+echo "Dropping temp".DEFAULTLOGTABLE." if it exists ... ";
+$query = "DROP TABLE IF EXISTS temp".DEFAULTLOGTABLE;
+perform_query($query, $dbLink);
+$q = perform_query($query, $dbLink);
+if ( strstr( $q, "Error") ) {
+   	echo ("\nAn error was encountered while dropping temp".DEFAULTLOGTABLE ."\n");
+} else {
+   	echo "ok.\n";
+}
+
+// Make sure we're not overwriting $today
+$today = date("Ymd");
+$query = "SHOW CREATE TABLE ".DEFAULTLOGTABLE.$today;
+$q = perform_query_quiet($query, $dbLink);
+$row = @mysql_fetch_array($q);
+if ($row[0]) {
+   	echo ("\nERROR: " .DEFAULTLOGTABLE.$today ." already exists!\nEither DROP the table or wait until tomorrow to re-run this script." ."\n");
+   	die("Here's the duplicate table:\n" .$row[1] ."\n");
+} 
+
+// Create new table
+echo "Creating temp".DEFAULTLOGTABLE." ... ";
+$query = "SHOW CREATE TABLE ".DEFAULTLOGTABLE;
+$result = perform_query($query, $dbLink);
+$row = mysql_fetch_array($result);
+
+// CDUKES 7/4/08: Added stripslashes below to fix quoting error
+// Ref: http://groups.google.com/group/php-syslog-ng-support/browse_thread/thread/a41fc933fe705f90
+$createQuery = stripslashes($row[1]);
+$search = "CREATE TABLE `".DEFAULTLOGTABLE."`";
+$replace = "CREATE TABLE `temp".DEFAULTLOGTABLE."`";
+$createQuery = str_replace($search, $replace, $createQuery);
+$q = perform_query($createQuery, $dbLink);
+if ( strstr( $q, "Error") ) {
+   	echo ("\nAn error was encountered while dropping temp".DEFAULTLOGTABLE ."\n");
+} else {
+   	echo "ok.\n";
+}
+
+
+// Drop the merge table
+echo "Dropping ".MERGELOGTABLE." if it exists ... ";
+if(defined('MERGELOGTABLE') && MERGELOGTABLE) {
+   	$query = "FLUSH TABLES";
+   	perform_query($query, $dbLink);
+   	$query = "DROP TABLE IF EXISTS ".MERGELOGTABLE;
+   	$q = perform_query($query, $dbLink);
+   	if ( strstr( $q, "Error") ) {
+	   	echo ("\nAn error was encountered while dropping ".MERGELOGTABLE ."\n");
+   	} else {
+	   	echo "ok.\n";
+   	}
+}
+
+// Rename the two tables
+echo "Renaming '".DEFAULTLOGTABLE."' to '".DEFAULTLOGTABLE.$today."' and 'temp".DEFAULTLOGTABLE."' to '".DEFAULTLOGTABLE."' ... ";
+$query = "RENAME TABLE ".DBNAME.".".DEFAULTLOGTABLE." TO ".DBNAME.".".DEFAULTLOGTABLE.$today.", "
+.DBNAME.".temp".DEFAULTLOGTABLE." TO ".DBNAME.".".DEFAULTLOGTABLE;
+$q = perform_query($query, $dbLink);
+if ( strstr( $q, "Error") ) {
+   	echo ("\nError, unable to complete log rotation\n");
+   	die("Failed Query: \n" .$query);
+} else {
+   	echo "ok.\n";
+}
+
+/* cdukes 2-27-08 - Changed below to prevent corruption of table data since myisamchk should really not be used while the mysql server is up
+   "The easiest way to avoid this problem is to use CHECK TABLE instead of myisamchk to check tables."
+Ref: http://dev.mysql.com/doc/refman/5.0/en/myisamchk.html
+Ref: http://dev.mysql.com/doc/refman/5.0/en/check-table.html
+$cmd = "myisampack /var/lib/mysql/".DBNAME."/".DEFAULTLOGTABLE.$today.".MYI && myisamchk -rq --sort-index --analyze /var/lib/mysql/".DBNAME."/".DEFAULTLOGTABLE.$today.".MYI";
+$output = `$cmd`;
+ */
+echo "Checking " .DEFAULTLOGTABLE.$today." for errors...";
+$query = "CHECK TABLE ".DBNAME.".".DEFAULTLOGTABLE.$today ."QUICK";
+$q = perform_query($query, $dbLink);
+if ( strstr( $q, "Error") ) {
+   	echo ("\nError, something failed during CHECK phase\n");
+   	die("Failed Query: \n" .$query);
+} else {
+   	echo "ok.\n";
+}
+echo "Now optimizing " .DEFAULTLOGTABLE.$today."...";
+$query = "OPTIMIZE TABLE ".DBNAME.".".DEFAULTLOGTABLE.$today;
+$q = perform_query($query, $dbLink);
+if ( strstr( $q, "Error") ) {
+   	echo ("\nError, something failed during Optimization\n");
+   	die("Failed Query: \n" .$query);
+} else {
+   	echo "ok.\n";
+}
+
+if(defined('LOGROTATERETENTION') && LOGROTATERETENTION) {
+   	$cutoffDate = date("Ymd", mktime(0, 0, 0, date("m"), date("d")-LOGROTATERETENTION, date("Y")));
+   	echo "Deleting logs older than $cutoffDate:\n";
+   	$logTableArray = get_logtables($dbLink);
+   	foreach($logTableArray as $value) {
+	   	if(preg_match("([0-9]{8}$)", $value)) {
+		   	// determine if datestamp is old enough
+		   	$tableDate = strrev(substr(strrev($value), 0, 8));
+		   	if($cutoffDate > $tableDate) {
+			   	echo "(Dropping) $value\n";
+			   	$query = "DROP TABLE ".$value;
+			   	$q = perform_query($query, $dbLink);
+			   	if ( strstr( $q, "Error") ) {
+				   	echo ("\nError, something failed during Retention Phase!\n");
+				   	die("Failed Query: \n" .$query);
+			   	} 
+			}
+		   	else {
+			   	echo "(Keeping) $value\n";
+		   	}
+	   	}
+   	}
+}
+
+if(defined('MERGELOGTABLE') && MERGELOGTABLE) {
+   	$logTableArray = get_logtables($dbLink);
+   	echo "Creating merge table...";
+   	$query = "SHOW CREATE TABLE ".DEFAULTLOGTABLE;
+
+	$result = perform_query($query, $dbLink);
+   	$row = mysql_fetch_array($result);
+   	$createQuery = stripslashes($row[1]);
+
+	$oldStr = "CREATE TABLE `".DEFAULTLOGTABLE."`";
+   	$newStr = "CREATE TABLE `".MERGELOGTABLE."`";
+   	$createQuery = str_replace($oldStr, $newStr, $createQuery);
+
+	$oldStr = "ENGINE=MyISAM";
+   	// $newStr = "TYPE=MRG_MyISAM";
+   	$newStr = "ENGINE=MRG_MyISAM";
+   	$createQuery = str_replace($oldStr, $newStr, $createQuery);
+   	$oldStr = "TYPE=MyISAM";
+   	// $newStr = "TYPE=MRG_MyISAM";
+   	$newStr = "ENGINE=MRG_MyISAM";
+   	$createQuery = str_replace($oldStr, $newStr, $createQuery);
+
+
+	// REMOVED below because it was causing an error in newer version of Mysql
+	// Ref: http://bugs.mysql.com/bug.php?id=26881
+	// $createQuery = str_replace('PRIMARY KEY', 'INDEX', $createQuery);
+
+
+	$unionStr = " UNION=(";
+   	foreach($logTableArray as $value) {
+	   	$unionStr = $unionStr.$value.", ";
+   	}
+   	$unionStr = rtrim($unionStr, ", ");
+   	$unionStr = $unionStr.")";
+
+	$createQuery = $createQuery.$unionStr;
+// 	die($createQuery);
+
+	// $query = "FLUSH TABLES";
+   	$flushQuery = "FLUSH TABLES";
+   	perform_query($flushQuery, $dbLink);
+   	perform_query($createQuery, $dbLink);
+   	perform_query($flushQuery, $dbLink);
+   	echo "ok.\n";
+	// echo "$createQuery\n";
+}
+
+echo "\n".date("Y-m-d H:i:s")."\n";
+echo "All done!\n";
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/lpdcache.patch php-syslog-ng/scripts/lpdcache.patch
--- php-syslog-ng-2.9.f/scripts/lpdcache.patch	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/lpdcache.patch	2008-08-09 17:44:50.000000000 -0400
@@ -0,0 +1,16 @@
+--- lpdcache.php.orig	2008-08-07 17:05:37.000000000 -0400
++++ lpdcache.php	2008-08-09 17:43:31.000000000 -0400
+@@ -75,8 +75,12 @@
+ 			   	}
+ 		   	}
+ 	   	} else {
+-		   	echo "You have no merg table, assuming this is a fresh install and updating cache for today only...\n";
++		   	echo "Either you have no ".MERGELOGTABLE." table or it is messed up, assuming this is a fresh install and updating cache for today only...\n";
++		   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+ 		   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, SUM(counter) as value, DATE_SUB(CURDATE(), INTERVAL 0 DAY) as updatetime FROM ".DEFAULTLOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL 0 DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL 0 DAY)";
++			} else {
++		   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, count(*) as value, DATE_SUB(CURDATE(), INTERVAL 0 DAY) as updatetime FROM ".DEFAULTLOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL 0 DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL 0 DAY)";
++			}
+ 		   	perform_query($query, $dbLink);
+ 	   	}
+    	} else {
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/lpdcache.php php-syslog-ng/scripts/lpdcache.php
--- php-syslog-ng-2.9.f/scripts/lpdcache.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/lpdcache.php	2008-08-09 17:43:31.000000000 -0400
@@ -0,0 +1,99 @@
+<?php
+/*
+ * cache.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2008 http://www.gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2008-08-07 - created
+ *
+ */
+
+/* $Platon$ */
+
+
+/* Cdukes: 08-07-2008
+   Added below to use cache table for filling in graph values on logs per day graph on main page
+   Note that this requires a small modification to the current search_cache table:
+   ALTER TABLE search_cache MODIFY type enum('HOST','FACILITY','PROGRAM','LPD') default NULL
+   By default, this will cache X amount of days based on your LOGROTATERETENTION setting in config.php
+ */
+
+require_once "/www/php-syslog-ng/html/includes/common_funcs.php";
+require_once "/www/php-syslog-ng/html/config/config.php";
+
+$dbLink = db_connect_syslog(DBADMIN, DBADMINPW);
+
+echo "\nStarting LPD Cache\n";
+echo date("Y-m-d H:i:s")."\n";
+
+// First check to see if we have caching turned on
+if(defined('LPD_CACHE') && LPD_CACHE == TRUE) {
+   	echo "Setting daily log counts in ".CACHETABLENAME."\n";
+   	$cacheready = 0;
+   	// Check to make sure the search cache has the LPD field set
+   	$query="DESCRIBE ".CACHETABLENAME;
+   	$result = perform_query($query, $dbLink);
+   	while($row = fetch_array($result)) {
+	   	if (ereg('LPD', $row['Type'])) {
+		   	// 	echo $row['Type']."\n";
+		   	$cacheready = 1;
+	   	}
+   	}
+   	// We're ready to start
+   	if ($cacheready == 1) {
+	   	// check to see if this is a new install (MERGELOGTABLE doesn't exists)
+	   	$check = mysql_query ("SELECT * FROM ".MERGELOGTABLE." LIMIT 0,1"); /* >>limit<< is just to make it faster in case the db is huge */
+	   	if ($check) {
+		   	for($i=0;$i<=LOGROTATERETENTION;$i++) {
+			   	$query="SELECT value as count from ".CACHETABLENAME." WHERE type='LPD' AND updatetime=DATE_SUB(CURDATE(), INTERVAL $i DAY)";
+			   	$result = perform_query($query, $dbLink);
+			   	if(num_rows($result) >= 1) {
+				   	echo "Entry $i already in cache...";
+				   	if ($i == 0) { // We only need to update today's count since (presumably) old logs should not be getting new INSERTs
+					   	echo "UPDATING\n";
+					   	// Test for SqueezeDB function since count fields are different
+					   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+							   	$query="SELECT SUM(counter) as value FROM ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+					   	} else {
+							   	$query="SELECT count(*) as value FROM ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+					   	}
+					   	$result = perform_query($query, $dbLink);
+					   	$row = fetch_array($result);
+					   	$query="UPDATE ".CACHETABLENAME." SET value='".$row['value']."' WHERE type='LPD' AND updatetime=DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+					   	perform_query($query, $dbLink);
+				   	} else {
+					   	echo "No update needed\n";
+				   	}
+			   	} else {
+				   	echo "Entry $i...INSERTing\n";
+					   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, SUM(counter) as value, DATE_SUB(CURDATE(), INTERVAL $i DAY) as updatetime FROM ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+				   	perform_query($query, $dbLink);
+			   	}
+		   	}
+	   	} else {
+		   	echo "Either you have no ".MERGELOGTABLE." table or it is messed up, assuming this is a fresh install and updating cache for today only...\n";
+		   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+		   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, SUM(counter) as value, DATE_SUB(CURDATE(), INTERVAL 0 DAY) as updatetime FROM ".DEFAULTLOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL 0 DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL 0 DAY)";
+			} else {
+		   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, count(*) as value, DATE_SUB(CURDATE(), INTERVAL 0 DAY) as updatetime FROM ".DEFAULTLOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL 0 DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL 0 DAY)";
+			}
+		   	perform_query($query, $dbLink);
+	   	}
+   	} else {
+	   	echo "ERROR: ".CACHETABLENAME." is missing a column\n";
+	   	echo "You will need to run the following command in mysql before using this script:\n";
+	   	echo "ALTER TABLE ".CACHETABLENAME." MODIFY `type` enum('HOST','FACILITY','PROGRAM','LPD') default NULL;\n";
+   	}
+} else {
+   	echo "\nLPD Cache is not enabled!\n";
+   	echo "Please make sure the following variable is set in your config.php file:\n";
+   	echo "define('LPD_CACHE', FALSE);\n";
+}
+
+echo "\n".date("Y-m-d H:i:s")."\n";
+echo "All done!\n";
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/lpdcache.php.orig php-syslog-ng/scripts/lpdcache.php.orig
--- php-syslog-ng-2.9.f/scripts/lpdcache.php.orig	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/lpdcache.php.orig	2008-08-07 17:05:37.000000000 -0400
@@ -0,0 +1,95 @@
+<?php
+/*
+ * cache.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2008 http://www.gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2008-08-07 - created
+ *
+ */
+
+/* $Platon$ */
+
+
+/* Cdukes: 08-07-2008
+   Added below to use cache table for filling in graph values on logs per day graph on main page
+   Note that this requires a small modification to the current search_cache table:
+   ALTER TABLE search_cache MODIFY type enum('HOST','FACILITY','PROGRAM','LPD') default NULL
+   By default, this will cache X amount of days based on your LOGROTATERETENTION setting in config.php
+ */
+
+require_once "/www/php-syslog-ng/html/includes/common_funcs.php";
+require_once "/www/php-syslog-ng/html/config/config.php";
+
+$dbLink = db_connect_syslog(DBADMIN, DBADMINPW);
+
+echo "\nStarting LPD Cache\n";
+echo date("Y-m-d H:i:s")."\n";
+
+// First check to see if we have caching turned on
+if(defined('LPD_CACHE') && LPD_CACHE == TRUE) {
+   	echo "Setting daily log counts in ".CACHETABLENAME."\n";
+   	$cacheready = 0;
+   	// Check to make sure the search cache has the LPD field set
+   	$query="DESCRIBE ".CACHETABLENAME;
+   	$result = perform_query($query, $dbLink);
+   	while($row = fetch_array($result)) {
+	   	if (ereg('LPD', $row['Type'])) {
+		   	// 	echo $row['Type']."\n";
+		   	$cacheready = 1;
+	   	}
+   	}
+   	// We're ready to start
+   	if ($cacheready == 1) {
+	   	// check to see if this is a new install (MERGELOGTABLE doesn't exists)
+	   	$check = mysql_query ("SELECT * FROM ".MERGELOGTABLE." LIMIT 0,1"); /* >>limit<< is just to make it faster in case the db is huge */
+	   	if ($check) {
+		   	for($i=0;$i<=LOGROTATERETENTION;$i++) {
+			   	$query="SELECT value as count from ".CACHETABLENAME." WHERE type='LPD' AND updatetime=DATE_SUB(CURDATE(), INTERVAL $i DAY)";
+			   	$result = perform_query($query, $dbLink);
+			   	if(num_rows($result) >= 1) {
+				   	echo "Entry $i already in cache...";
+				   	if ($i == 0) { // We only need to update today's count since (presumably) old logs should not be getting new INSERTs
+					   	echo "UPDATING\n";
+					   	// Test for SqueezeDB function since count fields are different
+					   	if(defined('SQZ_ENABLED') && SQZ_ENABLED == TRUE) {
+							   	$query="SELECT SUM(counter) as value FROM ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+					   	} else {
+							   	$query="SELECT count(*) as value FROM ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+					   	}
+					   	$result = perform_query($query, $dbLink);
+					   	$row = fetch_array($result);
+					   	$query="UPDATE ".CACHETABLENAME." SET value='".$row['value']."' WHERE type='LPD' AND updatetime=DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+					   	perform_query($query, $dbLink);
+				   	} else {
+					   	echo "No update needed\n";
+				   	}
+			   	} else {
+				   	echo "Entry $i...INSERTing\n";
+					   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, SUM(counter) as value, DATE_SUB(CURDATE(), INTERVAL $i DAY) as updatetime FROM ".MERGELOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL $i DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL $i DAY)";
+				   	perform_query($query, $dbLink);
+			   	}
+		   	}
+	   	} else {
+		   	echo "You have no merg table, assuming this is a fresh install and updating cache for today only...\n";
+		   	$query="INSERT INTO ".CACHETABLENAME." (tablename, type, value, updatetime) SELECT '".MERGELOGTABLE."' as tablename, 'LPD' as type, SUM(counter) as value, DATE_SUB(CURDATE(), INTERVAL 0 DAY) as updatetime FROM ".DEFAULTLOGTABLE." WHERE datetime BETWEEN DATE_SUB(CURDATE(), INTERVAL 0 DAY) AND DATE_SUB(DATE_ADD(CURDATE( ), INTERVAL 1 DAY), INTERVAL 0 DAY)";
+		   	perform_query($query, $dbLink);
+	   	}
+   	} else {
+	   	echo "ERROR: ".CACHETABLENAME." is missing a column\n";
+	   	echo "You will need to run the following command in mysql before using this script:\n";
+	   	echo "ALTER TABLE ".CACHETABLENAME." MODIFY `type` enum('HOST','FACILITY','PROGRAM','LPD') default NULL;\n";
+   	}
+} else {
+   	echo "\nLPD Cache is not enabled!\n";
+   	echo "Please make sure the following variable is set in your config.php file:\n";
+   	echo "define('LPD_CACHE', FALSE);\n";
+}
+
+echo "\n".date("Y-m-d H:i:s")."\n";
+echo "All done!\n";
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/MySQL.pm php-syslog-ng/scripts/MySQL.pm
--- php-syslog-ng-2.9.f/scripts/MySQL.pm	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/MySQL.pm	2007-04-20 14:38:41.000000000 -0400
@@ -0,0 +1,1134 @@
+package Net::MySQL;
+
+use 5.004;
+use IO::Socket;
+use Carp;
+use vars qw($VERSION $DEBUG);
+use strict;
+$VERSION = '0.09';
+
+use constant COMMAND_SLEEP          => "\x00";
+use constant COMMAND_QUIT           => "\x01";
+use constant COMMAND_INIT_DB        => "\x02";
+use constant COMMAND_QUERY          => "\x03";
+use constant COMMAND_FIELD_LIST     => "\x04";
+use constant COMMAND_CREATE_DB      => "\x05";
+use constant COMMAND_DROP_DB        => "\x06";
+use constant COMMAND_REFRESH        => "\x07";
+use constant COMMAND_SHUTDOWN       => "\x08";
+use constant COMMAND_STATISTICS     => "\x09";
+use constant COMMAND_PROCESS_INFO   => "\x0A";
+use constant COMMAND_CONNECT        => "\x0B";
+use constant COMMAND_PROCESS_KILL   => "\x0C";
+use constant COMMAND_DEBUG          => "\x0D";
+use constant COMMAND_PING           => "\x0E";
+use constant COMMAND_TIME           => "\x0F";
+use constant COMMAND_DELAYED_INSERT => "\x10";
+use constant COMMAND_CHANGE_USER    => "\x11";
+use constant COMMAND_BINLOG_DUMP    => "\x12";
+use constant COMMAND_TABLE_DUMP     => "\x13";
+use constant COMMAND_CONNECT_OUT    => "\x14";
+
+use constant DEFAULT_PORT_NUMBER => 3306;
+use constant BUFFER_LENGTH       => 1460;
+use constant DEFAULT_UNIX_SOCKET => '/tmp/mysql.sock';
+
+
+sub new
+{
+	my $class = shift;
+	my %args = @_;
+
+	my $self = bless {
+		hostname   => $args{hostname},
+		unixsocket => $args{unixsocket} || DEFAULT_UNIX_SOCKET,
+		port       => $args{port}       || DEFAULT_PORT_NUMBER,
+		database   => $args{database},
+		user       => $args{user},
+		password   => $args{password},
+		timeout    => $args{timeout}  || 60,
+		'socket'   => undef,
+		salt                 => '',
+		protocol_version     => undef,
+		client_capabilities  => 0,
+		affected_rows_length => 0,
+	}, $class;
+	$self->debug($args{debug});
+	$self->_initialize;
+	return $self;
+}
+
+
+sub query
+{
+	my $self = shift;
+	my $sql = join '', @_;
+	my $mysql = $self->{socket};
+
+	return $self->_execute_command(COMMAND_QUERY, $sql);
+}
+
+
+sub create_database
+{
+	my $self = shift;
+	my $db_name = shift;
+	my $mysql = $self->{socket};
+
+	return $self->_execute_command(COMMAND_CREATE_DB, $db_name);
+}
+
+
+sub drop_database
+{
+	my $self = shift;
+	my $db_name = shift;
+	my $mysql = $self->{socket};
+
+	return $self->_execute_command(COMMAND_DROP_DB, $db_name);
+}
+
+
+sub close
+{
+	my $self = shift;
+	my $mysql = $self->{socket};
+	return unless $mysql->can('send');
+
+	my $quit_message =
+		chr(length(COMMAND_QUIT)). "\x00\x00\x00". COMMAND_QUIT;
+	$mysql->send($quit_message, 0);
+	$self->_dump_packet($quit_message) if Net::MySQL->debug;
+	$mysql->close;
+}
+
+
+sub get_affected_rows_length
+{
+	my $self = shift;
+	$self->{affected_rows_length};
+}
+
+
+sub get_insert_id
+{
+	my $self = shift;
+	$self->{insert_id};
+}
+
+
+sub create_record_iterator
+{
+	my $self = shift;
+	return undef unless $self->has_selected_record;
+
+	my $record = Net::MySQL::RecordIterator->new(
+		$self->{selected_record}
+	);
+	$self->{selected_record} = undef;
+	$record->parse;
+	return $record;
+}
+
+
+sub has_selected_record
+{
+	my $self = shift;
+	$self->{selected_record} ? 1 : undef;
+}
+
+
+sub is_error
+{
+	my $self = shift;
+	$self->{error_code} ? 1 : undef;
+}
+
+
+sub get_error_code
+{
+	my $self = shift;
+	$self->{error_code};
+}
+
+
+sub get_error_message
+{
+	my $self = shift;
+	$self->{server_message};
+}
+
+
+sub debug
+{
+	my $class = shift;
+	$DEBUG = shift if @_;
+	$DEBUG;
+}
+
+
+sub _connect
+{
+	my $self = shift;
+
+	my $mysql;
+	if ($self->{hostname}) {
+		printf "Use INET Socket: %s %d/tcp\n", $self->{hostname}, $self->{port}
+			if $self->debug;
+		$mysql = IO::Socket::INET->new(
+			PeerAddr => $self->{hostname},
+			PeerPort => $self->{port},
+			Proto    => 'tcp',
+			Timeout  => $self->{timeout} || 60,
+		) or croak "Couldn't connect to $self->{hostname}:$self->{port}/tcp: $@";
+	}
+	else {
+		printf "Use UNIX Socket: %s\n", $self->{unixsocket} if $self->debug;
+		$mysql = IO::Socket::UNIX->new(
+			Type => SOCK_STREAM,
+			Peer => $self->{unixsocket},
+		) or croak "Couldn't connect to $self->{unixsocket}: $@";
+	}
+	$mysql->autoflush(1);
+	$self->{socket} = $mysql;
+}
+
+
+sub _get_server_information
+{
+	my $self = shift;
+	my $mysql = $self->{socket};
+
+	my $message;
+	$mysql->recv($message, BUFFER_LENGTH, 0);
+	$self->_dump_packet($message)
+		if Net::MySQL->debug;
+	my $i = 0;
+	my $packet_length = ord substr $message, $i, 1;
+	$i += 4;
+	$self->{protocol_version} = ord substr $message, $i, 1;
+	printf "Protocol Version: %d\n", $self->{protocol_version}
+		if Net::MySQL->debug;
+	if ($self->{protocol_version} == 10) {
+		$self->{client_capabilities} = 1;
+	}
+
+	++$i;
+	my $string_end = index($message, "\0", $i) - $i;
+	$self->{server_version} = substr $message, $i, $string_end;
+	printf "Server Version: %s\n", $self->{server_version}
+		if Net::MySQL->debug;
+
+	$i += $string_end + 1;
+	$self->{server_thread_id} = unpack 'v', substr $message, $i, 2;
+	$i += 4;
+	$self->{salt} = substr $message, $i, 8;
+	$self->{saltold} = $self->{salt};
+        #
+	$i += 8+1;
+	if (length $message >= $i + 1) {
+		$i += 1;
+	}
+	if (length $message >= $i + 18) {
+		# get server_language
+		# get server_status
+	}
+	$i += 18 - 1;
+	if (length $message >= $i + 12 - 1) {
+		$self->{salt} .= substr $message, $i, 12;
+	}
+	printf "Salt: %s\n", $self->{salt} if Net::MySQL->debug;
+
+}
+
+
+sub _request_authentication
+{
+	my $self = shift;
+	my $mysql = $self->{socket};
+	$self->_send_login_message();
+
+	my $auth_result;
+	$mysql->recv($auth_result, BUFFER_LENGTH, 0);
+	$self->_dump_packet($auth_result) if Net::MySQL->debug;
+	if ($self->_is_error($auth_result)) {
+		$mysql->close;
+		if (length $auth_result < 7) {
+			croak "Timeout of authentication";
+		}
+		croak substr $auth_result, 7;
+	} elsif (ord(substr $auth_result, 4) == 254 ) {
+            $self->_send_password();
+            $mysql->recv($auth_result, BUFFER_LENGTH, 0);
+	    $self->_dump_packet($auth_result) if Net::MySQL->debug;
+	    if ($self->_is_error($auth_result)) {
+		$mysql->close;
+		if (length $auth_result < 7) {
+			croak "Timeout of authentication";
+		}
+		croak substr $auth_result, 7;
+            }
+        }
+	print "connect database\n" if Net::MySQL->debug;
+}
+
+
+sub _send_login_message
+{
+	my $self = shift;
+	my $mysql = $self->{socket};
+	my $body = "\0\0\x01\x0d\xa6\03\0\0\0\0\x01".
+		"\x21\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0".
+		 join "\0",
+		$self->{user},
+		"\x14".
+		Net::MySQL::Password->scramble(
+			$self->{password}, $self->{salt}, $self->{client_capabilities}
+		);
+	$body .= $self->{database};
+	$body .= "\0";
+	my $login_message = chr(length($body)-3). $body;
+	$mysql->send($login_message, 0);
+	$self->_dump_packet($login_message) if Net::MySQL->debug;
+}
+
+sub _send_password
+{
+        my $self = shift;
+	my $mysql = $self->{socket};
+	my $body = "\0\0\x03".
+		 Net::MySQL::Password32->scramble(
+			$self->{password}, $self->{saltold}, $self->{client_capabilities}
+		);
+	$body .= "\0";
+	my $pw_message = chr(length($body)-3). $body;
+	$mysql->send($pw_message, 0);
+	$self->_dump_packet($pw_message) if Net::MySQL->debug;
+}
+
+sub _execute_command
+{
+	my $self = shift;
+	my $command = shift;
+	my $sql = shift;
+	my $mysql = $self->{socket};
+
+	my $message = pack('V', length($sql) + 1). $command. $sql;
+	$mysql->send($message, 0);
+	$self->_dump_packet($message) if Net::MySQL->debug;
+
+	my $result;
+	$mysql->recv($result, BUFFER_LENGTH, 0);
+	$self->_dump_packet($result) if Net::MySQL->debug;
+	$self->_reset_status;
+
+	if ($self->_is_error($result)) {
+		return $self->_set_error_by_packet($result);
+	}
+	elsif ($self->_is_select_query_result($result)) {
+		return $self->_get_record_by_server($result);
+	}
+	elsif ($self->_is_update_query_result($result)){
+		return $self->_get_affected_rows_information_by_packet($result);
+	}
+	else {
+		croak 'Unknown Result: '. $self->_get_result_length($result). 'byte';
+	}
+}
+
+
+sub _initialize
+{
+	my $self = shift;
+	$self->_connect;
+	$self->_get_server_information;
+	$self->_request_authentication;
+}
+
+
+sub _set_error_by_packet
+{
+	my $self = shift;
+	my $packet = shift;
+
+	my $error_message = $self->_get_server_message($packet);
+	$self->{server_message} = $error_message;
+	$self->{error_code}     = $self->_get_error_code($packet);
+	return undef;
+}
+
+
+sub _get_record_by_server
+{
+	my $self = shift;
+	my $packet = shift;
+	my $mysql = $self->{socket};
+	$self->_get_column_length($packet);
+	while ($self->_has_next_packet($packet)) {
+		my $next_result;
+		$mysql->recv($next_result, BUFFER_LENGTH, 0);
+		$packet .= $next_result;
+		$self->_dump_packet($next_result) if Net::MySQL->debug;
+	}
+	$self->{selected_record} = $packet;
+}
+
+
+sub _get_affected_rows_information_by_packet
+{
+	my $self = shift;
+	my $packet = shift;
+
+	$self->{affected_rows_length} = $self->_get_affected_rows_length($packet);
+	$self->{insert_id} = $self->_get_insert_id($packet);
+	$self->{server_message} = $self->_get_server_message($packet);
+	return $self->{affected_rows_length};
+}
+
+
+sub _is_error
+{
+	my $self = shift;
+	my $packet = shift;
+	return 1 if length $packet < 4;
+	ord(substr $packet, 4) == 255;
+}
+
+
+sub _is_select_query_result
+{
+	my $self = shift;
+	my $packet = shift;
+	return undef if $self->_is_error($packet);
+	ord(substr $packet, 4) >= 1;
+}
+
+
+sub _is_update_query_result
+{
+	my $self = shift;
+	my $packet = shift;
+	return undef if $self->_is_error($packet);
+	ord(substr $packet, 4) == 0;
+}
+
+
+sub _get_result_length
+{
+	my $self = shift;
+	my $packet = shift;
+	ord(substr $packet, 0, 1)
+}
+
+
+sub _get_column_length
+{
+	my $self = shift;
+	my $packet = shift;
+	ord(substr $packet, 4);
+}
+
+
+sub _get_affected_rows_length
+{
+	my $self = shift;
+	my $packet = shift;
+	my $pos = 5;
+	return Net::MySQL::Util::get_field_length($packet, \$pos);
+}
+
+
+sub _get_insert_id
+{
+	my $self = shift;
+	my $packet = shift;
+	return ord(substr $packet, 6, 1) if ord(substr $packet, 6, 1) != 0xfc;
+	unpack 'v', substr $packet, 7, 2;
+}
+
+
+sub _get_server_message
+{
+	my $self = shift;
+	my $packet = shift;
+	return '' if length $packet < 7;
+	substr $packet, 7;
+}
+
+
+sub _get_error_code
+{
+	my $self = shift;
+	my $packet = shift;
+	$self->_is_error($packet)
+		or croak "_get_error_code(): Is not error packet";
+	unpack 'v', substr $packet, 5, 2;
+}
+
+
+sub _reset_status
+{
+	my $self = shift;
+	$self->{insert_id}       = 0;
+	$self->{server_message}  = '';
+	$self->{error_code}      = undef;
+	$self->{selected_record} = undef;
+}
+
+
+sub _has_next_packet
+{
+	my $self = shift;
+	#substr($_[0], -1) ne "\xfe";
+	return substr($_[0], -5) ne "\xfe\0\0\x22\x00";
+}
+
+
+sub _dump_packet {
+    my $self = shift;
+    my $packet = shift;
+    my ($method_name) = (caller(1))[3];
+    my $str = sprintf "%s():\n", $method_name;
+    while ($packet =~ /(.{1,16})/sg) {
+        my $line = $1;
+        $str .= join ' ', map {sprintf '%02X', ord $_} split //, $line;
+        $str .= '   ' x (16 - length $line);
+        $str .= '  ';
+        $str .= join '', map {
+            sprintf '%s', (/[\w\d\*\,\?\%\=\'\;\(\)\.-]/) ? $_ : '.'
+        } split //, $line;
+        $str .= "\n"; 
+    }
+    print $str;
+}
+
+
+
+package Net::MySQL::RecordIterator;
+use strict;
+
+use constant NULL_COLUMN           => 251;
+use constant UNSIGNED_CHAR_COLUMN  => 251;
+use constant UNSIGNED_SHORT_COLUMN => 252;
+use constant UNSIGNED_INT24_COLUMN => 253;
+use constant UNSIGNED_INT32_COLUMN => 254;
+use constant UNSIGNED_CHAR_LENGTH  => 1;
+use constant UNSIGNED_SHORT_LENGTH => 2;
+use constant UNSIGNED_INT24_LENGTH => 3;
+use constant UNSIGNED_INT32_LENGTH => 4;
+use constant UNSIGNED_INT32_PAD_LENGTH => 4;
+
+
+sub new
+{
+	my $class = shift;
+	my $packet = shift;
+	bless {
+		packet   => $packet,
+		position => 0,
+		column   => [],
+	}, $class;
+}
+
+
+sub parse
+{
+	my $self = shift;
+	$self->_get_column_length;
+	$self->_get_column_name;
+}
+
+
+sub each
+{
+	my $self = shift;
+	my @result;
+	return undef if $self->is_end_of_packet;
+
+	for (1..$self->{column_length}) {
+		push @result, $self->_get_string_and_seek_position;
+	}
+	$self->{position} += 4;
+
+	return \@result;
+}
+
+
+sub is_end_of_packet
+{
+	my $self = shift;
+	return substr($self->{packet}, $self->{position}, 1) eq "\xFE";
+}
+
+
+sub get_field_length
+{
+	my $self = shift;
+	$self->{column_length};
+}
+
+
+sub get_field_names
+{
+	my $self = shift;
+	map { $_->{column} } @{$self->{column}};
+}
+
+
+sub _get_column_length
+{
+	my $self = shift;
+	$self->{position} += 4;
+	$self->{column_length} = ord substr $self->{packet}, $self->{position}, 1;
+	$self->{position} += 5;
+	printf "Column Length: %d\n", $self->{column_length}
+		if Net::MySQL->debug;
+}
+
+
+sub _get_column_name
+{
+	my $self = shift;
+
+	for my $i (1.. $self->{column_length}) {
+		$self->_get_string_and_seek_position;
+		$self->_get_string_and_seek_position;
+		my $table = $self->_get_string_and_seek_position;
+		$self->_get_string_and_seek_position;
+		my $column = $self->_get_string_and_seek_position;
+		$self->_get_string_and_seek_position;
+		push @{$self->{column}}, {
+			table  => $table,
+			column => $column,
+		};
+		$self->_get_string_and_seek_position;
+		$self->{position} += 4;
+	}
+	$self->{position} += 9;
+	printf "Column name: '%s'\n",
+		join ", ", map { $_->{column} } @{$self->{column}}
+			if Net::MySQL->debug;
+}
+
+
+sub _get_string_and_seek_position
+{
+	my $self = shift;
+
+	my $length = $self->_get_field_length();
+
+	return undef unless defined $length;
+
+	my $string = substr $self->{packet}, $self->{position}, $length;
+	$self->{position} += $length;
+	return $string;
+}
+
+
+sub _get_field_length
+{
+	my $self = shift;
+	return Net::MySQL::Util::get_field_length($self->{packet}, \$self->{position});
+}
+
+
+package Net::MySQL::Util;
+use strict;
+
+use constant NULL_COLUMN           => 251;
+use constant UNSIGNED_CHAR_COLUMN  => 251;
+use constant UNSIGNED_SHORT_COLUMN => 252;
+use constant UNSIGNED_INT24_COLUMN => 253;
+use constant UNSIGNED_INT32_COLUMN => 254;
+use constant UNSIGNED_CHAR_LENGTH  => 1;
+use constant UNSIGNED_SHORT_LENGTH => 2;
+use constant UNSIGNED_INT24_LENGTH => 3;
+use constant UNSIGNED_INT32_LENGTH => 4;
+use constant UNSIGNED_INT32_PAD_LENGTH => 4;
+
+
+sub get_field_length
+{
+	my $packet = shift;
+	my $pos = shift;
+
+	my $head = ord substr(
+		$packet,
+		$$pos,
+		UNSIGNED_CHAR_LENGTH
+	);
+	$$pos += UNSIGNED_CHAR_LENGTH;
+
+	return undef if $head == NULL_COLUMN;
+	if ($head < UNSIGNED_CHAR_COLUMN) {
+		return $head;
+	}
+	elsif ($head == UNSIGNED_SHORT_COLUMN) {
+		my $length = unpack 'v', substr(
+			$packet,
+			$$pos,
+			UNSIGNED_SHORT_LENGTH
+		);
+		$$pos += UNSIGNED_SHORT_LENGTH;
+		return $length;
+	}
+	elsif ($head == UNSIGNED_INT24_COLUMN) {
+		my $int24 = substr(
+			$packet, $$pos,
+			UNSIGNED_INT24_LENGTH
+		);
+		my $length = unpack('C', substr($int24, 0, 1))
+		          + (unpack('C', substr($int24, 1, 1)) << 8)
+			  + (unpack('C', substr($int24, 2, 1)) << 16);
+		$$pos += UNSIGNED_INT24_LENGTH;
+		return $length;
+	}
+	else {
+		my $int32 = substr(
+			$packet, $$pos,
+			UNSIGNED_INT32_LENGTH
+		);
+		my $length = unpack('C', substr($int32, 0, 1))
+		          + (unpack('C', substr($int32, 1, 1)) << 8)
+			  + (unpack('C', substr($int32, 2, 1)) << 16)
+			  + (unpack('C', substr($int32, 3, 1)) << 24);
+		$$pos += UNSIGNED_INT32_LENGTH;
+		$$pos += UNSIGNED_INT32_PAD_LENGTH;
+		return $length;
+	}
+}
+
+
+
+package Net::MySQL::Password;
+use strict;
+use Digest::SHA1;
+
+sub scramble {
+	my $class = shift;
+	my $password = shift;
+	my $hash_seed = shift;
+	return '' unless $password;
+	return '' if length $password == 0;
+	return _make_scrambled_password($hash_seed, $password);
+}
+
+
+sub _make_scrambled_password {
+	my $message = shift;
+	my $password = shift;
+
+	my $ctx = Digest::SHA1->new;
+	$ctx->reset;
+	$ctx->add($password);
+	my $stage1 = $ctx->digest;
+
+	$ctx->reset;
+	$ctx->add($stage1);
+	my $stage2 = $ctx->digest;
+
+	$ctx->reset;
+	$ctx->add($message);
+	$ctx->add($stage2);
+	my $result = $ctx->digest;
+	return _my_crypt($result, $stage1);
+}
+
+sub _my_crypt {
+	my $s1 = shift;
+	my $s2 = shift;
+	my $l = length($s1) - 1;
+	my $result = '';
+	for my $i (0..$l) {
+		$result .= pack 'C', (unpack('C', substr($s1, $i, 1)) ^ unpack('C', substr($s2, $i, 1)));
+	}
+	return $result;
+}
+
+package Net::MySQL::Password32;
+use strict;
+
+sub scramble
+{
+	my $class = shift;
+	my $password = shift;
+	my $hash_seed = shift;
+	my $client_capabilities = shift;
+
+	return '' unless $password;
+	return '' if length $password == 0;
+
+	my $hsl = length $hash_seed;
+	my @out;
+	my @hash_pass = _get_hash($password);
+	my @hash_mess = _get_hash($hash_seed);
+
+	my ($max_value, $seed, $seed2);
+	my ($dRes, $dSeed, $dMax);
+	if ($client_capabilities < 1) {
+		$max_value = 0x01FFFFFF;
+		$seed = _xor_by_long($hash_pass[0], $hash_mess[0]) % $max_value;
+		$seed2 = int($seed / 2);
+	} else {
+		$max_value= 0x3FFFFFFF;
+		$seed  = _xor_by_long($hash_pass[0], $hash_mess[0]) % $max_value;
+		$seed2 = _xor_by_long($hash_pass[1], $hash_mess[1]) % $max_value;
+	}
+	$dMax = $max_value;
+
+	for (my $i=0; $i < $hsl; $i++) {
+		$seed  = int(($seed * 3 + $seed2) % $max_value);
+		$seed2 = int(($seed + $seed2 + 33) % $max_value);
+		$dSeed = $seed;
+		$dRes = $dSeed / $dMax;
+		push @out, int($dRes * 31) + 64;
+	}
+
+	if ($client_capabilities == 1) {
+		# Make it harder to break
+		$seed  = ($seed * 3 + $seed2  ) % $max_value;
+		$seed2 = ($seed + $seed2 + 33 ) % $max_value;
+		$dSeed = $seed;
+
+		$dRes = $dSeed / $dMax;
+		my $e = int($dRes * 31);
+		for (my $i=0; $i < $hsl ; $i++) {
+			$out[$i] ^= $e;
+		}
+	}
+	return join '', map { chr $_ } @out;
+}
+
+
+sub _get_hash
+{
+	my $password = shift;
+
+	my $nr = 1345345333;
+	my $add = 7; 
+	my $nr2 = 0x12345671;
+	my $tmp;
+	my $pwlen = length $password;
+	my $c;
+
+	for (my $i=0; $i < $pwlen; $i++) {
+		my $c = substr $password, $i, 1;
+		next if $c eq ' ' || $c eq "\t";
+		my $tmp = ord $c;
+		my $value = ((_and_by_char($nr, 63) + $add) * $tmp) + $nr * 256;
+		$nr = _xor_by_long($nr, $value);
+		$nr2 += _xor_by_long(($nr2 * 256), $nr);
+		$add += $tmp;
+	}
+	return (_and_by_long($nr, 0x7fffffff), _and_by_long($nr2, 0x7fffffff));
+}
+
+
+sub _and_by_char
+{
+	my $source = shift;
+	my $mask   = shift;
+
+	return $source & $mask;
+}
+
+
+sub _and_by_long
+{
+	my $source = shift;
+	my $mask = shift || 0xFFFFFFFF;
+
+	return _cut_off_to_long($source) & _cut_off_to_long($mask);
+}
+
+
+sub _xor_by_long
+{
+	my $source = shift;
+	my $mask = shift || 0;
+
+	return _cut_off_to_long($source) ^ _cut_off_to_long($mask);
+}
+
+
+sub _cut_off_to_long
+{
+	my $source = shift;
+
+	if ($] >= 5.006) {
+		$source = $source % (0xFFFFFFFF + 1) if $source > 0xFFFFFFFF;
+		return $source;
+	}
+	while ($source > 0xFFFFFFFF) {
+		$source -= 0xFFFFFFFF + 1;
+	}
+	return $source;
+}
+
+
+1;
+__END__
+
+=head1 NAME
+
+Net::MySQL - Pure Perl MySQL network protocol interface.
+
+=head1 SYNOPSIS
+
+  use Net::MySQL;
+  
+  my $mysql = Net::MySQL->new(
+      # hostname => 'mysql.example.jp',   # Default use UNIX socket
+      database => 'your_database_name',
+      user     => 'user',
+      password => 'password'
+  );
+
+  # INSERT example
+  $mysql->query(q{
+      INSERT INTO tablename (first, next) VALUES ('Hello', 'World')
+  });
+  printf "Affected row: %d\n", $mysql->get_affected_rows_length;
+
+  # SLECT example
+  $mysql->query(q{SELECT * FROM tablename});
+  my $record_set = $mysql->create_record_iterator;
+  while (my $record = $record_set->each) {
+      printf "First column: %s Next column: %s\n",
+          $record->[0], $record->[1];
+  }
+  $mysql->close;
+
+=head1 DESCRIPTION
+
+Net::MySQL is a Pure Perl client interface for the MySQL database. This module implements network protocol between server and client of MySQL, thus you don't need external MySQL client library like libmysqlclient for this module to work. It means this module enables you to connect to MySQL server from some operation systems which MySQL is not ported. How nifty!
+
+Since this module's final goal is to completely replace DBD::mysql, API is made similar to that of DBI.
+
+From perl you activate the interface with the statement
+
+    use Net::MySQL;
+
+After that you can connect to multiple MySQL daemon and send multiple queries to any of them via a simple object oriented interface.
+
+There are two classes which have public APIs: Net::MySQL and Net::MySQL::RecordIterator.
+
+    $mysql = Net::MySQL->new(
+        hostname => $host,
+        database => $database,
+        user     => $user,
+        password => $password,
+    );
+
+Once you have connected to a daemon, you can can execute SQL with:
+
+    $mysql->query(q{
+        INSERT INTO foo (id, message) VALUES (1, 'Hello World')
+    });
+
+If you want to retrieve results, you need to create a so-called statement handle with:
+
+    $mysql->query(q{
+        SELECT id, message FROM foo
+    });
+    if ($mysql->has_selected_record) {
+        my $a_record_iterator = $mysql->create_record_iterator;
+        # ...
+    }
+
+This Net::MySQL::RecordIterator object can be used for multiple purposes. First of all you can retreive a row of data:
+
+    my $record = $a_record_iterator->each;
+
+The each() method takes out the reference result of one line at a time, and the return value is ARRAY reference.
+
+=head2 Net::MySQL API
+
+=over 4
+
+=item new(HASH)
+
+    use Net::MySQL;
+    use strict;
+
+    my $mysql = Net::MySQL->new(
+        unixsocket => $path_to_socket,
+        hostname   => $host,
+        database   => $database,
+        user       => $user,
+        password   => $password,
+    );
+
+The constructor of Net::MySQL. Connection with MySQL daemon is established and the object is returned. Argument hash contains following parameters:
+
+=over 8
+
+=item unixsocket
+
+Path of the UNIX socket where MySQL daemon. default is F</tmp/mysql.sock>.
+Supposing I<hostname> is omitted, it will connect by I<UNIX Socket>.
+
+=item hostname
+
+Name of the host where MySQL daemon runs.
+Supposing I<hostname> is specified, it will connect by I<INET Socket>.
+
+=item port
+
+Port where MySQL daemon listens to. default is 3306.
+
+=item database
+
+Name of the database to connect.
+
+=item user / password
+
+Username and password for database authentication.
+
+=item timeout
+
+The waiting time which carries out a timeout when connection is overdue is specified.
+
+=item debug
+
+The exchanged packet will be outputted if a true value is given.
+
+=back
+
+
+=item create_database(DB_NAME)
+
+A create_DATABASE() method creates a database by the specified name.
+
+    $mysql->create_database('example_db');
+    die $mysql->get_error_message if $mysql->is_error;
+
+=item drop_database(DB_NAME)
+
+A drop_database() method deletes the database of the specified name.
+
+    $mysql->drop_database('example_db');
+    die $mysql->get_error_message if $mysql->is_error;
+
+=item query(SQL_STRING)
+
+A query() method transmits the specified SQL string to MySQL database, and obtains the response.
+
+=item create_record_iterator()
+
+When SELECT type SQL is specified, Net::MySQL::RecordIterator object which shows the reference result is returned.
+
+    $mysql->query(q{SELECT * FROM table});
+    my $a_record_iterator = $mysql->create_recrod_iterator();
+
+Net::MySQL::RecordIterator object is applicable to acquisition of a reference result. See L<"/Net::SQL::RecordIterator API"> for more.
+
+=item get_affected_rows_length()
+
+returns the number of records finally influenced by specified SQL.
+
+    my $affected_rows = $mysql->get_affected_rows_length;
+
+=item get_insert_id()
+
+MySQL has the ability to choose unique key values automatically. If this happened, the new ID will be stored in this attribute. 
+
+=item is_error()
+
+TRUE will be returned if the error has occurred.
+
+=item has_selected_record()
+
+TRUE will be returned if it has a reference result by SELECT.
+
+=item get_field_length()
+
+return the number of column.
+
+=item get_field_names()
+
+return column names by ARRAY.
+
+=item close()
+
+transmits an end message to MySQL daemon, and closes a socket.
+
+=back
+
+=head2 Net::MySQL::RecordIterator API
+
+Net::MySQL::RecordIterator object is generated by the query() method of Net::MySQL object. Thus it has no public constructor method.
+
+=over 4
+
+=item each()
+
+each() method takes out only one line from a result, and returns it as an ARRAY reference. C<undef> is returned when all the lines has been taken out.
+
+    while (my $record = $a_record_iterator->each) {
+        printf "Column 1: %s Column 2: %s Collumn 3: %s\n",
+            $record->[0], $record->[1], $record->[2];
+    }
+
+=back
+
+=head1 SUPPORT OPERATING SYSTEM
+
+This module has been tested on these OSes.
+
+=over 4
+
+=item * MacOS 9.x
+
+with MacPerl5.6.1r.
+
+=item * MacOS X
+
+with perl5.6.0 build for darwin.
+
+=item * Windows2000
+
+with ActivePerl5.6.1 build631.
+
+=item * FreeBSD 3.4 and 4.x
+
+with perl5.6.1 build for i386-freebsd.
+
+with perl5.005_03 build for i386-freebsd.
+
+=item * Linux
+
+with perl 5.005_03 built for ppc-linux.
+
+with perl 5.6.0 bult for i386-linux.
+
+=item * Solaris 2.6 (SPARC)
+
+with perl 5.6.1 built for sun4-solaris.
+
+with perl 5.004_04 built for sun4-solaris.
+
+Can use on Solaris2.6 with perl5.004_04, although I<make test> is failure.
+
+=back
+
+This list is the environment which I can use by the test usually. Net::MySQL will operate  also in much environment which is not in a list.
+
+I believe this module can work with whatever perls which has B<IO::Socket>. I'll be glad if you give me a report of successful installation of this module on I<rare> OSes.
+
+=head1 SEE ALSO
+
+L<libmysql>, L<IO::Socket>
+
+=head1 AUTHOR
+
+Hiroyuki OYAMA E<lt>oyama@module.jpE<gt>
+
+=head1 COPYRIGHT AND LICENCE
+
+Copyright (C) 2002 Hiroyuki OYAMA. Japan. All rights reserved.
+
+This library is free software; you can redistribute it and/or modify
+it under the same terms as Perl itself. 
+
+=cut
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/reloadcache.php php-syslog-ng/scripts/reloadcache.php
--- php-syslog-ng-2.9.f/scripts/reloadcache.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/reloadcache.php	2008-08-10 15:49:50.000000000 -0400
@@ -0,0 +1,62 @@
+#!/usr/bin/php
+<?php
+// Copyright (C) 2005 Claus Lund, clauslund@gmail.com
+echo "\nStarting to reload cache\n";
+echo date("Y-m-d H:i:s")."\n\n";
+
+require_once "/www/php-syslog-ng/html/includes/common_funcs.php";
+require_once "/www/php-syslog-ng/html/config/config.php";
+
+$dbLink = db_connect_syslog(DBUSER, DBUSERPW);
+
+// If merge table exists and is not empty
+// then load the cache with data from that table
+/* BEGIN REMOVE cdukes 2-27-08: Removed this check for MERGELOGTABLE
+   I don't see why we're reloading cache from the MERGETABLE???
+   Wouldn't that just make a cache of the all_logs data from midnight of each day and
+   not current data?
+
+if(table_exists(MERGELOGTABLE, $dbLink) == TRUE ) {
+	$mergelog = TRUE;
+	$sql = "SELECT * FROM ".MERGELOGTABLE." LIMIT 1";
+	$result = perform_query($sql, $dbLink);
+	if(num_rows($result)) {
+	echo "Loading the cache with data from the merge table\n";
+	reload_cache(MERGELOGTABLE, $dbLink);
+	}
+} else {
+// Else load the cache with data from each log table
+*/
+	$tableArray = get_logtables($dbLink);
+	foreach($tableArray as $table) {
+		if ($table == MERGELOGTABLE) {
+			continue;
+		}
+		echo "Loading the cache with data from: ".$table."\n";
+		reload_cache($table, $dbLink);
+	}
+// }
+
+// Delete rows with data from log tables that do not exist
+echo "\nDeleting cache entries for tables that no longer exist...\n";
+$tableArray = get_logtables($dbLink);
+
+$sql = "SELECT DISTINCT tablename FROM ".CACHETABLENAME;
+$result = perform_query($sql, $dbLink);
+while($row = fetch_array($result)) {
+	if(array_search($row['tablename'], $tableArray) === FALSE) {
+		$sql = "DELETE FROM ".CACHETABLENAME." WHERE tablename='".$row['tablename']."'";
+		perform_query($sql, $dbLink);
+	}
+}
+
+if($mergelog) {
+	$sql = "DELETE FROM ".CACHETABLENAME." WHERE tablename!='".MERGELOGTABLE."'";
+	perform_query($sql, $dbLink);
+}
+
+echo "\n".date("Y-m-d H:i:s")."\n";
+echo "Reloadcache Completed!\n";
+
+include ("lpdcache.php");
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/resetusers.sh php-syslog-ng/scripts/resetusers.sh
--- php-syslog-ng-2.9.f/scripts/resetusers.sh	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/resetusers.sh	2007-07-18 18:41:28.000000000 -0400
@@ -0,0 +1,21 @@
+#!/bin/bash
+# WARNING: THIS WILL DELETE ALL USERS FROM THE DATABASE AND CREATE NEW ONES
+config="/www/php-syslog-ng/html/config/config.php"
+
+user=`cat $config | grep "'DBADMIN'" | awk -F"'" '{print $4}' `
+pw=`cat $config | grep "'DBADMINPW'" | awk -F"'" '{print $4}' `
+db=`cat $config | grep "'DBNAME'" | awk -F"'" '{print $4}' `
+
+echo
+echo "WARNING: THIS WILL DELETE ALL USERS FROM THE DATABASE AND CREATE NEW ONES"
+echo
+echo "continuing in 5 seconds"
+echo "ctrl-c now to abort!"
+sleep 5
+echo "delete from users;" | mysql -u $user --password=$pw $db
+
+echo "
+INSERT INTO users VALUES ('admin','21232f297a57a5a743894a0e4a801fc3','c65e0e4a8fd3ea3d433d78c4ab27f8e7','2007-07-06 12:15:35'),('demo','fe01ce2a7fbac8fafaed7c982a04e229',NULL,NULL);
+" | mysql -u $user --password=$pw $db
+echo "script completed..."
+
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/SqueezeDB-v2.2.php php-syslog-ng/scripts/SqueezeDB-v2.2.php
--- php-syslog-ng-2.9.f/scripts/SqueezeDB-v2.2.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/SqueezeDB-v2.2.php	2008-07-23 16:04:54.000000000 -0400
@@ -0,0 +1,442 @@
+<?php
+/*
+ * squeezedb.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2008 http://nms.gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2008-02-08 - created
+ * 2008-02-10 - Fixed count bug (db inserts were calculating incorrect count)
+
+ *  $Log: SqueezeDB-v2.2.php,v $
+ *  Revision 2.2  2008/07/21 06:13:04  cdukes
+ *  Added test for max iterations due to excessive memory consumption in arrays for large systems.
+ *  Set $max to whatever your system can handle
+ *  Memory usage will print during run so you can test for your needs.
+ *  This will allow you to run the script more often to deduplicate messages on larger systems
+ *  For example, you can now just create a small shell script instead of cron to run every x seconds:
+ * i=0
+ * while [ $i -le 1000000 ]
+ *  do
+ *    php /www/php-syslog-ng/scripts/SqueezeDB-v2.2.php
+ *	    sleep 3
+ *		    i=`expr $i + 1`
+ *			done
+ *
+ *
+ * Ethan's RCS log:
+ *
+ *  $Log: SqueezeDB-v2.0.php,v $
+ *  Revision 1.3  2008/03/01 06:13:04  ethan
+ *  Implemented database transaction functions.  Lowered $matchpercent from 95 to 90.
+ *
+ *  Revision 1.2  2008/03/01 02:58:10  ethan
+ *  Modified matching strings to include hostname like Clayton's
+ *  original algorithm.
+ *
+ *  Revision 1.1  2008/03/01 01:02:32  ethan
+ *  Initial revision
+ *
+ *
+ */
+
+/*
+   NOTE: Versions of php-syslog-ng 2.9.5d and below will need to alter the database to use this script
+   ALTER TABLE logs ADD counter INT NOT NULL DEFAULT 1;
+   ALTER TABLE logs ADD fo datetime default NULL;
+   ALTER TABLE logs ADD lo datetime default NULL;
+
+   Basic Usage:
+   $s = "/USR/SBIN/CRON[10749]: (root) CMD (php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log)";
+   $s2 = "/USR/SBIN/CRON[10849]: (root) CMD (php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log)";
+   similar_text($s, $s2, $p);
+   echo "Percent: $p%";
+
+   Description:
+   This calculates the similarity between two strings as described in Oliver [1993]. 
+   Note that this implementation does not use a stack as in Oliver's pseudo code, but 
+   recursive calls which may or may not speed up the whole process. Note also that the 
+   complexity of this algorithm is O(N**3) where N is the length of the longest string.
+   
+   Once a match is made, the source row is updated with a "count" of the destination (compared to) row.
+   It also logs the "first occurance" and "last occurance" of the message so that you can get an idea
+   of how long the message has been repeating.
+
+   Why is this useful?
+   Running this script makes a HUGE difference on the amount of data you have to store, and subsequently, search through
+   to get to what you really want - an answer to the # 1 question for most customers: Where are my problem children?
+
+   Example:
+   When tested on a smaller database, I get the following results:
+   // Starting Row Count = 12832
+   // Ending Row Count = 1770
+   // Cleaned 11062 records saving 86 percent
+   // Squeeze finished in 1318.39662099 seconds (9.7 MPS)
+   (note: I hope to get this script to run faster/more efficiently in the future, if you have ideas, please let me know!)
+   (note2: The amount of time it takes to run may vary greatly for you based on hardware 
+   - it will take a long time on the first run, but subsequent runs should improve markedly.
+   Update for v2.0 Script:
+   Starting Row Count = 4271
+   Ending Row Count = 170
+   Cleaned 4101 records saving 96 percent
+   Squeeze finished in 2.07 seconds (2063.29 MPS)
+
+   Now, we can quickly pull valuable data from the (much smaller!) databse by doing:
+   (this will show the top 10 "problem" children")
+   mysql> SELECT host,counter,msg from logs WHERE counter>1 ORDER BY counter DESC limit 10;
+
+   +--------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
+   | host    | counter | msg
+   +--------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
+   | host-a |     668 | 466927:         If Cisco determines that your insertion of non-Cisco memory, WIC cards,
+   |
+   | host-b |     644 | 466928:         AIM cards, Network Modules, SPA cards, GBICs or other modules into a
+   |
+   | host-c |     614 | 466925:         The module in slot 4 in this router may not be a genuine Cisco product.
+   |
+   | host-d |     585 | 466926:         Cisco warranties and support programs only apply to genuine Cisco products.
+   |
+   | host-e |     572 | 466929:         Cisco product is the cause of a support issue, Cisco may deny support under
+   |
+   | host-f |     385 | 466930:         your warranty or under a Cisco support program such as SmartNet.
+   |
+   | host-g |     215 | 467114:         your warranty or under a Cisco support program such as SmartNet.
+   |
+   | host-h |     165 | 32574: %CDP-4-DUPLEX_MISMATCH: duplex mismatch discovered on FastEthernet1/26 (not full duplex), with 7200-3 FastEthernet1/0 (full duplex).  
+   |
+   | host-i |     133 | /USR/SBIN/CRON[2858]: (root) CMD (php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log)
+   |
+   | host-j |     133 | /USR/SBIN/CRON[2861]: (root) CMD (php /www/rtpnml-xray/htdocs/cacti/poller.php > /dev/null 2>&1)
+   |
+   +--------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------+
+   10 rows in set (0.01 sec)
+
+   As you can see, most of the "spammy" messages are useless and could easily be ignored or deleted (and definitely shouldn't be taking up so many rows!)
+   Also note that one of the top issues listed is CDP Duplex (gee there's a surprise) - maybe we should go fix that host/device!
+
+   This is an excellent way (and much faster) to get your Top X problem children with an added benefit of trimming 85-95% of the fat off your database!"
+*/
+
+$max_sql_in_list_count = 255;
+
+include_once "/www/php-syslog-ng/html/includes/common_funcs.php";
+include_once "/www/php-syslog-ng/html/config/config.php";
+
+
+$time_start = get_microtime();
+echo "\nStarting Squeeze\n";
+
+// Open connection to DB
+$dbLink = db_connect_syslog(DBADMIN, DBADMINPW);
+
+//========================================================================
+// START: Set level to match on
+// Possible values are 1 to 99.9999999999
+// I highly recommend NOT using 1 unless you want to lose all your data...
+//========================================================================
+
+// Original value in Clayton's code (things go much faster at 90):
+#$matchpercent = 95;
+$matchpercent = 86;
+// CDUKES: Jun 18, 2008: Changed this to 86%, it seemed to work much better for me in finding duplicate rows
+
+//------------------------------------------------------------------------
+// Grab all rows by sequence # (the primary key) for processing
+//------------------------------------------------------------------------
+// if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+//    	$query = "SELECT SQL_CALC_FOUND_ROWS seq from " .DEFAULTLOGTABLE ." ORDER BY seq ASC";
+// }
+// else {
+//    	$query = "SELECT seq from " . DEFAULTLOGTABLE . " ORDER BY seq ASC";
+// }
+
+
+// Set a limit to avoid puking
+// $limit = "LIMIT 50000";
+
+$query = "SELECT * from " . DEFAULTLOGTABLE . " ORDER BY seq ASC $limit";
+
+
+
+$result = perform_query($query, $dbLink);
+
+//------------------------------------------------------------------------
+// Get row count
+//------------------------------------------------------------------------
+if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+	$num_results_array = perform_query("SELECT FOUND_ROWS()", $dbLink);
+   	$num_results_array = fetch_array($num_results_array);
+   	$num_rows = $num_results_array[0];
+} else {
+   	$num_rows = mysql_num_rows($result);
+}
+echo "$num_rows total rows to process\n";
+
+
+
+//------------------------------------------------------------------------
+// Begin outer loop
+// Loop through each record and collect information in a multi-dimensional
+// associative array keyed by host.
+//------------------------------------------------------------------------
+$exact_matches = 0;
+$similar_matches = 0;
+$rowcnt = 1;
+error_reporting(E_ALL);
+$host_message_cache = array();
+$max = 8000; // Max messages to process at a single time
+while ($row = fetch_array($result)) {
+   	if (count($host_message_cache, COUNT_RECURSIVE) < $max ) {
+	   	//print_r($row); exit();
+	   	$r_host = $row['host'];
+	   	$r_message = $row['msg'];
+	   	$r_seq = $row['seq'];
+	   	$r_entry_timestamp = $row['datetime'];
+	   	$r_fo = $row['fo'];
+	   	$r_lo = $row['lo']; 
+
+		if (array_key_exists($r_host, $host_message_cache))
+	   	{
+		   	// Host already in cache.  Update or create message entry.
+
+			$message_found = false;
+		   	$messages = $host_message_cache[$r_host];
+
+			// First check for exact match (on key value).  Otherwise, do the
+		   	// similar_text() (expensive) check.
+
+			if (array_key_exists($r_message, $host_message_cache[$r_host]))
+		   	{
+			   	// Found match in existing message set.  Update stats:
+			   	// echo "Found match in existing message set.  Update stats...\n";
+			   	$host_message_cache[$r_host][$r_message]['child_seqs'][]
+				   	= $r_seq;
+			   	$host_message_cache[$r_host][$r_message]['last_message_time']
+				   	= $r_lo ? $r_lo : $r_entry_timestamp;
+			   	$message_found = true;
+			   	$exact_matches++;
+		   	}
+		   	else
+		   	{
+			   	$tc=0;
+			   	foreach ($messages as $message => $message_data)
+			   	{
+				   	// Note: similar_text should be changed to return the matchpercent,
+				   	// instead of returning value by side effect.
+				  	//   (The host . message concatenation is done for consistency
+				   	//    with Clayton's original algorithm).
+				  	similar_text("$r_host,$r_message", "$r_host,$message", $p);	
+					/*
+					   if ($r_host = "11.16.254.160") { 
+					   echo "DEBUG $p\n\t$r_host,$r_message\n\t$r_host,$message\n";
+					   }
+					   if ($tc > 120) {
+					   exit;
+					   }
+					 */
+				   	if ($p >= $matchpercent)
+				   	{
+					   	// Found match in existing message set.  Update stats:
+					   	// echo "MATCH: $r_host,$r_message", "$r_host,$message, $p\n ";
+					   	$host_message_cache[$r_host][$message]['child_seqs'][]
+						   	= $r_seq;
+					   	$host_message_cache[$r_host][$message]['last_message_time']
+						   	= $r_lo ? $r_lo : $r_entry_timestamp;
+
+						$message_found = true;
+					   	$similar_matches++;
+					   	// echo "$similar_matches matches\n";
+					   	break;
+				   	}
+				   	$tc++;
+			   	}
+		   	}
+		   	if (!$message_found)
+		   	{
+			   	// Found not match in existing message set.  Create new entry.
+			  	$message_info = array('parent_seq' => $r_seq,
+					   	'child_seqs' => array(),
+					   	'first_message_time' => $r_entry_timestamp,
+					   	'last_message_time' => $r_lo ? $r_lo : $r_entry_timestamp);
+			   	$host_message_cache[$r_host][$r_message] = $message_info;
+		   	}
+	   	}
+	   	else
+	   	{
+		   	// Host didn't exist in cache, so create an entry for it
+
+			$message_info = array('parent_seq' => $r_seq,
+				   	'child_seqs' => array(),
+				   	'first_message_time' => $r_entry_timestamp,
+				   	'last_message_time' => $r_lo ? $r_lo : $r_entry_timestamp);
+		   	$host_message_cache[$r_host][$r_message] = $message_info;
+
+		}
+
+		if (($rowcnt++ % 1000 == 0))
+	   	{
+		   	// print_r($host_message_cache);
+		   	// print " $rowcnt\n ";
+		   	echo "Row $rowcnt Memory used: ".number_format(memory_get_usage())." bytes\n";
+		   	// exit();
+	   	}
+
+	} 
+	else {
+	   	// print_r($host_message_cache);
+	   	break;
+   	}
+}
+
+#print_r ($host_message_cache); exit;
+
+// We now have all of the information in the $host_message_cache.  Loop over
+// each message for each host and modify the database accordingly by
+// updating the message parent row's stats and deleting child rows.
+
+// We are doing a lot of database modification.  It should all be part of the same transaction.
+
+print "\n\n";
+print "Debug: Log table analysis complete.\n";
+print "Debug: Exact log message matches: $exact_matches\n";
+print "Debug: Similar log message matches: $similar_matches\n";
+
+
+print "Debug: Starting log table modifications...\n";
+$db_time_start = get_microtime();
+
+begin_transaction($dbLink);
+foreach ($host_message_cache as $host => $messages)
+{
+   	foreach ($messages as $message => $message_data)
+   	{
+	   	if (!$message_data['child_seqs'])
+		   	continue; // Solitary message with no associations.
+
+
+		// Bugfix: http://code.google.com/p/php-syslog-ng/issues/detail?id=70
+	   	// $count = count($message_data['child_seqs']) + 1; // Children + parent
+	   	$parent_seq = $message_data['parent_seq'];
+	   	$query_count = "SELECT counter FROM " . DEFAULTLOGTABLE . " WHERE seq = '$parent_seq'";
+	   	$result_count = perform_query($query_count, $dbLink);
+	   	$row_count = fetch_array($result_count);
+	   	$r_counter = $row_count['counter'];
+
+		if (($r_counter == '') || ($r_counter == 0))
+	   	{
+		   	$count = count($message_data['child_seqs']) + 1; // Children + parent
+	   	}
+	   	else
+	   	{
+		   	$count = count($message_data['child_seqs']) + $r_counter; // Children + parent
+	   	}
+	   	$fo = $message_data['first_message_time'];
+	   	$lo = $message_data['last_message_time'];
+	   	$query = "UPDATE " . DEFAULTLOGTABLE . "  SET counter = $count, fo = '$fo', lo = '$lo' WHERE seq = '$parent_seq'";
+
+		// Update the parent record to reflect count and start, end times.
+	  	if (! perform_query($query, $dbLink)) // Assuming that your perform_query returns false on error
+	   	{
+		   	rollback($dbLink);
+		   	die("Error: Update failed.");
+	   	}
+
+		// Delete all the child records.
+
+		// Create a set of SQL IN lists (e.g. "('seq1', 'seq2',...).  You
+	   	// need a set because there can be limits of 255 IN list members.
+	  	// print "Splitting lists into array of 255\n";
+	   	$lists = array_chunk($message_data['child_seqs'], $max_sql_in_list_count);
+	   	foreach ($lists as $list)
+	   	{
+		   	$in_list = create_sql_in_list($list);
+		   	$query = "DELETE FROM " . DEFAULTLOGTABLE . " WHERE seq IN $in_list";
+		   	// print "Processing in list\n";
+		   	if (! perform_query($query, $dbLink)) // Assuming that your perform_query returns false on error
+		   	{
+			   	rollback($dbLink);
+			   	die("Error: Delete failed.");
+		   	}
+	   	}
+   	}
+}
+
+commit($dbLink);
+
+$dbsecs = get_microtime() - $db_time_start;
+print "Debug: Log table modifications complete in $dbsecs seconds...\n";
+
+//------------------------------------------------------------------------
+// Gather and spit out some stats
+//------------------------------------------------------------------------
+
+$query = 'SELECT count(*) AS "count" from ' . DEFAULTLOGTABLE ;
+$result = perform_query($query, $dbLink);
+$row = fetch_array($result);
+$num_rows_after = $row['count'];
+$savings = $num_rows - $num_rows_after;
+$savings_p = round( ($savings/$num_rows)*100, 0 );
+echo "\nStarting Row Count = $num_rows\n";
+echo "Ending Row Count = $num_rows_after\n";
+echo "Cleaned $savings records saving $savings_p percent\n";
+$time_end = get_microtime();
+$exetime = round($time_end - $time_start, 2);
+$mps = round($num_rows/$exetime, 2);
+echo "Squeeze finished in ".$exetime." seconds ($mps MPS)\n";
+//========================================================================
+// END
+//========================================================================
+
+///// Functions (should probably be put in include file common functions
+
+/**
+ * Create an SQL in list '(val1,val2,...,valn)' from an array.  If any
+ * elements are not numeric, treat all as characters.
+ * One may also use the $force_string arg to force a string type.
+ */
+function create_sql_in_list($vals, $force_string = false)
+{
+   	$is_str = array_filter($vals,
+		   	create_function('$val', 'return (! is_numeric($val));'));
+
+	$is_str = $is_str || $force_string;
+   	$res = '(';
+   	$sep = '';
+   	foreach ($vals as $val)
+   	{
+	   	$res .= $sep;
+	   	if ($is_str)
+		   	$res .= "'";
+	   	$res .= $val;
+	   	if ($is_str)
+		   	$res .= "'";
+	   	$sep = ',';
+   	}
+   	$res .= ')';
+   	return $res;
+}
+
+/**
+ * Database transaction functions.
+ *
+ *  
+ */
+
+function begin_transaction($dbLink)
+{
+   	mysql_query('begin');
+}
+
+function rollback($dbLink)
+{
+   	mysql_query('rollback');
+}
+
+function commit($dbLink)
+{
+   	mysql_query('commit');
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/SqueezeDB-v2.3.php php-syslog-ng/scripts/SqueezeDB-v2.3.php
--- php-syslog-ng-2.9.f/scripts/SqueezeDB-v2.3.php	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/SqueezeDB-v2.3.php	2008-08-07 17:59:43.000000000 -0400
@@ -0,0 +1,457 @@
+<?php
+/*
+ * squeezedb.php
+ *
+ * Developed by Clayton Dukes <cdukes@cdukes.com>
+ * Copyright (c) 2008 http://nms.gdd.net
+ * Licensed under terms of GNU General Public License.
+ * All rights reserved.
+ *
+ * Changelog:
+ * 2008-02-08 - created
+ * 2008-02-10 - Fixed count bug (db inserts were calculating incorrect count)
+
+ *  $Log: SqueezeDB-v2.3.php,v $
+ *  Revision 2.3  2008/08/07 06:13:04  cdukes
+ *  REF: http://code.google.com/p/php-syslog-ng/issues/detail?id=75
+ *  Added test for command line argument (ARGV)
+ *  This will alow passing a variable into the script to only run on select databases
+ *  Example:
+ *  php SqueezeDB.php logs20080807
+ *  Would tell the script to only run Squeeze on the Aug 07, 2008 log table
+ * 
+ *  $Log: SqueezeDB-v2.2.php,v $
+ *  Revision 2.2  2008/07/21 06:13:04  cdukes
+ *  Added test for max iterations due to excessive memory consumption in arrays for large systems.
+ *  Set $max to whatever your system can handle
+ *  Memory usage will print during run so you can test for your needs.
+ *  This will allow you to run the script more often to deduplicate messages on larger systems
+ *  For example, you can now just create a small shell script instead of cron to run every x seconds:
+ * i=0
+ * while [ $i -le 1000000 ]
+ *  do
+ *    php /www/php-syslog-ng/scripts/SqueezeDB-v2.2.php
+ *	    sleep 3
+ *		    i=`expr $i + 1`
+ *			done
+ *
+ *
+ * Ethan's RCS log:
+ *
+ *  $Log: SqueezeDB-v2.0.php,v $
+ *  Revision 1.3  2008/03/01 06:13:04  ethan
+ *  Implemented database transaction functions.  Lowered $matchpercent from 95 to 90.
+ *
+ *  Revision 1.2  2008/03/01 02:58:10  ethan
+ *  Modified matching strings to include hostname like Clayton's
+ *  original algorithm.
+ *
+ *  Revision 1.1  2008/03/01 01:02:32  ethan
+ *  Initial revision
+ *
+ *
+ */
+
+/*
+   NOTE: Versions of php-syslog-ng 2.9.5d and below will need to alter the database to use this script
+   ALTER TABLE logs ADD counter INT NOT NULL DEFAULT 1;
+   ALTER TABLE logs ADD fo datetime default NULL;
+   ALTER TABLE logs ADD lo datetime default NULL;
+
+   Basic Usage:
+   $s = "/USR/SBIN/CRON[10749]: (root) CMD (php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log)";
+   $s2 = "/USR/SBIN/CRON[10849]: (root) CMD (php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log)";
+   similar_text($s, $s2, $p);
+   echo "Percent: $p%";
+
+   Description:
+   This calculates the similarity between two strings as described in Oliver [1993]. 
+   Note that this implementation does not use a stack as in Oliver's pseudo code, but 
+   recursive calls which may or may not speed up the whole process. Note also that the 
+   complexity of this algorithm is O(N**3) where N is the length of the longest string.
+   
+   Once a match is made, the source row is updated with a "count" of the destination (compared to) row.
+   It also logs the "first occurance" and "last occurance" of the message so that you can get an idea
+   of how long the message has been repeating.
+
+   Why is this useful?
+   Running this script makes a HUGE difference on the amount of data you have to store, and subsequently, search through
+   to get to what you really want - an answer to the # 1 question for most customers: Where are my problem children?
+
+   Example:
+   When tested on a smaller database, I get the following results:
+   // Starting Row Count = 12832
+   // Ending Row Count = 1770
+   // Cleaned 11062 records saving 86 percent
+   // Squeeze finished in 1318.39662099 seconds (9.7 MPS)
+   (note: I hope to get this script to run faster/more efficiently in the future, if you have ideas, please let me know!)
+   (note2: The amount of time it takes to run may vary greatly for you based on hardware 
+   - it will take a long time on the first run, but subsequent runs should improve markedly.
+   Update for v2.0 Script:
+   Starting Row Count = 4271
+   Ending Row Count = 170
+   Cleaned 4101 records saving 96 percent
+   Squeeze finished in 2.07 seconds (2063.29 MPS)
+
+   Now, we can quickly pull valuable data from the (much smaller!) databse by doing:
+   (this will show the top 10 "problem" children")
+   mysql> SELECT host,counter,msg from logs WHERE counter>1 ORDER BY counter DESC limit 10;
+
+   +--------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
+   | host    | counter | msg
+   +--------+---------+-----------------------------------------------------------------------------------------------------------------------------------------------------+
+   | host-a |     668 | 466927:         If Cisco determines that your insertion of non-Cisco memory, WIC cards,
+   |
+   | host-b |     644 | 466928:         AIM cards, Network Modules, SPA cards, GBICs or other modules into a
+   |
+   | host-c |     614 | 466925:         The module in slot 4 in this router may not be a genuine Cisco product.
+   |
+   | host-d |     585 | 466926:         Cisco warranties and support programs only apply to genuine Cisco products.
+   |
+   | host-e |     572 | 466929:         Cisco product is the cause of a support issue, Cisco may deny support under
+   |
+   | host-f |     385 | 466930:         your warranty or under a Cisco support program such as SmartNet.
+   |
+   | host-g |     215 | 467114:         your warranty or under a Cisco support program such as SmartNet.
+   |
+   | host-h |     165 | 32574: %CDP-4-DUPLEX_MISMATCH: duplex mismatch discovered on FastEthernet1/26 (not full duplex), with 7200-3 FastEthernet1/0 (full duplex).  
+   |
+   | host-i |     133 | /USR/SBIN/CRON[2858]: (root) CMD (php /www/php-syslog-ng/scripts/reloadcache.php >> /var/log/php-syslog-ng/reloadcache.log)
+   |
+   | host-j |     133 | /USR/SBIN/CRON[2861]: (root) CMD (php /www/rtpnml-xray/htdocs/cacti/poller.php > /dev/null 2>&1)
+   |
+   +--------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------+
+   10 rows in set (0.01 sec)
+
+   As you can see, most of the "spammy" messages are useless and could easily be ignored or deleted (and definitely shouldn't be taking up so many rows!)
+   Also note that one of the top issues listed is CDP Duplex (gee there's a surprise) - maybe we should go fix that host/device!
+
+   This is an excellent way (and much faster) to get your Top X problem children with an added benefit of trimming 85-95% of the fat off your database!"
+*/
+
+$max_sql_in_list_count = 255;
+
+include_once "/www/php-syslog-ng/html/includes/common_funcs.php";
+include_once "/www/php-syslog-ng/html/config/config.php";
+
+
+$time_start = get_microtime();
+echo "\nStarting Squeeze\n";
+
+// Open connection to DB
+$dbLink = db_connect_syslog(DBADMIN, DBADMINPW);
+
+//========================================================================
+// START: Set level to match on
+// Possible values are 1 to 99.9999999999
+// I highly recommend NOT using 1 unless you want to lose all your data...
+//========================================================================
+
+// Original value in Clayton's code (things go much faster at 90):
+#$matchpercent = 95;
+// CDUKES: Jun 18, 2008: Changed this to 86%, it seemed to work much better for me in finding duplicate rows
+$matchpercent = 86;
+
+// CDUKES: Aug 7, 2008: Added for command line passing of tables
+$Tables = array();
+if ($argc > 1) {
+   	foreach ($argv as $arg) {
+	   	if ($arg != $argv[0]) {
+		   	$tableArray = get_logtables($dbLink);
+		   	foreach($tableArray as $table) {
+			   	if ($table == $arg) {
+				   	array_push($Tables, $arg);
+			   	} else {
+				   	echo "Table $arg does not exist in this dojo!\n";
+			   	}
+		   	}
+	   	}
+   	}
+} else {
+   	array_push($Tables, DEFAULTLOGTABLE);
+}
+// die(print_r($Tables));
+foreach($Tables as $table) {
+   	echo "Processing Squeeze on $table\n";
+   	//------------------------------------------------------------------------
+   	// Grab all rows by sequence # (the primary key) for processing
+   	//------------------------------------------------------------------------
+   	$query = "SELECT * from " . $table . " ORDER BY seq ASC $limit";
+   	$result = perform_query($query, $dbLink);
+
+	//------------------------------------------------------------------------
+   	// Get row count
+   	//------------------------------------------------------------------------
+   	if(defined('COUNT_ROWS') && COUNT_ROWS == TRUE) {
+	   	$num_results_array = perform_query("SELECT FOUND_ROWS()", $dbLink);
+	   	$num_results_array = fetch_array($num_results_array);
+	   	$num_rows = $num_results_array[0];
+   	} else {
+	   	$num_rows = mysql_num_rows($result);
+   	}
+   	echo "$num_rows total rows to process\n";
+
+	//------------------------------------------------------------------------
+   	// Begin outer loop
+   	// Loop through each record and collect information in a multi-dimensional
+   	// associative array keyed by host.
+  	//------------------------------------------------------------------------
+   	$exact_matches = 0;
+   	$similar_matches = 0;
+   	$rowcnt = 1;
+   	error_reporting(E_ALL);
+   	$host_message_cache = array();
+   	$max = 8000; // Max messages to process at a single time
+   	while ($row = fetch_array($result)) {
+	   	if (count($host_message_cache, COUNT_RECURSIVE) < $max ) {
+		   	//print_r($row); exit();
+		   	$r_host = $row['host'];
+		   	$r_message = $row['msg'];
+		   	$r_seq = $row['seq'];
+		   	$r_entry_timestamp = $row['datetime'];
+		   	$r_fo = $row['fo'];
+		   	$r_lo = $row['lo'];
+
+			if (array_key_exists($r_host, $host_message_cache))
+		   	{
+			   	// Host already in cache.  Update or create message entry.
+
+				$message_found = false;
+			   	$messages = $host_message_cache[$r_host];
+
+				// First check for exact match (on key value).  Otherwise, do the
+			   	// similar_text() (expensive) check.
+
+				if (array_key_exists($r_message, $host_message_cache[$r_host]))
+			   	{
+				   	// Found match in existing message set.  Update stats:
+				   	// echo "Found match in existing message set.  Update stats...\n";
+				   	$host_message_cache[$r_host][$r_message]['child_seqs'][]
+					   	= $r_seq;
+				   	$host_message_cache[$r_host][$r_message]['last_message_time']
+					   	= $r_lo ? $r_lo : $r_entry_timestamp;
+				   	$message_found = true;
+				   	$exact_matches++;
+			   	}
+			   	else
+			   	{
+				   	$tc=0;
+				   	foreach ($messages as $message => $message_data)
+				   	{
+					   	// Note: similar_text should be changed to return the matchpercent,
+					   	// instead of returning value by side effect.
+					  	//   (The host . message concatenation is done for consistency
+					   	//    with Clayton's original algorithm).
+					  	similar_text("$r_host,$r_message", "$r_host,$message", $p);	
+						/*
+						   if ($r_host = "11.16.254.160") { 
+						   echo "DEBUG $p\n\t$r_host,$r_message\n\t$r_host,$message\n";
+						   }
+						   if ($tc > 120) {
+						   exit;
+						   }
+						 */
+					   	if ($p >= $matchpercent)
+					   	{
+						   	// Found match in existing message set.  Update stats:
+						   	// echo "MATCH: $r_host,$r_message", "$r_host,$message, $p\n ";
+						   	$host_message_cache[$r_host][$message]['child_seqs'][]
+							   	= $r_seq;
+						   	$host_message_cache[$r_host][$message]['last_message_time']
+							   	= $r_lo ? $r_lo : $r_entry_timestamp;
+
+							$message_found = true;
+						   	$similar_matches++;
+						   	// echo "$similar_matches matches\n";
+						   	break;
+					   	}
+					   	$tc++;
+				   	}
+			   	}
+			   	if (!$message_found)
+			   	{
+				   	// Found not match in existing message set.  Create new entry.
+				  	$message_info = array('parent_seq' => $r_seq,
+						   	'child_seqs' => array(),
+						   	'first_message_time' => $r_entry_timestamp,
+						   	'last_message_time' => $r_lo ? $r_lo : $r_entry_timestamp);
+				   	$host_message_cache[$r_host][$r_message] = $message_info;
+			   	}
+		   	}
+		   	else
+		   	{
+			   	// Host didn't exist in cache, so create an entry for it
+
+				$message_info = array('parent_seq' => $r_seq,
+					   	'child_seqs' => array(),
+					   	'first_message_time' => $r_entry_timestamp,
+					   	'last_message_time' => $r_lo ? $r_lo : $r_entry_timestamp);
+			   	$host_message_cache[$r_host][$r_message] = $message_info;
+
+			}
+
+			if (($rowcnt++ % 1000 == 0))
+		   	{
+			   	// print_r($host_message_cache);
+			   	// print " $rowcnt\n ";
+			   	echo "Row $rowcnt Memory used: ".number_format(memory_get_usage())." bytes\n";
+			   	// exit();
+		   	}
+
+		} 
+		else {
+		   	// print_r($host_message_cache);
+		   	break;
+	   	}
+   	}
+
+#print_r ($host_message_cache); exit;
+
+	// We now have all of the information in the $host_message_cache.  Loop over
+   	// each message for each host and modify the database accordingly by
+   	// updating the message parent row's stats and deleting child rows.
+
+	// We are doing a lot of database modification.  It should all be part of the same transaction.
+
+	print "\n\n";
+   	print "Debug: Log table analysis complete.\n";
+   	print "Debug: Exact log message matches: $exact_matches\n";
+   	print "Debug: Similar log message matches: $similar_matches\n";
+
+
+	print "Debug: Starting log table modifications...\n";
+   	$db_time_start = get_microtime();
+
+	begin_transaction($dbLink);
+   	foreach ($host_message_cache as $host => $messages)
+   	{
+	   	foreach ($messages as $message => $message_data)
+	   	{
+		   	if (!$message_data['child_seqs'])
+			   	continue; // Solitary message with no associations.
+
+
+			// Bugfix: http://code.google.com/p/php-syslog-ng/issues/detail?id=70
+		   	// $count = count($message_data['child_seqs']) + 1; // Children + parent
+		   	$parent_seq = $message_data['parent_seq'];
+		   	$query_count = "SELECT counter FROM " . $table . " WHERE seq = '$parent_seq'";
+		   	$result_count = perform_query($query_count, $dbLink);
+		   	$row_count = fetch_array($result_count);
+		   	$r_counter = $row_count['counter'];
+
+			if (($r_counter == '') || ($r_counter == 0))
+		   	{
+			   	$count = count($message_data['child_seqs']) + 1; // Children + parent
+		   	}
+		   	else
+		   	{
+			   	$count = count($message_data['child_seqs']) + $r_counter; // Children + parent
+		   	}
+		   	$fo = $message_data['first_message_time'];
+		   	$lo = $message_data['last_message_time'];
+		   	$query = "UPDATE " . $table . "  SET counter = $count, fo = '$fo', lo = '$lo' WHERE seq = '$parent_seq'";
+
+			// Update the parent record to reflect count and start, end times.
+		  	if (! perform_query($query, $dbLink)) // Assuming that your perform_query returns false on error
+		   	{
+			   	rollback($dbLink);
+			   	die("Error: Update failed.");
+		   	}
+
+			// Delete all the child records.
+
+			// Create a set of SQL IN lists (e.g. "('seq1', 'seq2',...).  You
+		   	// need a set because there can be limits of 255 IN list members.
+		  	// print "Splitting lists into array of 255\n";
+		   	$lists = array_chunk($message_data['child_seqs'], $max_sql_in_list_count);
+		   	foreach ($lists as $list)
+		   	{
+			   	$in_list = create_sql_in_list($list);
+			   	$query = "DELETE FROM " . $table . " WHERE seq IN $in_list";
+			   	// print "Processing in list\n";
+			   	if (! perform_query($query, $dbLink)) // Assuming that your perform_query returns false on error
+			   	{
+				   	rollback($dbLink);
+				   	die("Error: Delete failed.");
+			   	}
+		   	}
+	   	}
+   	}
+
+	commit($dbLink);
+}
+
+	$dbsecs = get_microtime() - $db_time_start;
+   	print "Debug: Log table modifications complete in $dbsecs seconds...\n";
+
+	//------------------------------------------------------------------------
+   	// Gather and spit out some stats
+   	//------------------------------------------------------------------------
+
+	$query = 'SELECT count(*) AS "count" from ' . $table ;
+   	$result = perform_query($query, $dbLink);
+   	$row = fetch_array($result);
+   	$num_rows_after = $row['count'];
+   	$savings = $num_rows - $num_rows_after;
+   	$savings_p = round( ($savings/$num_rows)*100, 0 );
+   	echo "\nStarting Row Count = $num_rows\n";
+   	echo "Ending Row Count = $num_rows_after\n";
+   	echo "Cleaned $savings records saving $savings_p percent\n";
+   	$time_end = get_microtime();
+   	$exetime = round($time_end - $time_start, 2);
+   	$mps = round($num_rows/$exetime, 2);
+   	echo "Squeeze finished in ".$exetime." seconds ($mps MPS)\n";
+//========================================================================
+// END
+//========================================================================
+
+///// Functions (should probably be put in include file common functions
+
+/**
+ * Create an SQL in list '(val1,val2,...,valn)' from an array.  If any
+ * elements are not numeric, treat all as characters.
+ * One may also use the $force_string arg to force a string type.
+ */
+function create_sql_in_list($vals, $force_string = false)
+{
+   	$is_str = array_filter($vals,
+		   	create_function('$val', 'return (! is_numeric($val));'));
+
+	$is_str = $is_str || $force_string;
+   	$res = '(';
+   	$sep = '';
+   	foreach ($vals as $val)
+   	{
+	   	$res .= $sep;
+	   	if ($is_str)
+		   	$res .= "'";
+	   	$res .= $val;
+	   	if ($is_str)
+		   	$res .= "'";
+	   	$sep = ',';
+   	}
+   	$res .= ')';
+   	return $res;
+}
+
+/**
+ * Database transaction functions.
+ *
+ *  
+ */
+
+function begin_transaction($dbLink)
+{
+   	mysql_query('begin');
+}
+
+function rollback($dbLink)
+{
+   	mysql_query('rollback');
+}
+
+function commit($dbLink)
+{
+   	mysql_query('commit');
+}
+?>
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/syslog-ng.conf php-syslog-ng/scripts/syslog-ng.conf
--- php-syslog-ng-2.9.f/scripts/syslog-ng.conf	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/syslog-ng.conf	2009-02-23 11:48:10.000000000 -0500
@@ -0,0 +1,398 @@
+#
+# Configuration file for syslog-ng under Debian
+#
+# attempts at reproducing default syslog behavior
+
+# the standard syslog levels are (in descending order of priority):
+# emerg alert crit err warning notice info debug
+# the aliases "error", "panic", and "warn" are deprecated
+# the "none" priority found in the original syslogd configuration is
+# only used in internal messages created by syslogd
+
+
+######
+# options
+
+options {
+        # disable the chained hostname format in logs
+        # (default is enabled)
+        chain_hostnames(0);
+
+        # the time to wait before a died connection is re-established
+        # (default is 60)
+        time_reopen(10);
+
+        # the time to wait before an idle destination file is closed
+        # (default is 60)
+        time_reap(360);
+
+        # the number of lines buffered before written to file
+        # you might want to increase this if your disk isn't catching with
+        # all the log messages you get or if you want less disk activity
+        # (say on a laptop)
+        # (default is 0)
+        #sync(0);
+
+        # the number of lines fitting in the output queue
+        log_fifo_size(2048);
+
+        # enable or disable directory creation for destination files
+        create_dirs(yes);
+
+        # default owner, group, and permissions for log files
+        # (defaults are 0, 0, 0600)
+        #owner(root);
+        group(adm);
+        perm(0640);
+
+        # default owner, group, and permissions for created directories
+        # (defaults are 0, 0, 0700)
+        #dir_owner(root);
+        #dir_group(root);
+        dir_perm(0755);
+
+        # enable or disable DNS usage
+        # syslog-ng blocks on DNS queries, so enabling DNS may lead to
+        # a Denial of Service attack
+        # (default is yes)
+        use_dns(no);
+
+        # maximum length of message in bytes
+        # this is only limited by the program listening on the /dev/log Unix
+        # socket, glibc can handle arbitrary length log messages, but -- for
+        # example -- syslogd accepts only 1024 bytes
+        # (default is 2048)
+        #log_msg_size(2048);
+};
+
+
+######
+# sources
+
+# all known message sources
+source s_all {
+        # message generated by Syslog-NG
+        internal();
+        # standard Linux log source (this is the default place for the syslog()
+        # function to send logs to)
+        unix-stream("/dev/log");
+        # messages from the kernel
+        file("/proc/kmsg" log_prefix("kernel: "));
+        # use the following line if you want to receive remote UDP logging messages
+        # (this is equivalent to the "-r" syslogd flag)
+        udp();
+};
+
+
+######
+# destinations
+
+# some standard log files
+destination df_auth { file("/var/log/auth.log"); };
+destination df_syslog { file("/var/log/syslog"); };
+destination df_cron { file("/var/log/cron.log"); };
+destination df_daemon { file("/var/log/daemon.log"); };
+destination df_kern { file("/var/log/kern.log"); };
+destination df_lpr { file("/var/log/lpr.log"); };
+destination df_mail { file("/var/log/mail.log"); };
+destination df_user { file("/var/log/user.log"); };
+destination df_uucp { file("/var/log/uucp.log"); };
+
+# these files are meant for the mail system log files
+# and provide re-usable destinations for {mail,cron,...}.info,
+# {mail,cron,...}.notice, etc.
+destination df_facility_dot_info { file("/var/log/$FACILITY.info"); };
+destination df_facility_dot_notice { file("/var/log/$FACILITY.notice"); };
+destination df_facility_dot_warn { file("/var/log/$FACILITY.warn"); };
+destination df_facility_dot_err { file("/var/log/$FACILITY.err"); };
+destination df_facility_dot_crit { file("/var/log/$FACILITY.crit"); };
+
+# these files are meant for the news system, and are kept separated
+# because they should be owned by "news" instead of "root"
+destination df_news_dot_notice { file("/var/log/news/news.notice" owner("news")); };
+destination df_news_dot_err { file("/var/log/news/news.err" owner("news")); };
+destination df_news_dot_crit { file("/var/log/news/news.crit" owner("news")); };
+
+# some more classical and useful files found in standard syslog configurations
+destination df_debug { file("/var/log/debug"); };
+destination df_messages { file("/var/log/messages"); };
+
+# pipes
+# a console to view log messages under X
+destination dp_xconsole { pipe("/dev/xconsole"); };
+
+# consoles
+# this will send messages to everyone logged in
+destination du_all { usertty("*"); };
+
+
+######
+# filters
+
+# all messages from the auth and authpriv facilities
+filter f_auth { facility(auth, authpriv); };
+
+# all messages except from the auth and authpriv facilities
+filter f_syslog { not facility(auth, authpriv); };
+
+# respectively: messages from the cron, daemon, kern, lpr, mail, news, user,
+# and uucp facilities
+filter f_cron { facility(cron); };
+filter f_daemon { facility(daemon); };
+filter f_kern { facility(kern); };
+filter f_lpr { facility(lpr); };
+filter f_mail { facility(mail); };
+filter f_news { facility(news); };
+filter f_user { facility(user); };
+filter f_uucp { facility(uucp); };
+
+# some filters to select messages of priority greater or equal to info, warn,
+# and err
+# (equivalents of syslogd's *.info, *.warn, and *.err)
+filter f_at_least_info { level(info..emerg); };
+filter f_at_least_notice { level(notice..emerg); };
+filter f_at_least_warn { level(warn..emerg); };
+filter f_at_least_err { level(err..emerg); };
+filter f_at_least_crit { level(crit..emerg); };
+
+# all messages of priority debug not coming from the auth, authpriv, news, and
+# mail facilities
+filter f_debug { level(debug) and not facility(auth, authpriv, news, mail); };
+
+# all messages of info, notice, or warn priority not coming form the auth,
+# authpriv, cron, daemon, mail, and news facilities
+filter f_messages {
+        level(info,notice,warn)
+            and not facility(auth,authpriv,cron,daemon,mail,news);
+};
+
+# messages with priority emerg
+filter f_emerg { level(emerg); };
+
+# complex filter for messages usually sent to the xconsole
+filter f_xconsole {
+    facility(daemon,mail)
+        or level(debug,info,notice,warn)
+        or (facility(news)
+                and level(crit,err,notice));
+};
+
+
+######
+# logs
+# order matters if you use "flags(final);" to mark the end of processing in a
+# "log" statement
+
+# these rules provide the same behavior as the commented original syslogd rules
+
+# auth,authpriv.*                 /var/log/auth.log
+log {
+        source(s_all);
+        filter(f_auth);
+        destination(df_auth);
+};
+
+# *.*;auth,authpriv.none          -/var/log/syslog
+log {
+        source(s_all);
+        filter(f_syslog);
+        destination(df_syslog);
+};
+
+# this is commented out in the default syslog.conf
+# cron.*                         /var/log/cron.log
+#log {
+#        source(s_all);
+#        filter(f_cron);
+#        destination(df_cron);
+#};
+
+# daemon.*                        -/var/log/daemon.log
+log {
+        source(s_all);
+        filter(f_daemon);
+        destination(df_daemon);
+};
+
+# kern.*                          -/var/log/kern.log
+log {
+        source(s_all);
+        filter(f_kern);
+        destination(df_kern);
+};
+
+# lpr.*                           -/var/log/lpr.log
+log {
+        source(s_all);
+        filter(f_lpr);
+        destination(df_lpr);
+};
+
+# mail.*                          -/var/log/mail.log
+log {
+        source(s_all);
+        filter(f_mail);
+        destination(df_mail);
+};
+
+# user.*                          -/var/log/user.log
+log {
+        source(s_all);
+        filter(f_user);
+        destination(df_user);
+};
+
+# uucp.*                          /var/log/uucp.log
+log {
+        source(s_all);
+        filter(f_uucp);
+        destination(df_uucp);
+};
+
+# mail.info                       -/var/log/mail.info
+log {
+        source(s_all);
+        filter(f_mail);
+        filter(f_at_least_info);
+        destination(df_facility_dot_info);
+};
+
+# mail.warn                       -/var/log/mail.warn
+log {
+        source(s_all);
+        filter(f_mail);
+        filter(f_at_least_warn);
+        destination(df_facility_dot_warn);
+};
+
+# mail.err                        /var/log/mail.err
+log {
+        source(s_all);
+        filter(f_mail);
+        filter(f_at_least_err);
+        destination(df_facility_dot_err);
+};
+
+# news.crit                       /var/log/news/news.crit
+log {
+        source(s_all);
+        filter(f_news);
+        filter(f_at_least_crit);
+        destination(df_news_dot_crit);
+};
+
+# news.err                        /var/log/news/news.err
+log {
+        source(s_all);
+        filter(f_news);
+        filter(f_at_least_err);
+        destination(df_news_dot_err);
+};
+
+# news.notice                     /var/log/news/news.notice
+log {
+        source(s_all);
+        filter(f_news);
+        filter(f_at_least_notice);
+        destination(df_news_dot_notice);
+};
+
+
+# *.=debug;\
+#         auth,authpriv.none;\
+#         news.none;mail.none     -/var/log/debug
+log {
+        source(s_all);
+        filter(f_debug);
+        destination(df_debug);
+};
+
+
+# *.=info;*.=notice;*.=warn;\
+#         auth,authpriv.none;\
+#         cron,daemon.none;\
+#         mail,news.none          -/var/log/messages
+log {
+        source(s_all);
+        filter(f_messages);
+        destination(df_messages);
+};
+
+# *.emerg                         *
+log {
+        source(s_all);
+        filter(f_emerg);
+        destination(du_all);
+};
+
+
+# daemon.*;mail.*;\
+#         news.crit;news.err;news.notice;\
+#         *.=debug;*.=info;\
+#         *.=notice;*.=warn       |/dev/xconsole
+log {
+        source(s_all);
+        filter(f_xconsole);
+        destination(dp_xconsole);
+};
+
+# Clay's config below
+###########################################################################################
+
+###########################################################################################
+# Feb 04, 2008 Added by cdukes for php-syslog-ng // ref: http://gentoo-wiki.com/HOWTO_setup_PHP-Syslog-NG
+###########################################################################################
+options { 
+		long_hostnames(off);
+
+		# doesn't actually help on Solaris, log(3) truncates at 1024 chars
+		log_msg_size(8192);
+
+		# buffer just a little for performance
+		sync(1);
+
+		# memory is cheap, buffer messages unable to write (like to loghost)
+		log_fifo_size(16384);
+
+		# Hosts we don't want syslog from
+		#bad_hostname("^(ctld.|cmd|tmd|last)$");
+
+		# The time to wait before a dead connection is reestablished (seconds)
+		time_reopen(10);
+
+		#Use DNS so that our good names are used, not hostnames
+		use_dns(yes);
+		dns_cache(yes);
+
+		#Use the whole DNS name
+		use_fqdn(yes);
+
+		keep_hostname(yes);
+		chain_hostnames(no);
+
+		#Read permission for everyone
+		perm(0644);
+
+		# The default action of syslog-ng 1.6.0 is to log a STATS line
+		# to the file every 10 minutes.  That's pretty ugly after a while.
+		# Change it to every 12 hours so you get a nice daily update of
+		# how many messages syslog-ng missed (0).
+		stats(43200); 
+		};
+
+
+source s_everything { internal(); pipe("/proc/kmsg"); unix-stream("/dev/log"); udp(); };
+
+destination d_mysql {
+    program("/usr/bin/mysql -usyslogadmin -psyslogadmin syslog"
+    template("INSERT INTO logs (host, facility, priority, level, tag, datetime, program, msg, seq)
+    VALUES ( '$HOST', '$FACILITY', '$PRIORITY', '$LEVEL', '$TAG', '$YEAR-$MONTH-$DAY $HOUR:$MIN:$SEC', '$PROGRAM', '$MSG', '$SEQ' );\n")
+    template-escape(yes));
+    };
+
+
+log {
+    source(s_everything);
+    destination(d_mysql);
+    };
+# Feb 04, 2008 Added above by cdukes for php-syslog-ng enhancements
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/tests/find_missing_sequences.pl php-syslog-ng/scripts/tests/find_missing_sequences.pl
--- php-syslog-ng-2.9.f/scripts/tests/find_missing_sequences.pl	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/tests/find_missing_sequences.pl	2008-02-24 01:17:54.000000000 -0500
@@ -0,0 +1,72 @@
+#!/usr/bin/perl
+
+###########################################################################################
+#
+# This file will look for missing sequence numbers in the syslog.logs database.
+# I used it to find missing sequence numbers when inserting large amounts of test 
+# data from the "loggen" program in the scripts directory.
+# Created 2-23-07 by cdukes
+###########################################################################################
+
+local $\ = "\n";
+use DBI;
+
+# Change below to match your config path (use full path if you run this from cron)
+my $ngconfig = "/www/php-syslog-ng/html/config/config.php"; 
+
+open( CONFIG, $ngconfig ) or die "Can't open $ngconfig : $!"; 
+my @config = <CONFIG>; 
+close( CONFIG );
+
+my($table,$dbadmin,$dbpw,$dbname,$dbhost,$dbport,$DEBUG);
+foreach my $var (@config) {
+	next unless $var =~ /^define/; # read only def's
+	$table = $1 if ($var =~ /'DEFAULTLOGTABLE', '(\w+)'/);
+	$dbadmin = $1 if ($var =~ /'DBADMIN', '(\w+)'/);
+	$dbpw = $1 if ($var =~ /'DBADMINPW', '(\w+)'/);
+	$dbname = $1 if ($var =~ /'DBNAME', '(\w+)'/);
+	$dbhost = $1 if ($var =~ /'DBHOST', '(\w+)'/);
+	$dbport = $1 if ($var =~ /'DBPORT', '(\w+)'/);
+	$DEBUG = $1 if ($var =~ /'DEBUG', '(\w+)'/);
+	$DEBUG = 1;
+}
+if ( ! $table ) {
+	print "Error: Unable to read config variables from $ngconfig";
+	exit;
+}
+
+# Connect to DB
+$dbh = DBI->connect("dbi:mysql:$dbname","$dbadmin","$dbpw")
+	or die "Connection Error: $DBI::errstr";
+
+# Prepare SELECT statement
+$sql = "SELECT seq FROM $table WHERE tag=26 ORDER BY seq ASC";
+$sth = $dbh->prepare($sql);
+
+# Execute statement
+$sth->execute
+	or die "SQL Error: $DBI::errstr";
+
+# Push results into an array
+while (@row = $sth->fetchrow_array) {
+	push(@seqs, @row);
+}
+
+if ($#seqs > 0) {
+	print "\n\tSearching for gaps in $#seqs total sequence numbers...";
+# I stole most of the great code below from:
+# http://forums.devshed.com/perl-programming-6/find-missing-sequence-and-show-them-in-continuous-order-496037.html
+	my $missing = join ',', map find_gap( $seqs[$_-1], $seqs[$_] ), 1 .. $#seqs;
+	if ($missing) {
+		print "The following sequence numbers are missing from the \"$table\" table: $missing";
+	} else {
+		print "\tNo missing sequences found in the \"$table\" table.";
+	} 
+}
+else {
+	print "\tQuery returned no results: $sql";
+}
+
+sub find_gap {
+	$_[1]-$_[0]-1?$_[1]-$_[0]-2?($_[0]+1).'-'.($_[1]-1):$_[1]-1:();
+} 
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/tests/generate-logs.sh php-syslog-ng/scripts/tests/generate-logs.sh
--- php-syslog-ng-2.9.f/scripts/tests/generate-logs.sh	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/tests/generate-logs.sh	2008-08-07 15:01:46.000000000 -0400
@@ -0,0 +1,45 @@
+#!/bin/sh
+# The following command will generate:
+# 50 messages per second
+# using TCP stream
+# for one minute (60 seconds)
+# on port 5000 (check /etc/syslog-ng.conf to make sure it's listening)
+
+#######################################
+# Prompt for a value
+#######################################
+f_ANSWER()
+{
+   	printf "%s " "$1"
+   	if [ "$2" != "" ] ; then
+	   	printf "[%s] " "$2"
+   	fi 
+	if [ "${DEFAULT:-0}" -eq 0 ] ; then
+	   	read ANSWER
+   	else
+	   	printf "%s\n" "$2"
+   	fi
+   	if [ "$ANSWER" = "" ] ; then
+	   	ANSWER="$2"
+   	fi
+}
+
+f_ANSWER "Logs per day?" "10000000"
+LPD=$ANSWER
+MPS=`expr $LPD / 24 / 60 / 60`
+echo "Will run @ $MPS messages per second"
+f_ANSWER "Destination Host?" "log1"
+HOST=$ANSWER
+f_ANSWER "Port?" "5000"
+PORT=$ANSWER
+f_ANSWER "How Long? (seconds)" "86400"
+TIME=$ANSWER
+
+echo "Starting loggen"
+echo "MPS: $MPS"
+echo "TIME: $TIME"
+echo "HOST: $HOST"
+echo "PORT: $PORT"
+./loggen -r $MPS -S --interval $TIME $HOST $PORT
+echo "Run completed!"
+exit
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/tests/README php-syslog-ng/scripts/tests/README
--- php-syslog-ng-2.9.f/scripts/tests/README	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/tests/README	2008-02-24 01:52:21.000000000 -0500
@@ -0,0 +1,27 @@
+# Tests
+# The loggen program is from syslog-ng. You can use it to insert large amounts of data for testing
+# More info here: http://bazsi.blogs.balabit.com/2007/12/syslog-ng-fun-with-performance.html
+# 
+# The generate-logs.sh is just a sample shell file to show you how to run loggen
+#
+# The  find_missing_sequences.pl file can be run after inserting data using loggen to see if any sequences were missed.
+# Note that you *should* run loggen from a remote system to truly test this since you would want to include any potential ethernet drops.
+#
+#
+# Sample process:
+# 1. copy "loggen" to another linux host
+# 2. from that host, run:
+#
+# # The following command will generate:
+# # 50 messages per second
+# # using TCP stream
+# # for one minute (60 seconds)
+# # on port 5000 (check /etc/syslog-ng.conf to make sure it's listening)
+# # to the "loghost" server (make an /etc/hosts entry or replace with the IP address)
+#
+# ./loggen -r 50 -S --interval 60 loghost 5000
+#
+# Finally, run:
+# ./find_missing_sequences.pl
+# to find any missing sequences.
+# According to Bazsi, you should be able to get 68,000 messages per second which is essentially wire speed (100Mb)
diff -Nur -Nur php-syslog-ng-2.9.f/scripts/users.sql php-syslog-ng/scripts/users.sql
--- php-syslog-ng-2.9.f/scripts/users.sql	1969-12-31 19:00:00.000000000 -0500
+++ php-syslog-ng/scripts/users.sql	2007-09-14 11:01:51.000000000 -0400
@@ -0,0 +1,50 @@
+-- MySQL dump 10.10
+--
+-- Host: localhost    Database: syslog
+-- ------------------------------------------------------
+-- Server version	5.0.24a-Debian_9ubuntu2-log
+
+/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
+/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
+/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
+/*!40101 SET NAMES utf8 */;
+/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
+/*!40103 SET TIME_ZONE='+00:00' */;
+/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
+/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
+/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
+/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
+
+--
+-- Table structure for table `users`
+--
+
+DROP TABLE IF EXISTS `users`;
+CREATE TABLE `users` (
+  `username` varchar(32) NOT NULL default '',
+  `pwhash` char(40) default NULL,
+  `sessionid` char(32) default NULL,
+  `exptime` datetime default NULL,
+  PRIMARY KEY  (`username`)
+) ENGINE=MyISAM DEFAULT CHARSET=latin1;
+
+--
+-- Dumping data for table `users`
+--
+
+
+/*!40000 ALTER TABLE `users` DISABLE KEYS */;
+LOCK TABLES `users` WRITE;
+INSERT INTO `users` VALUES ('admin','cbcb57332ea0290af7ca6b61df97e644','b7f3597d98f4782b3beee88a228b91f3','0000-00-00 00:00:00'),('demo','fe01ce2a7fbac8fafaed7c982a04e229','bcdc7030ed10d4e46f91f11fcf921b31','2007-09-14 11:56:12');
+UNLOCK TABLES;
+/*!40000 ALTER TABLE `users` ENABLE KEYS */;
+/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;
+
+/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
+/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
+/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
+/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
+/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
+/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
+/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
